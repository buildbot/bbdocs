<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.5.1. Configuring Buildbot &mdash; Buildbot 3.11.9 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/buildbot_rtd.css?v=915d5e18" />

  
    <link rel="shortcut icon" href="../../_static/icon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=0eee63e3"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.5.2. Global Configuration" href="global.html" />
    <link rel="prev" title="2.5. Configuration" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Buildbot
              <img src="../../_static/full_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.11.9
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.5.1. Configuring Buildbot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#config-file-format">2.5.1.1. Config File Format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#predefined-config-file-symbols">2.5.1.2. Predefined Config File Symbols</a></li>
<li class="toctree-l4"><a class="reference internal" href="#testing-the-config-file">2.5.1.3. Testing the Config File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loading-the-config-file">2.5.1.4. Loading the Config File</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="workers.html">2.5.6. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="projects.html">2.5.8. Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildfactories.html">2.5.9. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsets.html">2.5.10. Build Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="properties.html">2.5.11. Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="steps/index.html">2.5.12. Build Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="interlocks.html">2.5.13. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="report_generators/index.html">2.5.14. Report Generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="reporters/index.html">2.5.15. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="www.html">2.5.16. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="wwwhooks.html">2.5.17. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="services/index.html">2.5.18. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbconfig.html">2.5.19. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="configurators.html">2.5.20. Configurators</a></li>
<li class="toctree-l3"><a class="reference internal" href="manhole.html">2.5.21. Manhole</a></li>
<li class="toctree-l3"><a class="reference internal" href="multimaster.html">2.5.22. Multimaster</a></li>
<li class="toctree-l3"><a class="reference internal" href="multicodebase.html">2.5.23. Multiple-Codebase Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc/index.html">2.5.24. Miscellaneous Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="tests/index.html">2.5.25. Testing Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relnotes/index.html">4. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relnotes/index.html#older-release-notes">5. Older Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices.html">6. API Indices</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Buildbot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">2.5. </span>Configuration</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.5.1. </span>Configuring Buildbot</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/manual/configuration/intro.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="configuring-buildbot">
<h1><span class="section-number">2.5.1. </span>Configuring Buildbot<a class="headerlink" href="#configuring-buildbot" title="Link to this heading"></a></h1>
<p>Buildbot’s behavior is defined by the <em>config file</em>, which normally lives in the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file in the buildmaster’s base directory (but this can be changed with an option to the <strong class="command">buildbot create-master</strong> command).
This file completely specifies which <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s are to be run, which workers they should use, how <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s should be tracked, and where the status information is to be sent.
The buildmaster’s <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file names the base directory; everything else comes from the config file.</p>
<p>A sample config file was installed for you when you created the buildmaster, but you will need to edit it before your Buildbot will do anything useful.</p>
<p>This chapter gives an overview of the format of this file and the various sections in it.
You will need to read the later chapters to understand how to fill in each section properly.</p>
<section id="config-file-format">
<span id="id1"></span><h2><span class="section-number">2.5.1.1. </span>Config File Format<a class="headerlink" href="#config-file-format" title="Link to this heading"></a></h2>
<p>The config file is, fundamentally, just a piece of Python code which defines a dictionary named <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code>, with a number of keys that are treated specially.
You don’t need to know Python to do the basic configuration, though; you can just copy the sample file’s syntax.
If you <em>are</em> comfortable writing Python code, however, you can use all the power of a full programming language to build more complicated configurations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code> name is the only one which matters: all other names defined during the execution of the file are discarded.
When parsing the config file, the Buildmaster generally compares the old configuration with the new one and performs the minimum set of actions necessary to bring Buildbot up to date: <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s which are not changed are left untouched, and <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s which are modified get to keep their old event history.</p>
<p>The beginning of the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file typically starts with something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BuildmasterConfig</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Therefore a config key like <a class="reference internal" href="changesources.html#cfg-change_source" title="change_source"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">change_source</span></code></a> will usually appear in <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> as <code class="docutils literal notranslate"><span class="pre">c['change_source']</span></code>.</p>
<p>See <a class="reference internal" href="../../bb-cfg.html" title="Buildmaster Configuration Index"><em>Buildmaster Configuration Index</em></a> for a full list of <code class="docutils literal notranslate"><span class="pre">BuildMasterConfig</span></code> keys.</p>
<section id="basic-python-syntax">
<h3>Basic Python Syntax<a class="headerlink" href="#basic-python-syntax" title="Link to this heading"></a></h3>
<p>The master configuration file is interpreted as Python, allowing the full flexibility of the language.
For the configurations described in this section, a detailed knowledge of Python is not required, but the basic syntax is easily described.</p>
<p>Python comments start with a hash character <code class="docutils literal notranslate"><span class="pre">#</span></code>, tuples are defined with <code class="docutils literal notranslate"><span class="pre">(parenthesis,</span> <span class="pre">pairs)</span></code>, and lists (arrays) are defined with <code class="docutils literal notranslate"><span class="pre">[square,</span> <span class="pre">brackets]</span></code>.
Tuples and lists are mostly interchangeable.
Dictionaries (data structures which map <em>keys</em> to <em>values</em>) are defined with curly braces: <code class="docutils literal notranslate"><span class="pre">{'key1':</span> <span class="pre">value1,</span> <span class="pre">'key2':</span> <span class="pre">value2}</span></code>.
Function calls (and object instantiations) can use named parameters, like <code class="docutils literal notranslate"><span class="pre">steps.ShellCommand(command=[&quot;trial&quot;,</span> <span class="pre">&quot;hello&quot;])</span></code>.</p>
<p>The config file starts with a series of <code class="docutils literal notranslate"><span class="pre">import</span></code> statements, which make various kinds of <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code>s and <code class="xref py py-class docutils literal notranslate"><span class="pre">Status</span></code> targets available for later use.
The main <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code> dictionary is created, and then it is populated with a variety of keys, described section-by-section in the subsequent chapters.</p>
</section>
</section>
<section id="predefined-config-file-symbols">
<span id="id2"></span><h2><span class="section-number">2.5.1.2. </span>Predefined Config File Symbols<a class="headerlink" href="#predefined-config-file-symbols" title="Link to this heading"></a></h2>
<p>The following symbols are automatically available for use in the configuration file.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">basedir</span></code></dt><dd><p>the base directory for the buildmaster.
This string has not been expanded, so it may start with a tilde.
It needs to be expanded before use.
The config file is located in:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basedir</span><span class="p">,</span> <span class="s1">&#39;master.cfg&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__file__</span></code></dt><dd><p>the absolute path of the config file.
The config file’s directory is located in <code class="docutils literal notranslate"><span class="pre">os.path.dirname(__file__)</span></code>.</p>
</dd>
</dl>
</section>
<section id="testing-the-config-file">
<span id="id3"></span><h2><span class="section-number">2.5.1.3. </span>Testing the Config File<a class="headerlink" href="#testing-the-config-file" title="Link to this heading"></a></h2>
<p>To verify that the config file is well-formed and contains no deprecated or invalid elements, use the <code class="docutils literal notranslate"><span class="pre">checkconfig</span></code> command, passing it either a master directory or a config file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>buildbot<span class="w"> </span>checkconfig<span class="w"> </span>master.cfg
Config<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>good!
<span class="c1"># or</span>
%<span class="w"> </span>buildbot<span class="w"> </span>checkconfig<span class="w"> </span>/tmp/masterdir
Config<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>good!
</pre></div>
</div>
<p>If the config file has deprecated features (perhaps because you’ve upgraded the buildmaster and need to update the config file to match), they will be announced by checkconfig.
In this case, the config file will work, but you should really remove the deprecated items and use the recommended replacements instead:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% buildbot checkconfig master.cfg
/usr/lib/python2.4/site-packages/buildbot/master.py:559: DeprecationWarning: c[&#39;sources&#39;] is
deprecated as of 0.7.6 and will be removed by 0.8.0 . Please use c[&#39;change_source&#39;] instead.
Config file is good!
</pre></div>
</div>
<p>If you have errors in your configuration file, checkconfig will let you know:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% buildbot checkconfig master.cfg
Configuration Errors:
c[&#39;workers&#39;] must be a list of Worker instances
no workers are configured
builder &#39;smoketest&#39; uses unknown workers &#39;linux-002&#39;
</pre></div>
</div>
<p>If the config file is simply broken, that will be caught too:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% buildbot checkconfig master.cfg
error while parsing config file:
Traceback (most recent call last):
File &quot;/home/buildbot/master/bin/buildbot&quot;, line 4, in &lt;module&gt;
    runner.run()
File &quot;/home/buildbot/master/buildbot/scripts/runner.py&quot;, line 1358, in run
    if not doCheckConfig(so):
File &quot;/home/buildbot/master/buildbot/scripts/runner.py&quot;, line 1079, in doCheckConfig
    return cl.load(quiet=quiet)
File &quot;/home/buildbot/master/buildbot/scripts/checkconfig.py&quot;, line 29, in load
    self.basedir, self.configFileName)
--- &lt;exception caught here&gt; ---
File &quot;/home/buildbot/master/buildbot/config.py&quot;, line 147, in loadConfig
    exec f in localDict
exceptions.SyntaxError: invalid syntax (master.cfg, line 52)
Configuration Errors:
error while parsing config file: invalid syntax (master.cfg, line 52) (traceback in logfile)
</pre></div>
</div>
</section>
<section id="loading-the-config-file">
<h2><span class="section-number">2.5.1.4. </span>Loading the Config File<a class="headerlink" href="#loading-the-config-file" title="Link to this heading"></a></h2>
<p>The config file is only read at specific points in time.
It is first read when the buildmaster is launched.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the configuration is invalid, the master will display the errors in the console output, but will not exit.</p>
</div>
<section id="reloading-the-config-file-reconfig">
<h3>Reloading the Config File (reconfig)<a class="headerlink" href="#reloading-the-config-file-reconfig" title="Link to this heading"></a></h3>
<p>If you are on the system hosting the buildmaster, you can send a <code class="docutils literal notranslate"><span class="pre">SIGHUP</span></code> signal to it: the <strong class="command">buildbot</strong> tool has a shortcut for this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot reconfig BASEDIR
</pre></div>
</div>
<p>This command will show you all of the lines from <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> that relate to the reconfiguration.
If there are any problems during the config-file reload, they will be displayed in the output.</p>
<p>When reloading the config file, the buildmaster will endeavor to change as little as possible about the running system.
For example, although old status targets may be shut down and new ones started up, any status targets that were not changed since the last time the config file was read will be left running and untouched.
Likewise any <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s which have not been changed will be left running.
If a <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> is modified (say, the build command is changed), this change will apply only for new <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s.
Any existing build that is currently running or was already queued will be allowed to finish using the old configuration.</p>
<p>Note that if any lock is renamed, old and new instances of the lock will be completely unrelated in the eyes of the buildmaster.
This means that buildmaster will be able to start new builds that would otherwise have waited for the old lock to be released.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Buildbot’s reconfiguration system is fragile for a few difficult-to-fix reasons:</p>
<ul class="simple">
<li><p>Any modules imported by the configuration file are not automatically reloaded.
Python modules such as <a class="reference external" href="https://docs.python.org/3/library/importlib.html">https://docs.python.org/3/library/importlib.html</a> and <cite>importlib.reload()</cite> may help here, but reloading modules is fraught with subtleties and difficult-to-decipher failure cases.</p></li>
<li><p>During the reconfiguration, active internal objects are divorced from the service hierarchy, leading to tracebacks in the web interface and other components.
These are ordinarily transient, but with HTTP connection caching (either by the browser or an intervening proxy) they can last for a long time.</p></li>
<li><p>If the new configuration file is invalid, it is possible for Buildbot’s internal state to be corrupted, leading to undefined results.
When this occurs, it is best to restart the master.</p></li>
<li><p>For more advanced configurations, it is impossible for Buildbot to tell if the configuration for a <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">Scheduler</span></code> has changed, and thus the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">Scheduler</span></code> will always be reloaded.
This occurs most commonly when a callable is passed as a configuration parameter.</p></li>
</ul>
<p>The bbproto project (at <a class="reference external" href="https://github.com/dabrahams/bbproto">https://github.com/dabrahams/bbproto</a>) may help to construct large (multi-file) configurations which can be effectively reloaded and reconfigured.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="2.5. Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="global.html" class="btn btn-neutral float-right" title="2.5.2. Global Configuration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Buildbot Team Members.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>