
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Buildbot 1.6.0 documentation</title>
    <link rel="stylesheet" href="_static/qtile.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/icon.png"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  <!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="#document-index">Buildbot 1.6.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p>This is the Buildbot documentation for Buildbot version 1.6.0.</p>
<p>If you are evaluating Buildbot and would like to get started quickly, start
with the <a class="reference internal" href="#document-tutorial/index"><span class="doc">Tutorial</span></a>.  Regular users of Buildbot should
consult the <a class="reference internal" href="#document-manual/index"><span class="doc">Manual</span></a>, and those wishing to modify Buildbot
directly will want to be familiar with the <a class="reference internal" href="#document-developer/index"><span class="doc">Developer’s Documentation</span></a>.</p>
<div class="section" id="table-of-contents">
<h1>Table Of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-tutorial/index"></span><div class="section" id="buildbot-tutorial">
<h2>1. Buildbot Tutorial<a class="headerlink" href="#buildbot-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Contents:</p>
<div class="toctree-wrapper compound">
<span id="document-tutorial/firstrun"></span><div class="section" id="first-run">
<span id="first-run-label"></span><h3>1.1. First Run<a class="headerlink" href="#first-run" title="Permalink to this headline">¶</a></h3>
<div class="section" id="goal">
<h4>1.1.1. Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h4>
<p>This tutorial will take you from zero to running your first buildbot master and worker as quickly as possible, without changing the default configuration.</p>
<p>This tutorial is all about instant gratification and the five minute experience: in five minutes we want to convince you that this project works, and that you should seriously consider spending time learning the system.
In this tutorial no configuration or code changes are done.</p>
<p>This tutorial assumes that you are running Unix, but might be adaptable to Windows.</p>
<p>Thanks to <a class="reference external" href="https://pypi.python.org/pypi/virtualenv">virtualenv</a>, installing buildbot in a standalone environment is very easy.
For those more familiar with <a class="reference external" href="https://docker.com">Docker</a>, there also exists a <a class="reference internal" href="#first-run-docker-label"><span class="std std-ref">docker version of these instructions</span></a>.</p>
<p>You should be able to cut and paste each shell block from this tutorial directly into a terminal.</p>
</div>
<div class="section" id="getting-ready">
<span id="getting-code-label"></span><h4>1.1.2. Getting ready<a class="headerlink" href="#getting-ready" title="Permalink to this headline">¶</a></h4>
<p>There are many ways to get the code on your machine.
We will use the easiest one: via <code class="docutils literal notranslate"><span class="pre">pip</span></code> in a <a class="reference external" href="https://pypi.python.org/pypi/virtualenv">virtualenv</a>.
It has the advantage of not polluting your operating system, as everything will be contained in the virtualenv.</p>
<p>To make this work, you will need the following installed:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.python.org/">Python</a> and the development packages for it</li>
<li><a class="reference external" href="https://pypi.python.org/pypi/virtualenv">virtualenv</a></li>
</ul>
<p>Preferably, use your distribution package manager to install these.</p>
<p>You will also need a working Internet connection, as virtualenv and pip will need to download other projects from the Internet.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Buildbot does not require root access.
Run the commands in this tutorial as a normal, unprivileged user.</p>
</div>
</div>
<div class="section" id="creating-a-master">
<h4>1.1.3. Creating a master<a class="headerlink" href="#creating-a-master" title="Permalink to this headline">¶</a></h4>
<p>The first necessary step is to create a virtualenv for our master.
We will also use a separate directory to demonstrate the distinction between a master and worker:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p ~/tmp/bb-master
<span class="nb">cd</span> ~/tmp/bb-master
</pre></div>
</div>
<p>On Python 2:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>virtualenv --no-site-packages sandbox
<span class="nb">source</span> sandbox/bin/activate
</pre></div>
</div>
<p>On Python 3:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m venv sandbox
<span class="nb">source</span> sandbox/bin/activate
</pre></div>
</div>
<p>Now that we are ready, we need to install buildbot:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install --upgrade pip
pip install <span class="s1">&#39;buildbot[bundle]&#39;</span>
</pre></div>
</div>
<p>Now that buildbot is installed, it’s time to create the master:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot create-master master
</pre></div>
</div>
<p>Buildbot’s activity is controlled by a configuration file.
We will use the sample configuration file unchanged:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mv master/master.cfg.sample master/master.cfg
</pre></div>
</div>
<p>Finally, start the master:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot start master
</pre></div>
</div>
<p>You will now see some log information from the master in this terminal.
It should end with lines like these:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2014-11-01 15:52:55+0100 [-] BuildMaster is running
The buildmaster appears to have (re)started correctly.
</pre></div>
</div>
<p>From now on, feel free to visit the web status page running on the port 8010: <a class="reference external" href="http://localhost:8010/">http://localhost:8010/</a></p>
<p>Our master now needs (at least) a worker to execute its commands.
For that, head on to the next section!</p>
</div>
<div class="section" id="creating-a-worker">
<h4>1.1.4. Creating a worker<a class="headerlink" href="#creating-a-worker" title="Permalink to this headline">¶</a></h4>
<p>The worker will be executing the commands sent by the master.
In this tutorial, we are using the buildbot/hello-world project as an example.
As a consequence of this, your worker will need access to the <a class="reference external" href="https://git-scm.com/">git</a> command in order to checkout some code.
Be sure that it is installed, or the builds will fail.</p>
<p>Same as we did for our master, we will create a virtualenv for our worker next to the other one.
It would however be completely ok to do this on another computer - as long as the <em>worker</em> computer is able to connect to the <em>master</em> one:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p ~/tmp/bb-worker
<span class="nb">cd</span> ~/tmp/bb-worker
</pre></div>
</div>
<p>On Python 2:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>virtualenv --no-site-packages sandbox
<span class="nb">source</span> sandbox/bin/activate
</pre></div>
</div>
<p>On Python 3:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3 -m venv sandbox
<span class="nb">source</span> sandbox/bin/activate
</pre></div>
</div>
<p>Install the <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install --upgrade pip
pip install buildbot-worker
<span class="c1"># required for `runtests` build</span>
pip install setuptools-trial
</pre></div>
</div>
<p>Now, create the worker:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot-worker create-worker worker localhost example-worker pass
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you decided to create this from another computer, you should replace <code class="docutils literal notranslate"><span class="pre">localhost</span></code> with the name of the computer where your master is running.</p>
</div>
<p>The username (<code class="docutils literal notranslate"><span class="pre">example-worker</span></code>), and password (<code class="docutils literal notranslate"><span class="pre">pass</span></code>) should be the same as those in <code class="file docutils literal notranslate"><span class="pre">master/master.cfg</span></code>; verify this is the case by looking at the section for <code class="docutils literal notranslate"><span class="pre">c['workers']</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat ../bb-master/master/master.cfg
</pre></div>
</div>
<p>And finally, start the worker:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot-worker start worker
</pre></div>
</div>
<p>Check the worker’s output.
It should end with lines like these:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2014-11-01 15:56:51+0100 [-] Connecting to localhost:9989
2014-11-01 15:56:51+0100 [Broker,client] message from master: attached
The worker appears to have (re)started correctly.
</pre></div>
</div>
<p>Meanwhile, from the other terminal, in the master log (<code class="file docutils literal notranslate"><span class="pre">twisted.log</span></code> in the master directory), you should see lines like these:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2014-11-01 15:56:51+0100 [Broker,1,127.0.0.1] worker &#39;example-worker&#39; attaching from IPv4Address(TCP, &#39;127.0.0.1&#39;, 54015)
2014-11-01 15:56:51+0100 [Broker,1,127.0.0.1] Got workerinfo from &#39;example-worker&#39;
2014-11-01 15:56:51+0100 [-] bot attached
</pre></div>
</div>
<p>You should now be able to go to <a class="reference external" href="http://localhost:8010">http://localhost:8010</a>, where you will see a web page similar to:</p>
<img alt="index page" src="_images/index.png" />
<p>Click on the <a class="reference external" href="http://localhost:8010/#/waterfall">Waterfall Display link</a> and you get this:</p>
<img alt="empty waterfall." src="_images/waterfall-empty.png" />
<p>Your master is now quietly waiting for new commits to hello-world.
This doesn’t happen very often though.
In the next section, we’ll see how to manually start a build.</p>
<p>We just wanted to get you to dip your toes in the water.
It’s easy to take your first steps, but this is about as far as we can go without touching the configuration.</p>
<p>You’ve got a taste now, but you’re probably curious for more.
Let’s step it up a little in the second tutorial by changing the configuration and doing an actual build.
Continue on to <a class="reference internal" href="#quick-tour-label"><span class="std std-ref">A Quick Tour</span></a>.</p>
</div>
</div>
<span id="document-tutorial/docker"></span><div class="section" id="first-buildbot-run-with-docker">
<span id="first-run-docker-label"></span><h3>1.2. First Buildbot run with Docker<a class="headerlink" href="#first-buildbot-run-with-docker" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Docker can be tricky to get working correctly if you haven’t used it before.
If you’re having trouble, first determine whether it is a Buildbot issue or a Docker issue by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run ubuntu:12.04 apt-get update
</pre></div>
</div>
<p class="last">If that fails, look for help with your Docker install.
On the other hand, if that succeeds, then you may have better luck getting help from members of the Buildbot community.</p>
</div>
<p><a class="reference external" href="https://www.docker.com">Docker</a> is a tool that makes building and deploying custom environments a breeze.
It uses lightweight linux containers (LXC) and performs quickly, making it a great instrument for the testing community.
The next section includes a Docker pre-flight check.
If it takes more that 3 minutes to get the ‘Success’ message for you, try the Buildbot pip-based <a class="reference internal" href="#getting-code-label"><span class="std std-ref">first run</span></a> instead.</p>
<div class="section" id="current-docker-dependencies">
<h4>1.2.1. Current Docker dependencies<a class="headerlink" href="#current-docker-dependencies" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Linux system, with at least kernel 3.8 and AUFS support.
For example, Standard Ubuntu, Debian and Arch systems.</li>
<li>Packages: lxc, iptables, ca-certificates, and bzip2 packages.</li>
<li>Local clock on time or slightly in the future for proper SSL communication.</li>
<li>This tutorial uses docker-compose to run a master, a worker, and a postgresql database server</li>
</ul>
</div>
<div class="section" id="installation">
<h4>1.2.2. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Use the <a class="reference external" href="https://docs.docker.com/engine/installation/">Docker installation instructions</a> for your operating system.</p>
</li>
<li><p class="first">Make sure you install docker-compose.
As root or inside a virtualenv, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install docker-compose
</pre></div>
</div>
</li>
<li><p class="first">Test docker is happy in your environment:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo docker run -i busybox /bin/echo Success
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="building-and-running-buildbot">
<h4>1.2.3. Building and running Buildbot<a class="headerlink" href="#building-and-running-buildbot" title="Permalink to this headline">¶</a></h4>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># clone the example repository</span>
git clone --depth <span class="m">1</span> https://github.com/buildbot/buildbot-docker-example-config

<span class="c1"># Build the Buildbot container (it will take a few minutes to download packages)</span>
<span class="nb">cd</span> buildbot-docker-example-config/simple
docker-compose up
</pre></div>
</div>
<p>You should now be able to go to <a class="reference external" href="http://localhost:8010">http://localhost:8010</a> and see a web page similar to:</p>
<img alt="index page" src="_images/index.png" />
<p>Click on the <a class="reference external" href="http://localhost:8010/#/waterfall">Waterfall Display link</a> and you get this:</p>
<img alt="empty waterfall." src="_images/waterfall-empty.png" />
</div>
<div class="section" id="overview-of-the-docker-compose-configuration">
<h4>1.2.4. Overview of the docker-compose configuration<a class="headerlink" href="#overview-of-the-docker-compose-configuration" title="Permalink to this headline">¶</a></h4>
<p>This docker-compose configuration is made as a basis for what you would put in production</p>
<ul class="simple">
<li>Separated containers for each component</li>
<li>A solid database backend with postgresql</li>
<li>A buildbot master that exposes its configuration to the docker host</li>
<li>A buildbot worker that can be cloned in order to add additional power</li>
<li>Containers are linked together so that the only port exposed to external is the web server</li>
<li>The default master container is based on Alpine linux for minimal footprint</li>
<li>The default worker container is based on more widely known Ubuntu distribution, as this is the container you want to customize.</li>
<li>Download the config from a tarball accessible via a web server</li>
</ul>
</div>
<div class="section" id="playing-with-your-buildbot-containers">
<h4>1.2.5. Playing with your Buildbot containers<a class="headerlink" href="#playing-with-your-buildbot-containers" title="Permalink to this headline">¶</a></h4>
<p>If you’ve come this far, you have a Buildbot environment that you can freely experiment with.</p>
<p>In order to modify the configuration, you need to fork the project on github <a class="reference external" href="https://github.com/buildbot/buildbot-docker-example-config">https://github.com/buildbot/buildbot-docker-example-config</a>
Then you can clone your own fork, and start the docker-compose again.</p>
<p>To modify your config, edit the master.cfg file, commit your changes, and push to your fork.
You can use the command buildbot check-config in order to make sure the config is valid before the push.
You will need to change <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> the variable <code class="docutils literal notranslate"><span class="pre">BUILDBOT_CONFIG_URL</span></code> in order to point to your github fork.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BUILDBOT_CONFIG_URL</span></code> may point to a <code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code> file accessible from HTTP.
Several git servers like github can generate that tarball automatically from the master branch of a git repository
If the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_CONFIG_URL</span></code> does not end with <code class="docutils literal notranslate"><span class="pre">.tar.gz</span></code>, it is considered to be the URL to a <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code> file accessible from HTTP.</p>
</div>
<div class="section" id="customize-your-worker-container">
<h4>1.2.6. Customize your Worker container<a class="headerlink" href="#customize-your-worker-container" title="Permalink to this headline">¶</a></h4>
<p>It is advised to customize you worker container in order to suit your project’s build dependencies and need.
An example DockerFile is available which the buildbot community uses for its own CI purposes:</p>
<p><a class="reference external" href="https://github.com/buildbot/metabbotcfg/blob/nine/docker/metaworker/Dockerfile">https://github.com/buildbot/metabbotcfg/blob/nine/docker/metaworker/Dockerfile</a></p>
</div>
<div class="section" id="multi-master">
<h4>1.2.7. Multi-master<a class="headerlink" href="#multi-master" title="Permalink to this headline">¶</a></h4>
<p>A multi-master environment can be setup using the <code class="docutils literal notranslate"><span class="pre">multimaster/docker-compose.yml</span></code> file in the example repository</p>
<blockquote>
<div># Build the Buildbot container (it will take a few minutes to download packages)
cd buildbot-docker-example-config/simple
docker-compose up -d
docker-compose scale buildbot=4</div></blockquote>
</div>
<div class="section" id="going-forward">
<h4>1.2.8. Going forward<a class="headerlink" href="#going-forward" title="Permalink to this headline">¶</a></h4>
<p>You’ve got a taste now, but you’re probably curious for more.
Let’s step it up a little in the second tutorial by changing the configuration and doing an actual build.
Continue on to <a class="reference internal" href="#quick-tour-label"><span class="std std-ref">A Quick Tour</span></a>.</p>
</div>
</div>
<span id="document-tutorial/tour"></span><div class="section" id="a-quick-tour">
<span id="quick-tour-label"></span><h3>1.3. A Quick Tour<a class="headerlink" href="#a-quick-tour" title="Permalink to this headline">¶</a></h3>
<div class="section" id="goal">
<h4>1.3.1. Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h4>
<p>This tutorial will expand on the <a class="reference internal" href="#first-run-label"><span class="std std-ref">First Run</span></a> tutorial by taking a quick tour around some of the features of buildbot that are hinted at in the comments in the sample configuration.
We will simply change parts of the default configuration and explain the activated features.</p>
<p>As a part of this tutorial, we will make buildbot do a few actual builds.</p>
<p>This section will teach you how to:</p>
<ul class="simple">
<li>make simple configuration changes and activate them</li>
<li>deal with configuration errors</li>
<li>force builds</li>
<li>enable and control the IRC bot</li>
<li>enable ssh debugging</li>
<li>add a ‘try’ scheduler</li>
</ul>
</div>
<div class="section" id="setting-project-name-and-url">
<h4>1.3.2. Setting Project Name and URL<a class="headerlink" href="#setting-project-name-and-url" title="Permalink to this headline">¶</a></h4>
<p>Let’s start simple by looking at where you would customize the buildbot’s project name and URL.</p>
<p>We continue where we left off in the <a class="reference internal" href="#first-run-label"><span class="std std-ref">First Run</span></a> tutorial.</p>
<p>Open a new terminal, and first enter the same sandbox you created before (where <code class="docutils literal notranslate"><span class="pre">$EDITOR</span></code> is your editor of choice like vim, gedit, or emacs):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/tmp/bb-master
<span class="nb">source</span> sandbox/bin/activate
<span class="nv">$EDITOR</span> master/master.cfg
</pre></div>
</div>
<p>Now, look for the section marked <em>PROJECT IDENTITY</em> which reads:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">####### PROJECT IDENTITY</span>

<span class="c1"># the &#39;title&#39; string will appear at the top of this buildbot installation&#39;s</span>
<span class="c1"># home pages (linked to the &#39;titleURL&#39;).</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Hello World CI&quot;</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;titleURL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://buildbot.github.io/hello-world/&quot;</span>
</pre></div>
</div>
<p>If you want, you can change either of these links to anything you want to see what happens when you change them.</p>
<p>After making a change go into the terminal and type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot reconfig master
</pre></div>
</div>
<p>You will see a handful of lines of output from the master log, much like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2011-12-04 10:11:09-0600 [-] loading configuration from /home/dustin/tmp/buildbot/master/master.cfg
2011-12-04 10:11:09-0600 [-] configuration update started
2011-12-04 10:11:09-0600 [-] builder runtests is unchanged
2011-12-04 10:11:09-0600 [-] removing IStatusReceiver &lt;WebStatus on port tcp:8010 at 0x2aee368&gt;
2011-12-04 10:11:09-0600 [-] (TCP Port 8010 Closed)
2011-12-04 10:11:09-0600 [-] Stopping factory &lt;buildbot.status.web.baseweb.RotateLogSite instance at 0x2e36638&gt;
2011-12-04 10:11:09-0600 [-] adding IStatusReceiver &lt;WebStatus on port tcp:8010 at 0x2c2d950&gt;
2011-12-04 10:11:09-0600 [-] RotateLogSite starting on 8010
2011-12-04 10:11:09-0600 [-] Starting factory &lt;buildbot.status.web.baseweb.RotateLogSite instance at 0x2e36e18&gt;
2011-12-04 10:11:09-0600 [-] Setting up http.log rotating 10 files of 10000000 bytes each
2011-12-04 10:11:09-0600 [-] WebStatus using (/home/dustin/tmp/buildbot/master/public_html)
2011-12-04 10:11:09-0600 [-] removing 0 old schedulers, updating 0, and adding 0
2011-12-04 10:11:09-0600 [-] adding 1 new changesources, removing 1
2011-12-04 10:11:09-0600 [-] gitpoller: using workdir &#39;/home/dustin/tmp/buildbot/master/gitpoller-workdir&#39;
2011-12-04 10:11:09-0600 [-] GitPoller repository already exists
2011-12-04 10:11:09-0600 [-] configuration update complete

Reconfiguration appears to have completed successfully.
</pre></div>
</div>
<p>The important lines are the ones telling you that it is loading the new configuration at the top, and the one at the bottom saying that the update is complete.</p>
<p>Now, if you go back to <a class="reference external" href="http://localhost:8010/#/waterfall">the waterfall page</a>, you will see that the project’s name is whatever you may have changed it to and when you click on the URL of the project name at the bottom of the page it should take you to the link you put in the configuration.</p>
</div>
<div class="section" id="configuration-errors">
<h4>1.3.3. Configuration Errors<a class="headerlink" href="#configuration-errors" title="Permalink to this headline">¶</a></h4>
<p>It is very common to make a mistake when configuring buildbot, so you might as well see now what happens in that case and what you can do to fix the error.</p>
<p>Open up the config again and introduce a syntax error by removing the first single quote in the two lines you changed, so they read:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>c[title&#39;] = &quot;Hello World CI&quot;
c[titleURL&#39;] = &quot;https://buildbot.github.io/hello-world/&quot;
</pre></div>
</div>
<p>This creates a Python <code class="docutils literal notranslate"><span class="pre">SyntaxError</span></code>.
Now go ahead and reconfig the buildmaster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot reconfig master
</pre></div>
</div>
<p>This time, the output looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2015-08-14 18:40:46+0000 [-] beginning configuration update
2015-08-14 18:40:46+0000 [-] Loading configuration from &#39;/data/buildbot/master/master.cfg&#39;
2015-08-14 18:40:46+0000 [-] error while parsing config file:
        Traceback (most recent call last):
          File &quot;/usr/local/lib/python2.7/dist-packages/buildbot/master.py&quot;, line 265, in reconfig
            d = self.doReconfig()
          File &quot;/usr/local/lib/python2.7/dist-packages/twisted/internet/defer.py&quot;, line 1274, in unwindGenerator
            return _inlineCallbacks(None, gen, Deferred())
          File &quot;/usr/local/lib/python2.7/dist-packages/twisted/internet/defer.py&quot;, line 1128, in _inlineCallbacks
            result = g.send(result)
          File &quot;/usr/local/lib/python2.7/dist-packages/buildbot/master.py&quot;, line 289, in doReconfig
            self.configFileName)
        --- &lt;exception caught here&gt; ---
          File &quot;/usr/local/lib/python2.7/dist-packages/buildbot/config.py&quot;, line 156, in loadConfig
            exec f in localDict
        exceptions.SyntaxError: EOL while scanning string literal (master.cfg, line 103)

2015-08-14 18:40:46+0000 [-] error while parsing config file: EOL while scanning string literal (master.cfg, line 103) (traceback in logfile)
2015-08-14 18:40:46+0000 [-] reconfig aborted without making any changes

Reconfiguration failed. Please inspect the master.cfg file for errors,
correct them, then try &#39;buildbot reconfig&#39; again.
</pre></div>
</div>
<p>This time, it’s clear that there was a mistake in the configuration.
Luckily, the Buildbot master will ignore the wrong configuration and keep running with the previous configuration.</p>
<p>The message is clear enough, so open the configuration again, fix the error, and reconfig the master.</p>
</div>
<div class="section" id="your-first-build">
<h4>1.3.4. Your First Build<a class="headerlink" href="#your-first-build" title="Permalink to this headline">¶</a></h4>
<p>By now you’re probably thinking: “All this time spent and still not done a single build? What was the name of this project again?”</p>
<p>On the <a class="reference external" href="http://localhost:8010/#/builders">Builders</a> page, click on the runtests link.
You’ll see a builder page, and an option that allow you to force a build:</p>
<img alt="force a build." src="_images/force-build.png" />
<p>Click <em>Start Build</em> - there’s no need to fill in any of the fields in this case.
Next, click on <a class="reference external" href="http://localhost:8010/#/waterfall?show=runtests">view in waterfall</a>.</p>
<p>You will now see:</p>
<img alt="an successful test run happened." src="_images/runtests-success.png" />
</div>
<div class="section" id="enabling-the-irc-bot">
<h4>1.3.5. Enabling the IRC Bot<a class="headerlink" href="#enabling-the-irc-bot" title="Permalink to this headline">¶</a></h4>
<p>Buildbot includes an IRC bot that you can tell to join a channel and control to report on the status of buildbot.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Security Note</p>
<p class="last">Please note that any user having access to your irc channel or can PM the bot will be able to create or stop builds <a class="reference external" href="http://trac.buildbot.net/ticket/3377">bug #3377</a>.</p>
</div>
<p>First, start an IRC client of your choice, connect to irc.freenode.net and join an empty channel.
In this example we will use <code class="docutils literal notranslate"><span class="pre">#buildbot-test</span></code>, so go join that channel.
(<em>Note: please do not join the main buildbot channel!</em>)</p>
<p>Edit <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> and look for the <em>BUILDBOT SERVICES</em> section.
At the end of that section add the lines:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reporters</span><span class="o">.</span><span class="n">IRC</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;irc.freenode.net&quot;</span><span class="p">,</span> <span class="n">nick</span><span class="o">=</span><span class="s2">&quot;bbtest&quot;</span><span class="p">,</span>
                                   <span class="n">channels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;#buildbot-test&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Reconfigure the build master then do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>grep -i irc master/twistd.log
</pre></div>
</div>
<p>The log output should contain a line like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2016-11-13 15:53:06+0100 [-] Starting factory &lt;buildbot.reporters.irc.IrcStatusFactory instance at 0x7ff2b4b72710&gt;
2016-11-13 15:53:19+0100 [IrcStatusBot,client] &lt;buildbot.reporters.irc.IrcStatusBot object at 0x7ff2b5075750&gt;: I have joined #buildbot-test
</pre></div>
</div>
<p>You should see the bot now joining in your IRC client.
In your IRC channel, type:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bbtest: commands
</pre></div>
</div>
<p>to get a list of the commands the bot supports.</p>
<p>Let’s tell the bot to notify certain events, to learn which EVENTS we can notify on:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>bbtest: help notify
</pre></div>
</div>
<p>Now let’s set some event notifications:</p>
<div class="highlight-irc notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;@lsblakk&gt; </span><span class="na">bbtest:</span> notify on started finished failure
<span class="nt">&lt; bbtest&gt; </span>The following events are being notified: [&#39;started&#39;, &#39;failure&#39;, &#39;finished&#39;]
</pre></div>
</div>
<p>Now, go back to the web interface and force another build. Alternatively, ask the bot to force a build:</p>
<div class="highlight-irc notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;@lsblakk&gt; </span><span class="na">bbtest:</span> force build --codebase= runtests
<span class="nt">&lt; bbtest&gt; </span>build #1 of runtests started
<span class="nt">&lt; bbtest&gt; </span>Hey! build runtests #1 is complete: Success [finished]
</pre></div>
</div>
<p>You can also see the new builds in the web interface.</p>
<img alt="a successful test run from IRC happened." src="_images/irc-testrun.png" />
<p>The full documentation is available at <a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a>.</p>
</div>
<div class="section" id="setting-authorized-web-users">
<h4>1.3.6. Setting Authorized Web Users<a class="headerlink" href="#setting-authorized-web-users" title="Permalink to this headline">¶</a></h4>
<p>The default configuration allows everyone to perform any task like creating or stopping builds via the web interface. To restrict this to a user, look for:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8010</span><span class="p">,</span>
                 <span class="n">plugins</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">waterfall_view</span><span class="o">=</span><span class="p">{},</span> <span class="n">console_view</span><span class="o">=</span><span class="p">{}))</span>
</pre></div>
</div>
<p>and append:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
        <span class="n">allowRules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">util</span><span class="o">.</span><span class="n">AnyEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">)</span>
        <span class="p">],</span>
        <span class="n">roleMatchers</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">util</span><span class="o">.</span><span class="n">RolesFromUsername</span><span class="p">(</span><span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;admins&#39;</span><span class="p">],</span> <span class="n">usernames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Alice&#39;</span><span class="p">])</span>
        <span class="p">]</span>
<span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;auth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">UserPasswordAuth</span><span class="p">([(</span><span class="s1">&#39;Alice&#39;</span><span class="p">,</span><span class="s1">&#39;Password1&#39;</span><span class="p">)])</span>
</pre></div>
</div>
<p>For more details, see <a class="reference internal" href="#web-authentication"><span class="std std-ref">Authentication plugins</span></a>.</p>
</div>
<div class="section" id="debugging-with-manhole">
<h4>1.3.7. Debugging with Manhole<a class="headerlink" href="#debugging-with-manhole" title="Permalink to this headline">¶</a></h4>
<p>You can do some debugging by using manhole, an interactive Python shell.
It exposes full access to the buildmaster’s account (including the ability to modify and delete files), so it should not be enabled with a weak or easily guessable password.</p>
<p>To use this you will need to install an additional package or two to your virtualenv:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/tmp/bb-master
<span class="nb">source</span> sandbox/bin/activate
pip install -U pip
pip install cryptography pyasn1
</pre></div>
</div>
<p>You will also need to generate an SSH host key for the Manhole server.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p /data/ssh_host_keys
ckeygen -t rsa -f /data/ssh_host_keys/ssh_host_rsa_key
</pre></div>
</div>
<p>In your master.cfg find:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">BuildmasterConfig</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Insert the following to enable debugging mode with manhole:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">####### DEBUGGING</span>
<span class="kn">from</span> <span class="nn">buildbot</span> <span class="k">import</span> <span class="n">manhole</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manhole</span><span class="o">.</span><span class="n">PasswordManhole</span><span class="p">(</span><span class="s2">&quot;tcp:1234:interface=127.0.0.1&quot;</span><span class="p">,</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="s2">&quot;passwd&quot;</span><span class="p">,</span> <span class="n">ssh_hostkey_dir</span><span class="o">=</span><span class="s2">&quot;/data/ssh_host_keys/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>After restarting the master, you can ssh into the master and get an interactive Python shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ssh -p1234 admin@127.0.0.1
<span class="c1"># enter passwd at prompt</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The pyasn1-0.1.1 release has a bug which results in an exception similar to
this on startup:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>exceptions.TypeError: argument 2 must be long, not int
</pre></div>
</div>
<p>If you see this, the temporary solution is to install the previous version
of pyasn1:</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install pyasn1-0.0.13b
</pre></div>
</div>
</div>
<p>If you wanted to check which workers are connected and what builders those workers are assigned to you could do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">master</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">workers</span>
<span class="go">{&#39;example-worker&#39;: &lt;Worker &#39;example-worker&#39;, current builders: runtests&gt;}</span>
</pre></div>
</div>
<p>Objects can be explored in more depth using <cite>dir(x)</cite> or the helper function <cite>show(x)</cite>.</p>
</div>
<div class="section" id="adding-a-try-scheduler">
<h4>1.3.8. Adding a ‘try’ scheduler<a class="headerlink" href="#adding-a-try-scheduler" title="Permalink to this headline">¶</a></h4>
<p>Buildbot includes a way for developers to submit patches for testing without committing them to the source code control system.
(This is really handy for projects that support several operating systems or architectures.)</p>
<p>To set this up, add the following lines to master.cfg:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.scheduler</span> <span class="k">import</span> <span class="n">Try_Userpass</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Try_Userpass</span><span class="p">(</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;try&#39;</span><span class="p">,</span>
                                    <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;runtests&#39;</span><span class="p">],</span>
                                    <span class="n">port</span><span class="o">=</span><span class="mi">5555</span><span class="p">,</span>
                                    <span class="n">userpass</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;sampleuser&#39;</span><span class="p">,</span><span class="s1">&#39;samplepass&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>Then you can submit changes using the <a class="reference internal" href="#cmdline-try" title="try"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">try</span></code></a> command.</p>
<p>Let’s try this out by making a one-line change to hello-world, say, to make it trace the tree by default:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone git://github.com/buildbot/hello-world.git hello-world-git
<span class="nb">cd</span> hello-world-git/hello
<span class="nv">$EDITOR</span> __init__.py
<span class="c1"># change &#39;return &quot;hello &quot; + who&#39; on line 6 to &#39;return &quot;greets &quot; + who&#39;</span>
</pre></div>
</div>
<p>Then run buildbot’s <code class="docutils literal notranslate"><span class="pre">try</span></code> command as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> ~/tmp/bb-master
<span class="nb">source</span> sandbox/bin/activate
buildbot try --connect<span class="o">=</span>pb --master<span class="o">=</span><span class="m">127</span>.0.0.1:5555 --username<span class="o">=</span>sampleuser --passwd<span class="o">=</span>samplepass --vc<span class="o">=</span>git
</pre></div>
</div>
<p>This will do <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">diff</span></code> for you and send the resulting patch to the server for build and test against the latest sources from Git.</p>
<p>Now go back to the <a class="reference external" href="http://localhost:8010/#/waterfall">waterfall</a> page, click on the runtests link, and scroll down.
You should see that another build has been started with your change (and stdout for the tests should be chock-full of parse trees as a result).
The “Reason” for the job will be listed as “‘try’ job”, and the blamelist will be empty.</p>
<p>To make yourself show up as the author of the change, use the <code class="docutils literal notranslate"><span class="pre">--who=emailaddr</span></code> option on <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">try</span></code> to pass your email address.</p>
<p>To make a description of the change show up, use the <code class="docutils literal notranslate"><span class="pre">--properties=comment=&quot;this</span> <span class="pre">is</span> <span class="pre">a</span> <span class="pre">comment&quot;</span></code> option on <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">try</span></code>.</p>
<p>To use ssh instead of a private username/password database, see <a class="reference internal" href="#sched-Try_Jobdir" title="Try_Jobdir"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Try_Jobdir</span></code></a>.</p>
</div>
</div>
<span id="document-tutorial/further"></span><div class="section" id="further-reading">
<h3>1.4. Further Reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h3>
<p>See the following user-contributed tutorials for other highlights and ideas:</p>
<div class="toctree-wrapper compound">
<span id="document-tutorial/fiveminutes"></span><div class="section" id="buildbot-in-5-minutes-a-user-contributed-tutorial">
<span id="fiveminutes"></span><h4>1.4.1. Buildbot in 5 minutes - a user-contributed tutorial<a class="headerlink" href="#buildbot-in-5-minutes-a-user-contributed-tutorial" title="Permalink to this headline">¶</a></h4>
<p>(Ok, maybe 10.)</p>
<p>Buildbot is really an excellent piece of software, however it can be a bit confusing for a newcomer (like me when I first started looking at it).
Typically, at first sight it looks like a bunch of complicated concepts that make no sense and whose relationships with each other are unclear.
After some time and some reread, it all slowly starts to be more and more meaningful, until you finally say “oh!” and things start to make sense.
Once you get there, you realize that the documentation is great, but only if you already know what it’s about.</p>
<p>This is what happened to me, at least.
Here I’m going to (try to) explain things in a way that would have helped me more as a newcomer.
The approach I’m taking is more or less the reverse of that used by the documentation, that is, I’m going to start from the components that do the actual work (the builders) and go up the chain from there up to change sources.
I hope purists will forgive this unorthodoxy.
Here I’m trying to clarify the concepts only, and will not go into the details of each object or property; the documentation explains those quite well.</p>
<div class="section" id="installation">
<h5>1.4.1.1. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h5>
<p>I won’t cover the installation; both Buildbot master and worker are available as packages for the major distributions, and in any case the instructions in the official documentation are fine.
This document will refer to Buildbot 0.8.5 which was current at the time of writing, but hopefully the concepts are not too different in other versions.
All the code shown is of course python code, and has to be included in the master.cfg master configuration file.</p>
<p>We won’t cover the basic things such as how to define the workers, project names, or other administrative information that is contained in that file; for that, again the official documentation is fine.</p>
</div>
<div class="section" id="builders-the-workhorses">
<h5>1.4.1.2. Builders: the workhorses<a class="headerlink" href="#builders-the-workhorses" title="Permalink to this headline">¶</a></h5>
<p>Since Buildbot is a tool whose goal is the automation of software builds, it makes sense to me to start from where we tell Buildbot how to build our software: the <cite>builder</cite> (or builders, since there can be more than one).</p>
<p>Simply put, a builder is an element that is in charge of performing some action or sequence of actions, normally something related to building software (for example, checking out the source, or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>), but it can also run arbitrary commands.</p>
<p>A builder is configured with a list of workers that it can use to carry out its task.
The other fundamental piece of information that a builder needs is, of course, the list of things it has to do (which will normally run on the chosen worker).
In Buildbot, this list of things is represented as a <code class="docutils literal notranslate"><span class="pre">BuildFactory</span></code> object, which is essentially a sequence of steps, each one defining a certain operation or command.</p>
<p>Enough talk, let’s see an example.
For this example, we are going to assume that our super software project can be built using a simple <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>, and there is another target <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">packages</span></code> that creates rpm, deb and tgz packages of the binaries.
In the real world things are usually more complex (for example there may be a <code class="docutils literal notranslate"><span class="pre">configure</span></code> step, or multiple targets), but the concepts are the same; it will just be a matter of adding more steps to a builder, or creating multiple builders, although sometimes the resulting builders can be quite complex.</p>
<p>So to perform a manual build of our project we would type this from the command line (assuming we are at the root of the local copy of the repository):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make clean    <span class="c1"># clean remnants of previous builds</span>
...
$ svn update
...
$ make all
...
$ make packages
...
<span class="c1"># optional but included in the example: copy packages to some central machine</span>
$ scp packages/*.rpm packages/*.deb packages/*.tgz someuser@somehost:/repository
...
</pre></div>
</div>
<p>Here we’re assuming the repository is SVN, but again the concepts are the same with git, mercurial or any other VCS.</p>
<p>Now, to automate this, we create a builder where each step is one of the commands we typed above.
A step can be a shell command object, or a dedicated object that checks out the source code (there are various types for different repositories, see the docs for more info), or yet something else:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="c1"># first, let&#39;s create the individual step objects</span>

<span class="c1"># step 1: make clean; this fails if the worker has no local copy, but</span>
<span class="c1"># is harmless and will only happen the first time</span>
<span class="n">makeclean</span> <span class="o">=</span> <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;make clean&quot;</span><span class="p">,</span>
                               <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;clean&quot;</span><span class="p">],</span>
                               <span class="n">description</span><span class="o">=</span><span class="s2">&quot;make clean&quot;</span><span class="p">)</span>

<span class="c1"># step 2: svn update (here updates trunk, see the docs for more</span>
<span class="c1"># on how to update a branch, or make it more generic).</span>
<span class="n">checkout</span> <span class="o">=</span> <span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">baseURL</span><span class="o">=</span><span class="s1">&#39;svn://myrepo/projects/coolproject/trunk&#39;</span><span class="p">,</span>
                     <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">,</span>
                     <span class="n">username</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
                     <span class="n">password</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
                     <span class="n">haltOnFailure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># step 3: make all</span>
<span class="n">makeall</span> <span class="o">=</span> <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;make all&quot;</span><span class="p">,</span>
                             <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">],</span>
                             <span class="n">haltOnFailure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">description</span><span class="o">=</span><span class="s2">&quot;make all&quot;</span><span class="p">)</span>

<span class="c1"># step 4: make packages</span>
<span class="n">makepackages</span> <span class="o">=</span> <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;make packages&quot;</span><span class="p">,</span>
                                  <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;packages&quot;</span><span class="p">],</span>
                                  <span class="n">haltOnFailure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                  <span class="n">description</span><span class="o">=</span><span class="s2">&quot;make packages&quot;</span><span class="p">)</span>

<span class="c1"># step 5: upload packages to central server. This needs passwordless ssh</span>
<span class="c1"># from the worker to the server (set it up in advance as part of worker setup)</span>
<span class="n">uploadpackages</span> <span class="o">=</span> <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;upload packages&quot;</span><span class="p">,</span>
                                    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;upload packages&quot;</span><span class="p">,</span>
                                    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;scp packages/*.rpm packages/*.deb packages/*.tgz someuser@somehost:/repository&quot;</span><span class="p">,</span>
                                    <span class="n">haltOnFailure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># create the build factory and add the steps to it</span>
<span class="n">f_simplebuild</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f_simplebuild</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">makeclean</span><span class="p">)</span>
<span class="n">f_simplebuild</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">checkout</span><span class="p">)</span>
<span class="n">f_simplebuild</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">makeall</span><span class="p">)</span>
<span class="n">f_simplebuild</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">makepackages</span><span class="p">)</span>
<span class="n">f_simplebuild</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">uploadpackages</span><span class="p">)</span>

<span class="c1"># finally, declare the list of builders. In this case, we only have one builder</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;simplebuild&quot;</span><span class="p">,</span> <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;worker1&#39;</span><span class="p">,</span> <span class="s1">&#39;worker2&#39;</span><span class="p">,</span> <span class="s1">&#39;worker3&#39;</span><span class="p">],</span> <span class="n">factory</span><span class="o">=</span><span class="n">f_simplebuild</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>So our builder is called <code class="docutils literal notranslate"><span class="pre">simplebuild</span></code> and can run on either of <code class="docutils literal notranslate"><span class="pre">worker1</span></code>, <code class="docutils literal notranslate"><span class="pre">worker2</span></code> and <code class="docutils literal notranslate"><span class="pre">worker3</span></code>.
If our repository has other branches besides trunk, we could create another one or more builders to build them; in the example, only the checkout step would be different, in that it would need to check out the specific branch.
Depending on how exactly those branches have to be built, the shell commands may be recycled, or new ones would have to be created if they are different in the branch.
You get the idea.
The important thing is that all the builders be named differently and all be added to the <code class="docutils literal notranslate"><span class="pre">c['builders']</span></code> value (as can be seen above, it is a list of <code class="docutils literal notranslate"><span class="pre">BuilderConfig</span></code> objects).</p>
<p>Of course the type and number of steps will vary depending on the goal; for example, to just check that a commit doesn’t break the build, we could include just up to the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code> step.
Or we could have a builder that performs a more thorough test by also doing <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> or other targets.
You get the idea.
Note that at each step except the very first we use <code class="docutils literal notranslate"><span class="pre">haltOnFailure=True</span></code> because it would not make sense to execute a step if the previous one failed (ok, it wouldn’t be needed for the last step, but it’s harmless and protects us if one day we add another step after it).</p>
</div>
<div class="section" id="schedulers">
<h5>1.4.1.3. Schedulers<a class="headerlink" href="#schedulers" title="Permalink to this headline">¶</a></h5>
<p>Now this is all nice and dandy, but who tells the builder (or builders) to run, and when?
This is the job of the <cite>scheduler</cite>, which is a fancy name for an element that waits for some event to happen, and when it does, based on that information decides whether and when to run a builder (and which one or ones).
There can be more than one scheduler.
I’m being purposely vague here because the possibilities are almost endless and highly dependent on the actual setup, build purposes, source repository layout and other elements.</p>
<p>So a scheduler needs to be configured with two main pieces of information: on one hand, which events to react to, and on the other hand, which builder or builders to trigger when those events are detected.
(It’s more complex than that, but if you understand this, you can get the rest of the details from the docs).</p>
<p>A simple type of scheduler may be a periodic scheduler: when a configurable amount of time has passed, run a certain builder (or builders).
In our example, that’s how we would trigger a build every hour:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>

<span class="c1"># define the periodic scheduler</span>
<span class="n">hourlyscheduler</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Periodic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;hourly&quot;</span><span class="p">,</span>
                                      <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;simplebuild&quot;</span><span class="p">],</span>
                                      <span class="n">periodicBuildTimer</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>

<span class="c1"># define the available schedulers</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">hourlyscheduler</span><span class="p">]</span>
</pre></div>
</div>
<p>That’s it.
Every hour this <code class="docutils literal notranslate"><span class="pre">hourly</span></code> scheduler will run the <code class="docutils literal notranslate"><span class="pre">simplebuild</span></code> builder.
If we have more than one builder that we want to run every hour, we can just add them to the <code class="docutils literal notranslate"><span class="pre">builderNames</span></code> list when defining the scheduler and they will all be run.
Or since multiple scheduler are allowed, other schedulers can be defined and added to <code class="docutils literal notranslate"><span class="pre">c['schedulers']</span></code> in the same way.</p>
<p>Other types of schedulers exist; in particular, there are schedulers that can be more dynamic than the periodic one.
The typical dynamic scheduler is one that learns about changes in a source repository (generally because some developer checks in some change), and triggers one or more builders in response to those changes.
Let’s assume for now that the scheduler “magically” learns about changes in the repository (more about this later); here’s how we would define it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>

<span class="c1"># define the dynamic scheduler</span>
<span class="n">trunkchanged</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;trunkchanged&quot;</span><span class="p">,</span>
                                                <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                                <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                                                <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;simplebuild&quot;</span><span class="p">])</span>

<span class="c1"># define the available schedulers</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">trunkchanged</span><span class="p">]</span>
</pre></div>
</div>
<p>This scheduler receives changes happening to the repository, and among all of them, pays attention to those happening in “trunk” (that’s what <code class="docutils literal notranslate"><span class="pre">branch=None</span></code> means).
In other words, it filters the changes to react only to those it’s interested in.
When such changes are detected, and the tree has been quiet for 5 minutes (300 seconds), it runs the <code class="docutils literal notranslate"><span class="pre">simplebuild</span></code> builder.
The <code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code> helps in those situations where commits tend to happen in bursts, which would otherwise result in multiple build requests queuing up.</p>
<p>What if we want to act on two branches (say, trunk and 7.2)?
First we create two builders, one for each branch (see the builders paragraph above), then we create two dynamic schedulers:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>

<span class="c1"># define the dynamic scheduler for trunk</span>
<span class="n">trunkchanged</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;trunkchanged&quot;</span><span class="p">,</span>
                                                <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                                <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                                                <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;simplebuild-trunk&quot;</span><span class="p">])</span>

<span class="c1"># define the dynamic scheduler for the 7.2 branch</span>
<span class="n">branch72changed</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;branch72changed&quot;</span><span class="p">,</span>
                                                   <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="s1">&#39;branches/7.2&#39;</span><span class="p">),</span>
                                                   <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
                                                   <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;simplebuild-72&quot;</span><span class="p">])</span>

<span class="c1"># define the available schedulers</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">trunkchanged</span><span class="p">,</span> <span class="n">branch72changed</span><span class="p">]</span>
</pre></div>
</div>
<p>The syntax of the change filter is VCS-dependent (above is for SVN), but again once the idea is clear, the documentation has all the details.
Another feature of the scheduler is that it can be told which changes, within those it’s paying attention to, are important and which are not.
For example, there may be a documentation directory in the branch the scheduler is watching, but changes under that directory should not trigger a build of the binary.
This finer filtering is implemented by means of the <code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> argument to the scheduler (full details in the docs and - alas - in the sources).</p>
</div>
<div class="section" id="change-sources">
<h5>1.4.1.4. Change sources<a class="headerlink" href="#change-sources" title="Permalink to this headline">¶</a></h5>
<p>Earlier we said that a dynamic scheduler “magically” learns about changes; the final piece of the puzzle are <cite>change sources</cite>, which are precisely the elements in Buildbot whose task is to detect changes in the repository and communicate them to the schedulers.
Note that periodic schedulers don’t need a change source, since they only depend on elapsed time; dynamic schedulers, on the other hand, do need a change source.</p>
<p>A change source is generally configured with information about a source repository (which is where changes happen); a change source can watch changes at different levels in the hierarchy of the repository, so for example it is possible to watch the whole repository or a subset of it, or just a single branch.
This determines the extent of the information that is passed down to the schedulers.</p>
<p>There are many ways a change source can learn about changes; it can periodically poll the repository for changes, or the VCS can be configured (for example through hook scripts triggered by commits) to push changes into the change source.
While these two methods are probably the most common, they are not the only possibilities; it is possible for example to have a change source detect changes by parsing some email sent to a mailing list when a commit happens, and yet other methods exist.
The manual again has the details.</p>
<p>To complete our example, here’s a change source that polls a SVN repository every 2 minutes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>

<span class="n">svnpoller</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;svn://myrepo/projects/coolproject&quot;</span><span class="p">,</span>
                              <span class="n">svnuser</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span>
                              <span class="n">svnpasswd</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span>
                              <span class="n">pollinterval</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
                              <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_branches</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">svnpoller</span>
</pre></div>
</div>
<p>This poller watches the whole “coolproject” section of the repository, so it will detect changes in all the branches.
We could have said:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repourl</span> <span class="o">=</span> <span class="s2">&quot;svn://myrepo/projects/coolproject/trunk&quot;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">repourl</span> <span class="o">=</span> <span class="s2">&quot;svn://myrepo/projects/coolproject/branches/7.2&quot;</span>
</pre></div>
</div>
<p>to watch only a specific branch.</p>
<p>To watch another project, you need to create another change source – and you need to filter changes by project.
For instance, when you add a change source watching project ‘superproject’ to the above example, you need to change:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunkchanged</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;trunkchanged&quot;</span><span class="p">,</span>
                                                <span class="n">change_filter</span><span class="o">=</span><span class="nb">filter</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                                <span class="c1"># ...</span>
                                                <span class="p">)</span>
</pre></div>
</div>
<p>to e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">trunkchanged</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;trunkchanged&quot;</span><span class="p">,</span>
                                                <span class="n">change_filter</span><span class="o">=</span><span class="nb">filter</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s2">&quot;coolproject&quot;</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                                                <span class="c1"># ...</span>
                                                <span class="p">)</span>
</pre></div>
</div>
<p>else coolproject will be built when there’s a change in superproject.</p>
<p>Since we’re watching more than one branch, we need a method to tell in which branch the change occurred when we detect one.
This is what the <code class="docutils literal notranslate"><span class="pre">split_file</span></code> argument does, it takes a callable that Buildbot will call to do the job.
The split_file_branches function, which comes with Buildbot, is designed for exactly this purpose so that’s what the example above uses.</p>
<p>And of course this is all SVN-specific, but there are pollers for all the popular VCSs.</p>
<p>But note: if you have many projects, branches, and builders it probably pays to not hardcode all the schedulers and builders in the configuration, but generate them dynamically starting from list of all projects, branches, targets etc. and using loops to generate all possible combinations (or only the needed ones, depending on the specific setup), as explained in the documentation chapter about <a class="reference internal" href="#document-manual/customization"><span class="doc">Customization</span></a>.</p>
</div>
<div class="section" id="reporters">
<h5>1.4.1.5. Reporters<a class="headerlink" href="#reporters" title="Permalink to this headline">¶</a></h5>
<p>Now that the basics are in place, let’s go back to the builders, which is where the real work happens.
<cite>Reporters</cite> are simply the means Buildbot uses to inform the world about what’s happening, that is, how builders are doing.
There are many reporters: a mail notifier, an IRC notifier, and others.
They are described fairly well in the manual.</p>
<p>One thing I’ve found useful is the ability to pass a domain name as the lookup argument to a <code class="docutils literal notranslate"><span class="pre">mailNotifier</span></code>, which allows you to take an unqualified username as it appears in the SVN change and create a valid email address by appending the given domain name to it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporter</span>

<span class="c1"># if jsmith commits a change, mail for the build is sent to jsmith@example.org</span>
<span class="n">notifier</span> <span class="o">=</span> <span class="n">reporter</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                               <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">lookup</span><span class="o">=</span><span class="s2">&quot;example.org&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;reporters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">notifier</span><span class="p">)</span>
</pre></div>
</div>
<p>The mail notifier can be customized at will by means of the <code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code> argument, which is a class that Buildbot calls to format the body of the email, and to which it makes available lots of information about the build.
Here all the details.</p>
</div>
<div class="section" id="conclusion">
<h5>1.4.1.6. Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h5>
<p>Please note that this article has just scratched the surface; given the complexity of the task of build automation, the possibilities are almost endless.
So there’s much, much more to say about Buildbot. However, hopefully this is a preparation step before reading the official manual. Had I found an explanation as the one above when I was approaching Buildbot, I’d have had to read the manual just once, rather than multiple times. Hope this can help someone else.</p>
<p>(Thanks to Davide Brini for permission to include this tutorial, derived from one he originally posted at <a class="reference external" href="http://backreference.org">http://backreference.org</a> .)</p>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-manual/index"></span><p>This is the Buildbot manual for Buildbot version 1.6.0.</p>
<div class="section" id="buildbot-manual">
<h2>2. Buildbot Manual<a class="headerlink" href="#buildbot-manual" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-manual/introduction"></span><div class="section" id="introduction">
<span id="id1"></span><h3>2.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>Buildbot is a system to automate the compile/test cycle required by most software projects to validate code changes.
By automatically rebuilding and testing the tree each time something has changed, build problems are pinpointed quickly, before other developers are inconvenienced by the failure.
The guilty developer can be identified and harassed without human intervention.
By running the builds on a variety of platforms, developers who do not have the facilities to test their changes everywhere before checkin will at least know shortly afterwards whether they have broken the build or not.
Warning counts, lint checks, image size, compile time, and other build parameters can be tracked over time, are more visible, and are therefore easier to improve.</p>
<p>The overall goal is to reduce tree breakage and provide a platform to run tests or code-quality checks that are too annoying or pedantic for any human to waste their time with.
Developers get immediate (and potentially public) feedback about their changes, encouraging them to be more careful about testing before checkin.</p>
<p>Features:</p>
<ul class="simple">
<li>run builds on a variety of worker platforms</li>
<li>arbitrary build process: handles projects using C, Python, whatever</li>
<li>minimal host requirements: Python and Twisted</li>
<li>workers can be behind a firewall if they can still do checkout</li>
<li>status delivery through web page, email, IRC, other protocols</li>
<li>track builds in progress, provide estimated completion time</li>
<li>flexible configuration by subclassing generic build process classes</li>
<li>debug tools to force a new build, submit fake <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s, query worker status</li>
<li>released under the <a class="reference external" href="https://opensource.org/licenses/gpl-2.0.php">GPL</a></li>
</ul>
<div class="section" id="history-and-philosophy">
<span id="id2"></span><h4>2.1.1. History and Philosophy<a class="headerlink" href="#history-and-philosophy" title="Permalink to this headline">¶</a></h4>
<p>The Buildbot was inspired by a similar project built for a development team writing a cross-platform embedded system.
The various components of the project were supposed to compile and run on several flavors of unix (linux, solaris, BSD), but individual developers had their own preferences and tended to stick to a single platform.
From time to time, incompatibilities would sneak in (some unix platforms want to use <code class="file docutils literal notranslate"><span class="pre">string.h</span></code>, some prefer <code class="file docutils literal notranslate"><span class="pre">strings.h</span></code>), and then the tree would compile for some developers but not others.
The buildbot was written to automate the human process of walking into the office, updating a tree, compiling (and discovering the breakage), finding the developer at fault, and complaining to them about the problem they had introduced.
With multiple platforms it was difficult for developers to do the right thing (compile their potential change on all platforms); the buildbot offered a way to help.</p>
<p>Another problem was when programmers would change the behavior of a library without warning its users, or change internal aspects that other code was (unfortunately) depending upon.
Adding unit tests to the codebase helps here: if an application’s unit tests pass despite changes in the libraries it uses, you can have more confidence that the library changes haven’t broken anything.
Many developers complained that the unit tests were inconvenient or took too long to run: having the buildbot run them reduces the developer’s workload to a minimum.</p>
<p>In general, having more visibility into the project is always good, and automation makes it easier for developers to do the right thing.
When everyone can see the status of the project, developers are encouraged to keep the tree in good working order.
Unit tests that aren’t run on a regular basis tend to suffer from bitrot just like code does: exercising them on a regular basis helps to keep them functioning and useful.</p>
<p>The current version of the Buildbot is additionally targeted at distributed free-software projects, where resources and platforms are only available when provided by interested volunteers.
The workers are designed to require an absolute minimum of configuration, reducing the effort a potential volunteer needs to expend to be able to contribute a new test environment to the project.
The goal is for anyone who wishes that a given project would run on their favorite platform should be able to offer that project a worker, running on that platform, where they can verify that their portability code works, and keeps working.</p>
</div>
<div class="section" id="system-architecture">
<span id="id3"></span><h4>2.1.2. System Architecture<a class="headerlink" href="#system-architecture" title="Permalink to this headline">¶</a></h4>
<p>The Buildbot consists of a single <em>buildmaster</em> and one or more <em>workers</em>, connected in a star topology.
The buildmaster makes all decisions about what, when, and how to build.
It sends commands to be run on the workers, which simply execute the commands and return the results.
(certain steps involve more local decision making, where the overhead of sending a lot of commands back and forth would be inappropriate, but in general the buildmaster is responsible for everything).</p>
<p>The buildmaster is usually fed <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s by some sort of version control system (<a class="reference internal" href="#change-sources"><span class="std std-ref">Change Sources and Changes</span></a>), which may cause builds to be run.
As the builds are performed, various status messages are produced, which are then sent to any registered <a class="reference internal" href="#reporters"><span class="std std-ref">Reporters</span></a>.</p>
<img alt="Overview Diagram" src="_images/overview.svg" /><p>The buildmaster is configured and maintained by the <em>buildmaster admin</em>, who is generally the project team member responsible for build process issues.
Each worker is maintained by a <em>worker admin</em>, who do not need to be quite as involved.
Generally workers are run by anyone who has an interest in seeing the project work well on their favorite platform.</p>
<div class="section" id="worker-connections">
<h5>2.1.2.1. Worker Connections<a class="headerlink" href="#worker-connections" title="Permalink to this headline">¶</a></h5>
<p>The workers are typically run on a variety of separate machines, at least one per platform of interest.
These machines connect to the buildmaster over a TCP connection to a publicly-visible port.
As a result, the workers can live behind a NAT box or similar firewalls, as long as they can get to buildmaster.
The TCP connections are initiated by the worker and accepted by the buildmaster, but commands and results travel both ways within this connection.
The buildmaster is always in charge, so all commands travel exclusively from the buildmaster to the worker.</p>
<p>To perform builds, the workers must typically obtain source code from a CVS/SVN/etc repository.
Therefore they must also be able to reach the repository.
The buildmaster provides instructions for performing builds, but does not provide the source code itself.</p>
<img alt="Worker Connections" src="_images/workers.svg" /></div>
<div class="section" id="buildmaster-architecture">
<span id="id4"></span><h5>2.1.2.2. Buildmaster Architecture<a class="headerlink" href="#buildmaster-architecture" title="Permalink to this headline">¶</a></h5>
<p>The buildmaster consists of several pieces:</p>
<img alt="Buildmaster Architecture" src="_images/master.svg" /><dl class="docutils">
<dt>Change Sources</dt>
<dd>Which create a Change object each time something is modified in the VC repository.
Most <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code>s listen for messages from a hook script of some sort.
Some sources actively poll the repository on a regular basis.
All <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s are fed to the schedulers.</dd>
<dt>Schedulers</dt>
<dd>Which decide when builds should be performed.
They collect <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s into <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code>s, which are then queued for delivery to <code class="xref py py-class docutils literal notranslate"><span class="pre">Builders</span></code> until a worker is available.</dd>
<dt>Builders</dt>
<dd>Which control exactly <em>how</em> each build is performed (with a series of <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s, configured in a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code>).
Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> is run on a single worker.</dd>
<dt>Status plugins</dt>
<dd>Which deliver information about the build results through protocols like HTTP, mail, and IRC.</dd>
</dl>
<p>Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> is configured with a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>s that it will use for its builds.
These workers are expected to behave identically: the only reason to use multiple <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>s for a single <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> is to provide a measure of load-balancing.</p>
<p>Within a single <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>, each <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> creates its own <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> instance.
These <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code>s operate independently from each other.
Each gets its own base directory to work in.
It is quite common to have many <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s sharing the same worker.
For example, there might be two workers: one for i386, and a second for PowerPC.
There may then be a pair of <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s that do a full compile/test run, one for each architecture, and a lone <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> that creates snapshot source tarballs if the full builders complete successfully.
The full builders would each run on a single worker, whereas the tarball creation step might run on either worker (since the platform doesn’t matter when creating source tarballs).
In this case, the mapping would look like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Builder(full-i386)  -&gt;  Workers(worker-i386)
Builder(full-ppc)   -&gt;  Workers(worker-ppc)
Builder(source-tarball) -&gt; Workers(worker-i386, worker-ppc)
</pre></div>
</div>
<p>and each <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> would have two <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code>s inside it, one for a full builder, and a second for the source-tarball builder.</p>
<p>Once a <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> is available, the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> pulls one or more <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code>s off its incoming queue.
(It may pull more than one if it determines that it can merge the requests together; for example, there may be multiple requests to build the current <em>HEAD</em> revision).
These requests are merged into a single <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> instance, which includes the <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code> that describes what exact version of the source code should be used for the build.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> is then randomly assigned to a free <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> and the build begins.</p>
<p>The behaviour when <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code>s are merged can be customized, <a class="reference internal" href="#collapsing-build-requests"><span class="std std-ref">Collapsing Build Requests</span></a>.</p>
</div>
<div class="section" id="status-delivery-architecture">
<span id="id5"></span><h5>2.1.2.3. Status Delivery Architecture<a class="headerlink" href="#status-delivery-architecture" title="Permalink to this headline">¶</a></h5>
<p>The buildmaster maintains a central <code class="xref py py-class docutils literal notranslate"><span class="pre">Status</span></code> object, to which various status plugins are connected.
Through this <code class="xref py py-class docutils literal notranslate"><span class="pre">Status</span></code> object, a full hierarchy of build status objects can be obtained.</p>
<img alt="Status Delivery" src="_images/status.svg" /><p>The configuration file controls which status plugins are active.
Each status plugin gets a reference to the top-level <code class="xref py py-class docutils literal notranslate"><span class="pre">Status</span></code> object.
From there they can request information on each <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code>, and <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code>.
This query-on-demand interface is used by the <code class="docutils literal notranslate"><span class="pre">html.Waterfall</span></code> plugin to create the main status page each time a web browser hits the main URL.</p>
<p>The status plugins can also subscribe to hear about new <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s as they occur: this is used by the <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> to create new email messages for each recently-completed <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Status</span></code> object records the status of old builds on disk in the buildmaster’s base directory.
This allows it to return information about historical builds.</p>
<p>There are also status objects that correspond to <code class="xref py py-class docutils literal notranslate"><span class="pre">Scheduler</span></code>s and <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>s.
These allow status plugins to report information about upcoming builds, and the online/offline status of each worker.</p>
</div>
</div>
<div class="section" id="control-flow">
<span id="id6"></span><h4>2.1.3. Control Flow<a class="headerlink" href="#control-flow" title="Permalink to this headline">¶</a></h4>
<p>A day in the life of the buildbot:</p>
<ul class="simple">
<li>A developer commits some source code changes to the repository.
A hook script or commit trigger of some sort sends information about this change to the buildmaster through one of its configured Change Sources.
This notification might arrive via email, or over a network connection (either initiated by the buildmaster as it <em>subscribes</em> to changes, or by the commit trigger as it pushes <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s towards the buildmaster).
The <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> contains information about who made the change, what files were modified, which revision contains the change, and any checkin comments.</li>
<li>The buildmaster distributes this change to all of its configured schedulers.
Any <code class="docutils literal notranslate"><span class="pre">important</span></code> changes cause the <code class="docutils literal notranslate"><span class="pre">tree-stable-timer</span></code> to be started, and the <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> is added to a list of those that will go into a new <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>.
When the timer expires, a <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> is started on each of a set of configured Builders, all compiling/testing the same source code.
Unless configured otherwise, all <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s run in parallel on the various workers.</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> consists of a series of <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code>s.
Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code> causes some number of commands to be invoked on the remote worker associated with that <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.
The first step is almost always to perform a checkout of the appropriate revision from the same VC system that produced the <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>.
The rest generally perform a compile and run unit tests.
As each <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code> runs, the worker reports back command output and return status to the buildmaster.</li>
<li>As the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> runs, status messages like “Build Started”, “Step Started”, “Build Finished”, etc, are published to a collection of Status Targets.
One of these targets is usually the HTML <code class="docutils literal notranslate"><span class="pre">Waterfall</span></code> display, which shows a chronological list of events, and summarizes the results of the most recent build at the top of each column.
Developers can periodically check this page to see how their changes have fared.
If they see red, they know that they’ve made a mistake and need to fix it.
If they see green, they know that they’ve done their duty and don’t need to worry about their change breaking anything.</li>
<li>If a <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> status target is active, the completion of a build will cause email to be sent to any developers whose <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s were incorporated into this <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> can be configured to only send mail upon failing builds, or for builds which have just transitioned from passing to failing.
Other status targets can provide similar real-time notification via different communication channels, like IRC.</li>
</ul>
</div>
</div>
<span id="document-manual/installation/index"></span><div class="section" id="installation">
<h3>2.2. Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
<span id="document-manual/installation/components"></span><div class="section" id="buildbot-components">
<span id="id1"></span><h4>2.2.1. Buildbot Components<a class="headerlink" href="#buildbot-components" title="Permalink to this headline">¶</a></h4>
<p>Buildbot is shipped in two components: the <em>buildmaster</em> (called <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> for legacy reasons) and the <em>worker</em>.
The worker component has far fewer requirements, and is more broadly compatible than the buildmaster.
You will need to carefully pick the environment in which to run your buildmaster, but the worker should be able to run just about anywhere.</p>
<p>It is possible to install the buildmaster and worker on the same system, although for anything but the smallest installation this arrangement will not be very efficient.</p>
</div>
<span id="document-manual/installation/requirements"></span><div class="section" id="requirements">
<span id="id1"></span><h4>2.2.2. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<div class="section" id="common-requirements">
<span id="id2"></span><h5>2.2.2.1. Common Requirements<a class="headerlink" href="#common-requirements" title="Permalink to this headline">¶</a></h5>
<p>At a bare minimum, you’ll need the following for both the buildmaster and a worker:</p>
<p>Python: <a class="reference external" href="https://www.python.org">https://www.python.org</a></p>
<blockquote>
<div><p>Buildbot master works with Python 2.7 or Python-3.4+.
Buildbot worker works with Python 2.7, or Python 3.4+.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This should be a “normal” build of Python.
Builds of Python with debugging enabled or other unusual build parameters are likely to cause incorrect behavior.</p>
</div>
</div></blockquote>
<p>Twisted: <a class="reference external" href="http://twistedmatrix.com">http://twistedmatrix.com</a></p>
<blockquote>
<div>Buildbot requires Twisted-14.0.1 or later on the master, and Twisted-10.2.0 on the worker.
In upcoming versions of Buildbot, a newer Twisted will also be required on the worker.
As always, the most recent version is recommended.</div></blockquote>
<p>Of course, your project’s build process will impose additional requirements on the workers.
These hosts must have all the tools necessary to compile and test your project’s source code.</p>
<div class="section" id="windows-support">
<h6>Windows Support<a class="headerlink" href="#windows-support" title="Permalink to this headline">¶</a></h6>
<p>Buildbot - both master and worker - runs well natively on Windows.
The worker runs well on Cygwin, but because of problems with SQLite on Cygwin, the master does not.</p>
<p>Buildbot’s windows testing is limited to the most recent Twisted and Python versions.
For best results, use the most recent available versions of these libraries on Windows.</p>
<p>Pywin32: <a class="reference external" href="http://sourceforge.net/projects/pywin32/">http://sourceforge.net/projects/pywin32/</a></p>
<blockquote>
<div>Twisted requires PyWin32 in order to spawn processes on Windows.</div></blockquote>
</div>
</div>
<div class="section" id="buildmaster-requirements">
<span id="id3"></span><h5>2.2.2.2. Buildmaster Requirements<a class="headerlink" href="#buildmaster-requirements" title="Permalink to this headline">¶</a></h5>
<p>Note that all of these requirements aside from SQLite can easily be installed from the Python package repository, PyPI.</p>
<p>sqlite3: <a class="reference external" href="http://www.sqlite.org">http://www.sqlite.org</a></p>
<blockquote>
<div><p>Buildbot requires a database to store its state, and by default uses SQLite.
Version 3.7.0 or higher is recommended, although Buildbot will run down to 3.6.16 – at the risk of “Database is locked” errors.
The minimum version is 3.4.0, below which parallel database queries and schema introspection fail.</p>
<p>Please note that Python ships with sqlite3 by default since Python 2.6.</p>
<p>If you configure a different database engine, then SQLite is not required.
however note that Buildbot’s own unit tests require SQLite.</p>
</div></blockquote>
<p>Jinja2: <a class="reference external" href="http://jinja.pocoo.org/">http://jinja.pocoo.org/</a></p>
<blockquote>
<div><p>Buildbot requires Jinja version 2.1 or higher.</p>
<p>Jinja2 is a general purpose templating language and is used by Buildbot to generate the HTML output.</p>
</div></blockquote>
<p>SQLAlchemy: <a class="reference external" href="http://www.sqlalchemy.org/">http://www.sqlalchemy.org/</a></p>
<blockquote>
<div>Buildbot requires SQLAlchemy version 0.8.0 or higher.
SQLAlchemy allows Buildbot to build database schemas and queries for a wide variety of database systems.</div></blockquote>
<p>SQLAlchemy-Migrate: <a class="reference external" href="https://sqlalchemy-migrate.readthedocs.io/en/latest/">https://sqlalchemy-migrate.readthedocs.io/en/latest/</a></p>
<blockquote>
<div>Buildbot requires SQLAlchemy-Migrate version 0.9.0 or higher.
Buildbot uses SQLAlchemy-Migrate to manage schema upgrades from version to version.</div></blockquote>
<p>Python-Dateutil: <a class="reference external" href="http://labix.org/python-dateutil">http://labix.org/python-dateutil</a></p>
<blockquote>
<div>Buildbot requires Python-Dateutil in version 1.5 or higher (the last version to support Python-2.x).
This is a small, pure-Python library.</div></blockquote>
<p>Autobahn:</p>
<blockquote>
<div>The master requires Autobahn version 0.16.0 or higher with Python 2.7.</div></blockquote>
</div>
</div>
<span id="document-manual/installation/installation"></span><div class="section" id="installing-the-code">
<span id="id1"></span><h4>2.2.3. Installing the code<a class="headerlink" href="#installing-the-code" title="Permalink to this headline">¶</a></h4>
<div class="section" id="the-buildbot-packages">
<h5>2.2.3.1. The Buildbot Packages<a class="headerlink" href="#the-buildbot-packages" title="Permalink to this headline">¶</a></h5>
<p>Buildbot comes in several parts: <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> (the buildmaster), <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> (the worker), <code class="docutils literal notranslate"><span class="pre">buildbot-www</span></code>, and several web plugins such as <code class="docutils literal notranslate"><span class="pre">buildbot-waterfall-view</span></code>.</p>
<p>The worker and buildmaster can be installed individually or together.
The base web (<code class="docutils literal notranslate"><span class="pre">buildbot.www</span></code>) and web plugins are required to run a master with a web interface (the common configuration).</p>
</div>
<div class="section" id="installation-from-pypi">
<h5>2.2.3.2. Installation From PyPI<a class="headerlink" href="#installation-from-pypi" title="Permalink to this headline">¶</a></h5>
<p>The preferred way to install Buildbot is using <code class="docutils literal notranslate"><span class="pre">pip</span></code>.
For the master:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot
</pre></div>
</div>
<p>and for the worker:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-worker
</pre></div>
</div>
<p>When using <code class="docutils literal notranslate"><span class="pre">pip</span></code> to install instead of distribution specific package managers, e.g. via <cite>apt-get</cite> or <cite>ports</cite>, it is simpler to choose exactly which version one wants to use.
It may however be easier to install via distribution specific package mangers but note that they may provide an earlier version than what is available via <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<p>If you plan to use TLS or SSL in master configuration (e.g. to fetch resources over HTTPS using <code class="docutils literal notranslate"><span class="pre">twisted.web.client</span></code>), you need to install Buildbot with <code class="docutils literal notranslate"><span class="pre">tls</span></code> extras:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot<span class="o">[</span>tls<span class="o">]</span>
</pre></div>
</div>
</div>
<div class="section" id="installation-from-tarballs">
<h5>2.2.3.3. Installation From Tarballs<a class="headerlink" href="#installation-from-tarballs" title="Permalink to this headline">¶</a></h5>
<p>Buildbot master and <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> are installed using the standard Python <a class="reference external" href="http://docs.python.org/library/distutils.html">distutils</a> process.
For either component, after unpacking the tarball, the process is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py build
python setup.py install
</pre></div>
</div>
<p>where the install step may need to be done as root.
This will put the bulk of the code in somewhere like <code class="file docutils literal notranslate"><span class="pre">/usr/lib/pythonx.y/site-packages/buildbot</span></code>.
It will also install the <strong class="command">buildbot</strong> command-line tool in <code class="file docutils literal notranslate"><span class="pre">/usr/bin/buildbot</span></code>.</p>
<p>If the environment variable <code class="docutils literal notranslate"><span class="pre">$NO_INSTALL_REQS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code>, then <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> will not try to install Buildbot’s requirements.
This is usually only useful when building a Buildbot package.</p>
<p>To test this, shift to a different directory (like <code class="file docutils literal notranslate"><span class="pre">/tmp</span></code>), and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot --version
<span class="c1"># or</span>
buildbot-worker --version
</pre></div>
</div>
<p>If it shows you the versions of Buildbot and Twisted, the install went ok.
If it says “no such command” or it gets an <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> when it tries to load the libraries, then something went wrong.
<code class="docutils literal notranslate"><span class="pre">pydoc</span> <span class="pre">buildbot</span></code> is another useful diagnostic tool.</p>
<p>Windows users will find these files in other places.
You will need to make sure that Python can find the libraries, and will probably find it convenient to have <strong class="command">buildbot</strong> on your <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>.</p>
</div>
<div class="section" id="installation-in-a-virtualenv">
<span id="id2"></span><h5>2.2.3.4. Installation in a Virtualenv<a class="headerlink" href="#installation-in-a-virtualenv" title="Permalink to this headline">¶</a></h5>
<p>If you cannot or do not wish to install the buildbot into a site-wide location like <code class="file docutils literal notranslate"><span class="pre">/usr</span></code> or <code class="file docutils literal notranslate"><span class="pre">/usr/local</span></code>, you can also install it into the account’s home directory or any other location using a tool like <a class="reference external" href="http://pypi.python.org/pypi/virtualenv">virtualenv</a>.</p>
</div>
<div class="section" id="running-buildbot-s-tests-optional">
<span id="running-buildbots-tests-optional"></span><h5>2.2.3.5. Running Buildbot’s Tests (optional)<a class="headerlink" href="#running-buildbot-s-tests-optional" title="Permalink to this headline">¶</a></h5>
<p>If you wish, you can run the buildbot unit test suite.
First, ensure you have the <a class="reference external" href="http://pypi.python.org/pypi/mock">mock</a> Python module installed from PyPI.
You must not be using a Python wheels packaged version of Buildbot or have specified the bdist_wheel command when building.
The test suite is not included with the PyPi packaged version.
This module is not required for ordinary Buildbot operation - only to run the tests.
Note that this is not the same as the Fedora <code class="docutils literal notranslate"><span class="pre">mock</span></code> package!</p>
<p>You can check with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python -mmock
</pre></div>
</div>
<p>Then, run the tests:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PYTHONPATH</span><span class="o">=</span>. trial buildbot.test
<span class="c1"># or</span>
<span class="nv">PYTHONPATH</span><span class="o">=</span>. trial buildbot_worker.test
</pre></div>
</div>
<p>Nothing should fail, although a few might be skipped.</p>
<p>If any of the tests fail for reasons other than a missing <code class="docutils literal notranslate"><span class="pre">mock</span></code>, you should stop and investigate the cause before continuing the installation process, as it will probably be easier to track down the bug early.
In most cases, the problem is incorrectly installed Python modules or a badly configured <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>.
This may be a good time to contact the Buildbot developers for help.</p>
</div>
</div>
<span id="document-manual/installation/buildmaster"></span><div class="section" id="buildmaster-setup">
<h4>2.2.4. Buildmaster Setup<a class="headerlink" href="#buildmaster-setup" title="Permalink to this headline">¶</a></h4>
<div class="section" id="creating-a-buildmaster">
<span id="id1"></span><h5>2.2.4.1. Creating a buildmaster<a class="headerlink" href="#creating-a-buildmaster" title="Permalink to this headline">¶</a></h5>
<p>As you learned earlier (<a class="reference internal" href="#system-architecture"><span class="std std-ref">System Architecture</span></a>), the buildmaster runs on a central host (usually one that is publicly visible, so everybody can check on the status of the project), and controls all aspects of the buildbot system</p>
<p>You will probably wish to create a separate user account for the buildmaster, perhaps named <code class="docutils literal notranslate"><span class="pre">buildmaster</span></code>.
Do not run the buildmaster as <code class="docutils literal notranslate"><span class="pre">root</span></code>!</p>
<p>You need to choose a directory for the buildmaster, called the <code class="docutils literal notranslate"><span class="pre">basedir</span></code>.
This directory will be owned by the buildmaster.
It will contain configuration, the database, and status information - including logfiles.
On a large buildmaster this directory will see a lot of activity, so it should be on a disk with adequate space and speed.</p>
<p>Once you’ve picked a directory, use the <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span></code> command to create the directory and populate it with startup files:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot create-master -r basedir
</pre></div>
</div>
<p>You will need to create a <a class="reference internal" href="#configuration"><span class="std std-ref">configuration file</span></a> before starting the buildmaster.
Most of the rest of this manual is dedicated to explaining how to do this.
A sample configuration file is placed in the working directory, named <code class="file docutils literal notranslate"><span class="pre">master.cfg.sample</span></code>, which can be copied to <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> and edited to suit your purposes.</p>
<p>(Internal details: This command creates a file named <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> that contains all the state necessary to create the buildmaster.
Twisted has a tool called <code class="docutils literal notranslate"><span class="pre">twistd</span></code> which can use this .tac file to create and launch a buildmaster instance.
Twistd takes care of logging and daemonization (running the program in the background).
<code class="file docutils literal notranslate"><span class="pre">/usr/bin/buildbot</span></code> is a front end which runs <cite>twistd</cite> for you.)</p>
<p>Your master will need a database to store the various information about your builds, and its configuration.
By default, the <code class="docutils literal notranslate"><span class="pre">sqlite3</span></code> backend will be used.
This needs no configuration, neither extra software.
All information will be stored in the file <code class="file docutils literal notranslate"><span class="pre">state.sqlite</span></code>.
Buildbot however supports multiple backends.
See <a class="reference internal" href="#database-server"><span class="std std-ref">Using A Database Server</span></a> for more options.</p>
<div class="section" id="buildmaster-options">
<h6>Buildmaster Options<a class="headerlink" href="#buildmaster-options" title="Permalink to this headline">¶</a></h6>
<p>This section lists options to the <code class="docutils literal notranslate"><span class="pre">create-master</span></code> command.
You can also type <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span> <span class="pre">--help</span></code> for an up-to-the-moment summary.</p>
<dl class="option">
<dt id="cmdoption-buildbot-create-master-force">
<code class="descname">--force</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-force" title="Permalink to this definition">¶</a></dt>
<dd><p>This option will allow to re-use an existing directory.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-no-logrotate">
<code class="descname">--no-logrotate</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-no-logrotate" title="Permalink to this definition">¶</a></dt>
<dd><p>This disables internal worker log management mechanism.
With this option worker does not override the default logfile name and its behaviour giving a possibility to control those with command-line options of twistd daemon.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-relocatable">
<code class="descname">--relocatable</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-relocatable" title="Permalink to this definition">¶</a></dt>
<dd><p>This creates a “relocatable” <code class="docutils literal notranslate"><span class="pre">buildbot.tac</span></code>, which uses relative paths instead of absolute paths, so that the buildmaster directory can be moved about.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-config">
<code class="descname">--config</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-config" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the configuration file to use.
This configuration file need not reside in the buildmaster directory.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-log-size">
<code class="descname">--log-size</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-log-size" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the size in bytes when to rotate the Twisted log files.
The default is 10MiB.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-log-count">
<code class="descname">--log-count</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-log-count" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the number of log rotations to keep around.
You can either specify a number or <code class="docutils literal notranslate"><span class="pre">None</span></code> to keep all <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> files around.
The default is 10.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-create-master-db">
<code class="descname">--db</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-create-master-db" title="Permalink to this definition">¶</a></dt>
<dd><p>The database that the Buildmaster should use.
Note that the same value must be added to the configuration file.</p>
</dd></dl>

</div>
</div>
<div class="section" id="upgrading-an-existing-buildmaster">
<span id="id2"></span><h5>2.2.4.2. Upgrading an Existing Buildmaster<a class="headerlink" href="#upgrading-an-existing-buildmaster" title="Permalink to this headline">¶</a></h5>
<p>If you have just installed a new version of the Buildbot code, and you have buildmasters that were created using an older version, you’ll need to upgrade these buildmasters before you can use them.
The upgrade process adds and modifies files in the buildmaster’s base directory to make it compatible with the new code.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot upgrade-master basedir
</pre></div>
</div>
<p>This command will also scan your <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file for incompatibilities (by loading it and printing any errors or deprecation warnings that occur).
Each buildbot release tries to be compatible with configurations that worked cleanly (i.e. without deprecation warnings) on the previous release: any functions or classes that are to be removed will first be deprecated in a release, to give you a chance to start using the replacement.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> command is idempotent.
It is safe to run it multiple times.
After each upgrade of the buildbot code, you should use <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> on all your buildmasters.</p>
<p>In general, Buildbot workers and masters can be upgraded independently, although some new features will not be available, depending on the master and worker versions.</p>
<p>Beyond this general information, read all of the sections below that apply to versions through which you are upgrading.</p>
<div class="section" id="version-specific-notes">
<span id="buildmaster-version-specific-notes"></span><h6>Version-specific Notes<a class="headerlink" href="#version-specific-notes" title="Permalink to this headline">¶</a></h6>
<div class="section" id="upgrading-from-buildbot-0-8-x-to-buildbot-0-9-x">
<h7>Upgrading from Buildbot-0.8.x to Buildbot-0.9.x<a class="headerlink" href="#upgrading-from-buildbot-0-8-x-to-buildbot-0-9-x" title="Permalink to this headline">¶</a></h7>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
</div>
<div class="section" id="upgrading-a-buildmaster-to-buildbot-0-7-6">
<h7>Upgrading a Buildmaster to Buildbot-0.7.6<a class="headerlink" href="#upgrading-a-buildmaster-to-buildbot-0-7-6" title="Permalink to this headline">¶</a></h7>
<p>The 0.7.6 release introduced the <code class="file docutils literal notranslate"><span class="pre">public_html/</span></code> directory, which contains <code class="file docutils literal notranslate"><span class="pre">index.html</span></code> and other files served by the <code class="docutils literal notranslate"><span class="pre">WebStatus</span></code> and <code class="docutils literal notranslate"><span class="pre">Waterfall</span></code> status displays.
The <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> command will create these files if they do not already exist.
It will not modify existing copies, but it will write a new copy in e.g. <code class="file docutils literal notranslate"><span class="pre">index.html.new</span></code> if the new version differs from the version that already exists.</p>
</div>
<div class="section" id="upgrading-a-buildmaster-to-buildbot-0-8-0">
<h7>Upgrading a Buildmaster to Buildbot-0.8.0<a class="headerlink" href="#upgrading-a-buildmaster-to-buildbot-0-8-0" title="Permalink to this headline">¶</a></h7>
<p>Buildbot-0.8.0 introduces a database backend, which is SQLite by default.
The <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code> command will automatically create and populate this database with the changes the buildmaster has seen.
Note that, as of this release, build history is <em>not</em> contained in the database, and is thus not migrated.</p>
</div>
<div class="section" id="upgrading-into-a-non-sqlite-database">
<h7>Upgrading into a non-SQLite database<a class="headerlink" href="#upgrading-into-a-non-sqlite-database" title="Permalink to this headline">¶</a></h7>
<p>If you are not using sqlite, you will need to add an entry into your <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> to reflect the database version you are using.
The upgrade process does <em>not</em> edit your <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> for you.
So something like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># for using mysql:</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mysql://bbuser:&lt;password&gt;@localhost/buildbot&#39;</span>
</pre></div>
</div>
<p>Once the parameter has been added, invoke <code class="docutils literal notranslate"><span class="pre">upgrade-master</span></code>.
This will extract the DB url from your configuration file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot upgrade-master
</pre></div>
</div>
<p>See <a class="reference internal" href="#database-specification"><span class="std std-ref">Database Specification</span></a> for more options to specify a database.</p>
</div>
</div>
</div>
</div>
<span id="document-manual/installation/worker"></span><div class="section" id="worker-setup">
<h4>2.2.5. Worker Setup<a class="headerlink" href="#worker-setup" title="Permalink to this headline">¶</a></h4>
<div class="section" id="creating-a-worker">
<span id="id1"></span><h5>2.2.5.1. Creating a worker<a class="headerlink" href="#creating-a-worker" title="Permalink to this headline">¶</a></h5>
<p>Typically, you will be adding a worker to an existing buildmaster, to provide additional architecture coverage.
The buildbot administrator will give you several pieces of information necessary to connect to the buildmaster.
You should also be somewhat familiar with the project being tested, so you can troubleshoot build problems locally.</p>
<p>The buildbot exists to make sure that the project’s stated <code class="docutils literal notranslate"><span class="pre">how</span> <span class="pre">to</span> <span class="pre">build</span> <span class="pre">it</span></code> process actually works.
To this end, the worker should run in an environment just like that of your regular developers.
Typically the project build process is documented somewhere (<code class="file docutils literal notranslate"><span class="pre">README</span></code>, <code class="file docutils literal notranslate"><span class="pre">INSTALL</span></code>, etc), in a document that should mention all library dependencies and contain a basic set of build instructions.
This document will be useful as you configure the host and account in which the worker runs.</p>
<p>Here’s a good checklist for setting up a worker:</p>
<ol class="arabic simple">
<li>Set up the account</li>
</ol>
<blockquote>
<div>It is recommended (although not mandatory) to set up a separate user account for the worker.
This account is frequently named <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> or <code class="docutils literal notranslate"><span class="pre">worker</span></code>.
This serves to isolate your personal working environment from that of the worker’s, and helps to minimize the security threat posed by letting possibly-unknown contributors run arbitrary code on your system.
The account should have a minimum of fancy init scripts.</div></blockquote>
<ol class="arabic simple" start="2">
<li>Install the buildbot code</li>
</ol>
<blockquote>
<div>Follow the instructions given earlier (<a class="reference internal" href="#installing-the-code"><span class="std std-ref">Installing the code</span></a>).
If you use a separate worker account, and you didn’t install the buildbot code to a shared location, then you will need to install it with <code class="docutils literal notranslate"><span class="pre">--home=~</span></code> for each account that needs it.</div></blockquote>
<ol class="arabic simple" start="3">
<li>Set up the host</li>
</ol>
<blockquote>
<div><p>Make sure the host can actually reach the buildmaster.
Usually the buildmaster is running a status webserver on the same machine, so simply point your web browser at it and see if you can get there.
Install whatever additional packages or libraries the project’s INSTALL document advises.
(or not: if your worker is supposed to make sure that building without optional libraries still works, then don’t install those libraries.)</p>
<p>Again, these libraries don’t necessarily have to be installed to a site-wide shared location, but they must be available to your build process.
Accomplishing this is usually very specific to the build process, so installing them to <code class="file docutils literal notranslate"><span class="pre">/usr</span></code> or <code class="file docutils literal notranslate"><span class="pre">/usr/local</span></code> is usually the best approach.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Test the build process</li>
</ol>
<blockquote>
<div>Follow the instructions in the <code class="file docutils literal notranslate"><span class="pre">INSTALL</span></code> document, in the worker’s account.
Perform a full CVS (or whatever) checkout, configure, make, run tests, etc.
Confirm that the build works without manual fussing.
If it doesn’t work when you do it by hand, it will be unlikely to work when the buildbot attempts to do it in an automated fashion.</div></blockquote>
<ol class="arabic simple" start="5">
<li>Choose a base directory</li>
</ol>
<blockquote>
<div>This should be somewhere in the worker’s account, typically named after the project which is being tested.
The worker will not touch any file outside of this directory.
Something like <code class="file docutils literal notranslate"><span class="pre">~/Buildbot</span></code> or <code class="file docutils literal notranslate"><span class="pre">~/Workers/fooproject</span></code> is appropriate.</div></blockquote>
<ol class="arabic simple" start="6">
<li>Get the buildmaster host/port, botname, and password</li>
</ol>
<blockquote>
<div><p>When the buildbot admin configures the buildmaster to accept and use your worker, they will provide you with the following pieces of information:</p>
<ul class="simple">
<li>your worker’s name</li>
<li>the password assigned to your worker</li>
<li>the hostname and port number of the buildmaster, i.e. <a class="reference external" href="http://buildbot.example.org:8007">http://buildbot.example.org:8007</a></li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="7">
<li>Create the worker</li>
</ol>
<blockquote>
<div><p>Now run the ‘worker’ command as follows:</p>
<blockquote>
<div><code class="samp docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <em><span class="pre">BASEDIR</span></em> <em><span class="pre">MASTERHOST</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em> <em><span class="pre">WORKERNAME</span></em> <em><span class="pre">PASSWORD</span></em></code></div></blockquote>
<p>This will create the base directory and a collection of files inside, including the <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file that contains all the information you passed to the <strong class="command">buildbot</strong> command.</p>
</div></blockquote>
<ol class="arabic simple" start="8">
<li>Fill in the hostinfo files</li>
</ol>
<blockquote>
<div><p>When it first connects, the worker will send a few files up to the buildmaster which describe the host that it is running on.
These files are presented on the web status display so that developers have more information to reproduce any test failures that are witnessed by the buildbot.
There are sample files in the <code class="file docutils literal notranslate"><span class="pre">info</span></code> subdirectory of the buildbot’s base directory.
You should edit these to correctly describe you and your host.</p>
<p><code class="file docutils literal notranslate"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/admin</span></code> should contain your name and email address.
This is the <code class="docutils literal notranslate"><span class="pre">worker</span> <span class="pre">admin</span> <span class="pre">address</span></code>, and will be visible from the build status page (so you may wish to munge it a bit if address-harvesting spambots are a concern).</p>
<p><code class="file docutils literal notranslate"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/host</span></code> should be filled with a brief description of the host: OS, version, memory size, CPU speed, versions of relevant libraries installed, and finally the version of the buildbot code which is running the worker.</p>
<p>The optional <code class="file docutils literal notranslate"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/access_uri</span></code> can specify a URI which will connect a user to the machine.
Many systems accept <code class="docutils literal notranslate"><span class="pre">ssh://hostname</span></code> URIs for this purpose.</p>
<p>If you run many workers, you may want to create a single <code class="file docutils literal notranslate"><span class="pre">~worker/info</span></code> file and share it among all the workers with symlinks.</p>
</div></blockquote>
<div class="section" id="worker-options">
<span id="id2"></span><h6>Worker Options<a class="headerlink" href="#worker-options" title="Permalink to this headline">¶</a></h6>
<p>There are a handful of options you might want to use when creating the worker with the <code class="samp docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <span class="pre">&lt;options&gt;</span> <span class="pre">DIR</span> <span class="pre">&lt;params&gt;</span></code> command.
You can type <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <span class="pre">--help</span></code> for a summary.
To use these, just include them on the <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code> command line, like this</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot-worker create-worker --umask<span class="o">=</span>0o22 ~/worker buildmaster.example.org:42012 <span class="o">{</span>myworkername<span class="o">}</span> <span class="o">{</span>mypasswd<span class="o">}</span>
</pre></div>
</div>
<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-no-logrotate">
<code class="descname">--no-logrotate</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-no-logrotate" title="Permalink to this definition">¶</a></dt>
<dd><p>This disables internal worker log management mechanism.
With this option worker does not override the default logfile name and its behaviour giving a possibility to control those with command-line options of twistd daemon.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-umask">
<code class="descname">--umask</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-umask" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a string (generally an octal representation of an integer) which will cause the worker process’ <code class="docutils literal notranslate"><span class="pre">umask</span></code> value to be set shortly after initialization.
The <code class="docutils literal notranslate"><span class="pre">twistd</span></code> daemonization utility forces the umask to 077 at startup (which means that all files created by the worker or its child processes will be unreadable by any user other than the worker account).
If you want build products to be readable by other accounts, you can add <code class="docutils literal notranslate"><span class="pre">--umask=022</span></code> to tell the worker to fix the umask after twistd clobbers it.
If you want build products to be <em>writable</em> by other accounts too, use <code class="docutils literal notranslate"><span class="pre">--umask=000</span></code>, but this is likely to be a security problem.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-keepalive">
<code class="descname">--keepalive</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-keepalive" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a number that indicates how frequently <code class="docutils literal notranslate"><span class="pre">keepalive</span></code> messages should be sent from the worker to the buildmaster, expressed in seconds.
The default (600) causes a message to be sent to the buildmaster at least once every 10 minutes.
To set this to a lower value, use e.g. <code class="docutils literal notranslate"><span class="pre">--keepalive=120</span></code>.</p>
<p>If the worker is behind a NAT box or stateful firewall, these messages may help to keep the connection alive: some NAT boxes tend to forget about a connection if it has not been used in a while.
When this happens, the buildmaster will think that the worker has disappeared, and builds will time out.
Meanwhile the worker will not realize than anything is wrong.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-maxdelay">
<code class="descname">--maxdelay</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-maxdelay" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a number that indicates the maximum amount of time the worker will wait between connection attempts, expressed in seconds.
The default (300) causes the worker to wait at most 5 minutes before trying to connect to the buildmaster again.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-maxretries">
<code class="descname">--maxretries</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-maxretries" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a number that indicates the maximum number of time the worker will make connection attempts.
After that amount, the worker process will stop.
This option is useful for <a class="reference internal" href="#latent-workers"><span class="std std-ref">Latent Workers</span></a> to avoid consuming resources in case of misconfiguration or master failure.</p>
<p>For VM based latent workers, the user is responsible for halting the system when Buildbot worker has exited.
This feature is heavily OS dependent, and cannot be managed by Buildbot worker.
For example with <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.service.html">systemd</a>, one can add <code class="docutils literal notranslate"><span class="pre">ExecStopPost=shutdown</span> <span class="pre">now</span></code> to the Buildbot worker service unit configuration.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-log-size">
<code class="descname">--log-size</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-log-size" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the size in bytes when to rotate the Twisted log files.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-log-count">
<code class="descname">--log-count</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-log-count" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the number of log rotations to keep around.
You can either specify a number or <code class="docutils literal notranslate"><span class="pre">None</span></code> to keep all <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> files around.
The default is 10.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildbot-worker-create-worker-allow-shutdown">
<code class="descname">--allow-shutdown</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-buildbot-worker-create-worker-allow-shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>Can also be passed directly to the Worker constructor in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>.
If set, it allows the worker to initiate a graceful shutdown, meaning that it will ask the master to shut down the worker when the current build, if any, is complete.</p>
<p>Setting allow_shutdown to <code class="docutils literal notranslate"><span class="pre">file</span></code> will cause the worker to watch <code class="file docutils literal notranslate"><span class="pre">shutdown.stamp</span></code> in basedir for updates to its mtime.
When the mtime changes, the worker will request a graceful shutdown from the master.
The file does not need to exist prior to starting the worker.</p>
<p>Setting allow_shutdown to <code class="docutils literal notranslate"><span class="pre">signal</span></code> will set up a SIGHUP handler to start a graceful shutdown.
When the signal is received, the worker will request a graceful shutdown from the master.</p>
<p>The default value is <code class="docutils literal notranslate"><span class="pre">None</span></code>, in which case this feature will be disabled.</p>
<p>Both master and worker must be at least version 0.8.3 for this feature to work.</p>
</dd></dl>

</div>
<div class="section" id="other-worker-configuration">
<span id="id3"></span><h6>Other Worker Configuration<a class="headerlink" href="#other-worker-configuration" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unicode_encoding</span></code></dt>
<dd><p class="first">This represents the encoding that buildbot should use when converting unicode commandline arguments into byte strings in order to pass to the operating system when spawning new processes.</p>
<p>The default value is what Python’s <code class="xref py py-func docutils literal notranslate"><span class="pre">sys.getfilesystemencoding</span></code> returns, which on Windows is ‘mbcs’, on Mac OSX is ‘utf-8’, and on Unix depends on your locale settings.</p>
<p class="last">If you need a different encoding, this can be changed in your worker’s <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file by adding a <code class="docutils literal notranslate"><span class="pre">unicode_encoding</span></code> argument to the Worker constructor.</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">buildmaster_host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">workername</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span>
           <span class="n">keepalive</span><span class="p">,</span> <span class="n">usepty</span><span class="p">,</span> <span class="n">umask</span><span class="o">=</span><span class="n">umask</span><span class="p">,</span> <span class="n">maxdelay</span><span class="o">=</span><span class="n">maxdelay</span><span class="p">,</span>
           <span class="n">unicode_encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">allow_shutdown</span><span class="o">=</span><span class="s1">&#39;signal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="upgrading-an-existing-worker">
<span id="id4"></span><h5>2.2.5.2. Upgrading an Existing Worker<a class="headerlink" href="#upgrading-an-existing-worker" title="Permalink to this headline">¶</a></h5>
<div class="section" id="version-specific-notes">
<span id="worker-version-specific-notes"></span><h6>Version-specific Notes<a class="headerlink" href="#version-specific-notes" title="Permalink to this headline">¶</a></h6>
<p>During project lifetime worker has transitioned over few states:</p>
<ol class="arabic simple">
<li>Before Buildbot version 0.8.1 worker were integral part of <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> package distribution.</li>
<li>Starting from Buildbot version 0.8.1 worker were extracted from <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> package to <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package.</li>
<li>Starting from Buildbot version 0.9.0 the <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package was renamed to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code>.</li>
</ol>
<div class="section" id="upgrading-a-worker-to-buildbot-slave-0-8-1">
<h7>Upgrading a Worker to buildbot-slave 0.8.1<a class="headerlink" href="#upgrading-a-worker-to-buildbot-slave-0-8-1" title="Permalink to this headline">¶</a></h7>
<p>Before Buildbot version 0.8.1, the Buildbot master and worker were part of the same distribution.
As of version 0.8.1, the worker is a separate distribution.</p>
<p>As of this release, you will need to install <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> to run a worker.</p>
<p>Any automatic startup scripts that had run <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">start</span></code> for previous versions should be changed to run <code class="docutils literal notranslate"><span class="pre">buildslave</span> <span class="pre">start</span></code> instead.</p>
<p>If you are running a version later than 0.8.1, then you can skip the remainder of this section: the <code class="docutils literal notranslate"><span class="pre">upgrade-slave</span></code> command will take care of this.
If you are upgrading directly to 0.8.1, read on.</p>
<p>The existing <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> for any workers running older versions will need to be edited or replaced.
If the loss of cached worker state (e.g., for Source steps in copy mode) is not problematic, the easiest solution is to simply delete the worker directory and re-run <code class="docutils literal notranslate"><span class="pre">buildslave</span> <span class="pre">create-slave</span></code>.</p>
<p>If deleting the worker directory is problematic, the change to <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> is simple.
On line 3, replace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.slave.bot</span> <span class="k">import</span> <span class="n">BuildSlave</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildslave.bot</span> <span class="k">import</span> <span class="n">BuildSlave</span>
</pre></div>
</div>
<p>After this change, the worker should start as usual.</p>
</div>
<div class="section" id="upgrading-from-0-8-1-to-the-latest-0-8-version-of-buildbot-slave">
<h7>Upgrading from <cite>0.8.1</cite> to the latest <code class="docutils literal notranslate"><span class="pre">0.8.*</span></code> version of buildbot-slave<a class="headerlink" href="#upgrading-from-0-8-1-to-the-latest-0-8-version-of-buildbot-slave" title="Permalink to this headline">¶</a></h7>
<p>If you have just installed a new version of Buildbot-slave, you may need to take some steps to upgrade it.
If you are upgrading to version 0.8.2 or later, you can run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildslave upgrade-slave /path/to/worker/dir
</pre></div>
</div>
</div>
<div class="section" id="upgrading-from-the-latest-version-of-buildbot-slave-to-buildbot-worker">
<h7>Upgrading from the latest version of <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code><a class="headerlink" href="#upgrading-from-the-latest-version-of-buildbot-slave-to-buildbot-worker" title="Permalink to this headline">¶</a></h7>
<p>If the loss of cached worker state (e.g., for Source steps in copy mode) is not problematic, the easiest solution is to simply delete the worker directory and re-run <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code>.</p>
<p>If deleting the worker directory is problematic, you can change <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> in the following way:</p>
<ol class="arabic">
<li><p class="first">Replace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildslave.bot</span> <span class="k">import</span> <span class="n">BuildSlave</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot_worker.bot</span> <span class="k">import</span> <span class="n">Worker</span>
</pre></div>
</div>
</li>
<li><p class="first">Replace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="s1">&#39;buildslave&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">application</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">Application</span><span class="p">(</span><span class="s1">&#39;buildbot-worker&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Replace:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">BuildSlave</span><span class="p">(</span><span class="n">buildmaster_host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">slavename</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span>
               <span class="n">keepalive</span><span class="p">,</span> <span class="n">usepty</span><span class="p">,</span> <span class="n">umask</span><span class="o">=</span><span class="n">umask</span><span class="p">,</span> <span class="n">maxdelay</span><span class="o">=</span><span class="n">maxdelay</span><span class="p">,</span>
               <span class="n">numcpus</span><span class="o">=</span><span class="n">numcpus</span><span class="p">,</span> <span class="n">allow_shutdown</span><span class="o">=</span><span class="n">allow_shutdown</span><span class="p">)</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">(</span><span class="n">buildmaster_host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">slavename</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span>
           <span class="n">keepalive</span><span class="p">,</span> <span class="n">umask</span><span class="o">=</span><span class="n">umask</span><span class="p">,</span> <span class="n">maxdelay</span><span class="o">=</span><span class="n">maxdelay</span><span class="p">,</span>
           <span class="n">numcpus</span><span class="o">=</span><span class="n">numcpus</span><span class="p">,</span> <span class="n">allow_shutdown</span><span class="o">=</span><span class="n">allow_shutdown</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>See <a class="reference internal" href="#worker-transition-buildbot-worker"><span class="std std-ref">Transition to “Worker” Terminology</span></a> for details of changes in version Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0</span></code>.</p>
</div>
</div>
</div>
</div>
<span id="document-manual/installation/misc"></span><div class="section" id="next-steps">
<h4>2.2.6. Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this headline">¶</a></h4>
<div class="section" id="launching-the-daemons">
<span id="id1"></span><h5>2.2.6.1. Launching the daemons<a class="headerlink" href="#launching-the-daemons" title="Permalink to this headline">¶</a></h5>
<p>Both the buildmaster and the worker run as daemon programs.
To launch them, pass the working directory to the <strong class="command">buildbot</strong> and <strong class="command">buildbot-worker</strong> commands, as appropriate:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># start a master</span>
buildbot start <span class="o">[</span> BASEDIR <span class="o">]</span>
<span class="c1"># start a worker</span>
buildbot-worker start <span class="o">[</span> WORKER_BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>The <em>BASEDIR</em> is option and can be omitted if the current directory contains the buildbot configuration (the <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot start
</pre></div>
</div>
<p>This command will start the daemon and then return, so normally it will not produce any output.
To verify that the programs are indeed running, look for a pair of files named <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> and <code class="file docutils literal notranslate"><span class="pre">twistd.pid</span></code> that should be created in the working directory.
<code class="file docutils literal notranslate"><span class="pre">twistd.pid</span></code> contains the process ID of the newly-spawned daemon.</p>
<p>When the worker connects to the buildmaster, new directories will start appearing in its base directory.
The buildmaster tells the worker to create a directory for each Builder which will be using that worker.
All build operations are performed within these directories: CVS checkouts, compiles, and tests.</p>
<p>Once you get everything running, you will want to arrange for the buildbot daemons to be started at boot time.
One way is to use <strong class="command">cron</strong>, by putting them in a <code class="docutils literal notranslate"><span class="pre">&#64;reboot</span></code> crontab entry <a class="footnote-reference" href="#f1" id="id2">[1]</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@reboot buildbot start [ BASEDIR ]
</pre></div>
</div>
<p>When you run <strong class="command">crontab</strong> to set this up, remember to do it as the buildmaster or worker account!
If you add this to your crontab when running as your regular account (or worse yet, root), then the daemon will run as the wrong user, quite possibly as one with more authority than you intended to provide.</p>
<p>It is important to remember that the environment provided to cron jobs and init scripts can be quite different that your normal runtime.
There may be fewer environment variables specified, and the <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> may be shorter than usual.
It is a good idea to test out this method of launching the worker by using a cron job with a time in the near future, with the same command, and then check <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> to make sure the worker actually started correctly.
Common problems here are for <code class="file docutils literal notranslate"><span class="pre">/usr/local</span></code> or <code class="file docutils literal notranslate"><span class="pre">~/bin</span></code> to not be on your <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>, or for <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> to not be set correctly.
Sometimes <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">HOME</span></code> is messed up too.</p>
<p>Some distributions may include conveniences to make starting buildbot at boot time easy.
For instance, with the default buildbot package in Debian-based distributions, you may only need to modify <code class="file docutils literal notranslate"><span class="pre">/etc/default/buildbot</span></code> (see also <code class="file docutils literal notranslate"><span class="pre">/etc/init.d/buildbot</span></code>, which reads the configuration in <code class="file docutils literal notranslate"><span class="pre">/etc/default/buildbot</span></code>).</p>
<p>Buildbot also comes with its own init scripts that provide support for controlling multi-worker and multi-master setups (mostly because they are based on the init script from the Debian package).
With a little modification these scripts can be used both on Debian and RHEL-based distributions and may thus prove helpful to package maintainers who are working on buildbot (or those that haven’t yet split buildbot into master and worker packages).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># install as /etc/default/buildbot-worker</span>
<span class="c1">#         or /etc/sysconfig/buildbot-worker</span>
worker/contrib/init-scripts/buildbot-worker.default

<span class="c1"># install as /etc/default/buildmaster</span>
<span class="c1">#         or /etc/sysconfig/buildmaster</span>
master/contrib/init-scripts/buildmaster.default

<span class="c1"># install as /etc/init.d/buildbot-worker</span>
worker/contrib/init-scripts/buildbot-worker.init.sh

<span class="c1"># install as /etc/init.d/buildmaster</span>
master/contrib/init-scripts/buildmaster.init.sh

<span class="c1"># ... and tell sysvinit about them</span>
chkconfig buildmaster reset
<span class="c1"># ... or</span>
update-rc.d buildmaster defaults
</pre></div>
</div>
</div>
<div class="section" id="logfiles">
<span id="id3"></span><h5>2.2.6.2. Logfiles<a class="headerlink" href="#logfiles" title="Permalink to this headline">¶</a></h5>
<p>While a buildbot daemon runs, it emits text to a logfile, named <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code>.
A command like <code class="docutils literal notranslate"><span class="pre">tail</span> <span class="pre">-f</span> <span class="pre">twistd.log</span></code> is useful to watch the command output as it runs.</p>
<p>The buildmaster will announce any errors with its configuration file in the logfile, so it is a good idea to look at the log at startup time to check for any problems.
Most buildmaster activities will cause lines to be added to the log.</p>
</div>
<div class="section" id="shutdown">
<span id="id4"></span><h5>2.2.6.3. Shutdown<a class="headerlink" href="#shutdown" title="Permalink to this headline">¶</a></h5>
<p>To stop a buildmaster or worker manually, use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot stop <span class="o">[</span> BASEDIR <span class="o">]</span>
<span class="c1"># or</span>
buildbot-worker stop <span class="o">[</span> WORKER_BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>This simply looks for the <code class="file docutils literal notranslate"><span class="pre">twistd.pid</span></code> file and kills whatever process is identified within.</p>
<p>At system shutdown, all processes are sent a <code class="docutils literal notranslate"><span class="pre">SIGKILL</span></code>.
The buildmaster and worker will respond to this by shutting down normally.</p>
<p>The buildmaster will respond to a <code class="docutils literal notranslate"><span class="pre">SIGHUP</span></code> by re-reading its config file.
Of course, this only works on Unix-like systems with signal support, and won’t work on Windows.
The following shortcut is available:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot reconfig <span class="o">[</span> BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>When you update the Buildbot code to a new release, you will need to restart the buildmaster and/or worker before it can take advantage of the new code.
You can do a <code class="samp docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">stop</span> <em><span class="pre">BASEDIR</span></em></code> and <code class="samp docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">start</span> <em><span class="pre">BASEDIR</span></em></code> in quick succession, or you can use the <code class="docutils literal notranslate"><span class="pre">restart</span></code> shortcut, which does both steps for you:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot restart <span class="o">[</span> BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>Workers can similarly be restarted with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot-worker restart <span class="o">[</span> BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>There are certain configuration changes that are not handled cleanly by <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">reconfig</span></code>.
If this occurs, <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">restart</span></code> is a more robust tool to fully switch over to the new configuration.</p>
<p><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">restart</span></code> may also be used to start a stopped Buildbot instance.
This behaviour is useful when writing scripts that stop, start and restart Buildbot.</p>
<p>A worker may also be gracefully shutdown from the web UI.
This is useful to shutdown a worker without interrupting any current builds.
The buildmaster will wait until the worker is finished all its current builds, and will then tell the worker to shutdown.</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>This <code class="docutils literal notranslate"><span class="pre">&#64;reboot</span></code> syntax is understood by Vixie cron, which is the flavor usually provided with Linux systems.
Other unices may have a cron that doesn’t understand <code class="docutils literal notranslate"><span class="pre">&#64;reboot</span></code></td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<span id="document-manual/concepts"></span><div class="section" id="concepts">
<h3>2.3. Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h3>
<p>This chapter defines some of the basic concepts that the Buildbot uses.
You’ll need to understand how the Buildbot sees the world to configure it properly.</p>
<div class="section" id="source-stamps">
<span id="id1"></span><h4>2.3.1. Source Stamps<a class="headerlink" href="#source-stamps" title="Permalink to this headline">¶</a></h4>
<p>Buildbot uses the concept of <em>source stamp set</em> to identify exact source code that needs to be built for a certain project.
A <em>source stamp set</em> is a collection of one or more source stamps.</p>
<p>A <em>source stamp</em> is a collection of information needed to identify a particular version of code on a certain codebase. This information most often is a revision and possibly a branch.</p>
<p>A <em>codebase</em> is a collection of related files and their history tracked as a unit by version control systems.
A single codebase may appear in multiple repositories which themselves are identified by URLs.
For example, <code class="docutils literal notranslate"><span class="pre">https://github.com/mozilla/mozilla-central</span></code> and <code class="docutils literal notranslate"><span class="pre">http://hg.mozilla.org/mozilla-release</span></code> both contain the Firefox codebase, although not exactly the same code.</p>
<p>A <em>project</em> is corresponds to a set of one or more codebases that together may be built and produce some end artifact.
For example, a company may build several applications based on the same core library.
The “app” codebase and the “core” codebase are in separate repositories, but are compiled together and constitute a single project.
Changes to either codebase should cause a rebuild of the application.</p>
<p>A <em>revision</em> is an identifier used by most version control systems to uniquely specify a particular version of the source code.
Sometimes in order to do that a revision may make sense only if used combination with a <em>branch</em>.</p>
<p>To sum up the above, to build a project, Buildbot needs to know exactly which version of each codebase it should build.
It uses a <em>source stamp</em> to do so for each codebase, each of which assigns informs Buildbot that it should use a specific <em>revision</em> from that codebase.
Collectively these source stamps are called <em>source stamp set</em> for each project.</p>
<img alt="Source Stamp Sets" src="_images/changes.svg" /></div>
<div class="section" id="version-control-systems">
<span id="id2"></span><h4>2.3.2. Version Control Systems<a class="headerlink" href="#version-control-systems" title="Permalink to this headline">¶</a></h4>
<p>Buildbot supports a significant number of version control systems, so it treats them abstractly.</p>
<p>For purposes of deciding when to perform builds, Buildbot’s change sources monitor repositories, and represent any updates to those repositories as <em>changes</em>.
These change sources fall broadly into two categories: pollers which periodically check the repository for updates; and hooks, where the repository is configured to notify Buildbot whenever an update occurs.
For more information see <a class="reference internal" href="#change-sources"><span class="std std-ref">Change Sources and Changes</span></a> and <a class="reference internal" href="#how-different-vc-systems-specify-sources"><span class="std std-ref">How Different VC Systems Specify Sources</span></a>.</p>
<p>When it comes time to actually perform a build, a scheduler prepares a source stamp set, as described above, based on its configuration.
When the build begins, one or more source steps use the information in the source stamp set to actually check out the source code, using the normal VCS commands.</p>
</div>
<div class="section" id="changes">
<span id="concept-changes"></span><h4>2.3.3. Changes<a class="headerlink" href="#changes" title="Permalink to this headline">¶</a></h4>
<p>A <a class="reference internal" href="#change-attrs"><span class="std std-ref">Change</span></a> is an abstract way Buildbot uses to represent a single change to the source files performed by a developer.
In version control systems that support the notion of atomic check-ins a change represents a changeset or commit.</p>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> comprises of the following information:</p>
<blockquote>
<div><ul class="simple">
<li>the developer that is responsible for the change</li>
<li>the list of files that the change added, removed or modified</li>
<li>the message of the commit</li>
<li>the repository, the codebase and the project that the change corresponds to</li>
<li>the revision and the branch of the commit</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="scheduling-builds">
<span id="id3"></span><h4>2.3.4. Scheduling Builds<a class="headerlink" href="#scheduling-builds" title="Permalink to this headline">¶</a></h4>
<p>Each Buildmaster has a set of scheduler objects, each of which gets a copy of every incoming <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>.
The Schedulers are responsible for deciding when <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s should be run.
Some Buildbot installations might have a single scheduler, while others may have several, each for a different purpose.</p>
<p>For example, a <em>quick</em> scheduler might exist to give immediate feedback to developers, hoping to catch obvious problems in the code that can be detected quickly.
These typically do not run the full test suite, nor do they run on a wide variety of platforms.
They also usually do a VC update rather than performing a brand-new checkout each time.</p>
<p>A separate <em>full</em> scheduler might run more comprehensive tests, to catch more subtle problems.
configured to run after the quick scheduler, to give developers time to commit fixes to bugs caught by the quick scheduler before running the comprehensive tests.
This scheduler would also feed multiple <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s.</p>
<p>Many schedulers can be configured to wait a while after seeing a source-code change - this is the <em>tree stable timer</em>.
The timer allows multiple commits to be “batched” together.
This is particularly useful in distributed version control systems, where a developer may push a long sequence of changes all at once.
To save resources, it’s often desirable only to test the most recent change.</p>
<p>Schedulers can also filter out the changes they are interested in, based on a number of criteria.
For example, a scheduler that only builds documentation might skip any changes that do not affect the documentation.
Schedulers can also filter on the branch to which a commit was made.</p>
<p>There is some support for configuring dependencies between builds - for example, you may want to build packages only for revisions which pass all of the unit tests.
This support is under active development in Buildbot, and is referred to as “build coordination”.</p>
<p>Periodic builds (those which are run every N seconds rather than after new Changes arrive) are triggered by a special <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a> scheduler.</p>
<p>Each scheduler creates and submits <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code> objects to the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code>, which is then responsible for making sure the individual <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequests</span></code> are delivered to the target <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s.</p>
<p>Scheduler instances are activated by placing them in the <a class="reference internal" href="#cfg-schedulers" title="schedulers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">schedulers</span></code></a> list in the buildmaster config file.
Each scheduler must have a unique name.</p>
</div>
<div class="section" id="buildsets">
<span id="buildset"></span><h4>2.3.5. BuildSets<a class="headerlink" href="#buildsets" title="Permalink to this headline">¶</a></h4>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code> is the name given to a set of <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s that all compile/test the same version of the tree on multiple <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s.
In general, all these component <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s will perform the same sequence of <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code>s, using the same source code, but on different platforms or against a different set of libraries.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code> is tracked as a single unit, which fails if any of the component <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s have failed, and therefore can succeed only if <em>all</em> of the component <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s have succeeded.
There are two kinds of status notification messages that can be emitted for a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code>: the <code class="docutils literal notranslate"><span class="pre">firstFailure</span></code> type (which fires as soon as we know the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code> will fail), and the <code class="docutils literal notranslate"><span class="pre">Finished</span></code> type (which fires once the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code> has completely finished, regardless of whether the overall set passed or failed).</p>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code> is created with set of one or more <em>source stamp</em> tuples of <code class="docutils literal notranslate"><span class="pre">(branch,</span> <span class="pre">revision,</span> <span class="pre">changes,</span> <span class="pre">patch)</span></code>, some of which may be <code class="docutils literal notranslate"><span class="pre">None</span></code>, and a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s on which it is to be run.
They are then given to the BuildMaster, which is responsible for creating a separate <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> for each <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.</p>
<p>There are a couple of different likely values for the <code class="docutils literal notranslate"><span class="pre">SourceStamp</span></code>:</p>
<dl class="docutils">
<dt><code class="samp docutils literal notranslate"><span class="pre">(revision=None,</span> <span class="pre">changes=</span><em><span class="pre">CHANGES</span></em><span class="pre">,</span> <span class="pre">patch=None)</span></code></dt>
<dd>This is a <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code> used when a series of <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s have triggered a build.
The VC step will attempt to check out a tree that contains <em>CHANGES</em> (and any changes that occurred before <em>CHANGES</em>, but not any that occurred after them.)</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">(revision=None,</span> <span class="pre">changes=None,</span> <span class="pre">patch=None)</span></code></dt>
<dd>This builds the most recent code on the default branch.
This is the sort of <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code> that would be used on a <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> that was triggered by a user request, or a <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a> scheduler.
It is also possible to configure the VC Source Step to always check out the latest sources rather than paying attention to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s in the <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code>, which will result in same behavior as this.</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">(branch=</span><em><span class="pre">BRANCH</span></em><span class="pre">,</span> <span class="pre">revision=None,</span> <span class="pre">changes=None,</span> <span class="pre">patch=None)</span></code></dt>
<dd>This builds the most recent code on the given <em>BRANCH</em>.
Again, this is generally triggered by a user request or a <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a> scheduler.</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">(revision=</span><em><span class="pre">REV</span></em><span class="pre">,</span> <span class="pre">changes=None,</span> <span class="pre">patch=(</span><em><span class="pre">LEVEL</span></em><span class="pre">,</span> <em><span class="pre">DIFF</span></em><span class="pre">,</span> <em><span class="pre">SUBDIR_ROOT</span></em><span class="pre">))</span></code></dt>
<dd>This checks out the tree at the given revision <em>REV</em>, then applies a patch (using <code class="docutils literal notranslate"><span class="pre">patch</span> <span class="pre">-pLEVEL</span> <span class="pre">&lt;DIFF</span></code>) from inside the relative directory <em>SUBDIR_ROOT</em>.
Item <em>SUBDIR_ROOT</em> is optional and defaults to the builder working directory.
The <a class="reference internal" href="#cmdline-try" title="try"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">try</span></code></a> command creates this kind of <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code>.
If <code class="docutils literal notranslate"><span class="pre">patch</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, the patching step is bypassed.</dd>
</dl>
<p>The buildmaster is responsible for turning the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code> into a set of <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> objects and queueing them on the appropriate <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s.</p>
</div>
<div class="section" id="buildrequests">
<span id="buildrequest"></span><h4>2.3.6. BuildRequests<a class="headerlink" href="#buildrequests" title="Permalink to this headline">¶</a></h4>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> is a request to build a specific set of source code (specified by one or more source stamps) on a single <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.
Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> runs the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> as soon as it can (i.e. when an associated worker becomes free).
<code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code>s are prioritized from oldest to newest, so when a worker becomes free, the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> with the oldest <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> is run.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> contains one <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code> specification per codebase.
The actual process of running the build (the series of <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code>s that will be executed) is implemented by the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> object.
In the future this might be changed, to have the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> define <em>what</em> gets built, and a separate <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildProcess</span></code> (provided by the Builder) to define <em>how</em> it gets built.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> may be mergeable with other compatible <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code>s.
Builds that are triggered by incoming <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s will generally be mergeable.
Builds that are triggered by user requests are generally not, unless they are multiple requests to build the <em>latest sources</em> of the same branch.
A merge of buildrequests is performed per codebase, thus on changes having the same codebase.</p>
</div>
<div class="section" id="builders">
<span id="builder"></span><h4>2.3.7. Builders<a class="headerlink" href="#builders" title="Permalink to this headline">¶</a></h4>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> handles the process of scheduling work to workers.
Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> is responsible for a certain type of build, which usually consist of identical or very similar sequence of steps.</p>
<p>The class serves as a kind of queue for that particular type of build.
In general, each <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> runs independently, but it’s possible to constrain the behavior of <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s using various kinds of interlocks.</p>
<p>Each builder is a long-lived object which controls a sequence of <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s.
A <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> is created when the config file is first parsed, and lives forever (or rather until it is removed from the config file).
It mediates the connections to the workers that do all the work, and is responsible for creating the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> objects - <a class="reference internal" href="#concepts-build"><span class="std std-ref">Builds</span></a>.</p>
<p>Each builder gets a unique name, and the path name of a directory where it gets to do all its work.
This path is used in two ways.
On the buildmaster-side a directory is created for keeping status information.
On the worker-side a directory is created where the actual checkout, compile and test commands are executed.</p>
</div>
<div class="section" id="build-factories">
<span id="concepts-build-factories"></span><h4>2.3.8. Build Factories<a class="headerlink" href="#build-factories" title="Permalink to this headline">¶</a></h4>
<p>A builder also has a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code>, which is responsible for creating new <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> instances: because the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> instance is what actually performs each build, choosing the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> is the way to specify what happens each time a build is done (<a class="reference internal" href="#concepts-build"><span class="std std-ref">Builds</span></a>).</p>
</div>
<div class="section" id="workers">
<span id="concepts-workers"></span><h4>2.3.9. Workers<a class="headerlink" href="#workers" title="Permalink to this headline">¶</a></h4>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>s corresponds to an environment where builds are executed.
A single physical machine that must run at least one <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>s in order for Buildbot to be able to utilize it for running builds.
Multiple <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>s may run on a single machine to provide different environments that can reuse the same hardware by means of containers or virtual machines.</p>
<p>Each builder is associated with one or more <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>s.
For example, a builder which is used to perform macOS builds (as opposed to Linux or Windows builds) should naturally be associated with a Mac worker.</p>
<p>If multiple workers are available for any given builder, you will have some measure of redundancy: in case one worker goes offline, the others can still keep the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> working.
In addition, multiple workers will allow multiple simultaneous builds for the same <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>, which might be useful if you have a lot of forced or <code class="docutils literal notranslate"><span class="pre">try</span></code> builds taking place.</p>
<p>Ideally, each <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> that is configured for a builder should be identical.
Otherwise build or test failures will be dependent on which worker the build is ran and this will complicate investigation of failures.</p>
</div>
<div class="section" id="builds">
<span id="concepts-build"></span><h4>2.3.10. Builds<a class="headerlink" href="#builds" title="Permalink to this headline">¶</a></h4>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> is a single compile or test run of a particular version of the source code, and is comprised of a series of steps.
The steps may be arbitrary. For example, for compiled software a build generally consists of the checkout, configure, make, and make check sequence.
For interpreted projects like Python modules, a build is generally a checkout followed by an invocation of the bundled test suite.</p>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> describes the steps a build will perform.
The builder which starts a build uses its configured build factory to determine the build’s steps.</p>
</div>
<div class="section" id="users">
<span id="concepts-users"></span><h4>2.3.11. Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h4>
<p>Buildbot has a somewhat limited awareness of <em>users</em>.
It assumes the world consists of a set of developers, each of whom can be described by a couple of simple attributes.
These developers make changes to the source code, causing builds which may succeed or fail.</p>
<p>Users also may have different levels of authorization when issuing Buildbot commands, such as forcing a build from the web interface or from an IRC channel.</p>
<p>Each developer is primarily known through the source control system.
Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> object that arrives is tagged with a <code class="xref py py-attr docutils literal notranslate"><span class="pre">who</span></code> field that typically gives the account name (on the repository machine) of the user responsible for that change.
This string is displayed on the HTML status pages and in each <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>’s <em>blamelist</em>.</p>
<p>To do more with the User than just refer to them, this username needs to be mapped into an address of some sort.
The responsibility for this mapping is left up to the status module which needs the address.
In the future, the responsibility for managing users will be transferred to User Objects.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">who</span></code> fields in <code class="docutils literal notranslate"><span class="pre">git</span></code> Changes are used to create <a class="reference internal" href="#user-objects"><span class="std std-ref">User Objects</span></a>, which allows for more control and flexibility in how Buildbot manages users.</p>
<div class="section" id="user-objects">
<span id="id4"></span><h5>2.3.11.1. User Objects<a class="headerlink" href="#user-objects" title="Permalink to this headline">¶</a></h5>
<p>User Objects allow Buildbot to better manage users throughout its various interactions with users (see <a class="reference internal" href="#change-sources"><span class="std std-ref">Change Sources and Changes</span></a> and <a class="reference internal" href="#reporters"><span class="std std-ref">Reporters</span></a>).
The User Objects are stored in the Buildbot database and correlate the various attributes that a user might have: irc, Git, etc.</p>
<div class="section" id="id5">
<h6>Changes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h6>
<p>Incoming Changes all have a <code class="docutils literal notranslate"><span class="pre">who</span></code> attribute attached to them that specifies which developer is responsible for that Change.
When a Change is first rendered, the <code class="docutils literal notranslate"><span class="pre">who</span></code> attribute is parsed and added to the database if it doesn’t exist or checked against an existing user.
The <code class="docutils literal notranslate"><span class="pre">who</span></code> attribute is formatted in different ways depending on the version control system that the Change came from.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">git</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">who</span></code> attributes take the form <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Name</span> <span class="pre">&lt;Email&gt;</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">svn</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">who</span></code> attributes are of the form <code class="docutils literal notranslate"><span class="pre">Username</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hg</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">who</span></code> attributes are free-form strings, but usually adhere to similar conventions as <code class="docutils literal notranslate"><span class="pre">git</span></code> attributes (<code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Name</span> <span class="pre">&lt;Email&gt;</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cvs</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">who</span></code> attributes are of the form <code class="docutils literal notranslate"><span class="pre">Username</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">darcs</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">who</span></code> attributes contain an <code class="docutils literal notranslate"><span class="pre">Email</span></code> and may also include a <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Name</span></code> like <code class="docutils literal notranslate"><span class="pre">git</span></code> attributes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bzr</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">who</span></code> attributes are free-form strings like <code class="docutils literal notranslate"><span class="pre">hg</span></code>, and can include a <code class="docutils literal notranslate"><span class="pre">Username</span></code>, <code class="docutils literal notranslate"><span class="pre">Email</span></code>, and/or <code class="docutils literal notranslate"><span class="pre">Full</span> <span class="pre">Name</span></code>.</dd>
</dl>
</div>
<div class="section" id="tools">
<h6>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h6>
<p>For managing users manually, use the <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">user</span></code> command, which allows you to add, remove, update, and show various attributes of users in the Buildbot database (see <a class="reference internal" href="#command-line-tool"><span class="std std-ref">Command-line Tool</span></a>).</p>
</div>
<div class="section" id="uses">
<h6>Uses<a class="headerlink" href="#uses" title="Permalink to this headline">¶</a></h6>
<p>Correlating the various bits and pieces that Buildbot views as users also means that one attribute of a user can be translated into another.
This provides a more complete view of users throughout Buildbot.</p>
<p>One such use is being able to find email addresses based on a set of Builds to notify users through the <code class="docutils literal notranslate"><span class="pre">MailNotifier</span></code>.
This process is explained more clearly in <a class="reference internal" href="#email-addresses"><span class="std std-ref">Email Addresses</span></a>.</p>
<p>Another way to utilize <cite>User Objects</cite> is through <cite>UsersAuth</cite> for web authentication.
To use <cite>UsersAuth</cite>, you need to set a <cite>bb_username</cite> and <cite>bb_password</cite> via the <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">user</span></code> command line tool to check against.
The password will be encrypted before storing in the database along with other user attributes.</p>
</div>
</div>
<div class="section" id="doing-things-with-users">
<span id="id6"></span><h5>2.3.11.2. Doing Things With Users<a class="headerlink" href="#doing-things-with-users" title="Permalink to this headline">¶</a></h5>
<p>Each change has a single user who is responsible for it.
Most builds have a set of changes: the build generally represents the first time these changes have been built and tested by the Buildbot.
The build has a <em>blamelist</em> that is the union of the users responsible for all the build’s changes.
If the build was created by a <a class="reference internal" href="#try-schedulers"><span class="std std-ref">Try Schedulers</span></a> this list will include the submitter of the try job, if known.</p>
<p>The build provides a list of users who are interested in the build – the <em>interested users</em>.
Usually this is equal to the blamelist, but may also be expanded, e.g., to include the current build sherrif or a module’s maintainer.</p>
<p>If desired, the buildbot can notify the interested users until the problem is resolved.</p>
</div>
<div class="section" id="email-addresses">
<span id="id7"></span><h5>2.3.11.3. Email Addresses<a class="headerlink" href="#email-addresses" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> is a status target which can send email about the results of each build.
It accepts a static list of email addresses to which each message should be delivered, but it can also be configured to send mail to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>’s Interested Users.
To do this, it needs a way to convert User names into email addresses.</p>
<p>For many VC systems, the User Name is actually an account name on the system which hosts the repository.
As such, turning the name into an email address is a simple matter of appending <code class="docutils literal notranslate"><span class="pre">&#64;repositoryhost.com</span></code>.
Some projects use other kinds of mappings (for example the preferred email address may be at <code class="docutils literal notranslate"><span class="pre">project.org</span></code> despite the repository host being named <code class="docutils literal notranslate"><span class="pre">cvs.project.org</span></code>), and some VC systems have full separation between the concept of a user and that of an account on the repository host (like Perforce).
Some systems (like Git) put a full contact email address in every change.</p>
<p>To convert these names to addresses, the <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> uses an <code class="xref py py-class docutils literal notranslate"><span class="pre">EmailLookup</span></code> object.
This provides a <code class="xref py py-meth docutils literal notranslate"><span class="pre">getAddress</span></code> method which accepts a name and (eventually) returns an address.
The default <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> module provides an <code class="xref py py-class docutils literal notranslate"><span class="pre">EmailLookup</span></code> which simply appends a static string, configurable when the notifier is created.
To create more complex behaviors (perhaps using an LDAP lookup, or using <code class="docutils literal notranslate"><span class="pre">finger</span></code> on a central host to determine a preferred address for the developer), provide a different object as the <code class="docutils literal notranslate"><span class="pre">lookup</span></code> argument.</p>
<p>If an EmailLookup object isn’t given to the MailNotifier, the MailNotifier will try to find emails through <a class="reference internal" href="#user-objects"><span class="std std-ref">User Objects</span></a>.
This will work the same as if an EmailLookup object was used if every user in the Build’s Interested Users list has an email in the database for them.
If a user whose change led to a Build doesn’t have an email attribute, that user will not receive an email.
If <code class="docutils literal notranslate"><span class="pre">extraRecipients</span></code> is given, those users are still sent mail when the EmailLookup object is not specified.</p>
<p>In the future, when the Problem mechanism has been set up, the Buildbot will need to send mail to arbitrary Users.
It will do this by locating a <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code>-like object among all the buildmaster’s status targets, and asking it to send messages to various Users.
This means the User-to-address mapping only has to be set up once, in your <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code>, and every email message the buildbot emits will take advantage of it.</p>
</div>
<div class="section" id="irc-nicknames">
<span id="id8"></span><h5>2.3.11.4. IRC Nicknames<a class="headerlink" href="#irc-nicknames" title="Permalink to this headline">¶</a></h5>
<p>Like <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code>, the <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.status.words.IRC</span></code> class provides a status target which can announce the results of each build.
It also provides an interactive interface by responding to online queries posted in the channel or sent as private messages.</p>
<p>In the future, the buildbot can be configured to map User names to IRC nicknames, to watch for the recent presence of these nicknames, and to deliver build status messages to the interested parties.
Like <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> does for email addresses, the <code class="xref py py-class docutils literal notranslate"><span class="pre">IRC</span></code> object will have an <code class="xref py py-class docutils literal notranslate"><span class="pre">IRCLookup</span></code> which is responsible for nicknames.
The mapping can be set up statically, or it can be updated by online users themselves (by claiming a username with some kind of <code class="docutils literal notranslate"><span class="pre">buildbot:</span> <span class="pre">i</span> <span class="pre">am</span> <span class="pre">user</span> <span class="pre">warner</span></code> commands).</p>
<p>Once the mapping is established, the rest of the buildbot can ask the <code class="xref py py-class docutils literal notranslate"><span class="pre">IRC</span></code> object to send messages to various users.
It can report on the likelihood that the user saw the given message (based upon how long the user has been inactive on the channel), which might prompt the Problem Hassler logic to send them an email message instead.</p>
<p>These operations and authentication of commands issued by particular nicknames will be implemented in <a class="reference internal" href="#user-objects"><span class="std std-ref">User Objects</span></a>.</p>
</div>
</div>
<div class="section" id="build-properties">
<span id="index-0"></span><span id="id9"></span><h4>2.3.12. Build Properties<a class="headerlink" href="#build-properties" title="Permalink to this headline">¶</a></h4>
<p>Each build has a set of <em>Build Properties</em>, which can be used by its build steps to modify their actions.
These properties, in the form of key-value pairs, provide a general framework for dynamically altering the behavior of a build based on its circumstances.</p>
<p>Properties form a simple kind of variable in a build.
Some properties are set when the build starts, and properties can be changed as a build progresses – properties set or changed in one step may be accessed in subsequent steps.
Property values can be numbers, strings, lists, or dictionaries - basically, anything that can be represented in JSON.</p>
<p>Properties are very flexible, and can be used to implement all manner of functionality.
Here are some examples:</p>
<p>Most Source steps record the revision that they checked out in the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property.
A later step could use this property to specify the name of a fully-built tarball, dropped in an easily-accessible directory for later testing.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In builds with more than one codebase, the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property is a dictionary, keyed by codebase.</p>
</div>
<p>Some projects want to perform nightly builds as well as building in response to committed changes.
Such a project would run two schedulers, both pointing to the same set of builders, but could provide an <code class="docutils literal notranslate"><span class="pre">is_nightly</span></code> property so that steps can distinguish the nightly builds, perhaps to run more resource-intensive tests.</p>
<p>Some projects have different build processes on different systems.
Rather than create a build factory for each worker, the steps can use worker properties to identify the unique aspects of each worker and adapt the build process dynamically.</p>
</div>
<div class="section" id="multiple-codebase-builds">
<span id="id10"></span><h4>2.3.13. Multiple-Codebase Builds<a class="headerlink" href="#multiple-codebase-builds" title="Permalink to this headline">¶</a></h4>
<p>What if an end-product is composed of code from several codebases?
Changes may arrive from different repositories within the tree-stable-timer period.
Buildbot will not only use the source-trees that contain changes but also needs the remaining source-trees to build the complete product.</p>
<p>For this reason a <a class="reference internal" href="#scheduling-builds"><span class="std std-ref">Scheduler</span></a> can be configured to base a build on a set of several source-trees that can (partly) be overridden by the information from incoming <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s.</p>
<p>As described <a class="reference internal" href="#source-stamps"><span class="std std-ref">above</span></a>, the source for each codebase is identified by a source stamp, containing its repository, branch and revision.
A full build set will specify a source stamp set describing the source to use for each codebase.</p>
<p>Configuring all of this takes a coordinated approach.  A complete multiple repository configuration consists of:</p>
<p>a <em>codebase generator</em></p>
<blockquote>
<div>Every relevant change arriving from a VC must contain a codebase.
This is done by a <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">codebaseGenerator</span></code></a> that is defined in the configuration.
Most generators examine the repository of a change to determine its codebase, using project-specific rules.</div></blockquote>
<p>some <em>schedulers</em></p>
<blockquote>
<div>Each <a class="reference internal" href="#cfg-schedulers" title="schedulers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">scheduler</span></code></a> has to be configured with a set of all required <code class="docutils literal notranslate"><span class="pre">codebases</span></code> to build a product.
These codebases indicate the set of required source-trees.
In order for the scheduler to be able to produce a complete set for each build, the configuration can give a default repository, branch, and revision for each codebase.
When a scheduler must generate a source stamp for a codebase that has received no changes, it applies these default values.</div></blockquote>
<p>multiple <em>source steps</em> - one for each codebase</p>
<blockquote>
<div><p>A <a class="reference internal" href="#builder"><span class="std std-ref">Builders</span></a>’s build factory must include a <a class="reference internal" href="#source-checkout"><span class="std std-ref">source step</span></a> for each codebase.
Each of the source steps has a <code class="docutils literal notranslate"><span class="pre">codebase</span></code> attribute which is used to select an appropriate source stamp from the source stamp set for a build.
This information comes from the arrived changes or from the scheduler’s configured default values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Each <a class="reference internal" href="#source-checkout"><span class="std std-ref">source step</span></a> has to have its own <code class="docutils literal notranslate"><span class="pre">workdir</span></code> set in order for the checkout to be done for each codebase in its own directory.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ensure you specify the codebase within your source step’s Interpolate() calls (ex. <code class="docutils literal notranslate"><span class="pre">http://.../svn/%(src:codebase:branch)s)</span></code>.
See <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> for details.</p>
</div>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Defining a <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">codebaseGenerator</span></code></a> that returns non-empty (not <code class="docutils literal notranslate"><span class="pre">''</span></code>) codebases will change the behavior of all the schedulers.</p>
</div>
</div>
<div class="section" id="multimaster">
<span id="id11"></span><h4>2.3.14. Multimaster<a class="headerlink" href="#multimaster" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Buildbot Multimaster is considered experimental.
There are still some companies using it in production.
Don’t hesitate to use the mailing lists to share your experience.</p>
</div>
<div><svg height="520" viewBox="0 0 832 520" width="832" xmlns="http://www.w3.org/2000/svg" xmlns:inkspace="http://www.inkscape.org/namespaces/inkscape" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs id="defs_block">
    <filter height="1.504" id="filter_blur" inkspace:collect="always" width="1.1575" x="-0.07875" y="-0.252">
      <feGaussianBlur id="feGaussianBlur3780" inkspace:collect="always" stdDeviation="4.2" />
    </filter>
  </defs>
  <title>blockdiag</title>
  <desc />
  <ellipse cx="323" cy="66" fill="rgb(0,0,0)" rx="64" ry="20" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <ellipse cx="323" cy="386" fill="rgb(0,0,0)" rx="64" ry="20" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 75 46 L 187 46 A8,8 0 0 1 195 54 L 195 78 A8,8 0 0 1 187 86 L 75 86 A8,8 0 0 1 67 78 L 67 54 A8,8 0 0 1 75 46" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 75 206 L 187 206 A8,8 0 0 1 195 214 L 195 238 A8,8 0 0 1 187 246 L 75 246 A8,8 0 0 1 67 238 L 67 214 A8,8 0 0 1 75 206" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <polygon fill="rgb(0,0,0)" points="133,380 133,383 143,383 143,386 133,386 133,389 141,398 137,398 131,392 125,398 121,398 129,389 129,386 119,386 119,383 129,383 129,380" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <ellipse cx="131" cy="377" fill="rgb(0,0,0)" rx="4" ry="4" stroke="rgb(0,153,204)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <polygon fill="rgb(0,0,0)" points="133,460 133,463 143,463 143,466 133,466 133,469 141,478 137,478 131,472 125,478 121,478 129,469 129,466 119,466 119,463 129,463 129,460" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <ellipse cx="131" cy="457" fill="rgb(0,0,0)" rx="4" ry="4" stroke="rgb(0,153,204)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 459 46 L 571 46 A8,8 0 0 1 579 54 L 579 78 A8,8 0 0 1 571 86 L 459 86 A8,8 0 0 1 451 78 L 451 54 A8,8 0 0 1 459 46" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 459 126 L 571 126 A8,8 0 0 1 579 134 L 579 158 A8,8 0 0 1 571 166 L 459 166 A8,8 0 0 1 451 158 L 451 134 A8,8 0 0 1 459 126" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 459 206 L 571 206 A8,8 0 0 1 579 214 L 579 238 A8,8 0 0 1 571 246 L 459 246 A8,8 0 0 1 451 238 L 451 214 A8,8 0 0 1 459 206" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 459 286 L 571 286 A8,8 0 0 1 579 294 L 579 318 A8,8 0 0 1 571 326 L 459 326 A8,8 0 0 1 451 318 L 451 294 A8,8 0 0 1 459 286" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 651 62 A64,8 0 0 1 779 62 L 779 86 A64,8 0 0 1 651 86 L 651 62" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 647 58 A64,8 0 0 1 775 58 L 775 82 A64,8 0 0 1 647 82 L 647 58" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <path d="M 643 54 A64,8 0 0 1 771 54 L 771 78 A64,8 0 0 1 643 78 L 643 54" fill="rgb(0,0,0)" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="643" y="126" />
  <ellipse cx="320" cy="60" fill="rgb(51,181,229)" rx="64" ry="20" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="320" y="66">LoadBalancer</text>
  <ellipse cx="320" cy="380" fill="rgb(51,181,229)" rx="64" ry="20" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="84" x="320" y="386">LoadBalancerUI</text>
  <path d="M 72 40 L 184 40 A8,8 0 0 1 192 48 L 192 72 A8,8 0 0 1 184 80 L 72 80 A8,8 0 0 1 64 72 L 64 48 A8,8 0 0 1 72 40" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="42" x="128" y="66">Worker1</text>
  <ellipse cx="128" cy="140" fill="rgb(0,153,204)" rx="4" ry="4" stroke="rgb(0,153,204)" />
  <ellipse cx="128" cy="120" fill="rgb(0,153,204)" rx="4" ry="4" stroke="rgb(0,153,204)" />
  <ellipse cx="128" cy="160" fill="rgb(0,153,204)" rx="4" ry="4" stroke="rgb(0,153,204)" />
  <path d="M 72 200 L 184 200 A8,8 0 0 1 192 208 L 192 232 A8,8 0 0 1 184 240 L 72 240 A8,8 0 0 1 64 232 L 64 208 A8,8 0 0 1 72 200" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="42" x="128" y="226">WorkerN</text>
  <polygon fill="rgb(51,181,229)" points="130,374 130,377 140,377 140,380 130,380 130,383 138,392 134,392 128,386 122,392 118,392 126,383 126,380 116,380 116,377 126,377 126,374" stroke="rgb(0,153,204)" />
  <ellipse cx="128" cy="371" fill="rgb(51,181,229)" rx="4" ry="4" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="30" x="128" y="405">User1</text>
  <polygon fill="rgb(51,181,229)" points="130,454 130,457 140,457 140,460 130,460 130,463 138,472 134,472 128,466 122,472 118,472 126,463 126,460 116,460 116,457 126,457 126,454" stroke="rgb(0,153,204)" />
  <ellipse cx="128" cy="451" fill="rgb(51,181,229)" rx="4" ry="4" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="30" x="128" y="485">User2</text>
  <path d="M 456 40 L 568 40 A8,8 0 0 1 576 48 L 576 72 A8,8 0 0 1 568 80 L 456 80 A8,8 0 0 1 448 72 L 448 48 A8,8 0 0 1 456 40" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="42" x="512" y="66">Master1</text>
  <path d="M 456 120 L 568 120 A8,8 0 0 1 576 128 L 576 152 A8,8 0 0 1 568 160 L 456 160 A8,8 0 0 1 448 152 L 448 128 A8,8 0 0 1 456 120" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="42" x="512" y="146">Master2</text>
  <path d="M 456 200 L 568 200 A8,8 0 0 1 576 208 L 576 232 A8,8 0 0 1 568 240 L 456 240 A8,8 0 0 1 448 232 L 448 208 A8,8 0 0 1 456 200" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="54" x="512" y="226">MasterUI1</text>
  <path d="M 456 280 L 568 280 A8,8 0 0 1 576 288 L 576 312 A8,8 0 0 1 568 320 L 456 320 A8,8 0 0 1 448 312 L 448 288 A8,8 0 0 1 456 280" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="54" x="512" y="306">MasterUI2</text>
  <path d="M 648 56 A64,8 0 0 1 776 56 L 776 80 A64,8 0 0 1 648 80 L 648 56" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <path d="M 776 56 A64,8 0 0 1 648 56" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <path d="M 644 52 A64,8 0 0 1 772 52 L 772 76 A64,8 0 0 1 644 76 L 644 52" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <path d="M 772 52 A64,8 0 0 1 644 52" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <path d="M 640 48 A64,8 0 0 1 768 48 L 768 72 A64,8 0 0 1 640 72 L 640 48" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <path d="M 768 48 A64,8 0 0 1 640 48" fill="rgb(51,181,229)" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="48" x="704" y="70">database</text>
  <rect fill="rgb(51,181,229)" height="40" stroke="rgb(0,153,204)" width="128" x="640" y="120" />
  <path d="M 640 120 L 704 136" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 704 136 L 768 120" fill="none" stroke="rgb(0,153,204)" />
  <text fill="rgb(225,245,254)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="66" x="704" y="154">crossbar.io</text>
  <path d="M 384 60 L 440 60" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="447,60 440,56 440,64 447,60" stroke="rgb(0,153,204)" />
  <path d="M 384 60 L 416 60" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 416 60 L 416 140" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 416 140 L 440 140" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="447,140 440,136 440,144 447,140" stroke="rgb(0,153,204)" />
  <path d="M 384 380 L 432 380" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 432 380 L 432 220" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 432 220 L 440 220" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="447,220 440,216 440,224 447,220" stroke="rgb(0,153,204)" />
  <path d="M 384 380 L 432 380" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 432 380 L 432 300" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 432 300 L 440 300" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="447,300 440,296 440,304 447,300" stroke="rgb(0,153,204)" />
  <path d="M 192 60 L 248 60" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="255,60 248,56 248,64 255,60" stroke="rgb(0,153,204)" />
  <path d="M 192 140 L 240 140" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 240 140 L 240 60" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 240 60 L 248 60" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="255,60 248,56 248,64 255,60" stroke="rgb(0,153,204)" />
  <path d="M 192 220 L 240 220" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 240 220 L 240 60" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 240 60 L 248 60" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="255,60 248,56 248,64 255,60" stroke="rgb(0,153,204)" />
  <path d="M 140 380 L 248 380" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="255,380 248,376 248,384 255,380" stroke="rgb(0,153,204)" />
  <path d="M 140 460 L 240 460" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 240 460 L 240 380" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 240 380 L 248 380" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="255,380 248,376 248,384 255,380" stroke="rgb(0,153,204)" />
  <path d="M 576 60 L 632 60" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="639,60 632,56 632,64 639,60" stroke="rgb(0,153,204)" />
  <path d="M 576 60 L 608 60" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 608 60 L 608 140" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 608 140 L 620 140" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 620.0 140.0 A4,4 0 0 1 628.0 140.0" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 628 140 L 632 140" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="639,140 632,136 632,144 639,140" stroke="rgb(0,153,204)" />
  <path d="M 576 140 L 624 140" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 140 L 624 60" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 60 L 632 60" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="639,60 632,56 632,64 639,60" stroke="rgb(0,153,204)" />
  <path d="M 576 140 L 620 140" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 620.0 140.0 A4,4 0 0 1 628.0 140.0" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 628 140 L 632 140" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="639,140 632,136 632,144 639,140" stroke="rgb(0,153,204)" />
  <path d="M 576 220 L 624 220" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 220 L 624 60" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 60 L 632 60" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="639,60 632,56 632,64 639,60" stroke="rgb(0,153,204)" />
  <path d="M 576 220 L 624 220" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 220 L 624 140" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 140 L 632 140" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="639,140 632,136 632,144 639,140" stroke="rgb(0,153,204)" />
  <path d="M 576 300 L 624 300" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 300 L 624 60" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 60 L 632 60" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="639,60 632,56 632,64 639,60" stroke="rgb(0,153,204)" />
  <path d="M 576 300 L 624 300" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 300 L 624 140" fill="none" stroke="rgb(0,153,204)" />
  <path d="M 624 140 L 632 140" fill="none" stroke="rgb(0,153,204)" />
  <polygon fill="rgb(0,153,204)" points="639,140 632,136 632,144 639,140" stroke="rgb(0,153,204)" />
  <rect fill="none" height="220" stroke="rgb(66,139,202)" stroke-width="3" width="144" x="56" y="30" />
  <rect fill="none" height="140" stroke="rgb(66,139,202)" stroke-width="3" width="144" x="56" y="350" />
  <rect fill="none" height="300" stroke="rgb(66,139,202)" stroke-width="3" width="144" x="440" y="30" />
  <rect fill="none" height="140" stroke="rgb(66,139,202)" stroke-width="3" width="144" x="632" y="30" />
</svg>
</div>
<p>Buildbot supports interconnection of several masters.
This has to be done through a multi-master enabled message queue backend.
As of now the only one supported is wamp and crossbar.io.
see <a class="reference internal" href="#mq-specification"><span class="std std-ref">wamp</span></a></p>
<p>There are then several strategy for introducing multimaster in your buildbot infra.
A simple way to say it is by adding the concept of symmetrics and asymmetrics multimaster (like there is SMP and AMP for multi core CPUs)</p>
<p>Symmetric multimaster is when each master share the exact same configuration. They run the same builders, same schedulers, same everything, the only difference is that workers are connected evenly between the masters (by any means (e.g. DNS load balancing, etc)) Symmetric multimaster is good to use to scale buildbot horizontally.</p>
<p>Asymmetric multimaster is when each master have different configuration. Each master may have a specific responsibility (e.g schedulers, set of builder, UI). This was more how you did in 0.8, also because of its own technical limitations. A nice feature of asymmetric multimaster is that you can have the UI only handled by some masters.</p>
<p>Separating the UI from the controlling will greatly help in the performance of the UI, because badly written BuildSteps?? can stall the reactor for several seconds.</p>
<p>The fanciest configuration would probably be a symmetric configuration for everything but the UI.
You would scale the number of UI master according to your number of UI users, and scale the number of engine masters to the number of workers.</p>
<p>Depending on your workload and size of master host, it is probably a good idea to start thinking of multimaster starting from a hundred workers connected.</p>
<p>Multimaster can also be used for high availability, and seamless upgrade of configuration code.
Complex configuration indeed requires sometimes to restart the master to reload custom steps or code, or just to upgrade the upstream buildbot version.</p>
<p>In this case, you will implement following procedure:</p>
<ul class="simple">
<li>Start new master(s) with new code and configuration.</li>
<li>Send a graceful shutdown to the old master(s).</li>
<li>New master(s) will start taking the new jobs, while old master(s) will just finish managing the running builds.</li>
<li>As an old master is finishing the running builds, it will drop the connections from the workers, who will then reconnect automatically, and by the mean of load balancer will get connected to a new master to run new jobs.</li>
</ul>
<p>As buildbot nine has been designed to allow such procedure, it has not been implemented in production yet as we know.
There is probably a new REST api needed in order to graceful shutdown a master, and the details of gracefully dropping the connection to the workers to be sorted out.</p>
</div>
</div>
<span id="document-manual/secretsmanagement"></span><div class="section" id="secret-management">
<span id="secretmanagement"></span><h3>2.4. Secret Management<a class="headerlink" href="#secret-management" title="Permalink to this headline">¶</a></h3>
<div class="section" id="requirements">
<h4>2.4.1. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<p>Buildbot steps might need secrets to execute their actions.
Secrets are used to execute commands or to create authenticated network connections.
Secrets may be a SSH key, a password, or a file content like a wgetrc file or a public SSH key.
To preserve confidentiality, the secrets values must not be printed or logged in the twisted or steps logs.
Secrets must not be stored in the Buildbot configuration (master.cfg), as the source code is usually shared in SCM like git.</p>
</div>
<div class="section" id="how-to-use-buildbot-secret-management">
<h4>2.4.2. How to use Buildbot Secret Management<a class="headerlink" href="#how-to-use-buildbot-secret-management" title="Permalink to this headline">¶</a></h4>
<div class="section" id="secrets-and-providers">
<h5>2.4.2.1. Secrets and providers<a class="headerlink" href="#secrets-and-providers" title="Permalink to this headline">¶</a></h5>
<p>Buildbot implements several providers for secrets retrieval:</p>
<ul class="simple">
<li>File system based: secrets are written in a file.
This is a simple solution for example when secrets are managed by config management system like Ansible Vault.</li>
<li>Third party backend based: secrets are stored by a specialized software.
These solution are usually more secured.</li>
</ul>
<p>Secrets providers are configured if needed in the master configuration.
Multiple providers can be configured at once.
The secret manager is a Buildbot service.
The secret manager returns the specific provider results related to the providers registered in the configuration.</p>
</div>
<div class="section" id="how-to-use-secrets-in-buildbot">
<h5>2.4.2.2. How to use secrets in Buildbot<a class="headerlink" href="#how-to-use-secrets-in-buildbot" title="Permalink to this headline">¶</a></h5>
<p>Secret can be used in Buildbot via the <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> mechanism.
Two <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> actually implement secrets.
<a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> can be used if you need to mix secrets and other interpolation in the same argument.
<a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> can be used if your secret is directly used as a component argument.</p>
<div class="section" id="secret">
<span id="id1"></span><h6>Secret<a class="headerlink" href="#secret" title="Permalink to this headline">¶</a></h6>
<blockquote>
<div><p><a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a> is a simple renderable which directly renders a secret.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Secret</span><span class="p">(</span><span class="s2">&quot;secretName&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="as-argument-to-steps">
<h6>As argument to steps<a class="headerlink" href="#as-argument-to-steps" title="Permalink to this headline">¶</a></h6>
<p>The following example shows a basic usage of secrets in Buildbot.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">secrets</span><span class="p">,</span> <span class="n">util</span>
<span class="c1"># First we declare that the secrets are stored in a directory of the filesystem</span>
<span class="c1"># each file contain one secret identified by the filename</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;secretsProviders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">secrets</span><span class="o">.</span><span class="n">SecretInAFile</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s2">&quot;/path/toSecretsFiles&quot;</span><span class="p">)]</span>

<span class="c1"># then in a buildfactory:</span>

<span class="c1"># use a secret on a shell command via Interpolate</span>
<span class="n">f1</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;wget -u user -p &#39;%(secret:userpassword)s&#39; &#39;%(prop:urltofetch)s&#39;&quot;</span><span class="p">)))</span>
<span class="c1"># .. or non shell form:</span>
<span class="n">f1</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">([</span><span class="s2">&quot;wget&quot;</span><span class="p">,</span> <span class="s2">&quot;-u&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Secret</span><span class="p">(</span><span class="s2">&quot;userpassword&quot;</span><span class="p">),</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(prop:urltofetch)s&quot;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>Secrets are also interpolated in the build like properties are, and will be used in a command line for example.</p>
</div>
<div class="section" id="as-argument-to-services">
<h6>As argument to services<a class="headerlink" href="#as-argument-to-services" title="Permalink to this headline">¶</a></h6>
<p>You can use secrets to configure services.
All services arguments are not compatible with secrets.
See their individual documentation for details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># First we declare that the secrets are stored in a directory of the filesystem</span>
<span class="c1"># each file contain one secret identified by the filename</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;secretsProviders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">secrets</span><span class="o">.</span><span class="n">SecretInAFile</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s2">&quot;/path/toSecretsFiles&quot;</span><span class="p">)]</span>

<span class="c1"># then for a reporter:</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">GitHubStatusPush</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Secret</span><span class="p">(</span><span class="s2">&quot;githubToken&quot;</span><span class="p">))]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="secrets-storages">
<h5>2.4.2.3. Secrets storages<a class="headerlink" href="#secrets-storages" title="Permalink to this headline">¶</a></h5>
<div class="section" id="secretinafile">
<span id="id2"></span><h6>SecretInAFile<a class="headerlink" href="#secretinafile" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;secretsProviders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">secrets</span><span class="o">.</span><span class="n">SecretInAFile</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s2">&quot;/path/toSecretsFiles&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>In the passed directory, every file contains a secret identified by the filename.</p>
<p>e.g: a file <code class="docutils literal notranslate"><span class="pre">user</span></code> contains the text <code class="docutils literal notranslate"><span class="pre">pa$$w0rd</span></code>.</p>
<p>Arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">dirname</span></code></dt>
<dd>(required) Absolute path to directory containing the files with a secret.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">strip</span></code></dt>
<dd>(optional) if <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default), trailing newlines are removed from the
file contents.</dd>
</dl>
</div>
<div class="section" id="secretinvault">
<span id="secretinavault"></span><h6>SecretInVault<a class="headerlink" href="#secretinvault" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;secretsProviders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">secrets</span><span class="o">.</span><span class="n">SecretInVault</span><span class="p">(</span>
                        <span class="n">vaultToken</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;VAULT_TOKEN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
                        <span class="n">vaultServer</span><span class="o">=</span><span class="s2">&quot;http://localhost:8200&quot;</span>
<span class="p">)]</span>
</pre></div>
</div>
<p>Vault secures, stores, and tightly controls access to secrets.
Vault presents a unified API to access multiple backends.
To be authenticated in Vault, Buildbot need to send a token to the vault server.
The token is generated when the Vault instance is initialized for the first time.</p>
<p>In the master configuration, the Vault provider is instantiated through the Buildbot service manager as a secret provider with the the Vault server address and the Vault token.
The provider SecretInVault allows Buildbot to read secrets in Vault.
For more information about Vault please visit: <span class="target" id="vault">Vault</span>: <a class="reference external" href="https://www.vaultproject.io/">https://www.vaultproject.io/</a></p>
</div>
</div>
<div class="section" id="how-to-populate-secrets-in-a-build">
<h5>2.4.2.4. How to populate secrets in a build<a class="headerlink" href="#how-to-populate-secrets-in-a-build" title="Permalink to this headline">¶</a></h5>
<p>To populate secrets in files during a build, 2 steps are used to create and delete the files on the worker.
The files will be automatically deleted at the end of the build.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>       <span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
       <span class="k">with</span> <span class="n">f</span><span class="o">.</span><span class="n">withSecrets</span><span class="p">(</span><span class="n">secrets_list</span><span class="p">):</span>
           <span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">step_definition</span><span class="p">)</span>
<span class="ow">or</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addSteps</span><span class="p">([</span><span class="n">list_of_step_definitions</span><span class="p">],</span> <span class="n">withSecrets</span><span class="o">=</span><span class="p">[</span><span class="n">secrets_list</span><span class="p">])</span>
</pre></div>
</div>
<p>In both cases the secrets_list is a list of tuple (secret path, secret value).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">secrets_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;/first/path&#39;</span><span class="p">,</span> <span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;write something and %(secret:somethingmore)s&#39;</span><span class="p">)),</span>
                <span class="p">(</span><span class="s1">&#39;/second/path&#39;</span><span class="p">,</span> <span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;%(secret:othersecret)s&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>The Interpolate class is used to render the value during the build execution.</p>
</div>
<div class="section" id="how-to-configure-a-vault-instance">
<h5>2.4.2.5. How to configure a Vault instance<a class="headerlink" href="#how-to-configure-a-vault-instance" title="Permalink to this headline">¶</a></h5>
<p>Vault being a very generic system, it can be complex to install for the first time.
Here is a simple tutorial to install the minimal Vault for use with Buildbot.</p>
<div class="section" id="use-docker-to-install-vault">
<h6>Use Docker to install Vault<a class="headerlink" href="#use-docker-to-install-vault" title="Permalink to this headline">¶</a></h6>
<p>A Docker image is available to help users installing Vault.
Without any arguments, the command launches a Docker Vault developer instance, easy to use and test the functions.
The developer version is already initialized and unsealed.
To launch a Vault server please refer to the <a class="reference external" href="https://hub.docker.com/_/vault/">VaultDocker</a> documentation:</p>
<p>In a shell:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker run vault
</pre></div>
</div>
</div>
<div class="section" id="starting-the-vault-instance">
<h6>Starting the vault instance<a class="headerlink" href="#starting-the-vault-instance" title="Permalink to this headline">¶</a></h6>
<p>Once the Docker image is created, launch a shell terminal on the Docker image:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -i -t <span class="sb">``</span>docker_vault_image_name<span class="sb">``</span> /bin/sh
</pre></div>
</div>
<p>Then, export the environment variable VAULT_ADDR needed to init Vault.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">VAULT_ADDR</span><span class="o">=</span><span class="s1">&#39;vault.server.adress&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="writing-secrets">
<h6>Writing secrets<a class="headerlink" href="#writing-secrets" title="Permalink to this headline">¶</a></h6>
<p>By default Vault is initialized with a mount named secret.
To add a new secret:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vault write secret/new_secret_key <span class="nv">value</span><span class="o">=</span>new_secret_value
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-manual/configuration/index"></span><div class="section" id="configuration">
<span id="id1"></span><h3>2.5. Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The following sections describe the configuration of the various Buildbot components.
The information available here is sufficient to create basic build and test configurations, and does not assume great familiarity with Python.</p>
<p>In more advanced Buildbot configurations, Buildbot acts as a framework for a continuous-integration application.
The next section, <a class="reference internal" href="#document-manual/customization"><span class="doc">Customization</span></a>, describes this approach, with frequent references into the <a class="reference internal" href="#buildbot-development"><span class="std std-ref">development documentation</span></a>.</p>
<div class="toctree-wrapper compound">
<span id="document-manual/configuration/intro"></span><div class="section" id="configuring-buildbot">
<h4>2.5.1. Configuring Buildbot<a class="headerlink" href="#configuring-buildbot" title="Permalink to this headline">¶</a></h4>
<p>The buildbot’s behavior is defined by the <em>config file</em>, which normally lives in the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file in the buildmaster’s base directory (but this can be changed with an option to the <strong class="command">buildbot create-master</strong> command).
This file completely specifies which <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s are to be run, which workers they should use, how <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s should be tracked, and where the status information is to be sent.
The buildmaster’s <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file names the base directory; everything else comes from the config file.</p>
<p>A sample config file was installed for you when you created the buildmaster, but you will need to edit it before your buildbot will do anything useful.</p>
<p>This chapter gives an overview of the format of this file and the various sections in it.
You will need to read the later chapters to understand how to fill in each section properly.</p>
<div class="section" id="config-file-format">
<span id="id1"></span><h5>2.5.1.1. Config File Format<a class="headerlink" href="#config-file-format" title="Permalink to this headline">¶</a></h5>
<p>The config file is, fundamentally, just a piece of Python code which defines a dictionary named <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code>, with a number of keys that are treated specially.
You don’t need to know Python to do basic configuration, though, you can just copy the syntax of the sample file.
If you <em>are</em> comfortable writing Python code, however, you can use all the power of a full programming language to achieve more complicated configurations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code> name is the only one which matters: all other names defined during the execution of the file are discarded.
When parsing the config file, the Buildmaster generally compares the old configuration with the new one and performs the minimum set of actions necessary to bring the buildbot up to date: <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s which are not changed are left untouched, and <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s which are modified get to keep their old event history.</p>
<p>The beginning of the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file typically starts with something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BuildmasterConfig</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Therefore a config key like <a class="reference internal" href="#cfg-change_source" title="change_source"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">change_source</span></code></a> will usually appear in <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> as <code class="docutils literal notranslate"><span class="pre">c['change_source']</span></code>.</p>
<p>See <a class="reference internal" href="bb-cfg.html" title="Buildmaster Configuration Index"><em>Buildmaster Configuration Index</em></a> for a full list of <code class="docutils literal notranslate"><span class="pre">BuildMasterConfig</span></code> keys.</p>
<div class="section" id="basic-python-syntax">
<h6>Basic Python Syntax<a class="headerlink" href="#basic-python-syntax" title="Permalink to this headline">¶</a></h6>
<p>The master configuration file is interpreted as Python, allowing the full flexibility of the language.
For the configurations described in this section, a detailed knowledge of Python is not required, but the basic syntax is easily described.</p>
<p>Python comments start with a hash character <code class="docutils literal notranslate"><span class="pre">#</span></code>, tuples are defined with <code class="docutils literal notranslate"><span class="pre">(parenthesis,</span> <span class="pre">pairs)</span></code>, and lists (arrays) are defined with <code class="docutils literal notranslate"><span class="pre">[square,</span> <span class="pre">brackets]</span></code>.
Tuples and lists are mostly interchangeable.
Dictionaries (data structures which map <em>keys</em> to <em>values</em>) are defined with curly braces: <code class="docutils literal notranslate"><span class="pre">{'key1':</span> <span class="pre">value1,</span> <span class="pre">'key2':</span> <span class="pre">value2}</span></code>.
Function calls (and object instantiation) can use named parameters, like <code class="docutils literal notranslate"><span class="pre">steps.ShellCommand(command=[&quot;trial&quot;,</span> <span class="pre">&quot;hello&quot;])</span></code>.</p>
<p>The config file starts with a series of <code class="docutils literal notranslate"><span class="pre">import</span></code> statements, which make various kinds of <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code>s and <code class="xref py py-class docutils literal notranslate"><span class="pre">Status</span></code> targets available for later use.
The main <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code> dictionary is created, then it is populated with a variety of keys, described section-by-section in subsequent chapters.</p>
</div>
</div>
<div class="section" id="predefined-config-file-symbols">
<span id="id2"></span><h5>2.5.1.2. Predefined Config File Symbols<a class="headerlink" href="#predefined-config-file-symbols" title="Permalink to this headline">¶</a></h5>
<p>The following symbols are automatically available for use in the configuration file.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">basedir</span></code></dt>
<dd><p class="first">the base directory for the buildmaster.
This string has not been expanded, so it may start with a tilde.
It needs to be expanded before use.
The config file is located in:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basedir</span><span class="p">,</span> <span class="s1">&#39;master.cfg&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">__file__</span></code></dt>
<dd>the absolute path of the config file.
The config file’s directory is located in <code class="docutils literal notranslate"><span class="pre">os.path.dirname(__file__)</span></code>.</dd>
</dl>
</div>
<div class="section" id="testing-the-config-file">
<span id="id3"></span><h5>2.5.1.3. Testing the Config File<a class="headerlink" href="#testing-the-config-file" title="Permalink to this headline">¶</a></h5>
<p>To verify that the config file is well-formed and contains no deprecated or invalid elements, use the <code class="docutils literal notranslate"><span class="pre">checkconfig</span></code> command, passing it either a master directory or a config file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% buildbot checkconfig master.cfg
Config file is good!
<span class="c1"># or</span>
% buildbot checkconfig /tmp/masterdir
Config file is good!
</pre></div>
</div>
<p>If the config file has deprecated features (perhaps because you’ve upgraded the buildmaster and need to update the config file to match), they will be announced by checkconfig.
In this case, the config file will work, but you should really remove the deprecated items and use the recommended replacements instead:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% buildbot checkconfig master.cfg
/usr/lib/python2.4/site-packages/buildbot/master.py:559: DeprecationWarning: c[&#39;sources&#39;] is
deprecated as of 0.7.6 and will be removed by 0.8.0 . Please use c[&#39;change_source&#39;] instead.
Config file is good!
</pre></div>
</div>
<p>If you have errors in your configuration file, checkconfig will let you know:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% buildbot checkconfig master.cfg
Configuration Errors:
c[&#39;workers&#39;] must be a list of Worker instances
no workers are configured
builder &#39;smoketest&#39; uses unknown workers &#39;linux-002&#39;
</pre></div>
</div>
<p>If the config file is simply broken, that will be caught too:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>% buildbot checkconfig master.cfg
error while parsing config file:
Traceback (most recent call last):
File &quot;/home/buildbot/master/bin/buildbot&quot;, line 4, in &lt;module&gt;
    runner.run()
File &quot;/home/buildbot/master/buildbot/scripts/runner.py&quot;, line 1358, in run
    if not doCheckConfig(so):
File &quot;/home/buildbot/master/buildbot/scripts/runner.py&quot;, line 1079, in doCheckConfig
    return cl.load(quiet=quiet)
File &quot;/home/buildbot/master/buildbot/scripts/checkconfig.py&quot;, line 29, in load
    self.basedir, self.configFileName)
--- &lt;exception caught here&gt; ---
File &quot;/home/buildbot/master/buildbot/config.py&quot;, line 147, in loadConfig
    exec f in localDict
exceptions.SyntaxError: invalid syntax (master.cfg, line 52)
Configuration Errors:
error while parsing config file: invalid syntax (master.cfg, line 52) (traceback in logfile)
</pre></div>
</div>
</div>
<div class="section" id="loading-the-config-file">
<h5>2.5.1.4. Loading the Config File<a class="headerlink" href="#loading-the-config-file" title="Permalink to this headline">¶</a></h5>
<p>The config file is only read at specific points in time.
It is first read when the buildmaster is launched.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the configuration is invalid, the master will display the errors in the console output, but will not exit.</p>
</div>
<div class="section" id="reloading-the-config-file-reconfig">
<h6>Reloading the Config File (reconfig)<a class="headerlink" href="#reloading-the-config-file-reconfig" title="Permalink to this headline">¶</a></h6>
<p>If you are on the system hosting the buildmaster, you can send a <code class="docutils literal notranslate"><span class="pre">SIGHUP</span></code> signal to it: the <strong class="command">buildbot</strong> tool has a shortcut for this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot reconfig BASEDIR
</pre></div>
</div>
<p>This command will show you all of the lines from <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> that relate to the reconfiguration.
If there are any problems during the config-file reload, they will be displayed in these lines.</p>
<p>When reloading the config file, the buildmaster will endeavor to change as little as possible about the running system.
For example, although old status targets may be shut down and new ones started up, any status targets that were not changed since the last time the config file was read will be left running and untouched.
Likewise any <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>s which have not been changed will be left running.
If a <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> is modified (say, the build process is changed) while a <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> is currently running, that <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> will keep running with the old process until it completes.
Any previously queued <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s (or <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>s which get queued after the reconfig) will use the new process.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Buildbot’s reconfiguration system is fragile for a few difficult-to-fix reasons:</p>
<ul class="simple">
<li>Any modules imported by the configuration file are not automatically reloaded.
Python modules such as <a class="reference external" href="http://pypi.python.org/pypi/lazy-reload">http://pypi.python.org/pypi/lazy-reload</a> may help here, but reloading modules is fraught with subtleties and difficult-to-decipher failure cases.</li>
<li>During the reconfiguration, active internal objects are divorced from the service hierarchy, leading to tracebacks in the web interface and other components.
These are ordinarily transient, but with HTTP connection caching (either by the browser or an intervening proxy) they can last for a long time.</li>
<li>If the new configuration file is invalid, it is possible for Buildbot’s internal state to be corrupted, leading to undefined results.
When this occurs, it is best to restart the master.</li>
<li>For more advanced configurations, it is impossible for Buildbot to tell if the configuration for a <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">Scheduler</span></code> has changed, and thus the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">Scheduler</span></code> will always be reloaded.
This occurs most commonly when a callable is passed as a configuration parameter.</li>
</ul>
<p class="last">The bbproto project (at <a class="reference external" href="https://github.com/dabrahams/bbproto">https://github.com/dabrahams/bbproto</a>) may help to construct large (multi-file) configurations which can be effectively reloaded and reconfigured.</p>
</div>
</div>
</div>
</div>
<span id="document-manual/configuration/global"></span><div class="section" id="global-configuration">
<h4>2.5.2. Global Configuration<a class="headerlink" href="#global-configuration" title="Permalink to this headline">¶</a></h4>
<p>The keys in this section affect the operations of the buildmaster globally.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#database-specification" id="id13">Database Specification</a></li>
<li><a class="reference internal" href="#mq-specification" id="id14">MQ Specification</a></li>
<li><a class="reference internal" href="#multi-master-mode" id="id15">Multi-master mode</a></li>
<li><a class="reference internal" href="#site-definitions" id="id16">Site Definitions</a></li>
<li><a class="reference internal" href="#log-handling" id="id17">Log Handling</a></li>
<li><a class="reference internal" href="#data-lifetime" id="id18">Data Lifetime</a></li>
<li><a class="reference internal" href="#merging-build-requests" id="id19">Merging Build Requests</a></li>
<li><a class="reference internal" href="#prioritizing-builders" id="id20">Prioritizing Builders</a></li>
<li><a class="reference internal" href="#setting-the-pb-port-for-workers" id="id21">Setting the PB Port for Workers</a></li>
<li><a class="reference internal" href="#defining-global-properties" id="id22">Defining Global Properties</a></li>
<li><a class="reference internal" href="#manhole" id="id23">Manhole</a></li>
<li><a class="reference internal" href="#metrics-options" id="id24">Metrics Options</a></li>
<li><a class="reference internal" href="#statistics-service" id="id25">Statistics Service</a></li>
<li><a class="reference internal" href="#secretsproviders" id="id26"><code class="docutils literal notranslate"><span class="pre">secretsProviders</span></code></a></li>
<li><a class="reference internal" href="#buildbotnetusagedata" id="id27">BuildbotNetUsageData</a></li>
<li><a class="reference internal" href="#users-options" id="id28">Users Options</a></li>
<li><a class="reference internal" href="#input-validation" id="id29">Input Validation</a></li>
<li><a class="reference internal" href="#revision-links" id="id30">Revision Links</a></li>
<li><a class="reference internal" href="#codebase-generator" id="id31">Codebase Generator</a></li>
</ul>
</div>
<span class="target" id="cfg-db"></span><div class="section" id="database-specification">
<span id="cfg-db_url"></span><span id="id1"></span><h5><a class="toc-backref" href="#id13">2.5.2.1. Database Specification</a><a class="headerlink" href="#database-specification" title="Permalink to this headline">¶</a></h5>
<p>Buildbot requires a connection to a database to maintain certain state information, such as tracking pending build requests.
In the default configuration Buildbot uses a file-based SQLite database, stored in the <code class="file docutils literal notranslate"><span class="pre">state.sqlite</span></code> file of the master’s base directory.
Override this configuration with the <a class="reference internal" href="#cfg-db_url" title="db_url"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">db_url</span></code></a> parameter.</p>
<p>Buildbot accepts a database configuration in a dictionary named <code class="docutils literal notranslate"><span class="pre">db</span></code>.
All keys are optional:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;db_url&#39;</span> <span class="p">:</span> <span class="s1">&#39;sqlite:///state.sqlite&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">db_url</span></code> key indicates the database engine to use.
The format of this parameter is completely documented at <a class="reference external" href="http://www.sqlalchemy.org/docs/dialects/">http://www.sqlalchemy.org/docs/dialects/</a>, but is generally of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;driver://[username:password@]host:port/database[?args]&quot;</span>
</pre></div>
</div>
<p>These parameters can be specified directly in the configuration dictionary, as <code class="docutils literal notranslate"><span class="pre">c['db_url']</span></code> and <code class="docutils literal notranslate"><span class="pre">c['db_poll_interval']</span></code>, although this method is deprecated.</p>
<p>The following sections give additional information for particular database backends:</p>
<div class="section" id="sqlite">
<span id="index-0"></span><h6>SQLite<a class="headerlink" href="#sqlite" title="Permalink to this headline">¶</a></h6>
<p>For sqlite databases, since there is no host and port, relative paths are specified with <code class="docutils literal notranslate"><span class="pre">sqlite:///</span></code> and absolute paths with <code class="docutils literal notranslate"><span class="pre">sqlite:////</span></code>.
Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;sqlite:///state.sqlite&quot;</span>
</pre></div>
</div>
<p>SQLite requires no special configuration.</p>
</div>
<div class="section" id="mysql">
<span id="index-1"></span><h6>MySQL<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mysql://username:password@example.com/database_name?max_idle=300&quot;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">max_idle</span></code> argument for MySQL connections is unique to Buildbot, and should be set to something less than the <code class="docutils literal notranslate"><span class="pre">wait_timeout</span></code> configured for your server.
This controls the SQLAlchemy <code class="docutils literal notranslate"><span class="pre">pool_recycle</span></code> parameter, which defaults to no timeout.
Setting this parameter ensures that connections are closed and re-opened after the configured amount of idle time.
If you see errors such as <code class="docutils literal notranslate"><span class="pre">_mysql_exceptions.OperationalError:</span> <span class="pre">(2006,</span> <span class="pre">'MySQL</span> <span class="pre">server</span> <span class="pre">has</span> <span class="pre">gone</span> <span class="pre">away')</span></code>, this means your <code class="docutils literal notranslate"><span class="pre">max_idle</span></code> setting is probably too high.
<code class="docutils literal notranslate"><span class="pre">show</span> <span class="pre">global</span> <span class="pre">variables</span> <span class="pre">like</span> <span class="pre">'wait_timeout';</span></code> will show what the currently configured <code class="docutils literal notranslate"><span class="pre">wait_timeout</span></code> is on your MySQL server.</p>
<p>Buildbot requires <code class="docutils literal notranslate"><span class="pre">use_unique=True</span></code> and <code class="docutils literal notranslate"><span class="pre">charset=utf8</span></code>, and will add them automatically, so they do not need to be specified in <code class="docutils literal notranslate"><span class="pre">db_url</span></code>.</p>
<p>MySQL defaults to the MyISAM storage engine, but this can be overridden with the <code class="docutils literal notranslate"><span class="pre">storage_engine</span></code> URL argument.</p>
</div>
<div class="section" id="postgres">
<span id="index-2"></span><h6>Postgres<a class="headerlink" href="#postgres" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;postgresql://username:password@hostname/dbname&quot;</span>
</pre></div>
</div>
<p>PosgreSQL requires no special configuration.</p>
</div>
</div>
<div class="section" id="mq-specification">
<span id="cfg-mq"></span><span id="id2"></span><h5><a class="toc-backref" href="#id14">2.5.2.2. MQ Specification</a><a class="headerlink" href="#mq-specification" title="Permalink to this headline">¶</a></h5>
<p>Buildbot uses a message-queueing system to handle communication within the master.
Messages are used to indicate events within the master, and components that are interested in those events arrange to receive them.</p>
<p>The message queueing implementation is configured as a dictionary in the <code class="docutils literal notranslate"><span class="pre">mq</span></code> option.
The <code class="docutils literal notranslate"><span class="pre">type</span></code> key describes the type of MQ implementation to be used.
Note that the implementation type cannot be changed in a reconfig.</p>
<p>The available implementation types are described in the following sections.</p>
<div class="section" id="simple">
<h6>Simple<a class="headerlink" href="#simple" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;mq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">:</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span>
    <span class="s1">&#39;debug&#39;</span> <span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is the default MQ implementation.
Similar to SQLite, it has no additional software dependencies, but does not support multi-master mode.</p>
<p>Note that this implementation also does not support message persistence across a restart of the master.
For example, if a change is received, but the master shuts down before the schedulers can create build requests for it, then those schedulers will not be notified of the change when the master starts again.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">debug</span></code> key, which defaults to False, can be used to enable logging of every message produced on this master.</p>
</div>
<div class="section" id="wamp">
<span id="mq-wamp"></span><h6>Wamp<a class="headerlink" href="#wamp" title="Permalink to this headline">¶</a></h6>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At the moment, wamp is the only message queue implementation for multimaster.
It has been privileged as this is the only message queue that have very solid support for Twisted.
Other more common message queue systems like <code class="docutils literal notranslate"><span class="pre">RabbitMQ</span></code> (using the <code class="docutils literal notranslate"><span class="pre">AMQP</span></code> protocol) do not have convincing driver for twisted, and this would require to run on threads, which will add an important performance overhead.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;mq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">:</span> <span class="s1">&#39;wamp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;router_url&#39;</span><span class="p">:</span> <span class="s1">&#39;ws://localhost:8080/ws&#39;</span><span class="p">,</span>
    <span class="s1">&#39;realm&#39;</span><span class="p">:</span> <span class="s1">&#39;realm1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wamp_debug_level&#39;</span> <span class="p">:</span> <span class="s1">&#39;error&#39;</span> <span class="c1"># valid are: none, critical, error, warn, info, debug, trace</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is a MQ implementation using <a class="reference external" href="http://wamp.ws/">wamp</a> protocol.
This implementation uses <a class="reference external" href="http://autobahn.ws">Python Autobahn</a> wamp client library, and is fully asynchronous (no use of threads).
To use this implementation, you need a wamp router like <a class="reference external" href="http://crossbar.io">Crossbar</a>.</p>
<p>Please refer to Crossbar documentation for more details, but the default Crossbar setup will just work with Buildbot, provided you use the example <code class="docutils literal notranslate"><span class="pre">mq</span></code> configuration above, and start Crossbar with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># of course, you should work in a virtualenv...</span>
pip install crossbar
crossbar init
crossbar start
</pre></div>
</div>
<p>The implementation does not yet support wamp authentication.
This MQ allows buildbot to run in multi-master mode.</p>
<p>Note that this implementation also does not support message persistence across a restart of the master.
For example, if a change is received, but the master shuts down before the schedulers can create build requests for it, then those schedulers will not be notified of the change when the master starts again.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">router_url</span></code> (mandatory): points to your router websocket url.</dt>
<dd>Buildbot is only supporting wamp over websocket, which is a sub-protocol of http.
SSL is supported using <code class="docutils literal notranslate"><span class="pre">wss://</span></code> instead of <code class="docutils literal notranslate"><span class="pre">ws://</span></code>.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">realm</span></code> (optional, defaults to <code class="docutils literal notranslate"><span class="pre">buildbot</span></code>): defines the wamp realm to use for your buildbot messages.</p>
<p><code class="docutils literal notranslate"><span class="pre">wamp_debug_level</span></code> (optional, defaults to <code class="docutils literal notranslate"><span class="pre">error</span></code>): defines the log level of autobahn.</p>
<p>You must use a router with very reliable connection to the master.
If for some reason, the wamp connection is lost, then the master will stop, and should be restarted via a process manager.</p>
</div>
</div>
<div class="section" id="multi-master-mode">
<span id="cfg-multiMaster"></span><span id="id4"></span><h5><a class="toc-backref" href="#id15">2.5.2.3. Multi-master mode</a><a class="headerlink" href="#multi-master-mode" title="Permalink to this headline">¶</a></h5>
<p>See <a class="reference internal" href="#multimaster"><span class="std std-ref">Multimaster</span></a> for details on the Multi-master mode in Buildbot Nine.</p>
<p>By default, Buildbot makes coherency checks that prevents typo in your <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code>
It make sure schedulers are not referencing unknown builders, and enforces there is at least one builder.</p>
<p>In the case of a asymmetric multimaster, those coherency checks can be harmful and prevent you to implement what you want.
For example you might want to have one master dedicated to the UI, so that a big load generated by builds will not impact page load times.</p>
<p>To enable multi-master mode in this configuration, you will need to set the <a class="reference internal" href="#cfg-multiMaster" title="multiMaster"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">multiMaster</span></code></a> option so that buildbot doesn’t warn about missing schedulers or builders.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Enable multiMaster mode; disables warnings about unknown builders and</span>
<span class="c1"># schedulers</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;multiMaster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;db_url&#39;</span> <span class="p">:</span> <span class="s1">&#39;mysql://...&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;mq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># Need to enable multimaster aware mq. Wamp is the only option for now.</span>
    <span class="s1">&#39;type&#39;</span> <span class="p">:</span> <span class="s1">&#39;wamp&#39;</span><span class="p">,</span>
    <span class="s1">&#39;router_url&#39;</span><span class="p">:</span> <span class="s1">&#39;ws://localhost:8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;realm&#39;</span><span class="p">:</span> <span class="s1">&#39;realm1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;wamp_debug_level&#39;</span> <span class="p">:</span> <span class="s1">&#39;error&#39;</span> <span class="c1"># valid are: none, critical, error, warn, info, debug, trace</span>
<span class="p">}</span>
</pre></div>
</div>
<span class="target" id="cfg-buildbotURL"></span><span class="target" id="cfg-titleURL"></span></div>
<div class="section" id="site-definitions">
<span id="cfg-title"></span><h5><a class="toc-backref" href="#id16">2.5.2.4. Site Definitions</a><a class="headerlink" href="#site-definitions" title="Permalink to this headline">¶</a></h5>
<p>Three basic settings describe the buildmaster in status reports:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Buildbot&quot;</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;titleURL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;http://buildbot.sourceforge.net/&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#cfg-title" title="title"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">title</span></code></a> is a short string that will appear at the top of this buildbot installation’s home page (linked to the <a class="reference internal" href="#cfg-titleURL" title="titleURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">titleURL</span></code></a>).</p>
<p><a class="reference internal" href="#cfg-titleURL" title="titleURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">titleURL</span></code></a> is a URL string that must end with a slash (<code class="docutils literal notranslate"><span class="pre">/</span></code>).
HTML status displays will show <code class="docutils literal notranslate"><span class="pre">title</span></code> as a link to <a class="reference internal" href="#cfg-titleURL" title="titleURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">titleURL</span></code></a>.
This URL is often used to provide a link from buildbot HTML pages to your project’s home page.</p>
<p>The <a class="reference internal" href="#cfg-buildbotURL" title="buildbotURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildbotURL</span></code></a> string should point to the location where the buildbot’s internal web server is visible.
This URL must end with a slash (<code class="docutils literal notranslate"><span class="pre">/</span></code>).</p>
<p>When status notices are sent to users (e.g., by email or over IRC), <a class="reference internal" href="#cfg-buildbotURL" title="buildbotURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildbotURL</span></code></a> will be used to create a URL to the specific build or problem that they are being notified about.</p>
<span class="target" id="cfg-logCompressionLimit"></span><span class="target" id="cfg-logCompressionMethod"></span><span class="target" id="cfg-logMaxSize"></span><span class="target" id="cfg-logMaxTailSize"></span></div>
<div class="section" id="log-handling">
<span id="log-encodings"></span><span id="cfg-logEncoding"></span><h5><a class="toc-backref" href="#id17">2.5.2.5. Log Handling</a><a class="headerlink" href="#log-handling" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;logCompressionMethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gz&#39;</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;logMaxSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span> <span class="c1"># 1M</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;logMaxTailSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32768</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;logEncoding&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;utf-8&#39;</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#cfg-logCompressionLimit" title="logCompressionLimit"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logCompressionLimit</span></code></a> enables compression of build logs on disk for logs that are bigger than the given size, or disables that completely if set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.
The default value is 4096, which should be a reasonable default on most file systems.
This setting has no impact on status plugins, and merely affects the required disk space on the master for build logs.</p>
<p>The <a class="reference internal" href="#cfg-logCompressionMethod" title="logCompressionMethod"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logCompressionMethod</span></code></a> controls what type of compression is used for build logs.
The default is ‘gz’, and the other valid option are ‘raw’ (no compression), ‘gz’ or ‘lz4’ (required lz4 package).</p>
<p>Please find below some stats extracted from 50x “trial Pyflakes” runs (results may differ according to log type).</p>
<table border="1" class="docutils" id="id12">
<caption><span class="caption-text">Space saving details</span><a class="headerlink" href="#id12" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">compression</th>
<th class="head">raw log size</th>
<th class="head">compressed log size</th>
<th class="head">space saving</th>
<th class="head">compression speed</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>bz2</td>
<td>2.981 MB</td>
<td>0.603 MB</td>
<td>79.77%</td>
<td>3.433 MB/s</td>
</tr>
<tr class="row-odd"><td>gz</td>
<td>2.981 MB</td>
<td>0.568 MB</td>
<td>80.95%</td>
<td>6.604 MB/s</td>
</tr>
<tr class="row-even"><td>lz4</td>
<td>2.981 MB</td>
<td>0.844 MB</td>
<td>71.68%</td>
<td>77.668 MB/s</td>
</tr>
</tbody>
</table>
<p>The <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logMaxSize</span></code></a> parameter sets an upper limit (in bytes) to how large logs from an individual build step can be.
The default value is None, meaning no upper limit to the log size.
Any output exceeding <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logMaxSize</span></code></a> will be truncated, and a message to this effect will be added to the log’s HEADER channel.</p>
<p>If <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logMaxSize</span></code></a> is set, and the output from a step exceeds the maximum, the <a class="reference internal" href="#cfg-logMaxTailSize" title="logMaxTailSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logMaxTailSize</span></code></a> parameter controls how much of the end of the build log will be kept.
The effect of setting this parameter is that the log will contain the first <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logMaxSize</span></code></a> bytes and the last <a class="reference internal" href="#cfg-logMaxTailSize" title="logMaxTailSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logMaxTailSize</span></code></a> bytes of output.
Don’t set this value too high, as the the tail of the log is kept in memory.</p>
<p>The <a class="reference internal" href="#cfg-logEncoding" title="logEncoding"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logEncoding</span></code></a> parameter specifies the character encoding to use to decode bytestrings provided as logs.
It defaults to <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>, which should work in most cases, but can be overridden if necessary.
In extreme cases, a callable can be specified for this parameter.
It will be called with byte strings, and should return the corresponding Unicode string.</p>
<p>This setting can be overridden for a single build step with the <code class="docutils literal notranslate"><span class="pre">logEncoding</span></code> step parameter.
It can also be overridden for a single log file by passing the <code class="docutils literal notranslate"><span class="pre">logEncoding</span></code> parameter to <code class="xref py py-meth docutils literal notranslate"><span class="pre">addLog</span></code>.</p>
</div>
<div class="section" id="data-lifetime">
<h5><a class="toc-backref" href="#id18">2.5.2.6. Data Lifetime</a><a class="headerlink" href="#data-lifetime" title="Permalink to this headline">¶</a></h5>
<div class="section" id="horizons">
<h6>Horizons<a class="headerlink" href="#horizons" title="Permalink to this headline">¶</a></h6>
<p>Previously Buildbot implemented a global configuration for horizons.
Now it is implemented as an utility Builder, and shall be configured via <a class="reference internal" href="#configurator-JanitorConfigurator" title="JanitorConfigurator"><code class="xref bb bb-configurator docutils literal notranslate"><span class="pre">JanitorConfigurator</span></code></a></p>
<span class="target" id="cfg-caches"></span><span class="target" id="cfg-changeCacheSize"></span></div>
<div class="section" id="caches">
<span id="cfg-buildCacheSize"></span><h6>Caches<a class="headerlink" href="#caches" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;caches&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Changes&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>     <span class="c1"># formerly c[&#39;changeCacheSize&#39;]</span>
    <span class="s1">&#39;Builds&#39;</span> <span class="p">:</span> <span class="mi">500</span><span class="p">,</span>      <span class="c1"># formerly c[&#39;buildCacheSize&#39;]</span>
    <span class="s1">&#39;chdicts&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;BuildRequests&#39;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;SourceStamps&#39;</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;ssdicts&#39;</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;objectids&#39;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;usdicts&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#cfg-caches" title="caches"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">caches</span></code></a> configuration key contains the configuration for Buildbot’s in-memory caches.
These caches keep frequently-used objects in memory to avoid unnecessary trips to the database.
Caches are divided by object type, and each has a configurable maximum size.</p>
<p>The default size for each cache is 1, except where noted below.
A value of 1 allows Buildbot to make a number of optimizations without consuming much memory.
Larger, busier installations will likely want to increase these values.</p>
<p>The available caches are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Changes</span></code></dt>
<dd><p class="first">the number of change objects to cache in memory.
This should be larger than the number of changes that typically arrive in the span of a few minutes, otherwise your schedulers will be reloading changes from the database every time they run.
For distributed version control systems, like Git or Hg, several thousand changes may arrive at once, so setting this parameter to something like 10000 isn’t unreasonable.</p>
<p class="last">This parameter is the same as the deprecated global parameter <a class="reference internal" href="#cfg-changeCacheSize" title="changeCacheSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">changeCacheSize</span></code></a>.
Its default value is 10.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">Builds</span></code></dt>
<dd><p class="first">The <a class="reference internal" href="#cfg-buildCacheSize" title="buildCacheSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildCacheSize</span></code></a> parameter gives the number of builds for each builder which are cached in memory.
This number should be larger than the number of builds required for commonly-used status displays (the waterfall or grid views), so that those displays do not miss the cache on a refresh.</p>
<p class="last">This parameter is the same as the deprecated global parameter <a class="reference internal" href="#cfg-buildCacheSize" title="buildCacheSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildCacheSize</span></code></a>.
Its default value is 15.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">chdicts</span></code></dt>
<dd>The number of rows from the <code class="docutils literal notranslate"><span class="pre">changes</span></code> table to cache in memory.
This value should be similar to the value for <code class="docutils literal notranslate"><span class="pre">Changes</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BuildRequests</span></code></dt>
<dd>The number of BuildRequest objects kept in memory.
This number should be higher than the typical number of outstanding build requests.
If the master ordinarily finds jobs for BuildRequests immediately, you may set a lower value.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SourceStamps</span></code></dt>
<dd>the number of SourceStamp objects kept in memory.
This number should generally be similar to the number <code class="docutils literal notranslate"><span class="pre">BuildRequesets</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ssdicts</span></code></dt>
<dd>The number of rows from the <code class="docutils literal notranslate"><span class="pre">sourcestamps</span></code> table to cache in memory.
This value should be similar to the value for <code class="docutils literal notranslate"><span class="pre">SourceStamps</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">objectids</span></code></dt>
<dd>The number of object IDs - a means to correlate an object in the Buildbot configuration with an identity in the database–to cache.
In this version, object IDs are not looked up often during runtime, so a relatively low value such as 10 is fine.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usdicts</span></code></dt>
<dd><p class="first">The number of rows from the <code class="docutils literal notranslate"><span class="pre">users</span></code> table to cache in memory.
Note that for a given user there will be a row for each attribute that user has.</p>
<p class="last">c[‘buildCacheSize’] = 15</p>
</dd>
</dl>
<span class="target" id="cfg-collapseRequests"></span></div>
</div>
<div class="section" id="merging-build-requests">
<span id="index-3"></span><h5><a class="toc-backref" href="#id19">2.5.2.7. Merging Build Requests</a><a class="headerlink" href="#merging-build-requests" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;collapseRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>This is a global default value for builders’ <a class="reference internal" href="#cfg-collapseRequests" title="collapseRequests"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">collapseRequests</span></code></a> parameter, and controls the merging of build requests.</p>
<p>This parameter can be overridden on a per-builder basis.
See <a class="reference internal" href="#collapsing-build-requests"><span class="std std-ref">Collapsing Build Requests</span></a> for the allowed values for this parameter.</p>
<span class="target" id="index-4"></span></div>
<div class="section" id="prioritizing-builders">
<span id="cfg-prioritizeBuilders"></span><span id="id5"></span><h5><a class="toc-backref" href="#id20">2.5.2.8. Prioritizing Builders</a><a class="headerlink" href="#prioritizing-builders" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prioritizeBuilders</span><span class="p">(</span><span class="n">buildmaster</span><span class="p">,</span> <span class="n">builders</span><span class="p">):</span>
    <span class="o">...</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;prioritizeBuilders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prioritizeBuilders</span>
</pre></div>
</div>
<p>By default, buildbot will attempt to start builds on builders in order, beginning with the builder with the oldest pending request.
Customize this behavior with the <a class="reference internal" href="#cfg-prioritizeBuilders" title="prioritizeBuilders"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">prioritizeBuilders</span></code></a> configuration key, which takes a callable.
See <a class="reference internal" href="#builder-priority-functions"><span class="std std-ref">Builder Priority Functions</span></a> for details on this callable.</p>
<p>This parameter controls the order that the build master can start builds, and is useful in situations where there is resource contention between builders, e.g., for a test database.
It does not affect the order in which a builder processes the build requests in its queue.
For that purpose, see <a class="reference internal" href="#prioritizing-builds"><span class="std std-ref">Prioritizing Builds</span></a>.</p>
</div>
<div class="section" id="setting-the-pb-port-for-workers">
<span id="cfg-protocols"></span><span id="id6"></span><h5><a class="toc-backref" href="#id21">2.5.2.9. Setting the PB Port for Workers</a><a class="headerlink" href="#setting-the-pb-port-for-workers" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;protocols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">}}</span>
</pre></div>
</div>
<p>The buildmaster will listen on a TCP port of your choosing for connections from workers.
It can also use this port for connections from remote Change Sources, status clients, and debug tools.
This port should be visible to the outside world, and you’ll need to tell your worker admins about your choice.</p>
<p>It does not matter which port you pick, as long it is externally visible; however, you should probably use something larger than 1024, since most operating systems don’t allow non-root processes to bind to low-numbered ports.
If your buildmaster is behind a firewall or a NAT box of some sort, you may have to configure your firewall to permit inbound connections to this port.</p>
<p><code class="docutils literal notranslate"><span class="pre">c['protocols']['pb']['port']</span></code> is a <em>strports</em> specification string, defined in the <code class="docutils literal notranslate"><span class="pre">twisted.application.strports</span></code> module (try <code class="docutils literal notranslate"><span class="pre">pydoc</span> <span class="pre">twisted.application.strports</span></code> to get documentation on the format).</p>
<p>This means that you can have the buildmaster listen on a localhost-only port by doing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;protocols&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pb&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="s2">&quot;tcp:10000:interface=127.0.0.1&quot;</span><span class="p">}}</span>
</pre></div>
</div>
<p>This might be useful if you only run workers on the same machine, and they are all configured to contact the buildmaster at <code class="docutils literal notranslate"><span class="pre">localhost:10000</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In Buildbot versions &lt;=0.8.8 you might see <code class="docutils literal notranslate"><span class="pre">slavePortnum</span></code> option.
This option contains same value as <code class="docutils literal notranslate"><span class="pre">c['protocols']['pb']['port']</span></code> but not recommended to use.</p>
</div>
<span class="target" id="index-5"></span></div>
<div class="section" id="defining-global-properties">
<span id="cfg-properties"></span><h5><a class="toc-backref" href="#id22">2.5.2.10. Defining Global Properties</a><a class="headerlink" href="#defining-global-properties" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#cfg-properties" title="properties"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">properties</span></code></a> configuration key defines a dictionary of properties that will be available to all builds started by the buildmaster:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Widget-version&#39;</span> <span class="p">:</span> <span class="s1">&#39;1.2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;release-stage&#39;</span> <span class="p">:</span> <span class="s1">&#39;alpha&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
<span class="target" id="index-6"></span></div>
<div class="section" id="manhole">
<span id="cfg-manhole"></span><h5><a class="toc-backref" href="#id23">2.5.2.11. Manhole</a><a class="headerlink" href="#manhole" title="Permalink to this headline">¶</a></h5>
<p>If you set <a class="reference internal" href="#cfg-manhole" title="manhole"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">manhole</span></code></a> to an instance of one of the classes in <code class="docutils literal notranslate"><span class="pre">buildbot.manhole</span></code>, you can telnet or ssh into the buildmaster and get an interactive Python shell, which may be useful for debugging buildbot internals.
It is probably only useful for buildbot developers.
It exposes full access to the buildmaster’s account (including the ability to modify and delete files), so it should not be enabled with a weak or easily guessable password.</p>
<p>There are three separate <code class="xref py py-class docutils literal notranslate"><span class="pre">Manhole</span></code> classes.
Two of them use SSH, one uses unencrypted telnet.
Two of them use a username+password combination to grant access, one of them uses an SSH-style <code class="file docutils literal notranslate"><span class="pre">authorized_keys</span></code> file which contains a list of ssh public keys.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using any Manhole requires that <code class="docutils literal notranslate"><span class="pre">cryptography</span></code> and <code class="docutils literal notranslate"><span class="pre">pyasn1</span></code> be installed.
These are not part of the normal Buildbot dependencies.</p>
</div>
<dl class="docutils">
<dt><cite>manhole.AuthorizedKeysManhole</cite></dt>
<dd>You construct this with the name of a file that contains one SSH public key per line, just like <code class="file docutils literal notranslate"><span class="pre">~/.ssh/authorized_keys</span></code>.
If you provide a non-absolute filename, it will be interpreted relative to the buildmaster’s base directory.
You must also specify a directory which contains an SSH host key for the Manhole server.</dd>
<dt><cite>manhole.PasswordManhole</cite></dt>
<dd>This one accepts SSH connections but asks for a username and password when authenticating.
It accepts only one such pair.
You must also specify a directory which contains an SSH host key for the Manhole server.</dd>
<dt><cite>manhole.TelnetManhole</cite></dt>
<dd>This accepts regular unencrypted telnet connections, and asks for a username/password pair before providing access.
Because this username/password is transmitted in the clear, and because Manhole access to the buildmaster is equivalent to granting full shell privileges to both the buildmaster and all the workers (and to all accounts which then run code produced by the workers), it is  highly recommended that you use one of the SSH manholes instead.</dd>
</dl>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># some examples:</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">AuthorizedKeysManhole</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s2">&quot;authorized_keys&quot;</span><span class="p">,</span> <span class="n">ssh_hostkey_dir</span><span class="o">=</span><span class="s2">&quot;/data/ssh_host_keys/&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">PasswordManhole</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s2">&quot;alice&quot;</span><span class="p">,</span> <span class="s2">&quot;mysecretpassword&quot;</span><span class="p">,</span> <span class="n">ssh_hostkey_dir</span><span class="o">=</span><span class="s2">&quot;/data/ssh_host_keys/&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">TelnetManhole</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="s2">&quot;snoop_my_password_please&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Manhole</span></code> instance can be configured to listen on a specific port.
You may wish to have this listening port bind to the loopback interface (sometimes known as <cite>lo0</cite>, <cite>localhost</cite>, or 127.0.0.1) to restrict access to clients which are running on the same host.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">PasswordManhole</span><span class="p">(</span><span class="s2">&quot;tcp:9999:interface=127.0.0.1&quot;</span><span class="p">,</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span><span class="s2">&quot;passwd&quot;</span><span class="p">,</span> <span class="n">ssh_hostkey_dir</span><span class="o">=</span><span class="s2">&quot;/data/ssh_host_keys/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To have the <code class="xref py py-class docutils literal notranslate"><span class="pre">Manhole</span></code> listen on all interfaces, use <code class="docutils literal notranslate"><span class="pre">&quot;tcp:9999&quot;</span></code> or simply 9999.
This port specification uses <code class="docutils literal notranslate"><span class="pre">twisted.application.strports</span></code>, so you can make it listen on SSL or even UNIX-domain sockets if you want.</p>
<p>Note that using any <code class="xref py py-class docutils literal notranslate"><span class="pre">Manhole</span></code> requires that the <a class="reference external" href="http://twistedmatrix.com/trac/wiki/TwistedConch">TwistedConch</a> package be installed.</p>
<p>The buildmaster’s SSH server will use a different host key than the normal sshd running on a typical unix host.
This will cause the ssh client to complain about a <cite>host key mismatch</cite>, because it does not realize there are two separate servers running on the same host.
To avoid this, use a clause like the following in your <code class="file docutils literal notranslate"><span class="pre">.ssh/config</span></code> file:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Host remotehost-buildbot
HostName remotehost
HostKeyAlias remotehost-buildbot
Port 9999
# use &#39;user&#39; if you use PasswordManhole and your name is not &#39;admin&#39;.
# if you use AuthorizedKeysManhole, this probably doesn&#39;t matter.
User admin
</pre></div>
</div>
<div class="section" id="using-manhole">
<h6>Using Manhole<a class="headerlink" href="#using-manhole" title="Permalink to this headline">¶</a></h6>
<p>After you have connected to a manhole instance, you will find yourself at a Python prompt.
You have access to two objects: <code class="docutils literal notranslate"><span class="pre">master</span></code> (the BuildMaster) and <code class="docutils literal notranslate"><span class="pre">status</span></code> (the master’s Status object).
Most interesting objects on the master can be reached from these two objects.</p>
<p>To aid in navigation, the <code class="docutils literal notranslate"><span class="pre">show</span></code> method is defined.
It displays the non-method attributes of an object.</p>
<p>A manhole session might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">show</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
<span class="go">data attributes of &lt;buildbot.master.BuildMaster instance at 0x7f7a4ab7df38&gt;</span>
<span class="go">                       basedir : &#39;/home/dustin/code/buildbot/t/buildbot/&#39;...</span>
<span class="go">                     botmaster : &lt;type &#39;instance&#39;&gt;</span>
<span class="go">                buildCacheSize : None</span>
<span class="go">                  buildHorizon : None</span>
<span class="go">                   buildbotURL : http://localhost:8010/</span>
<span class="go">               changeCacheSize : None</span>
<span class="go">                    change_svc : &lt;type &#39;instance&#39;&gt;</span>
<span class="go">                configFileName : master.cfg</span>
<span class="go">                            db : &lt;class &#39;buildbot.db.connector.DBConnector&#39;&gt;</span>
<span class="go">                        db_url : sqlite:///state.sqlite</span>
<span class="go">                              ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show</span><span class="p">(</span><span class="n">master</span><span class="o">.</span><span class="n">botmaster</span><span class="o">.</span><span class="n">builders</span><span class="p">[</span><span class="s1">&#39;win32&#39;</span><span class="p">])</span>
<span class="go">data attributes of &lt;Builder &#39;&#39;builder&#39;&#39; at 48963528&gt;</span>
<span class="go">                              ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">win32</span> <span class="o">=</span> <span class="n">_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">win32</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="s1">&#39;w32&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="metrics-options">
<span id="cfg-metrics"></span><h5><a class="toc-backref" href="#id24">2.5.2.12. Metrics Options</a><a class="headerlink" href="#metrics-options" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;metrics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">log_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">periodic_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#cfg-metrics" title="metrics"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">metrics</span></code></a> can be a dictionary that configures various aspects of the metrics subsystem.
If <a class="reference internal" href="#cfg-metrics" title="metrics"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">metrics</span></code></a> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then metrics collection, logging and reporting will be disabled.</p>
<p><code class="docutils literal notranslate"><span class="pre">log_interval</span></code> determines how often metrics should be logged to twistd.log.
It defaults to 60s.
If set to 0 or <code class="docutils literal notranslate"><span class="pre">None</span></code>, then logging of metrics will be disabled.
This value can be changed via a reconfig.</p>
<p><code class="docutils literal notranslate"><span class="pre">periodic_interval</span></code> determines how often various non-event based metrics are collected, such as memory usage, uncollectable garbage, reactor delay.
This defaults to 10s.
If set to 0 or <code class="docutils literal notranslate"><span class="pre">None</span></code>, then periodic collection of this data is disabled.
This value can also be changed via a reconfig.</p>
<p>Read more about metrics in the <a class="reference internal" href="#metrics"><span class="std std-ref">Metrics</span></a> section in the developer documentation.</p>
</div>
<div class="section" id="statistics-service">
<span id="cfg-stats-service"></span><h5><a class="toc-backref" href="#id25">2.5.2.13. Statistics Service</a><a class="headerlink" href="#statistics-service" title="Permalink to this headline">¶</a></h5>
<p>The Statistics Service (stats service for short) supports for collecting arbitrary data from within a running Buildbot instance and export it do a number of storage backends.
Currently, only <a class="reference external" href="https://influxdata.com/time-series-platform/influxdb/">InfluxDB</a> is supported as a storage backend.
Also, InfluxDB (or any other storage backend) is not a mandatory dependency.
Buildbot can run without it although <code class="xref py py-class docutils literal notranslate"><span class="pre">StatsService</span></code> will be of no use in such a case.
At present, <code class="xref py py-class docutils literal notranslate"><span class="pre">StatsService</span></code> can keep track of build properties, build times (start, end, duration) and arbitrary data produced inside Buildbot (more on this later).</p>
<p>Example usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">captures</span> <span class="o">=</span> <span class="p">[</span><span class="n">stats</span><span class="o">.</span><span class="n">CaptureProperty</span><span class="p">(</span><span class="s1">&#39;Builder1&#39;</span><span class="p">,</span> <span class="s1">&#39;tree-size-KiB&#39;</span><span class="p">),</span>
            <span class="n">stats</span><span class="o">.</span><span class="n">CaptureBuildDuration</span><span class="p">(</span><span class="s1">&#39;Builder2&#39;</span><span class="p">)]</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats</span><span class="o">.</span><span class="n">StatsService</span><span class="p">(</span>
    <span class="n">storage_backends</span><span class="o">=</span><span class="p">[</span>
        <span class="n">stats</span><span class="o">.</span><span class="n">InfluxStorageService</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">8086</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">captures</span><span class="p">)</span>
    <span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;StatsService&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">services</span></code> configuration value should be initialized as a list and a <code class="xref py py-class docutils literal notranslate"><span class="pre">StatsService</span></code> instance should be appended to it as shown in the example above.</p>
<div class="section" id="id7">
<h6>Statistics Service<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.stats_service.</code><code class="descname">StatsService</code></dt>
<dd><p>This is the main class for statistics service.
It is initialized in the master configuration as show in the example above.
It takes two arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">storage_backends</span></code></dt>
<dd>A list of storage backends (see <a class="reference internal" href="#storage-backends"><span class="std std-ref">Storage Backends</span></a>).
In the example above, <code class="docutils literal notranslate"><span class="pre">stats.InfluxStorageService</span></code> is an instance of a storage backend.
Each storage backend is an instances of subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">statsStorageBase</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>The name of this service.</dd>
</dl>
</dd></dl>

<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code>: This method can be used to send arbitrary data for storage. (See <a class="reference internal" href="#yieldmetricsvalue"><span class="std std-ref">Using StatsService.yieldMetricsValue</span></a> for more information.)</p>
</div>
<div class="section" id="capture-classes">
<span id="id8"></span><h6>Capture Classes<a class="headerlink" href="#capture-classes" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureProperty</code></dt>
<dd><p>Instance of this class declares which properties must be captured and sent to the <a class="reference internal" href="#storage-backends"><span class="std std-ref">Storage Backends</span></a>.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>The name of builder in which the property is recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">property_name</span></code></dt>
<dd>The name of property needed to be recorded as a statistic.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>(Optional) A custom callback function for this class.
This callback function should take in two arguments - <cite>build_properties</cite> (dict) and <cite>property_name</cite> (str) and return a string that will be sent for storage in the storage backends.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">regex=False</span></code></dt>
<dd>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the property name can be a regular expression.
All properties matching this regular expression will be sent for storage.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CapturePropertyAllBuilders</code></dt>
<dd><p>Instance of this class declares which properties must be captured on all builders and sent to the <a class="reference internal" href="#storage-backends"><span class="std std-ref">Storage Backends</span></a>.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">property_name</span></code></dt>
<dd>The name of property needed to be recorded as a statistic.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>(Optional) A custom callback function for this class.
This callback function should take in two arguments - <cite>build_properties</cite> (dict) and <cite>property_name</cite> (str) and return a string that will be sent for storage in the storage backends.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">regex=False</span></code></dt>
<dd>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the property name can be a regular expression.
All properties matching this regular expression will be sent for storage.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildStartTime</code></dt>
<dd><p>Instance of this class declares which builders’ start times are to be captured and sent to <a class="reference internal" href="#storage-backends"><span class="std std-ref">Storage Backends</span></a>.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>The name of builder whose times are to be recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>(Optional) A custom callback function for this class.
This callback function should take in a Python datetime object and return a string that will be sent for storage in the storage backends.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildStartTimeAllBuilders</code></dt>
<dd><p>Instance of this class declares start times of all builders to be captured and sent to <a class="reference internal" href="#storage-backends"><span class="std std-ref">Storage Backends</span></a>.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>(Optional) A custom callback function for this class.
This callback function should take in a Python datetime object and return a string that will be sent for storage in the storage backends.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildEndTime</code></dt>
<dd><p>Exactly like <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildStartTime</span></code> except it declares the builders whose end time is to be recorded.
The arguments are same as <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildStartTime</span></code>.</p>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildEndTimeAllBuilders</code></dt>
<dd><p>Exactly like <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildStartTimeAllBuilders</span></code> except it declares all builders’ end time to be recorded.
The arguments are same as <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildStartTimeAllBuilders</span></code>.</p>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildDuration</code></dt>
<dd><p>Instance of this class declares the builders whose build durations are to be recorded.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>The name of builder whose times are to be recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">report_in='seconds'</span></code></dt>
<dd>Can be one of three: <code class="docutils literal notranslate"><span class="pre">'seconds'</span></code>, <code class="docutils literal notranslate"><span class="pre">'minutes'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'hours'</span></code>.
This is the units in which the build time will be reported.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>(Optional) A custom callback function for this class.
This callback function should take in two Python datetime objects - a <code class="docutils literal notranslate"><span class="pre">start_time</span></code> and an <code class="docutils literal notranslate"><span class="pre">end_time</span></code> and return a string that will be sent for storage in the storage backends.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildDurationAllBuilders</code></dt>
<dd><p>Instance of this class declares build durations to be recorded for all builders.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">report_in='seconds'</span></code></dt>
<dd>Can be one of three: <code class="docutils literal notranslate"><span class="pre">'seconds'</span></code>, <code class="docutils literal notranslate"><span class="pre">'minutes'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'hours'</span></code>.
This is the units in which the build time will be reported.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>(Optional) A custom callback function for this class.
This callback function should take in two Python datetime objects - a <code class="docutils literal notranslate"><span class="pre">start_time</span></code> and an <code class="docutils literal notranslate"><span class="pre">end_time</span></code> and return a string that will be sent for storage in the storage backends.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureData</code></dt>
<dd><p>Instance of this capture class is for capturing arbitrary data that is not stored as build-data.
Needs to be used in conjunction with <code class="docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code> (See <a class="reference internal" href="#yieldmetricsvalue"><span class="std std-ref">Using StatsService.yieldMetricsValue</span></a>).
Takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">data_name</span></code></dt>
<dd>The name of data to be captured.
Same as in <code class="docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>The name of builder whose times are to be recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>The callback function for this class.
This callback receives the data sent to  <code class="docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code> as <code class="docutils literal notranslate"><span class="pre">post_data</span></code> (See <a class="reference internal" href="#yieldmetricsvalue"><span class="std std-ref">Using StatsService.yieldMetricsValue</span></a>).
It must return a string that is to be sent to the storage backends for storage.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureDataAllBuilders</code></dt>
<dd><p>Instance of this capture class for capturing arbitrary data that is not stored as build-data on all builders.
Needs to be used in conjunction with <code class="docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code> (See <a class="reference internal" href="#yieldmetricsvalue"><span class="std std-ref">Using StatsService.yieldMetricsValue</span></a>).
Takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">data_name</span></code></dt>
<dd>The name of data to be captured.
Same as in <code class="docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>The callback function for this class.
This callback receives the data sent to  <code class="docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code> as <code class="docutils literal notranslate"><span class="pre">post_data</span></code> (See <a class="reference internal" href="#yieldmetricsvalue"><span class="std std-ref">Using StatsService.yieldMetricsValue</span></a>).
It must return a string that is to be sent to the storage backends for storage.</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="using-statsservice-yieldmetricsvalue">
<span id="yieldmetricsvalue"></span><h6>Using <code class="docutils literal notranslate"><span class="pre">StatsService.yieldMetricsValue</span></code><a class="headerlink" href="#using-statsservice-yieldmetricsvalue" title="Permalink to this headline">¶</a></h6>
<p>Advanced users can modify <code class="docutils literal notranslate"><span class="pre">BuildSteps</span></code> to use <code class="docutils literal notranslate"><span class="pre">StatsService.yieldMetricsValue</span></code> which will send arbitrary data for storage to the <code class="docutils literal notranslate"><span class="pre">StatsService</span></code>.
It takes the following arguments:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">data_name</span></code></dt>
<dd>The name of the data being sent or storage.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">post_data</span></code></dt>
<dd>A dictionary of key value pair that is sent for storage.
The keys will act as columns in a database and the value is stored under that column.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buildid</span></code></dt>
<dd>The integer build id of the current build.
Obtainable in all <code class="docutils literal notranslate"><span class="pre">BuildSteps</span></code>.</dd>
</dl>
</div></blockquote>
<p>Along with using <code class="docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code>, the user will also need to use the <code class="docutils literal notranslate"><span class="pre">CaptureData</span></code> capture class.
As an example, we can add the following to a build step:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">yieldMetricsValue</span><span class="p">(</span><span class="s1">&#39;test_data_name&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;some_data&#39;</span><span class="p">:</span> <span class="s1">&#39;some_value&#39;</span><span class="p">},</span> <span class="n">buildid</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, we can add in the master configuration a capture class like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">captures</span> <span class="o">=</span> <span class="p">[</span><span class="n">CaptureBuildData</span><span class="p">(</span><span class="s1">&#39;test_data_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Builder1&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Pass this <code class="docutils literal notranslate"><span class="pre">captures</span></code> list to a storage backend (as shown in the example at the top of this section) for capturing this data.</p>
</div>
<div class="section" id="storage-backends">
<span id="id9"></span><h6>Storage Backends<a class="headerlink" href="#storage-backends" title="Permalink to this headline">¶</a></h6>
<p>Storage backends are responsible for storing any statistics data sent to them.
A storage backend will generally be some sort of a database-server running on a machine.
(<em>Note</em>: This machine may be different from the one running <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code>)</p>
<p>Currently, only <a class="reference external" href="https://influxdata.com/time-series-platform/influxdb/">InfluxDB</a> is supported as a storage backend.</p>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.statistics.storage_backends.influxdb_client.</code><code class="descname">InfluxStorageService</code></dt>
<dd><p>This class is a Buildbot client to the InfluxDB storage backend. <a class="reference external" href="https://influxdata.com/time-series-platform/influxdb/">InfluxDB</a> is a distributed, time series database that employs a key-value pair storage system.</p>
<p>It requires the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">url</span></code></dt>
<dd>The URL where the service is running.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt>
<dd>The port on which the service is listening.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">user</span></code></dt>
<dd>Username of a InfluxDB user.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt>
<dd>Password for <code class="docutils literal notranslate"><span class="pre">user</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">db</span></code></dt>
<dd>The name of database to be used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">captures</span></code></dt>
<dd>A list of objects of <a class="reference internal" href="#capture-classes"><span class="std std-ref">Capture Classes</span></a>.
This tells which statistics are to be stored in this storage backend.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name=None</span></code></dt>
<dd>(Optional) The name of this storage backend.</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="secretsproviders">
<span id="cfg-secretsProviders"></span><h5><a class="toc-backref" href="#id26">2.5.2.14. <code class="docutils literal notranslate"><span class="pre">secretsProviders</span></code></a><a class="headerlink" href="#secretsproviders" title="Permalink to this headline">¶</a></h5>
<p>see <a class="reference internal" href="#secretmanagement"><span class="std std-ref">Secret Management</span></a> for details on secret concepts.</p>
<p>Example usage:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;secretsProviders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="o">..</span> <span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">secretsProviders</span></code> is a  list of secrets storage.
See <a class="reference internal" href="#secretmanagement"><span class="std std-ref">Secret Management</span></a> to configure an available secret storage provider.</p>
</div>
<div class="section" id="buildbotnetusagedata">
<span id="cfg-buildbotNetUsageData"></span><h5><a class="toc-backref" href="#id27">2.5.2.15. BuildbotNetUsageData</a><a class="headerlink" href="#buildbotnetusagedata" title="Permalink to this headline">¶</a></h5>
<p>Since buildbot 0.9.0, buildbot has a simple feature which sends usage analysis info to buildbot.net.
This is very important for buildbot developers to understand how the community is using the tools.
This allows to better prioritize issues, and understand what plugins are actually being used.
This will also be a tool to decide whether to keep support for very old tools.
For example buildbot contains support for the venerable CVS, but we have no information whether it actually works beyond the unit tests.
We rely on the community to test and report issues with the old features.</p>
<p>With BuildbotNetUsageData, we can know exactly what combination of plugins are working together, how much people are customizing plugins, what versions of the main dependencies people run.</p>
<p>We take your privacy very seriously.</p>
<p>BuildbotNetUsageData will never send information specific to your Code or Intellectual Property.
No repository url, shell command values, host names, ip address or custom class names.
If it does, then this is a bug, please report.</p>
<p>We still need to track unique number for installation.
This is done via doing a sha1 hash of master’s hostname, installation path and fqdn.
Using a secure hash means there is no way of knowing hostname, path and fqdn given the hash, but still there is a different hash for each master.</p>
<p>You can see exactly what is sent in the master’s twisted.log.
Usage data is sent every time the master is started.</p>
<p>BuildbotNetUsageData can be configured with 4 values:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">c['buildbotNetUsageData']</span> <span class="pre">=</span> <span class="pre">None</span></code> disables the feature</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">c['buildbotNetUsageData']</span> <span class="pre">=</span> <span class="pre">'basic'</span></code> sends the basic information to buildbot including:</p>
<blockquote>
<div><ul class="simple">
<li>versions of buildbot, python and twisted</li>
<li>platform information (CPU, OS, distribution, python flavor (i.e CPython vs PyPy))</li>
<li>mq and database type (mysql or sqlite?)</li>
<li>www plugins usage</li>
<li>Plugins usages:
This counts the number of time each class of buildbot is used in your configuration.
This counts workers, builders, steps, schedulers, change sources.
If the plugin is subclassed, then it will be prefixed with a <cite>&gt;</cite></li>
</ul>
<p>example of basic report (for the metabuildbot):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s1">&#39;versions&#39;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;Python&#39;</span><span class="o">:</span> <span class="s1">&#39;2.7.6&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Twisted&#39;</span><span class="o">:</span> <span class="s1">&#39;15.5.0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Buildbot&#39;</span><span class="o">:</span> <span class="s1">&#39;0.9.0rc2-176-g5fa9dbf&#39;</span>
<span class="p">},</span>
<span class="s1">&#39;platform&#39;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;machine&#39;</span><span class="o">:</span> <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
    <span class="s1">&#39;python_implementation&#39;</span><span class="o">:</span> <span class="s1">&#39;CPython&#39;</span><span class="p">,</span>
    <span class="s1">&#39;version&#39;</span><span class="o">:</span> <span class="s1">&#39;#140-Ubuntu SMP Mon Jul&#39;</span><span class="p">,</span>
    <span class="s1">&#39;processor&#39;</span><span class="o">:</span>
    <span class="s1">&#39;x86_64&#39;</span><span class="p">,</span>
    <span class="s1">&#39;distro:&#39;</span><span class="o">:</span> <span class="p">(</span><span class="s1">&#39;Ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;14.04&#39;</span><span class="p">,</span> <span class="s1">&#39;trusty&#39;</span><span class="p">)</span>
    <span class="p">},</span>
<span class="s1">&#39;db&#39;</span><span class="o">:</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">,</span>
<span class="s1">&#39;mq&#39;</span><span class="o">:</span> <span class="s1">&#39;simple&#39;</span><span class="p">,</span>
<span class="s1">&#39;plugins&#39;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;buildbot.schedulers.forcesched.ForceScheduler&#39;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;buildbot.schedulers.triggerable.Triggerable&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;buildbot.config.BuilderConfig&#39;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;buildbot.schedulers.basic.AnyBranchScheduler&#39;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;buildbot.steps.source.git.Git&#39;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;&gt;&gt;buildbot.steps.trigger.Trigger&#39;</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;&gt;&gt;&gt;buildbot.worker.base.Worker&#39;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="s1">&#39;buildbot.reporters.irc.IRC&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;&gt;&gt;&gt;buildbot.process.buildstep.LoggingBuildStep&#39;</span><span class="o">:</span> <span class="mi">2</span><span class="p">},</span>
<span class="s1">&#39;www_plugins&#39;</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;buildbot_travis&#39;</span><span class="p">,</span> <span class="s1">&#39;waterfall_view&#39;</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">c['buildbotNetUsageData']</span> <span class="pre">=</span> <span class="pre">'full'</span></code> sends the basic information plus additional information:</p>
<blockquote>
<div><ul class="simple">
<li>configuration of each builders: how the steps are arranged together. for ex:</li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;builders&#39;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">&#39;buildbot.steps.source.git.Git&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&gt;buildbot.process.buildstep.LoggingBuildStep&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;buildbot.steps.source.git.Git&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;buildbot.steps.trigger.Trigger&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;buildbot.steps.source.git.Git&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&gt;buildbot.process.buildstep.LoggingBuildStep&#39;</span><span class="p">],</span>
        <span class="p">[</span><span class="s1">&#39;buildbot.steps.source.git.Git&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;buildbot.steps.trigger.Trigger&#39;</span><span class="p">]]</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">c['buildbotNetUsageData']</span> <span class="pre">=</span> <span class="pre">myCustomFunction</span></code>. You can also specify exactly what to send using a callback.</p>
<blockquote>
<div><p>The custom function will take the generated data from full report in the form of a dictionary, and return a customized report as a jsonable dictionary. You can use this to filter any information you don’t want to disclose. You can use a custom http_proxy environment variable in order to not send any data while developing your callback.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="users-options">
<span id="cfg-user_managers"></span><span id="id10"></span><h5><a class="toc-backref" href="#id28">2.5.2.16. Users Options</a><a class="headerlink" href="#users-options" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;user_managers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;user_managers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">CommandlineUserManager</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
                                                      <span class="n">passwd</span><span class="o">=</span><span class="s2">&quot;userpw&quot;</span><span class="p">,</span>
                                                      <span class="n">port</span><span class="o">=</span><span class="mi">9990</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="#cfg-user_managers" title="user_managers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">user_managers</span></code></a> contains a list of ways to manually manage User Objects within Buildbot (see <a class="reference internal" href="#user-objects"><span class="std std-ref">User Objects</span></a>).
Currently implemented is a commandline tool <cite>buildbot user</cite>, described at length in <a class="reference internal" href="#cmdline-user" title="user"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">user</span></code></a>.
In the future, a web client will also be able to manage User Objects and their attributes.</p>
<p>As shown above, to enable the <cite>buildbot user</cite> tool, you must initialize a <cite>CommandlineUserManager</cite> instance in your <cite>master.cfg</cite>.
<cite>CommandlineUserManager</cite> instances require the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">username</span></code></dt>
<dd>This is the <cite>username</cite> that will be registered on the PB connection and need to be used when calling <cite>buildbot user</cite>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">passwd</span></code></dt>
<dd>This is the <cite>passwd</cite> that will be registered on the PB connection and need to be used when calling <cite>buildbot user</cite>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt>
<dd>The PB connection <cite>port</cite> must be different than <cite>c[‘protocols’][‘pb’][‘port’]</cite> and be specified when calling <cite>buildbot user</cite></dd>
</dl>
</div>
<div class="section" id="input-validation">
<span id="cfg-validation"></span><span id="id11"></span><h5><a class="toc-backref" href="#id29">2.5.2.17. Input Validation</a><a class="headerlink" href="#input-validation" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;validation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;branch&#39;</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[\w.+/~-]*$&#39;</span><span class="p">),</span>
    <span class="s1">&#39;revision&#39;</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[ \w\.\-\/]*$&#39;</span><span class="p">),</span>
    <span class="s1">&#39;property_name&#39;</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[\w\.\-\/\~:]*$&#39;</span><span class="p">),</span>
    <span class="s1">&#39;property_value&#39;</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[\w\.\-\/\~:]*$&#39;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This option configures the validation applied to user inputs of various types.
This validation is important since these values are often included in command-line arguments executed on workers.
Allowing arbitrary input from untrusted users may raise security concerns.</p>
<p>The keys describe the type of input validated; the values are compiled regular expressions against which the input will be matched.
The defaults for each type of input are those given in the example, above.</p>
</div>
<div class="section" id="revision-links">
<span id="cfg-revlink"></span><h5><a class="toc-backref" href="#id30">2.5.2.18. Revision Links</a><a class="headerlink" href="#revision-links" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#cfg-revlink" title="revlink"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">revlink</span></code></a> parameter is used to create links from revision IDs in the web status to a web-view of your source control system.
The parameter’s value must be a callable.</p>
<p>By default, Buildbot is configured to generate revlinks for a number of open source hosting platforms.</p>
<p>The callable takes the revision id and repository argument, and should return an URL to the revision.
Note that the revision id may not always be in the form you expect, so code defensively.
In particular, a revision of “??” may be supplied when no other information is available.</p>
<p>Note that <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code>s that are not created from version-control changes (e.g., those created by a <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> or <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a> scheduler) may have an empty repository string, if the repository is not known to the scheduler.</p>
<div class="section" id="revision-link-helpers">
<h6>Revision Link Helpers<a class="headerlink" href="#revision-link-helpers" title="Permalink to this headline">¶</a></h6>
<p>Buildbot provides two helpers for generating revision links.
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.revlinks.RevlinkMatcher</span></code> takes a list of regular expressions, and replacement text.
The regular expressions should all have the same number of capture groups.
The replacement text should have sed-style references to that capture groups (i.e. ‘1’ for the first capture group), and a single ‘%s’ reference, for the revision ID.
The repository given is tried against each regular expression in turn.
The results are the substituted into the replacement text, along with the revision ID to obtain the revision link.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;revlink&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">RevlinkMatch</span><span class="p">([</span><span class="sa">r</span><span class="s1">&#39;git://notmuchmail.org/git/(.*)&#39;</span><span class="p">],</span>
                                  <span class="sa">r</span><span class="s1">&#39;http://git.notmuchmail.org/git/\1/commit/</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.revlinks.RevlinkMultiplexer</span></code> takes a list of revision link callables, and tries each in turn, returning the first successful match.</p>
</div>
</div>
<div class="section" id="codebase-generator">
<span id="cfg-codebaseGenerator"></span><h5><a class="toc-backref" href="#id31">2.5.2.19. Codebase Generator</a><a class="headerlink" href="#codebase-generator" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">all_repositories</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sa">r</span><span class="s1">&#39;https://hg/hg/mailsuite/mailclient&#39;</span><span class="p">:</span> <span class="s1">&#39;mailexe&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;https://hg/hg/mailsuite/mapilib&#39;</span><span class="p">:</span> <span class="s1">&#39;mapilib&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;https://hg/hg/mailsuite/imaplib&#39;</span><span class="p">:</span> <span class="s1">&#39;imaplib&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;https://github.com/mailinc/mailsuite/mailclient&#39;</span><span class="p">:</span> <span class="s1">&#39;mailexe&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;https://github.com/mailinc/mailsuite/mapilib&#39;</span><span class="p">:</span> <span class="s1">&#39;mapilib&#39;</span><span class="p">,</span>
    <span class="sa">r</span><span class="s1">&#39;https://github.com/mailinc/mailsuite/imaplib&#39;</span><span class="p">:</span> <span class="s1">&#39;imaplib&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">codebaseGenerator</span><span class="p">(</span><span class="n">chdict</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">all_repositories</span><span class="p">[</span><span class="n">chdict</span><span class="p">[</span><span class="s1">&#39;repository&#39;</span><span class="p">]]</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;codebaseGenerator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">codebaseGenerator</span>
</pre></div>
</div>
<p>For any incoming change, the <a class="reference internal" href="#change-attr-codebase"><span class="std std-ref">codebase</span></a> is set to ‘’.
This codebase value is sufficient if all changes come from the same repository (or clones).
If changes come from different repositories, extra processing will be needed to determine the codebase for the incoming change.
This codebase will then be a logical name for the combination of repository and or branch etc.</p>
<p>The <cite>codebaseGenerator</cite> accepts a change dictionary as produced by the <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.db.changes.ChangesConnectorComponent</span></code>, with a changeid equal to <cite>None</cite>.</p>
</div>
</div>
<span id="document-manual/configuration/changesources"></span><div class="section" id="change-sources-and-changes">
<span id="change-sources"></span><h4>2.5.3. Change Sources and Changes<a class="headerlink" href="#change-sources-and-changes" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#how-different-vc-systems-specify-sources" id="id24">How Different VC Systems Specify Sources</a><ul>
<li><a class="reference internal" href="#comparison" id="id25">Comparison</a></li>
<li><a class="reference internal" href="#tree-stability" id="id26">Tree Stability</a></li>
</ul>
</li>
<li><a class="reference internal" href="#choosing-a-change-source" id="id27">Choosing a Change Source</a></li>
<li><a class="reference internal" href="#configuring-change-sources" id="id28">Configuring Change Sources</a><ul>
<li><a class="reference internal" href="#repository-and-project" id="id29">Repository and Project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mail-parsing-changesources" id="id30">Mail-parsing ChangeSources</a><ul>
<li><a class="reference internal" href="#subscribing-the-buildmaster" id="id31">Subscribing the Buildmaster</a></li>
<li><a class="reference internal" href="#using-maildirs" id="id32">Using Maildirs</a></li>
<li><a class="reference internal" href="#parsing-email-change-messages" id="id33">Parsing Email Change Messages</a></li>
<li><a class="reference internal" href="#cvsmaildirsource" id="id34">CVSMaildirSource</a></li>
<li><a class="reference internal" href="#svncommitemailmaildirsource" id="id35">SVNCommitEmailMaildirSource</a></li>
<li><a class="reference internal" href="#bzrlaunchpademailmaildirsource" id="id36">BzrLaunchpadEmailMaildirSource</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pbchangesource" id="id37">PBChangeSource</a><ul>
<li><a class="reference internal" href="#bzr-hook" id="id38">Bzr Hook</a></li>
</ul>
</li>
<li><a class="reference internal" href="#p4source" id="id39">P4Source</a><ul>
<li><a class="reference internal" href="#example-1" id="id40">Example #1</a></li>
<li><a class="reference internal" href="#example-2" id="id41">Example #2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#svnpoller" id="id42">SVNPoller</a></li>
<li><a class="reference internal" href="#bzr-poller" id="id43">Bzr Poller</a></li>
<li><a class="reference internal" href="#gitpoller" id="id44">GitPoller</a></li>
<li><a class="reference internal" href="#hgpoller" id="id45">HgPoller</a></li>
<li><a class="reference internal" href="#githubpullrequestpoller" id="id46">GitHubPullrequestPoller</a></li>
<li><a class="reference internal" href="#bitbucketpullrequestpoller" id="id47">BitbucketPullrequestPoller</a></li>
<li><a class="reference internal" href="#gerritchangesource" id="id48">GerritChangeSource</a></li>
<li><a class="reference internal" href="#gerriteventlogpoller" id="id49">GerritEventLogPoller</a></li>
<li><a class="reference internal" href="#gerritchangefilter" id="id50">GerritChangeFilter</a></li>
<li><a class="reference internal" href="#change-hooks-http-notifications" id="id51">Change Hooks (HTTP Notifications)</a></li>
</ul>
</div>
<p>A <em>change source</em> is the mechanism which is used by Buildbot to get information about new changes in a repository maintained by a Version Control System.</p>
<p>These change sources fall broadly into two categories: pollers which periodically check the repository for updates; and hooks, where the repository is configured to notify Buildbot whenever an update occurs.</p>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> is an abstract way that Buildbot uses to represent changes in any of the Version Control Systems it supports. It contains just enough information needed to acquire specific version of the tree when needed. This usually happens as one of the first steps in a <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>.</p>
<p>This concept does not map perfectly to every version control system.
For example, for CVS Buildbot must guess that version updates made to multiple files within a short time represent a single change.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s can be provided by a variety of <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code> types, although any given project will typically have only a single <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code> active.</p>
<div class="section" id="how-different-vc-systems-specify-sources">
<span id="id1"></span><h5><a class="toc-backref" href="#id24">2.5.3.1. How Different VC Systems Specify Sources</a><a class="headerlink" href="#how-different-vc-systems-specify-sources" title="Permalink to this headline">¶</a></h5>
<p>For CVS, the static specifications are <em>repository</em> and <em>module</em>.
In addition to those, each build uses a timestamp (or omits the timestamp to mean <em>the latest</em>) and <em>branch tag</em> (which defaults to <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>).
These parameters collectively specify a set of sources from which a build may be performed.</p>
<p><a class="reference external" href="http://subversion.tigris.org">Subversion</a>,  combines the repository, module, and branch into a single <em>Subversion URL</em> parameter.
Within that scope, source checkouts can be specified by a numeric <em>revision number</em> (a repository-wide monotonically-increasing marker, such that each transaction that changes the repository is indexed by a different revision number), or a revision timestamp.
When branches are used, the repository and module form a static <code class="docutils literal notranslate"><span class="pre">baseURL</span></code>, while each build has a <em>revision number</em> and a <em>branch</em> (which defaults to a statically-specified <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code>).
The <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> and <code class="docutils literal notranslate"><span class="pre">branch</span></code> are simply concatenated together to derive the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> to use for the checkout.</p>
<p><a class="reference external" href="http://www.perforce.com/">Perforce</a> is similar.
The server is specified through a <code class="docutils literal notranslate"><span class="pre">P4PORT</span></code> parameter.
Module and branch are specified in a single depot path, and revisions are depot-wide.
When branches are used, the <code class="docutils literal notranslate"><span class="pre">p4base</span></code> and <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code> are concatenated together to produce the depot path.</p>
<p><a class="reference external" href="http://bazaar-vcs.org">Bzr</a> (which is a descendant of Arch/Bazaar, and is frequently referred to as “Bazaar”) has the same sort of repository-vs-workspace model as Arch, but the repository data can either be stored inside the working directory or kept elsewhere (either on the same machine or on an entirely different machine).
For the purposes of Buildbot (which never commits changes), the repository is specified with a URL and a revision number.</p>
<p>The most common way to obtain read-only access to a bzr tree is via HTTP, simply by making the repository visible through a web server like Apache.
Bzr can also use FTP and SFTP servers, if the worker process has sufficient privileges to access them.
Higher performance can be obtained by running a special Bazaar-specific server.
None of these matter to the buildbot: the repository URL just has to match the kind of server being used.
The <code class="docutils literal notranslate"><span class="pre">repoURL</span></code> argument provides the location of the repository.</p>
<p>Branches are expressed as subdirectories of the main central repository, which means that if branches are being used, the BZR step is given a <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> and <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code> instead of getting the <code class="docutils literal notranslate"><span class="pre">repoURL</span></code> argument.</p>
<p><a class="reference external" href="http://darcs.net/">Darcs</a> doesn’t really have the notion of a single master repository.
Nor does it really have branches.
In Darcs, each working directory is also a repository, and there are operations to push and pull patches from one of these <code class="docutils literal notranslate"><span class="pre">repositories</span></code> to another.
For the Buildbot’s purposes, all you need to do is specify the URL of a repository that you want to build from.
The worker will then pull the latest patches from that repository and build them.
Multiple branches are implemented by using multiple repositories (possibly living on the same server).</p>
<p>Builders which use Darcs therefore have a static <code class="docutils literal notranslate"><span class="pre">repourl</span></code> which specifies the location of the repository.
If branches are being used, the source Step is instead configured with a <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> and a <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code>, and the two strings are simply concatenated together to obtain the repository’s URL.
Each build then has a specific branch which replaces <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code>, or just uses the default one.
Instead of a revision number, each build can have a <code class="docutils literal notranslate"><span class="pre">context</span></code>, which is a string that records all the patches that are present in a given tree (this is the output of <code class="docutils literal notranslate"><span class="pre">darcs</span> <span class="pre">changes</span> <span class="pre">--context</span></code>, and is considerably less concise than, e.g. Subversion’s revision number, but the patch-reordering flexibility of Darcs makes it impossible to provide a shorter useful specification).</p>
<p><a class="reference external" href="https://www.mercurial-scm.org/">Mercurial</a> follows a decentralized model, and each repository can have several branches and tags.
The source Step is configured with a static <code class="docutils literal notranslate"><span class="pre">repourl</span></code> which specifies the location of the repository.
Branches are configured with the <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code> argument.
The <em>revision</em> is the hash identifier returned by <code class="docutils literal notranslate"><span class="pre">hg</span> <span class="pre">identify</span></code>.</p>
<p><a class="reference external" href="http://git.or.cz/">Git</a> also follows a decentralized model, and each repository can have several branches and tags.
The source Step is configured with a static <code class="docutils literal notranslate"><span class="pre">repourl</span></code> which specifies the location of the repository.
In addition, an optional <code class="docutils literal notranslate"><span class="pre">branch</span></code> parameter can be specified to check out code from a specific branch instead of the default <em>master</em> branch.
The <em>revision</em> is specified as a SHA1 hash as returned by e.g. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">rev-parse</span></code>.
No attempt is made to ensure that the specified revision is actually a subset of the specified branch.</p>
<p><a class="reference external" href="http://www.monotone.ca/">Monotone</a> is another that follows a decentralized model where each repository can have several branches and tags.
The source Step is configured with static <code class="docutils literal notranslate"><span class="pre">repourl</span></code> and <code class="docutils literal notranslate"><span class="pre">branch</span></code> parameters, which specifies the location of the repository and the branch to use.
The <em>revision</em> is specified as a SHA1 hash as returned by e.g. <code class="docutils literal notranslate"><span class="pre">mtn</span> <span class="pre">automate</span> <span class="pre">select</span> <span class="pre">w:</span></code>.
No attempt is made to ensure that the specified revision is actually a subset of the specified branch.</p>
<div class="section" id="comparison">
<h6><a class="toc-backref" href="#id25">Comparison</a><a class="headerlink" href="#comparison" title="Permalink to this headline">¶</a></h6>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="21%" />
<col width="21%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Change</th>
<th class="head">Revision</th>
<th class="head">Branches</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CVS</td>
<td>patch [1]</td>
<td>timestamp</td>
<td>unnamed</td>
</tr>
<tr class="row-odd"><td>Subversion</td>
<td>revision</td>
<td>integer</td>
<td>directories</td>
</tr>
<tr class="row-even"><td>Git</td>
<td>commit</td>
<td>sha1 hash</td>
<td>named refs</td>
</tr>
<tr class="row-odd"><td>Mercurial</td>
<td>changeset</td>
<td>sha1 hash</td>
<td>different repos
or (permanently)
named commits</td>
</tr>
<tr class="row-even"><td>Darcs</td>
<td>?</td>
<td>none [2]</td>
<td>different repos</td>
</tr>
<tr class="row-odd"><td>Bazaar</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr class="row-even"><td>Perforce</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr class="row-odd"><td>BitKeeper</td>
<td>changeset</td>
<td>?</td>
<td>different repos</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>[1] note that CVS only tracks patches to individual files.  Buildbot tries to
recognize coordinated changes to multiple files by correlating change times.</li>
<li>[2] Darcs does not have a concise way of representing a particular revision
of the source.</li>
</ul>
</div>
<div class="section" id="tree-stability">
<h6><a class="toc-backref" href="#id26">Tree Stability</a><a class="headerlink" href="#tree-stability" title="Permalink to this headline">¶</a></h6>
<p>Changes tend to arrive at a buildmaster in bursts.
In many cases, these bursts of changes are meant to be taken together.
For example, a developer may have pushed multiple commits to a DVCS that comprise the same new feature or bugfix.
To avoid trying to build every change, Buildbot supports the notion of <em>tree stability</em>, by waiting for a burst of changes to finish before starting to schedule builds.
This is implemented as a timer, with builds not scheduled until no changes have occurred for the duration of the timer.</p>
</div>
</div>
<div class="section" id="choosing-a-change-source">
<span id="id2"></span><h5><a class="toc-backref" href="#id27">2.5.3.2. Choosing a Change Source</a><a class="headerlink" href="#choosing-a-change-source" title="Permalink to this headline">¶</a></h5>
<p>There are a variety of <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code> classes available, some of which are meant to be used in conjunction with other tools to deliver <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> events from the VC repository to the buildmaster.</p>
<p>As a quick guide, here is a list of VC systems and the <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code>s that might be useful with them.
Note that some of these modules are in Buildbot’s <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib">master/contrib</a> directory, meaning that they have been offered by other users in hopes they may be useful, and might require some additional work to make them functional.</p>
<p>CVS</p>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">CVSMaildirSource</span></code></a> (watching mail sent by <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/buildbot_cvs_mail.py">master/contrib/buildbot_cvs_mail.py</a> script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code> run in a loginfo script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from a long-running <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/viewcvspoll.py">master/contrib/viewcvspoll.py</a> polling process which examines the ViewCVS database directly)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
</ul>
<p>SVN</p>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/svn_buildbot.py">master/contrib/svn_buildbot.py</a> run in a postcommit script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from a long-running <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/svn_watcher.py">master/contrib/svn_watcher.py</a> or <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/svnpoller.py">master/contrib/svnpoller.py</a> polling process</li>
<li><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNCommitEmailMaildirSource</span></code></a> (watching for email sent by <code class="file docutils literal notranslate"><span class="pre">commit-email.pl</span></code>)</li>
<li><a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> (polling the SVN repository)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
</ul>
<p>Darcs</p>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/darcs_buildbot.py">master/contrib/darcs_buildbot.py</a> in a commit script)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
</ul>
<p>Mercurial</p>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus (including <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/hgbuildbot.py">master/contrib/hgbuildbot.py</a>, configurable in a <code class="docutils literal notranslate"><span class="pre">changegroup</span></code> hook)</li>
<li><a class="reference external" href="BitBuckethook">BitBucket change hook</a> (specifically designed for BitBucket notifications, but requiring a publicly-accessible WebStatus)</li>
<li><a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a> (polling a remote Mercurial repository)</li>
<li><a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code></a> (polling Bitbucket for pull requests)</li>
<li><a class="reference internal" href="#mail-parsing-changesources"><span class="std std-ref">Mail-parsing ChangeSources</span></a>, though there are no ready-to-use recipes</li>
</ul>
<p>Bzr (the newer Bazaar)</p>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/bzr_buildbot.py">master/contrib/bzr_buildbot.py</a> run in a post-change-branch-tip or commit hook)</li>
<li><a class="reference internal" href="#chsrc-BzrPoller" title="BzrPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BzrPoller</span></code></a> (polling the Bzr repository)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
</ul>
<p>Git</p>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/git_buildbot.py">master/contrib/git_buildbot.py</a> run in the post-receive hook)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/github_buildbot.py">master/contrib/github_buildbot.py</a>, which listens for notifications from GitHub)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
<li><a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> change hook (specifically designed for GitHub notifications, but requiring a publicly-accessible WebStatus)</li>
<li><a class="reference internal" href="#chsrc-BitBucket" title="BitBucket"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitBucket</span></code></a> change hook (specifically designed for BitBucket notifications, but requiring a publicly-accessible WebStatus)</li>
<li><a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> (polling a remote Git repository)</li>
<li><a class="reference internal" href="#chsrc-GitHubPullrequestPoller" title="GitHubPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHubPullrequestPoller</span></code></a> (polling GitHub API for pull requests)</li>
<li><a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code></a> (polling Bitbucket for pull requests)</li>
</ul>
<p>Repo/Gerrit</p>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a> connects to Gerrit via SSH to get a live stream of changes</li>
<li><a class="reference internal" href="#chsrc-GerritEventLogPoller" title="GerritEventLogPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritEventLogPoller</span></code></a> connects to Gerrit via HTTP with the help of the plugin <a class="reference external" href="https://gerrit.googlesource.com/plugins/events-log/">events-log</a></li>
</ul>
<p>Monotone</p>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="file docutils literal notranslate"><span class="pre">monotone-buildbot.lua</span></code>, which is available with Monotone)</li>
</ul>
<p>All VC systems can be driven by a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> and the <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code> tool run from some form of commit script.
If you write an email parsing function, they can also all be driven by a suitable <a class="reference internal" href="#mail-parsing-changesources"><span class="std std-ref">mail-parsing source</span></a>.
Additionally, handlers for web-based notification (i.e. from GitHub) can be used with WebStatus’ change_hook module.
The interface is simple, so adding your own handlers (and sharing!) should be a breeze.</p>
<p>See <a class="reference internal" href="bb-chsrc.html" title="Change Source Index"><em>Change Source Index</em></a> for a full list of change sources.</p>
<span class="target" id="index-0"></span></div>
<div class="section" id="configuring-change-sources">
<span id="cfg-change_source"></span><h5><a class="toc-backref" href="#id28">2.5.3.3. Configuring Change Sources</a><a class="headerlink" href="#configuring-change-sources" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#cfg-change_source" title="change_source"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">change_source</span></code></a> configuration key holds all active change sources for the configuration.</p>
<p>Most configurations have a single <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code>, watching only a single tree, e.g.,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">PBChangeSource</span><span class="p">()</span>
</pre></div>
</div>
<p>For more advanced configurations, the parameter can be a list of change sources:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source1</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">source2</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">source1</span><span class="p">,</span> <span class="n">source1</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="repository-and-project">
<h6><a class="toc-backref" href="#id29">Repository and Project</a><a class="headerlink" href="#repository-and-project" title="Permalink to this headline">¶</a></h6>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code>s will, in general, automatically provide the proper <code class="xref py py-attr docutils literal notranslate"><span class="pre">repository</span></code> attribute for any changes they produce.
For systems which operate on URL-like specifiers, this is a repository URL.
Other <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code>s adapt the concept as necessary.</p>
<p>Many <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code>s allow you to specify a project, as well.
This attribute is useful when building from several distinct codebases in the same buildmaster: the project string can serve to differentiate the different codebases.
Schedulers can filter on project, so you can configure different builders to run for each project.</p>
</div>
</div>
<div class="section" id="mail-parsing-changesources">
<span id="id3"></span><h5><a class="toc-backref" href="#id30">2.5.3.4. Mail-parsing ChangeSources</a><a class="headerlink" href="#mail-parsing-changesources" title="Permalink to this headline">¶</a></h5>
<p>Many projects publish information about changes to their source tree by sending an email message out to a mailing list, frequently named <code class="samp docutils literal notranslate"><em><span class="pre">PROJECT</span></em><span class="pre">-commits</span></code> or <code class="samp docutils literal notranslate"><em><span class="pre">PROJECT</span></em><span class="pre">-changes</span></code>.
Each message usually contains a description of the change (who made the change, which files were affected) and sometimes a copy of the diff.
Humans can subscribe to this list to stay informed about what’s happening to the source tree.</p>
<p>The Buildbot can also be subscribed to a <cite>-commits</cite> mailing list, and can trigger builds in response to Changes that it hears about.
The buildmaster admin needs to arrange for these email messages to arrive in a place where the buildmaster can find them, and configure the buildmaster to parse the messages correctly.
Once that is in place, the email parser will create Change objects and deliver them to the schedulers (see <a class="reference internal" href="#schedulers"><span class="std std-ref">Schedulers</span></a>) just like any other ChangeSource.</p>
<p>There are two components to setting up an email-based ChangeSource.
The first is to route the email messages to the buildmaster, which is done by dropping them into a <cite>maildir</cite>.
The second is to actually parse the messages, which is highly dependent upon the tool that was used to create them.
Each VC system has a collection of favorite change-emailing tools, and each has a slightly different format, so each has a different parsing function.
There is a separate ChangeSource variant for each parsing function.</p>
<p>Once you’ve chosen a maildir location and a parsing function, create the change source and put it in <a class="reference internal" href="#cfg-change_source" title="change_source"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">change_source</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">CVSMaildirSource</span><span class="p">(</span><span class="s2">&quot;~/maildir-buildbot&quot;</span><span class="p">,</span>
                                              <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;/trunk/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="subscribing-the-buildmaster">
<span id="id4"></span><h6><a class="toc-backref" href="#id31">Subscribing the Buildmaster</a><a class="headerlink" href="#subscribing-the-buildmaster" title="Permalink to this headline">¶</a></h6>
<p>The recommended way to install the Buildbot is to create a dedicated account for the buildmaster.
If you do this, the account will probably have a distinct email address (perhaps <cite>buildmaster&#64;example.org</cite>).
Then just arrange for this account’s email to be delivered to a suitable maildir (described in the next section).</p>
<p>If the Buildbot does not have its own account, <cite>extension addresses</cite> can be used to distinguish between email intended for the buildmaster and email intended for the rest of the account.
In most modern MTAs, the e.g. <cite>foo&#64;example.org</cite> account has control over every email address at example.org which begins with “foo”, such that email addressed to <cite>account-foo&#64;example.org</cite> can be delivered to a different destination than <cite>account-bar&#64;example.org</cite>.
qmail does this by using separate <code class="file docutils literal notranslate"><span class="pre">.qmail</span></code> files for the two destinations (<code class="file docutils literal notranslate"><span class="pre">.qmail-foo</span></code> and <code class="file docutils literal notranslate"><span class="pre">.qmail-bar</span></code>, with <code class="file docutils literal notranslate"><span class="pre">.qmail</span></code> controlling the base address and <code class="file docutils literal notranslate"><span class="pre">.qmail-default</span></code> controlling all other extensions).
Other MTAs have similar mechanisms.</p>
<p>Thus you can assign an extension address like <cite>foo-buildmaster&#64;example.org</cite> to the buildmaster, and retain <cite>foo&#64;example.org</cite> for your own use.</p>
</div>
<div class="section" id="using-maildirs">
<span id="id5"></span><h6><a class="toc-backref" href="#id32">Using Maildirs</a><a class="headerlink" href="#using-maildirs" title="Permalink to this headline">¶</a></h6>
<p>A <cite>maildir</cite> is a simple directory structure originally developed for qmail that allows safe atomic update without locking.
Create a base directory with three subdirectories: <code class="file docutils literal notranslate"><span class="pre">new</span></code>, <code class="file docutils literal notranslate"><span class="pre">tmp</span></code>, and <code class="file docutils literal notranslate"><span class="pre">cur</span></code>.
When messages arrive, they are put into a uniquely-named file (using pids, timestamps, and random numbers) in <code class="file docutils literal notranslate"><span class="pre">tmp</span></code>. When the file is complete, it is atomically renamed into <code class="file docutils literal notranslate"><span class="pre">new</span></code>. Eventually the buildmaster notices the file in <code class="file docutils literal notranslate"><span class="pre">new</span></code>, reads and parses the contents, then moves it into <code class="file docutils literal notranslate"><span class="pre">cur</span></code>. A cronjob can be used to delete files in <code class="file docutils literal notranslate"><span class="pre">cur</span></code> at leisure.</p>
<p>Maildirs are frequently created with the <strong class="command">maildirmake</strong> tool, but a simple <code class="samp docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">~/</span><em><span class="pre">MAILDIR</span></em><span class="pre">/</span><em><span class="pre">cur,new,tmp</span></em></code> is pretty much equivalent.</p>
<p>Many modern MTAs can deliver directly to maildirs.
The usual <code class="file docutils literal notranslate"><span class="pre">.forward</span></code> or <code class="file docutils literal notranslate"><span class="pre">.procmailrc</span></code> syntax is to name the base directory with a trailing slash, so something like <code class="samp docutils literal notranslate"><span class="pre">~/</span><em><span class="pre">MAILDIR</span></em><span class="pre">/</span></code>.
qmail and postfix are maildir-capable MTAs, and procmail is a maildir-capable MDA (Mail Delivery Agent).</p>
<p>Here is an example procmail config, located in <code class="file docutils literal notranslate"><span class="pre">~/.procmailrc</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># .procmailrc
# routes incoming mail to appropriate mailboxes
PATH=/usr/bin:/usr/local/bin
MAILDIR=$HOME/Mail
LOGFILE=.procmail_log
SHELL=/bin/sh

:0
*
new
</pre></div>
</div>
<p>If procmail is not setup on a system wide basis, then the following one-line <code class="file docutils literal notranslate"><span class="pre">.forward</span></code> file will invoke it.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>!/usr/bin/procmail
</pre></div>
</div>
<p>For MTAs which cannot put files into maildirs directly, the <cite>safecat</cite> tool can be executed from a <code class="file docutils literal notranslate"><span class="pre">.forward</span></code> file to accomplish the same thing.</p>
<p>The Buildmaster uses the linux DNotify facility to receive immediate notification when the maildir’s <code class="file docutils literal notranslate"><span class="pre">new</span></code> directory has changed.
When this facility is not available, it polls the directory for new messages, every 10 seconds by default.</p>
</div>
<div class="section" id="parsing-email-change-messages">
<span id="id6"></span><h6><a class="toc-backref" href="#id33">Parsing Email Change Messages</a><a class="headerlink" href="#parsing-email-change-messages" title="Permalink to this headline">¶</a></h6>
<p>The second component to setting up an email-based <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code> is to parse the actual notices.
This is highly dependent upon the VC system and commit script in use.</p>
<p>A couple of common tools used to create these change emails, along with the Buildbot tools to parse them, are:</p>
<dl class="docutils">
<dt>CVS</dt>
<dd><dl class="first last docutils">
<dt>Buildbot CVS MailNotifier</dt>
<dd><a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">CVSMaildirSource</span></code></a></dd>
</dl>
</dd>
<dt>SVN</dt>
<dd><dl class="first last docutils">
<dt>svnmailer</dt>
<dd><a class="reference external" href="http://opensource.perlig.de/en/svnmailer/">http://opensource.perlig.de/en/svnmailer/</a></dd>
<dt><code class="file docutils literal notranslate"><span class="pre">commit-email.pl</span></code></dt>
<dd><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNCommitEmailMaildirSource</span></code></a></dd>
</dl>
</dd>
<dt>Bzr</dt>
<dd><dl class="first last docutils">
<dt>Launchpad</dt>
<dd><a class="reference internal" href="#chsrc-BzrLaunchpadEmailMaildirSource" title="BzrLaunchpadEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BzrLaunchpadEmailMaildirSource</span></code></a></dd>
</dl>
</dd>
<dt>Mercurial</dt>
<dd><dl class="first last docutils">
<dt>NotifyExtension</dt>
<dd><a class="reference external" href="https://www.mercurial-scm.org/wiki/NotifyExtension">https://www.mercurial-scm.org/wiki/NotifyExtension</a></dd>
</dl>
</dd>
<dt>Git</dt>
<dd><dl class="first last docutils">
<dt>post-receive-email</dt>
<dd><a class="reference external" href="http://git.kernel.org/?p=git/git.git;a=blob;f=contrib/hooks/post-receive-email;hb=HEAD">http://git.kernel.org/?p=git/git.git;a=blob;f=contrib/hooks/post-receive-email;hb=HEAD</a></dd>
</dl>
</dd>
</dl>
<p>The following sections describe the parsers available for each of these tools.</p>
<p>Most of these parsers accept a <code class="docutils literal notranslate"><span class="pre">prefix=</span></code> argument, which is used to limit the set of files that the buildmaster pays attention to.
This is most useful for systems like CVS and SVN which put multiple projects in a single repository (or use repository names to indicate branches).
Each filename that appears in the email is tested against the prefix: if the filename does not start with the prefix, the file is ignored.
If the filename <em>does</em> start with the prefix, that prefix is stripped from the filename before any further processing is done.
Thus the prefix usually ends with a slash.</p>
</div>
<div class="section" id="cvsmaildirsource">
<span id="chsrc-CVSMaildirSource"></span><span id="id7"></span><h6><a class="toc-backref" href="#id34">CVSMaildirSource</a><a class="headerlink" href="#cvsmaildirsource" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.changes.mail.CVSMaildirSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.mail.</code><code class="descname">CVSMaildirSource</code><a class="headerlink" href="#buildbot.changes.mail.CVSMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This parser works with the <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/buildbot_cvs_mail.py">master/contrib/buildbot_cvs_mail.py</a> script.</p>
<p>The script sends an email containing all the files submitted in one directory.
It is invoked by using the <code class="file docutils literal notranslate"><span class="pre">CVSROOT/loginfo</span></code> facility.</p>
<p>The Buildbot’s <a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">CVSMaildirSource</span></code></a> knows how to parse these messages and turn them into Change objects.
It takes the directory name of the maildir root.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">CVSMaildirSource</span><span class="p">(</span><span class="s2">&quot;/home/buildbot/Mail&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="configuration-of-cvs-and-buildbot-cvs-mail-py">
<h7>Configuration of CVS and <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/buildbot_cvs_mail.py">buildbot_cvs_mail.py</a><a class="headerlink" href="#configuration-of-cvs-and-buildbot-cvs-mail-py" title="Permalink to this headline">¶</a></h7>
<p>CVS must be configured to invoke the <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/buildbot_cvs_mail.py">buildbot_cvs_mail.py</a> script when files are checked in.
This is done via the CVS loginfo configuration file.</p>
<p>To update this, first do:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cvs checkout CVSROOT
</pre></div>
</div>
<p>cd to the CVSROOT directory and edit the file loginfo, adding a line like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SomeModule /cvsroot/CVSROOT/buildbot_cvs_mail.py --cvsroot :ext:example.com:/cvsroot -e buildbot -P SomeModule %@{sVv@}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For cvs version 1.12.x, the <code class="docutils literal notranslate"><span class="pre">--path</span> <span class="pre">%p</span></code> option is required.
Version 1.11.x and 1.12.x report the directory path differently.</p>
</div>
<p>The above example you put the <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/buildbot_cvs_mail.py">buildbot_cvs_mail.py</a> script under /cvsroot/CVSROOT.
It can be anywhere.
Run the script with <code class="docutils literal notranslate"><span class="pre">--help</span></code> to see all the options.
At the very least, the options <code class="docutils literal notranslate"><span class="pre">-e</span></code> (email) and <code class="docutils literal notranslate"><span class="pre">-P</span></code> (project) should be specified.
The line must end with <code class="docutils literal notranslate"><span class="pre">%{sVv}</span></code>.
This is expanded to the files that were modified.</p>
<p>Additional entries can be added to support more modules.</p>
<p>See <strong class="command">buildbot_cvs_mail.py --help</strong> for more information on the available options.</p>
</div>
</div>
<div class="section" id="svncommitemailmaildirsource">
<span id="chsrc-SVNCommitEmailMaildirSource"></span><span id="id8"></span><h6><a class="toc-backref" href="#id35">SVNCommitEmailMaildirSource</a><a class="headerlink" href="#svncommitemailmaildirsource" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.changes.mail.SVNCommitEmailMaildirSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.mail.</code><code class="descname">SVNCommitEmailMaildirSource</code><a class="headerlink" href="#buildbot.changes.mail.SVNCommitEmailMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNCommitEmailMaildirSource</span></code></a> parses message sent out by the <code class="file docutils literal notranslate"><span class="pre">commit-email.pl</span></code> script, which is included in the Subversion distribution.</p>
<p>It does not currently handle branches: all of the Change objects that it creates will be associated with the default (i.e. trunk) branch.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNCommitEmailMaildirSource</span><span class="p">(</span><span class="s2">&quot;~/maildir-buildbot&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="bzrlaunchpademailmaildirsource">
<span id="chsrc-BzrLaunchpadEmailMaildirSource"></span><span id="id9"></span><h6><a class="toc-backref" href="#id36">BzrLaunchpadEmailMaildirSource</a><a class="headerlink" href="#bzrlaunchpademailmaildirsource" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.changes.mail.BzrLaunchpadEmailMaildirSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.mail.</code><code class="descname">BzrLaunchpadEmailMaildirSource</code><a class="headerlink" href="#buildbot.changes.mail.BzrLaunchpadEmailMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-BzrLaunchpadEmailMaildirSource" title="BzrLaunchpadEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BzrLaunchpadEmailMaildirSource</span></code></a> parses the mails that are sent to addresses that subscribe to branch revision notifications for a bzr branch hosted on Launchpad.</p>
<p>The branch name defaults to <code class="samp docutils literal notranslate"><span class="pre">lp:</span><em><span class="pre">Launchpad</span> <span class="pre">path</span></em></code>.
For example <code class="docutils literal notranslate"><span class="pre">lp:~maria-captains/maria/5.1</span></code>.</p>
<p>If only a single branch is used, the default branch name can be changed by setting <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code>.</p>
<p>For multiple branches, pass a dictionary as the value of the <code class="docutils literal notranslate"><span class="pre">branchMap</span></code> option to map specific repository paths to specific branch names (see example below).
The leading <code class="docutils literal notranslate"><span class="pre">lp:</span></code> prefix of the path is optional.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">prefix</span></code> option is not supported (it is silently ignored).
Use the <code class="docutils literal notranslate"><span class="pre">branchMap</span></code> and <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code> instead to assign changes to branches (and just do not subscribe the Buildbot to branches that are not of interest).</p>
<p>The revision number is obtained from the email text.
The bzr revision id is not available in the mails sent by Launchpad.
However, it is possible to set the bzr <cite>append_revisions_only</cite> option for public shared repositories to avoid new pushes of merges changing the meaning of old revision numbers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">bm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lp:~maria-captains/maria/5.1&#39;</span><span class="p">:</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lp:~maria-captains/maria/6.0&#39;</span><span class="p">:</span> <span class="s1">&#39;6.0&#39;</span>
<span class="p">}</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">BzrLaunchpadEmailMaildirSource</span><span class="p">(</span><span class="s2">&quot;~/maildir-buildbot&quot;</span><span class="p">,</span>
                                                            <span class="n">branchMap</span><span class="o">=</span><span class="n">bm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pbchangesource">
<span id="chsrc-PBChangeSource"></span><span id="id10"></span><h5><a class="toc-backref" href="#id37">2.5.3.5. PBChangeSource</a><a class="headerlink" href="#pbchangesource" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.pb.PBChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.pb.</code><code class="descname">PBChangeSource</code><a class="headerlink" href="#buildbot.changes.pb.PBChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> actually listens on a TCP port for clients to connect and push change notices <em>into</em> the Buildmaster.
This is used by the built-in <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code> notification tool, as well as several version-control hook scripts.
This change is also useful for creating new kinds of change sources that work on a <cite>push</cite> model instead of some kind of subscription scheme, for example a script which is run out of an email <code class="file docutils literal notranslate"><span class="pre">.forward</span></code> file.
This ChangeSource always runs on the same TCP port as the workers.
It shares the same protocol, and in fact shares the same space of “usernames”, so you cannot configure a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> with the same name as a worker.</p>
<p>If you have a publicly accessible worker port, and are using <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a>, <em>you must establish a secure username and password for the change source</em>.
If your sendchange credentials are known (e.g., the defaults), then your buildmaster is susceptible to injection of arbitrary changes, which (depending on the build factories) could lead to arbitrary code execution on workers.</p>
<p>The <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> is created with the following arguments.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt>
<dd>which port to listen on.
If <code class="docutils literal notranslate"><span class="pre">None</span></code> (which is the default), it shares the port used for worker connections.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">user</span></code></dt>
<dd>The user account that the client program must use to connect.
Defaults to <code class="docutils literal notranslate"><span class="pre">change</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">passwd</span></code></dt>
<dd>The password for the connection - defaults to <code class="docutils literal notranslate"><span class="pre">changepw</span></code>.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.
Do not use this default on a publicly exposed port!</dd>
<dt><code class="docutils literal notranslate"><span class="pre">prefix</span></code></dt>
<dd><p class="first">The prefix to be found and stripped from filenames delivered over the connection, defaulting to <code class="docutils literal notranslate"><span class="pre">None</span></code>.
Any filenames which do not start with this prefix will be removed.
If all the filenames in a given Change are removed, the that whole Change will be dropped.
This string should probably end with a directory separator.</p>
<p class="last">This is useful for changes coming from version control systems that represent branches as parent directories within the repository (like SVN and Perforce).
Use a prefix of <code class="docutils literal notranslate"><span class="pre">trunk/</span></code> or <code class="docutils literal notranslate"><span class="pre">project/branches/foobranch/</span></code> to only follow one branch and to get correct tree-relative filenames.
Without a prefix, the <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a> will probably deliver Changes with filenames like <code class="file docutils literal notranslate"><span class="pre">trunk/foo.c</span></code> instead of just <code class="file docutils literal notranslate"><span class="pre">foo.c</span></code>.
Of course this also depends upon the tool sending the Changes in (like <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code></a>) and what filenames it is delivering: that tool may be filtering and stripping prefixes at the sending end.</p>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">PBChangeSource</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;laura&#39;</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;fpga&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The following hooks are useful for sending changes to a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a>:</p>
<div class="section" id="bzr-hook">
<span id="id11"></span><h6><a class="toc-backref" href="#id38">Bzr Hook</a><a class="headerlink" href="#bzr-hook" title="Permalink to this headline">¶</a></h6>
<p>Bzr is also written in Python, and the Bzr hook depends on Twisted to send the changes.</p>
<p>To install, put <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/bzr_buildbot.py">master/contrib/bzr_buildbot.py</a> in one of your plugins locations a bzr plugins directory (e.g., <code class="file docutils literal notranslate"><span class="pre">~/.bazaar/plugins</span></code>).
Then, in one of your bazaar conf files (e.g., <code class="file docutils literal notranslate"><span class="pre">~/.bazaar/locations.conf</span></code>), set the location you want to connect with Buildbot with these keys:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">buildbot_on</span></code>
one of ‘commit’, ‘push, or ‘change’.
Turns the plugin on to report changes via commit, changes via push, or any changes to the trunk.
‘change’ is recommended.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot_server</span></code>
(required to send to a Buildbot master) the URL of the Buildbot master to which you will connect (as of this writing, the same server and port to which workers connect).</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot_port</span></code>
(optional, defaults to 9989) the port of the Buildbot master to which you will connect (as of this writing, the same server and port to which workers connect)</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot_pqm</span></code>
(optional, defaults to not pqm) Normally, the user that commits the revision is the user that is responsible for the change.
When run in a pqm (Patch Queue Manager, see <a class="reference external" href="https://launchpad.net/pqm">https://launchpad.net/pqm</a>) environment, the user that commits is the Patch Queue Manager, and the user that committed the <em>parent</em> revision is responsible for the change.
To turn on the pqm mode, set this value to any of (case-insensitive) “Yes”, “Y”, “True”, or “T”.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot_dry_run</span></code>
(optional, defaults to not a dry run) Normally, the post-commit hook will attempt to communicate with the configured Buildbot server and port.
If this parameter is included and any of (case-insensitive) “Yes”, “Y”, “True”, or “T”, then the hook will simply print what it would have sent, but not attempt to contact the Buildbot master.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot_send_branch_name</span></code>
(optional, defaults to not sending the branch name) If your Buildbot’s bzr source build step uses a repourl, do <em>not</em> turn this on.
If your buildbot’s bzr build step uses a baseURL, then you may set this value to any of (case-insensitive) “Yes”, “Y”, “True”, or “T” to have the Buildbot master append the branch name to the baseURL.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The bzr smart server (as of version 2.2.2) doesn’t know how to resolve <code class="docutils literal notranslate"><span class="pre">bzr://</span></code> urls into absolute paths so any paths in <code class="docutils literal notranslate"><span class="pre">locations.conf</span></code> won’t match, hence no change notifications will be sent to Buildbot.
Setting configuration parameters globally or in-branch might still work.
When Buildbot no longer has a hardcoded password, it will be a configuration option here as well.</p>
</div>
<p>Here’s a simple example that you might have in your <code class="file docutils literal notranslate"><span class="pre">~/.bazaar/locations.conf</span></code>.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[chroot-*:///var/local/myrepo/mybranch]</span>
<span class="na">buildbot_on</span> <span class="o">=</span> <span class="s">change</span>
<span class="na">buildbot_server</span> <span class="o">=</span> <span class="s">localhost</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="p4source">
<span id="chsrc-P4Source"></span><span id="id12"></span><h5><a class="toc-backref" href="#id39">2.5.3.6. P4Source</a><a class="headerlink" href="#p4source" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a> periodically polls a <a class="reference external" href="http://www.perforce.com/">Perforce</a> depot for changes.
It accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">p4port</span></code></dt>
<dd>The Perforce server to connect to (as <code class="samp docutils literal notranslate"><em><span class="pre">host</span></em><span class="pre">:</span><em><span class="pre">port</span></em></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4user</span></code></dt>
<dd>The Perforce user.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4passwd</span></code></dt>
<dd>The Perforce password.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4base</span></code></dt>
<dd>The base depot path to watch, without the trailing ‘/…’.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4bin</span></code></dt>
<dd>An optional string parameter.
Specify the location of the perforce command line binary (p4).
You only need to do this if the perforce binary is not in the path of the Buildbot user.
Defaults to <cite>p4</cite>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">split_file</span></code></dt>
<dd>A function that maps a pathname, without the leading <code class="docutils literal notranslate"><span class="pre">p4base</span></code>, to a (branch, filename) tuple.
The default just returns <code class="docutils literal notranslate"><span class="pre">(None,</span> <span class="pre">branchfile)</span></code>, which effectively disables branch support.
You should supply a function which understands your repository structure.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollInterval</span></code></dt>
<dd>How often to poll, in seconds.
Defaults to 600 (10 minutes).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a>.
This will then be set in any changes generated by the <code class="docutils literal notranslate"><span class="pre">P4Source</span></code>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch, False = wait for one pollInterval (default).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">histmax</span></code></dt>
<dd>The maximum number of changes to inspect at a time.
If more than this number occur since the last poll, older changes will be silently ignored.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">encoding</span></code></dt>
<dd>The character encoding of <code class="docutils literal notranslate"><span class="pre">p4</span></code>’s output.
This defaults to “utf8”, but if your commit messages are in another encoding, specify that here.
For example, if you’re using Perforce on Windows, you may need to use “cp437” as the encoding if “utf8” generates errors in your master log.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">server_tz</span></code></dt>
<dd>The timezone of the Perforce server, using the usual timezone format (e.g: <code class="docutils literal notranslate"><span class="pre">&quot;Europe/Stockholm&quot;</span></code>) in case it’s not in UTC.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">use_tickets</span></code></dt>
<dd>Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to use ticket-based authentication, instead of passwords (but you still need to specify <code class="docutils literal notranslate"><span class="pre">p4passwd</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ticket_login_interval</span></code></dt>
<dd>How often to get a new ticket, in seconds, when <code class="docutils literal notranslate"><span class="pre">use_tickets</span></code> is enabled.
Defaults to 86400 (24 hours).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">revlink</span></code></dt>
<dd>A function that maps branch and revision to a valid url (e.g. p4web), stored along with the change.
This function must be a callable which takes two arguments, the branch and the revision.
Defaults to lambda branch, revision: (u’‘)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">resolvewho</span></code></dt>
<dd>A function that resolves the Perforce <a class="reference external" href="mailto:'user&#37;&#52;&#48;workspace">‘user<span>&#64;</span>workspace</a>’ into a more verbose form, stored as the author of the change. Useful when usernames do not match email addresses and external, client-side lookup is required.
This function must be a callable which takes one argument.
Defaults to lambda who: (who)</dd>
</dl>
<div class="section" id="example-1">
<h6><a class="toc-backref" href="#id40">Example #1</a><a class="headerlink" href="#example-1" title="Permalink to this headline">¶</a></h6>
<p>This configuration uses the <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">P4PORT</span></code>, <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">P4USER</span></code>, and <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">P4PASSWD</span></code> specified in the buildmaster’s environment.
It watches a project in which the branch name is simply the next path component, and the file is all path components after.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">P4Source</span><span class="p">(</span><span class="n">p4base</span><span class="o">=</span><span class="s1">&#39;//depot/project/&#39;</span><span class="p">,</span>
                     <span class="n">split_file</span><span class="o">=</span><span class="k">lambda</span> <span class="n">branchfile</span><span class="p">:</span> <span class="n">branchfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</pre></div>
</div>
</div>
<div class="section" id="example-2">
<h6><a class="toc-backref" href="#id41">Example #2</a><a class="headerlink" href="#example-2" title="Permalink to this headline">¶</a></h6>
<p>Similar to the previous example but also resolves the branch and revision into a valid revlink.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">P4Source</span><span class="p">(</span><span class="n">p4base</span><span class="o">=</span><span class="s1">&#39;//depot/project/&#39;</span><span class="p">,</span>
                     <span class="n">split_file</span><span class="o">=</span><span class="k">lambda</span> <span class="n">branchfile</span><span class="p">:</span> <span class="n">branchfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
                     <span class="n">revlink</span><span class="o">=</span><span class="k">lambda</span> <span class="n">branch</span><span class="p">,</span> <span class="n">revision</span><span class="p">:</span> <span class="s1">&#39;http://p4web:8080/@md=d&amp;@/{}?ac=10&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">revision</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="svnpoller">
<span id="chsrc-SVNPoller"></span><span id="id14"></span><h5><a class="toc-backref" href="#id42">2.5.3.7. SVNPoller</a><a class="headerlink" href="#svnpoller" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.svnpoller.SVNPoller">
<em class="property">class </em><code class="descclassname">buildbot.changes.svnpoller.</code><code class="descname">SVNPoller</code><a class="headerlink" href="#buildbot.changes.svnpoller.SVNPoller" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> is a ChangeSource which periodically polls a <a class="reference external" href="http://subversion.tigris.org">Subversion</a> repository for new revisions, by running the <code class="docutils literal notranslate"><span class="pre">svn</span> <span class="pre">log</span></code> command in a subshell.
It can watch a single branch or multiple branches.</p>
<p><a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd><p class="first">The base URL path to watch, like <code class="docutils literal notranslate"><span class="pre">svn://svn.twistedmatrix.com/svn/Twisted/trunk</span></code>, or <code class="docutils literal notranslate"><span class="pre">http://divmod.org/svn/Divmo/</span></code>, or even <code class="docutils literal notranslate"><span class="pre">file:///home/svn/Repository/ProjectA/branches/1.5/</span></code>.
This must include the access scheme, the location of the repository (both the hostname for remote ones, and any additional directory names necessary to get to the repository), and the sub-path within the repository’s virtual filesystem for the project and branch of interest.</p>
<p class="last">The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> will only pay attention to files inside the subdirectory specified by the complete repourl.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">split_file</span></code></dt>
<dd><p class="first">A function to convert pathnames into <code class="docutils literal notranslate"><span class="pre">(branch,</span> <span class="pre">relative_pathname)</span></code> tuples.
Use this to explain your repository’s branch-naming policy to <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a>.
This function must accept a single string (the pathname relative to the repository) and return a two-entry tuple.
Directory pathnames always end with a right slash to distinguish them from files, like <code class="docutils literal notranslate"><span class="pre">trunk/src/</span></code>, or <code class="docutils literal notranslate"><span class="pre">src/</span></code>.
There are a few utility functions in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.changes.svnpoller</span></code> that can be used as a <code class="xref py py-meth docutils literal notranslate"><span class="pre">split_file</span></code> function; see below for details.</p>
<p>For directories, the relative pathname returned by <code class="xref py py-meth docutils literal notranslate"><span class="pre">split_file</span></code> should end with a right slash but an empty string is also accepted for the root, like <code class="docutils literal notranslate"><span class="pre">(&quot;branches/1.5.x&quot;,</span> <span class="pre">&quot;&quot;)</span></code> being converted from <code class="docutils literal notranslate"><span class="pre">&quot;branches/1.5.x/&quot;</span></code>.</p>
<p>The default value always returns <code class="docutils literal notranslate"><span class="pre">(None,</span> <span class="pre">path)</span></code>, which indicates that all files are on the trunk.</p>
<p class="last">Subclasses of <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> can override the <code class="xref py py-meth docutils literal notranslate"><span class="pre">split_file</span></code> method instead of using the <code class="docutils literal notranslate"><span class="pre">split_file=</span></code> argument.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a>, and can be used in a <a class="reference internal" href="#change-filters"><span class="std std-ref">Change Filter</span></a> for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">svnuser</span></code></dt>
<dd>An optional string parameter.
If set, the option <cite>–user</cite> argument will be added to all <strong class="command">svn</strong> commands.
Use this if you have to authenticate to the svn server before you can do <strong class="command">svn info</strong> or <strong class="command">svn log</strong> commands.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">svnpasswd</span></code></dt>
<dd>Like <code class="docutils literal notranslate"><span class="pre">svnuser</span></code>, this will cause a option <cite>–password</cite> argument to be passed to all <strong class="command">svn</strong> commands.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollInterval</span></code></dt>
<dd>How often to poll, in seconds.
Defaults to 600 (checking once every 10 minutes).
Lower this if you want the Buildbot to notice changes faster, raise it if you want to reduce the network and CPU load on your svn server.
Please be considerate of public SVN repositories by using a large interval when polling them.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch, False = wait for one pollInterval (default).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">histmax</span></code></dt>
<dd>The maximum number of changes to inspect at a time.
Every <code class="docutils literal notranslate"><span class="pre">pollInterval</span></code> seconds, the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> asks for the last <code class="docutils literal notranslate"><span class="pre">histmax</span></code> changes and looks through them for any revisions it does not already know about.
If more than <code class="docutils literal notranslate"><span class="pre">histmax</span></code> revisions have been committed since the last poll, older changes will be silently ignored.
Larger values of <code class="docutils literal notranslate"><span class="pre">histmax</span></code> will cause more time and memory to be consumed on each poll attempt.
<code class="docutils literal notranslate"><span class="pre">histmax</span></code> defaults to 100.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">svnbin</span></code></dt>
<dd>This controls the <strong class="command">svn</strong> executable to use.
If subversion is installed in a weird place on your system (outside of the buildmaster’s <span class="target" id="index-4"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>), use this to tell <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> where to find it.
The default value of <cite>svn</cite> will almost always be sufficient.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">revlinktmpl</span></code></dt>
<dd>This parameter is deprecated in favour of specifying a global revlink option.
This parameter allows a link to be provided for each revision (for example, to websvn or viewvc).
These links appear anywhere changes are shown, such as on build or change pages.
The proper form for this parameter is an URL with the portion that will substitute for a revision number replaced by ‘’%s’‘.
For example, <code class="docutils literal notranslate"><span class="pre">'http://myserver/websvn/revision.php?rev=%s'</span></code> could be used to cause revision links to be created to a websvn repository viewer.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cachepath</span></code></dt>
<dd>If specified, this is a pathname of a cache file that <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> will use to store its state between restarts of the master.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extra_args</span></code></dt>
<dd>If specified, the extra arguments will be added to the svn command args.</dd>
</dl>
<p>Several split file functions are available for common SVN repository layouts.
For a poller that is only monitoring trunk, the default split file function is available explicitly as <code class="docutils literal notranslate"><span class="pre">split_file_alwaystrunk</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;svn://svn.twistedmatrix.com/svn/Twisted/trunk&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_alwaystrunk</span><span class="p">)</span>
</pre></div>
</div>
<p>For repositories with the <code class="docutils literal notranslate"><span class="pre">/trunk</span></code> and <code class="samp docutils literal notranslate"><span class="pre">/branches/</span><em><span class="pre">BRANCH</span></em></code> layout, <code class="docutils literal notranslate"><span class="pre">split_file_branches</span></code> will do the job:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/amanda&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>When using this splitter the poller will set the <code class="docutils literal notranslate"><span class="pre">project</span></code> attribute of any changes to the <code class="docutils literal notranslate"><span class="pre">project</span></code> attribute of the poller.</p>
<p>For repositories with the <code class="samp docutils literal notranslate"><em><span class="pre">PROJECT</span></em><span class="pre">/trunk</span></code> and <code class="samp docutils literal notranslate"><em><span class="pre">PROJECT</span></em><span class="pre">/branches/</span><em><span class="pre">BRANCH</span></em></code> layout, <code class="docutils literal notranslate"><span class="pre">split_file_projects_branches</span></code> will do the job:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_projects_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>When using this splitter the poller will set the <code class="docutils literal notranslate"><span class="pre">project</span></code> attribute of any changes to the project determined by the splitter.</p>
<p>The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> is highly adaptable to various Subversion layouts.
See <a class="reference internal" href="#customizing-svnpoller"><span class="std std-ref">Customizing SVNPoller</span></a> for details and some common scenarios.</p>
</div>
<div class="section" id="bzr-poller">
<span id="chsrc-BzrPoller"></span><span id="id16"></span><h5><a class="toc-backref" href="#id43">2.5.3.8. Bzr Poller</a><a class="headerlink" href="#bzr-poller" title="Permalink to this headline">¶</a></h5>
<p>If you cannot insert a Bzr hook in the server, you can use the <a class="reference internal" href="#chsrc-BzrPoller" title="BzrPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BzrPoller</span></code></a>.
To use it, put <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/bzr_buildbot.py">master/contrib/bzr_buildbot.py</a> somewhere that your Buildbot configuration can import it.
Even putting it in the same directory as the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> should work.
Install the poller in the Buildbot configuration as with any other change source.
Minimally, provide a URL that you want to poll (<code class="docutils literal notranslate"><span class="pre">bzr://</span></code>, <code class="docutils literal notranslate"><span class="pre">bzr+ssh://</span></code>, or <code class="docutils literal notranslate"><span class="pre">lp:</span></code>), making sure the Buildbot user has necessary privileges.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># put bzr_buildbot.py file to the same directory as master.cfg</span>
<span class="kn">from</span> <span class="nn">bzr_buildbot</span> <span class="kn">import</span> <span class="n">BzrPoller</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BzrPoller</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;bzr://hostname/my_project&#39;</span><span class="p">,</span>
    <span class="n">poll_interval</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">BzrPoller</span></code> parameters are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">url</span></code></dt>
<dd>The URL to poll.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">poll_interval</span></code></dt>
<dd>The number of seconds to wait between polls.
Defaults to 10 minutes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch_name</span></code></dt>
<dd>Any value to be used as the branch name.
Defaults to None, or specify a string, or specify the constants from <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/bzr_buildbot.py">bzr_buildbot.py</a> <code class="docutils literal notranslate"><span class="pre">SHORT</span></code> or <code class="docutils literal notranslate"><span class="pre">FULL</span></code> to get the short branch name or full branch address.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">blame_merge_author</span></code></dt>
<dd>normally, the user that commits the revision is the user that is responsible for the change.
When run in a pqm (Patch Queue Manager, see <a class="reference external" href="https://launchpad.net/pqm">https://launchpad.net/pqm</a>) environment, the user that commits is the Patch Queue Manager, and the user that committed the merged, <em>parent</em> revision is responsible for the change.
Set this value to <code class="docutils literal notranslate"><span class="pre">True</span></code> if this is pointed against a PQM-managed branch.</dd>
</dl>
</div>
<div class="section" id="gitpoller">
<span id="chsrc-GitPoller"></span><span id="id17"></span><h5><a class="toc-backref" href="#id44">2.5.3.9. GitPoller</a><a class="headerlink" href="#gitpoller" title="Permalink to this headline">¶</a></h5>
<p>If you cannot take advantage of post-receive hooks as provided by <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/git_buildbot.py">master/contrib/git_buildbot.py</a> for example, then you can use the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a>.</p>
<p>The <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> periodically fetches from a remote Git repository and processes any changes.
It requires its own working directory for operation.
The default should be adequate, but it can be overridden via the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> property.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There can only be a single <cite>GitPoller</cite> pointed at any given repository.</p>
</div>
<p>The <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> requires Git-1.7 and later.
It accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd>the git-url that describes the remote repository, e.g. <code class="docutils literal notranslate"><span class="pre">git&#64;example.com:foobaz/myrepo.git</span></code> (see the <strong class="command">git fetch</strong> help for more info on git-url formats)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branches</span></code></dt>
<dd><p class="first">One of the following:</p>
<ul class="last simple">
<li>a list of the branches to fetch.</li>
<li><code class="docutils literal notranslate"><span class="pre">True</span></code> indicating that all branches should be fetched</li>
<li>a callable which takes a single argument.
It should take a remote refspec (such as <code class="docutils literal notranslate"><span class="pre">'refs/heads/master'</span></code>, and return a boolean indicating whether that branch should be fetched.</li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>accepts a single branch name to fetch.
Exists for backwards compatibility with old configurations.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollInterval</span></code></dt>
<dd>interval in seconds between polls, default is 10 minutes</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch, False = wait for one pollInterval (default).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buildPushesWithNoCommits</span></code></dt>
<dd>Determine if a push on a new branch or update of an already known branch with
already known commits should trigger a build.
This is useful in case you have build steps depending on the name of the
branch and you use topic branches for development. When you merge your topic
branch into “master” (for instance), a new build will be triggered.
(defaults to False).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gitbin</span></code></dt>
<dd>path to the Git binary, defaults to just <code class="docutils literal notranslate"><span class="pre">'git'</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">category</span></code></dt>
<dd>Set the category to be used for the changes produced by the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a>.
This will then be set in any changes generated by the <code class="docutils literal notranslate"><span class="pre">GitPoller</span></code>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usetimestamps</span></code></dt>
<dd>parse each revision’s commit timestamp (default is <code class="docutils literal notranslate"><span class="pre">True</span></code>), or ignore it in favor of the current time (so recently processed commits appear together in the waterfall page)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">encoding</span></code></dt>
<dd>Set encoding will be used to parse author’s name and commit message.
Default encoding is <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code>.
This will not be applied to file names since Git will translate non-ascii file names to unreadable escape sequences.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt>
<dd>the directory where the poller should keep its local repository.
The default is <code class="samp docutils literal notranslate"><span class="pre">gitpoller_work</span></code>.
If this is a relative path, it will be interpreted relative to the master’s basedir.
Multiple Git pollers can share the same directory.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">only_tags</span></code></dt>
<dd>Determines if the GitPoller should poll for new tags in the git repository.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sshPrivateKey</span></code></dt>
<dd>Specifies private SSH key for git to use. This may be either a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>
or just a string. This option requires Git-2.3 or later. The master must
either have the host in the known hosts file or the host key must be
specified via the <cite>sshHostKey</cite> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sshHostKey</span></code></dt>
<dd>Specifies public host key to match when authenticating with SSH
public key authentication. This may be either a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a> or just a
string. <cite>sshPrivateKey</cite> must be specified in order to use this option.
The host key must be in the form of <cite>&lt;key type&gt; &lt;base64-encoded string&gt;</cite>,
e.g. <cite>ssh-rsa AAAAB3N&lt;…&gt;FAaQ==</cite>.</dd>
</dl>
<p>A configuration for the Git poller might look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">GitPoller</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;git@example.com:foobaz/myrepo.git&#39;</span><span class="p">,</span>
                                       <span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;master&#39;</span><span class="p">,</span> <span class="s1">&#39;great_new_feature&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="hgpoller">
<span id="chsrc-HgPoller"></span><span id="id18"></span><h5><a class="toc-backref" href="#id45">2.5.3.10. HgPoller</a><a class="headerlink" href="#hgpoller" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a> periodically pulls a named branch from a remote Mercurial repository and processes any changes.
It requires its own working directory for operation, which must be specified via the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> property.</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a> requires a working <code class="docutils literal notranslate"><span class="pre">hg</span></code> executable, and at least a read-only access to the repository it polls (possibly through ssh keys or by tweaking the <code class="docutils literal notranslate"><span class="pre">hgrc</span></code> of the system user Buildbot runs as).</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a> will not transmit any change if there are several heads on the watched named branch.
This is similar (although not identical) to the Mercurial executable behaviour.
This exceptional condition is usually the result of a developer mistake, and usually does not last for long.
It is reported in logs.
If fixed by a later merge, the buildmaster administrator does not have anything to do: that merge will be transmitted, together with the intermediate ones.</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>the name of the poller.
This must be unique, and defaults to the <code class="docutils literal notranslate"><span class="pre">repourl</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd>the url that describes the remote repository, e.g. <code class="docutils literal notranslate"><span class="pre">http://hg.example.com/projects/myrepo</span></code>.
Any url suitable for <code class="docutils literal notranslate"><span class="pre">hg</span> <span class="pre">pull</span></code> can be specified.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>the desired branch to pull, will default to <code class="docutils literal notranslate"><span class="pre">'default'</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt>
<dd><p class="first">the directory where the poller should keep its local repository.
It is mandatory for now, although later releases may provide a meaningful default.</p>
<p>It also serves to identify the poller in the buildmaster internal database.
Changing it may result in re-processing all changes so far.</p>
<p>Several <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a> instances may share the same <code class="docutils literal notranslate"><span class="pre">workdir</span></code> for mutualisation of the common history between two different branches, thus easing on local and remote system resources and bandwidth.</p>
<p class="last">If relative, the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> will be interpreted from the master directory.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollInterval</span></code></dt>
<dd>interval in seconds between polls, default is 10 minutes</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch, False = wait for one pollInterval (default).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hgbin</span></code></dt>
<dd>path to the Mercurial binary, defaults to just <code class="docutils literal notranslate"><span class="pre">'hg'</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">category</span></code></dt>
<dd>Set the category to be used for the changes produced by the <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a>.
This will then be set in any changes generated by the <code class="docutils literal notranslate"><span class="pre">HgPoller</span></code>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usetimestamps</span></code></dt>
<dd>parse each revision’s commit timestamp (default is <code class="docutils literal notranslate"><span class="pre">True</span></code>), or ignore it in favor of the current time (so recently processed commits appear together in the waterfall page)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">encoding</span></code></dt>
<dd>Set encoding will be used to parse author’s name and commit message.
Default encoding is <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code>.</dd>
</dl>
<p>A configuration for the Mercurial poller might look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">HgPoller</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;http://hg.example.org/projects/myrepo&#39;</span><span class="p">,</span>
                                      <span class="n">branch</span><span class="o">=</span><span class="s1">&#39;great_new_feature&#39;</span><span class="p">,</span>
                                      <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;hg-myrepo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="githubpullrequestpoller">
<span id="chsrc-GitHubPullrequestPoller"></span><span id="id19"></span><h5><a class="toc-backref" href="#id46">2.5.3.11. GitHubPullrequestPoller</a><a class="headerlink" href="#githubpullrequestpoller" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.github.GitHubPullrequestPoller">
<em class="property">class </em><code class="descclassname">buildbot.changes.github.</code><code class="descname">GitHubPullrequestPoller</code><a class="headerlink" href="#buildbot.changes.github.GitHubPullrequestPoller" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This <a class="reference internal" href="#chsrc-GitHubPullrequestPoller" title="GitHubPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHubPullrequestPoller</span></code></a> periodically polls the GitHub API for new or updated pull requests. The <cite>author</cite>, <cite>revision</cite>, <cite>revlink</cite>, <cite>branch</cite> and <cite>files</cite> fields in the recorded changes are populated with information extracted from the pull request. This allows to filter for certain changes in files and create a blamelist based on the authors in the GitHub pull request.</p>
<p>The <a class="reference internal" href="#chsrc-GitHubPullrequestPoller" title="GitHubPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHubPullrequestPoller</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">owner</span></code></dt>
<dd>The owner of the GitHub repository. This argument is required.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repo</span></code></dt>
<dd>The name of the GitHub repository. This argument is required.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branches</span></code></dt>
<dd>List of branches to accept as base branch (e.g. master). Defaults to <cite>None</cite> and accepts all branches as base.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollInterval</span></code></dt>
<dd>Poll interval between polls in seconds. Default is 10 minutes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Whether to poll on startup of the buildbot master. Default is <cite>False</cite> and first poll will occur <cite>pollInterval</cite> seconds after the master start.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">category</span></code></dt>
<dd>Set the category to be used for the changes produced by the <a class="reference internal" href="#chsrc-GitHubPullrequestPoller" title="GitHubPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHubPullrequestPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-GitHubPullrequestPoller" title="GitHubPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHubPullrequestPoller</span></code></a>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseURL</span></code></dt>
<dd>GitHub API endpoint. Default is <code class="docutils literal notranslate"><span class="pre">https://api.github.com</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pullrequest_filter</span></code></dt>
<dd>A callable which takes a <cite>dict</cite> which contains the decoded <cite>JSON</cite> object of the GitHub pull request as argument. All fields specified by the GitHub API are accessible. If the callable returns <cite>False</cite> the pull request is ignored. Default is <cite>True</cite> which does not filter any pull requests.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">token</span></code></dt>
<dd>A GitHub API token to execute all requests to the API authenticated. It is strongly recommended to use a API token since it increases GitHub API rate limits significantly.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repository_type</span></code></dt>
<dd>Set which type of repository link will be in the <cite>repository</cite> property. Possible values <code class="docutils literal notranslate"><span class="pre">https</span></code>, <code class="docutils literal notranslate"><span class="pre">svn</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span></code> or <code class="docutils literal notranslate"><span class="pre">svn</span></code>. This link can then be used in a Source Step to checkout the source.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">magic_link</span></code></dt>
<dd>Set to <cite>True</cite> if the changes should contain <code class="docutils literal notranslate"><span class="pre">refs/pulls/&lt;PR</span> <span class="pre">#&gt;/merge</span></code> in the <cite>branch</cite> property and a link to the base <cite>repository</cite> in the repository property. These properties can be used by the <a class="reference internal" href="#step-GitHub" title="GitHub"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitHub</span></code></a> source to pull from the special branch in the base repository. Default is <cite>False</cite>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">github_property_whitelist</span></code></dt>
<dd>A list of <code class="docutils literal notranslate"><span class="pre">fnmatch</span></code> expressions which match against the flattened pull request information JSON prefixed with <code class="docutils literal notranslate"><span class="pre">github</span></code>. For example <code class="docutils literal notranslate"><span class="pre">github.number</span></code> represents the pull request number. Available entries can be looked up in the GitHub API Documentation or by examining the data returned for a pull request by the API.</dd>
</dl>
</div>
<div class="section" id="bitbucketpullrequestpoller">
<span id="chsrc-BitbucketPullrequestPoller"></span><span id="id20"></span><h5><a class="toc-backref" href="#id47">2.5.3.12. BitbucketPullrequestPoller</a><a class="headerlink" href="#bitbucketpullrequestpoller" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.bitbucket.BitbucketPullrequestPoller">
<em class="property">class </em><code class="descclassname">buildbot.changes.bitbucket.</code><code class="descname">BitbucketPullrequestPoller</code><a class="headerlink" href="#buildbot.changes.bitbucket.BitbucketPullrequestPoller" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code></a> periodically polls Bitbucket for new or updated pull requests.
It uses Bitbuckets powerful <a class="reference external" href="https://confluence.atlassian.com/display/BITBUCKET/pullrequests+Resource">Pull Request REST API</a> to gather the information needed.</p>
<p>The <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">owner</span></code></dt>
<dd>The owner of the Bitbucket repository.
All Bitbucket Urls are of the form <code class="docutils literal notranslate"><span class="pre">https://bitbucket.org/owner/slug/</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">slug</span></code></dt>
<dd>The name of the Bitbucket repository.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>A single branch or a list of branches which should be processed.
If it is <code class="docutils literal notranslate"><span class="pre">None</span></code> (the default) all pull requests are used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollInterval</span></code></dt>
<dd>Interval in seconds between polls, default is 10 minutes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
<code class="docutils literal notranslate"><span class="pre">True</span></code> = immediately on launch, <code class="docutils literal notranslate"><span class="pre">False</span></code> = wait for one <code class="docutils literal notranslate"><span class="pre">pollInterval</span></code> (default).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">category</span></code></dt>
<dd>Set the category to be used for the changes produced by the <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code></a>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code></a>.
This will then be set in any changes generated by the <code class="docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pullrequest_filter</span></code></dt>
<dd>A callable which takes one parameter, the decoded Python object of the pull request JSON.
If the it returns <code class="docutils literal notranslate"><span class="pre">False</span></code> the pull request is ignored.
It can be used to define custom filters based on the content of the pull request.
See the Bitbucket documentation for more information about the format of the response.
By default the filter always returns <code class="docutils literal notranslate"><span class="pre">True</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usetimestamps</span></code></dt>
<dd>parse each revision’s commit timestamp (default is <code class="docutils literal notranslate"><span class="pre">True</span></code>), or ignore it in favor of the current time (so recently processed commits appear together in the waterfall page)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">encoding</span></code></dt>
<dd>Set encoding will be used to parse author’s name and commit message.
Default encoding is <code class="docutils literal notranslate"><span class="pre">'utf-8'</span></code>.</dd>
</dl>
<p>A minimal configuration for the Bitbucket pull request poller might look like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">BitbucketPullrequestPoller</span><span class="p">(</span>
    <span class="n">owner</span><span class="o">=</span><span class="s1">&#39;myname&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s1">&#39;myrepo&#39;</span><span class="p">,</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>Here is a more complex configuration using a <code class="docutils literal notranslate"><span class="pre">pullrequest_filter</span></code>.
The pull request is only processed if at least 3 people have already approved it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">approve_filter</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="n">approves</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">participant</span> <span class="ow">in</span> <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;participants&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">participant</span><span class="p">[</span><span class="s1">&#39;approved&#39;</span><span class="p">]:</span>
            <span class="n">approves</span> <span class="o">=</span> <span class="n">approves</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">approves</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">BitbucketPullrequestPoller</span><span class="p">(</span>
    <span class="n">owner</span><span class="o">=</span><span class="s1">&#39;myname&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s1">&#39;myrepo&#39;</span><span class="p">,</span>
    <span class="n">branch</span><span class="o">=</span><span class="s1">&#39;mybranch&#39;</span><span class="p">,</span>
    <span class="n">project</span><span class="o">=</span><span class="s1">&#39;myproject&#39;</span><span class="p">,</span>
    <span class="n">pullrequest_filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pr</span> <span class="p">:</span> <span class="n">approve_filter</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">pollInterval</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Anyone who can create pull requests for the Bitbucket repository can initiate a change, potentially causing the buildmaster to run arbitrary code.</p>
</div>
</div>
<div class="section" id="gerritchangesource">
<span id="chsrc-GerritChangeSource"></span><span id="id21"></span><h5><a class="toc-backref" href="#id48">2.5.3.13. GerritChangeSource</a><a class="headerlink" href="#gerritchangesource" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.gerritchangesource.GerritChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.gerritchangesource.</code><code class="descname">GerritChangeSource</code><a class="headerlink" href="#buildbot.changes.gerritchangesource.GerritChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a> class connects to a Gerrit server by its SSH interface and uses its event source mechanism, <a class="reference external" href="https://gerrit-documentation.storage.googleapis.com/Documentation/2.2.1/cmd-stream-events.html">gerrit stream-events</a>.</p>
<p>The <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">gerritserver</span></code></dt>
<dd>the dns or ip that host the Gerrit ssh server</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gerritport</span></code></dt>
<dd>the port of the Gerrit ssh server</dd>
<dt><code class="docutils literal notranslate"><span class="pre">username</span></code></dt>
<dd>the username to use to connect to Gerrit</dd>
<dt><code class="docutils literal notranslate"><span class="pre">identity_file</span></code></dt>
<dd>ssh identity file to for authentication (optional).
Pay attention to the <cite>ssh passphrase</cite></dd>
<dt><code class="docutils literal notranslate"><span class="pre">handled_events</span></code></dt>
<dd>event to be handled (optional).
By default processes <cite>patchset-created</cite> and <cite>ref-updated</cite></dd>
<dt><code class="docutils literal notranslate"><span class="pre">debug</span></code></dt>
<dd>Print Gerrit event in the log (default <cite>False</cite>).
This allows to debug event content, but will eventually fill your logs with useless Gerrit event logs.</dd>
</dl>
<p>By default this class adds a change to the Buildbot system for each of the following events:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">patchset-created</span></code></dt>
<dd>A change is proposed for review.
Automatic checks like <code class="file docutils literal notranslate"><span class="pre">checkpatch.pl</span></code> can be automatically triggered.
Beware of what kind of automatic task you trigger.
At this point, no trusted human has reviewed the code, and a patch could be specially crafted by an attacker to compromise your workers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ref-updated</span></code></dt>
<dd>A change has been merged into the repository.
Typically, this kind of event can lead to a complete rebuild of the project, and upload binaries to an incremental build results server.</dd>
</dl>
<p>But you can specify how to handle events:</p>
<ul class="simple">
<li>Any event with change and patchSet will be processed by universal collector by default.</li>
<li>In case you’ve specified processing function for the given kind of events, all events of this kind will be processed only by this function, bypassing universal collector.</li>
</ul>
<p>An example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="k">class</span> <span class="nc">MyGerritChangeSource</span><span class="p">(</span><span class="n">changes</span><span class="o">.</span><span class="n">GerritChangeSource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom GerritChangeSource</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">eventReceived_patchset_created</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handler events without properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addChangeFromEvent</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</pre></div>
</div>
<p>This class will populate the property list of the triggered build with the info received from Gerrit server in JSON format.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you selected <code class="xref py py-class docutils literal notranslate"><span class="pre">GerritChangeSource</span></code>, you <strong>must</strong> use <a class="reference internal" href="#step-Gerrit" title="Gerrit"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Gerrit</span></code></a> source step: the <code class="docutils literal notranslate"><span class="pre">branch</span></code> property of the change will be <code class="samp docutils literal notranslate"><em><span class="pre">target_branch</span></em><span class="pre">/</span><em><span class="pre">change_id</span></em></code> and such a ref cannot be resolved, so the <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> source step would fail.</p>
</div>
<p id="index-5">In case of <code class="docutils literal notranslate"><span class="pre">patchset-created</span></code> event, these properties will be:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">event.change.branch</span></code></dt>
<dd>Branch of the Change</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.change.id</span></code></dt>
<dd>Change’s ID in the Gerrit system (the ChangeId: in commit comments)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.change.number</span></code></dt>
<dd>Change’s number in Gerrit system</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.change.owner.email</span></code></dt>
<dd>Change’s owner email (owner is first uploader)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.change.owner.name</span></code></dt>
<dd>Change’s owner name</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.change.project</span></code></dt>
<dd>Project of the Change</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.change.subject</span></code></dt>
<dd>Change’s subject</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.change.url</span></code></dt>
<dd>URL of the Change in the Gerrit’s web interface</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.patchSet.number</span></code></dt>
<dd>Patchset’s version number</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.patchSet.ref</span></code></dt>
<dd>Patchset’s Gerrit “virtual branch”</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.patchSet.revision</span></code></dt>
<dd>Patchset’s Git commit ID</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.patchSet.uploader.email</span></code></dt>
<dd>Patchset uploader’s email (owner is first uploader)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.patchSet.uploader.name</span></code></dt>
<dd>Patchset uploader’s name (owner is first uploader)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.type</span></code></dt>
<dd>Event type (<code class="docutils literal notranslate"><span class="pre">patchset-created</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.uploader.email</span></code></dt>
<dd>Patchset uploader’s email</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.uploader.name</span></code></dt>
<dd>Patchset uploader’s name</dd>
</dl>
<p>In case of <code class="docutils literal notranslate"><span class="pre">ref-updated</span></code> event, these properties will be:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">event.refUpdate.newRev</span></code></dt>
<dd>New Git commit ID (after merger)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.refUpdate.oldRev</span></code></dt>
<dd>Previous Git commit ID (before merger)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.refUpdate.project</span></code></dt>
<dd>Project that was updated</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.refUpdate.refName</span></code></dt>
<dd>Branch that was updated</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.submitter.email</span></code></dt>
<dd>Submitter’s email (merger responsible)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.submitter.name</span></code></dt>
<dd>Submitter’s name (merger responsible)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.type</span></code></dt>
<dd>Event type (<code class="docutils literal notranslate"><span class="pre">ref-updated</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.submitter.email</span></code></dt>
<dd>Submitter’s email (merger responsible)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">event.submitter.name</span></code></dt>
<dd>Submitter’s name (merger responsible)</dd>
</dl>
<p>A configuration for this source might look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">changes</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">GerritChangeSource</span><span class="p">(</span>
    <span class="s2">&quot;gerrit.example.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gerrit_user&quot;</span><span class="p">,</span>
    <span class="n">handled_events</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;patchset-created&quot;</span><span class="p">,</span> <span class="s2">&quot;change-merged&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>See <code class="file docutils literal notranslate"><span class="pre">master/docs/examples/git_gerrit.cfg</span></code> or <code class="file docutils literal notranslate"><span class="pre">master/docs/examples/repo_gerrit.cfg</span></code> in the Buildbot distribution for a full example setup of Git+Gerrit or Repo+Gerrit of <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a>.</p>
</div>
<div class="section" id="gerriteventlogpoller">
<span id="chsrc-GerritEventLogPoller"></span><span id="id22"></span><h5><a class="toc-backref" href="#id49">2.5.3.14. GerritEventLogPoller</a><a class="headerlink" href="#gerriteventlogpoller" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.gerritchangesource.GerritEventLogPoller">
<em class="property">class </em><code class="descclassname">buildbot.changes.gerritchangesource.</code><code class="descname">GerritEventLogPoller</code><a class="headerlink" href="#buildbot.changes.gerritchangesource.GerritEventLogPoller" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#chsrc-GerritEventLogPoller" title="GerritEventLogPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritEventLogPoller</span></code></a> class is similar to <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a> but connects to the Gerrit server by its HTTP interface and uses the <a class="reference external" href="https://gerrit.googlesource.com/plugins/events-log/">events-log</a> plugin.</p>
<p>The <a class="reference internal" href="#chsrc-GerritEventLogPoller" title="GerritEventLogPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritEventLogPoller</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">baseURL</span></code></dt>
<dd>the HTTP url where to find Gerrit</dd>
<dt><code class="docutils literal notranslate"><span class="pre">auth</span></code></dt>
<dd>a requests authentication configuration.
if Gerrit is configured with <code class="docutils literal notranslate"><span class="pre">BasicAuth</span></code>, then it shall be <code class="docutils literal notranslate"><span class="pre">('login',</span> <span class="pre">'password')</span></code>
if Gerrit is configured with <code class="docutils literal notranslate"><span class="pre">DigestAuth</span></code>, then it shall be <code class="docutils literal notranslate"><span class="pre">requests.auth.HTTPDigestAuth('login',</span> <span class="pre">'password')</span></code> from the requests module.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">handled_events</span></code></dt>
<dd>event to be handled (optional).
By default processes <cite>patchset-created</cite> and <cite>ref-updated</cite></dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollInterval</span></code></dt>
<dd>interval in seconds between polls, default is 30 seconds</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch (default), False = wait for one pollInterval.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gitBaseURL</span></code></dt>
<dd>The git URL where Gerrit is accessible via git+ssh protocol</dd>
<dt><code class="docutils literal notranslate"><span class="pre">debug</span></code></dt>
<dd>Print Gerrit event in the log (default <cite>False</cite>).
This allows to debug event content, but will eventually fill your logs with useless Gerrit event logs.</dd>
</dl>
<p>The same customization can be done as <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a> for handling special events.</p>
</div>
<div class="section" id="gerritchangefilter">
<h5><a class="toc-backref" href="#id50">2.5.3.15. GerritChangeFilter</a><a class="headerlink" href="#gerritchangefilter" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.gerritchangesource.GerritChangeFilter">
<em class="property">class </em><code class="descclassname">buildbot.changes.gerritchangesource.</code><code class="descname">GerritChangeFilter</code><a class="headerlink" href="#buildbot.changes.gerritchangesource.GerritChangeFilter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="xref py py-class docutils literal notranslate"><span class="pre">GerritChangeFilter</span></code> is a ready to use <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeFilter</span></code> you can pass to <a class="reference internal" href="#sched-AnyBranchScheduler" title="AnyBranchScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">AnyBranchScheduler</span></code></a> in order to filter changes, to create pre-commit builders or post-commit schedulers.
It has the same api as <a class="reference internal" href="#change-filters"><span class="std std-ref">Change Filter</span></a>, except it has additional <cite>eventtype</cite> set of filter (can as well be specified as value, list, regular expression or callable)</p>
<p>An example is following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">schedulers</span><span class="p">,</span> <span class="n">util</span>

<span class="c1"># this scheduler will create builds when a patch is uploaded to gerrit</span>
<span class="c1"># but only if it is uploaded to the &quot;main&quot; branch</span>
<span class="n">schedulers</span><span class="o">.</span><span class="n">AnyBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;main-precommit&quot;</span><span class="p">,</span>
                              <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">GerritChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span>
                                                                    <span class="n">eventtype</span><span class="o">=</span><span class="s2">&quot;patchset-created&quot;</span><span class="p">),</span>
                              <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                              <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;main-precommit&quot;</span><span class="p">])</span>

<span class="c1"># this scheduler will create builds when a patch is merged in the &quot;main&quot; branch</span>
<span class="c1"># for post-commit tests</span>
<span class="n">schedulers</span><span class="o">.</span><span class="n">AnyBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;main-postcommit&quot;</span><span class="p">,</span>
                              <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">GerritChangeFilter</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="s2">&quot;ref-updated&quot;</span><span class="p">),</span>
                              <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                              <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;main-postcommit&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="change-hooks-http-notifications">
<span id="chsrc-Change Hooks"></span><span id="id23"></span><h5><a class="toc-backref" href="#id51">2.5.3.16. Change Hooks (HTTP Notifications)</a><a class="headerlink" href="#change-hooks-http-notifications" title="Permalink to this headline">¶</a></h5>
<p>Buildbot already provides a web frontend, and that frontend can easily be used to receive HTTP push notifications of commits from services like GitHub.
See <a class="reference internal" href="#change-hooks"><span class="std std-ref">Change Hooks</span></a> for more information.</p>
</div>
</div>
<div class="section" id="changes">
<span id="change-attrs"></span><h4>2.5.4. Changes<a class="headerlink" href="#changes" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="buildbot.changes.changes.Change">
<em class="property">class </em><code class="descclassname">buildbot.changes.changes.</code><code class="descname">Change</code><a class="headerlink" href="#buildbot.changes.changes.Change" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> is an abstract way Buildbot uses to represent a single change to the source files performed by a developer.
In version control systems that support the notion of atomic check-ins a change represents a changeset or commit.
Instances of <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> have the following attributes.</p>
<div class="section" id="who">
<span id="change-attr-who"></span><h5>2.5.4.1. Who<a class="headerlink" href="#who" title="Permalink to this headline">¶</a></h5>
<p>Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> has a <code class="xref py py-attr docutils literal notranslate"><span class="pre">who</span></code> attribute, which specifies which developer is responsible for the change.
This is a string which comes from a namespace controlled by the VC repository.
Frequently this means it is a username on the host which runs the repository, but not all VC systems require this.
Each <code class="xref py py-class docutils literal notranslate"><span class="pre">StatusNotifier</span></code> will map the <code class="xref py py-attr docutils literal notranslate"><span class="pre">who</span></code> attribute into something appropriate for their particular means of communication: an email address, an IRC handle, etc.</p>
<p>This <code class="docutils literal notranslate"><span class="pre">who</span></code> attribute is also parsed and stored into Buildbot’s database (see <a class="reference internal" href="#user-objects"><span class="std std-ref">User Objects</span></a>).
Currently, only <code class="docutils literal notranslate"><span class="pre">who</span></code> attributes in Changes from <code class="docutils literal notranslate"><span class="pre">git</span></code> repositories are translated into user objects, but in the future all incoming Changes will have their <code class="docutils literal notranslate"><span class="pre">who</span></code> parsed and stored.</p>
</div>
<div class="section" id="files">
<span id="change-attr-files"></span><h5>2.5.4.2. Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h5>
<p>It also has a list of <code class="xref py py-attr docutils literal notranslate"><span class="pre">files</span></code>, which are just the tree-relative filenames of any files that were added, deleted, or modified for this <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>.
These filenames are used by the <code class="xref py py-func docutils literal notranslate"><span class="pre">fileIsImportant</span></code> function (in the scheduler) to decide whether it is worth triggering a new build or not, e.g. the function could use the following function to only run a build if a C file were checked in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">has_C_files</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">change</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.c&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Certain <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s can also use the list of changed files to run a more targeted series of tests, e.g. the <code class="docutils literal notranslate"><span class="pre">python_twisted.Trial</span></code> step can run just the unit tests that provide coverage for the modified .py files instead of running the full test suite.</p>
</div>
<div class="section" id="comments">
<span id="change-attr-comments"></span><h5>2.5.4.3. Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h5>
<p>The Change also has a <code class="xref py py-attr docutils literal notranslate"><span class="pre">comments</span></code> attribute, which is a string containing any checkin comments.</p>
</div>
<div class="section" id="project">
<span id="change-attr-project"></span><h5>2.5.4.4. Project<a class="headerlink" href="#project" title="Permalink to this headline">¶</a></h5>
<p>The <code class="xref py py-attr docutils literal notranslate"><span class="pre">project</span></code> attribute of a change or source stamp describes the project to which it corresponds, as a short human-readable string.
This is useful in cases where multiple independent projects are built on the same buildmaster.
In such cases, it can be used to control which builds are scheduled for a given commit, and to limit status displays to only one project.</p>
</div>
<div class="section" id="repository">
<span id="change-attr-repository"></span><h5>2.5.4.5. Repository<a class="headerlink" href="#repository" title="Permalink to this headline">¶</a></h5>
<p>This attribute specifies the repository in which this change occurred.
In the case of DVCS’s, this information may be required to check out the committed source code.
However, using the repository from a change has security risks: if Buildbot is configured to blindly trust this information, then it may easily be tricked into building arbitrary source code, potentially compromising the workers and the integrity of subsequent builds.</p>
</div>
<div class="section" id="codebase">
<span id="change-attr-codebase"></span><h5>2.5.4.6. Codebase<a class="headerlink" href="#codebase" title="Permalink to this headline">¶</a></h5>
<p>This attribute specifies the codebase to which this change was made.
As described in <a class="reference internal" href="#source-stamps"><span class="std std-ref">source stamps</span></a> section, multiple repositories may contain the same codebase.
A change’s codebase is usually determined by the <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">codebaseGenerator</span></code></a> configuration.
By default the codebase is ‘’; this value is used automatically for single-codebase configurations.</p>
</div>
<div class="section" id="revision">
<span id="change-attr-revision"></span><h5>2.5.4.7. Revision<a class="headerlink" href="#revision" title="Permalink to this headline">¶</a></h5>
<p>Each Change can have a <code class="xref py py-attr docutils literal notranslate"><span class="pre">revision</span></code> attribute, which describes how to get a tree with a specific state: a tree which includes this Change (and all that came before it) but none that come after it.
If this information is unavailable, the <code class="xref py py-attr docutils literal notranslate"><span class="pre">revision</span></code> attribute will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.
These revisions are provided by the <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code>.</p>
<p>Revisions are always strings.</p>
<dl class="docutils">
<dt><cite>CVS</cite></dt>
<dd><code class="xref py py-attr docutils literal notranslate"><span class="pre">revision</span></code> is the seconds since the epoch as an integer.</dd>
<dt><cite>SVN</cite></dt>
<dd><code class="xref py py-attr docutils literal notranslate"><span class="pre">revision</span></code> is the revision number</dd>
<dt><cite>Darcs</cite></dt>
<dd><code class="xref py py-attr docutils literal notranslate"><span class="pre">revision</span></code> is a large string, the output of <strong class="command">darcs changes --context</strong></dd>
<dt><cite>Mercurial</cite></dt>
<dd><code class="xref py py-attr docutils literal notranslate"><span class="pre">revision</span></code> is a short string (a hash ID), the output of <strong class="command">hg identify</strong></dd>
<dt><cite>P4</cite></dt>
<dd><code class="xref py py-attr docutils literal notranslate"><span class="pre">revision</span></code> is the transaction number</dd>
<dt><cite>Git</cite></dt>
<dd><code class="xref py py-attr docutils literal notranslate"><span class="pre">revision</span></code> is a short string (a SHA1 hash), the output of e.g.  <strong class="command">git rev-parse</strong></dd>
</dl>
</div>
<div class="section" id="branches">
<h5>2.5.4.8. Branches<a class="headerlink" href="#branches" title="Permalink to this headline">¶</a></h5>
<p>The Change might also have a <code class="xref py py-attr docutils literal notranslate"><span class="pre">branch</span></code> attribute.
This indicates that all of the Change’s files are in the same named branch.
The schedulers get to decide whether the branch should be built or not.</p>
<p>For VC systems like CVS, Git, Mercurial and Monotone the <code class="xref py py-attr docutils literal notranslate"><span class="pre">branch</span></code> name is unrelated to the filename.
(That is, the branch name and the filename inhabit unrelated namespaces.)
For SVN, branches are expressed as subdirectories of the repository, so the file’s <code class="docutils literal notranslate"><span class="pre">repourl</span></code> is a combination of some base URL, the branch name, and the filename within the branch.
(In a sense, the branch name and the filename inhabit the same namespace.)
Darcs branches are subdirectories of a base URL just like SVN.</p>
<dl class="docutils">
<dt><cite>CVS</cite></dt>
<dd>branch=’warner-newfeature’, files=[‘src/foo.c’]</dd>
<dt><cite>SVN</cite></dt>
<dd>branch=’branches/warner-newfeature’, files=[‘src/foo.c’]</dd>
<dt><cite>Darcs</cite></dt>
<dd>branch=’warner-newfeature’, files=[‘src/foo.c’]</dd>
<dt><cite>Mercurial</cite></dt>
<dd>branch=’warner-newfeature’, files=[‘src/foo.c’]</dd>
<dt><cite>Git</cite></dt>
<dd>branch=’warner-newfeature’, files=[‘src/foo.c’]</dd>
<dt><cite>Monotone</cite></dt>
<dd>branch=’warner-newfeature’, files=[‘src/foo.c’]</dd>
</dl>
</div>
<div class="section" id="change-properties">
<h5>2.5.4.9. Change Properties<a class="headerlink" href="#change-properties" title="Permalink to this headline">¶</a></h5>
<p>A Change may have one or more properties attached to it, usually specified through the Force Build form or <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">sendchange</span></code></a>.
Properties are discussed in detail in the <a class="reference internal" href="#build-properties"><span class="std std-ref">Build Properties</span></a> section.</p>
</div>
</div>
<span id="document-manual/configuration/schedulers"></span><div class="section" id="schedulers">
<span id="id1"></span><h4>2.5.5. Schedulers<a class="headerlink" href="#schedulers" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#configuring-schedulers" id="id11">Configuring Schedulers</a></li>
<li><a class="reference internal" href="#scheduler-resiliency" id="id12">Scheduler Resiliency</a></li>
<li><a class="reference internal" href="#change-filters" id="id13">Change Filters</a></li>
<li><a class="reference internal" href="#scheduler-types" id="id14">Scheduler Types</a><ul>
<li><a class="reference internal" href="#singlebranchscheduler" id="id15">SingleBranchScheduler</a></li>
<li><a class="reference internal" href="#anybranchscheduler" id="id16">AnyBranchScheduler</a></li>
<li><a class="reference internal" href="#dependent-scheduler" id="id17">Dependent Scheduler</a></li>
<li><a class="reference internal" href="#periodic-scheduler" id="id18">Periodic Scheduler</a></li>
<li><a class="reference internal" href="#nightly-scheduler" id="id19">Nightly Scheduler</a></li>
<li><a class="reference internal" href="#try-schedulers" id="id20">Try Schedulers</a></li>
<li><a class="reference internal" href="#triggerable-scheduler" id="id21">Triggerable Scheduler</a></li>
<li><a class="reference internal" href="#nightlytriggerable-scheduler" id="id22">NightlyTriggerable Scheduler</a></li>
<li><a class="reference internal" href="#forcescheduler-scheduler" id="id23">ForceScheduler Scheduler</a></li>
</ul>
</li>
</ul>
</div>
<p>Schedulers are responsible for initiating builds on builders.</p>
<p>Some schedulers listen for changes from ChangeSources and generate build sets in response to these changes.
Others generate build sets without changes, based on other events in the buildmaster.</p>
<div class="section" id="configuring-schedulers">
<span id="id2"></span><h5><a class="toc-backref" href="#id11">2.5.5.1. Configuring Schedulers</a><a class="headerlink" href="#configuring-schedulers" title="Permalink to this headline">¶</a></h5>
<p id="cfg-schedulers">The <a class="reference internal" href="#cfg-schedulers" title="schedulers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">schedulers</span></code></a> configuration parameter gives a list of scheduler instances, each of which causes builds to be started on a particular set of Builders.
The two basic scheduler classes you are likely to start with are <a class="reference internal" href="#sched-SingleBranchScheduler" title="SingleBranchScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">SingleBranchScheduler</span></code></a> and <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a>, but you can write a customized subclass to implement more complicated build scheduling.</p>
<p>Scheduler arguments should always be specified by name (as keyword arguments), to allow for future expansion:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sched</span> <span class="o">=</span> <span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;quick&quot;</span><span class="p">,</span> <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="s1">&#39;win&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>There are several common arguments for schedulers, although not all are available with all schedulers.</p>
<dl class="docutils" id="scheduler-attr-name">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>Each Scheduler must have a unique name.
This is used in status displays, and is also available in the build property <code class="docutils literal notranslate"><span class="pre">scheduler</span></code>.</dd>
</dl>
<dl class="docutils" id="scheduler-attr-buildernames">
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd><p class="first">This is the set of builders which this scheduler should trigger, specified as a list of names (strings).
This can also be an <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> object which will render to a list of builder names (or a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> that will render to builder names).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When <code class="docutils literal notranslate"><span class="pre">builderNames</span></code> is rendered, these additional <code class="xref py py-class docutils literal notranslate"><span class="pre">Properties</span></code> attributes are available:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">master</span></code></dt>
<dd>A reference to the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code> object that owns this scheduler.
This can be used to access the data API.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sourcestamps</span></code></dt>
<dd>The list of sourcestamps that triggered the scheduler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">changes</span></code></dt>
<dd>The list of changes associated with the sourcestamps.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">files</span></code></dt>
<dd>The list of modified files associated with the changes.</dd>
</dl>
<p class="last">Any property attached to the change(s) that triggered the scheduler will be combined and available when rendering <cite>builderNames</cite>.</p>
</div>
<p>Here is a simple example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">schedulers</span>

<span class="nd">@util.renderer</span>
<span class="k">def</span> <span class="nf">builderNames</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="n">builders</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">props</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.rst&#39;</span><span class="p">):</span>
            <span class="n">builders</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;check_docs&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.c&#39;</span><span class="p">):</span>
            <span class="n">builders</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;check_code&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">builders</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">schedulers</span><span class="o">.</span><span class="n">AnyBranchScheduler</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="n">builderNames</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>And a more complex one:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">fnmatch</span>

<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span>

<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">schedulers</span>

<span class="nd">@util.renderer</span>
<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">builderNames</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="c1"># If &quot;buildername_pattern&quot; is defined with &quot;buildbot sendchange&quot;,</span>
    <span class="c1"># check if the builder name matches it.</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;buildername_pattern&#39;</span><span class="p">)</span>

    <span class="c1"># If &quot;builder_tags&quot; is defined with &quot;buildbot sendchange&quot;,</span>
    <span class="c1"># only schedule builders that have the specified tags.</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;builder_tags&#39;</span><span class="p">)</span>

    <span class="n">builders</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">(</span><span class="k">yield</span> <span class="n">props</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;builders&#39;</span><span class="p">,))):</span>
        <span class="k">if</span> <span class="n">pattern</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">fnmatchcase</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">pattern</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">tags</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="o">.</span><span class="n">split</span><span class="p">())</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;tags&#39;</span><span class="p">])):</span>
            <span class="k">continue</span>
        <span class="n">builders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>

    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">builders</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
   <span class="n">schedulers</span><span class="o">.</span><span class="n">AnyBranchScheduler</span><span class="p">(</span>
      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;matrix&#39;</span><span class="p">,</span>
      <span class="n">builderNames</span><span class="o">=</span><span class="n">builderNames</span><span class="p">,</span>
   <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="scheduler-attr-properties">
<span id="index-0"></span><dt><code class="docutils literal notranslate"><span class="pre">properties</span></code> (optional)</dt>
<dd><p class="first">This is a dictionary specifying properties that will be transmitted to all builds started by this scheduler.
The <code class="docutils literal notranslate"><span class="pre">owner</span></code> property may be of particular interest, as its contents (as a list) will be added to the list of “interested users” (<a class="reference internal" href="#doing-things-with-users"><span class="std std-ref">Doing Things With Users</span></a>) for each triggered build.
For example</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sched</span> <span class="o">=</span> <span class="n">Scheduler</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;owner&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;zorro@example.com&#39;</span><span class="p">,</span> <span class="s1">&#39;silver@example.com&#39;</span><span class="p">]</span>
    <span class="p">})</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="scheduler-attr-codebases">
<dt><code class="docutils literal notranslate"><span class="pre">codebases</span></code> (optional)</dt>
<dd><p class="first">Specifies codebase definitions that are used when the scheduler processes data from more than one repository at the same time.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">codebases</span></code> parameter is only used to fill in missing details about a codebases when scheduling a build.
For example, when a change to codebase <code class="docutils literal notranslate"><span class="pre">A</span></code> occurs, a scheduler must invent a sourcestamp for codebase <code class="docutils literal notranslate"><span class="pre">B</span></code>.
Source steps that specify codebase <code class="docutils literal notranslate"><span class="pre">B</span></code> as their codebase will use the invented timestamp.</p>
<p>The parameter does not act as a filter on incoming changes – use a change filter for that purpose.</p>
<p>This parameter can be specified in two forms:</p>
<blockquote>
<div><ul class="simple">
<li>as a list of strings.
This is the Simplest form, use it if no special overrides are needed.
In this form, just the names of the codebases are listed.</li>
<li>as a dictionary of dictionaries.
In this form, the per-codebase overrides of repository, branch and revision can be specified.</li>
</ul>
</div></blockquote>
<p>Each codebase definition dictionary is a dictionary with any of the keys: <code class="docutils literal notranslate"><span class="pre">repository</span></code>, <code class="docutils literal notranslate"><span class="pre">branch</span></code>, <code class="docutils literal notranslate"><span class="pre">revision</span></code>.
The codebase definitions are combined in a dictionary keyed by the name of the codebase.</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">codebases</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;codebase1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;repository&#39;</span><span class="p">:</span><span class="s1">&#39;....&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;branch&#39;</span><span class="p">:</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;revision&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">},</span>
             <span class="s1">&#39;codebase2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;repository&#39;</span><span class="p">:</span><span class="s1">&#39;....&#39;</span><span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="scheduler-attr-fileisimportant">
<dt><code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> (optional)</dt>
<dd>A callable which takes one argument, a Change instance, and returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the change is worth building, and <code class="docutils literal notranslate"><span class="pre">False</span></code> if it is not.
Unimportant Changes are accumulated until the build is triggered by an important change.
The default value of <code class="docutils literal notranslate"><span class="pre">None</span></code> means that all Changes are important.</dd>
</dl>
<dl class="docutils" id="scheduler-attr-changefilter">
<dt><code class="docutils literal notranslate"><span class="pre">change_filter</span></code> (optional)</dt>
<dd>The change filter that will determine which changes are recognized by this scheduler; <a class="reference internal" href="#change-filters"><span class="std std-ref">Change Filters</span></a>.
Note that this is different from <code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code>: if the change filter filters out a Change, then it is completely ignored by the scheduler.
If a Change is allowed by the change filter, but is deemed unimportant, then it will not cause builds to start, but will be remembered and shown in status displays.
The default value of <code class="docutils literal notranslate"><span class="pre">None</span></code> does not filter any changes at all.</dd>
</dl>
<dl class="docutils" id="scheduler-attr-onlyimportant">
<dt><code class="docutils literal notranslate"><span class="pre">onlyImportant</span></code> (optional)</dt>
<dd>A boolean that, when <code class="docutils literal notranslate"><span class="pre">True</span></code>, only adds important changes to the buildset as specified in the <code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> callable.
This means that unimportant changes are ignored the same way a <code class="docutils literal notranslate"><span class="pre">change_filter</span></code> filters changes.
This defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code> and only applies when <code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> is given.</dd>
</dl>
<dl class="docutils" id="scheduler-attr-reason">
<dt><code class="docutils literal notranslate"><span class="pre">reason</span></code> (optional)</dt>
<dd>A string that will be used as the reason for the triggered build.
By default it lists the type and name of the scheduler triggering the build.</dd>
</dl>
<p>The remaining subsections represent a catalog of the available scheduler types.
All these schedulers are defined in modules under <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.schedulers</span></code>, and the docstrings there are the best source of documentation on the arguments taken by each one.</p>
</div>
<div class="section" id="scheduler-resiliency">
<h5><a class="toc-backref" href="#id12">2.5.5.2. Scheduler Resiliency</a><a class="headerlink" href="#scheduler-resiliency" title="Permalink to this headline">¶</a></h5>
<p>In a multi-master configuration, schedulers with the same name can be configured on multiple masters.
Only one instance of the scheduler will be active.
If that instance becomes inactive, due to its master being shut down or failing, then another instance will become active after a short delay.
This provides resiliency in scheduler configurations, so that schedulers are not a single point of failure in a Buildbot infrastructure.</p>
<p>The Data API and web UI display the master on which each scheduler is running.</p>
<p>There is currently no mechanism to control which master’s scheduler instance becomes active.
The behavior is nondeterministic, based on the timing of polling by inactive schedulers.
The failover is non-revertive.</p>
</div>
<div class="section" id="change-filters">
<span id="id3"></span><h5><a class="toc-backref" href="#id13">2.5.5.3. Change Filters</a><a class="headerlink" href="#change-filters" title="Permalink to this headline">¶</a></h5>
<p>Several schedulers perform filtering on an incoming set of changes.
The filter can most generically be specified as a <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeFilter</span></code>.
Set up a <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeFilter</span></code> like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">my_filter</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">project_re</span><span class="o">=</span><span class="s2">&quot;^baseproduct/.*&quot;</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="s2">&quot;devel&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>and then add it to a scheduler with the <code class="docutils literal notranslate"><span class="pre">change_filter</span></code> parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sch</span> <span class="o">=</span> <span class="n">SomeSchedulerClass</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_filter</span><span class="o">=</span><span class="n">my_filter</span><span class="p">)</span>
</pre></div>
</div>
<p>There are five attributes of changes on which you can filter:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">project</span></code></dt>
<dd>the project string, as defined by the ChangeSource.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repository</span></code></dt>
<dd>the repository in which this change occurred.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>the branch on which this change occurred.
Note that ‘trunk’ or ‘master’ is often denoted by <code class="docutils literal notranslate"><span class="pre">None</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">category</span></code></dt>
<dd>the category, again as defined by the ChangeSource.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code></dt>
<dd>the change’s codebase.</dd>
</dl>
<p>For each attribute, the filter can look for a single, specific value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_filter</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="s1">&#39;myproject&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or accept any of a set of values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_filter</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;myproject&#39;</span><span class="p">,</span> <span class="s1">&#39;jimsproject&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>or apply a regular expression, using the attribute name with a “<code class="docutils literal notranslate"><span class="pre">_re</span></code>” suffix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_filter</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">category_re</span><span class="o">=</span><span class="s1">&#39;.*deve.*&#39;</span><span class="p">)</span>
<span class="c1"># or, to use regular expression flags:</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">my_filter</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">category_re</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;.*deve.*&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">))</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.www.hooks.github.GitHubEventHandler</span></code> has a special
<code class="docutils literal notranslate"><span class="pre">github_distinct</span></code> property that can be used to filter whether or not
non-distinct changes should be considered. For example, if a commit is pushed to
a branch that is not being watched and then later pushed to a watched branch, by
default, this will be recorded as two separate Changes. In order to record a
change only the first time the commit appears, you can install a custom
<code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeFilter</span></code> like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">filter_fn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;github_distinct&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For anything more complicated, define a Python function to recognize the strings you want:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_branch_fn</span><span class="p">(</span><span class="n">branch</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">branches_to_build</span> <span class="ow">and</span> <span class="n">branch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">branches_to_ignore</span>
<span class="n">my_filter</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch_fn</span><span class="o">=</span><span class="n">my_branch_fn</span><span class="p">)</span>
</pre></div>
</div>
<p>The special argument <code class="docutils literal notranslate"><span class="pre">filter_fn</span></code> can be used to specify a function that is given the entire Change object, and returns a boolean.</p>
<p>The entire set of allowed arguments, then, is</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="36%" />
<col width="36%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>project</td>
<td>project_re</td>
<td>project_fn</td>
</tr>
<tr class="row-even"><td>repository</td>
<td>repository_re</td>
<td>repository_fn</td>
</tr>
<tr class="row-odd"><td>branch</td>
<td>branch_re</td>
<td>branch_fn</td>
</tr>
<tr class="row-even"><td>category</td>
<td>category_re</td>
<td>category_fn</td>
</tr>
<tr class="row-odd"><td>codebase</td>
<td>codebase_re</td>
<td>codebase_fn</td>
</tr>
<tr class="row-even"><td colspan="3">filter_fn</td>
</tr>
</tbody>
</table>
<p>A Change passes the filter only if <em>all</em> arguments are satisfied.
If no filter object is given to a scheduler, then all changes will be built (subject to any other restrictions the scheduler enforces).</p>
</div>
<div class="section" id="scheduler-types">
<h5><a class="toc-backref" href="#id14">2.5.5.4. Scheduler Types</a><a class="headerlink" href="#scheduler-types" title="Permalink to this headline">¶</a></h5>
<p>The remaining subsections represent a catalog of the available Scheduler types.
All these Schedulers are defined in modules under <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.schedulers</span></code>, and the docstrings there are the best source of documentation on the arguments taken by each one.</p>
<span class="target" id="sched-SingleBranchScheduler"></span><div class="section" id="singlebranchscheduler">
<span id="scheduler-singlebranchscheduler"></span><span id="sched-Scheduler"></span><h6><a class="toc-backref" href="#id15">SingleBranchScheduler</a><a class="headerlink" href="#singlebranchscheduler" title="Permalink to this headline">¶</a></h6>
<p>This is the original and still most popular scheduler class.
It follows exactly one branch, and starts a configurable tree-stable-timer after each change on that branch.
When the timer expires, it starts a build on some set of Builders.
This scheduler accepts a <code class="xref py py-meth docutils literal notranslate"><span class="pre">fileIsImportant</span></code> function which can be used to ignore some Changes if they do not affect any <em>important</em> files.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code> is not set, then this scheduler starts a build for every Change that matches its <code class="docutils literal notranslate"><span class="pre">change_filter</span></code> and statsfies <code class="xref py py-meth docutils literal notranslate"><span class="pre">fileIsImportant</span></code>.
If <code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code> is set, then a build is triggered for each set of Changes which arrive within the configured time, and match the filters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The behavior of this scheduler is undefined, if <code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code> is set, and changes from multiple branches, repositories or codebases are accepted by the filter.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">codebases</span></code> argument will filter out codebases not specified there, but <em>won’t</em> filter based on the branches specified there.</p>
</div>
<p>The arguments to this scheduler are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-name"><span class="std std-ref">name scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-buildernames"><span class="std std-ref">builderNames scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">properties</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-properties"><span class="std std-ref">properties scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebases</span></code> (optional):</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-codebases"><span class="std std-ref">codebases scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-fileisimportant"><span class="std std-ref">fileIsImportant scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">change_filter</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-changefilter"><span class="std std-ref">change_filter scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">onlyImportant</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-onlyimportant"><span class="std std-ref">onlyImportant scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reason</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-reason"><span class="std std-ref">reason scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code></dt>
<dd><p class="first">The scheduler will wait for this many seconds before starting the build.
If new changes are made during this interval, the timer will be restarted, so really the build will be started after a change and then after this many seconds of inactivity.</p>
<p class="last">If <code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then a separate build is started immediately for each Change.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">categories</span></code> (deprecated; use change_filter)</dt>
<dd>A list of categories of changes that this scheduler will respond to.
If this is specified, then any non-matching changes are ignored.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code> (deprecated; use change_filter)</dt>
<dd><p class="first">The scheduler will pay attention to this branch, ignoring Changes that occur on other branches.
Setting <code class="docutils literal notranslate"><span class="pre">branch</span></code> equal to the special value of <code class="docutils literal notranslate"><span class="pre">None</span></code> means it should only pay attention to the default branch.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">None</span></code> is a keyword, not a string, so write <code class="docutils literal notranslate"><span class="pre">None</span></code> and not <code class="docutils literal notranslate"><span class="pre">&quot;None&quot;</span></code>.</p>
</div>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span><span class="p">,</span> <span class="n">util</span>
<span class="n">quick</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;quick&quot;</span><span class="p">,</span>
            <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="s1">&#39;master&#39;</span><span class="p">),</span>
            <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
            <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;quick-linux&quot;</span><span class="p">,</span> <span class="s2">&quot;quick-netbsd&quot;</span><span class="p">])</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;full&quot;</span><span class="p">,</span>
            <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="s1">&#39;master&#39;</span><span class="p">),</span>
            <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
            <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;full-linux&quot;</span><span class="p">,</span> <span class="s2">&quot;full-netbsd&quot;</span><span class="p">,</span> <span class="s2">&quot;full-OSX&quot;</span><span class="p">])</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">quick</span><span class="p">,</span> <span class="n">full</span><span class="p">]</span>
</pre></div>
</div>
<p>In this example, the two <em>quick</em> builders are triggered 60 seconds after the tree has been changed.
The <em>full</em> builds do not run quite so quickly (they wait 5 minutes), so hopefully if the quick builds fail due to a missing file or really simple typo, the developer can discover and fix the problem before the full builds are started.
Both schedulers only pay attention to the default branch: any changes on other branches are ignored.
Each scheduler triggers a different set of Builders, referenced by name.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The old names for this scheduler, <code class="docutils literal notranslate"><span class="pre">buildbot.scheduler.Scheduler</span></code> and <code class="docutils literal notranslate"><span class="pre">buildbot.schedulers.basic.Scheduler</span></code>, are deprecated in favor of using <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.plugins</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>
</pre></div>
</div>
<p class="last">However if you must use a fully qualified name, it is <code class="docutils literal notranslate"><span class="pre">buildbot.schedulers.basic.SingleBranchScheduler</span></code>.</p>
</div>
</div>
<div class="section" id="anybranchscheduler">
<span id="sched-AnyBranchScheduler"></span><span id="id4"></span><h6><a class="toc-backref" href="#id16">AnyBranchScheduler</a><a class="headerlink" href="#anybranchscheduler" title="Permalink to this headline">¶</a></h6>
<p>This scheduler uses a tree-stable-timer like the default one, but uses a separate timer for each branch.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code> is not set, then this scheduler is indistinguishable from <a class="reference internal" href="#sched-SingleBranchScheduler" title="SingleBranchScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">SingleBranchScheduler</span></code></a>.
If <code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code> is set, then a build is triggered for each set of Changes which arrive within the configured time, and match the filters.</p>
<p>The arguments to this scheduler are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-name"><span class="std std-ref">name scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-buildernames"><span class="std std-ref">builderNames scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">properties</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-properties"><span class="std std-ref">properties scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebases</span></code> (optional):</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-codebases"><span class="std std-ref">codebases scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-fileisimportant"><span class="std std-ref">fileIsImportant scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">change_filter</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-changefilter"><span class="std std-ref">change_filter scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">onlyImportant</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-onlyimportant"><span class="std std-ref">onlyImportant scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reason</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-reason"><span class="std std-ref">reason scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code></dt>
<dd>The scheduler will wait for this many seconds before starting the build.
If new changes are made <em>on the same branch</em> during this interval, the timer will be restarted.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branches</span></code> (deprecated; use change_filter)</dt>
<dd>Changes on branches not specified on this list will be ignored.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">categories</span></code> (deprecated; use change_filter)</dt>
<dd>A list of categories of changes that this scheduler will respond to.
If this is specified, then any non-matching changes are ignored.</dd>
</dl>
</div>
<div class="section" id="dependent-scheduler">
<span id="sched-Dependent"></span><span id="id5"></span><h6><a class="toc-backref" href="#id17">Dependent Scheduler</a><a class="headerlink" href="#dependent-scheduler" title="Permalink to this headline">¶</a></h6>
<p>It is common to wind up with one kind of build which should only be performed if the same source code was successfully handled by some other kind of build first.
An example might be a packaging step: you might only want to produce .deb or RPM packages from a tree that was known to compile successfully and pass all unit tests.
You could put the packaging step in the same Build as the compile and testing steps, but there might be other reasons to not do this (in particular you might have several Builders worth of compiles/tests, but only wish to do the packaging once).
Another example is if you want to skip the <em>full</em> builds after a failing <em>quick</em> build of the same source code.
Or, if one Build creates a product (like a compiled library) that is used by some other Builder, you’d want to make sure the consuming Build is run <em>after</em> the producing one.</p>
<p>You can use <em>dependencies</em> to express this relationship to the Buildbot.
There is a special kind of scheduler named <a class="reference internal" href="#sched-Dependent" title="Dependent"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Dependent</span></code></a> that will watch an <em>upstream</em> scheduler for builds to complete successfully (on all of its Builders).
Each time that happens, the same source code (i.e. the same <code class="docutils literal notranslate"><span class="pre">SourceStamp</span></code>) will be used to start a new set of builds, on a different set of Builders.
This <em>downstream</em> scheduler doesn’t pay attention to Changes at all.
It only pays attention to the upstream scheduler.</p>
<p>If the build fails on any of the Builders in the upstream set, the downstream builds will not fire.
Note that, for SourceStamps generated by a <a class="reference internal" href="#sched-Dependent" title="Dependent"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Dependent</span></code></a> scheduler, the <code class="docutils literal notranslate"><span class="pre">revision</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, meaning HEAD.
If any changes are committed between the time the upstream scheduler begins its build and the time the dependent scheduler begins its build, then those changes will be included in the downstream build.
See the <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> scheduler for a more flexible dependency mechanism that can avoid this problem.</p>
<p>The keyword arguments to this scheduler are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-name"><span class="std std-ref">name scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-buildernames"><span class="std std-ref">builderNames scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">properties</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-properties"><span class="std std-ref">properties scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebases</span></code> (optional):</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-codebases"><span class="std std-ref">codebases scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">upstream</span></code></dt>
<dd>The upstream scheduler to watch.
Note that this is an <em>instance</em>, not the name of the scheduler.</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;just-tests&quot;</span><span class="p">,</span>
                                         <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                                         <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;full-linux&quot;</span><span class="p">,</span>
                                                       <span class="s2">&quot;full-netbsd&quot;</span><span class="p">,</span>
                                                       <span class="s2">&quot;full-OSX&quot;</span><span class="p">])</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Dependent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;build-package&quot;</span><span class="p">,</span>
                               <span class="n">upstream</span><span class="o">=</span><span class="n">tests</span><span class="p">,</span> <span class="c1"># &lt;- no quotes!</span>
                               <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make-tarball&quot;</span><span class="p">,</span> <span class="s2">&quot;make-deb&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;make-rpm&quot;</span><span class="p">])</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tests</span><span class="p">,</span> <span class="n">package</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="periodic-scheduler">
<span id="sched-Periodic"></span><span id="id6"></span><h6><a class="toc-backref" href="#id18">Periodic Scheduler</a><a class="headerlink" href="#periodic-scheduler" title="Permalink to this headline">¶</a></h6>
<p>This simple scheduler just triggers a build every <em>N</em> seconds.</p>
<p>The arguments to this scheduler are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-name"><span class="std std-ref">name scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-buildernames"><span class="std std-ref">builderNames scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">properties</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-properties"><span class="std std-ref">properties scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebases</span></code> (optional):</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-codebases"><span class="std std-ref">codebases scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-fileisimportant"><span class="std std-ref">fileIsImportant scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">change_filter</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-changefilter"><span class="std std-ref">change_filter scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">onlyImportant</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-onlyimportant"><span class="std std-ref">onlyImportant scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reason</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-reason"><span class="std std-ref">reason scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">createAbsoluteSourceStamps</span></code> (optional)</dt>
<dd>This option only has effect when using multiple codebases.
When <code class="docutils literal notranslate"><span class="pre">True</span></code>, it uses the last seen revision for each codebase that does not have a change.
When <code class="docutils literal notranslate"><span class="pre">False</span></code> (the default), codebases without changes will use the revision from the <code class="docutils literal notranslate"><span class="pre">codebases</span></code> argument.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">onlyIfChanged</span></code> (optional)</dt>
<dd>If this is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then builds will not be scheduled at the designated time
<em>unless</em> the specified branch has seen an important change since
the previous build.
By default this setting is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">periodicBuildTimer</span></code></dt>
<dd>The time, in seconds, after which to start a build.</dd>
</dl>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>
<span class="n">nightly</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Periodic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;daily&quot;</span><span class="p">,</span>
                              <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;full-solaris&quot;</span><span class="p">],</span>
                              <span class="n">periodicBuildTimer</span><span class="o">=</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nightly</span><span class="p">]</span>
</pre></div>
</div>
<p>The scheduler in this example just runs the full solaris build once per day.
Note that this scheduler only lets you control the time between builds, not the absolute time-of-day of each Build, so this could easily wind up an <em>evening</em> or <em>every afternoon</em> scheduler depending upon when it was first activated.</p>
</div>
<div class="section" id="nightly-scheduler">
<span id="sched-Nightly"></span><span id="id7"></span><h6><a class="toc-backref" href="#id19">Nightly Scheduler</a><a class="headerlink" href="#nightly-scheduler" title="Permalink to this headline">¶</a></h6>
<p>This is highly configurable periodic build scheduler, which triggers a build at particular times of day, week, month, or year.
The configuration syntax is very similar to the well-known <code class="docutils literal notranslate"><span class="pre">crontab</span></code> format, in which you provide values for minute, hour, day, and month (some of which can be wildcards), and a build is triggered whenever the current time matches the given constraints.
This can run a build every night, every morning, every weekend, alternate Thursdays, on your boss’s birthday, etc.</p>
<p>Pass some subset of <code class="docutils literal notranslate"><span class="pre">minute</span></code>, <code class="docutils literal notranslate"><span class="pre">hour</span></code>, <code class="docutils literal notranslate"><span class="pre">dayOfMonth</span></code>, <code class="docutils literal notranslate"><span class="pre">month</span></code>, and <code class="docutils literal notranslate"><span class="pre">dayOfWeek</span></code>; each may be a single number or a list of valid values.
The builds will be triggered whenever the current time matches these values.
Wildcards are represented by a ‘*’ string.
All fields default to a wildcard except ‘minute’, so with no fields this defaults to a build every hour, on the hour.
The full list of parameters is:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-name"><span class="std std-ref">name scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-buildernames"><span class="std std-ref">builderNames scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">properties</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-properties"><span class="std std-ref">properties scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebases</span></code> (optional):</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-codebases"><span class="std std-ref">codebases scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-fileisimportant"><span class="std std-ref">fileIsImportant scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">change_filter</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-changefilter"><span class="std std-ref">change_filter scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">onlyImportant</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-onlyimportant"><span class="std std-ref">onlyImportant scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reason</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-reason"><span class="std std-ref">reason scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">createAbsoluteSourceStamps</span></code> (optional)</dt>
<dd>This option only has effect when using multiple codebases.
When <code class="docutils literal notranslate"><span class="pre">True</span></code>, it uses the last seen revision for each codebase that does not have a change.
When <code class="docutils literal notranslate"><span class="pre">False</span></code> (the default), codebases without changes will use the revision from the <code class="docutils literal notranslate"><span class="pre">codebases</span></code> argument.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">onlyIfChanged</span></code> (optional)</dt>
<dd>If this is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then builds will not be scheduled at the designated time <em>unless</em> the change filter has accepted an important change since the previous build.
The default of this value is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code> (optional)</dt>
<dd>(deprecated; use <code class="docutils literal notranslate"><span class="pre">change_filter</span></code> and <code class="docutils literal notranslate"><span class="pre">codebases</span></code>)
The branch to build when the time comes, and the branch to filter for if <code class="docutils literal notranslate"><span class="pre">change_filter</span></code> is not specified.
Remember that a value of <code class="docutils literal notranslate"><span class="pre">None</span></code> here means the default branch, and will not match other branches!</dd>
<dt><code class="docutils literal notranslate"><span class="pre">minute</span></code> (optional)</dt>
<dd>The minute of the hour on which to start the build.
This defaults to 0, meaning an hourly build.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hour</span></code> (optional)</dt>
<dd>The hour of the day on which to start the build, in 24-hour notation.
This defaults to *, meaning every hour.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dayOfMonth</span></code> (optional)</dt>
<dd>The day of the month to start a build.
This defaults to <code class="docutils literal notranslate"><span class="pre">*</span></code>, meaning every day.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">month</span></code> (optional)</dt>
<dd>The month in which to start the build, with January = 1.
This defaults to <code class="docutils literal notranslate"><span class="pre">*</span></code>, meaning every month.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dayOfWeek</span></code> (optional)</dt>
<dd>The day of the week to start a build, with Monday = 0.
This defaults to <code class="docutils literal notranslate"><span class="pre">*</span></code>, meaning every day of the week.</dd>
</dl>
<p>For example, the following <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> clause will cause a build to be started every night at 3:00am:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">schedulers</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;nightly&#39;</span><span class="p">,</span>
                       <span class="n">branch</span><span class="o">=</span><span class="s1">&#39;master&#39;</span><span class="p">,</span>
                       <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;builder1&#39;</span><span class="p">,</span> <span class="s1">&#39;builder2&#39;</span><span class="p">],</span>
                       <span class="n">hour</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>This scheduler will perform a build each Monday morning at 6:23am and again at 8:23am, but only if someone has committed code in the interim:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>c[&#39;schedulers&#39;].append(
    schedulers.Nightly(name=&#39;BeforeWork&#39;,
                       branch=`default`,
                       builderNames=[&#39;builder1&#39;],
                       dayOfWeek=0, hour=[6,8], minute=23,
                       onlyIfChanged=True))
</pre></div>
</div>
<p>The following runs a build every two hours, using Python’s <code class="xref py py-func docutils literal notranslate"><span class="pre">range</span></code> function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="o">.</span><span class="n">schedulers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">timed</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;every2hours&#39;</span><span class="p">,</span>
        <span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># default branch</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;builder1&#39;</span><span class="p">],</span>
        <span class="n">hour</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>Finally, this example will run only on December 24th:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">timed</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;SleighPreflightCheck&#39;</span><span class="p">,</span>
        <span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># default branch</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;flying_circuits&#39;</span><span class="p">,</span> <span class="s1">&#39;radar&#39;</span><span class="p">],</span>
        <span class="n">month</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">dayOfMonth</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
        <span class="n">hour</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<span class="target" id="sched-Try_Jobdir"></span></div>
<div class="section" id="try-schedulers">
<span id="sched-Try_Userpass"></span><span id="id8"></span><h6><a class="toc-backref" href="#id20">Try Schedulers</a><a class="headerlink" href="#try-schedulers" title="Permalink to this headline">¶</a></h6>
<p>This scheduler allows developers to use the <strong class="command">buildbot try</strong> command to trigger builds of code they have not yet committed.
See <a class="reference internal" href="#cmdline-try" title="try"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">try</span></code></a> for complete details.</p>
<p>Two implementations are available: <a class="reference internal" href="#sched-Try_Jobdir" title="Try_Jobdir"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Try_Jobdir</span></code></a> and <a class="reference internal" href="#sched-Try_Userpass" title="Try_Userpass"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Try_Userpass</span></code></a>.
The former monitors a job directory, specified by the <code class="docutils literal notranslate"><span class="pre">jobdir</span></code> parameter, while the latter listens for PB connections on a specific <code class="docutils literal notranslate"><span class="pre">port</span></code>, and authenticates against <code class="docutils literal notranslate"><span class="pre">userport</span></code>.</p>
<p>The buildmaster must have a scheduler instance in the config file’s <a class="reference internal" href="#cfg-schedulers" title="schedulers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">schedulers</span></code></a> list to receive try requests.
This lets the administrator control who may initiate these <cite>trial</cite> builds, which branches are eligible for trial builds, and which Builders should be used for them.</p>
<p>The scheduler has various means to accept build requests.
All of them enforce more security than the usual buildmaster ports do.
Any source code being built can be used to compromise the worker accounts, but in general that code must be checked out from the VC repository first, so only people with commit privileges can get control of the workers.
The usual force-build control channels can waste worker time but do not allow arbitrary commands to be executed by people who don’t have those commit privileges.
However, the source code patch that is provided with the trial build does not have to go through the VC system first, so it is important to make sure these builds cannot be abused by a non-committer to acquire as much control over the workers as a committer has.
Ideally, only developers who have commit access to the VC repository would be able to start trial builds, but unfortunately the buildmaster does not, in general, have access to VC system’s user list.</p>
<p>As a result, the try scheduler requires a bit more configuration.
There are currently two ways to set this up:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">jobdir</span></code> (ssh)</dt>
<dd><p class="first">This approach creates a command queue directory, called the <code class="file docutils literal notranslate"><span class="pre">jobdir</span></code>, in the buildmaster’s working directory.
The buildmaster admin sets the ownership and permissions of this directory to only grant write access to the desired set of developers, all of whom must have accounts on the machine.
The <strong class="command">buildbot try</strong> command creates a special file containing the source stamp information and drops it in the jobdir, just like a standard maildir.
When the buildmaster notices the new file, it unpacks the information inside and starts the builds.</p>
<p>The config file entries used by ‘buildbot try’ either specify a local queuedir (for which write and mv are used) or a remote one (using scp and ssh).</p>
<p>The advantage of this scheme is that it is quite secure, the disadvantage is that it requires fiddling outside the buildmaster config (to set the permissions on the jobdir correctly).
If the buildmaster machine happens to also house the VC repository, then it can be fairly easy to keep the VC userlist in sync with the trial-build userlist.
If they are on different machines, this will be much more of a hassle.
It may also involve granting developer accounts on a machine that would not otherwise require them.</p>
<p class="last">To implement this, the worker invokes <code class="samp docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">-l</span> <em><span class="pre">username</span></em> <em><span class="pre">host</span></em> <span class="pre">buildbot</span> <span class="pre">tryserver</span> <em><span class="pre">ARGS</span></em></code>, passing the patch contents over stdin.
The arguments must include the inlet directory and the revision information.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">user+password</span></code> (PB)</dt>
<dd><p class="first">In this approach, each developer gets a username/password pair, which are all listed in the buildmaster’s configuration file.
When the developer runs <strong class="command">buildbot try</strong>, their machine connects to the buildmaster via PB and authenticates themselves using that username and password, then sends a PB command to start the trial build.</p>
<p class="last">The advantage of this scheme is that the entire configuration is performed inside the buildmaster’s config file.
The disadvantages are that it is less secure (while the <cite>cred</cite> authentication system does not expose the password in plaintext over the wire, it does not offer most of the other security properties that SSH does).
In addition, the buildmaster admin is responsible for maintaining the username/password list, adding and deleting entries as developers come and go.</p>
</dd>
</dl>
<p>For example, to set up the <cite>jobdir</cite> style of trial build, using a command queue directory of <code class="file docutils literal notranslate"><em><span class="pre">MASTERDIR</span></em><span class="pre">/jobdir</span></code> (and assuming that all your project developers were members of the <code class="docutils literal notranslate"><span class="pre">developers</span></code> unix group), you would first set up that directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir -p MASTERDIR/jobdir MASTERDIR/jobdir/new MASTERDIR/jobdir/cur MASTERDIR/jobdir/tmp
chgrp developers MASTERDIR/jobdir MASTERDIR/jobdir/*
chmod g+rwx,o-rwx MASTERDIR/jobdir MASTERDIR/jobdir/*
</pre></div>
</div>
<p>and then use the following scheduler in the buildmaster’s config file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Try_Jobdir</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;try1&quot;</span><span class="p">,</span>
                          <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;full-linux&quot;</span><span class="p">,</span> <span class="s2">&quot;full-netbsd&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;full-OSX&quot;</span><span class="p">],</span>
                          <span class="n">jobdir</span><span class="o">=</span><span class="s2">&quot;jobdir&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that you must create the jobdir before telling the buildmaster to use this configuration, otherwise you will get an error.
Also remember that the buildmaster must be able to read and write to the jobdir as well.
Be sure to watch the <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> file (<a class="reference internal" href="#logfiles"><span class="std std-ref">Logfiles</span></a>) as you start using the jobdir, to make sure the buildmaster is happy with it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Patches in the jobdir are encoded using netstrings, which place an arbitrary upper limit on patch size of 99999 bytes.
If your submitted try jobs are rejected with <cite>BadJobfile</cite>, try increasing this limit with a snippet like this in your <cite>master.cfg</cite>:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.protocols.basic</span> <span class="k">import</span> <span class="n">NetstringReceiver</span>
<span class="n">NetstringReceiver</span><span class="o">.</span><span class="n">MAX_LENGTH</span> <span class="o">=</span> <span class="mi">1000000</span>
</pre></div>
</div>
</div>
<p>To use the username/password form of authentication, create a <code class="xref py py-class docutils literal notranslate"><span class="pre">Try_Userpass</span></code> instance instead.
It takes the same <code class="docutils literal notranslate"><span class="pre">builderNames</span></code> argument as the <code class="xref py py-class docutils literal notranslate"><span class="pre">Try_Jobdir</span></code> form, but accepts an additional <code class="docutils literal notranslate"><span class="pre">port</span></code> argument (to specify the TCP port to listen on) and a <code class="docutils literal notranslate"><span class="pre">userpass</span></code> list of username/password pairs to accept.
Remember to use good passwords for this: the security of the worker accounts depends upon it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Try_Userpass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;try2&quot;</span><span class="p">,</span>
                            <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;full-linux&quot;</span><span class="p">,</span> <span class="s2">&quot;full-netbsd&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;full-OSX&quot;</span><span class="p">],</span>
                            <span class="n">port</span><span class="o">=</span><span class="mi">8031</span><span class="p">,</span>
                            <span class="n">userpass</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;alice&quot;</span><span class="p">,</span><span class="s2">&quot;pw1&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;bob&quot;</span><span class="p">,</span> <span class="s2">&quot;pw2&quot;</span><span class="p">)])</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
</pre></div>
</div>
<p>Like most places in the buildbot, the <code class="docutils literal notranslate"><span class="pre">port</span></code> argument takes a <cite>strports</cite> specification.
See <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.application.strports</span></code> for details.</p>
<span class="target" id="sched-Triggerable"></span></div>
<div class="section" id="triggerable-scheduler">
<span id="index-1"></span><span id="id9"></span><h6><a class="toc-backref" href="#id21">Triggerable Scheduler</a><a class="headerlink" href="#triggerable-scheduler" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> scheduler waits to be triggered by a <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> step (see <a class="reference internal" href="#triggering-schedulers"><span class="std std-ref">Triggering Schedulers</span></a>) in another build.
That step can optionally wait for the scheduler’s builds to complete.
This provides two advantages over <a class="reference internal" href="#sched-Dependent" title="Dependent"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Dependent</span></code></a> schedulers.
First, the same scheduler can be triggered from multiple builds.
Second, the ability to wait for <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a>’s builds to complete provides a form of “subroutine call”, where one or more builds can “call” a scheduler to perform some work for them, perhaps on other workers.
The <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> scheduler supports multiple codebases.
The scheduler filters out all codebases from <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> steps that are not configured in the scheduler.</p>
<p>The parameters are just the basics:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-name"><span class="std std-ref">name scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-buildernames"><span class="std std-ref">builderNames scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">properties</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-properties"><span class="std std-ref">properties scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebases</span></code> (optional):</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-codebases"><span class="std std-ref">codebases scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reason</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-reason"><span class="std std-ref">reason scheduler argument</span></a>.</dd>
</dl>
<p>This class is only useful in conjunction with the <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> step.
Here is a fully-worked example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span><span class="p">,</span> <span class="n">util</span><span class="p">,</span> <span class="n">steps</span>

<span class="n">checkin</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;checkin&quot;</span><span class="p">,</span>
                                           <span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                                           <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;checkin&quot;</span><span class="p">])</span>
<span class="n">nightly</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;nightly&#39;</span><span class="p">,</span>
                             <span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nightly&#39;</span><span class="p">],</span>
                             <span class="n">hour</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">mktarball</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Triggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;mktarball&quot;</span><span class="p">,</span> <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;mktarball&quot;</span><span class="p">])</span>
<span class="n">build</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Triggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;build-all-platforms&quot;</span><span class="p">,</span>
                               <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;build-all-platforms&quot;</span><span class="p">])</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Triggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;distributed-test&quot;</span><span class="p">,</span>
                              <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;distributed-test&quot;</span><span class="p">])</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">Triggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;package-all-platforms&quot;</span><span class="p">,</span>
                                 <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;package-all-platforms&quot;</span><span class="p">])</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mktarball</span><span class="p">,</span> <span class="n">checkin</span><span class="p">,</span> <span class="n">nightly</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">package</span><span class="p">]</span>

<span class="c1"># on checkin, make a tarball, build it, and test it</span>
<span class="n">checkin_factory</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">checkin_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mktarball&#39;</span><span class="p">],</span>
                                      <span class="n">waitForFinish</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">checkin_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;build-all-platforms&#39;</span><span class="p">],</span>
                                      <span class="n">waitForFinish</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">checkin_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;distributed-test&#39;</span><span class="p">],</span>
                                      <span class="n">waitForFinish</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="c1"># and every night, make a tarball, build it, and package it</span>
<span class="n">nightly_factory</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">nightly_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mktarball&#39;</span><span class="p">],</span>
                                      <span class="n">waitForFinish</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">nightly_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;build-all-platforms&#39;</span><span class="p">],</span>
                                      <span class="n">waitForFinish</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">nightly_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;package-all-platforms&#39;</span><span class="p">],</span>
                                      <span class="n">waitForFinish</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="nightlytriggerable-scheduler">
<span id="sched-NightlyTriggerable"></span><h6><a class="toc-backref" href="#id22">NightlyTriggerable Scheduler</a><a class="headerlink" href="#nightlytriggerable-scheduler" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.schedulers.timed.NightlyTriggerable">
<em class="property">class </em><code class="descclassname">buildbot.schedulers.timed.</code><code class="descname">NightlyTriggerable</code><a class="headerlink" href="#buildbot.schedulers.timed.NightlyTriggerable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#sched-NightlyTriggerable" title="NightlyTriggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">NightlyTriggerable</span></code></a> scheduler is a mix of the <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> and <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> schedulers.
This scheduler triggers builds at a particular time of day, week, or year, exactly as the <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> scheduler.
However, the source stamp set that is used that provided by the last <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> step that targeted this scheduler.</p>
<p>The parameters are just the basics:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-name"><span class="std std-ref">name scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-buildernames"><span class="std std-ref">builderNames scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">properties</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-properties"><span class="std std-ref">properties scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebases</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-codebases"><span class="std std-ref">codebases scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reason</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#scheduler-attr-reason"><span class="std std-ref">reason scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">minute</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hour</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dayOfMonth</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">month</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dayOfWeek</span></code> (optional)</dt>
<dd>See <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a>.</dd>
</dl>
<p>This class is only useful in conjunction with the <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> step.
Note that <code class="docutils literal notranslate"><span class="pre">waitForFinish</span></code> is ignored by <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> steps targeting this scheduler.</p>
<p>Here is a fully-worked example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span><span class="p">,</span> <span class="n">util</span><span class="p">,</span> <span class="n">steps</span>

<span class="n">checkin</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;checkin&quot;</span><span class="p">,</span>
                                           <span class="n">branch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                                           <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;checkin&quot;</span><span class="p">])</span>
<span class="n">nightly</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">NightlyTriggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;nightly&#39;</span><span class="p">,</span>
                                        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nightly&#39;</span><span class="p">],</span>
                                        <span class="n">hour</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">checkin</span><span class="p">,</span> <span class="n">nightly</span><span class="p">]</span>

<span class="c1"># on checkin, run tests</span>
<span class="n">checkin_factory</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">([</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">Test</span><span class="p">(),</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nightly&#39;</span><span class="p">])</span>
<span class="p">])</span>

<span class="c1"># and every night, package the latest successful build</span>
<span class="n">nightly_factory</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">([</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;package&#39;</span><span class="p">])</span>
<span class="p">])</span>
</pre></div>
</div>
<span class="target" id="sched-ForceScheduler"></span></div>
<div class="section" id="forcescheduler-scheduler">
<span id="index-2"></span><h6><a class="toc-backref" href="#id23">ForceScheduler Scheduler</a><a class="headerlink" href="#forcescheduler-scheduler" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> scheduler is the way you can configure a force build form in the web UI.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">/#/builders/:builderid</span></code> web page, you will see, on the top right of the page, one button for each <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> scheduler that was configured for this builder.
If you click on that button, a dialog will let you choose various parameters for requesting a new build.</p>
<p>The Buildbot framework allows you to customize exactly how the build form looks, which builders have a force build form (it might not make sense to force build every builder), and who is allowed to force builds on which builders.</p>
<p>How you do so is by configuring a <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a>, and add it into the list <a class="reference internal" href="#cfg-schedulers" title="schedulers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">schedulers</span></code></a>.</p>
<p>The scheduler takes the following parameters:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>See <a class="reference internal" href="#scheduler-attr-name"><span class="std std-ref">name scheduler argument</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builderNames</span></code></dt>
<dd>List of builders where the force button should appear.
See <a class="reference internal" href="#scheduler-attr-buildernames"><span class="std std-ref">builderNames scheduler argument</span></a>.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">reason</span></code></p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">parameter</span></a> allowing the user to specify the reason for the build.
The default value is a string parameter with a default value “force build”.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">reasonString</span></code></p>
<blockquote>
<div>A string that will be used to create the build reason for the forced build.
This string can contain the placeholders <code class="docutils literal notranslate"><span class="pre">%(owner)s</span></code> and <code class="docutils literal notranslate"><span class="pre">%(reason)s</span></code>, which represents the value typed into the reason field.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">username</span></code></p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">parameter</span></a> specifying the username associated with the build (aka owner).
The default value is a username parameter.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">codebases</span></code></p>
<blockquote>
<div>A list of strings or <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">CodebaseParameter</span></a> specifying the codebases that should be presented.
The default is a single codebase with no name (i.e. <cite>codebases=[‘’]</cite>).</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">properties</span></code></p>
<blockquote>
<div>A list of <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">parameters</span></a>, one for each property.
These can be arbitrary parameters, where the parameter’s name is taken as the property name, or <code class="docutils literal notranslate"><span class="pre">AnyPropertyParameter</span></code>, which allows the web user to specify the property name.
The default value is an empty list.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">buttonName</span></code></p>
<blockquote>
<div>The name of the “submit” button on the resulting force-build form.
This defaults to the name of scheduler.</div></blockquote>
<p>An example may be better than long explanation.
What you need in your config file is something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span><span class="p">,</span> <span class="n">util</span>

<span class="n">sch</span> <span class="o">=</span> <span class="n">schedulers</span><span class="o">.</span><span class="n">ForceScheduler</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
    <span class="n">buttonName</span><span class="o">=</span><span class="s2">&quot;pushMe!&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;My nice Force form&quot;</span><span class="p">,</span>
    <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my-builder&quot;</span><span class="p">],</span>

    <span class="n">codebases</span><span class="o">=</span><span class="p">[</span>
        <span class="n">util</span><span class="o">.</span><span class="n">CodebaseParameter</span><span class="p">(</span>
            <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Main repository&quot;</span><span class="p">,</span>
            <span class="c1"># will generate a combo box</span>
            <span class="n">branch</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">ChoiceStringParameter</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;branch&quot;</span><span class="p">,</span>
                <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="s2">&quot;hest&quot;</span><span class="p">],</span>
                <span class="n">default</span><span class="o">=</span><span class="s2">&quot;master&quot;</span><span class="p">),</span>

            <span class="c1"># will generate nothing in the form, but revision, repository,</span>
            <span class="c1"># and project are needed by buildbot scheduling system so we</span>
            <span class="c1"># need to pass a value (&quot;&quot;)</span>
            <span class="n">revision</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">FixedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;revision&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">repository</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">FixedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;repository&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
            <span class="n">project</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">FixedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
        <span class="p">),</span>
    <span class="p">],</span>

    <span class="c1"># will generate a text input</span>
    <span class="n">reason</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">StringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;reason&quot;</span><span class="p">,</span>
                                <span class="n">label</span><span class="o">=</span><span class="s2">&quot;reason:&quot;</span><span class="p">,</span>
                                <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>

    <span class="c1"># in case you don&#39;t require authentication this will display</span>
    <span class="c1"># input for user to type his name</span>
    <span class="n">username</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">UserNameParameter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;your name:&quot;</span><span class="p">,</span>
                                    <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>
    <span class="c1"># A completely customized property list.  The name of the</span>
    <span class="c1"># property is the name of the parameter</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">[</span>
        <span class="n">util</span><span class="o">.</span><span class="n">NestedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Build Options&quot;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span>
            <span class="n">util</span><span class="o">.</span><span class="n">StringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;pull_url&quot;</span><span class="p">,</span>
                                 <span class="n">label</span><span class="o">=</span><span class="s2">&quot;optionally give a public Git pull url:&quot;</span><span class="p">,</span>
                                 <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>
            <span class="n">util</span><span class="o">.</span><span class="n">BooleanParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;force_build_clean&quot;</span><span class="p">,</span>
                                  <span class="n">label</span><span class="o">=</span><span class="s2">&quot;force a make clean&quot;</span><span class="p">,</span>
                                  <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="p">])</span>
</pre></div>
</div>
<p>This will result in the following UI:</p>
<img alt="Force Form Result" src="_images/forcedialog1.png" />
<div class="section" id="authorization">
<h7>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h7>
<p>The force scheduler uses the web interface’s authorization framework to determine which user has the right to force which build.
Here is an example of code on how you can define which user has which right:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">user_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;project1-builder&quot;</span><span class="p">):</span> <span class="p">[</span><span class="s2">&quot;project1-maintainer&quot;</span><span class="p">,</span> <span class="s2">&quot;john&quot;</span><span class="p">]</span> <span class="p">,</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;project2-builder&quot;</span><span class="p">):</span> <span class="p">[</span><span class="s2">&quot;project2-maintainer&quot;</span><span class="p">,</span> <span class="s2">&quot;jack&quot;</span><span class="p">],</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;.*&quot;</span><span class="p">):</span> <span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="k">def</span> <span class="nf">force_auth</span><span class="p">(</span><span class="n">user</span><span class="p">,</span>  <span class="n">status</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">user_mapping</span>
    <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">users</span> <span class="ow">in</span> <span class="n">user_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># use authz_cfg in your WebStatus setup</span>
<span class="n">authz_cfg</span><span class="o">=</span><span class="n">authz</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
    <span class="n">auth</span><span class="o">=</span><span class="n">my_auth</span><span class="p">,</span>
    <span class="n">forceBuild</span> <span class="o">=</span> <span class="n">force_auth</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="forcescheduler-parameters">
<span id="id10"></span><h7>ForceScheduler Parameters<a class="headerlink" href="#forcescheduler-parameters" title="Permalink to this headline">¶</a></h7>
<p>Most of the arguments to <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> are “parameters”.
Several classes of parameters are available, each describing a different kind of input from a force-build form.</p>
<p>All parameter types have a few common arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">name</span></code> (required)</p>
<blockquote>
<div>The name of the parameter.
For properties, this will correspond to the name of the property that your parameter will set.
The name is also used internally as the identifier for in the HTML form.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">label</span></code> (optional; default is same as name)</p>
<blockquote>
<div>The label of the parameter.
This is what is displayed to the user.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">tablabel</span></code> (optional; default is same as label)</p>
<blockquote>
<div>The label of the tab if this parameter is included into a tab layout NestedParameter.
This is what is displayed to the user.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">default</span></code> (optional; default: “”)</p>
<blockquote>
<div>The default value for the parameter, that is used if there is no user input.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">required</span></code> (optional; default: False)</p>
<blockquote>
<div>If this is true, then an error will be shown to user if there is no input in this field</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">maxsize</span></code> (optional; default: None)</p>
<blockquote>
<div>The maximum size of a field (in bytes).
Buildbot will ensure the field sent by the user is not too large.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">autopopulate</span></code> (optional; default: None)</p>
<blockquote>
<div><p>If not None, <code class="docutils literal notranslate"><span class="pre">autopopulate</span></code> is a dictionary which describes how other parameters are updated if this one changes.
This is useful for when you have lots of parameters, and defaults depends on e.g. the branch.
This is implemented generically, and all parameters can update others.
Beware of infinite loops!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">schedulers</span><span class="o">.</span><span class="n">ForceScheduler</span><span class="p">(</span>
<span class="n">name</span><span class="o">=</span><span class="s2">&quot;custom&quot;</span><span class="p">,</span>
<span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;runtests&quot;</span><span class="p">],</span>
<span class="n">buttonName</span><span class="o">=</span><span class="s2">&quot;Start Custom Build&quot;</span><span class="p">,</span>
<span class="n">codebases</span> <span class="o">=</span> <span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">CodebaseParameter</span><span class="p">(</span>
    <span class="n">codebase</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">project</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">branch</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">ChoiceStringParameter</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;branch&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Branch&quot;</span><span class="p">,</span>
        <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;master&quot;</span><span class="p">,</span> <span class="s2">&quot;dev&quot;</span><span class="p">],</span>
        <span class="n">autopopulate</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;master&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;build_name&#39;</span><span class="p">:</span> <span class="s1">&#39;build for master branch&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;dev&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;build_name&#39;</span><span class="p">:</span> <span class="s1">&#39;build for dev branch&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="p">}</span>
<span class="p">))],</span>
<span class="n">properties</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">StringParameter</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;build_name&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Name of the Build release.&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)]))</span>  <span class="c1"># this parameter will be auto populated when user chooses branch</span>
</pre></div>
</div>
</div></blockquote>
<p>The parameter types are:</p>
<div class="section" id="nestedparameter">
<span id="sched-NestedParameter"></span><h8>NestedParameter<a class="headerlink" href="#nestedparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NestedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;options&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Build options&quot;</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">]),</span>
</pre></div>
</div>
<p>This parameter type is a special parameter which contains other parameters.
This can be used to group a set of parameters together, and define the layout of your form.
You can recursively include NestedParameter into NestedParameter, to build very complex UI.</p>
<p>It adds the following arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">layout</span></code> (optional, default: “vertical”)</p>
<blockquote>
<div><p>The layout defines how the fields are placed in the form.</p>
<p>The layouts implemented in the standard web application are:</p>
<ul>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">simple</span></code>: fields are displayed one by one without alignment.</dt>
<dd><p class="first last">They take the horizontal space that they need.</p>
</dd>
</dl>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">vertical</span></code>: all fields are displayed vertically, aligned in columns (as per the <code class="docutils literal notranslate"><span class="pre">column</span></code> attribute of the NestedParameter)</p>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">tabs</span></code>: Each field gets its own <a class="reference external" href="https://getbootstrap.com/components/">tab</a>.</dt>
<dd><p class="first last">This can be used to declare complex build forms which won’t fit into one screen.
The children fields are usually other NestedParameters with vertical layout.</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">columns</span></code> (optional, accepted values are 1,2,3,4)</p>
<blockquote>
<div>The number of columns to use for a <cite>vertical</cite> layout.
If omitted, it is set to 1 unless there are more than 3 visible child fields in which case it is set to 2.</div></blockquote>
</div>
<div class="section" id="fixedparameter">
<h8>FixedParameter<a class="headerlink" href="#fixedparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FixedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;branch&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;trunk&quot;</span><span class="p">),</span>
</pre></div>
</div>
<p>This parameter type will not be shown on the web form, and always generate a property with its default value.</p>
</div>
<div class="section" id="stringparameter">
<h8>StringParameter<a class="headerlink" href="#stringparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">StringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;pull_url&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;optionally give a public Git pull url:&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type will show a single-line text-entry box, and allow the user to enter an arbitrary string.
It adds the following arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">regex</span></code> (optional)</p>
<blockquote>
<div>A string that will be compiled as a regex, and used to validate the input of this parameter.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">size</span></code> (optional; default: 10)</p>
<blockquote>
<div>The width of the input field (in characters).</div></blockquote>
</div>
<div class="section" id="textparameter">
<h8>TextParameter<a class="headerlink" href="#textparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TextParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;comments to be displayed to the user of the built binary&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;This is a development build&quot;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type is similar to StringParameter, except that it is represented in the HTML form as a <code class="docutils literal notranslate"><span class="pre">textarea</span></code>, allowing multi-line input.
It adds the StringParameter arguments, this type allows:</p>
<p><code class="docutils literal notranslate"><span class="pre">cols</span></code> (optional; default: 80)</p>
<blockquote>
<div>The number of columns the <code class="docutils literal notranslate"><span class="pre">textarea</span></code> will have.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rows</span></code> (optional; default: 20)</p>
<blockquote>
<div>The number of rows the <code class="docutils literal notranslate"><span class="pre">textarea</span></code> will have</div></blockquote>
<p>This class could be subclassed in order to have more customization e.g.</p>
<ul class="simple">
<li>developer could send a list of Git branches to pull from</li>
<li>developer could send a list of Gerrit changes to cherry-pick,</li>
<li>developer could send a shell script to amend the build.</li>
</ul>
<p>Beware of security issues anyway.</p>
</div>
<div class="section" id="intparameter">
<h8>IntParameter<a class="headerlink" href="#intparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IntParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;debug_level&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;debug level (1-10)&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type accepts an integer value using a text-entry box.</p>
</div>
<div class="section" id="booleanparameter">
<h8>BooleanParameter<a class="headerlink" href="#booleanparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">BooleanParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;force_build_clean&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;force a make clean&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>This type represents a boolean value.
It will be presented as a checkbox.</p>
</div>
<div class="section" id="usernameparameter">
<h8>UserNameParameter<a class="headerlink" href="#usernameparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UserNameParameter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;your name:&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type accepts a username.
If authentication is active, it will use the authenticated user instead of displaying a text-entry box.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code> (optional; default: 10)</dt>
<dd>The width of the input field (in characters).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">need_email</span></code> (optional; default True)</dt>
<dd>If true, require a full email address rather than arbitrary text.</dd>
</dl>
</div>
<div class="section" id="choicestringparameter">
<span id="sched-ChoiceStringParameter"></span><h8>ChoiceStringParameter<a class="headerlink" href="#choicestringparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ChoiceStringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;branch&quot;</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;main&quot;</span><span class="p">,</span><span class="s2">&quot;devel&quot;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type lets the user choose between several choices (e.g the list of branches you are supporting, or the test campaign to run).
If <code class="docutils literal notranslate"><span class="pre">multiple</span></code> is false, then its result is a string - one of the choices.
If <code class="docutils literal notranslate"><span class="pre">multiple</span></code> is true, then the result is a list of strings from the choices.</p>
<p>Note that for some use cases, the choices need to be generated dynamically.
This can be done via subclassing and overriding the ‘getChoices’ member function.
An example of this is provided by the source for the <code class="xref py py-class docutils literal notranslate"><span class="pre">InheritBuildParameter</span></code> class.</p>
<p>Its arguments, in addition to the common options, are:</p>
<p><code class="docutils literal notranslate"><span class="pre">choices</span></code></p>
<blockquote>
<div>The list of available choices.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">strict</span></code> (optional; default: True)</p>
<blockquote>
<div>If true, verify that the user’s input is from the list.
Note that this only affects the validation of the form request; even if this argument is False, there is no HTML form component available to enter an arbitrary value.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">multiple</span></code></p>
<blockquote>
<div>If true, then the user may select multiple choices.</div></blockquote>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ChoiceStringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;forced_tests&quot;</span><span class="p">,</span>
                      <span class="n">label</span><span class="o">=</span><span class="s2">&quot;smoke test campaign to run&quot;</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="n">default_tests</span><span class="p">,</span>
                      <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                      <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;test_builder1&quot;</span><span class="p">,</span> <span class="s2">&quot;test_builder2&quot;</span><span class="p">,</span>
                               <span class="s2">&quot;test_builder3&quot;</span><span class="p">])</span>

<span class="c1"># .. and later base the schedulers to trigger off this property:</span>

<span class="c1"># triggers the tests depending on the property forced_test</span>
<span class="n">builder1</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Trigger</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Trigger tests&quot;</span><span class="p">,</span>
                                <span class="n">schedulerNames</span><span class="o">=</span><span class="n">Property</span><span class="p">(</span><span class="s2">&quot;forced_tests&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="section" id="codebaseparameter">
<span id="sched-CodebaseParameter"></span><h8>CodebaseParameter<a class="headerlink" href="#codebaseparameter" title="Permalink to this headline">¶</a></h8>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CodebaseParameter</span><span class="p">(</span><span class="n">codebase</span><span class="o">=</span><span class="s2">&quot;myrepo&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is a parameter group to specify a sourcestamp for a given codebase.</p>
<p><code class="docutils literal notranslate"><span class="pre">codebase</span></code></p>
<blockquote>
<div>The name of the codebase.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">branch</span></code> (optional; default: StringParameter)</p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">parameter</span></a> specifying the branch to build.
The default value is a string parameter.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">revision</span></code> (optional; default: StringParameter)</p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">parameter</span></a> specifying the revision to build.
The default value is a string parameter.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">repository</span></code> (optional; default: StringParameter)</p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">parameter</span></a> specifying the repository for the build.
The default value is a string parameter.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">project</span></code> (optional; default: StringParameter)</p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">parameter</span></a> specifying the project for the build.
The default value is a string parameter.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">patch</span></code> (optional; default: None)</p>
<blockquote>
<div>A <a class="reference internal" href="#sched-PatchParameter" title="PatchParameter"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">PatchParameter</span></code></a> specifying that the user can upload a patch for this codebase.</div></blockquote>
</div>
<div class="section" id="fileparameter">
<span id="sched-FileParameter"></span><h8>FileParameter<a class="headerlink" href="#fileparameter" title="Permalink to this headline">¶</a></h8>
<p>This parameter allows the user to upload a file to a build.
The user can either write some text to a text area, or select a file from the browser.
Note that the file is then stored inside a property, so a <code class="docutils literal notranslate"><span class="pre">maxsize</span></code> of 10 megabytes has been set.
You can still override that <code class="docutils literal notranslate"><span class="pre">maxsize</span></code> if you wish.</p>
</div>
<div class="section" id="patchparameter">
<span id="sched-PatchParameter"></span><h8>PatchParameter<a class="headerlink" href="#patchparameter" title="Permalink to this headline">¶</a></h8>
<p>This parameter allows the user to specify a patch to be applied at the source step.
The patch is stored within the sourcestamp, and associated to a codebase.
That is why <a class="reference internal" href="#sched-PatchParameter" title="PatchParameter"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">PatchParameter</span></code></a> must be set inside a <a class="reference internal" href="#sched-CodebaseParameter" title="CodebaseParameter"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">CodebaseParameter</span></code></a>.</p>
<p><a class="reference internal" href="#sched-PatchParameter" title="PatchParameter"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">PatchParameter</span></code></a> is actually a <a class="reference internal" href="#sched-NestedParameter" title="NestedParameter"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">NestedParameter</span></code></a> composed of following fields:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FileParameter</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">),</span>
<span class="n">IntParameter</span><span class="p">(</span><span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="n">StringParameter</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="n">StringParameter</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
<span class="n">StringParameter</span><span class="p">(</span><span class="s1">&#39;subdir&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can customize any of these fields by overwriting their field name e.g:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">schedulers</span><span class="o">.</span><span class="n">ForceScheduler</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
        <span class="n">codebases</span><span class="o">=</span><span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">CodebaseParameter</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="n">patch</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">PatchParameter</span><span class="p">(</span>
            <span class="n">body</span><span class="o">=</span><span class="n">FileParameter</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="n">maxsize</span><span class="o">=</span><span class="mi">10000</span><span class="p">)))],</span>  <span class="c1"># override the maximum size of a patch to 10k instead of 10M</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;testy&quot;</span><span class="p">])]</span>
</pre></div>
</div>
</div>
<div class="section" id="inheritbuildparameter">
<span id="sched-InheritBuildParameter"></span><h8>InheritBuildParameter<a class="headerlink" href="#inheritbuildparameter" title="Permalink to this headline">¶</a></h8>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">InheritBuildParameter is not yet ported to data API, and cannot be used with buildbot nine yet(<a class="reference external" href="http://trac.buildbot.net/ticket/3521">bug #3521</a>).</p>
</div>
<p>This is a special parameter for inheriting force build properties from another build.
The user is presented with a list of compatible builds from which to choose, and all forced-build parameters from the selected build are copied into the new build.
The new parameter is:</p>
<p><code class="docutils literal notranslate"><span class="pre">compatible_builds</span></code></p>
<blockquote>
<div>A function to find compatible builds in the build history.
This function is given the master <code class="xref py py-class docutils literal notranslate"><span class="pre">Status</span></code> instance as first argument, and the current builder name as second argument, or None when forcing all builds.</div></blockquote>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_compatible_builds</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">builder</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># this is the case for force_build_all</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;cannot generate build list here&quot;</span><span class="p">]</span>
    <span class="c1"># find all successful builds in builder1 and builder2</span>
    <span class="n">builds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">builder</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;builder1&quot;</span><span class="p">,</span><span class="s2">&quot;builder2&quot;</span><span class="p">]:</span>
        <span class="n">builder_status</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">getBuilder</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">40</span><span class="p">):</span> <span class="c1"># 40 last builds</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">builder_status</span><span class="o">.</span><span class="n">getBuild</span><span class="p">(</span><span class="o">-</span><span class="n">num</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">getResults</span><span class="p">()</span> <span class="o">==</span> <span class="n">FAILURE</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">builds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">builder</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">getNumber</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">builds</span>

<span class="c1"># ...</span>

<span class="n">sched</span> <span class="o">=</span> <span class="n">Scheduler</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">[</span>
        <span class="n">InheritBuildParameter</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;inherit&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;promote a build for merge&quot;</span><span class="p">,</span>
            <span class="n">compatible_builds</span><span class="o">=</span><span class="n">get_compatible_builds</span><span class="p">,</span>
            <span class="n">required</span> <span class="o">=</span> <span class="kc">True</span><span class="p">),</span>
            <span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="workerchoiceparameter">
<span id="sched-WorkerChoiceParameter"></span><h8>WorkerChoiceParameter<a class="headerlink" href="#workerchoiceparameter" title="Permalink to this headline">¶</a></h8>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">WorkerChoiceParameter is not yet ported to data API, and cannot be used with buildbot nine yet(<a class="reference external" href="http://trac.buildbot.net/ticket/3521">bug #3521</a>).</p>
</div>
<p>This parameter allows a scheduler to require that a build is assigned to the chosen worker.
The choice is assigned to the <cite>workername</cite> property for the build.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">enforceChosenWorker</span></code> functor must be assigned to the <code class="docutils literal notranslate"><span class="pre">canStartBuild</span></code> parameter for the <code class="docutils literal notranslate"><span class="pre">Builder</span></code>.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="c1"># schedulers:</span>
<span class="n">ForceScheduler</span><span class="p">(</span>
    <span class="c1"># ...</span>
    <span class="n">properties</span><span class="o">=</span><span class="p">[</span>
        <span class="n">WorkerChoiceParameter</span><span class="p">(),</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># builders:</span>
<span class="n">BuilderConfig</span><span class="p">(</span>
    <span class="c1"># ...</span>
    <span class="n">canStartBuild</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">enforceChosenWorker</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="anypropertyparameter">
<h8>AnyPropertyParameter<a class="headerlink" href="#anypropertyparameter" title="Permalink to this headline">¶</a></h8>
<p>This parameter type can only be used in <code class="docutils literal notranslate"><span class="pre">properties</span></code>, and allows the user to specify both the property name and value in the web form.</p>
<p>This Parameter is here to reimplement old Buildbot behavior, and should be avoided.
Stricter parameter name and type should be preferred.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-manual/configuration/workers"></span><span class="target" id="workers"></span><div class="section" id="cfg-workers">
<span id="id1"></span><h4>2.5.6. Workers<a class="headerlink" href="#cfg-workers" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="#cfg-workers" title="workers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">workers</span></code></a> configuration key specifies a list of known workers.
In the common case, each worker is defined by an instance of the <a class="reference internal" href="#buildbot.worker.Worker" title="buildbot.worker.Worker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.Worker</span></code></a> class.
It represents a standard, manually started machine that will try to connect to the Buildbot master as a worker.
Buildbot also supports “on-demand”, or latent, workers, which allow Buildbot to dynamically start and stop worker instances.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#defining-workers" id="id6">Defining Workers</a></li>
<li><a class="reference internal" href="#worker-options" id="id7">Worker Options</a></li>
<li><a class="reference internal" href="#local-workers" id="id8">Local Workers</a></li>
<li><a class="reference internal" href="#latent-workers" id="id9">Latent Workers</a></li>
</ul>
</div>
<div class="section" id="defining-workers">
<h5><a class="toc-backref" href="#id6">2.5.6.1. Defining Workers</a><a class="headerlink" href="#defining-workers" title="Permalink to this headline">¶</a></h5>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> instance is created with a <code class="docutils literal notranslate"><span class="pre">workername</span></code> and a <code class="docutils literal notranslate"><span class="pre">workerpassword</span></code>.
These are the same two values that need to be provided to the worker administrator when they create the worker.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">workername</span></code> must be unique, of course.
The password exists to prevent evildoers from interfering with the Buildbot by inserting their own (broken) workers into the system and thus displacing the real ones.</p>
<p>Workers with an unrecognized <code class="docutils literal notranslate"><span class="pre">workername</span></code> or a non-matching password will be rejected when they attempt to connect, and a message describing the problem will be written to the log file (see <a class="reference internal" href="#logfiles"><span class="std std-ref">Logfiles</span></a>).</p>
<p>A configuration for two workers would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s1">&#39;solarispasswd&#39;</span><span class="p">),</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;bot-bsd&#39;</span><span class="p">,</span> <span class="s1">&#39;bsdpasswd&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="worker-options">
<h5><a class="toc-backref" href="#id7">2.5.6.2. Worker Options</a><a class="headerlink" href="#worker-options" title="Permalink to this headline">¶</a></h5>
<div class="section" id="properties">
<h6>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h6>
<p id="index-0"><code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> objects can also be created with an optional <code class="docutils literal notranslate"><span class="pre">properties</span></code> argument, a dictionary specifying properties that will be available to any builds performed on this worker.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s1">&#39;solarispasswd&#39;</span><span class="p">,</span>
                  <span class="n">properties</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;os&#39;</span><span class="p">:</span><span class="s1">&#39;solaris&#39;</span> <span class="p">}),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="limiting-concurrency">
<h6>Limiting Concurrency<a class="headerlink" href="#limiting-concurrency" title="Permalink to this headline">¶</a></h6>
<p id="index-1">The <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> constructor can also take an optional <code class="docutils literal notranslate"><span class="pre">max_builds</span></code> parameter to limit the number of builds that it will execute simultaneously:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;bot-linux&#39;</span><span class="p">,</span> <span class="s1">&#39;linuxpassword&#39;</span><span class="p">,</span>
                  <span class="n">max_builds</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In <a class="reference internal" href="#worker-for-builders"><span class="std std-ref">Worker For Builders</span></a> concept only one build from the same builder would run on the worker.</p>
</div>
</div>
<div class="section" id="master-worker-tcp-keepalive">
<h6>Master-Worker TCP Keepalive<a class="headerlink" href="#master-worker-tcp-keepalive" title="Permalink to this headline">¶</a></h6>
<p>By default, the buildmaster sends a simple, non-blocking message to each worker every hour.
These keepalives ensure that traffic is flowing over the underlying TCP connection, allowing the system’s network stack to detect any problems before a build is started.</p>
<p>The interval can be modified by specifying the interval in seconds using the <code class="docutils literal notranslate"><span class="pre">keepalive_interval</span></code> parameter of <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> (defaults to 3600):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;bot-linux&#39;</span><span class="p">,</span> <span class="s1">&#39;linuxpasswd&#39;</span><span class="p">,</span>
                  <span class="n">keepalive_interval</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The interval can be set to <code class="docutils literal notranslate"><span class="pre">None</span></code> to disable this functionality altogether.</p>
</div>
<div class="section" id="when-workers-go-missing">
<span id="id2"></span><h6>When Workers Go Missing<a class="headerlink" href="#when-workers-go-missing" title="Permalink to this headline">¶</a></h6>
<p>Sometimes, the workers go away.
One very common reason for this is when the worker process is started once (manually) and left running, but then later the machine reboots and the process is not automatically restarted.</p>
<p>If you’d like to have the administrator of the worker (or other people) be notified by email when the worker has been missing for too long, just add the <code class="docutils literal notranslate"><span class="pre">notify_on_missing=</span></code> argument to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> definition.
This value can be a single email address, or a list of addresses:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s1">&#39;solarispasswd&#39;</span><span class="p">,</span>
                  <span class="n">notify_on_missing</span><span class="o">=</span><span class="s1">&#39;bob@example.com&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>By default, this will send email when the worker has been disconnected for more than one hour.
Only one email per connection-loss event will be sent.
To change the timeout, use <code class="docutils literal notranslate"><span class="pre">missing_timeout=</span></code> and give it a number of seconds (the default is 3600).</p>
<p>You can have the buildmaster send email to multiple recipients: just provide a list of addresses instead of a single one:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s1">&#39;solarispasswd&#39;</span><span class="p">,</span>
                  <span class="n">notify_on_missing</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bob@example.com&#39;</span><span class="p">,</span>
                                     <span class="s1">&#39;alice@example.org&#39;</span><span class="p">],</span>
                  <span class="n">missing_timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>  <span class="c1"># notify after 5 minutes</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The email sent this way will use a <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> (see <a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a>) status target, if one is configured.
This provides a way for you to control the <em>from</em> address of the email, as well as the relayhost (aka <em>smarthost</em>) to use as an SMTP server.
If no <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> is configured on this buildmaster, the worker-missing emails will be sent using a default configuration.</p>
<p>Note that if you want to have a <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> for worker-missing emails but not for regular build emails, just create one with <code class="docutils literal notranslate"><span class="pre">builders=[]</span></code>, as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">status</span><span class="p">,</span> <span class="n">worker</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">status</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s1">&#39;buildbot@localhost&#39;</span><span class="p">,</span> <span class="n">builders</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">relayhost</span><span class="o">=</span><span class="s1">&#39;smtp.example.org&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;reporters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="s1">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s1">&#39;solarispasswd&#39;</span><span class="p">,</span>
                      <span class="n">notify_on_missing</span><span class="o">=</span><span class="s1">&#39;bob@example.com&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="workers-states">
<span id="worker-states"></span><h6>Workers States<a class="headerlink" href="#workers-states" title="Permalink to this headline">¶</a></h6>
<p>There are some times when a worker misbehaves because of issues with its configuration.
In those cases, you may want to pause the worker, or maybe completely shut it down.</p>
<p>There are three actions that you may take (in the worker’s web page <em>Actions</em> dialog)</p>
<ul class="simple">
<li><em>Pause</em>: If a worker is paused, it won’t accept new builds. The action of pausing a worker will not affect any build ongoing.</li>
<li><em>Graceful Shutdown</em>: If a worker is in graceful shutdown mode, it won’t accept new builds, but will finish the current builds.
When all of its build are finished, the <strong class="command">buildbot-worker</strong> process will terminate.</li>
<li><em>Force Shutdown</em>: If a worker is in force shutdown mode, it will terminate immediately, and the build he was currently doing will be put to retry state.</li>
</ul>
<p>Those actions will put the worker in two states</p>
<ul class="simple">
<li><em>paused</em>: the worker is paused if it is connected but doesn’t accept new builds.</li>
<li><em>graceful</em>: the worker is graceful if it doesn’t accept new builds, and will shutdown when builds are finished.</li>
</ul>
<p>A worker might be put to <code class="docutils literal notranslate"><span class="pre">paused</span></code> state automatically if buildbot detects a misbehavior.
This is called the <em>quarantine timer</em>.</p>
<p>Quarantine timer is an exponential back-off mechanism for workers.
This avoids a misbehaving worker to eat the build queue by quickly finishing builds in <code class="docutils literal notranslate"><span class="pre">EXCEPTION</span></code> state.
When misbehavior is detected, the timer will pause the worker for 10 second, and then that time will double at each misbehavior detection, until the worker finishes a build.</p>
<p>The first case of misbehavior is for a latent worker to not start properly.
The second case of misbehavior is for a build to end with an <code class="docutils literal notranslate"><span class="pre">EXCEPTION</span></code> status.</p>
<p>Worker states are stored in the database, can be queried via <a class="reference internal" href="#rest-api"><span class="std std-ref">REST API</span></a> and visible in the UI’s workers page.</p>
</div>
</div>
<div class="section" id="local-workers">
<span id="index-2"></span><span id="id3"></span><h5><a class="toc-backref" href="#id8">2.5.6.3. Local Workers</a><a class="headerlink" href="#local-workers" title="Permalink to this headline">¶</a></h5>
<p>For smaller setups, you may want to just run the workers on the same machine as the master.
To simplify the maintenance, you may even want to run them in the same process.</p>
<p>This is what LocalWorker is for.
Instead of configuring a <code class="docutils literal notranslate"><span class="pre">worker.Worker</span></code>, you have to configure a <code class="docutils literal notranslate"><span class="pre">worker.LocalWorker</span></code>.
As the worker is running on the same process, password is not necessary.
You can run as many local workers as long as your machine CPU and memory is allowing.</p>
<p>A configuration for two workers would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">LocalWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">),</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">LocalWorker</span><span class="p">(</span><span class="s1">&#39;bot2&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>In order to use local workers you need to have <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> package installed.</p>
</div>
<div class="section" id="latent-workers">
<span id="index-3"></span><span id="id4"></span><h5><a class="toc-backref" href="#id9">2.5.6.4. Latent Workers</a><a class="headerlink" href="#latent-workers" title="Permalink to this headline">¶</a></h5>
<p>The standard Buildbot model has workers started manually.
The previous section described how to configure the master for this approach.</p>
<p>Another approach is to let the Buildbot master start workers when builds are ready, on-demand.
Thanks to services such as Amazon Web Services’ Elastic Compute Cloud (“AWS EC2”), this is relatively easy to set up, and can be very useful for some situations.</p>
<p>The workers that are started on-demand are called “latent” workers.
You can find the list of <a class="reference internal" href="#supported-latent-workers"><span class="std std-ref">Supported Latent Workers</span></a> below.</p>
<div class="section" id="common-options">
<span id="common-latent-workers-options"></span><h6>Common Options<a class="headerlink" href="#common-options" title="Permalink to this headline">¶</a></h6>
<p>The following options are available for all latent workers.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">build_wait_timeout</span></code></dt>
<dd>This option allows you to specify how long a latent worker should wait after a build for another build before it shuts down.
It defaults to 10 minutes.
If this is set to 0 then the worker will be shut down immediately.
If it is less than 0 it will never automatically shutdown.</dd>
</dl>
</div>
<div class="section" id="supported-latent-workers">
<span id="id5"></span><h6>Supported Latent Workers<a class="headerlink" href="#supported-latent-workers" title="Permalink to this headline">¶</a></h6>
<p>As of time of writing, Buildbot supports the following latent workers:</p>
<div class="toctree-wrapper compound">
<span id="document-manual/configuration/workers-ec2"></span><span class="target" id="index-0"></span><div class="section" id="amazon-web-services-elastic-compute-cloud-aws-ec2">
<span id="worker-EC2LatentWorker"></span><h7>Amazon Web Services Elastic Compute Cloud (“AWS EC2”)<a class="headerlink" href="#amazon-web-services-elastic-compute-cloud-aws-ec2" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.worker.ec2.EC2LatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.worker.ec2.</code><code class="descname">EC2LatentWorker</code><a class="headerlink" href="#buildbot.worker.ec2.EC2LatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://aws.amazon.com/ec2/">EC2</a> is a web service that allows you to start virtual machines in an Amazon data center.
Please see their website for details, including costs.
Using the AWS EC2 latent workers involves getting an EC2 account with AWS and setting up payment; customizing one or more EC2 machine images (“AMIs”) on your desired operating system(s) and publishing them (privately if needed); and configuring the buildbot master to know how to start your customized images for “substantiating” your latent workers.</p>
<p>This document will guide you through setup of a AWS EC2 latent worker:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#get-an-aws-ec2-account" id="id1">Get an AWS EC2 Account</a></li>
<li><a class="reference internal" href="#create-an-ami" id="id2">Create an AMI</a></li>
<li><a class="reference internal" href="#configure-the-master-with-an-ec2latentworker" id="id3">Configure the Master with an <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentWorker</span></code></a></a></li>
<li><a class="reference internal" href="#volumes" id="id4">Volumes</a></li>
<li><a class="reference internal" href="#vpc-support" id="id5">VPC Support</a></li>
<li><a class="reference internal" href="#spot-instances" id="id6">Spot instances</a></li>
</ul>
</div>
<div class="section" id="get-an-aws-ec2-account">
<h8><a class="toc-backref" href="#id1">Get an AWS EC2 Account</a><a class="headerlink" href="#get-an-aws-ec2-account" title="Permalink to this headline">¶</a></h8>
<p>To start off, to use the AWS EC2 latent worker, you need to get an AWS developer account and sign up for EC2.
Although Amazon often changes this process, these instructions should help you get started:</p>
<ol class="arabic simple">
<li>Go to <a class="reference external" href="http://aws.amazon.com/">http://aws.amazon.com/</a> and click to “Sign Up Now” for an AWS account.</li>
<li>Once you are logged into your account, you need to sign up for EC2.
Instructions for how to do this have changed over time because Amazon changes their website, so the best advice is to hunt for it.
After signing up for EC2, it may say it wants you to upload an x.509 cert.
You will need this to create images (see below) but it is not technically necessary for the buildbot master configuration.</li>
<li>You must enter a valid credit card before you will be able to use EC2.
Do that under ‘Payment Method’.</li>
<li>Make sure you’re signed up for EC2 by going to <span class="menuselection">Your Account ‣ Account Activity</span> and verifying EC2 is listed.</li>
</ol>
</div>
<div class="section" id="create-an-ami">
<h8><a class="toc-backref" href="#id2">Create an AMI</a><a class="headerlink" href="#create-an-ami" title="Permalink to this headline">¶</a></h8>
<p>Now you need to create an AMI and configure the master.
You may need to run through this cycle a few times to get it working, but these instructions should get you started.</p>
<p>Creating an AMI is out of the scope of this document.
The <a class="reference external" href="http://docs.amazonwebservices.com/AWSEC2/latest/GettingStartedGuide/">EC2 Getting Started Guide</a> is a good resource for this task.
Here are a few additional hints.</p>
<ul class="simple">
<li>When an instance of the image starts, it needs to automatically start a buildbot worker that connects to your master (to create a buildbot worker, <a class="reference internal" href="#creating-a-worker"><span class="std std-ref">Creating a worker</span></a>; to make a daemon, <a class="reference internal" href="#launching-the-daemons"><span class="std std-ref">Launching the daemons</span></a>).</li>
<li>You may want to make an instance of the buildbot worker, configure it as a standard worker in the master (i.e., not as a latent worker), and test and debug it that way before you turn it into an AMI and convert to a latent worker in the master.</li>
<li>In order to avoid extra costs in case of master failure, you should configure the worker of the AMI with <code class="docutils literal notranslate"><span class="pre">maxretries</span></code> option (see <a class="reference internal" href="#worker-options"><span class="std std-ref">Worker Options</span></a>)
Also see <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/blob/master/master/contrib/systemd/worker.service">example systemd unit file example</a></li>
</ul>
</div>
<div class="section" id="configure-the-master-with-an-ec2latentworker">
<h8><a class="toc-backref" href="#id3">Configure the Master with an <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentWorker</span></code></a></a><a class="headerlink" href="#configure-the-master-with-an-ec2latentworker" title="Permalink to this headline">¶</a></h8>
<p>Now let’s assume you have an AMI that should work with the <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentWorker</span></code></a>.
It’s now time to set up your buildbot master configuration.</p>
<p>You will need some information from your AWS account: the <cite>Access Key Id</cite> and the <cite>Secret Access Key</cite>.
If you’ve built the AMI yourself, you probably already are familiar with these values.
If you have not, and someone has given you access to an AMI, these hints may help you find the necessary values:</p>
<ul class="simple">
<li>While logged into your AWS account, find the “Access Identifiers” link (either on the left, or via <span class="menuselection">Your Account ‣ Access Identifiers</span>.</li>
<li>On the page, you’ll see alphanumeric values for “Your Access Key Id:” and “Your Secret Access Key:”.
Make a note of these.
Later on, we’ll call the first one your <code class="docutils literal notranslate"><span class="pre">identifier</span></code> and the second one your <code class="docutils literal notranslate"><span class="pre">secret_identifier</span></code>.</li>
</ul>
<p>When creating an <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentWorker</span></code></a> in the buildbot master configuration, the first three arguments are required.
The name and password are the first two arguments, and work the same as with normal workers.
The next argument specifies the type of the EC2 virtual machine (available options as of this writing include <code class="docutils literal notranslate"><span class="pre">m1.small</span></code>, <code class="docutils literal notranslate"><span class="pre">m1.large</span></code>, <code class="docutils literal notranslate"><span class="pre">m1.xlarge</span></code>, <code class="docutils literal notranslate"><span class="pre">c1.medium</span></code>, and <code class="docutils literal notranslate"><span class="pre">c1.xlarge</span></code>; see the EC2 documentation for descriptions of these machines).</p>
<p>Here is the simplest example of configuring an EC2 latent worker.
It specifies all necessary remaining values explicitly in the instantiation.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="n">ami</span><span class="o">=</span><span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span>
                           <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;publickey&#39;</span><span class="p">,</span>
                           <span class="n">secret_identifier</span><span class="o">=</span><span class="s1">&#39;privatekey&#39;</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">ami</span></code> argument specifies the AMI that the master should start.
The <code class="docutils literal notranslate"><span class="pre">identifier</span></code> argument specifies the AWS <cite>Access Key Id</cite>, and the <code class="docutils literal notranslate"><span class="pre">secret_identifier</span></code> specifies the AWS <cite>Secret Access Key</cite>.
Both the AMI and the account information can be specified in alternate ways.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Whoever has your <code class="docutils literal notranslate"><span class="pre">identifier</span></code> and <code class="docutils literal notranslate"><span class="pre">secret_identifier</span></code> values can request AWS work charged to your account, so these values need to be carefully protected.
Another way to specify these access keys is to put them in a separate file.
Buildbot supports the standard AWS credentials file.
You can then make the access privileges stricter for this separate file, and potentially let more people read your main configuration file.
If your master is running in EC2, you can also use IAM roles for EC2 to delegate permissions.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">keypair_name</span></code> and <code class="docutils literal notranslate"><span class="pre">security_name</span></code> allow you to specify different names for these AWS EC2 values.</p>
<p>You can make an <code class="file docutils literal notranslate"><span class="pre">.aws</span></code> directory in the home folder of the user running the buildbot master.
In that directory, create a file called <code class="file docutils literal notranslate"><span class="pre">credentials</span></code>.
The format of the file should be as follows, replacing <code class="docutils literal notranslate"><span class="pre">identifier</span></code> and <code class="docutils literal notranslate"><span class="pre">secret_identifier</span></code> with the credentials obtained before.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">default</span><span class="p">]</span>
<span class="n">aws_access_key_id</span> <span class="o">=</span> <span class="n">identifier</span>
<span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="n">secret_identifier</span>
</pre></div>
</div>
<p>If you are using IAM roles, no config file is required.
Then you can instantiate the worker as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="n">ami</span><span class="o">=</span><span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Previous examples used a particular AMI.
If the Buildbot master will be deployed in a process-controlled environment, it may be convenient to specify the AMI more flexibly.
Rather than specifying an individual AMI, specify one or two AMI filters.</p>
<p>In all cases, the AMI that sorts last by its location (the S3 bucket and manifest name) will be preferred.</p>
<p>One available filter is to specify the acceptable AMI owners, by AWS account number (the 12 digit number, usually rendered in AWS with hyphens like “1234-5678-9012”, should be entered as in integer).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">bot1</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                              <span class="n">valid_ami_owners</span><span class="o">=</span><span class="p">[</span><span class="mi">11111111111</span><span class="p">,</span>
                                                <span class="mi">22222222222</span><span class="p">],</span>
                              <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;publickey&#39;</span><span class="p">,</span>
                              <span class="n">secret_identifier</span><span class="o">=</span><span class="s1">&#39;privatekey&#39;</span><span class="p">,</span>
                              <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                              <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                              <span class="p">)</span>
</pre></div>
</div>
<p>The other available filter is to provide a regular expression string that will be matched against each AMI’s location (the S3 bucket and manifest name).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">bot1</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span>
        <span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
        <span class="n">valid_ami_location_regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;buildbot\-.*/image.manifest.xml&#39;</span><span class="p">,</span>
        <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;publickey&#39;</span><span class="p">,</span>
        <span class="n">secret_identifier</span><span class="o">=</span><span class="s1">&#39;privatekey&#39;</span><span class="p">,</span>
        <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
        <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>The regular expression can specify a group, which will be preferred for the sorting.
Only the first group is used; subsequent groups are ignored.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">bot1</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span>
    <span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
    <span class="n">valid_ami_location_regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;buildbot\-.*\-(.*)/image.manifest.xml&#39;</span><span class="p">,</span>
    <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;publickey&#39;</span><span class="p">,</span>
    <span class="n">secret_identifier</span><span class="o">=</span><span class="s1">&#39;privatekey&#39;</span><span class="p">,</span>
    <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
    <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>If the group can be cast to an integer, it will be.
This allows 10 to sort after 1, for instance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">bot1</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span>
        <span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
        <span class="n">valid_ami_location_regex</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;buildbot\-.*\-(\d+)/image.manifest.xml&#39;</span><span class="p">,</span>
        <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;publickey&#39;</span><span class="p">,</span>
        <span class="n">secret_identifier</span><span class="o">=</span><span class="s1">&#39;privatekey&#39;</span><span class="p">,</span>
        <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
        <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>In addition to using the password as a handshake between the master and the worker, you may want to use a firewall to assert that only machines from a specific IP can connect as workers.
This is possible with AWS EC2 by using the Elastic IP feature.
To configure, generate a Elastic IP in AWS, and then specify it in your configuration using the <code class="docutils literal notranslate"><span class="pre">elastic_ip</span></code> argument.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span>
                           <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;publickey&#39;</span><span class="p">,</span>
                           <span class="n">secret_identifier</span><span class="o">=</span><span class="s1">&#39;privatekey&#39;</span><span class="p">,</span>
                           <span class="n">elastic_ip</span><span class="o">=</span><span class="s1">&#39;208.77.188.166&#39;</span><span class="p">,</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>One other way to configure a worker is by settings AWS tags.
They can for example be used to have a more restrictive security <a class="reference external" href="http://aws.amazon.com/iam/">IAM</a> policy.
To get Buildbot to tag the latent worker specify the tag keys and values in your configuration using the <code class="docutils literal notranslate"><span class="pre">tags</span></code> argument.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span>
                           <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;publickey&#39;</span><span class="p">,</span>
                           <span class="n">secret_identifier</span><span class="o">=</span><span class="s1">&#39;privatekey&#39;</span><span class="p">,</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SomeTag&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">})</span>
<span class="p">]</span>
</pre></div>
</div>
<p>If the worker needs access to additional AWS resources, you can also enable your workers to access them via an EC2 instance profile.
To use this capability, you must first create an instance profile separately in AWS.
Then specify its name on EC2LatentWorker via instance_profile_name.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="n">ami</span><span class="o">=</span><span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">instance_profile_name</span><span class="o">=</span><span class="s1">&#39;my_profile&#39;</span>
                           <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>You may also supply your own boto3.Session object to allow for more flexible session options (ex. cross-account)
To use this capability, you must first create a boto3.Session object.
Then provide it to EC2LatentWorker via <code class="docutils literal notranslate"><span class="pre">session</span></code> argument.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>

<span class="n">session</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="n">ami</span><span class="o">=</span><span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">session</span><span class="o">=</span><span class="n">session</span>
                           <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentWorker</span></code></a> supports all other configuration from the standard <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>.
The <code class="docutils literal notranslate"><span class="pre">missing_timeout</span></code> and <code class="docutils literal notranslate"><span class="pre">notify_on_missing</span></code> specify how long to wait for an EC2 instance to attach before considering the attempt to have failed, and email addresses to alert, respectively.
<code class="docutils literal notranslate"><span class="pre">missing_timeout</span></code> defaults to 20 minutes.</p>
</div>
<div class="section" id="volumes">
<h8><a class="toc-backref" href="#id4">Volumes</a><a class="headerlink" href="#volumes" title="Permalink to this headline">¶</a></h8>
<p>If you want to attach existing volumes to an ec2 latent worker, use the volumes attribute.
This mechanism can be valuable if you want to maintain state on a conceptual worker across multiple start/terminate sequences.
<code class="docutils literal notranslate"><span class="pre">volumes</span></code> expects a list of (volume_id, mount_point) tuples to attempt attaching when your instance has been created.</p>
<p>If you want to attach new ephemeral volumes, use the the block_device_map attribute.
This follows the AWS API syntax, essentially acting as a passthrough.
The only distinction is that the volumes default to deleting on termination to avoid leaking volume resources when workers are terminated.
See boto documentation for further details.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="n">ami</span><span class="o">=</span><span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">block_device_map</span><span class="o">=</span> <span class="p">[</span>
                             <span class="s2">&quot;DeviceName&quot;</span><span class="p">:</span> <span class="s2">&quot;/dev/xvdb&quot;</span><span class="p">,</span>
                             <span class="s2">&quot;Ebs&quot;</span> <span class="p">:</span> <span class="p">{</span>
                                <span class="s2">&quot;VolumeType&quot;</span><span class="p">:</span> <span class="s2">&quot;io1&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;Iops&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
                                <span class="s2">&quot;VolumeSize&quot;</span><span class="p">:</span> <span class="mi">100</span>
                              <span class="p">}</span>
                           <span class="p">]</span>
                           <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="vpc-support">
<h8><a class="toc-backref" href="#id5">VPC Support</a><a class="headerlink" href="#vpc-support" title="Permalink to this headline">¶</a></h8>
<p>If you are managing workers within a VPC, your worker configuration must be modified from above.
You must specify the id of the subnet where you want your worker placed.
You must also specify security groups created within your VPC as opposed to classic EC2 security groups.
This can be done by passing the ids of the vpc security groups.
Note, when using a VPC, you can not specify classic EC2 security groups (as specified by security_name).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="n">ami</span><span class="o">=</span><span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">subnet_id</span><span class="o">=</span><span class="s1">&#39;subnet-12345&#39;</span><span class="p">,</span>
                           <span class="n">security_group_ids</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sg-12345&#39;</span><span class="p">,</span><span class="s1">&#39;sg-67890&#39;</span><span class="p">]</span>
                           <span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="spot-instances">
<h8><a class="toc-backref" href="#id6">Spot instances</a><a class="headerlink" href="#spot-instances" title="Permalink to this headline">¶</a></h8>
<p>If you would prefer to use spot instances for running your builds, you can accomplish that by passing in a True value to the <code class="docutils literal notranslate"><span class="pre">spot_instance</span></code> parameter to the <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentWorker</span></code></a> constructor.
Additionally, you may want to specify <code class="docutils literal notranslate"><span class="pre">max_spot_price</span></code> and <code class="docutils literal notranslate"><span class="pre">price_multiplier</span></code> in order to limit your builds’ budget consumption.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">EC2LatentWorker</span><span class="p">(</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s1">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;ami-12345&#39;</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="s1">&#39;us-west-2&#39;</span><span class="p">,</span>
                           <span class="n">identifier</span><span class="o">=</span><span class="s1">&#39;publickey&#39;</span><span class="p">,</span>
                           <span class="n">secret_identifier</span><span class="o">=</span><span class="s1">&#39;privatekey&#39;</span><span class="p">,</span>
                           <span class="n">elastic_ip</span><span class="o">=</span><span class="s1">&#39;208.77.188.166&#39;</span><span class="p">,</span>
                           <span class="n">keypair_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">security_name</span><span class="o">=</span><span class="s1">&#39;latent_buildbot_worker&#39;</span><span class="p">,</span>
                           <span class="n">placement</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">spot_instance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                           <span class="n">max_spot_price</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span>
                           <span class="n">price_multiplier</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
                           <span class="n">product_description</span><span class="o">=</span><span class="s1">&#39;Linux/UNIX&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This example would attempt to create a m1.large spot instance in the us-west-2b region costing no more than $0.09/hour.
The spot prices for ‘Linux/UNIX’ spot instances in that region over the last 24 hours will be averaged and multiplied by the <code class="docutils literal notranslate"><span class="pre">price_multiplier</span></code> parameter, then a spot request will be sent to Amazon with the above details.
If the multiple exceeds the <code class="docutils literal notranslate"><span class="pre">max_spot_price</span></code>, the bid price will be the <code class="docutils literal notranslate"><span class="pre">max_spot_price</span></code>.</p>
<p>Either <code class="docutils literal notranslate"><span class="pre">max_spot_price</span></code> or <code class="docutils literal notranslate"><span class="pre">price_multiplier</span></code>, but not both, may be None.
If <code class="docutils literal notranslate"><span class="pre">price_multiplier</span></code> is None, then no historical price information is retrieved; the bid price is simply the specified <code class="docutils literal notranslate"><span class="pre">max_spot_price</span></code>.
If the <code class="docutils literal notranslate"><span class="pre">max_spot_price</span></code> is None, then the multiple of the historical average spot prices is used as the bid price with no limit.</p>
</div>
</div>
<span id="document-manual/configuration/workers-libvirt"></span><span class="target" id="index-0"></span><div class="section" id="libvirt">
<span id="worker-LibVirtWorker"></span><h7>Libvirt<a class="headerlink" href="#libvirt" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.worker.libvirt.LibVirtWorker">
<em class="property">class </em><code class="descclassname">buildbot.worker.libvirt.</code><code class="descname">LibVirtWorker</code><a class="headerlink" href="#buildbot.worker.libvirt.LibVirtWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://www.libvirt.org/">libvirt</a> is a virtualization API for interacting with the virtualization capabilities of recent versions of Linux and other OSes.
It is LGPL and comes with a stable C API, and Python bindings.</p>
<p>This means we now have an API which when tied to buildbot allows us to have workers that run under Xen, QEMU, KVM, LXC, OpenVZ, User Mode Linux, VirtualBox and VMWare.</p>
<p>The libvirt code in Buildbot was developed against libvirt 0.7.5 on Ubuntu Lucid.
It is used with KVM to test Python code on VMs, but obviously isn’t limited to that.
Each build is run on a new VM, images are temporary and thrown away after each build.</p>
<p>This document will guide you through setup of a libvirt latent worker:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#setting-up-libvirt" id="id2">Setting up libvirt</a></li>
<li><a class="reference internal" href="#configuring-your-base-image" id="id3">Configuring your base image</a></li>
<li><a class="reference internal" href="#configuring-your-master" id="id4">Configuring your Master</a></li>
<li><a class="reference internal" href="#configuring-master-to-use-libvirt-on-remote-server" id="id5">Configuring Master to use libvirt on remote server</a></li>
</ul>
</div>
<div class="section" id="setting-up-libvirt">
<h8><a class="toc-backref" href="#id2">Setting up libvirt</a><a class="headerlink" href="#setting-up-libvirt" title="Permalink to this headline">¶</a></h8>
<p>We won’t show you how to set up libvirt as it is quite different on each platform, but there are a few things you should keep in mind.</p>
<ul class="simple">
<li>If you are using the system libvirt (libvirt and buildbot master are on same server), your buildbot master user will need to be in the libvirtd group.</li>
<li>If libvirt and buildbot master are on different servers, the user connecting to libvirt over ssh will need to be in the libvirtd group. Also need to setup authorization via ssh-keys (without password prompt).</li>
<li>If you are using KVM, your buildbot master user will need to be in the KVM group.</li>
<li>You need to think carefully about your virtual network <em>first</em>.
Will NAT be enough?
What IP will my VMs need to connect to for connecting to the master?</li>
</ul>
</div>
<div class="section" id="configuring-your-base-image">
<h8><a class="toc-backref" href="#id3">Configuring your base image</a><a class="headerlink" href="#configuring-your-base-image" title="Permalink to this headline">¶</a></h8>
<p>You need to create a base image for your builds that has everything needed to build your software.
You need to configure the base image with a buildbot worker that is configured to connect to the master on boot.</p>
<p>Because this image may need updating a lot, we strongly suggest scripting its creation.</p>
<p>If you want to have multiple workers using the same base image it can be annoying to duplicate the image just to change the buildbot credentials.
One option is to use libvirt’s DHCP server to allocate an identity to the worker: DHCP sets a hostname, and the worker takes its identity from that.</p>
<p>Doing all this is really beyond the scope of the manual, but there is a <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/libvirt/vmbuilder">vmbuilder</a> script and a <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/libvirt/network.xml">network.xml</a> file to create such a DHCP server in <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/">master/contrib/</a> (<a class="reference internal" href="#contrib-scripts"><span class="std std-ref">Contrib Scripts</span></a>) that should get you started:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install ubuntu-vm-builder
sudo contrib/libvirt/vmbuilder
</pre></div>
</div>
<p>Should create an <code class="file docutils literal notranslate"><span class="pre">ubuntu/</span></code> folder with a suitable image in it.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>virsh net-define contrib/libvirt/network.xml
virsh net-start buildbot-network
</pre></div>
</div>
<p>Should set up a KVM compatible libvirt network for your buildbot VM’s to run on.</p>
</div>
<div class="section" id="configuring-your-master">
<h8><a class="toc-backref" href="#id4">Configuring your Master</a><a class="headerlink" href="#configuring-your-master" title="Permalink to this headline">¶</a></h8>
<p>If you want to add a simple on demand VM to your setup, you only need the following.
We set the username to <code class="docutils literal notranslate"><span class="pre">minion1</span></code>, the password to <code class="docutils literal notranslate"><span class="pre">sekrit</span></code>.
The base image is called <code class="docutils literal notranslate"><span class="pre">base_image</span></code> and a copy of it will be made for the duration of the VM’s life.
That copy will be thrown away every time a build is complete.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span><span class="p">,</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">LibVirtWorker</span><span class="p">(</span><span class="s1">&#39;minion1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span>
                         <span class="n">util</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="s2">&quot;qemu:///session&quot;</span><span class="p">),</span>
                         <span class="s1">&#39;/home/buildbot/images/minion1&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;/home/buildbot/images/base_image&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>You can use virt-manager to define <code class="docutils literal notranslate"><span class="pre">minion1</span></code> with the correct hardware.
If you don’t, buildbot won’t be able to find a VM to start.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">LibVirtWorker</span></code> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>Both a buildbot username and the name of the virtual machine.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt>
<dd>A password for the buildbot to login to the master with.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">connection</span></code></dt>
<dd><code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> instance wrapping connection to libvirt.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hd_image</span></code></dt>
<dd>The path to a libvirt disk image, normally in qcow2 format when using KVM.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">base_image</span></code></dt>
<dd>If given a base image, buildbot will clone it every time it starts a VM.
This means you always have a clean environment to do your build in.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xml</span></code></dt>
<dd>If a VM isn’t predefined in virt-manager, then you can instead provide XML like that used with <code class="docutils literal notranslate"><span class="pre">virsh</span> <span class="pre">define</span></code>.
The VM will be created automatically when needed, and destroyed when not needed any longer.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">hd_image</span></code> and <code class="docutils literal notranslate"><span class="pre">base_image</span></code> must be on same machine with buildbot master.</p>
</div>
</div>
<div class="section" id="configuring-master-to-use-libvirt-on-remote-server">
<h8><a class="toc-backref" href="#id5">Configuring Master to use libvirt on remote server</a><a class="headerlink" href="#configuring-master-to-use-libvirt-on-remote-server" title="Permalink to this headline">¶</a></h8>
<p>If you want to use libvirt on remote server configure remote libvirt server and buildbot server following way.</p>
<ol class="arabic simple">
<li>Define user to connect to remote machine using ssh. Configure connection of such user to remote libvirt server (see <a class="reference external" href="https://wiki.libvirt.org/page/SSHSetup">https://wiki.libvirt.org/page/SSHSetup</a>) without password prompt.</li>
<li>Add user to libvirtd group on remote libvirt server <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">usermod</span> <span class="pre">-G</span> <span class="pre">libvirtd</span> <span class="pre">-a</span> <span class="pre">&lt;user&gt;</span></code>.</li>
</ol>
<p>Configure remote libvirt server:</p>
<ol class="arabic simple">
<li>Create virtual machine for buildbot and configure it.</li>
<li>Change virtual machine image file to new name, which will be used as temporary image and deleted after virtual machine stops. Execute command <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">virsh</span> <span class="pre">edit</span> <span class="pre">&lt;VM</span> <span class="pre">name&gt;</span></code>. In xml file locate <code class="docutils literal notranslate"><span class="pre">devices/disk/source</span></code> and change file path to new name. The file must not be exists, it will create via hook script.</li>
<li>Add hook script to <code class="docutils literal notranslate"><span class="pre">/etc/libvirt/hooks/qemu</span></code> to recreate VM image each start:</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python</span>

<span class="c1"># Script /etc/libvirt/hooks/qemu</span>
<span class="c1"># Don&#39;t forget to execute service libvirt-bin restart</span>
<span class="c1"># Also see https://www.libvirt.org/hooks.html</span>

<span class="c1"># This script make clean VM for each start using base image</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">images_path</span> <span class="o">=</span> <span class="s1">&#39;/var/lib/libvirt/images/&#39;</span>

<span class="c1"># build-vm - VM name in virsh list --all</span>
<span class="c1"># vm_base_image.qcow2 - base image file name, must exist in path /var/lib/libvirt/images/</span>
<span class="c1"># vm_temp_image.qcow2 - temporary image. Must not exist in path /var/lib/libvirt/images/, but defined in VM config file</span>
<span class="n">domains</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;build-vm&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;vm_base_image.qcow2&#39;</span><span class="p">,</span> <span class="s1">&#39;vm_temp_image.qcow2&#39;</span><span class="p">],</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">delete_image_clone</span><span class="p">(</span><span class="n">vir_domain</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">vir_domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
             <span class="n">domain</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="n">vir_domain</span><span class="p">]</span>
             <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">images_path</span> <span class="o">+</span> <span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">create_image_clone</span><span class="p">(</span><span class="n">vir_domain</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">vir_domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
             <span class="n">domain</span> <span class="o">=</span> <span class="n">domains</span><span class="p">[</span><span class="n">vir_domain</span><span class="p">]</span>
             <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/usr/bin/qemu-img&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">images_path</span> <span class="o">+</span> <span class="n">domain</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;qcow2&#39;</span><span class="p">,</span> <span class="n">images_path</span> <span class="o">+</span> <span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
             <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">vir_domain</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;prepare&quot;</span><span class="p">]:</span>
             <span class="n">create_image_clone</span><span class="p">(</span><span class="n">vir_domain</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;release&quot;</span><span class="p">]:</span>
             <span class="n">delete_image_clone</span><span class="p">(</span><span class="n">vir_domain</span><span class="p">)</span>
</pre></div>
</div>
<p>Configure buildbot server:</p>
<ol class="arabic simple">
<li>On buildbot server in virtual environment install libvirt-python package: <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">libvirt-python</span></code></li>
<li>Create worker using remote ssh connection.</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span><span class="p">,</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">LibVirtWorker</span><span class="p">(</span><span class="s1">&#39;minion1&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span>
                         <span class="n">util</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span><span class="s2">&quot;qemu+ssh://&lt;user&gt;@&lt;ip address or DNS name&gt;:&lt;port&gt;/session&quot;</span><span class="p">),</span>
                         <span class="s1">&#39;/home/buildbot/images/minion1&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<span id="document-manual/configuration/workers-openstack"></span><div class="section" id="openstack">
<span id="worker-OpenStackLatentWorker"></span><h7>OpenStack<a class="headerlink" href="#openstack" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.worker.openstack.OpenStackLatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.worker.openstack.</code><code class="descname">OpenStackLatentWorker</code><a class="headerlink" href="#buildbot.worker.openstack.OpenStackLatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://openstack.org/">OpenStack</a> is a series of interconnected components that facilitates managing compute, storage, and network resources in a data center.
It is available under the Apache License and has a REST interface along with a Python client.</p>
<p>This document will guide you through setup of an OpenStack latent worker:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#install-dependencies" id="id2">Install dependencies</a></li>
<li><a class="reference internal" href="#get-an-account-in-an-openstack-cloud" id="id3">Get an Account in an OpenStack cloud</a></li>
<li><a class="reference internal" href="#create-an-image" id="id4">Create an Image</a></li>
<li><a class="reference internal" href="#configure-the-master-with-an-openstacklatentworker" id="id5">Configure the Master with an OpenStackLatentWorker</a></li>
</ul>
</div>
<div class="section" id="install-dependencies">
<h8><a class="toc-backref" href="#id2">Install dependencies</a><a class="headerlink" href="#install-dependencies" title="Permalink to this headline">¶</a></h8>
<p>OpenStackLatentWorker requires python-novaclient to work, you can install it with pip install python-novaclient.</p>
</div>
<div class="section" id="get-an-account-in-an-openstack-cloud">
<h8><a class="toc-backref" href="#id3">Get an Account in an OpenStack cloud</a><a class="headerlink" href="#get-an-account-in-an-openstack-cloud" title="Permalink to this headline">¶</a></h8>
<p>Setting up OpenStack is outside the domain of this document.
There are four account details necessary for the Buildbot master to interact with your OpenStack cloud: username, password, a tenant name, and the auth URL to use.</p>
</div>
<div class="section" id="create-an-image">
<h8><a class="toc-backref" href="#id4">Create an Image</a><a class="headerlink" href="#create-an-image" title="Permalink to this headline">¶</a></h8>
<p>OpenStack supports a large number of image formats.
OpenStack maintains a short list of prebuilt images; if the desired image is not listed, The <a class="reference external" href="http://docs.openstack.org/trunk/openstack-compute/admin/content/index.html">OpenStack Compute Administration Manual</a> is a good resource for creating new images.
You need to configure the image with a buildbot worker to connect to the master on boot.</p>
</div>
<div class="section" id="configure-the-master-with-an-openstacklatentworker">
<h8><a class="toc-backref" href="#id5">Configure the Master with an OpenStackLatentWorker</a><a class="headerlink" href="#configure-the-master-with-an-openstacklatentworker" title="Permalink to this headline">¶</a></h8>
<p>With the configured image in hand, it is time to configure the buildbot master to create OpenStack instances of it.
You will need the aforementioned account details.
These are the same details set in either environment variables or passed as options to an OpenStack client.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>The worker name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt>
<dd>A password for the worker to login to the master with.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flavor</span></code></dt>
<dd>The flavor ID to use for the instance.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">image</span></code></dt>
<dd>A string containing the image UUID to use for the instance.
A callable may instead be passed.
It will be passed the list of available images and must return the image to use.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">os_username</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">os_password</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">os_tenant_name</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">os_user_domain</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">os_project_domain</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">os_auth_url</span></code></dt>
<dd>The OpenStack authentication needed to create and delete instances.
These are the same as the environment variables with uppercase names of the arguments.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">block_devices</span></code></dt>
<dd><p class="first">A list of dictionaries.
Each dictionary specifies a block device to set up during instance creation.
The values support using properties from the build and will be rendered when the instance is started.</p>
<p>Supported keys</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">uuid</span></code></dt>
<dd>(required):
The image, snapshot, or volume UUID.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">volume_size</span></code></dt>
<dd>(optional):
Size of the block device in GiB.
If not specified, the minimum size in GiB to contain the source will be calculated and used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">device_name</span></code></dt>
<dd>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">vda</span></code>.
The name of the device in the instance; e.g. vda or xda.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">source_type</span></code></dt>
<dd>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">image</span></code>.
The origin of the block device.
Valid values are <code class="docutils literal notranslate"><span class="pre">image</span></code>, <code class="docutils literal notranslate"><span class="pre">snapshot</span></code>, or <code class="docutils literal notranslate"><span class="pre">volume</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">destination_type</span></code></dt>
<dd>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">volume</span></code>.
Destination of block device: <code class="docutils literal notranslate"><span class="pre">volume</span></code> or <code class="docutils literal notranslate"><span class="pre">local</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">delete_on_termination</span></code></dt>
<dd>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
Controls if the block device will be deleted when the instance terminates.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">boot_index</span></code></dt>
<dd>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">0</span></code>.
Integer used for boot order.</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">meta</span></code></dt>
<dd>A dictionary of string key-value pairs to pass to the instance.
These will be available under the <code class="docutils literal notranslate"><span class="pre">metadata</span></code> key from the metadata service.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nova_args</span></code></dt>
<dd>(optional)
A dict that will be appended to the arguments when creating a VM.
Buildbot uses the OpenStack Nova version 2 API by default (see client_version).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">client_version</span></code></dt>
<dd>(optional)
A string containing the Nova client version to use.
Defaults to <code class="docutils literal notranslate"><span class="pre">2</span></code>.
Supports using <code class="docutils literal notranslate"><span class="pre">2.X</span></code>, where X is a micro-version.
Use <code class="docutils literal notranslate"><span class="pre">1.1</span></code> for the previous, deprecated, version.
If using <code class="docutils literal notranslate"><span class="pre">1.1</span></code>, note that an older version of novaclient will be needed so it won’t switch to using <code class="docutils literal notranslate"><span class="pre">2</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">region</span></code></dt>
<dd>(optional)
A string specifying region where to instantiate the worker.</dd>
</dl>
<p>Here is the simplest example of configuring an OpenStack latent worker.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">OpenStackLatentWorker</span><span class="p">(</span><span class="s1">&#39;bot2&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span>
                <span class="n">flavor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;8ac9d4a4-5e03-48b0-acde-77a0345a9ab1&#39;</span><span class="p">,</span>
                <span class="n">os_username</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">os_password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
                <span class="n">os_tenant_name</span><span class="o">=</span><span class="s1">&#39;tenant&#39;</span><span class="p">,</span>
                <span class="n">os_auth_url</span><span class="o">=</span><span class="s1">&#39;http://127.0.0.1:35357/v2.0&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">image</span></code> argument also supports being given a callable.
The callable will be passed the list of available images and must return the image to use.
The invocation happens in a separate thread to prevent blocking the build master when interacting with OpenStack.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>

<span class="k">def</span> <span class="nf">find_image</span><span class="p">(</span><span class="n">images</span><span class="p">):</span>
    <span class="c1"># Sort oldest to newest.</span>
    <span class="k">def</span> <span class="nf">key_fn</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">created</span>

    <span class="n">candidate_images</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key_fn</span><span class="p">)</span>
    <span class="c1"># Return the oldest candidate image.</span>
    <span class="k">return</span> <span class="n">candidate_images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">OpenStackLatentWorker</span><span class="p">(</span><span class="s1">&#39;bot2&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span>
                <span class="n">flavor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">find_image</span><span class="p">,</span>
                <span class="n">os_username</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">os_password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
                <span class="n">os_tenant_name</span><span class="o">=</span><span class="s1">&#39;tenant&#39;</span><span class="p">,</span>
                <span class="n">os_auth_url</span><span class="o">=</span><span class="s1">&#39;http://127.0.0.1:35357/v2.0&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">block_devices</span></code> argument is minimally manipulated to provide some defaults and passed directly to novaclient.
The simplest example is an image that is converted to a volume and the instance boots from that volume.
When the instance is destroyed, the volume will be terminated as well.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">OpenStackLatentWorker</span><span class="p">(</span><span class="s1">&#39;bot2&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span>
                <span class="n">flavor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;8ac9d4a4-5e03-48b0-acde-77a0345a9ab1&#39;</span><span class="p">,</span>
                <span class="n">os_username</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">os_password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
                <span class="n">os_tenant_name</span><span class="o">=</span><span class="s1">&#39;tenant&#39;</span><span class="p">,</span>
                <span class="n">os_auth_url</span><span class="o">=</span><span class="s1">&#39;http://127.0.0.1:35357/v2.0&#39;</span><span class="p">,</span>
                <span class="n">block_devices</span><span class="o">=</span><span class="p">[</span>
                    <span class="p">{</span><span class="s1">&#39;uuid&#39;</span><span class="p">:</span> <span class="s1">&#39;3f0b8868-67e7-4a5b-b685-2824709bd486&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;volume_size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}])</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">nova_args</span></code> can be used to specify additional arguments for the novaclient.
For example network mappings, which is required if your OpenStack tenancy has more than one network, and default cannot be determined.
Please refer to your OpenStack manual whether it wants net-id or net-name.</p>
<p>Other useful parameters are <code class="docutils literal notranslate"><span class="pre">availability_zone</span></code>, <code class="docutils literal notranslate"><span class="pre">security_groups</span></code> and <code class="docutils literal notranslate"><span class="pre">config_drive</span></code>.
Refer to <a class="reference external" href="http://docs.openstack.org/developer/python-novaclient/">Python bindings to the OpenStack Nova API</a> for more information.
It is found on section Servers, method create.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">OpenStackLatentWorker</span><span class="p">(</span><span class="s1">&#39;bot2&#39;</span><span class="p">,</span> <span class="s1">&#39;sekrit&#39;</span><span class="p">,</span>
                <span class="n">flavor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="s1">&#39;8ac9d4a4-5e03-48b0-acde-77a0345a9ab1&#39;</span><span class="p">,</span>
                <span class="n">os_username</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">os_password</span><span class="o">=</span><span class="s1">&#39;password&#39;</span><span class="p">,</span>
                <span class="n">os_tenant_name</span><span class="o">=</span><span class="s1">&#39;tenant&#39;</span><span class="p">,</span>
                <span class="n">os_auth_url</span><span class="o">=</span><span class="s1">&#39;http://127.0.0.1:35357/v2.0&#39;</span><span class="p">,</span>
                <span class="n">nova_args</span><span class="o">=</span><span class="p">{</span>
                  <span class="s1">&#39;nics&#39;</span><span class="p">:</span> <span class="p">[</span>
                            <span class="p">{</span><span class="s1">&#39;net-id&#39;</span><span class="p">:</span><span class="s1">&#39;uid-of-network&#39;</span><span class="p">}</span>
                          <span class="p">]})</span>
<span class="p">]</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code> supports all other configuration from the standard <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>.
The <code class="docutils literal notranslate"><span class="pre">missing_timeout</span></code> and <code class="docutils literal notranslate"><span class="pre">notify_on_missing</span></code> specify how long to wait for an OpenStack instance to attach before considering the attempt to have failed and email addresses to alert, respectively.
<code class="docutils literal notranslate"><span class="pre">missing_timeout</span></code> defaults to 20 minutes.</p>
</div>
</div>
<span id="document-manual/configuration/workers-docker"></span><span class="target" id="index-0"></span><div class="section" id="docker-latent-worker">
<span id="worker-DockerLatentWorker"></span><h7>Docker latent worker<a class="headerlink" href="#docker-latent-worker" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.worker.docker.DockerLatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.worker.docker.</code><code class="descname">DockerLatentWorker</code><a class="headerlink" href="#buildbot.worker.docker.DockerLatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.plugins.worker.DockerLatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.plugins.worker.</code><code class="descname">DockerLatentWorker</code><a class="headerlink" href="#buildbot.plugins.worker.DockerLatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="https://docker.com">Docker</a> is an open-source project that automates the deployment of applications inside software containers.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> attempts to instantiate a fresh image for each build to assure consistency of the environment between builds.
Each image will be discarded once the worker finished processing the build queue (i.e. becomes <code class="docutils literal notranslate"><span class="pre">idle</span></code>).
See <a class="reference internal" href="#common-latent-workers-options"><span class="std std-ref">build_wait_timeout</span></a> to change this behavior.</p>
<p>This document will guide you through the setup of such workers.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#docker-installation" id="id4">Docker Installation</a></li>
<li><a class="reference internal" href="#image-creation" id="id5">Image Creation</a></li>
<li><a class="reference internal" href="#reuse-same-image-for-different-workers" id="id6">Reuse same image for different workers</a></li>
<li><a class="reference internal" href="#master-setup" id="id7">Master Setup</a></li>
</ul>
</div>
<div class="section" id="docker-installation">
<h8><a class="toc-backref" href="#id4">Docker Installation</a><a class="headerlink" href="#docker-installation" title="Permalink to this headline">¶</a></h8>
<p>An easy way to try Docker is through installation of dedicated Virtual machines.
Two of them stands out:</p>
<ul class="simple">
<li><a class="reference external" href="https://coreos.com/">CoreOS</a></li>
<li><a class="reference external" href="http://boot2docker.io/">boot2docker</a></li>
</ul>
<p>Beside, it is always possible to install Docker next to the buildmaster.
Beware that in this case, overall performance will depend on how many builds the computer where you have your buildmaster can handle as everything will happen on the same one.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is not necessary to install Docker in the same environment as your master as we will make use to the Docker API through <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a>.
More in <a class="reference internal" href="#master-setup">master setup</a>.</p>
</div>
<div class="section" id="id1">
<h9>CoreOS<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h9>
<p>CoreOS is targeted at building infrastructure and distributed systems.
In order to get the latent worker working with CoreOS, it is necessary to <a class="reference external" href="https://coreos.com/docs/launching-containers/building/customizing-docker/">expose the docker socket</a> outside of the Virtual Machine.
If you installed it via <a class="reference external" href="https://coreos.com/docs/running-coreos/platforms/vagrant/">Vagrant</a>, it is also necessary to uncomment the following line in your <code class="file docutils literal notranslate"><span class="pre">config.rb</span></code> file:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="vg">$expose_docker_tcp</span><span class="o">=</span><span class="mi">2375</span>
</pre></div>
</div>
<p>The following command should allow you to confirm that your Docker socket is now available via the network:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker -H tcp://127.0.0.1:2375 ps
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h9>boot2docker<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h9>
<p>boot2docker is one of the fastest ways to boot to Docker.
As it is meant to be used from outside of the Virtual Machine, the socket is already exposed.
Please follow the installation instructions on how to find the address of your socket.</p>
</div>
</div>
<div class="section" id="image-creation">
<h8><a class="toc-backref" href="#id5">Image Creation</a><a class="headerlink" href="#image-creation" title="Permalink to this headline">¶</a></h8>
<p>Our build master will need the name of an image to perform its builds.
Each time a new build will be requested, the same base image will be used again and again, actually discarding the result of the previous build.
If you need some persistent storage between builds, you can <a class="reference external" href="settingupvolumes">use Volumes</a>.</p>
<p>Each Docker image has a single purpose.
Our worker image will be running a buildbot worker.</p>
<p>Docker uses <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code>s to describe the steps necessary to build an image.
The following example will build a minimal worker.
This example is voluntarily simplistic, and should probably not be used in production, see next paragraph.</p>
<div class="highlight-Docker notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> debian:stable</span>
<span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\</span>
   python-dev <span class="se">\</span>
   python-pip
<span class="k">RUN</span> pip install buildbot-worker
<span class="k">RUN</span> groupadd -r buildbot <span class="o">&amp;&amp;</span> useradd -r -g buildbot buildbot
<span class="k">RUN</span> mkdir /worker <span class="o">&amp;&amp;</span> chown buildbot:buildbot /worker
<span class="c"># Install your build-dependencies here ...</span>
USER buildbot
<span class="k">WORKDIR</span><span class="s"> /worker</span>
<span class="hll"><span class="k">RUN</span> buildbot-worker create-worker . &lt;master-hostname&gt; &lt;workername&gt; &lt;workerpassword&gt;
</span><span class="k">ENTRYPOINT</span><span class="s"> [&quot;/usr/local/bin/buildbot-worker&quot;]</span>
<span class="k">CMD</span><span class="s"> [&quot;start&quot;, &quot;--nodaemon&quot;]</span>
</pre></div>
</td></tr></table></div>
<p>On line 11, the hostname for your master instance, as well as the worker name and password is setup.
Don’t forget to replace those values with some valid ones for your project.</p>
<p>It is a good practice to set the <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> to the worker executable, and the <code class="docutils literal notranslate"><span class="pre">CMD</span></code> to <code class="docutils literal notranslate"><span class="pre">[&quot;start&quot;,</span> <span class="pre">&quot;--nodaemon&quot;]</span></code>.
This way, no parameter will be required when starting the image.</p>
<p>When your Dockerfile is ready, you can build your first image using the following command (replace <em>myworkername</em> with a relevant name for your case):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build -t myworkername - &lt; Dockerfile
</pre></div>
</div>
</div>
<div class="section" id="reuse-same-image-for-different-workers">
<h8><a class="toc-backref" href="#id6">Reuse same image for different workers</a><a class="headerlink" href="#reuse-same-image-for-different-workers" title="Permalink to this headline">¶</a></h8>
<p>Previous simple example hardcodes the worker name into the dockerfile, which will not work if you want to share your docker image between workers.</p>
<p>You can find in buildbot source code in <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/docker">master/contrib/docker</a> one example configurations:</p>
<dl class="docutils">
<dt><a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/docker/pythonnode_worker/">pythonnode_worker</a></dt>
<dd>a worker with Python and node installed, which demonstrate how to reuse the base worker to create variations of build environments.
It is based on the official <code class="docutils literal notranslate"><span class="pre">buildbot/buildbot-worker</span></code> image.</dd>
</dl>
<p>The master setups several environment variables before starting the workers:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">BUILDMASTER</span></code></dt>
<dd>The address of the master the worker shall connect to</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BUILDMASTER_PORT</span></code></dt>
<dd>The port of the master’s worker ‘pb’ protocol.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">WORKERNAME</span></code></dt>
<dd>The name the worker should use to connect to master</dd>
<dt><code class="docutils literal notranslate"><span class="pre">WORKERPASS</span></code></dt>
<dd>The password the worker should use to connect to master</dd>
</dl>
</div>
<div class="section" id="master-setup">
<h8><a class="toc-backref" href="#id7">Master Setup</a><a class="headerlink" href="#master-setup" title="Permalink to this headline">¶</a></h8>
<p>We will rely on docker-py to connect our master with docker.
Now is the time to install it in your master environment.</p>
<p>Before adding the worker to your master configuration, it is possible to validate the previous steps by starting the newly created image interactively.
To do this, enter the following lines in a Python prompt where docker-py is installed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">docker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docker_socket</span> <span class="o">=</span> <span class="s1">&#39;tcp://localhost:2375&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="n">docker_socket</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">worker_image</span> <span class="o">=</span> <span class="s1">&#39;my_project_worker&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">container</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">create_container</span><span class="p">(</span><span class="n">worker_image</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Optionally examine the logs of the master</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">])</span>
<span class="go">0</span>
</pre></div>
</div>
<p>It is now time to add the new worker to the master configuration under <a class="reference internal" href="#cfg-workers" title="workers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">workers</span></code></a>.</p>
<p>The following example will add a Docker latent worker for docker running at the following address: <code class="docutils literal notranslate"><span class="pre">tcp://localhost:2375</span></code>, the worker name will be <code class="docutils literal notranslate"><span class="pre">docker</span></code>, its password: <code class="docutils literal notranslate"><span class="pre">password</span></code>, and the base image name will be <code class="docutils literal notranslate"><span class="pre">my_project_worker</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">DockerLatentWorker</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
                              <span class="n">docker_host</span><span class="o">=</span><span class="s1">&#39;tcp://localhost:2375&#39;</span><span class="p">,</span>
                              <span class="n">image</span><span class="o">=</span><span class="s1">&#39;my_project_worker&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt>
<dd>(mandatory)
The worker password part of the <a class="reference internal" href="#latent-workers"><span class="std std-ref">Latent Workers</span></a> API.
If the password is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then it will be automatically generated from random number, and transmitted to the container via environment variable.</dd>
</dl>
<p>In addition to the arguments available for any <a class="reference internal" href="#latent-workers"><span class="std std-ref">Latent Workers</span></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> will accept the following extra ones:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">docker_host</span></code></dt>
<dd>(mandatory)
This is the address the master will use to connect with a running Docker instance.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">image</span></code></p>
<blockquote>
<div>This is the name of the image that will be started by the build master. It should start a worker.
This option can be a renderable, like <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>, so that it generates from the build request properties.</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">command</span></code></dt>
<dd>(optional)
This will override the command setup during image creation.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">volumes</span></code></dt>
<dd>(optional)
See <a class="reference internal" href="#setting-up-volumes">Setting up Volumes</a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">dockerfile</span></code></dt>
<dd><p class="first">(optional if <code class="docutils literal notranslate"><span class="pre">image</span></code> is given)
This is the content of the Dockerfile that will be used to build the specified image if the image is not found by Docker.
It should be a multiline string.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In case <code class="docutils literal notranslate"><span class="pre">image</span></code> and <code class="docutils literal notranslate"><span class="pre">dockerfile</span></code> are given, no attempt is made to compare the image with the content of the Dockerfile parameter if the image is found.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">version</span></code></dt>
<dd>(optional, default to the highest version known by docker-py)
This will indicates which API version must be used to communicate with Docker.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tls</span></code></dt>
<dd>(optional)
This allow to use TLS when connecting with the Docker socket.
This should be a <code class="docutils literal notranslate"><span class="pre">docker.tls.TLSConfig</span></code> object.
See <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/tls.html">docker-py’s own documentation</a> for more details on how to initialise this object.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">followStartupLogs</span></code></dt>
<dd>(optional, defaults to false)
This transfers docker container’s log inside master logs during worker startup (before connection). This can be useful to debug worker startup. e.g network issues, etc.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">masterFQDN</span></code></dt>
<dd>(optional, defaults to socket.getfqdn())
Address of the master the worker should connect to. Use if you master machine does not have proper fqdn.
This value is passed to the docker image via environment variable <code class="docutils literal notranslate"><span class="pre">BUILDMASTER</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">hostconfig</span></code></dt>
<dd>(optional)
Extra host configuration parameters passed as a dictionary used to create HostConfig object. See <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/api.html#docker.api.container.ContainerApiMixin.create_host_config">docker-py’s HostConfig documentation</a> for all the supported options.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">autopull</span></code></dt>
<dd>(optional, defaults to false)
Automatically pulls image if requested image is not on docker host.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">alwaysPull</span></code></dt>
<dd>(optional, defaults to false)
Always pulls image if autopull is set to true.</dd>
</dl>
<div class="section" id="setting-up-volumes">
<h9>Setting up Volumes<a class="headerlink" href="#setting-up-volumes" title="Permalink to this headline">¶</a></h9>
<p>The <code class="docutils literal notranslate"><span class="pre">volume</span></code> parameter allows to share directory between containers, or between a container and the host system.
Refer to Docker documentation for more information about Volumes.</p>
<p>The format of that variable has to be an array of string.
Each string specify a volume in the following format: <code class="samp docutils literal notranslate"><em><span class="pre">volumename</span></em><span class="pre">:</span><em><span class="pre">bindname</span></em></code>.
The volume name has to be appended with <code class="docutils literal notranslate"><span class="pre">:ro</span></code> if the volume should be mounted <em>read-only</em>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is the same format as when specifying volumes on the command line for docker’s own <code class="docutils literal notranslate"><span class="pre">-v</span></code> option.</p>
</div>
</div>
</div>
</div>
<div class="section" id="hyper-latent-worker">
<h7>Hyper latent worker<a class="headerlink" href="#hyper-latent-worker" title="Permalink to this headline">¶</a></h7>
<p><a class="reference external" href="https://hyper.sh">Hyper</a> is a CaaS solution for hosting docker container in the cloud, billed to the second.
It forms a very cost efficient solution to run your CI in the cloud.</p>
<p>Buildbot supports using <a class="reference external" href="https://hyper.sh">Hyper</a> to host your latent workers.</p>
<dl class="class">
<dt id="buildbot.worker.hyper.HyperLatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.worker.hyper.</code><code class="descname">HyperLatentWorker</code><a class="headerlink" href="#buildbot.worker.hyper.HyperLatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.plugins.worker.HyperLatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.plugins.worker.</code><code class="descname">HyperLatentWorker</code><a class="headerlink" href="#buildbot.plugins.worker.HyperLatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">HyperLatentWorker</span></code> attempts to instantiate a fresh image for each build to assure consistency of the environment between builds.
Each image will be discarded once the worker finished processing the build queue (i.e. becomes <code class="docutils literal notranslate"><span class="pre">idle</span></code>).
See <a class="reference internal" href="#common-latent-workers-options"><span class="std std-ref">build_wait_timeout</span></a> to change this behavior.</p>
<p>In addition to the arguments available for any <a class="reference internal" href="#latent-workers"><span class="std std-ref">Latent Workers</span></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">HyperLatentWorker</span></code> will accept the following extra ones:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt>
<dd>(mandatory)
The worker password part of the <a class="reference internal" href="#latent-workers"><span class="std std-ref">Latent Workers</span></a> API.
If the password is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then it will be automatically generated from random number, and transmitted to the container via environment variable.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hyper_host</span></code></dt>
<dd>(mandatory)
This is the address the hyper infra endpoint will use to start docker containers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">image</span></code></dt>
<dd>(mandatory)
This is the name of the image that will be started by the build master. It should start a worker.
This option can be a renderable, like <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>, so that it generates from the build request properties.
Images are by default pulled from the public <a class="reference external" href="https://hub.docker.com/">DockerHub</a> docker registry.
You can consult the hyper documentation to know how to configure a custom registry.
HyperLatentWorker does not support starting a worker built from a Dockerfile.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">masterFQDN</span></code></dt>
<dd><p class="first">(optional, defaults to socket.getfqdn())
Address of the master the worker should connect to. Use if you master machine does not have proper fqdn.
This value is passed to the docker image via environment variable <code class="docutils literal notranslate"><span class="pre">BUILDMASTER</span></code></p>
<p>If the value contains a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>), then BUILDMASTER and BUILDMASTER_PORT environment variables will be passed, following scheme: <code class="docutils literal notranslate"><span class="pre">masterFQDN=&quot;$BUILDMASTER:$BUILDMASTER_PORT&quot;</span></code></p>
<p class="last">This feature is useful for testing behind a proxy using <code class="docutils literal notranslate"><span class="pre">ngrok</span></code> command like: <code class="docutils literal notranslate"><span class="pre">ngrok</span> <span class="pre">tcp</span> <span class="pre">9989</span></code>
<code class="docutils literal notranslate"><span class="pre">ngrok</span></code> config can the be retrieved with following snippet:</p>
</dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">future.moves.urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://localhost:4040/api/tunnels/command_line&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">masterFQDN</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;public_url&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">netloc</span>
</pre></div>
</div>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">hyper_accesskey</span></code></dt>
<dd>(mandatory)
Access key to use as part of the creds to access hyper.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hyper_secretkey</span></code></dt>
<dd>(mandatory)
Secret key to use as part of the creds to access hyper.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hyper_size</span></code></dt>
<dd>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">s3</span></code>)
Size of the container to use as per <a class="reference external" href="https://hyper.sh/pricing.html">HyperPricing</a></dd>
</dl>
</div>
<div class="section" id="marathon-latent-worker">
<h7>Marathon latent worker<a class="headerlink" href="#marathon-latent-worker" title="Permalink to this headline">¶</a></h7>
<p><a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> Marathon is a production-grade container orchestration platform for Mesosphere’s Data-center Operating System (DC/OS) and Apache <code class="docutils literal notranslate"><span class="pre">Mesos</span></code>.</p>
<p>Buildbot supports using <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> to host your latent workers.
It requires either <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> or <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> to be installed to allow interaction with http server.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPClientService</span></code> for details.</p>
<dl class="class">
<dt id="buildbot.worker.marathon.MarathonLatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.worker.marathon.</code><code class="descname">MarathonLatentWorker</code><a class="headerlink" href="#buildbot.worker.marathon.MarathonLatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.plugins.worker.MarathonLatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.plugins.worker.</code><code class="descname">MarathonLatentWorker</code><a class="headerlink" href="#buildbot.plugins.worker.MarathonLatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">MarathonLatentWorker</span></code> attempts to instantiate a fresh image for each build to assure consistency of the environment between builds.
Each image will be discarded once the worker finished processing the build queue (i.e. becomes <code class="docutils literal notranslate"><span class="pre">idle</span></code>).
See <a class="reference internal" href="#common-latent-workers-options"><span class="std std-ref">build_wait_timeout</span></a> to change this behavior.</p>
<p>In addition to the arguments available for any <a class="reference internal" href="#latent-workers"><span class="std std-ref">Latent Workers</span></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">MarathonLatentWorker</span></code> will accept the following extra ones:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">marathon_url</span></code></dt>
<dd>(mandatory)
This is the URL to <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> server.
Its REST API will be used to start docker containers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">marathon_auth</span></code></dt>
<dd>(optional)
This is the optional <code class="docutils literal notranslate"><span class="pre">('userid',</span> <span class="pre">'password')</span></code> <code class="docutils literal notranslate"><span class="pre">BasicAuth</span></code> credential.
If <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> is installed, this can be a <a class="reference external" href="http://docs.python-requests.org/en/master/user/authentication/">requests authentication plugin</a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">image</span></code></dt>
<dd>(mandatory)
This is the name of the image that will be started by the build master. It should start a worker.
This option can be a renderable, like <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>, so that it generates from the build request properties.
Images are by pulled from the default docker registry.
MarathonLatentWorker does not support starting a worker built from a Dockerfile.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">masterFQDN</span></code></dt>
<dd><p class="first">(optional, defaults to socket.getfqdn())
Address of the master the worker should connect to. Use if you master machine does not have proper fqdn.
This value is passed to the docker image via environment variable <code class="docutils literal notranslate"><span class="pre">BUILDMASTER</span></code></p>
<p class="last">If the value contains a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>), then BUILDMASTER and BUILDMASTER_PORT environment variables will be passed, following scheme: <code class="docutils literal notranslate"><span class="pre">masterFQDN=&quot;$BUILDMASTER:$BUILDMASTER_PORT&quot;</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">marathon_extra_config</span></code></dt>
<dd>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">{}`</span></code>)
Extra configuration to be passed to <a class="reference external" href="http://mesosphere.github.io/marathon/docs/rest-api.html#post-v2-apps">Marathon API</a>.
This implementation will setup the minimal configuration to run a worker (docker image, <code class="docutils literal notranslate"><span class="pre">BRIDGED</span></code> network)
It will let the default for everything else, including memory size, volume mounting, etc.
This configuration is voluntarily very raw so that it is easy to use new marathon features.
This dictionary will be merged into the Buildbot generated config, and recursively override it.
See <a class="reference external" href="http://mesosphere.github.io/marathon/docs/rest-api.html#post-v2-apps">Marathon API</a> documentation to learn what to include in this config.</dd>
</dl>
</div>
</div>
</div>
<div class="section" id="dangers-with-latent-workers">
<h6>Dangers with Latent Workers<a class="headerlink" href="#dangers-with-latent-workers" title="Permalink to this headline">¶</a></h6>
<p>Any latent worker that interacts with a for-fee service, such as the <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentWorker</span></code></a>, brings significant risks.
As already identified, the configuration will need access to account information that, if obtained by a criminal, can be used to charge services to your account.
Also, bugs in the Buildbot software may lead to unnecessary charges.
In particular, if the master neglects to shut down an instance for some reason, a virtual machine may be running unnecessarily, charging against your account.
Manual and/or automatic (e.g. Nagios with a plugin using a library like boto) double-checking may be appropriate.</p>
<p>A comparatively trivial note is that currently if two instances try to attach to the same latent worker, it is likely that the system will become confused.
This should not occur, unless, for instance, you configure a normal worker to connect with the authentication of a latent buildbot.
If this situation does occurs, stop all attached instances and restart the master.</p>
</div>
</div>
</div>
<span id="document-manual/configuration/builders"></span><div class="section" id="builder-configuration">
<span id="cfg-builders"></span><span id="id1"></span><h4>2.5.7. Builder Configuration<a class="headerlink" href="#builder-configuration" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#collapsing-build-requests" id="id5">Collapsing Build Requests</a></li>
<li><a class="reference internal" href="#prioritizing-builds" id="id6">Prioritizing Builds</a></li>
<li><a class="reference internal" href="#virtual-builders" id="id7">Virtual Builders</a></li>
</ul>
</div>
<p>The <a class="reference internal" href="#cfg-builders" title="builders"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">builders</span></code></a> configuration key is a list of objects giving configuration for the Builders.
For more information on the function of Builders in Buildbot, see <a class="reference internal" href="#builder"><span class="std std-ref">the Concepts chapter</span></a>.
The class definition for the builder configuration is in <code class="file docutils literal notranslate"><span class="pre">buildbot.config</span></code>.
However there is a much simpler way to use it, so in the configuration file, its use looks like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;quick&#39;</span><span class="p">,</span> <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;bot2&#39;</span><span class="p">],</span> <span class="n">factory</span><span class="o">=</span><span class="n">f_quick</span><span class="p">),</span>
    <span class="n">util</span><span class="o">.</span><span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;thorough&#39;</span><span class="p">,</span> <span class="n">workername</span><span class="o">=</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">f_thorough</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BuilderConfig</span></code> takes the following keyword arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>This specifies the Builder’s name, which is used in status reports.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">workername</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">workernames</span></code></dt>
<dd>These arguments specify the worker or workers that will be used by this Builder.
All workers names must appear in the <a class="reference internal" href="#cfg-workers" title="workers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">workers</span></code></a> configuration parameter.
Each worker can accommodate multiple builders.
The <code class="docutils literal notranslate"><span class="pre">workernames</span></code> parameter can be a list of names, while <code class="docutils literal notranslate"><span class="pre">workername</span></code> can specify only one worker.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">factory</span></code></dt>
<dd>This is a <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.factory.BuildFactory</span></code> instance which controls how the build is performed by defining the steps in the build.
Full details appear in their own section, <a class="reference internal" href="#build-factories"><span class="std std-ref">Build Factories</span></a>.</dd>
</dl>
<p>Other optional keys may be set on each <code class="docutils literal notranslate"><span class="pre">BuilderConfig</span></code>:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builddir</span></code></dt>
<dd>Specifies the name of a subdirectory of the master’s basedir in which everything related to this builder will be stored.
This holds build status information.
If not set, this parameter defaults to the builder name, with some characters escaped.
Each builder must have a unique build directory.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">workerbuilddir</span></code></dt>
<dd>Specifies the name of a subdirectory (under the worker’s configured base directory) in which everything related to this builder will be placed on the worker.
This is where checkouts, compiles, and tests are run.
If not set, defaults to <code class="docutils literal notranslate"><span class="pre">builddir</span></code>.
If a worker is connected to multiple builders that share the same <code class="docutils literal notranslate"><span class="pre">workerbuilddir</span></code>, make sure the worker is set to run one build at a time or ensure this is fine to run multiple builds from the same directory simultaneously.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tags</span></code></dt>
<dd>If provided, this is a list of strings that identifies tags for the builder.
Status clients can limit themselves to a subset of the available tags.
A common use for this is to add new builders to your setup (for a new module, or for a new worker) that do not work correctly yet and allow you to integrate them with the active builders.
You can tag these new builders with a <code class="docutils literal notranslate"><span class="pre">test</span></code> tag, make your main status clients ignore them, and have only private status clients pick them up.
As soon as they work, you can move them over to the active tag.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nextWorker</span></code></dt>
<dd>If provided, this is a function that controls which worker will be assigned future jobs.
The function is passed three arguments, the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> object which is assigning a new job, a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> objects and the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code>.
The function should return one of the <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> objects, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if none of the available workers should be used.
As an example, for each <code class="docutils literal notranslate"><span class="pre">worker</span></code> in the list, <code class="docutils literal notranslate"><span class="pre">worker.worker</span></code> will be a <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> object, and <code class="docutils literal notranslate"><span class="pre">worker.worker.workername</span></code> is the worker’s name.
The function can optionally return a Deferred, which should fire with the same results.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nextBuild</span></code></dt>
<dd>If provided, this is a function that controls which build request will be handled next.
The function is passed two arguments, the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> object which is assigning a new job, and a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> objects of pending builds.
The function should return one of the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> objects, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if none of the pending builds should be started.
This function can optionally return a Deferred which should fire with the same results.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">canStartBuild</span></code></dt>
<dd><p class="first">If provided, this is a function that can veto whether a particular worker should be used for a given build request.
The function is passed three arguments: the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>, a <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code>, and a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code>.
The function should return <code class="docutils literal notranslate"><span class="pre">True</span></code> if the combination is acceptable, or <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.
This function can optionally return a Deferred which should fire with the same results.</p>
<p class="last">See <a class="reference internal" href="#canstartbuild-functions"><span class="std std-ref">canStartBuild Functions</span></a> for a concrete example.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">locks</span></code></dt>
<dd>A list of <code class="docutils literal notranslate"><span class="pre">Locks</span></code> (instances of <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.WorkerLock</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.MasterLock</span></code>) that should be acquired before starting a <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> from this <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.
Alternatively this could be a renderable that returns this list depending on properties of related to a build that is just about to be created.
This lets you defer picking the locks to acquire until it is known which <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> a build would get assigned to.
The properties available to the renderable include all properties that are set to the build before its first step excluding the properties that come from the build itself and the <code class="docutils literal notranslate"><span class="pre">builddir</span></code> property that comes from worker.
The <code class="docutils literal notranslate"><span class="pre">Locks</span></code> will be released when the build is complete.
Note that this is a list of actual <code class="xref py py-class docutils literal notranslate"><span class="pre">Lock</span></code> instances, not names.
Also note that all Locks must have unique names.
See <a class="reference internal" href="#interlocks"><span class="std std-ref">Interlocks</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt>
<dd><p class="first">A Builder may be given a dictionary of environment variables in this parameter.
The variables are used in <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> steps in builds created by this builder.
The environment variables will override anything in the worker’s environment.
Variables passed directly to a <code class="xref py py-class docutils literal notranslate"><span class="pre">ShellCommand</span></code> will override variables of the same name passed to the Builder.</p>
<p>For example, if you have a pool of identical workers it is often easier to manage variables like <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> from Buildbot rather than manually editing it inside of the workers’ environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="s1">&#39;./configure&#39;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Compile</span><span class="p">())</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
        <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;worker1&#39;</span><span class="p">,</span> <span class="s1">&#39;worker2&#39;</span><span class="p">,</span> <span class="s1">&#39;worker3&#39;</span><span class="p">,</span> <span class="s1">&#39;worker4&#39;</span><span class="p">],</span>
        <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PATH&#39;</span><span class="p">:</span> <span class="s1">&#39;/opt/local/bin:/opt/app/bin:/usr/local/bin:/usr/bin&#39;</span><span class="p">}),</span>
<span class="p">]</span>
</pre></div>
</div>
<p class="last">Unlike most builder configuration arguments, this argument can contain renderables.</p>
</dd>
</dl>
<dl class="docutils" id="index-1">
<dt><code class="docutils literal notranslate"><span class="pre">collapseRequests</span></code></dt>
<dd>Specifies how build requests for this builder should be collapsed.
See <a class="reference internal" href="#collapsing-build-requests"><span class="std std-ref">Collapsing Build Requests</span></a>, below.</dd>
</dl>
<dl class="docutils" id="index-2">
<dt><code class="docutils literal notranslate"><span class="pre">properties</span></code></dt>
<dd>A builder may be given a dictionary of <a class="reference internal" href="#build-properties"><span class="std std-ref">Build Properties</span></a> specific for this builder in this parameter.
Those values can be used later on like other properties.
<a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">defaultProperties</span></code></dt>
<dd>Similar to the <code class="docutils literal notranslate"><span class="pre">properties</span></code> parameter.
But <code class="docutils literal notranslate"><span class="pre">defaultProperties</span></code> will only be added to <a class="reference internal" href="#build-properties"><span class="std std-ref">Build Properties</span></a> if they are not already set by <a class="reference internal" href="#properties"><span class="std std-ref">another source</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">description</span></code></dt>
<dd>A builder may be given an arbitrary description, which will show up in the web status on the builder’s page.</dd>
</dl>
<div class="section" id="collapsing-build-requests">
<span id="index-3"></span><span id="id2"></span><h5><a class="toc-backref" href="#id5">2.5.7.1. Collapsing Build Requests</a><a class="headerlink" href="#collapsing-build-requests" title="Permalink to this headline">¶</a></h5>
<p>When more than one build request is available for a builder, Buildbot can “collapse” the requests into a single build.
This is desirable when build requests arrive more quickly than the available workers can satisfy them, but has the drawback that separate results for each build are not available.</p>
<p>Requests are only candidated for a merge if both requests have exactly the same <a class="reference internal" href="#change-attr-codebase"><span class="std std-ref">codebases</span></a>.</p>
<p>This behavior can be controlled globally, using the <a class="reference internal" href="#cfg-collapseRequests" title="collapseRequests"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">collapseRequests</span></code></a> parameter, and on a per-<code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> basis, using the <code class="docutils literal notranslate"><span class="pre">collapseRequests</span></code> argument to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> configuration.
If <code class="docutils literal notranslate"><span class="pre">collapseRequests</span></code> is given, it completely overrides the global configuration.</p>
<p>Possible values for both <code class="docutils literal notranslate"><span class="pre">collapseRequests</span></code> configurations are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">True</span></code></dt>
<dd>Requests will be collapsed if their sourcestamp are compatible (see below for definition of compatible).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">False</span></code></dt>
<dd>Requests will never be collapsed.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callable(builder,</span> <span class="pre">req1,</span> <span class="pre">req2)</span></code></dt>
<dd>Requests will be collapsed if the callable returns true.
See <a class="reference internal" href="#collapse-request-functions"><span class="std std-ref">Collapse Request Functions</span></a> for detailed example.</dd>
</dl>
<p>Sourcestamps are compatible if all of the below conditions are met:</p>
<ul class="simple">
<li>Their codebase, branch, project, and repository attributes match exactly</li>
<li>Neither source stamp has a patch (e.g., from a try scheduler)</li>
<li>Either both source stamps are associated with changes, or neither are associated with changes but they have matching revisions.</li>
</ul>
</div>
<div class="section" id="prioritizing-builds">
<span id="index-4"></span><span id="id3"></span><h5><a class="toc-backref" href="#id6">2.5.7.2. Prioritizing Builds</a><a class="headerlink" href="#prioritizing-builds" title="Permalink to this headline">¶</a></h5>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuilderConfig</span></code> parameter <code class="docutils literal notranslate"><span class="pre">nextBuild</span></code> can be use to prioritize build requests within a builder.
Note that this is orthogonal to <a class="reference internal" href="#prioritizing-builders"><span class="std std-ref">Prioritizing Builders</span></a>, which controls the order in which builders are called on to start their builds.
The details of writing such a function are in <a class="reference internal" href="#build-priority-functions"><span class="std std-ref">Build Priority Functions</span></a>.</p>
<p>Such a function can be provided to the BuilderConfig as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pickNextBuild</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">requests</span><span class="p">):</span>
    <span class="o">...</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
        <span class="n">nextBuild</span><span class="o">=</span><span class="n">pickNextBuild</span><span class="p">,</span>
        <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;worker1&#39;</span><span class="p">,</span> <span class="s1">&#39;worker2&#39;</span><span class="p">,</span> <span class="s1">&#39;worker3&#39;</span><span class="p">,</span> <span class="s1">&#39;worker4&#39;</span><span class="p">]),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="virtual-builders">
<span id="id4"></span><h5><a class="toc-backref" href="#id7">2.5.7.3. Virtual Builders</a><a class="headerlink" href="#virtual-builders" title="Permalink to this headline">¶</a></h5>
<p><a class="reference internal" href="#dynamic-trigger"><span class="std std-ref">Dynamic Trigger</span></a> is a method which allows to trigger the same builder, with different parameters.
This method is used by frameworks which store the build config along side the source code like <a class="reference external" href="https://github.com/buildbot/buildbot_travis">Buildbot_travis</a>.
The drawback of this method is that it is difficult to extract statistics for similar builds.
The standard dashboards are not working well due to the fact that all the builds are on the same builder.</p>
<p>In order to overcome those drawbacks, Buildbot has the concept of virtual builder.
If a build has the property <code class="docutils literal notranslate"><span class="pre">virtual_builder_name</span></code>, it will automatically attach to that builder instead of the original builder.
That created virtual builder is not attached to any master and is only used for better sorting in the UI and better statistics.
The original builder and worker configuration is still used for all other build behaviors.</p>
<p>The virtual builder metadata is configured with the following properties:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">virtual_builder_name</span></code>: The name of the virtual builder.</li>
<li><code class="docutils literal notranslate"><span class="pre">virtual_builder_description</span></code>: The description of the virtual builder.</li>
<li><code class="docutils literal notranslate"><span class="pre">virtual_builder_tags</span></code>: The tags for the virtual builder.</li>
</ul>
</div>
</div>
<span id="document-manual/configuration/buildfactories"></span><div class="section" id="build-factories">
<span id="id1"></span><h4>2.5.8. Build Factories<a class="headerlink" href="#build-factories" title="Permalink to this headline">¶</a></h4>
<p>Each Builder is equipped with a <code class="docutils literal notranslate"><span class="pre">build</span> <span class="pre">factory</span></code>, which defines the steps used to perform that particular type of build.
This factory is created in the configuration file, and attached to a Builder through the <code class="docutils literal notranslate"><span class="pre">factory</span></code> element of its dictionary.</p>
<p>The steps used by these builds are defined in the next section, <a class="reference internal" href="#build-steps"><span class="std std-ref">Build Steps</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Build factories are used with builders, and are not added directly to the buildmaster configuration dictionary.</p>
</div>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#defining-a-build-factory" id="id9">Defining a Build Factory</a></li>
<li><a class="reference internal" href="#dynamic-build-factories" id="id10">Dynamic Build Factories</a></li>
<li><a class="reference internal" href="#predefined-build-factories" id="id11">Predefined Build Factories</a></li>
</ul>
</div>
<span class="target" id="buildfactory"></span><div class="section" id="defining-a-build-factory">
<span id="index-0"></span><h5><a class="toc-backref" href="#id9">2.5.8.1. Defining a Build Factory</a><a class="headerlink" href="#defining-a-build-factory" title="Permalink to this headline">¶</a></h5>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> defines the steps that every build will follow.
Think of it as a glorified script.
For example, a build factory which consists of an SVN checkout followed by a <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">build</span></code> would be configured as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">steps</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;http://..&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;incremental&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;build&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This factory would then be attached to one builder (or several, if desired):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;quick&#39;</span><span class="p">,</span> <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bot1&#39;</span><span class="p">,</span> <span class="s1">&#39;bot2&#39;</span><span class="p">],</span> <span class="n">factory</span><span class="o">=</span><span class="n">f</span><span class="p">))</span>
</pre></div>
</div>
<p>It is also possible to pass a list of steps into the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> when it is created.
Using <code class="xref py py-meth docutils literal notranslate"><span class="pre">addStep</span></code> is usually simpler, but there are cases where it is more convenient to create the list of steps ahead of time, perhaps using some Python tricks to generate the steps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">all_steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">CVS</span><span class="p">(</span><span class="n">cvsroot</span><span class="o">=</span><span class="n">CVSROOT</span><span class="p">,</span> <span class="n">cvsmodule</span><span class="o">=</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">),</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;build&quot;</span><span class="p">]),</span>
<span class="p">]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">(</span><span class="n">all_steps</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can also add a sequence of steps all at once:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addSteps</span><span class="p">(</span><span class="n">all_steps</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="attributes">
<h6>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h6>
<p>The following attributes can be set on a build factory after it is created, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">useProgress</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<dl class="docutils">
<dt><code class="xref py py-attr docutils literal notranslate"><span class="pre">useProgress</span></code></dt>
<dd>(defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>): if <code class="docutils literal notranslate"><span class="pre">True</span></code>, the buildmaster keeps track of how long each step takes, so it can provide estimates of how long future builds will take.
If builds are not expected to take a consistent amount of time (such as incremental builds in which a random set of files are recompiled or tested each time), this should be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to inhibit progress-tracking.</dd>
<dt><code class="xref py py-attr docutils literal notranslate"><span class="pre">workdir</span></code></dt>
<dd><p class="first">(defaults to ‘build’): workdir given to every build step created by this factory as default.
The workdir can be overridden in a build step definition.</p>
<p class="last">If this attribute is set to a string, that string will be used for constructing the workdir (worker base + builder builddir + workdir).
The attribute can also be a Python callable, for more complex cases, as described in <a class="reference internal" href="#factory-workdir-functions"><span class="std std-ref">Factory Workdir Functions</span></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="dynamic-build-factories">
<span id="dynamicbuildfactories"></span><h5><a class="toc-backref" href="#id10">2.5.8.2. Dynamic Build Factories</a><a class="headerlink" href="#dynamic-build-factories" title="Permalink to this headline">¶</a></h5>
<p>In some cases you may not know what commands to run until after you checkout the source tree.
For those cases you can dynamically add steps during a build from other steps.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> object provides 2 functions to do this:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">addStepsAfterCurrentStep(self,</span> <span class="pre">step_factories)</span></code></dt>
<dd>This adds the steps after the step that is currently executing.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">addStepsAfterLastStep(self,</span> <span class="pre">step_factories)</span></code></dt>
<dd>This adds the steps onto the end of the build.</dd>
</dl>
<p>Both functions only accept as an argument a list of steps to add to the build.</p>
<p>For example lets say you have a script checked in into your source tree called build.sh.
When this script is called with the argument <code class="docutils literal notranslate"><span class="pre">--list-stages</span></code> it outputs a newline separated list of stage names.
This can be used to generate at runtime a step for each stage in the build.
Each stage is then run in this example using <code class="docutils literal notranslate"><span class="pre">./build.sh</span> <span class="pre">--run-stage</span> <span class="pre">&lt;stage</span> <span class="pre">name&gt;</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">steps</span>
<span class="kn">from</span> <span class="nn">buildbot.process</span> <span class="k">import</span> <span class="n">buildstep</span><span class="p">,</span> <span class="n">logobserver</span>
<span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="k">import</span> <span class="n">defer</span>

<span class="k">class</span> <span class="nc">GenerateStagesCommand</span><span class="p">(</span><span class="n">buildstep</span><span class="o">.</span><span class="n">ShellMixin</span><span class="p">,</span> <span class="n">steps</span><span class="o">.</span><span class="n">BuildStep</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupShellMixin</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">steps</span><span class="o">.</span><span class="n">BuildStep</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observer</span> <span class="o">=</span> <span class="n">logobserver</span><span class="o">.</span><span class="n">BufferLogObserver</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addLogObserver</span><span class="p">(</span><span class="s1">&#39;stdio&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">extract_stages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stdout</span><span class="p">):</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">stage</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">stage</span><span class="p">:</span>
                <span class="n">stages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stage</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stages</span>

    <span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># run &#39;./build.sh --list-stages&#39; to generate the list of stages</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeRemoteShellCommand</span><span class="p">()</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>

        <span class="c1"># if the command passes extract the list of stages</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">results</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">util</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
            <span class="c1"># create a ShellCommand for each stage and add them to the build</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">addStepsAfterCurrentStep</span><span class="p">([</span>
                <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">stage</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;./build.sh&quot;</span><span class="p">,</span> <span class="s2">&quot;--run-stage&quot;</span><span class="p">,</span> <span class="n">stage</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_stages</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observer</span><span class="o">.</span><span class="n">getStdout</span><span class="p">())</span>
            <span class="p">])</span>

        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Git</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="n">repourl</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">GenerateStagesCommand</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Generate build stages&quot;</span><span class="p">,</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;./build.sh&quot;</span><span class="p">,</span> <span class="s2">&quot;--list-stages&quot;</span><span class="p">],</span>
    <span class="n">haltOnFailure</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="predefined-build-factories">
<h5><a class="toc-backref" href="#id11">2.5.8.3. Predefined Build Factories</a><a class="headerlink" href="#predefined-build-factories" title="Permalink to this headline">¶</a></h5>
<p>Buildbot includes a few predefined build factories that perform common build sequences.
In practice, these are rarely used, as every site has slightly different requirements, but the source for these factories may provide examples for implementation of those requirements.</p>
<span class="target" id="gnuautoconf"></span><div class="section" id="index-1">
<span id="id2"></span><h6>GNUAutoconf<a class="headerlink" href="#index-1" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.GNUAutoconf">
<em class="property">class </em><code class="descclassname">buildbot.process.factory.</code><code class="descname">GNUAutoconf</code><a class="headerlink" href="#buildbot.process.factory.GNUAutoconf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://www.gnu.org/software/autoconf/">GNU Autoconf</a> is a software portability tool, intended to make it possible to write programs in C (and other languages) which will run on a variety of UNIX-like systems.
Most GNU software is built using autoconf.
It is frequently used in combination with GNU automake.
These tools both encourage a build process which usually looks like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% <span class="nv">CONFIG_ENV</span><span class="o">=</span>foo ./configure --with-flags
% make all
% make check
<span class="c1"># make install</span>
</pre></div>
</div>
<p>(except of course the Buildbot always skips the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code> part).</p>
<p>The Buildbot’s <a class="reference internal" href="#buildbot.process.factory.GNUAutoconf" title="buildbot.process.factory.GNUAutoconf"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.factory.GNUAutoconf</span></code></a> factory is designed to build projects which use GNU autoconf and/or automake.
The configuration environment variables, the configure flags, and command lines used for the compile and test are all configurable, in general the default values will be suitable.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">GNUAutoconf</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="n">URL</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;copy&quot;</span><span class="p">),</span>
                     <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;--disable-nls&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Required Arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt>
<dd>This argument must be a step specification tuple that provides a BuildStep to generate the source tree.</dd>
</dl>
<p>Optional Arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">configure</span></code></dt>
<dd>The command used to configure the tree.
Defaults to <strong class="command">./configure</strong>.
Accepts either a string or a list of shell argv elements.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">configureEnv</span></code></dt>
<dd>The environment used for the initial configuration step.
This accepts a dictionary which will be merged into the worker’s normal environment.
This is commonly used to provide things like <code class="docutils literal notranslate"><span class="pre">CFLAGS=&quot;-O2</span> <span class="pre">-g&quot;</span></code> (to turn off debug symbols during the compile).
Defaults to an empty dictionary.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">configureFlags</span></code></dt>
<dd>A list of flags to be appended to the argument list of the configure command.
This is commonly used to enable or disable specific features of the autoconf-controlled package, like <code class="docutils literal notranslate"><span class="pre">[&quot;--without-x&quot;]</span></code> to disable windowing support.
Defaults to an empty list.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reconf</span></code></dt>
<dd>use autoreconf to generate the ./configure file, set to True to use a buildbot default autoreconf command, or define the command for the ShellCommand.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">compile</span></code></dt>
<dd>this is a shell command or list of argv values which is used to actually compile the tree.
It defaults to <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>.
If set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, the compile step is skipped.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test</span></code></dt>
<dd>this is a shell command or list of argv values which is used to run the tree’s self-tests.
It defaults to <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">check</span></code>.
If set to None, the test step is skipped.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">distcheck</span></code></dt>
<dd>this is a shell command or list of argv values which is used to run the packaging test.
It defaults to <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">distcheck</span></code>.
If set to None, the test step is skipped.</dd>
</dl>
<span class="target" id="basicbuildfactory"></span></div>
<div class="section" id="index-2">
<span id="id3"></span><h6>BasicBuildFactory<a class="headerlink" href="#index-2" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.BasicBuildFactory">
<em class="property">class </em><code class="descclassname">buildbot.process.factory.</code><code class="descname">BasicBuildFactory</code><a class="headerlink" href="#buildbot.process.factory.BasicBuildFactory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">GNUAutoconf</span></code> which assumes the source is in CVS, and uses <code class="docutils literal notranslate"><span class="pre">mode='full'</span></code> and <code class="docutils literal notranslate"><span class="pre">method='clobber'</span></code>  to always build from a clean working copy.</p>
<span class="target" id="basicsvn"></span></div>
<div class="section" id="index-3">
<span id="id4"></span><h6>BasicSVN<a class="headerlink" href="#index-3" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.BasicSVN">
<em class="property">class </em><code class="descclassname">buildbot.process.factory.</code><code class="descname">BasicSVN</code><a class="headerlink" href="#buildbot.process.factory.BasicSVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This class is similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">QuickBuildFactory</span></code>, but uses SVN instead of CVS.</p>
<span class="target" id="quickbuildfactory"></span></div>
<div class="section" id="index-4">
<span id="id5"></span><h6>QuickBuildFactory<a class="headerlink" href="#index-4" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.QuickBuildFactory">
<em class="property">class </em><code class="descclassname">buildbot.process.factory.</code><code class="descname">QuickBuildFactory</code><a class="headerlink" href="#buildbot.process.factory.QuickBuildFactory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">QuickBuildFactory</span></code> class is a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">GNUAutoconf</span></code> which assumes the source is in CVS, and uses <code class="docutils literal notranslate"><span class="pre">mode='incremental'</span></code> to get incremental updates.</p>
<p>The difference between a <cite>full build</cite> and a <cite>quick build</cite> is that quick builds are generally done incrementally, starting with the tree where the previous build was performed.
That simply means that the source-checkout step should be given a <code class="docutils literal notranslate"><span class="pre">mode='incremental'</span></code> flag, to do the source update in-place.</p>
<p>In addition to that, this class sets the <code class="xref py py-attr docutils literal notranslate"><span class="pre">useProgress</span></code> flag to <code class="docutils literal notranslate"><span class="pre">False</span></code>.
Incremental builds will (or at least the ought to) compile as few files as necessary, so they will take an unpredictable amount of time to run.
Therefore it would be misleading to claim to predict how long the build will take.</p>
<p>This class is probably not of use to new projects.</p>
<span class="target" id="factory-cpan"></span></div>
<div class="section" id="cpan">
<span id="index-5"></span><h6>CPAN<a class="headerlink" href="#cpan" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.CPAN">
<em class="property">class </em><code class="descclassname">buildbot.process.factory.</code><code class="descname">CPAN</code><a class="headerlink" href="#buildbot.process.factory.CPAN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Most Perl modules available from the <a class="reference external" href="http://www.cpan.org/">CPAN</a> archive use the <code class="docutils literal notranslate"><span class="pre">MakeMaker</span></code> module to provide configuration, build, and test services.
The standard build routine for these modules looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% perl Makefile.PL
% make
% make <span class="nb">test</span>
<span class="c1"># make install</span>
</pre></div>
</div>
<p>(except again Buildbot skips the install step)</p>
<p>Buildbot provides a <code class="xref py py-class docutils literal notranslate"><span class="pre">CPAN</span></code> factory to compile and test these projects.</p>
<p>Arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt>
<dd>(required): A step specification tuple, like that used by <code class="xref py py-class docutils literal notranslate"><span class="pre">GNUAutoconf</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">perl</span></code></dt>
<dd>A string which specifies the <strong class="command">perl</strong> executable to use.
Defaults to just <strong class="command">perl</strong>.</dd>
</dl>
<span class="target" id="distutils"></span></div>
<div class="section" id="index-6">
<span id="id7"></span><h6>Distutils<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.Distutils">
<em class="property">class </em><code class="descclassname">buildbot.process.factory.</code><code class="descname">Distutils</code><a class="headerlink" href="#buildbot.process.factory.Distutils" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Most Python modules use the <code class="docutils literal notranslate"><span class="pre">distutils</span></code> package to provide configuration and build services.
The standard build process looks like:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% python ./setup.py build
% python ./setup.py install
</pre></div>
</div>
<p>Unfortunately, although Python provides a standard unit-test framework named <code class="docutils literal notranslate"><span class="pre">unittest</span></code>, to the best of my knowledge <code class="docutils literal notranslate"><span class="pre">distutils</span></code> does not provide a standardized target to run such unit tests.
(Please let me know if I’m wrong, and I will update this factory.)</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Distutils</span></code> factory provides support for running the build part of this process.
It accepts the same <code class="docutils literal notranslate"><span class="pre">source=</span></code> parameter as the other build factories.</p>
<p>Arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt>
<dd>(required): A step specification tuple, like that used by <code class="xref py py-class docutils literal notranslate"><span class="pre">GNUAutoconf</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">python</span></code></dt>
<dd>A string which specifies the <strong class="command">python</strong> executable to use.
Defaults to just <strong class="command">python</strong>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test</span></code></dt>
<dd>Provides a shell command which runs unit tests.
This accepts either a string or a list.
The default value is <code class="docutils literal notranslate"><span class="pre">None</span></code>, which disables the test step (since there is no common default command to run unit tests in distutils modules).</dd>
</dl>
<span class="target" id="trial"></span></div>
<div class="section" id="index-7">
<span id="id8"></span><h6>Trial<a class="headerlink" href="#index-7" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.Trial">
<em class="property">class </em><code class="descclassname">buildbot.process.factory.</code><code class="descname">Trial</code><a class="headerlink" href="#buildbot.process.factory.Trial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Twisted provides a unit test tool named <strong class="command">trial</strong> which provides a few improvements over Python’s built-in <code class="xref py py-mod docutils literal notranslate"><span class="pre">unittest</span></code> module.
Many Python projects which use Twisted for their networking or application services also use trial for their unit tests.
These modules are usually built and tested with something like the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% python ./setup.py build
% <span class="nv">PYTHONPATH</span><span class="o">=</span>build/lib.linux-i686-2.3 trial -v PROJECTNAME.test
% python ./setup.py install
</pre></div>
</div>
<p>Unfortunately, the <code class="file docutils literal notranslate"><span class="pre">build/lib</span></code> directory into which the built/copied <code class="docutils literal notranslate"><span class="pre">.py</span></code> files are placed is actually architecture-dependent, and I do not yet know of a simple way to calculate its value.
For many projects it is sufficient to import their libraries <cite>in place</cite> from the tree’s base directory (<code class="docutils literal notranslate"><span class="pre">PYTHONPATH=.</span></code>).</p>
<p>In addition, the <code class="samp docutils literal notranslate"><em><span class="pre">PROJECTNAME</span></em></code> value where the test files are located is project-dependent: it is usually just the project’s top-level library directory, as common practice suggests the unit test files are put in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">test</span></code> sub-module.
This value cannot be guessed, the <code class="xref py py-class docutils literal notranslate"><span class="pre">Trial</span></code> class must be told where to find the test files.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Trial</span></code> class provides support for building and testing projects which use distutils and trial.
If the test module name is specified, trial will be invoked.
The library path used for testing can also be set.</p>
<p>One advantage of trial is that the Buildbot happens to know how to parse trial output, letting it identify which tests passed and which ones failed.
The Buildbot can then provide fine-grained reports about how many tests have failed, when individual tests fail when they had been passing previously, etc.</p>
<p>Another feature of trial is that you can give it a series of source <code class="docutils literal notranslate"><span class="pre">.py</span></code> files, and it will search them for special <code class="docutils literal notranslate"><span class="pre">test-case-name</span></code> tags that indicate which test cases provide coverage for that file.
Trial can then run just the appropriate tests.
This is useful for quick builds, where you want to only run the test cases that cover the changed functionality.</p>
<p>Arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">testpath</span></code></dt>
<dd>Provides a directory to add to <span class="target" id="index-8"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> when running the unit tests, if tests are being run.
Defaults to <code class="docutils literal notranslate"><span class="pre">.</span></code> to include the project files in-place.
The generated build library is frequently architecture-dependent, but may simply be <code class="file docutils literal notranslate"><span class="pre">build/lib</span></code> for pure-Python modules.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">python</span></code></dt>
<dd>which Python executable to use.
This list will form the start of the <cite>argv</cite> array that will launch trial.
If you use this, you should set <code class="docutils literal notranslate"><span class="pre">trial</span></code> to an explicit path (like <code class="file docutils literal notranslate"><span class="pre">/usr/bin/trial</span></code> or <code class="file docutils literal notranslate"><span class="pre">./bin/trial</span></code>).
The parameter defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, which leaves it out entirely (running <code class="docutils literal notranslate"><span class="pre">trial</span> <span class="pre">args</span></code> instead of <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">./bin/trial</span> <span class="pre">args</span></code>).
Likely values are <code class="docutils literal notranslate"><span class="pre">['python']</span></code>, <code class="docutils literal notranslate"><span class="pre">['python2.2']</span></code>, or <code class="docutils literal notranslate"><span class="pre">['python',</span> <span class="pre">'-Wall']</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">trial</span></code></dt>
<dd>provides the name of the <strong class="command">trial</strong> command.
It is occasionally useful to use an alternate executable, such as <strong class="command">trial2.2</strong> which might run the tests under an older version of Python.
Defaults to <strong class="command">trial</strong>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">trialMode</span></code></dt>
<dd>a list of arguments to pass to trial, specifically to set the reporting mode.
This defaults to <code class="docutils literal notranslate"><span class="pre">['--reporter=bwverbose']</span></code>, which only works for Twisted-2.1.0 and later.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">trialArgs</span></code></dt>
<dd>a list of arguments to pass to trial, available to turn on any extra flags you like.
Defaults to <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tests</span></code></dt>
<dd>Provides a module name or names which contain the unit tests for this project.
Accepts a string, typically <code class="samp docutils literal notranslate"><em><span class="pre">PROJECTNAME</span></em><span class="pre">.test</span></code>, or a list of strings.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, indicating that no tests should be run.
You must either set this or <code class="docutils literal notranslate"><span class="pre">testChanges</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">testChanges</span></code></dt>
<dd>if <code class="docutils literal notranslate"><span class="pre">True</span></code>, ignore the <code class="docutils literal notranslate"><span class="pre">tests</span></code> parameter and instead ask the Build for all the files that make up the Changes going into this build.
Pass these filenames to trial and ask it to look for test-case-name tags, running just the tests necessary to cover the changes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">recurse</span></code></dt>
<dd>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, tells Trial (with the <code class="docutils literal notranslate"><span class="pre">--recurse</span></code> argument) to look in all subdirectories for additional test cases.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reactor</span></code></dt>
<dd>which reactor to use, like ‘gtk’ or ‘java’.
If not provided, the Twisted’s usual platform-dependent default is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">randomly</span></code></dt>
<dd>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, tells Trial (with the <code class="docutils literal notranslate"><span class="pre">--random=0</span></code> argument) to run the test cases in random order, which sometimes catches subtle inter-test dependency bugs.
Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</dd>
</dl>
<p>The step can also take any of the <code class="xref py py-class docutils literal notranslate"><span class="pre">ShellCommand</span></code> arguments, e.g., <code class="xref py py-attr docutils literal notranslate"><span class="pre">haltOnFailure</span></code>.</p>
<p>Unless one of <code class="docutils literal notranslate"><span class="pre">tests</span></code> or <code class="docutils literal notranslate"><span class="pre">testChanges</span></code> are set, the step will generate an exception.</p>
</div>
</div>
</div>
<span id="document-manual/configuration/properties"></span><div class="section" id="properties">
<span id="index-0"></span><span id="id1"></span><h4>2.5.9. Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h4>
<p>Build properties are a generalized way to provide configuration information to build steps; see <a class="reference internal" href="#build-properties"><span class="std std-ref">Build Properties</span></a> for the conceptual overview of properties.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#common-build-properties" id="id10">Common Build Properties</a></li>
<li><a class="reference internal" href="#source-stamp-attributes" id="id11">Source Stamp Attributes</a></li>
<li><a class="reference internal" href="#using-properties-in-steps" id="id12">Using Properties in Steps</a></li>
</ul>
</div>
<p>Some build properties come from external sources and are set before the build begins; others are set during the build, and available for later steps.
The sources for properties are:</p>
<dl class="docutils">
<dt><a class="reference internal" href="#cfg-properties" title="properties"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">global</span> <span class="pre">configuration</span></code></a></dt>
<dd>These properties apply to all builds.</dd>
<dt><a class="reference internal" href="#configuring-schedulers"><span class="std std-ref">schedulers</span></a></dt>
<dd>A scheduler can specify properties that become available to all builds it starts.</dd>
<dt><a class="reference internal" href="#change-sources"><span class="std std-ref">changes</span></a></dt>
<dd>A change can have properties attached to it, supplying extra information gathered by the change source.
This is most commonly used with the <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">sendchange</span></code></a> command.</dd>
<dt>forced builds</dt>
<dd>The “Force Build” form allows users to specify properties</dd>
<dt><a class="reference internal" href="#cfg-workers" title="workers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">workers</span></code></a></dt>
<dd>A worker can pass properties on to the builds it performs.</dd>
<dt><a class="reference internal" href="#common-build-properties"><span class="std std-ref">builds</span></a></dt>
<dd>A build automatically sets a number of properties on itself.</dd>
<dt><a class="reference internal" href="#cfg-builders" title="builders"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">builders</span></code></a></dt>
<dd>A builder can set properties on all the builds it runs.</dd>
<dt><a class="reference internal" href="#build-steps"><span class="std std-ref">steps</span></a></dt>
<dd>The steps of a build can set properties that are available to subsequent steps.
In particular, source steps set the <cite>got_revision</cite> property.</dd>
</dl>
<p>If the same property is supplied in multiple places, the final appearance takes precedence.
For example, a property set in a builder configuration will override one supplied by a scheduler.</p>
<p>Properties are stored internally in JSON format, so they are limited to basic types of data: numbers, strings, lists, and dictionaries.</p>
<div class="section" id="common-build-properties">
<span id="index-1"></span><span id="id2"></span><h5><a class="toc-backref" href="#id10">2.5.9.1. Common Build Properties</a><a class="headerlink" href="#common-build-properties" title="Permalink to this headline">¶</a></h5>
<p>The following build properties are set when the build is started, and are available to all steps.</p>
<dl class="docutils" id="index-2">
<dt><code class="docutils literal notranslate"><span class="pre">got_revision</span></code></dt>
<dd><p class="first">This property is set when a <code class="xref py py-class docutils literal notranslate"><span class="pre">Source</span></code> step checks out the source tree, and provides the revision that was actually obtained from the VC system.
In general this should be the same as <code class="docutils literal notranslate"><span class="pre">revision</span></code>, except for non-absolute sourcestamps, where <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> indicates what revision was current when the checkout was performed.
This can be used to rebuild the same source code later.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For some VC systems (Darcs in particular), the revision is a large string containing newlines, and is not suitable for interpolation into a filename.</p>
</div>
<p class="last">For multi-codebase builds (where codebase is not the default <cite>‘’</cite>), this property is a dictionary, keyed by codebase.</p>
</dd>
</dl>
<dl class="docutils" id="index-3">
<dt><code class="docutils literal notranslate"><span class="pre">buildername</span></code></dt>
<dd>This is a string that indicates which <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> the build was a part of.
The combination of buildername and buildnumber uniquely identify a build.</dd>
</dl>
<dl class="docutils" id="index-4">
<dt><code class="docutils literal notranslate"><span class="pre">buildnumber</span></code></dt>
<dd>Each build gets a number, scoped to the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> (so the first build performed on any given <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> will have a build number of 0).
This integer property contains the build’s number.</dd>
</dl>
<dl class="docutils" id="index-5">
<dt><code class="docutils literal notranslate"><span class="pre">workername</span></code></dt>
<dd>This is a string which identifies which worker the build is running on.</dd>
</dl>
<dl class="docutils" id="index-6">
<dt><code class="docutils literal notranslate"><span class="pre">scheduler</span></code></dt>
<dd>If the build was started from a scheduler, then this property will contain the name of that scheduler.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builddir</span></code></dt>
<dd>The absolute path of the base working directory on the worker, of the current builder.</dd>
</dl>
<p id="index-7">For single codebase builds, where the codebase is <cite>‘’</cite>, the following <a class="reference internal" href="#source-stamp-attributes"><span class="std std-ref">Source Stamp Attributes</span></a> are also available as properties: <code class="docutils literal notranslate"><span class="pre">branch</span></code>, <code class="docutils literal notranslate"><span class="pre">revision</span></code>, <code class="docutils literal notranslate"><span class="pre">repository</span></code>, and <code class="docutils literal notranslate"><span class="pre">project</span></code> .</p>
</div>
<div class="section" id="source-stamp-attributes">
<span id="id3"></span><h5><a class="toc-backref" href="#id11">2.5.9.2. Source Stamp Attributes</a><a class="headerlink" href="#source-stamp-attributes" title="Permalink to this headline">¶</a></h5>
<p id="index-8"><code class="docutils literal notranslate"><span class="pre">branch</span></code>
<code class="docutils literal notranslate"><span class="pre">revision</span></code>
<code class="docutils literal notranslate"><span class="pre">repository</span></code>
<code class="docutils literal notranslate"><span class="pre">project</span></code>
<code class="docutils literal notranslate"><span class="pre">codebase</span></code></p>
<blockquote>
<div>For details of these attributes see <a class="reference internal" href="#document-manual/concepts"><span class="doc">Concepts</span></a>.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">changes</span></code></p>
<blockquote>
<div>This attribute is a list of dictionaries representing the changes that make up this sourcestamp.</div></blockquote>
</div>
<div class="section" id="using-properties-in-steps">
<h5><a class="toc-backref" href="#id12">2.5.9.3. Using Properties in Steps</a><a class="headerlink" href="#using-properties-in-steps" title="Permalink to this headline">¶</a></h5>
<p>For the most part, properties are used to alter the behavior of build steps during a build.
This is done by using <span class="target" id="index-9"></span>renderables (objects implementing the <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> interface) as step parameters.
When the step is started, each such object is rendered using the current values of the build properties, and the resultant rendering is substituted as the actual value of the step parameter.</p>
<p>Buildbot offers several renderable object types covering common cases.
It’s also possible to <a class="reference internal" href="#custom-renderables"><span class="std std-ref">create custom renderables</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Properties are defined while a build is in progress; their values are not available when the configuration file is parsed.
This can sometimes confuse newcomers to Buildbot!
In particular, the following is a common error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;release_train&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">This does not work because the value of the property is not available when the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement is executed.
However, Python will not detect this as an error - you will just never see the step added to the factory.</p>
</div>
<p>You can use renderables in most step parameters.
Please file bugs for any parameters which do not accept renderables.</p>
<div class="section" id="property">
<span id="index-10"></span><span id="id4"></span><h6>Property<a class="headerlink" href="#property" title="Permalink to this headline">¶</a></h6>
<p>The simplest renderable is <code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code>, which renders to the value of the property named by its argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;buildername:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;buildername&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>You can specify a default value by passing a <code class="docutils literal notranslate"><span class="pre">default</span></code> keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;warnings:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>The default value is used when the property doesn’t exist, or when the value is something Python regards as <code class="docutils literal notranslate"><span class="pre">False</span></code>.
The <code class="docutils literal notranslate"><span class="pre">defaultWhenFalse</span></code> argument can be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to force buildbot to use the default argument only if the parameter is not set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;warnings:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                           <span class="n">defaultWhenFalse</span><span class="o">=</span><span class="kc">False</span><span class="p">)]))</span>
</pre></div>
</div>
<p>The default value can be a renderable itself, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;default-command&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="interpolate">
<span id="index-11"></span><span id="id5"></span><h6>Interpolate<a class="headerlink" href="#interpolate" title="Permalink to this headline">¶</a></h6>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code> can only be used to replace an entire argument: in the example above, it replaces an argument to <code class="docutils literal notranslate"><span class="pre">echo</span></code>.
Often, properties need to be interpolated into strings, instead.
The tool for that job is <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.</p>
<p>The more common pattern is to use Python dictionary-style string interpolation by using the <code class="docutils literal notranslate"><span class="pre">%(prop:&lt;propname&gt;)s</span></code> syntax.
In this form, the property name goes in the parentheses, as above.
A common mistake is to omit the trailing “s”, leading to a rather obscure error from Python (“ValueError: unsupported format character”).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;REVISION=%(prop:got_revision)s&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dist&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This example will result in a <code class="docutils literal notranslate"><span class="pre">make</span></code> command with an argument like <code class="docutils literal notranslate"><span class="pre">REVISION=12098</span></code>.</p>
<p id="interpolate-dictstyle">The syntax of dictionary-style interpolation is a selector, followed by a colon, followed by a selector specific key, optionally followed by a colon and a string indicating how to interpret the value produced by the key.</p>
<p>The following selectors are supported.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">prop</span></code></dt>
<dd>The key is the name of a property.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">src</span></code></dt>
<dd>The key is a codebase and source stamp attribute, separated by a colon.
Note, it is <code class="docutils literal notranslate"><span class="pre">%(src:&lt;codebase&gt;:&lt;ssattr&gt;)s</span></code> syntax, which differs from other selectors.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kw</span></code></dt>
<dd>The key refers to a keyword argument passed to <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code>.
Those keyword arguments may be ordinary values or renderables.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">secrets</span></code></dt>
<dd>The key refers to a secret provided by a provider declared in <a class="reference internal" href="#cfg-secretsProviders" title="secretsProviders"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">secretsProviders</span></code></a> .</dd>
</dl>
<p>The following ways of interpreting the value are available.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">-replacement</span></code></dt>
<dd>If the key exists, substitute its value; otherwise, substitute <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.
<code class="docutils literal notranslate"><span class="pre">replacement</span></code> may be empty (<code class="docutils literal notranslate"><span class="pre">%(prop:propname:-)s</span></code>).
This is the default.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">~replacement</span></code></dt>
<dd>Like <code class="docutils literal notranslate"><span class="pre">-replacement</span></code>, but only substitutes the value of the key if it is something Python regards as <code class="docutils literal notranslate"><span class="pre">True</span></code>.
Python considers <code class="docutils literal notranslate"><span class="pre">None</span></code>, 0, empty lists, and the empty string to be false, so such values will be replaced by <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">+replacement</span></code></dt>
<dd>If the key exists, substitute <code class="docutils literal notranslate"><span class="pre">replacement</span></code>; otherwise, substitute an empty string.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">?|sub_if_exists|sub_if_missing</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">#?|sub_if_true|sub_if_false</span></code></dt>
<dd>Ternary substitution, depending on either the key being present (with <code class="docutils literal notranslate"><span class="pre">?</span></code>, similar to <code class="docutils literal notranslate"><span class="pre">+</span></code>) or being <code class="docutils literal notranslate"><span class="pre">True</span></code> (with <code class="docutils literal notranslate"><span class="pre">#?</span></code>, like <code class="docutils literal notranslate"><span class="pre">~</span></code>).
Notice that there is a pipe immediately following the question mark <em>and</em> between the two substitution alternatives.
The character that follows the question mark is used as the delimiter between the two alternatives.
In the above examples, it is a pipe, but any character other than <code class="docutils literal notranslate"><span class="pre">(</span></code> can be used.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although these are similar to shell substitutions, no other substitutions are currently supported.</p>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;save-build-artifacts-script.sh&#39;</span><span class="p">,</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-r %(prop:repository)s&#39;</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-b %(src::branch)s&#39;</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-d %(kw:data)s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;some extra needed data&quot;</span><span class="p">)</span>
    <span class="p">]))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We use <code class="docutils literal notranslate"><span class="pre">%(src::branch)s</span></code> in most of examples, because <code class="docutils literal notranslate"><span class="pre">codebase</span></code> is empty by default.</p>
</div>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;make&#39;</span><span class="p">,</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;REVISION=%(prop:got_revision:-%(src::revision:-unknown)s)s&#39;</span><span class="p">),</span>
        <span class="s1">&#39;dist&#39;</span>
    <span class="p">]))</span>
</pre></div>
</div>
<p>In addition, <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code> supports using positional string interpolation.
Here, <code class="docutils literal notranslate"><span class="pre">%s</span></code> is used as a placeholder, and the substitutions (which may be renderables), are given as subsequent arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TODO</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Like Python, you can use either positional interpolation <em>or</em> dictionary-style interpolation, not both.
Thus you cannot use a string like <code class="docutils literal notranslate"><span class="pre">Interpolate(&quot;foo-%(src::revision)s-%s&quot;,</span> <span class="pre">&quot;branch&quot;)</span></code>.</p>
</div>
</div>
<div class="section" id="renderer">
<span id="index-12"></span><span id="id6"></span><h6>Renderer<a class="headerlink" href="#renderer" title="Permalink to this headline">¶</a></h6>
<p>While Interpolate can handle many simple cases, and even some common conditionals, more complex cases are best handled with Python code.
The <code class="docutils literal notranslate"><span class="pre">renderer</span></code> decorator creates a renderable object whose rendering is obtained by calling the decorated function when the step it’s passed to begins.
The function receives an <code class="xref py py-class docutils literal notranslate"><span class="pre">IProperties</span></code> object, which it can use to examine the values of any and all properties.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="nd">@util</span><span class="o">.</span><span class="n">renderer</span>
<span class="k">def</span> <span class="nf">makeCommand</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">]</span>
    <span class="n">cpus</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;CPUs&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cpus</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpus</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>
    <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;%(prop:MAKETARGET)s&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">command</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">makeCommand</span><span class="p">))</span>
</pre></div>
</div>
<p>You can think of <code class="docutils literal notranslate"><span class="pre">renderer</span></code> as saying “call this function when the step starts”.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since 0.9.3, renderer can itself return <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> objects or containers containing <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code>.</p>
</div>
<p>Optionally, extra arguments may be passed to the rendered function at any time by calling <code class="docutils literal notranslate"><span class="pre">withArgs</span></code> on the renderable object.
The <code class="docutils literal notranslate"><span class="pre">withArgs</span></code> method accepts <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> arguments which are stored in a new renderable object which is returned.
The original renderable object is not modified.
Multiple <code class="docutils literal notranslate"><span class="pre">withArgs</span></code> calls may be chained.
The passed <code class="docutils literal notranslate"><span class="pre">*args</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> parameters are rendered and the results are passed to the rendered function at the time it is itself rendered.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="nd">@util</span><span class="o">.</span><span class="n">renderer</span>
<span class="k">def</span> <span class="nf">makeCommand</span><span class="p">(</span><span class="n">props</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">]</span>
    <span class="n">cpus</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;CPUs&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cpus</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpus</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>
    <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">target</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">command</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">makeCommand</span><span class="o">.</span><span class="n">withArgs</span><span class="p">(</span><span class="s1">&#39;mytarget&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The rendering of the renderable object may happen at unexpected times, so it is best to ensure that the passed extra arguments are not changed.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Config errors with Renderables may not always be caught via checkconfig</p>
</div>
</div>
<div class="section" id="transform">
<span id="index-13"></span><span id="id7"></span><h6>Transform<a class="headerlink" href="#transform" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">Transform</span></code> is an alternative to <code class="docutils literal notranslate"><span class="pre">renderer</span></code>.
While <code class="docutils literal notranslate"><span class="pre">renderer</span></code> is useful for creating new renderables, <code class="docutils literal notranslate"><span class="pre">Transform</span></code> is easier to use when you want to transform or combine the renderings of preexisting ones.</p>
<p><code class="docutils literal notranslate"><span class="pre">Transform</span></code> takes a function and any number of positional and keyword arguments.
The function must either be a callable object or a renderable producing one.
When rendered, a <code class="docutils literal notranslate"><span class="pre">Transform</span></code> first replaces all of its arguments that are renderables with their renderings, then calls the function, passing it the positional and keyword arguments, and returns the result as its own rendering.</p>
<p>For example, suppose <code class="docutils literal notranslate"><span class="pre">my_path</span></code> is a path on the worker, and you want to get it relative to the build directory.
You can do it like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="n">my_path_rel</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">,</span> <span class="n">my_path</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;builddir&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This works whether <code class="docutils literal notranslate"><span class="pre">my_path</span></code> is an ordinary string or a renderable.
<code class="docutils literal notranslate"><span class="pre">my_path_rel</span></code> will be a renderable in either case, however.</p>
</div>
<div class="section" id="flattenlist">
<span id="withproperties"></span><span id="index-14"></span><h6>FlattenList<a class="headerlink" href="#flattenlist" title="Permalink to this headline">¶</a></h6>
<p>If nested list should be flatten for some renderables, FlattenList could be used.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span> <span class="s1">&#39;make&#39;</span> <span class="p">],</span>
    <span class="n">descriptionDone</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">([</span> <span class="s1">&#39;make &#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;done&#39;</span> <span class="p">]])</span>
<span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code> would be set to <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">'make',</span> <span class="pre">'done'</span> <span class="pre">]</span></code> when the <code class="docutils literal notranslate"><span class="pre">ShellCommand</span></code> executes.
This is useful when a list-returning property is used in renderables.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ShellCommand automatically flattens nested lists in its <code class="docutils literal notranslate"><span class="pre">command</span></code> argument, so there is no need to use <code class="docutils literal notranslate"><span class="pre">FlattenList</span></code> for it.</p>
</div>
</div>
<div class="section" id="id8">
<h6>WithProperties<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h6>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This class is deprecated.
It is an older version of <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.
It exists for compatibility with older configs.</p>
</div>
<p>The simplest use of this class is with positional string interpolation.
Here, <code class="docutils literal notranslate"><span class="pre">%s</span></code> is used as a placeholder, and property names are given as subsequent arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">,</span> <span class="s2">&quot;czf&quot;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">WithProperties</span><span class="p">(</span><span class="s2">&quot;build-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">.tar.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;branch&quot;</span><span class="p">,</span> <span class="s2">&quot;revision&quot;</span><span class="p">),</span>
            <span class="s2">&quot;source&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>If this <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> were used in a tree obtained from Git, it would create a tarball with a name like <code class="file docutils literal notranslate"><span class="pre">build-master-a7d3a333db708e786edb34b6af646edd8d4d3ad9.tar.gz</span></code>.</p>
<p id="index-15">The more common pattern is to use Python dictionary-style string interpolation by using the <code class="docutils literal notranslate"><span class="pre">%(propname)s</span></code> syntax.
In this form, the property name goes in the parentheses, as above.
A common mistake is to omit the trailing “s”, leading to a rather obscure error from Python (“ValueError: unsupported format character”).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">WithProperties</span><span class="p">(</span><span class="s1">&#39;REVISION=</span><span class="si">%(got_revision)s</span><span class="s1">&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dist&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This example will result in a <code class="docutils literal notranslate"><span class="pre">make</span></code> command with an argument like <code class="docutils literal notranslate"><span class="pre">REVISION=12098</span></code>.</p>
<p id="withproperties-dictstyle">The dictionary-style interpolation supports a number of more advanced syntaxes in the parentheses.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">propname:-replacement</span></code></dt>
<dd>If <code class="docutils literal notranslate"><span class="pre">propname</span></code> exists, substitute its value; otherwise, substitute <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.
<code class="docutils literal notranslate"><span class="pre">replacement</span></code> may be empty (<code class="docutils literal notranslate"><span class="pre">%(propname:-)s</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">propname:~replacement</span></code></dt>
<dd>Like <code class="docutils literal notranslate"><span class="pre">propname:-replacement</span></code>, but only substitutes the value of property <code class="docutils literal notranslate"><span class="pre">propname</span></code> if it is something Python regards as <code class="docutils literal notranslate"><span class="pre">True</span></code>.
Python considers <code class="docutils literal notranslate"><span class="pre">None</span></code>, 0, empty lists, and the empty string to be false, so such values will be replaced by <code class="docutils literal notranslate"><span class="pre">replacement</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">propname:+replacement</span></code></dt>
<dd>If <code class="docutils literal notranslate"><span class="pre">propname</span></code> exists, substitute <code class="docutils literal notranslate"><span class="pre">replacement</span></code>; otherwise, substitute an empty string.</dd>
</dl>
<p>Although these are similar to shell substitutions, no other substitutions are currently supported, and <code class="docutils literal notranslate"><span class="pre">replacement</span></code> in the above cannot contain more substitutions.</p>
<p>Note: like Python, you can use either positional interpolation <em>or</em> dictionary-style interpolation, not both.
Thus you cannot use a string like <code class="docutils literal notranslate"><span class="pre">WithProperties(&quot;foo-%(revision)s-%s&quot;,</span> <span class="pre">&quot;branch&quot;)</span></code>.</p>
</div>
<div class="section" id="custom-renderables">
<span id="id9"></span><h6>Custom Renderables<a class="headerlink" href="#custom-renderables" title="Permalink to this headline">¶</a></h6>
<p>If the options described above are not sufficient, more complex substitutions can be achieved by writing custom renderables.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> interface is simple - objects must provide a <cite>getRenderingFor</cite> method.
The method should take one argument - an <code class="xref py py-class docutils literal notranslate"><span class="pre">IProperties</span></code> provider - and should return the rendered value or a deferred firing with one.
Pass instances of the class anywhere other renderables are accepted.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="k">import</span> <span class="n">IRenderable</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="k">import</span> <span class="n">implementer</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IRenderable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DetermineFoo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getRenderingFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;qux&#39;</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="n">DetermineFoo</span><span class="p">()])</span>
</pre></div>
</div>
<p>or, more practically,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="k">import</span> <span class="n">IRenderable</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="k">import</span> <span class="n">implementer</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IRenderable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Now</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getRenderingFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;TIME=%(kw:now)s&#39;</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="n">Now</span><span class="p">())])</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="nd">@util</span><span class="o">.</span><span class="n">renderer</span>
<span class="k">def</span> <span class="nf">now</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;TIME=%(kw:now)s&#39;</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="n">now</span><span class="p">)])</span>
</pre></div>
</div>
<p>Note that a custom renderable must be instantiated (and its constructor can take whatever arguments you’d like), whereas a function decorated with <code class="xref py py-func docutils literal notranslate"><span class="pre">renderer</span></code> can be used directly.</p>
</div>
<div class="section" id="url-for-build">
<span id="urlforbuild"></span><h6>URL for build<a class="headerlink" href="#url-for-build" title="Permalink to this headline">¶</a></h6>
<p>Its common to need to use the URL for the build in a step.
For this you can use a special custom renderer as following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;BUILDURL=%(kw:url)s&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">URLForBuild</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-manual/configuration/buildsteps"></span><div class="section" id="build-steps">
<span id="id1"></span><h4>2.5.10. Build Steps<a class="headerlink" href="#build-steps" title="Permalink to this headline">¶</a></h4>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s are usually specified in the buildmaster’s configuration file, in a list that goes into the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code>.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> instances in this list are used as templates to construct new independent copies for each build (so that state can be kept on the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> in one build without affecting a later build).
Each <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> can be created with a list of steps, or the factory can be created empty and then steps added to it using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">addStep</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">steps</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addSteps</span><span class="p">([</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;http://svn.example.org/Trunk/&quot;</span><span class="p">),</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]),</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">])</span>
<span class="p">])</span>
</pre></div>
</div>
<p>The basic behavior for a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> is to:</p>
<ul class="simple">
<li>run for a while, then stop</li>
<li>possibly invoke some RemoteCommands on the attached worker</li>
<li>possibly produce a set of log files</li>
<li>finish with a status described by one of four values defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.status.builder</span></code>: <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>, <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>, <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>, <code class="docutils literal notranslate"><span class="pre">SKIPPED</span></code></li>
<li>provide a list of short strings to describe the step</li>
</ul>
<p>The rest of this section describes all the standard <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> objects available for use in a <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>, and the parameters which can be used to control each.
A full list of build steps is available in the <a class="reference internal" href="bb-step.html" title="Build Step Index"><em>Build Step Index</em></a>.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#common-parameters" id="id20">Common Parameters</a></li>
<li><a class="reference internal" href="#module-buildbot.steps.source" id="id21">Source Checkout</a><ul>
<li><a class="reference internal" href="#common-parameters-of-source-checkout-operations" id="id22">Common Parameters of source checkout operations</a></li>
<li><a class="reference internal" href="#mercurial" id="id23">Mercurial</a></li>
<li><a class="reference internal" href="#git" id="id24">Git</a></li>
<li><a class="reference internal" href="#svn" id="id25">SVN</a></li>
<li><a class="reference internal" href="#cvs" id="id26">CVS</a></li>
<li><a class="reference internal" href="#bzr" id="id27">Bzr</a></li>
<li><a class="reference internal" href="#p4" id="id28">P4</a></li>
<li><a class="reference internal" href="#repo" id="id29">Repo</a></li>
<li><a class="reference internal" href="#gerrit" id="id30">Gerrit</a></li>
<li><a class="reference internal" href="#github" id="id31">GitHub</a></li>
<li><a class="reference internal" href="#gitlab" id="id32">GitLab</a></li>
<li><a class="reference internal" href="#darcs" id="id33">Darcs</a></li>
<li><a class="reference internal" href="#monotone" id="id34">Monotone</a></li>
</ul>
</li>
<li><a class="reference internal" href="#other-source-operations" id="id35">Other Source operations</a><ul>
<li><a class="reference internal" href="#gitpush" id="id36">GitPush</a></li>
</ul>
</li>
<li><a class="reference internal" href="#shellcommand" id="id37">ShellCommand</a><ul>
<li><a class="reference internal" href="#using-shellcommands" id="id38">Using ShellCommands</a></li>
<li><a class="reference internal" href="#shell-sequence" id="id39">Shell Sequence</a></li>
<li><a class="reference internal" href="#configure" id="id40">Configure</a></li>
<li><a class="reference internal" href="#cmake" id="id41">CMake</a></li>
<li><a class="reference internal" href="#compile" id="id42">Compile</a></li>
<li><a class="reference internal" href="#visual-c" id="id43">Visual C++</a></li>
<li><a class="reference internal" href="#cppcheck" id="id44">Cppcheck</a></li>
<li><a class="reference internal" href="#robocopy" id="id45">Robocopy</a></li>
<li><a class="reference internal" href="#test" id="id46">Test</a></li>
<li><a class="reference internal" href="#treesize" id="id47">TreeSize</a></li>
<li><a class="reference internal" href="#perlmoduletest" id="id48">PerlModuleTest</a></li>
<li><a class="reference internal" href="#mtr-mysql-test-run" id="id49">MTR (mysql-test-run)</a></li>
<li><a class="reference internal" href="#subunitshellcommand" id="id50">SubunitShellCommand</a></li>
</ul>
</li>
<li><a class="reference internal" href="#worker-filesystem-steps" id="id51">Worker Filesystem Steps</a><ul>
<li><a class="reference internal" href="#fileexists" id="id52">FileExists</a></li>
<li><a class="reference internal" href="#copydirectory" id="id53">CopyDirectory</a></li>
<li><a class="reference internal" href="#removedirectory" id="id54">RemoveDirectory</a></li>
<li><a class="reference internal" href="#makedirectory" id="id55">MakeDirectory</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python-buildsteps" id="id56">Python BuildSteps</a><ul>
<li><a class="reference internal" href="#buildepydoc" id="id57">BuildEPYDoc</a></li>
<li><a class="reference internal" href="#pyflakes" id="id58">PyFlakes</a></li>
<li><a class="reference internal" href="#sphinx" id="id59">Sphinx</a></li>
<li><a class="reference internal" href="#pylint" id="id60">PyLint</a></li>
<li><a class="reference internal" href="#trial" id="id61">Trial</a></li>
<li><a class="reference internal" href="#removepycs" id="id62">RemovePYCs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transferring-files" id="id63">Transferring Files</a><ul>
<li><a class="reference internal" href="#other-parameters" id="id64">Other Parameters</a></li>
<li><a class="reference internal" href="#transferring-directories" id="id65">Transferring Directories</a></li>
<li><a class="reference internal" href="#transferring-multiple-files-at-once" id="id66">Transferring Multiple Files At Once</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transferring-strings" id="id67">Transferring Strings</a></li>
<li><a class="reference internal" href="#running-commands-on-the-master" id="id68">Running Commands on the Master</a><ul>
<li><a class="reference internal" href="#logrenderable" id="id69">LogRenderable</a></li>
<li><a class="reference internal" href="#assert" id="id70">Assert</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-properties" id="id71">Setting Properties</a><ul>
<li><a class="reference internal" href="#setproperty" id="id72">SetProperty</a></li>
<li><a class="reference internal" href="#setproperties-step" id="id73"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetProperties</span></code> step</a></li>
<li><a class="reference internal" href="#setpropertyfromcommand" id="id74">SetPropertyFromCommand</a></li>
<li><a class="reference internal" href="#setpropertiesfromenv" id="id75">SetPropertiesFromEnv</a></li>
</ul>
</li>
<li><a class="reference internal" href="#triggering-schedulers" id="id76">Triggering Schedulers</a><ul>
<li><a class="reference internal" href="#dynamic-trigger" id="id77">Dynamic Trigger</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rpm-related-steps" id="id78">RPM-Related Steps</a><ul>
<li><a class="reference internal" href="#rpmbuild" id="id79">RpmBuild</a></li>
<li><a class="reference internal" href="#rpmlint" id="id80">RpmLint</a></li>
<li><a class="reference internal" href="#mock-steps" id="id81">Mock Steps</a></li>
<li><a class="reference internal" href="#mockbuildsrpm-step" id="id82">MockBuildSRPM Step</a></li>
<li><a class="reference internal" href="#mockrebuild-step" id="id83">MockRebuild Step</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debian-build-steps" id="id84">Debian Build Steps</a><ul>
<li><a class="reference internal" href="#debpbuilder" id="id85">DebPbuilder</a></li>
<li><a class="reference internal" href="#debcowbuilder" id="id86">DebCowbuilder</a></li>
<li><a class="reference internal" href="#deblintian" id="id87">DebLintian</a></li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous-buildsteps" id="id88">Miscellaneous BuildSteps</a><ul>
<li><a class="reference internal" href="#hlint" id="id89">HLint</a></li>
<li><a class="reference internal" href="#maxq" id="id90">MaxQ</a></li>
<li><a class="reference internal" href="#http-requests" id="id91">HTTP Requests</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="common-parameters">
<span id="buildstep-common-parameters"></span><span id="index-0"></span><h5><a class="toc-backref" href="#id20">2.5.10.1. Common Parameters</a><a class="headerlink" href="#common-parameters" title="Permalink to this headline">¶</a></h5>
<p>All <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s accept some common parameters.
Some of these control how their individual status affects the overall build.
Others are used to specify which <cite>Locks</cite> (see <a class="reference internal" href="#interlocks"><span class="std std-ref">Interlocks</span></a>) should be acquired before allowing the step to run.</p>
<p>Arguments common to all <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> subclasses:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>the name used to describe the step on the status display.
Since 0.9.8, this argument might be renderable.</dd>
</dl>
<dl class="docutils" id="index-1">
<dt><code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code></dt>
<dd>if <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will cause the build to halt immediately.
Steps with <code class="docutils literal notranslate"><span class="pre">alwaysRun=True</span></code> are still run.
Generally speaking, <code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code> implies <code class="docutils literal notranslate"><span class="pre">flunkOnFailure</span></code> (the default for most <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s).
In some cases, particularly series of tests, it makes sense to <code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code> if something fails early on but not <code class="docutils literal notranslate"><span class="pre">flunkOnFailure</span></code>.
This can be achieved with <code class="docutils literal notranslate"><span class="pre">haltOnFailure=True</span></code>, <code class="docutils literal notranslate"><span class="pre">flunkOnFailure=False</span></code>.</dd>
</dl>
<dl class="docutils" id="index-2">
<dt><code class="docutils literal notranslate"><span class="pre">flunkOnWarnings</span></code></dt>
<dd>when <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code> or <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will mark the overall build as <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>.
The remaining steps will still be executed.</dd>
</dl>
<dl class="docutils" id="index-3">
<dt><code class="docutils literal notranslate"><span class="pre">flunkOnFailure</span></code></dt>
<dd>when <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will mark the overall build as a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>.
The remaining steps will still be executed.</dd>
</dl>
<dl class="docutils" id="index-4">
<dt><code class="docutils literal notranslate"><span class="pre">warnOnWarnings</span></code></dt>
<dd>when <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code> or <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will mark the overall build as having <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>.
The remaining steps will still be executed.</dd>
</dl>
<dl class="docutils" id="index-5">
<dt><code class="docutils literal notranslate"><span class="pre">warnOnFailure</span></code></dt>
<dd>when <code class="docutils literal notranslate"><span class="pre">True</span></code>, a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> of this build step will mark the overall build as having <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>.
The remaining steps will still be executed.</dd>
</dl>
<dl class="docutils" id="index-6">
<dt><code class="docutils literal notranslate"><span class="pre">alwaysRun</span></code></dt>
<dd>if <code class="docutils literal notranslate"><span class="pre">True</span></code>, this build step will always be run, even if a previous buildstep with <code class="docutils literal notranslate"><span class="pre">haltOnFailure=True</span></code> has failed.</dd>
</dl>
<dl class="docutils" id="index-7">
<dt><code class="docutils literal notranslate"><span class="pre">description</span></code></dt>
<dd>This will be used to describe the command (on the Waterfall display) while the command is still running.
It should be a single imperfect-tense verb, like <cite>compiling</cite> or <cite>testing</cite>.
The preferred form is a single, short string, but for historical reasons a list of strings is also acceptable.</dd>
</dl>
<dl class="docutils" id="index-8">
<dt><code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code></dt>
<dd><p class="first">This will be used to describe the command once it has finished.
A simple noun like <cite>compile</cite> or <cite>tests</cite> should be used.
Like <code class="docutils literal notranslate"><span class="pre">description</span></code>, this may either be a string or a list of short strings.</p>
<p>If neither <code class="docutils literal notranslate"><span class="pre">description</span></code> nor <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code> are set, the actual command arguments will be used to construct the description.
This may be a bit too wide to fit comfortably on the Waterfall display.</p>
<p>All subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> will contain the description attributes.
Consequently, you could add a <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> step like so:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">description</span><span class="o">=</span><span class="s2">&quot;testing&quot;</span><span class="p">,</span>
                             <span class="n">descriptionDone</span><span class="o">=</span><span class="s2">&quot;tests&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-9">
<dt><code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code></dt>
<dd><p class="first">This is an optional suffix appended to the end of the description (ie, after <code class="docutils literal notranslate"><span class="pre">description</span></code> and <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code>).
This can be used to distinguish between build steps that would display the same descriptions in the waterfall.
This parameter may be a string, a list of short strings or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p class="last">For example, a builder might use the <a class="reference internal" href="#step-Compile" title="Compile"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Compile</span></code></a> step to build two different codebases.
The <code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code> could be set to <cite>projectFoo</cite> and <cite>projectBar</cite>, respectively for each step, which will result in the full descriptions <cite>compiling projectFoo</cite> and <cite>compiling projectBar</cite> to be shown in the waterfall.</p>
</dd>
</dl>
<dl class="docutils" id="index-10">
<dt><code class="docutils literal notranslate"><span class="pre">doStepIf</span></code></dt>
<dd>A step can be configured to only run under certain conditions.
To do this, set the step’s <code class="docutils literal notranslate"><span class="pre">doStepIf</span></code> to a boolean value, or to a function that returns a boolean value or Deferred.
If the value or function result is false, then the step will return <code class="docutils literal notranslate"><span class="pre">SKIPPED</span></code> without doing anything.
Otherwise, the step will be executed normally.
If you set <code class="docutils literal notranslate"><span class="pre">doStepIf</span></code> to a function, that function should accept one parameter, which will be the <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code> object itself.</dd>
</dl>
<dl class="docutils" id="index-11">
<dt><code class="docutils literal notranslate"><span class="pre">hideStepIf</span></code></dt>
<dd><p class="first">A step can be optionally hidden from the waterfall and build details web pages.
To do this, set the step’s <code class="docutils literal notranslate"><span class="pre">hideStepIf</span></code> to a boolean value, or to a function that takes two parameters – the results and the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> – and returns a boolean value.
Steps are always shown while they execute, however after the step has finished, this parameter is evaluated (if a function) and if the value is True, the step is hidden.
For example, in order to hide the step if the step has been skipped:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">hideStepIf</span><span class="o">=</span><span class="k">lambda</span> <span class="n">results</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">results</span><span class="o">==</span><span class="n">SKIPPED</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-12">
<dt><code class="docutils literal notranslate"><span class="pre">locks</span></code></dt>
<dd>a list of <code class="docutils literal notranslate"><span class="pre">Locks</span></code> (instances of <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.WorkerLock</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.MasterLock</span></code>) that should be acquired before starting this <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>.
Alternatively this could be a renderable that returns this list during build execution.
This lets you defer picking the locks to acquire until the build step is about to start running.
The <code class="docutils literal notranslate"><span class="pre">Locks</span></code> will be released when the step is complete.
Note that this is a list of actual <code class="xref py py-class docutils literal notranslate"><span class="pre">Lock</span></code> instances, not names.
Also note that all Locks must have unique names.
See <a class="reference internal" href="#interlocks"><span class="std std-ref">Interlocks</span></a>.</dd>
</dl>
<dl class="docutils" id="index-13">
<dt><code class="docutils literal notranslate"><span class="pre">logEncoding</span></code></dt>
<dd>The character encoding to use to decode logs produced during the execution of this step.
This overrides the default <a class="reference internal" href="#cfg-logEncoding" title="logEncoding"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logEncoding</span></code></a>; see <a class="reference internal" href="#log-encodings"><span class="std std-ref">Log Handling</span></a>.</dd>
</dl>
<dl class="docutils" id="index-14">
<dt><code class="docutils literal notranslate"><span class="pre">updateBuildSummaryPolicy</span></code></dt>
<dd><p class="first">The policy to use to propagate the step summary to the build summary.
If False, the build summary will never include step summary
If True, the build summary will always include step summary
If set to a list (e.g. <code class="docutils literal notranslate"><span class="pre">[FAILURE,</span> <span class="pre">EXCEPTION]</span></code>), it will propagate if the step results id is present in that list.
If not set or None, the default is computed according to other BuildStep parameters using following algorithm:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">updateBuildSummaryPolicy</span> <span class="o">=</span> <span class="p">[</span><span class="n">EXCEPTION</span><span class="p">,</span> <span class="n">RETRY</span><span class="p">,</span> <span class="n">CANCELLED</span><span class="p">]</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flunkOnFailure</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">haltOnFailure</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnOnFailure</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateBuildSummaryPolicy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FAILURE</span><span class="p">)</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warnOnWarnings</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">flunkOnWarnings</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">updateBuildSummaryPolicy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WARNINGS</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">Note that in a custom step, if <code class="xref py py-meth docutils literal notranslate"><span class="pre">BuildStep.getResultSummary</span></code> is overridden and setting the <code class="docutils literal notranslate"><span class="pre">build</span></code> summary, <code class="docutils literal notranslate"><span class="pre">updateBuildSummaryPolicy</span></code> is ignored and <code class="docutils literal notranslate"><span class="pre">build</span></code> summary will be used regardless.</p>
</dd>
</dl>
</div>
<div class="section" id="module-buildbot.steps.source">
<span id="id2"></span><span id="source-checkout"></span><h5><a class="toc-backref" href="#id21">2.5.10.2. Source Checkout</a><a class="headerlink" href="#module-buildbot.steps.source" title="Permalink to this headline">¶</a></h5>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>Support for the old worker-side source checkout steps was removed in Buildbot-0.9.0.</p>
<p>The old source steps used to be imported like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.steps.source.oldsource</span> <span class="k">import</span> <span class="n">Git</span>

<span class="o">...</span> <span class="n">Git</span> <span class="o">...</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.steps.source</span> <span class="k">import</span> <span class="n">Git</span>
</pre></div>
</div>
<p>while new source steps are in separate Python modules for each version-control system and, using the plugin infrastructure are available as:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="o">...</span> <span class="n">steps</span><span class="o">.</span><span class="n">Git</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="common-parameters-of-source-checkout-operations">
<h6><a class="toc-backref" href="#id22">Common Parameters of source checkout operations</a><a class="headerlink" href="#common-parameters-of-source-checkout-operations" title="Permalink to this headline">¶</a></h6>
<p>All source checkout steps accept some common parameters to control how they get the sources and where they should be placed.
The remaining per-VC-system parameters are mostly to specify where exactly the sources are coming from.</p>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>These two parameters specify the means by which the source is checked out.
<code class="docutils literal notranslate"><span class="pre">mode</span></code> specifies the type of checkout and <code class="docutils literal notranslate"><span class="pre">method</span></code> tells about the way to implement it.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">factory</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Mercurial</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fresh&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">mode</span></code> parameter a string describing the kind of VC operation that is desired, defaulting to <code class="docutils literal notranslate"><span class="pre">incremental</span></code>.
The options are</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">incremental</span></code></dt>
<dd>Update the source to the desired revision, but do not remove any other files generated by previous builds.
This allows compilers to take advantage of object files from previous builds.
This mode is exactly same as the old <code class="docutils literal notranslate"><span class="pre">update</span></code> mode.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">full</span></code></dt>
<dd>Update the source, but delete remnants of previous builds.
Build steps that follow will need to regenerate all object files.</dd>
</dl>
<p>Methods are specific to the version-control system in question, as they may take advantage of special behaviors in that version-control system that can make checkouts more efficient or reliable.</p>
</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt>
<dd>like all Steps, this indicates the directory where the build will take place.
Source Steps are special in that they perform some operations outside of the workdir (like creating the workdir itself).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code></dt>
<dd>if True, bypass the usual behavior of checking out the revision in the source stamp, and always update to the latest revision in the repository instead.
If the specific VC system supports branches and a specific branch is specified in the step parameters via <code class="docutils literal notranslate"><span class="pre">branch</span></code> or <code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code> parameters then the latest revision on that branch is checked out.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">retry</span></code></dt>
<dd>If set, this specifies a tuple of <code class="docutils literal notranslate"><span class="pre">(delay,</span> <span class="pre">repeats)</span></code> which means that when a full VC checkout fails, it should be retried up to <code class="docutils literal notranslate"><span class="pre">repeats</span></code> times, waiting <code class="docutils literal notranslate"><span class="pre">delay</span></code> seconds between attempts.
If you don’t provide this, it defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, which means VC operations should not be retried.
This is provided to make life easier for workers which are stuck behind poor network connections.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repository</span></code></dt>
<dd><p class="first">The name of this parameter might vary depending on the Source step you are running.
The concept explained here is common to all steps and applies to <code class="docutils literal notranslate"><span class="pre">repourl</span></code> as well as for <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> (when applicable).</p>
<p class="last">A common idiom is to pass <code class="docutils literal notranslate"><span class="pre">Property('repository',</span> <span class="pre">'url://default/repo/path')</span></code> as repository.
This grabs the repository from the source stamp of the build.
This can be a security issue, if you allow force builds from the web, or have the <code class="xref py py-class docutils literal notranslate"><span class="pre">WebStatus</span></code> change hooks enabled; as the worker will download code from an arbitrary repository.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code></dt>
<dd>This specifies which codebase the source step should use to select the right source stamp.
The default codebase value is <code class="docutils literal notranslate"><span class="pre">''</span></code>.
The codebase must correspond to a codebase assigned by the <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">codebaseGenerator</span></code></a>.
If there is no codebaseGenerator defined in the master then codebase doesn’t need to be set, the default value will then match all changes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt>
<dd>Specifies the timeout for worker-side operations, in seconds.
If your repositories are particularly large, then you may need to increase this  value from its default of 1200 (20 minutes).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt>
<dd>If this option is true (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set <code class="docutils literal notranslate"><span class="pre">logEnviron=False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt>
<dd>a dictionary of environment strings which will be added to the child command’s environment.
The usual property interpolations can be used in environment variable names and values - see <a class="reference internal" href="#properties"><span class="std std-ref">Properties</span></a>.</dd>
</dl>
</div>
<div class="section" id="mercurial">
<span id="step-mercurial"></span><span id="step-Mercurial"></span><h6><a class="toc-backref" href="#id23">Mercurial</a><a class="headerlink" href="#mercurial" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.mercurial.Mercurial">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.mercurial.</code><code class="descname">Mercurial</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.mercurial.Mercurial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-Mercurial" title="Mercurial"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Mercurial</span></code></a> build step performs a <a class="reference external" href="https://www.mercurial-scm.org/">Mercurial</a> (aka <code class="docutils literal notranslate"><span class="pre">hg</span></code>) checkout or update.</p>
<p>Branches are available in two modes: <code class="docutils literal notranslate"><span class="pre">dirname</span></code>, where the name of the branch is a suffix of the name of the repository, or <code class="docutils literal notranslate"><span class="pre">inrepo</span></code>, which uses Hg’s named-branches support.
Make sure this setting matches your changehook, if you have that installed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Mercurial</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;fresh&#39;</span><span class="p">,</span> <span class="n">branchType</span><span class="o">=</span><span class="s1">&#39;inrepo&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The Mercurial step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd>where the Mercurial source repository is available.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code></dt>
<dd>this specifies the name of the branch to use when a Build does not provide one of its own.
This will be appended to <code class="docutils literal notranslate"><span class="pre">repourl</span></code> to create the string that will be passed to the <code class="docutils literal notranslate"><span class="pre">hg</span> <span class="pre">clone</span></code> command.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branchType</span></code></dt>
<dd>either ‘dirname’ (default) or ‘inrepo’ depending on whether the branch name should be appended to the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> or the branch is a Mercurial named branch and can be found within the <code class="docutils literal notranslate"><span class="pre">repourl</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clobberOnBranchChange</span></code></dt>
<dd>boolean, defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
If set and using inrepos branches, clobber the tree at each branch change.
Otherwise, just update to the branch.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>Mercurial’s incremental mode does not require a method.
The full mode has three methods defined:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt>
<dd>It removes the build directory entirely then makes full clone from repo.
This can be slow as it need to clone whole repository</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt>
<dd>This remove all other files except those tracked by VCS.
First it does <strong class="command">hg purge --all</strong> then pull/update</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt>
<dd>All the files which are tracked by Mercurial and listed ignore files are not deleted.
Remaining all other files will be deleted before pull/update.
This is equivalent to <strong class="command">hg purge</strong> then pull/update.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="git">
<span id="step-git"></span><span id="step-Git"></span><h6><a class="toc-backref" href="#id24">Git</a><a class="headerlink" href="#git" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.git.Git">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.git.</code><code class="descname">Git</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.git.Git" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> build step clones or updates a <a class="reference external" href="http://git.or.cz/">Git</a> repository and checks out the specified branch or revision.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Buildbot supports Git version 1.2.0 and later: earlier versions (such as the one shipped in Ubuntu ‘Dapper’) do not support the <strong class="command">git init</strong> command that the Buildbot uses.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Git</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;git://path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                          <span class="n">method</span><span class="o">=</span><span class="s1">&#39;clobber&#39;</span><span class="p">,</span> <span class="n">submodules</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<p>The Git step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code> (required)</dt>
<dd>The URL of the upstream Git repository.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code> (optional)</dt>
<dd>This specifies the name of the branch or the tag to use when a Build does not provide one of its own.
If this parameter is not specified, and the Build does not provide a branch, the default branch of the remote repository will be used.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">submodules</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</dt>
<dd>When initializing/updating a Git repository, this tells Buildbot whether to handle Git submodules.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">shallow</span></code> (optional)</dt>
<dd>Instructs Git to attempt shallow clones (<code class="docutils literal notranslate"><span class="pre">--depth</span> <span class="pre">1</span></code>).
The depth defaults to 1 and can be changed by passing an integer instead of <code class="docutils literal notranslate"><span class="pre">True</span></code>.
This option can be used only in full builds with clobber method.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">reference</span></code> (optional)</dt>
<dd>Use the specified string as a path to a reference repository on the local machine.
Git will try to grab objects from this path first instead of the main repository, if they exist.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">origin</span></code> (optional)</dt>
<dd>By default, any clone will use the name “origin” as the remote repository (eg, “origin/master”).
This renderable option allows that to be configured to an alternate name.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">progress</span></code> (optional)</dt>
<dd>Passes the (<code class="docutils literal notranslate"><span class="pre">--progress</span></code>) flag to (<strong class="command">git fetch</strong>).
This solves issues of long fetches being killed due to lack of output, but requires Git 1.7.2 or later.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">retryFetch</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</dt>
<dd>If true, if the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">fetch</span></code> fails then Buildbot retries to fetch again instead of failing the entire source checkout.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clobberOnFailure</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">False</span></code>)</dt>
<dd>If a fetch or full clone fails we can checkout source removing everything.
This way new repository will be cloned.
If retry fails it fails the source checkout step.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">'incremental'</span></code>)</dt>
<dd><p class="first">Specifies whether to clean the build tree or not.</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">incremental</span></code></dt>
<dd>The source is update, but any built files are left untouched.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">full</span></code></dt>
<dd>The build tree is clean of any built files.
The exact method for doing this is controlled by the <code class="docutils literal notranslate"><span class="pre">method</span></code> argument.</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">method</span></code> (optional, default: <code class="docutils literal notranslate"><span class="pre">fresh</span></code> when mode is <code class="docutils literal notranslate"><span class="pre">full</span></code>)</dt>
<dd><p class="first">Git’s incremental mode does not require a method.
The full mode has four methods defined:</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt>
<dd>It removes the build directory entirely then makes full clone from repo.
This can be slow as it need to clone whole repository.
To make faster clones enable <code class="docutils literal notranslate"><span class="pre">shallow</span></code> option.
If shallow options is enabled and build request have unknown revision value, then this step fails.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt>
<dd>This remove all other files except those tracked by Git.
First it does <strong class="command">git clean -d -f -f -x</strong> then fetch/checkout to a specified revision(if any).
This option is equal to update mode with <code class="docutils literal notranslate"><span class="pre">ignore_ignores=True</span></code> in old steps.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt>
<dd>All the files which are tracked by Git and listed ignore files are not deleted.
Remaining all other files will be deleted before fetch/checkout.
This is equivalent to <strong class="command">git clean -d -f -f</strong> then fetch.
This is equivalent to <code class="docutils literal notranslate"><span class="pre">ignore_ignores=False</span></code> in old steps.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt>
<dd>This first checkout source into source directory then copy the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory then performs the build operation in the copied directory.
This way we make fresh builds with very less bandwidth to download source.
The behavior of source checkout follows exactly same as incremental.
It performs all the incremental checkout behavior in <code class="docutils literal notranslate"><span class="pre">source</span></code> directory.</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">getDescription</span></code> (optional)</dt>
<dd><p class="first">After checkout, invoke a <cite>git describe</cite> on the revision and save the result in a property; the property’s name is either <code class="docutils literal notranslate"><span class="pre">commit-description</span></code> or <code class="docutils literal notranslate"><span class="pre">commit-description-foo</span></code>, depending on whether the <code class="docutils literal notranslate"><span class="pre">codebase</span></code> argument was also provided.
The argument should either be a <code class="docutils literal notranslate"><span class="pre">bool</span></code> or <code class="docutils literal notranslate"><span class="pre">dict</span></code>, and will change how <cite>git describe</cite> is called:</p>
<ul class="last">
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">getDescription=False</span></code>: disables this feature explicitly</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">getDescription=True</span></code> or empty <code class="docutils literal notranslate"><span class="pre">dict()</span></code>: Run <cite>git describe</cite> with no args</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">getDescription={...}</span></code>: a dict with keys named the same as the Git option.
Each key’s value can be <code class="docutils literal notranslate"><span class="pre">False</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code> to explicitly skip that argument.</p>
<p>For the following keys, a value of <code class="docutils literal notranslate"><span class="pre">True</span></code> appends the same-named Git argument:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">all</span></code> : <cite>–all</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">always</span></code>: <cite>–always</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">contains</span></code>: <cite>–contains</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">debug</span></code>: <cite>–debug</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">long</span></code>: <cite>–long`</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">exact-match</span></code>: <cite>–exact-match</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">tags</span></code>: <cite>–tags</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">dirty</span></code>: <cite>–dirty</cite></li>
</ul>
</div></blockquote>
<p>For the following keys, an integer or string value (depending on what Git expects) will set the argument’s parameter appropriately.
Examples show the key-value pair:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">match=foo</span></code>: <cite>–match foo</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">abbrev=7</span></code>: <cite>–abbrev=7</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">candidates=7</span></code>: <cite>–candidates=7</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">dirty=foo</span></code>: <cite>–dirty=foo</cite></li>
</ul>
</div></blockquote>
</li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code> (optional)</dt>
<dd>A dict of Git configuration settings to pass to the remote Git commands.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sshPrivateKey</span></code> (optional)</dt>
<dd>The private key to use when running Git for fetch operations.
The ssh utility must be in the system path in order to use this option.
On Windows only Git distribution that embeds MINGW has been tested (as of July 2017 the official distribution is MINGW-based).
The worker must either have the host in the known hosts file or the host key must be specified via the <cite>sshHostKey</cite> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sshHostKey</span></code> (optional)</dt>
<dd>Specifies public host key to match when authenticating with SSH public key authentication.
This may be either a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a> or just a string.
<cite>sshPrivateKey</cite> must be specified in order to use this option.
The host key must be in the form of <cite>&lt;key type&gt; &lt;base64-encoded string&gt;</cite>, e.g. <cite>ssh-rsa AAAAB3N&lt;…&gt;FAaQ==</cite>.</dd>
</dl>
</div>
<div class="section" id="svn">
<span id="step-svn"></span><span id="step-SVN"></span><h6><a class="toc-backref" href="#id25">SVN</a><a class="headerlink" href="#svn" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.svn.SVN">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.svn.</code><code class="descname">SVN</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.svn.SVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> build step performs a <a class="reference external" href="http://subversion.tigris.org">Subversion</a> checkout or update.
There are two basic ways of setting up the checkout step, depending upon whether you are using multiple branches or not.</p>
<p>The <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> step should be created with the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> argument:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd>(required): this specifies the <code class="docutils literal notranslate"><span class="pre">URL</span></code> argument that will be given to the <strong class="command">svn checkout</strong> command.
It dictates both where the repository is located and which sub-tree should be extracted.
One way to specify the branch is to use <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code>.
For example, if you wanted to check out the trunk repository, you could use <code class="docutils literal notranslate"><span class="pre">repourl=Interpolate(&quot;http://svn.example.com/repos/%(src::branch)s&quot;)</span></code>.
Alternatively, if you are using a remote Subversion repository which is accessible through HTTP at a URL of <code class="docutils literal notranslate"><span class="pre">http://svn.example.com/repos</span></code>, and you wanted to check out the <code class="docutils literal notranslate"><span class="pre">trunk/calc</span></code> sub-tree, you would directly use <code class="docutils literal notranslate"><span class="pre">repourl=&quot;http://svn.example.com/repos/trunk/calc&quot;</span></code> as an argument to your <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> step.</dd>
</dl>
<p>If you are building from multiple branches, then you should create the <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> step with the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> and provide branch information with <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
                <span class="n">repourl</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;svn://svn.example.org/svn/%(src::branch)s/myproject&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<p>Alternatively, the <code class="docutils literal notranslate"><span class="pre">repourl</span></code> argument can be used to create the <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> step without <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span>
                <span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;svn://svn.example.org/svn/myproject/trunk&#39;</span><span class="p">))</span>
</pre></div>
</div>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">username</span></code></dt>
<dd>(optional): if specified, this will be passed to the <code class="docutils literal notranslate"><span class="pre">svn</span></code> binary with a <code class="docutils literal notranslate"><span class="pre">--username</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt>
<dd>(optional): if specified, this will be passed to the <code class="docutils literal notranslate"><span class="pre">svn</span></code> binary with a <code class="docutils literal notranslate"><span class="pre">--password</span></code> option.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extra_args</span></code></dt>
<dd>(optional): if specified, an array of strings that will be passed as extra arguments to the <code class="docutils literal notranslate"><span class="pre">svn</span></code> binary.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">keep_on_purge</span></code></dt>
<dd>(optional): specific files or directories to keep between purges, like some build outputs that can be reused between builds.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">depth</span></code></dt>
<dd><p class="first">(optional): Specify depth argument to achieve sparse checkout.
Only available if worker has Subversion 1.5 or higher.</p>
<p class="last">If set to <code class="docutils literal notranslate"><span class="pre">empty</span></code> updates will not pull in any files or subdirectories not already present.
If set to <code class="docutils literal notranslate"><span class="pre">files</span></code>, updates will pull in any files not already present, but not directories.
If set to <code class="docutils literal notranslate"><span class="pre">immediates</span></code>, updates will pull in any files or subdirectories not already present, the new subdirectories will have depth: empty.
If set to <code class="docutils literal notranslate"><span class="pre">infinity</span></code>, updates will pull in any files or subdirectories not already present; the new subdirectories will have depth-infinity.
Infinity is equivalent to SVN default update behavior, without specifying any depth argument.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">preferLastChangedRev</span></code></dt>
<dd>(optional): By default, the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property is set to the repository’s global revision (“Revision” in the <cite>svn info</cite> output).
Set this parameter to <code class="docutils literal notranslate"><span class="pre">True</span></code> to have it set to the “Last Changed Rev” instead.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>SVN’s incremental mode does not require a method.
The full mode has five methods defined:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt>
<dd>It removes the working directory for each build then makes full checkout.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt>
<dd>This always always purges local changes before updating.
This deletes unversioned files and reverts everything that would appear in a <strong class="command">svn status --no-ignore</strong>.
This is equivalent to the old update mode with <code class="docutils literal notranslate"><span class="pre">always_purge</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt>
<dd>This is same as fresh except that it deletes all unversioned files generated by <strong class="command">svn status</strong>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt>
<dd>This first checkout source into source directory then copy the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory then performs the build operation in the copied directory.
This way we make fresh builds with very less bandwidth to download source.
The behavior of source checkout follows exactly same as incremental.
It performs all the incremental checkout behavior in <code class="docutils literal notranslate"><span class="pre">source</span></code> directory.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">export</span></code></dt>
<dd>Similar to <code class="docutils literal notranslate"><span class="pre">method='copy'</span></code>, except using <code class="docutils literal notranslate"><span class="pre">svn</span> <span class="pre">export</span></code> to create build directory so that there are no <code class="docutils literal notranslate"><span class="pre">.svn</span></code> directories in the build directory.</dd>
</dl>
</div></blockquote>
<p>If you are using branches, you must also make sure your <code class="docutils literal notranslate"><span class="pre">ChangeSource</span></code> will report the correct branch names.</p>
</div>
<div class="section" id="cvs">
<span id="step-cvs"></span><span id="step-CVS"></span><h6><a class="toc-backref" href="#id26">CVS</a><a class="headerlink" href="#cvs" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.cvs.CVS">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.cvs.</code><code class="descname">CVS</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.cvs.CVS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-CVS" title="CVS"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">CVS</span></code></a> build step performs a <a class="reference external" href="http://www.nongnu.org/cvs/">CVS</a> checkout or update.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">CVS</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
                <span class="n">cvsroot</span><span class="o">=</span><span class="s1">&#39;:pserver:me@cvs.example.net:/cvsroot/myproj&#39;</span><span class="p">,</span>
                <span class="n">cvsmodule</span><span class="o">=</span><span class="s1">&#39;buildbot&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">cvsroot</span></code></dt>
<dd>(required): specify the CVSROOT value, which points to a CVS repository, probably on a remote machine.
For example, if Buildbot was hosted in CVS then the CVSROOT value you would use to get a copy of the Buildbot source code might be <code class="docutils literal notranslate"><span class="pre">:pserver:anonymous&#64;cvs.example.net:/cvsroot/buildbot</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cvsmodule</span></code></dt>
<dd>(required): specify the cvs <code class="docutils literal notranslate"><span class="pre">module</span></code>, which is generally a subdirectory of the <code class="file docutils literal notranslate"><span class="pre">CVSROOT</span></code>.
The cvsmodule for the Buildbot source code is <code class="docutils literal notranslate"><span class="pre">buildbot</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>a string which will be used in a <code class="docutils literal notranslate"><span class="pre">-r</span></code> argument.
This is most useful for specifying a branch to work on.
Defaults to <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">global_options</span></code></dt>
<dd>a list of flags to be put before the argument <code class="docutils literal notranslate"><span class="pre">checkout</span></code> in the CVS command.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extra_options</span></code></dt>
<dd>a list of flags to be put after the <code class="docutils literal notranslate"><span class="pre">checkout</span></code> in the CVS command.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>No method is needed for incremental mode.
For full mode, <code class="docutils literal notranslate"><span class="pre">method</span></code> can take the values shown below.
If no value is given, it defaults to <code class="docutils literal notranslate"><span class="pre">fresh</span></code>.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt>
<dd>This specifies to remove the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> and make a full checkout.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt>
<dd>This method first runs <code class="docutils literal notranslate"><span class="pre">cvsdisard</span></code> in the build directory, then updates it.
This requires <code class="docutils literal notranslate"><span class="pre">cvsdiscard</span></code> which is a part of the cvsutil package.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt>
<dd>This method is the same as <code class="docutils literal notranslate"><span class="pre">method='fresh'</span></code>, but it runs <code class="docutils literal notranslate"><span class="pre">cvsdiscard</span> <span class="pre">--ignore</span></code> instead of <code class="docutils literal notranslate"><span class="pre">cvsdiscard</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt>
<dd>This maintains a <code class="docutils literal notranslate"><span class="pre">source</span></code> directory for source, which it updates copies to the build directory.
This allows Buildbot to start with a fresh directory, without downloading the entire repository on every build.</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">login</span></code></dt>
<dd>Password to use while performing login to the remote CVS server.
Default is <code class="docutils literal notranslate"><span class="pre">None</span></code> meaning that no login needs to be performed.</dd>
</dl>
</div>
<div class="section" id="bzr">
<span id="step-bzr"></span><span id="step-Bzr"></span><h6><a class="toc-backref" href="#id27">Bzr</a><a class="headerlink" href="#bzr" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.bzr.Bzr">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.bzr.</code><code class="descname">Bzr</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.bzr.Bzr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://bazaar.canonical.com/en/">bzr</a> is a descendant of Arch/Baz, and is frequently referred to as simply <cite>Bazaar</cite>.
The repository-vs-workspace model is similar to Darcs, but it uses a strictly linear sequence of revisions (one history per branch) like Arch.
Branches are put in subdirectories.
This makes it look very much like Mercurial.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Bzr</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">,</span>
                          <span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;lp:~knielsen/maria/tmp-buildbot-test&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd>(required unless <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> is provided): the URL at which the Bzr source repository is available.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">baseURL</span></code></dt>
<dd>(required unless <code class="docutils literal notranslate"><span class="pre">repourl</span></code> is provided): the base repository URL, to which a branch name will be appended.
It should probably end in a slash.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">defaultBranch</span></code></dt>
<dd>(allowed if and only if <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> is provided): this specifies the name of the branch to use when a Build does not provide one of its own.
This will be appended to <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> to create the string that will be passed to the <code class="docutils literal notranslate"><span class="pre">bzr</span> <span class="pre">checkout</span></code> command.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code>
<code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>No method is needed for incremental mode.
For full mode, <code class="docutils literal notranslate"><span class="pre">method</span></code> can take the values shown below.
If no value is given, it defaults to <code class="docutils literal notranslate"><span class="pre">fresh</span></code>.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt>
<dd>This specifies to remove the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> and make a full checkout.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt>
<dd>This method first runs <code class="docutils literal notranslate"><span class="pre">bzr</span> <span class="pre">clean-tree</span></code> to remove all the unversioned files then <code class="docutils literal notranslate"><span class="pre">update</span></code> the repo.
This remove all unversioned files including those in .bzrignore.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt>
<dd>This is same as fresh except that it doesn’t remove the files mentioned in <code class="file docutils literal notranslate"><span class="pre">.bzrginore</span></code> i.e, by running <code class="docutils literal notranslate"><span class="pre">bzr</span> <span class="pre">clean-tree</span> <span class="pre">--ignore</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt>
<dd>A local bzr repository is maintained and the repo is copied to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory for each build.
Before each build the local bzr repo is updated then copied to <code class="docutils literal notranslate"><span class="pre">build</span></code> for next steps.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="p4">
<span id="step-P4"></span><h6><a class="toc-backref" href="#id28">P4</a><a class="headerlink" href="#p4" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.p4.P4">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.p4.</code><code class="descname">P4</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.p4.P4" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-P4" title="P4"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">P4</span></code></a> build step creates a <a class="reference external" href="http://www.perforce.com/">Perforce</a> client specification and performs an update.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">P4</span><span class="p">(</span><span class="n">p4port</span><span class="o">=</span><span class="n">p4port</span><span class="p">,</span>
                         <span class="n">p4client</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">WithProperties</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(P4USER)s</span><span class="s1">-</span><span class="si">%(workername)s</span><span class="s1">-</span><span class="si">%(buildername)s</span><span class="s1">&#39;</span><span class="p">),</span>
                         <span class="n">p4user</span><span class="o">=</span><span class="n">p4user</span><span class="p">,</span>
                         <span class="n">p4base</span><span class="o">=</span><span class="s1">&#39;//depot&#39;</span><span class="p">,</span>
                         <span class="n">p4viewspec</span><span class="o">=</span><span class="n">p4viewspec</span><span class="p">,</span>
                         <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;incremental&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>You can specify the client spec in two different ways.
You can use the <code class="docutils literal notranslate"><span class="pre">p4base</span></code>, <code class="docutils literal notranslate"><span class="pre">p4branch</span></code>, and (optionally) <code class="docutils literal notranslate"><span class="pre">p4extra_views</span></code> to build up the viewspec, or you can utilize the <code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code> to specify the whole viewspec as a set of tuples.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code> will allow you to add lines such as:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//depot/branch/mybranch/...             //&lt;p4client&gt;/...
-//depot/branch/mybranch/notthisdir/... //&lt;p4client&gt;/notthisdir/...
</pre></div>
</div>
<p>If you specify <code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code> and any of <code class="docutils literal notranslate"><span class="pre">p4base</span></code>, <code class="docutils literal notranslate"><span class="pre">p4branch</span></code>, and/or <code class="docutils literal notranslate"><span class="pre">p4extra_views</span></code> you will receive a configuration error exception.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">p4base</span></code></dt>
<dd>A view into the Perforce depot without branch name or trailing <code class="docutils literal notranslate"><span class="pre">/...</span></code>.
Typically <code class="docutils literal notranslate"><span class="pre">//depot/proj</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4branch</span></code></dt>
<dd>(optional): A single string, which is appended to the p4base as follows <code class="docutils literal notranslate"><span class="pre">&lt;p4base&gt;/&lt;p4branch&gt;/...</span></code> to form the first line in the viewspec</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4extra_views</span></code></dt>
<dd>(optional): a list of <code class="docutils literal notranslate"><span class="pre">(depotpath,</span> <span class="pre">clientpath)</span></code> tuples containing extra views to be mapped into the client specification.
Both will have <code class="docutils literal notranslate"><span class="pre">/...</span></code> appended automatically.
The client name and source directory will be prepended to the client path.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code></dt>
<dd><p class="first">This will override any p4branch, p4base, and/or p4extra_views specified.
The viewspec will be an array of tuples as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;//depot/main/&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>It yields a viewspec with just:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>//depot/main/... //&lt;p4client&gt;/...
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4viewspec_suffix</span></code></dt>
<dd><p class="first">(optional): The <code class="docutils literal notranslate"><span class="pre">p4viewspec</span></code> lets you customize the client spec for a builder but, as the previous example shows, it automatically adds <code class="docutils literal notranslate"><span class="pre">...</span></code> at the end of each line.
If you need to also specify file-level remappings, you can set the <code class="docutils literal notranslate"><span class="pre">p4viewspec_suffix</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> so that nothing is added to your viewspec:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="s1">&#39;//depot/main/...&#39;</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;-//depot/main/config.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;config.xml&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="s1">&#39;//depot/main/config.vancouver.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;config.xml&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>It yields a viewspec with:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//depot/main/...                  //&lt;p4client&gt;/...
-//depot/main/config.xml          //&lt;p4client/main/config.xml
//depot/main/config.vancouver.xml //&lt;p4client&gt;/main/config.xml
</pre></div>
</div>
<p class="last">Note how, with <code class="docutils literal notranslate"><span class="pre">p4viewspec_suffix</span></code> set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, you need to manually add <code class="docutils literal notranslate"><span class="pre">...</span></code> where you need it.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4client_spec_options</span></code></dt>
<dd>(optional): By default, clients are created with the <code class="docutils literal notranslate"><span class="pre">allwrite</span> <span class="pre">rmdir</span></code> options.
This string lets you change that.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4port</span></code></dt>
<dd>(optional): the <code class="samp docutils literal notranslate"><em><span class="pre">host</span></em><span class="pre">:</span><em><span class="pre">port</span></em></code> string describing how to get to the P4 Depot (repository), used as the option <cite>-p</cite> argument for all p4 commands.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4user</span></code></dt>
<dd>(optional): the Perforce user, used as the option <cite>-u</cite> argument to all p4 commands.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4passwd</span></code></dt>
<dd>(optional): the Perforce password, used as the option <cite>-p</cite> argument to all p4 commands.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4client</span></code></dt>
<dd>(optional): The name of the client to use.
In <code class="docutils literal notranslate"><span class="pre">mode='full'</span></code> and <code class="docutils literal notranslate"><span class="pre">mode='incremental'</span></code>, it’s particularly important that a unique name is used for each checkout directory to avoid incorrect synchronization.
For this reason, Python percent substitution will be performed on this value to replace <code class="docutils literal notranslate"><span class="pre">%(prop:workername)s</span></code> with the worker name and <code class="docutils literal notranslate"><span class="pre">%(prop:buildername)s</span></code> with the builder name.
The default is <code class="docutils literal notranslate"><span class="pre">buildbot_%(prop:workername)s_%(prop:buildername)s</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4line_end</span></code></dt>
<dd>(optional): The type of line ending handling P4 should use.
This is added directly to the client spec’s <code class="docutils literal notranslate"><span class="pre">LineEnd</span></code> property.
The default is <code class="docutils literal notranslate"><span class="pre">local</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">p4extra_args</span></code></dt>
<dd><p class="first">(optional): Extra arguments to be added to the P4 command-line for the <code class="docutils literal notranslate"><span class="pre">sync</span></code> command.
So for instance if you want to sync only to populate a Perforce proxy (without actually syncing files to disk), you can do:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">P4</span><span class="p">(</span><span class="n">p4extra_args</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;-Zproxyload&#39;</span><span class="p">],</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">use_tickets</span></code></dt>
<dd>Set to <code class="docutils literal notranslate"><span class="pre">True</span></code> to use ticket-based authentication, instead of passwords (but you still need to specify <code class="docutils literal notranslate"><span class="pre">p4passwd</span></code>).</dd>
</dl>
<span class="target" id="index-15"></span></div>
<div class="section" id="repo">
<span id="step-Repo"></span><h6><a class="toc-backref" href="#id29">Repo</a><a class="headerlink" href="#repo" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.repo.Repo">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.repo.</code><code class="descname">Repo</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.repo.Repo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-Repo" title="Repo"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Repo</span></code></a> build step performs a <a class="reference external" href="http://lwn.net/Articles/304488/">Repo</a> init and sync.</p>
<p>The Repo step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">manifestURL</span></code></dt>
<dd>(required): the URL at which the Repo’s manifests source repository is available.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">manifestBranch</span></code></dt>
<dd>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">master</span></code>): the manifest repository branch on which repo will take its manifest.
Corresponds to the <code class="docutils literal notranslate"><span class="pre">-b</span></code> argument to the <strong class="command">repo init</strong> command.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">manifestFile</span></code></dt>
<dd>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">default.xml</span></code>): the manifest filename.
Corresponds to the <code class="docutils literal notranslate"><span class="pre">-m</span></code> argument to the <strong class="command">repo init</strong> command.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tarball</span></code></dt>
<dd><p class="first">(optional, defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>): the repo tarball used for fast bootstrap.
If not present the tarball will be created automatically after first sync.
It is a copy of the <code class="docutils literal notranslate"><span class="pre">.repo</span></code> directory which contains all the Git objects.
This feature helps to minimize network usage on very big projects with lots of workers.</p>
<p class="last">The suffix of the tarball determines if the tarball is compressed and which compressor is chosen.
Supported suffixes are <code class="docutils literal notranslate"><span class="pre">bz2</span></code>, <code class="docutils literal notranslate"><span class="pre">gz</span></code>, <code class="docutils literal notranslate"><span class="pre">lzma</span></code>, <code class="docutils literal notranslate"><span class="pre">lzop</span></code>, and <code class="docutils literal notranslate"><span class="pre">pigz</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">jobs</span></code></dt>
<dd>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>): Number of projects to fetch simultaneously while syncing.
Passed to repo sync subcommand with “-j”.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">syncAllBranches</span></code></dt>
<dd>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>): renderable boolean to control whether <code class="docutils literal notranslate"><span class="pre">repo</span></code> syncs all branches.
I.e. <code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">sync</span> <span class="pre">-c</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">depth</span></code></dt>
<dd>(optional, defaults to 0): Depth argument passed to repo init.
Specifies the amount of git history to store.
A depth of 1 is useful for shallow clones.
This can save considerable disk space on very large projects.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">updateTarballAge</span></code></dt>
<dd>(optional, defaults to “one week”): renderable to control the policy of updating of the tarball given properties.
Returns: max age of tarball in seconds, or <code class="docutils literal notranslate"><span class="pre">None</span></code>, if we want to skip tarball update.
The default value should be good trade off on size of the tarball, and update frequency compared to cost of tarball creation</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repoDownloads</span></code></dt>
<dd><p class="first">(optional, defaults to None): list of <code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">download</span></code> commands to perform at the end of the Repo step each string in the list will be prefixed <code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">download</span></code>, and run as is.
This means you can include parameter in the string.
For example:</p>
<ul class="last simple">
<li><code class="docutils literal notranslate"><span class="pre">[&quot;-c</span> <span class="pre">project</span> <span class="pre">1234/4&quot;]</span></code> will cherry-pick patchset 4 of patch 1234 in project <code class="docutils literal notranslate"><span class="pre">project</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">[&quot;-f</span> <span class="pre">project</span> <span class="pre">1234/4&quot;]</span></code> will enforce fast-forward on patchset 4 of patch 1234 in project <code class="docutils literal notranslate"><span class="pre">project</span></code></li>
</ul>
</dd>
</dl>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.repo.RepoDownloadsFromProperties">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.repo.</code><code class="descname">RepoDownloadsFromProperties</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.repo.RepoDownloadsFromProperties" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">util.repo.DownloadsFromProperties</span></code> can be used as a renderable of the <code class="docutils literal notranslate"><span class="pre">repoDownload</span></code> parameter it will look in passed properties for string with following possible format:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">repo</span> <span class="pre">download</span> <span class="pre">project</span> <span class="pre">change_number/patchset_number</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">project</span> <span class="pre">change_number/patchset_number</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">project/change_number/patchset_number</span></code></li>
</ul>
<p>All of these properties will be translated into a <strong class="command">repo download</strong>.
This feature allows integrators to build with several pending interdependent changes, which at the moment cannot be described properly in Gerrit, and can only be described by humans.</p>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.repo.RepoDownloadsFromChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.repo.</code><code class="descname">RepoDownloadsFromChangeSource</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.repo.RepoDownloadsFromChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">util.repo.DownloadsFromChangeSource</span></code> can be used as a renderable of the <code class="docutils literal notranslate"><span class="pre">repoDownload</span></code> parameter</p>
<p>This rendereable integrates with <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a>, and will automatically use the <strong class="command">repo download</strong> command of repo to download the additional changes introduced by a pending changeset.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can use the two above Rendereable in conjunction by using the class <code class="docutils literal notranslate"><span class="pre">buildbot.process.properties.FlattenList</span></code></p>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Repo</span><span class="p">(</span><span class="n">manifestURL</span><span class="o">=</span><span class="s1">&#39;git://gerrit.example.org/manifest.git&#39;</span><span class="p">,</span>
                           <span class="n">repoDownloads</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">([</span>
                                <span class="n">util</span><span class="o">.</span><span class="n">RepoDownloadsFromChangeSource</span><span class="p">(),</span>
                                <span class="n">util</span><span class="o">.</span><span class="n">RepoDownloadsFromProperties</span><span class="p">(</span><span class="s2">&quot;repo_downloads&quot;</span><span class="p">)</span>
                           <span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="section" id="gerrit">
<span id="step-gerrit"></span><span id="step-Gerrit"></span><h6><a class="toc-backref" href="#id30">Gerrit</a><a class="headerlink" href="#gerrit" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.gerrit.Gerrit">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.gerrit.</code><code class="descname">Gerrit</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.gerrit.Gerrit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#step-Gerrit" title="Gerrit"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Gerrit</span></code></a> step is exactly like the <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> step, except that it integrates with <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a>, and will automatically checkout the additional changes.</p>
<p>Gerrit integration can be also triggered using forced build with property named <code class="docutils literal notranslate"><span class="pre">gerrit_change</span></code> with values in format <code class="docutils literal notranslate"><span class="pre">change_number/patchset_number</span></code>.
This property will be translated into a branch name.
This feature allows integrators to build with several pending interdependent changes, which at the moment cannot be described properly in Gerrit, and can only be described by humans.</p>
</div>
<div class="section" id="github">
<span id="step-github"></span><span id="step-GitHub"></span><h6><a class="toc-backref" href="#id31">GitHub</a><a class="headerlink" href="#github" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.github.GitHub">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.github.</code><code class="descname">GitHub</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.github.GitHub" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#step-GitHub" title="GitHub"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitHub</span></code></a> step is exactly like the <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> step, except that it will ignore the revision sent by <a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> change hook, and rather take the branch if the branch ends with /merge.</p>
<p>This allows to test github pull requests merged directly into the mainline.</p>
<p>GitHub indeed provides <code class="docutils literal notranslate"><span class="pre">refs/origin/pull/NNN/merge</span></code> on top of <code class="docutils literal notranslate"><span class="pre">refs/origin/pull/NNN/head</span></code> which is a magic ref that always create a merge commit to the latest version of the mainline (i.e. the target branch for the pull request).</p>
<p>The revision in the GitHub event points to <code class="docutils literal notranslate"><span class="pre">/head</span></code> is important for the GitHub reporter as this is the revision that will be tagged with a CI status when the build is finished.</p>
<p>If you want to use  <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> to create sub tests and want to have the GitHub reporter still update the original revision, make sure you set <code class="docutils literal notranslate"><span class="pre">updateSourceStamp=False</span></code> in the <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> configuration.</p>
</div>
<div class="section" id="gitlab">
<span id="step-gitlab"></span><span id="step-GitLab"></span><h6><a class="toc-backref" href="#id32">GitLab</a><a class="headerlink" href="#gitlab" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.gitlab.GitLab">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.gitlab.</code><code class="descname">GitLab</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.gitlab.GitLab" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#step-GitLab" title="GitLab"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitLab</span></code></a> step is exactly like the <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> step, except that it uses the source repo and branch sent by the <a class="reference internal" href="#chsrc-GitLab" title="GitLab"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitLab</span></code></a> change hook when processing merge requests.</p>
<p>When configuring builders, you can use a ChangeFilter with <code class="docutils literal notranslate"><span class="pre">category</span> <span class="pre">=</span> <span class="pre">&quot;push&quot;</span></code>
to select normal commits, and <code class="docutils literal notranslate"><span class="pre">category</span> <span class="pre">=</span> <span class="pre">&quot;merge_request&quot;</span></code> to select merge requests.</p>
<p>See <code class="file docutils literal notranslate"><span class="pre">master/docs/examples/gitlab.cfg</span></code> in the Buildbot distribution
for a tutorial example of integrating Buildbot with GitLab.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your build worker will need access to the source project of the
changeset, or it won’t be able to check out the source.  This means
authenticating the build worker via ssh credentials in the usual
way, then granting it access [via a GitLab deploy key
or GitLab project membership](<a class="reference external" href="https://docs.gitlab.com/ee/ssh/">https://docs.gitlab.com/ee/ssh/</a>).
This needs to be done not only for the main git repo, but also for
each fork that wants to be able to submit merge requests against
the main repo.</p>
</div>
</div>
<div class="section" id="darcs">
<span id="step-darcs"></span><span id="step-Darcs"></span><h6><a class="toc-backref" href="#id33">Darcs</a><a class="headerlink" href="#darcs" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.darcs.Darcs">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.darcs.</code><code class="descname">Darcs</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.darcs.Darcs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-Darcs" title="Darcs"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Darcs</span></code></a> build step performs a <a class="reference external" href="http://darcs.net/">Darcs</a> checkout or update.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Darcs</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;http://path/to/repo&#39;</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;clobber&#39;</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>Darcs step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd>(required): The URL at which the Darcs source repository is available.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code></p>
<blockquote>
<div><p>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">'incremental'</span></code>.
Specifies whether to clean the build tree or not.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">incremental</span></code></dt>
<dd>The source is update, but any built files are left untouched.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">full</span></code></dt>
<dd>The build tree is clean of any built files.
The exact method for doing this is controlled by the <code class="docutils literal notranslate"><span class="pre">method</span></code> argument.</dd>
</dl>
</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">method</span></code></dt>
<dd><p class="first">(optional): defaults to <code class="docutils literal notranslate"><span class="pre">copy</span></code> when mode is <code class="docutils literal notranslate"><span class="pre">full</span></code>.
Darcs’ incremental mode does not require a method.
The full mode has two methods defined:</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt>
<dd>It removes the working directory for each build then makes full checkout.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt>
<dd>This first checkout source into source directory then copy the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory then performs the build operation in the copied directory.
This way we make fresh builds with very less bandwidth to download source.
The behavior of source checkout follows exactly same as incremental.
It performs all the incremental checkout behavior in <code class="docutils literal notranslate"><span class="pre">source</span></code> directory.</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="monotone">
<span id="step-monotone"></span><span id="step-Monotone"></span><h6><a class="toc-backref" href="#id34">Monotone</a><a class="headerlink" href="#monotone" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.mtn.Monotone">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.mtn.</code><code class="descname">Monotone</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.mtn.Monotone" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-Monotone" title="Monotone"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Monotone</span></code></a> build step performs a <a class="reference external" href="http://www.monotone.ca/">Monotone</a> checkout or update.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Monotone</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;http://path/to/repo&#39;</span><span class="p">,</span>
                               <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;full&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;clobber&#39;</span><span class="p">,</span>
                               <span class="n">branch</span><span class="o">=</span><span class="s1">&#39;some.branch.name&#39;</span><span class="p">,</span> <span class="n">retry</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
</pre></div>
</div>
<p>Monotone step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd>the URL at which the Monotone source repository is available.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>this specifies the name of the branch to use when a Build does not provide one of its own.
If <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the branch and revision information that comes with the Build is ignored and branch specified in this parameter is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">progress</span></code></dt>
<dd>this is a boolean that has a pull from the repository use <code class="docutils literal notranslate"><span class="pre">--ticker=dot</span></code> instead of the default <code class="docutils literal notranslate"><span class="pre">--ticker=none</span></code>.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code></p>
<blockquote>
<div><p>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">'incremental'</span></code>.
Specifies whether to clean the build tree or not.
In any case, the worker first pulls from the given remote repository
to synchronize (or possibly initialize) its local database. The mode
and method only affect how the build tree is checked-out or updated
from the local database.</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">incremental</span></code></dt>
<dd>The source is update, but any built files are left untouched.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">full</span></code></dt>
<dd>The build tree is clean of any built files.
The exact method for doing this is controlled by the <code class="docutils literal notranslate"><span class="pre">method</span></code> argument.
Even in this mode, the revisions already pulled remain in the database
and a fresh pull is rarely needed.</dd>
</dl>
</div></blockquote>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">method</span></code></p>
<blockquote>
<div><p>(optional): defaults to <code class="docutils literal notranslate"><span class="pre">copy</span></code> when mode is <code class="docutils literal notranslate"><span class="pre">full</span></code>.
Monotone’s incremental mode does not require a method.
The full mode has four methods defined:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">clobber</span></code></dt>
<dd>It removes the build directory entirely then makes fresh checkout from
the database.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">clean</span></code></dt>
<dd>This remove all other files except those tracked and ignored by Monotone.
It will remove all the files that appear in <strong class="command">mtn ls unknown</strong>.
Then it will pull from remote and update the working directory.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fresh</span></code></dt>
<dd>This remove all other files except those tracked by Monotone.
It will remove all the files that appear in <strong class="command">mtn ls ignored</strong> and <strong class="command">mtn ls unknows</strong>.
Then pull and update similar to <code class="docutils literal notranslate"><span class="pre">clean</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">copy</span></code></dt>
<dd>This first checkout source into source directory then copy the <code class="docutils literal notranslate"><span class="pre">source</span></code> directory to <code class="docutils literal notranslate"><span class="pre">build</span></code> directory then performs the build operation in the copied directory.
This way we make fresh builds with very less bandwidth to download source.
The behavior of source checkout follows exactly same as incremental.
It performs all the incremental checkout behavior in <code class="docutils literal notranslate"><span class="pre">source</span></code> directory.</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="other-source-operations">
<h5><a class="toc-backref" href="#id35">2.5.10.3. Other Source operations</a><a class="headerlink" href="#other-source-operations" title="Permalink to this headline">¶</a></h5>
<p>Currently the only non-checkout step that is related to version control is <code class="docutils literal notranslate"><span class="pre">GitPush</span></code>.</p>
<div class="section" id="gitpush">
<span id="step-GitPush"></span><h6><a class="toc-backref" href="#id36">GitPush</a><a class="headerlink" href="#gitpush" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.git.GitPush">
<em class="property">class </em><code class="descclassname">buildbot.steps.source.git.</code><code class="descname">GitPush</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.git.GitPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-GitPush" title="GitPush"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitPush</span></code></a> build step pushes new commits to a <a class="reference external" href="http://git.or.cz/">Git</a> repository.</p>
<p>The GitPush step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt>
<dd>(required) The path to the local repository to push commits from.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">repourl</span></code></dt>
<dd>(required) The URL of the upstream Git repository.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>(required) The branch to push.
The branch should already exist on the local repository.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">force</span></code></dt>
<dd>(optional) If <code class="docutils literal notranslate"><span class="pre">True</span></code>, forces overwrite of refs on the remote repository.
Corresponds to the <code class="docutils literal notranslate"><span class="pre">--force</span></code> flag of the <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> command.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt>
<dd>(optional) If this option is true (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set <code class="docutils literal notranslate"><span class="pre">logEnviron=False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt>
<dd>(optional) A dictionary of environment strings which will be added to the child command’s environment.
The usual property interpolations can be used in environment variable names and values - see <a class="reference internal" href="#properties"><span class="std std-ref">Properties</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt>
<dd>(optional) Specifies the timeout for worker-side operations, in seconds.
If your repositories are particularly large, then you may need to increase this  value from its default of 1200 (20 minutes).</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">config</span></code></p>
<blockquote>
<div>(optional) A dict of git configuration settings to pass to the remote git commands.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sshPrivateKey</span></code></p>
<blockquote>
<div>(optional) The private key to use when running git for fetch operations.
The ssh utility must be in the system path in order to use this option.
On Windows only git distribution that embeds MINGW has been tested (as of July 2017 the official distribution is MINGW-based).
The worker must either have the host in the known hosts file or the host key must be specified via the <code class="docutils literal notranslate"><span class="pre">sshHostKey</span></code> option.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">sshHostKey</span></code></p>
<blockquote>
<div>(optional) Specifies public host key to match when authenticating with SSH public key authentication.
This may be either a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a> or just a string.
<code class="docutils literal notranslate"><span class="pre">sshPrivateKey</span></code> must be specified in order to use this option.
The host key must be in the form of <code class="docutils literal notranslate"><span class="pre">&lt;key</span> <span class="pre">type&gt;</span> <span class="pre">&lt;base64-encoded</span> <span class="pre">string&gt;</span></code>, e.g. <code class="docutils literal notranslate"><span class="pre">ssh-rsa</span> <span class="pre">AAAAB3N&lt;...&gt;FAaQ==</span></code>.</div></blockquote>
</div>
</div>
<div class="section" id="shellcommand">
<span id="step-ShellCommand"></span><h5><a class="toc-backref" href="#id37">2.5.10.4. ShellCommand</a><a class="headerlink" href="#shellcommand" title="Permalink to this headline">¶</a></h5>
<p>Most interesting steps involve executing a process of some sort on the worker.
The <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> class handles this activity.</p>
<p>Several subclasses of <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> are provided as starting points for common build steps.</p>
<div class="section" id="using-shellcommands">
<h6><a class="toc-backref" href="#id38">Using ShellCommands</a><a class="headerlink" href="#using-shellcommands" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.ShellCommand">
<em class="property">class </em><code class="descclassname">buildbot.steps.shell.</code><code class="descname">ShellCommand</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.ShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is a useful base class for just about everything you might want to do during a build (except for the initial source checkout).
It runs a single command in a child shell on the worker.
All stdout/stderr is recorded into a <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code>.
The step usually finishes with a status of <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> if the command’s exit code is non-zero, otherwise it has a status of <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>.</p>
<p>The preferred way to specify the command is with a list of argv strings, since this allows for spaces in filenames and avoids doing any fragile shell-escaping.
You can also specify the command with a single string, in which case the string is given to <code class="samp docutils literal notranslate"><span class="pre">/bin/sh</span> <span class="pre">-c</span> <em><span class="pre">COMMAND</span></em></code> for parsing.</p>
<p>On Windows, commands are run via <code class="docutils literal notranslate"><span class="pre">cmd.exe</span> <span class="pre">/c</span></code> which works well.
However, if you’re running a batch file, the error level does not get propagated correctly unless you add ‘call’ before your batch file’s name: <code class="docutils literal notranslate"><span class="pre">cmd=['call',</span> <span class="pre">'myfile.bat',</span> <span class="pre">...]</span></code>.</p>
<p>The <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> arguments are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">command</span></code></dt>
<dd><p class="first">a list of strings (preferred) or single string (discouraged) which specifies the command to be run.
A list of strings is preferred because it can be used directly as an argv array.
Using a single string (with embedded spaces) requires the worker to pass the string to <strong class="command">/bin/sh</strong> for interpretation, which raises all sorts of difficult questions about how to escape or interpret shell metacharacters.</p>
<p class="last">If <code class="docutils literal notranslate"><span class="pre">command</span></code> contains nested lists (for example, from a properties substitution), then that list will be flattened before it is executed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt>
<dd><p class="first">All ShellCommands are run by default in the <code class="docutils literal notranslate"><span class="pre">workdir</span></code>, which defaults to the <code class="file docutils literal notranslate"><span class="pre">build</span></code> subdirectory of the worker builder’s base directory.
The absolute path of the workdir will thus be the worker’s basedir (set as an option to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code>, <a class="reference internal" href="#creating-a-worker"><span class="std std-ref">Creating a worker</span></a>) plus the builder’s basedir (set in the builder’s <code class="docutils literal notranslate"><span class="pre">builddir</span></code> key in <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code>) plus the workdir itself (a class-level attribute of the BuildFactory, defaults to <code class="file docutils literal notranslate"><span class="pre">build</span></code>).</p>
<p>For example:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;build/tests&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt>
<dd><p class="first">a dictionary of environment strings which will be added to the child command’s environment.
For example, to run tests with a different i18n language setting, you might use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;LANG&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">}))</span>
</pre></div>
</div>
<p>These variable settings will override any existing ones in the worker’s environment or the environment specified in the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.
The exception is <span class="target" id="index-16"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>, which is merged with (actually prepended to) any existing <span class="target" id="index-17"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> setting.
The following example will prepend <code class="file docutils literal notranslate"><span class="pre">/home/buildbot/lib/python</span></code> to any existing <span class="target" id="index-18"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">:</span> <span class="s2">&quot;/home/buildbot/lib/python&quot;</span><span class="p">}))</span>
</pre></div>
</div>
<p>To avoid the need of concatenating path together in the master config file, if the value is a list, it will be joined together using the right platform dependent separator.</p>
<p>Those variables support expansion so that if you just want to prepend <code class="file docutils literal notranslate"><span class="pre">/home/buildbot/bin</span></code> to the <span class="target" id="index-19"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> environment variable, you can do it by putting the value <code class="docutils literal notranslate"><span class="pre">${PATH}</span></code> at the end of the value like in the example below.
Variables that don’t exist on the worker will be replaced by <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PATH&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/home/buildbot/bin&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;$</span><span class="si">{PATH}</span><span class="s2">&quot;</span><span class="p">]}))</span>
</pre></div>
</div>
<p class="last">Note that environment values must be strings (or lists that are turned into strings).
In particular, numeric properties such as <code class="docutils literal notranslate"><span class="pre">buildnumber</span></code> must be substituted using <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">want_stdout</span></code></dt>
<dd>if <code class="docutils literal notranslate"><span class="pre">False</span></code>, stdout from the child process is discarded rather than being sent to the buildmaster for inclusion in the step’s <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">want_stderr</span></code></dt>
<dd>like <code class="docutils literal notranslate"><span class="pre">want_stdout</span></code> but for <code class="file docutils literal notranslate"><span class="pre">stderr</span></code>.
Note that commands run through a PTY do not have separate <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>/<code class="file docutils literal notranslate"><span class="pre">stderr</span></code> streams: both are merged into <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usePTY</span></code></dt>
<dd><p class="first">Should this command be run in a <code class="docutils literal notranslate"><span class="pre">pty</span></code>?
<code class="docutils literal notranslate"><span class="pre">False</span></code> by default.
This option is not available on Windows.</p>
<p>In general, you do not want to use a pseudo-terminal.
This is <em>only</em> useful for running commands that require a terminal - for example, testing a command-line application that will only accept passwords read from a terminal.
Using a pseudo-terminal brings lots of compatibility problems, and prevents Buildbot from distinguishing the standard error (red) and standard output (black) streams.</p>
<p>In previous versions, the advantage of using a pseudo-terminal was that <code class="docutils literal notranslate"><span class="pre">grandchild</span></code> processes were more likely to be cleaned up if the build was interrupted or times out.
This occurred because using a pseudo-terminal incidentally puts the command into its own process group.</p>
<p class="last">As of Buildbot-0.8.4, all commands are placed in process groups, and thus grandchild processes will be cleaned up properly.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logfiles</span></code></dt>
<dd><p class="first">Sometimes commands will log interesting data to a local file, rather than emitting everything to stdout or stderr.
For example, Twisted’s <strong class="command">trial</strong> command (which runs unit tests) only presents summary information to stdout, and puts the rest into a file named <code class="file docutils literal notranslate"><span class="pre">_trial_temp/test.log</span></code>.
It is often useful to watch these files as the command runs, rather than using <strong class="command">/bin/cat</strong> to dump their contents afterwards.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">logfiles=</span></code> argument allows you to collect data from these secondary logfiles in near-real-time, as the step is running.
It accepts a dictionary which maps from a local Log name (which is how the log data is presented in the build results) to either a remote filename (interpreted relative to the build’s working directory), or a dictionary of options.
Each named file will be polled on a regular basis (every couple of seconds) as the build runs, and any new text will be sent over to the buildmaster.</p>
<p>If you provide a dictionary of options instead of a string, you must specify the <code class="docutils literal notranslate"><span class="pre">filename</span></code> key.
You can optionally provide a <code class="docutils literal notranslate"><span class="pre">follow</span></code> key which is a boolean controlling whether a logfile is followed or concatenated in its entirety.
Following is appropriate for logfiles to which the build step will append, where the pre-existing contents are not interesting.
The default value for <code class="docutils literal notranslate"><span class="pre">follow</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, which gives the same behavior as just providing a string filename.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
                   <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                   <span class="n">logfiles</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;triallog&quot;</span><span class="p">:</span> <span class="s2">&quot;_trial_temp/test.log&quot;</span><span class="p">}))</span>
</pre></div>
</div>
<p>The above example will add a log named ‘triallog’ on the master, based on <code class="file docutils literal notranslate"><span class="pre">_trial_temp/test.log</span></code> on the worker.</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">logfiles</span><span class="o">=</span><span class="p">{</span>
                                 <span class="s2">&quot;triallog&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;_trial_temp/test.log&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;follow&quot;</span><span class="p">:</span> <span class="kc">True</span>
                                 <span class="p">}</span>
                             <span class="p">}))</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lazylogfiles</span></code></dt>
<dd>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, logfiles will be tracked lazily, meaning that they will only be added when and if something is written to them.
This can be used to suppress the display of empty or missing log files.
The default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt>
<dd>if the command fails to produce any output for this many seconds, it is assumed to be locked up and will be killed.
This defaults to 1200 seconds.
Pass <code class="docutils literal notranslate"><span class="pre">None</span></code> to disable.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxTime</span></code></dt>
<dd>if the command takes longer than this many seconds, it will be killed.
This is disabled by default.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt>
<dd>If this option is <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set <code class="docutils literal notranslate"><span class="pre">logEnviron=False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">interruptSignal</span></code></dt>
<dd>If the command should be interrupted (either by buildmaster or timeout etc.), what signal should be sent to the process, specified by name.
By default this is “KILL” (9).
Specify “TERM” (15) to give the process a chance to cleanup.
This functionality requires a 0.8.6 worker or newer.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">sigtermTime</span></code></p>
<blockquote>
<div>If set, when interrupting, try to kill the command with SIGTERM and wait for sigtermTime seconds before firing <code class="docutils literal notranslate"><span class="pre">interuptSignal</span></code>.
If None, <code class="docutils literal notranslate"><span class="pre">interruptSignal</span></code> will be fired immediately on interrupt.</div></blockquote>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">initialStdin</span></code></dt>
<dd>If the command expects input on stdin, that can be supplied a a string with this parameter.
This value should not be excessively large, as it is handled as a single string throughout Buildbot – for example, do not pass the contents of a tarball with this parameter.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">decodeRC</span></code></dt>
<dd>This is a dictionary that decodes exit codes into results value.
For example, <code class="docutils literal notranslate"><span class="pre">{0:SUCCESS,1:FAILURE,2:WARNINGS}</span></code>, will treat the exit code <code class="docutils literal notranslate"><span class="pre">2</span></code> as WARNINGS.
The default is to treat just 0 as successful.
(<code class="docutils literal notranslate"><span class="pre">{0:SUCCESS}</span></code>) any exit code not present in the dictionary will be treated as <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code></dd>
</dl>
</div>
<div class="section" id="shell-sequence">
<span id="step-ShellSequence"></span><h6><a class="toc-backref" href="#id39">Shell Sequence</a><a class="headerlink" href="#shell-sequence" title="Permalink to this headline">¶</a></h6>
<p>Some steps have a specific purpose, but require multiple shell commands to implement them.
For example, a build is often <code class="docutils literal notranslate"><span class="pre">configure;</span> <span class="pre">make;</span> <span class="pre">make</span> <span class="pre">install</span></code>.
We have two ways to handle that:</p>
<ul class="simple">
<li>Create one shell command with all these.
To put the logs of each commands in separate logfiles, we need to re-write the script as <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">1&gt;</span> <span class="pre">configure_log;</span> <span class="pre">...</span></code> and to add these <code class="docutils literal notranslate"><span class="pre">configure_log</span></code> files as <code class="docutils literal notranslate"><span class="pre">logfiles</span></code> argument of the buildstep.
This has the drawback of complicating the shell script, and making it harder to maintain as the logfile name is put in different places.</li>
<li>Create three <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> instances, but this loads the build UI unnecessarily.</li>
</ul>
<p><a class="reference internal" href="#step-ShellSequence" title="ShellSequence"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellSequence</span></code></a> is a class to execute not one but a sequence of shell commands during a build.
It takes as argument a renderable, or list of commands which are <a class="reference internal" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code></a> objects.
Each such object represents a shell invocation.</p>
<p>The single <a class="reference internal" href="#step-ShellSequence" title="ShellSequence"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellSequence</span></code></a> argument aside from the common parameters is:</p>
<p><code class="docutils literal notranslate"><span class="pre">commands</span></code></p>
<p>A list of <a class="reference internal" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code></a> objects or a renderable the returns a list of <a class="reference internal" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code></a> objects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellSequence</span><span class="p">(</span>
    <span class="n">commands</span><span class="o">=</span><span class="p">[</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ShellArg</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;configure&#39;</span><span class="p">]),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ShellArg</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">],</span> <span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;make&#39;</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ShellArg</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;check_warning&#39;</span><span class="p">],</span> <span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span> <span class="n">warnOnFailure</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ShellArg</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="s1">&#39;install&#39;</span><span class="p">],</span> <span class="n">logfile</span><span class="o">=</span><span class="s1">&#39;make install&#39;</span><span class="p">)</span>
    <span class="p">]))</span>
</pre></div>
</div>
<p>All these commands share the same configuration of <code class="docutils literal notranslate"><span class="pre">environment</span></code>, <code class="docutils literal notranslate"><span class="pre">workdir</span></code> and <code class="docutils literal notranslate"><span class="pre">pty</span></code> usage that can be setup the same way as in <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>.</p>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg">
<em class="property">class </em><code class="descclassname">buildbot.steps.shellsequence.</code><code class="descname">ShellArg</code><span class="sig-paren">(</span><em>self</em>, <em>command=None</em>, <em>logfile=None</em>, <em>haltOnFailure=False</em>, <em>flunkOnWarnings=False</em>, <em>flunkOnFailure=False</em>, <em>warnOnWarnings=False</em>, <em>warnOnFailure=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>command</strong> – (see the <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> <code class="docutils literal notranslate"><span class="pre">command</span></code> argument),</li>
<li><strong>logfile</strong> – optional log file name, used as the stdio log of the command</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code>, <code class="docutils literal notranslate"><span class="pre">flunkOnWarnings</span></code>, <code class="docutils literal notranslate"><span class="pre">flunkOnFailure</span></code>, <code class="docutils literal notranslate"><span class="pre">warnOnWarnings</span></code>, <code class="docutils literal notranslate"><span class="pre">warnOnFailure</span></code> parameters drive the execution of the sequence, the same way steps are scheduled in the build.
They have the same default values as for buildsteps - see <a class="reference internal" href="#buildstep-common-parameters"><span class="std std-ref">Common Parameters</span></a>.</p>
<p>Any of the arguments to this class can be renderable.</p>
<p>Note that if <code class="docutils literal notranslate"><span class="pre">logfile</span></code> name does not start with the prefix <code class="docutils literal notranslate"><span class="pre">stdio</span></code>, that prefix will be set like <code class="docutils literal notranslate"><span class="pre">stdio</span> <span class="pre">&lt;logfile&gt;</span></code>.</p>
</dd></dl>

<p>The two <a class="reference internal" href="#step-ShellSequence" title="ShellSequence"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellSequence</span></code></a> methods below tune the behavior of how the list of shell commands are executed, and can be overridden in subclasses.</p>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence">
<em class="property">class </em><code class="descclassname">buildbot.steps.shellsequence.</code><code class="descname">ShellSequence</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence.shouldRunTheCommand">
<code class="descname">shouldRunTheCommand</code><span class="sig-paren">(</span><em>oneCmd</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence.shouldRunTheCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>oneCmd</strong> – a string or a list of strings, as rendered from a <a class="reference internal" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellArg" title="buildbot.steps.source.buildbot.steps.shellsequence.ShellArg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code></a> instance’s <code class="docutils literal notranslate"><span class="pre">command</span></code> argument.</td>
</tr>
</tbody>
</table>
<p>Determine whether the command <code class="docutils literal notranslate"><span class="pre">oneCmd</span></code> should be executed.
If <code class="docutils literal notranslate"><span class="pre">shouldRunTheCommand</span></code> returns <code class="docutils literal notranslate"><span class="pre">False</span></code>, the result of the command will be recorded as SKIPPED.
The default methods skips all empty strings and empty lists.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence.getFinalState">
<code class="descname">getFinalState</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shellsequence.ShellSequence.getFinalState" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the status text of the step in the end.
The default value is to set the text describing the execution of the last shell command.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">runShellSequence(commands):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>commands</strong> – list of shell args</td>
</tr>
</tbody>
</table>
<p>This method actually runs the shell sequence.
The default <code class="docutils literal notranslate"><span class="pre">run</span></code> method calls <code class="docutils literal notranslate"><span class="pre">runShellSequence</span></code>, but subclasses can override <code class="docutils literal notranslate"><span class="pre">run</span></code> to perform other operations, if desired.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="configure">
<span id="step-Configure"></span><h6><a class="toc-backref" href="#id40">Configure</a><a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.Configure">
<em class="property">class </em><code class="descclassname">buildbot.steps.shell.</code><code class="descname">Configure</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.Configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is intended to handle the <strong class="command">./configure</strong> step from autoconf-style projects, or the <code class="docutils literal notranslate"><span class="pre">perl</span> <span class="pre">Makefile.PL</span></code> step from perl <code class="file docutils literal notranslate"><span class="pre">MakeMaker.pm</span></code>-style modules.
The default command is <strong class="command">./configure</strong> but you can change this by providing a <code class="docutils literal notranslate"><span class="pre">command=</span></code> parameter.
The arguments are identical to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Configure</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="cmake">
<span id="step-CMake"></span><h6><a class="toc-backref" href="#id41">CMake</a><a class="headerlink" href="#cmake" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.cmake.CMake">
<em class="property">class </em><code class="descclassname">buildbot.steps.cmake.</code><code class="descname">CMake</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.cmake.CMake" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is intended to handle the <strong class="command">cmake</strong> step for projects that use <a class="reference external" href="http://cmake.org">CMake-based build systems</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Links below point to the latest CMake documentation.
Make sure that you check the documentation for the CMake you use.</p>
</div>
<p>In addition to the parameters <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> supports, this step accepts the following parameters:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">path</span></code></dt>
<dd>Either a path to a source directory to (re-)generate a build system for it in the current working directory.
Or an existing build directory to re-generate its build system.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">generator</span></code></dt>
<dd>A build system generator.
See <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake-generators.7.html">cmake-generators(7)</a> for available options.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">definitions</span></code></dt>
<dd>A dictionary that contains parameters that will be converted to <code class="docutils literal notranslate"><span class="pre">-D{name}={value}</span></code> when passed to CMake.
A renderable which renders to a dictionary can also be provided, see <a class="reference internal" href="#properties"><span class="std std-ref">Properties</span></a>.
Refer to <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake.1.html">cmake(1)</a> for more information.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">options</span></code></dt>
<dd>A list or a tuple that contains options that will be passed to CMake as is.
A renderable which renders to a tuple or list can also be provided, see <a class="reference internal" href="#properties"><span class="std std-ref">Properties</span></a>.
Refer to <a class="reference external" href="https://cmake.org/cmake/help/latest/manual/cmake.1.html">cmake(1)</a> for more information.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cmake</span></code></dt>
<dd>Path to the CMake binary.
Default is <strong class="command">cmake</strong></dd>
</dl>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="o">...</span>

<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">CMake</span><span class="p">(</span>
        <span class="n">generator</span><span class="o">=</span><span class="s1">&#39;Ninja&#39;</span><span class="p">,</span>
        <span class="n">definitions</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;CMAKE_BUILD_TYPE&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;BUILD_TYPE&#39;</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="n">options</span><span class="o">=</span><span class="p">[</span>
            <span class="s1">&#39;-Wno-dev&#39;</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="compile">
<span id="step-Compile"></span><h6><a class="toc-backref" href="#id42">Compile</a><a class="headerlink" href="#compile" title="Permalink to this headline">¶</a></h6>
<p id="index-20">This is meant to handle compiling or building a project written in C.
The default command is <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">all</span></code>.
When the compilation is finished, the log file is scanned for GCC warning messages, a summary log is created with any problems that were seen, and the step is marked as WARNINGS if any were discovered.
Through the <code class="xref py py-class docutils literal notranslate"><span class="pre">WarningCountingShellCommand</span></code> superclass, the number of warnings is stored in a Build Property named <cite>warnings-count</cite>, which is accumulated over all <a class="reference internal" href="#step-Compile" title="Compile"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Compile</span></code></a> steps (so if two warnings are found in one step, and three are found in another step, the overall build will have a <cite>warnings-count</cite> property of 5).
Each step can be optionally given a maximum number of warnings via the maxWarnCount parameter.
If this limit is exceeded, the step will be marked as a failure.</p>
<p>The default regular expression used to detect a warning is <code class="docutils literal notranslate"><span class="pre">'.*warning[:</span> <span class="pre">].*'</span></code> , which is fairly liberal and may cause false-positives.
To use a different regexp, provide a <code class="docutils literal notranslate"><span class="pre">warningPattern=</span></code> argument, or use a subclass which sets the <code class="docutils literal notranslate"><span class="pre">warningPattern</span></code> attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                        <span class="n">warningPattern</span><span class="o">=</span><span class="s2">&quot;^Warning: &quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">warningPattern=</span></code> can also be a pre-compiled Python regexp object: this makes it possible to add flags like <code class="docutils literal notranslate"><span class="pre">re.I</span></code> (to use case-insensitive matching).</p>
<p>Note that the compiled <code class="docutils literal notranslate"><span class="pre">warningPattern</span></code> will have its <code class="xref py py-meth docutils literal notranslate"><span class="pre">match</span></code> method called, which is subtly different from a <code class="xref py py-meth docutils literal notranslate"><span class="pre">search</span></code>.
Your regular expression must match the from the beginning of the line.
This means that to look for the word “warning” in the middle of a line, you will need to prepend <code class="docutils literal notranslate"><span class="pre">'.*'</span></code> to your regular expression.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">suppressionFile=</span></code> argument can be specified as the (relative) path of a file inside the workdir defining warnings to be suppressed from the warning counting and log file.
The file will be uploaded to the master from the worker before compiling, and any warning matched by a line in the suppression file will be ignored.
This is useful to accept certain warnings (e.g. in some special module of the source tree or in cases where the compiler is being particularly stupid), yet still be able to easily detect and fix the introduction of new warnings.</p>
<p>The file must contain one line per pattern of warnings to ignore.
Empty lines and lines beginning with <code class="docutils literal notranslate"><span class="pre">#</span></code> are ignored.
Other lines must consist of a regexp matching the file name, followed by a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>), followed by a regexp matching the text of the warning.
Optionally this may be followed by another colon and a line number range.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Sample warning suppression file

mi_packrec.c : .*result of 32-bit shift implicitly converted to 64 bits.* : 560-600
DictTabInfo.cpp : .*invalid access to non-static.*
kernel_types.h : .*only defines private constructors and has no friends.* : 51
</pre></div>
</div>
<p>If no line number range is specified, the pattern matches the whole file; if only one number is given it matches only on that line.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">suppressionList=</span></code> argument can be specified as a list of four-tuples as addition or instead of <code class="docutils literal notranslate"><span class="pre">suppressionFile=</span></code>.
The tuple should be <code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">FILE-RE,</span> <span class="pre">WARNING-RE,</span> <span class="pre">START,</span> <span class="pre">END</span> <span class="pre">]</span></code>.
If <code class="docutils literal notranslate"><span class="pre">FILE-RE</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the suppression applies to any file.
<code class="docutils literal notranslate"><span class="pre">START</span></code> and <code class="docutils literal notranslate"><span class="pre">END</span></code> can be specified as in suppression file, or <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>The default warningPattern regexp only matches the warning text, so line numbers and file names are ignored.
To enable line number and file name matching, provide a different regexp and provide a function (callable) as the argument of <code class="docutils literal notranslate"><span class="pre">warningExtractor=</span></code>.
The function is called with three arguments: the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> object, the line in the log file with the warning, and the <code class="docutils literal notranslate"><span class="pre">SRE_Match</span></code> object of the regexp search for <code class="docutils literal notranslate"><span class="pre">warningPattern</span></code>.
It should return a tuple <code class="docutils literal notranslate"><span class="pre">(filename,</span> <span class="pre">linenumber,</span> <span class="pre">warning_test)</span></code>.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">],</span>
                  <span class="n">warningPattern</span><span class="o">=</span><span class="s2">&quot;^(.\*?):([0-9]+): [Ww]arning: (.\*)$&quot;</span><span class="p">,</span>
                  <span class="n">warningExtractor</span><span class="o">=</span><span class="n">Compile</span><span class="o">.</span><span class="n">warnExtractFromRegexpGroups</span><span class="p">,</span>
                  <span class="n">suppressionFile</span><span class="o">=</span><span class="s2">&quot;support-files/compiler_warnings.supp&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>(<code class="docutils literal notranslate"><span class="pre">Compile.warnExtractFromRegexpGroups</span></code> is a pre-defined function that returns the filename, linenumber, and text from groups (1,2,3) of the regexp match).</p>
<p>In projects with source files in multiple directories, it is possible to get full path names for file names matched in the suppression file, as long as the build command outputs the names of directories as they are entered into and left again.
For this, specify regexps for the arguments <code class="docutils literal notranslate"><span class="pre">directoryEnterPattern=</span></code> and <code class="docutils literal notranslate"><span class="pre">directoryLeavePattern=</span></code>.
The <code class="docutils literal notranslate"><span class="pre">directoryEnterPattern=</span></code> regexp should return the name of the directory entered into in the first matched group.
The defaults, which are suitable for GNU Make, are these:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">directoryEnterPattern</span><span class="o">=</span><span class="s2">&quot;make.*: Entering directory [</span><span class="se">\&quot;</span><span class="s2">`&#39;](.*)[&#39;`</span><span class="se">\&quot;</span><span class="s2">]&quot;</span>
<span class="n">directoryLeavePattern</span><span class="o">=</span><span class="s2">&quot;make.*: Leaving directory&quot;</span>
</pre></div>
</div>
<p>(TODO: this step needs to be extended to look for GCC error messages as well, and collect them into a separate logfile, along with the source code filenames involved).</p>
<span class="target" id="index-21"></span><span class="target" id="step-VC6"></span><span class="target" id="step-VC7"></span><span class="target" id="step-VC8"></span><span class="target" id="step-VC9"></span><span class="target" id="step-VC10"></span><span class="target" id="step-VC11"></span><span class="target" id="step-VC12"></span><span class="target" id="step-VC14"></span><span class="target" id="step-VC141"></span><span class="target" id="step-VS2003"></span><span class="target" id="step-VS2005"></span><span class="target" id="step-VS2008"></span><span class="target" id="step-VS2010"></span><span class="target" id="step-VS2012"></span><span class="target" id="step-VS2013"></span><span class="target" id="step-VS2015"></span><span class="target" id="step-VS2017"></span><span class="target" id="step-VCExpress9"></span><span class="target" id="step-MsBuild4"></span><span class="target" id="step-MsBuild12"></span><span class="target" id="step-MsBuild14"></span></div>
<div class="section" id="visual-c">
<span id="step-MsBuild141"></span><h6><a class="toc-backref" href="#id43">Visual C++</a><a class="headerlink" href="#visual-c" title="Permalink to this headline">¶</a></h6>
<p>These steps are meant to handle compilation using Microsoft compilers.
VC++ 6-141 (aka Visual Studio 2003-2015 and VCExpress9) are supported via calling <code class="docutils literal notranslate"><span class="pre">devenv</span></code>.
Msbuild as well as Windows Driver Kit 8 are supported via the <code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code>, <code class="docutils literal notranslate"><span class="pre">MsBuild12</span></code>, <code class="docutils literal notranslate"><span class="pre">MsBuild14</span></code> and  <code class="docutils literal notranslate"><span class="pre">MsBuild141</span></code> steps.
These steps will take care of setting up a clean compilation environment, parsing the generated output in real time, and delivering as detailed as possible information about the compilation executed.</p>
<p>All of the classes are in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.steps.vstudio</span></code>.
The available classes are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">VC6</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VC7</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VC8</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VC9</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VC10</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VC11</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VC12</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VC14</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VC141</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VS2003</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VS2005</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VS2008</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VS2010</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VS2012</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VS2013</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VS2015</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VS2017</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">VCExpress9</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">MsBuild12</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">MsBuild14</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">MsBuild141</span></code></li>
</ul>
<p>The available constructor arguments are</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code></dt>
<dd>The mode default to <code class="docutils literal notranslate"><span class="pre">rebuild</span></code>, which means that first all the remaining object files will be cleaned by the compiler.
The alternate values are <code class="docutils literal notranslate"><span class="pre">build</span></code>, where only the updated files will be recompiled, and <code class="docutils literal notranslate"><span class="pre">clean</span></code>, where the current build files are removed and no compilation occurs.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">projectfile</span></code></dt>
<dd>This is a mandatory argument which specifies the project file to be used during the compilation.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code></dt>
<dd>This argument defaults to <code class="docutils literal notranslate"><span class="pre">release</span></code> an gives to the compiler the configuration to use.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">installdir</span></code></dt>
<dd>This is the place where the compiler is installed.
The default value is compiler specific and is the default place where the compiler is installed.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">useenv</span></code></dt>
<dd>This boolean parameter, defaulting to <code class="docutils literal notranslate"><span class="pre">False</span></code> instruct the compiler to use its own settings or the one defined through the environment variables <span class="target" id="index-22"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code>, <span class="target" id="index-23"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">INCLUDE</span></code>, and <span class="target" id="index-24"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">LIB</span></code>.
If any of the <code class="docutils literal notranslate"><span class="pre">INCLUDE</span></code> or  <code class="docutils literal notranslate"><span class="pre">LIB</span></code> parameter is defined, this parameter automatically switches to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PATH</span></code></dt>
<dd>This is a list of path to be added to the <span class="target" id="index-25"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> environment variable.
The default value is the one defined in the compiler options.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">INCLUDE</span></code></dt>
<dd>This is a list of path where the compiler will first look for include files.
Then comes the default paths defined in the compiler options.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">LIB</span></code></dt>
<dd>This is a list of path where the compiler will first look for libraries.
Then comes the default path defined in the compiler options.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">arch</span></code></dt>
<dd>That one is only available with the class VS2005 (VC8).
It gives the target architecture of the built artifact.
It defaults to <code class="docutils literal notranslate"><span class="pre">x86</span></code> and does not apply to <code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code> or <code class="docutils literal notranslate"><span class="pre">MsBuild12</span></code>.
Please see <code class="docutils literal notranslate"><span class="pre">platform</span></code> below.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">project</span></code></dt>
<dd>This gives the specific project to build from within a workspace.
It defaults to building all projects.
This is useful for building cmake generate projects.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">platform</span></code></dt>
<dd>This is a mandatory argument for <code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code> and <code class="docutils literal notranslate"><span class="pre">MsBuild12</span></code> specifying the target platform such as ‘Win32’, ‘x64’ or ‘Vista Debug’.
The last one is an example of driver targets that appear once Windows Driver Kit 8 is installed.</dd>
</dl>
<p>Here is an example on how to drive compilation with Visual Studio 2013:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">VS2013</span><span class="p">(</span><span class="n">projectfile</span><span class="o">=</span><span class="s2">&quot;project.sln&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;release&quot;</span><span class="p">,</span>
        <span class="n">arch</span><span class="o">=</span><span class="s2">&quot;x64&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;build&quot;</span><span class="p">,</span>
           <span class="n">INCLUDE</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;C:\3rd-party\libmagic\include&#39;</span><span class="p">],</span>
           <span class="n">LIB</span><span class="o">=</span><span class="p">[</span><span class="sa">r</span><span class="s1">&#39;C:\3rd-party\libmagic\lib-x64&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Here is a similar example using “MsBuild12”:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="c1"># Build one project in Release mode for Win32</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">MsBuild12</span><span class="p">(</span><span class="n">projectfile</span><span class="o">=</span><span class="s2">&quot;trunk.sln&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s2">&quot;Release&quot;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;Win32&quot;</span><span class="p">,</span>
            <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;trunk&quot;</span><span class="p">,</span>
            <span class="n">project</span><span class="o">=</span><span class="s2">&quot;tools</span><span class="se">\\</span><span class="s2">protoc&quot;</span><span class="p">))</span>

<span class="c1"># Build the entire solution in Debug mode for x64</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">MsBuild12</span><span class="p">(</span><span class="n">projectfile</span><span class="o">=</span><span class="s2">&quot;trunk.sln&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s1">&#39;Debug&#39;</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;x64&#39;</span><span class="p">,</span>
            <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;trunk&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="cppcheck">
<span id="step-Cppcheck"></span><h6><a class="toc-backref" href="#id44">Cppcheck</a><a class="headerlink" href="#cppcheck" title="Permalink to this headline">¶</a></h6>
<p>This step runs <code class="docutils literal notranslate"><span class="pre">cppcheck</span></code>, analyse its output, and set the outcome in <a class="reference internal" href="#properties"><span class="std std-ref">Properties</span></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Cppcheck</span><span class="p">(</span><span class="n">enable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span> <span class="n">inconclusive</span><span class="o">=</span><span class="bp">True</span><span class="p">]))</span>
</pre></div>
</div>
<p>This class adds the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">binary</span></code></dt>
<dd>(Optional, default to <code class="docutils literal notranslate"><span class="pre">cppcheck</span></code>)
Use this if you need to give the full path to the cppcheck binary or if your binary is called differently.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt>
<dd>(Optional, default to <code class="docutils literal notranslate"><span class="pre">['.']</span></code>)
This is the list of paths for the sources to be checked by this step.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enable</span></code></dt>
<dd>(Optional)
Use this to give a list of the message classes that should be in cppcheck report.
See the cppcheck man page for more information.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">inconclusive</span></code></dt>
<dd>(Optional)
Set this to <code class="docutils literal notranslate"><span class="pre">True</span></code> if you want cppcheck to also report inconclusive results.
See the cppcheck man page for more information.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extra_args</span></code></dt>
<dd>(Optional)
This is the list of extra arguments to be given to the cppcheck command.</dd>
</dl>
<p>All other arguments are identical to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>.</p>
</div>
<div class="section" id="robocopy">
<span id="step-Robocopy"></span><h6><a class="toc-backref" href="#id45">Robocopy</a><a class="headerlink" href="#robocopy" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.mswin.Robocopy">
<em class="property">class </em><code class="descclassname">buildbot.steps.mswin.</code><code class="descname">Robocopy</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.mswin.Robocopy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This step runs <code class="docutils literal notranslate"><span class="pre">robocopy</span></code> on Windows.</p>
<p><a class="reference external" href="https://technet.microsoft.com/en-us/library/cc733145.aspx">Robocopy</a> is available in versions of Windows starting with Windows Vista and Windows Server 2008.
For previous versions of Windows, it’s available as part of the <a class="reference external" href="https://www.microsoft.com/en-us/download/details.aspx?id=17657">Windows Server 2003 Resource Kit Tools</a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">Robocopy</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;deploy_binaries&#39;</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Deploying binaries...&#39;</span><span class="p">,</span>
        <span class="n">descriptionDone</span><span class="o">=</span><span class="s1">&#39;Deployed binaries.&#39;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;Build</span><span class="se">\\</span><span class="s1">Bin</span><span class="se">\\</span><span class="s1">%(prop:configuration)s&#39;</span><span class="p">),</span>
        <span class="n">destination</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;%(prop:deploy_dir)</span><span class="se">\\</span><span class="s1">Bin</span><span class="se">\\</span><span class="s1">%(prop:configuration)s&#39;</span><span class="p">),</span>
        <span class="n">mirror</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Available constructor arguments are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt>
<dd>The path to the source directory (mandatory).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">destination</span></code></dt>
<dd>The path to the destination directory (mandatory).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">files</span></code></dt>
<dd>An array of file names or patterns to copy.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">recursive</span></code></dt>
<dd>Copy files and directories recursively (<code class="docutils literal notranslate"><span class="pre">/E</span></code> parameter).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mirror</span></code></dt>
<dd>Mirror the source directory in the destination directory, including removing files that don’t exist anymore (<code class="docutils literal notranslate"><span class="pre">/MIR</span></code> parameter).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">move</span></code></dt>
<dd>Delete the source directory after the copy is complete (<code class="docutils literal notranslate"><span class="pre">/MOVE</span></code> parameter).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">exclude_files</span></code></dt>
<dd>An array of file names or patterns to exclude from the copy (<code class="docutils literal notranslate"><span class="pre">/XF</span></code> parameter).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">exclude_dirs</span></code></dt>
<dd>An array of directory names or patterns to exclude from the copy (<code class="docutils literal notranslate"><span class="pre">/XD</span></code> parameter).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">custom_opts</span></code></dt>
<dd>An array of custom parameters to pass directly to the <code class="docutils literal notranslate"><span class="pre">robocopy</span></code> command.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">verbose</span></code></dt>
<dd>Whether to output verbose information (<code class="docutils literal notranslate"><span class="pre">/V</span> <span class="pre">/TS</span> <span class="pre">/FP</span></code> parameters).</dd>
</dl>
<p>Note that parameters <code class="docutils literal notranslate"><span class="pre">/TEE</span> <span class="pre">/NP</span></code> will always be appended to the command to signify, respectively, to output logging to the console, use Unicode logging, and not print any percentage progress information for each file.</p>
</div>
<div class="section" id="test">
<span id="step-Test"></span><h6><a class="toc-backref" href="#id46">Test</a><a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Test</span><span class="p">())</span>
</pre></div>
</div>
<p>This is meant to handle unit tests.
The default command is <strong class="command">make test</strong>, and the <code class="docutils literal notranslate"><span class="pre">warnOnFailure</span></code> flag is set.
The other arguments are identical to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>.</p>
<span class="target" id="step-TreeSize"></span></div>
<div class="section" id="treesize">
<span id="index-26"></span><h6><a class="toc-backref" href="#id47">TreeSize</a><a class="headerlink" href="#treesize" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">TreeSize</span><span class="p">())</span>
</pre></div>
</div>
<p>This is a simple command that uses the <strong class="command">du</strong> tool to measure the size of the code tree.
It puts the size (as a count of 1024-byte blocks, aka ‘KiB’ or ‘kibibytes’) on the step’s status text, and sets a build property named <code class="docutils literal notranslate"><span class="pre">tree-size-KiB</span></code> with the same value.
All arguments are identical to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>.</p>
</div>
<div class="section" id="perlmoduletest">
<span id="step-PerlModuleTest"></span><h6><a class="toc-backref" href="#id48">PerlModuleTest</a><a class="headerlink" href="#perlmoduletest" title="Permalink to this headline">¶</a></h6>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">PerlModuleTest</span><span class="p">())</span>
</pre></div>
</div>
<p>This is a simple command that knows how to run tests of perl modules.
It parses the output to determine the number of tests passed and failed and total number executed, saving the results for later query.
The command is <code class="docutils literal notranslate"><span class="pre">prove</span> <span class="pre">--lib</span> <span class="pre">lib</span> <span class="pre">-r</span> <span class="pre">t</span></code>, although this can be overridden with the <code class="docutils literal notranslate"><span class="pre">command</span></code> argument.
All other arguments are identical to those for <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>.</p>
</div>
<div class="section" id="mtr-mysql-test-run">
<span id="step-MTR"></span><h6><a class="toc-backref" href="#id49">MTR (mysql-test-run)</a><a class="headerlink" href="#mtr-mysql-test-run" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-MTR" title="MTR"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MTR</span></code></a> class is a subclass of <a class="reference internal" href="#step-Test" title="Test"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Test</span></code></a>.
It is used to run test suites using the mysql-test-run program, as used in MySQL, Drizzle, MariaDB, and MySQL storage engine plugins.</p>
<p>The shell command to run the test suite is specified in the same way as for the <a class="reference internal" href="#step-Test" title="Test"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Test</span></code></a> class.
The <a class="reference internal" href="#step-MTR" title="MTR"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MTR</span></code></a> class will parse the output of running the test suite, and use the count of tests executed so far to provide more accurate completion time estimates.
Any test failures that occur during the test are summarized on the Waterfall Display.</p>
<p>Server error logs are added as additional log files, useful to debug test failures.</p>
<p>Optionally, data about the test run and any test failures can be inserted into a database for further analysis and report generation.
To use this facility, create an instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.enterprise.adbapi.ConnectionPool</span></code> with connections to the database.
The necessary tables can be created automatically by setting <code class="docutils literal notranslate"><span class="pre">autoCreateTables</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>, or manually using the SQL found in the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/steps/mtrlogobserver.py">mtrlogobserver.py</a> source file.</p>
<p>One problem with specifying a database is that each reload of the configuration will get a new instance of <code class="docutils literal notranslate"><span class="pre">ConnectionPool</span></code> (even if the connection parameters are the same).
To avoid that Buildbot thinks the builder configuration has changed because of this, use the <code class="xref py py-class docutils literal notranslate"><span class="pre">steps.mtrlogobserver.EqConnectionPool</span></code> subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPool</span></code>, which implements an equality operation that avoids this problem.</p>
<p>Example use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">myPool</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">EqConnectionPool</span><span class="p">(</span><span class="s2">&quot;MySQLdb&quot;</span><span class="p">,</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;buildbot&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span> <span class="s2">&quot;db&quot;</span><span class="p">)</span>
<span class="n">myFactory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MTR</span><span class="p">(</span><span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;mysql-test&quot;</span><span class="p">,</span> <span class="n">dbpool</span><span class="o">=</span><span class="n">myPool</span><span class="p">,</span>
                            <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;perl&quot;</span><span class="p">,</span> <span class="s2">&quot;mysql-test-run.pl&quot;</span><span class="p">,</span> <span class="s2">&quot;--force&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#step-MTR" title="MTR"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MTR</span></code></a> step’s arguments are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">textLimit</span></code></dt>
<dd>Maximum number of test failures to show on the waterfall page (to not flood the page in case of a large number of test failures.
Defaults to 5.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">testNameLimit</span></code></dt>
<dd>Maximum length of test names to show unabbreviated in the waterfall page, to avoid excessive column width.
Defaults to 16.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">parallel</span></code></dt>
<dd>Value of option <cite>–parallel</cite> option used for <code class="file docutils literal notranslate"><span class="pre">mysql-test-run.pl</span></code> (number of processes used to run the test suite in parallel).
Defaults to 4.
This is used to determine the number of server error log files to download from the worker.
Specifying a too high value does not hurt (as nonexistent error logs will be ignored), however if using option <cite>–parallel</cite> value greater than the default it needs to be specified, or some server error logs will be missing.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dbpool</span></code></dt>
<dd>An instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.enterprise.adbapi.ConnectionPool</span></code>, or <code class="docutils literal notranslate"><span class="pre">None</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.
If specified, results are inserted into the database using the <code class="xref py py-class docutils literal notranslate"><span class="pre">ConnectionPool</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">autoCreateTables</span></code></dt>
<dd>Boolean, defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.
If <code class="docutils literal notranslate"><span class="pre">True</span></code> (and <code class="docutils literal notranslate"><span class="pre">dbpool</span></code> is specified), the necessary database tables will be created automatically if they do not exist already.
Alternatively, the tables can be created manually from the SQL statements found in the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/steps/mtrlogobserver.py">mtrlogobserver.py</a> source file.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_type</span></code></dt>
<dd>Short string that will be inserted into the database in the row for the test run.
Defaults to the empty string, but can be specified to identify different types of test runs.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">test_info</span></code></dt>
<dd>Descriptive string that will be inserted into the database in the row for the test run.
Defaults to the empty string, but can be specified as a user-readable description of this particular test run.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mtr_subdir</span></code></dt>
<dd>The subdirectory in which to look for server error log files.
Defaults to <code class="file docutils literal notranslate"><span class="pre">mysql-test</span></code>, which is usually correct.
<a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> is supported.</dd>
</dl>
</div>
<div class="section" id="subunitshellcommand">
<span id="step-subunitshellcommand"></span><span id="step-SubunitShellCommand"></span><h6><a class="toc-backref" href="#id50">SubunitShellCommand</a><a class="headerlink" href="#subunitshellcommand" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.subunit.SubunitShellCommand">
<em class="property">class </em><code class="descclassname">buildbot.steps.subunit.</code><code class="descname">SubunitShellCommand</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.subunit.SubunitShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This buildstep is similar to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>, except that it runs the log content through a subunit filter to extract test and failure counts.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SubunitShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;make test&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This runs <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> and filters it through subunit.
The ‘tests’ and ‘test failed’ progress metrics will now accumulate test data from the test run.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">failureOnNoTests</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, this step will fail if no test is run.
By default <code class="docutils literal notranslate"><span class="pre">failureOnNoTests</span></code> is False.</p>
</div>
</div>
<div class="section" id="worker-filesystem-steps">
<span id="id13"></span><h5><a class="toc-backref" href="#id51">2.5.10.5. Worker Filesystem Steps</a><a class="headerlink" href="#worker-filesystem-steps" title="Permalink to this headline">¶</a></h5>
<p>Here are some buildsteps for manipulating the worker’s filesystem.</p>
<div class="section" id="fileexists">
<span id="step-FileExists"></span><h6><a class="toc-backref" href="#id52">FileExists</a><a class="headerlink" href="#fileexists" title="Permalink to this headline">¶</a></h6>
<p>This step will assert that a given file exists, failing if it does not.
The filename can be specified with a property.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">FileExists</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;test_data&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires worker version 0.8.4 or later.</p>
</div>
<div class="section" id="copydirectory">
<span id="step-CopyDirectory"></span><h6><a class="toc-backref" href="#id53">CopyDirectory</a><a class="headerlink" href="#copydirectory" title="Permalink to this headline">¶</a></h6>
<p>This command copies a directory on the worker.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">CopyDirectory</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;build/data&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;tmp/data&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires worker version 0.8.5 or later.</p>
<p>The CopyDirectory step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt>
<dd>if the copy command fails to produce any output for this many seconds, it is assumed to be locked up and will be killed.
This defaults to 120 seconds.
Pass <code class="docutils literal notranslate"><span class="pre">None</span></code> to disable.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxTime</span></code></dt>
<dd>if the command takes longer than this many seconds, it will be killed.
This is disabled by default.</dd>
</dl>
</div>
<div class="section" id="removedirectory">
<span id="step-RemoveDirectory"></span><h6><a class="toc-backref" href="#id54">RemoveDirectory</a><a class="headerlink" href="#removedirectory" title="Permalink to this headline">¶</a></h6>
<p>This command recursively deletes a directory on the worker.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">RemoveDirectory</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s2">&quot;build/build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires worker version 0.8.4 or later.</p>
</div>
<div class="section" id="makedirectory">
<span id="step-MakeDirectory"></span><h6><a class="toc-backref" href="#id55">MakeDirectory</a><a class="headerlink" href="#makedirectory" title="Permalink to this headline">¶</a></h6>
<p>This command creates a directory on the worker.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MakeDirectory</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s2">&quot;build/build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires worker version 0.8.5 or later.</p>
</div>
</div>
<div class="section" id="python-buildsteps">
<span id="id14"></span><h5><a class="toc-backref" href="#id56">2.5.10.6. Python BuildSteps</a><a class="headerlink" href="#python-buildsteps" title="Permalink to this headline">¶</a></h5>
<p>Here are some <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s that are specifically useful for projects
implemented in Python.</p>
<div class="section" id="buildepydoc">
<span id="step-buildepydoc"></span><span id="step-BuildEPYDoc"></span><h6><a class="toc-backref" href="#id57">BuildEPYDoc</a><a class="headerlink" href="#buildepydoc" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.BuildEPYDoc">
<em class="property">class </em><code class="descclassname">buildbot.steps.python.</code><code class="descname">BuildEPYDoc</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.BuildEPYDoc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://epydoc.sourceforge.net/">epydoc</a> is a tool for generating
API documentation for Python modules from their docstrings.
It reads all the <code class="file docutils literal notranslate"><span class="pre">.py</span></code> files from your source tree, processes the docstrings therein, and creates a large tree of <code class="file docutils literal notranslate"><span class="pre">.html</span></code> files (or a single <code class="file docutils literal notranslate"><span class="pre">.pdf</span></code> file).</p>
<p>The <a class="reference internal" href="#step-BuildEPYDoc" title="BuildEPYDoc"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">BuildEPYDoc</span></code></a> step will run <strong class="command">epydoc</strong> to produce this API documentation, and will count the errors and warnings from its output.</p>
<p>You must supply the command line to be used.
The default is <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">epydocs</span></code>, which assumes that your project has a <code class="file docutils literal notranslate"><span class="pre">Makefile</span></code> with an <cite>epydocs</cite> target.
You might wish to use something like <code class="samp docutils literal notranslate"><span class="pre">epydoc</span> <span class="pre">-o</span> <span class="pre">apiref</span> <span class="pre">source/</span><em><span class="pre">PKGNAME</span></em></code> instead.
You might also want to add option <cite>–pdf</cite> to generate a PDF file instead of a large tree of HTML files.</p>
<p>The API docs are generated in-place in the build tree (under the workdir, in the subdirectory controlled by the option <cite>-o</cite> argument).
To make them useful, you will probably have to copy them to somewhere they can be read.
For example if you have server with configured nginx web server, you can place generated docs to it’s public folder with command like <code class="docutils literal notranslate"><span class="pre">rsync</span> <span class="pre">-ad</span> <span class="pre">apiref/</span> <span class="pre">dev.example.com:~/usr/share/nginx/www/current-apiref/</span></code>.
You might instead want to bundle them into a tarball and publish it in the same place where the generated install tarball is placed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">BuildEPYDoc</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;epydoc&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="s2">&quot;apiref&quot;</span><span class="p">,</span> <span class="s2">&quot;source/mypkg&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="pyflakes">
<span id="step-pyflake"></span><span id="step-PyFlakes"></span><h6><a class="toc-backref" href="#id58">PyFlakes</a><a class="headerlink" href="#pyflakes" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.PyFlakes">
<em class="property">class </em><code class="descclassname">buildbot.steps.python.</code><code class="descname">PyFlakes</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.PyFlakes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="https://launchpad.net/pyflakes">PyFlakes</a> is a tool to perform basic static analysis of Python code to look for simple errors, like missing imports and references of undefined names.
It is like a fast and simple form of the C <strong class="command">lint</strong> program.
Other tools (like <a class="reference external" href="http://pychecker.sourceforge.net/">pychecker</a>) provide more detailed results but take longer to run.</p>
<p>The <a class="reference internal" href="#step-PyFlakes" title="PyFlakes"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">PyFlakes</span></code></a> step will run pyflakes and count the various kinds of errors and warnings it detects.</p>
<p>You must supply the command line to be used.
The default is <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">pyflakes</span></code>, which assumes you have a top-level <code class="file docutils literal notranslate"><span class="pre">Makefile</span></code> with a <code class="docutils literal notranslate"><span class="pre">pyflakes</span></code> target.
You might want to use something like <code class="docutils literal notranslate"><span class="pre">pyflakes</span> <span class="pre">.</span></code> or <code class="docutils literal notranslate"><span class="pre">pyflakes</span> <span class="pre">src</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">PyFlakes</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pyflakes&quot;</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="sphinx">
<span id="step-sphinx"></span><span id="step-Sphinx"></span><h6><a class="toc-backref" href="#id59">Sphinx</a><a class="headerlink" href="#sphinx" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.Sphinx">
<em class="property">class </em><code class="descclassname">buildbot.steps.python.</code><code class="descname">Sphinx</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.Sphinx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://sphinx.pocoo.org/">Sphinx</a> is the Python Documentation Generator.
It uses <a class="reference external" href="http://docutils.sourceforge.net/rst.html">RestructuredText</a> as input format.</p>
<p>The <a class="reference internal" href="#step-Sphinx" title="Sphinx"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Sphinx</span></code></a> step will run <strong class="program">sphinx-build</strong> or any other program specified in its <code class="docutils literal notranslate"><span class="pre">sphinx</span></code> argument and count the various warnings and error it detects.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Sphinx</span><span class="p">(</span><span class="n">sphinx_builddir</span><span class="o">=</span><span class="s2">&quot;_build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">sphinx_builddir</span></code></dt>
<dd>(required) Name of the directory where the documentation will be generated.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sphinx_sourcedir</span></code></dt>
<dd>(optional, defaulting to <code class="docutils literal notranslate"><span class="pre">.</span></code>), Name the directory where the <code class="file docutils literal notranslate"><span class="pre">conf.py</span></code> file will be found</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sphinx_builder</span></code></dt>
<dd>(optional) Indicates the builder to use.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sphinx</span></code></dt>
<dd>(optional, defaulting to <strong class="program">sphinx-build</strong>) Indicates the executable to run.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tags</span></code></dt>
<dd>(optional) List of <code class="docutils literal notranslate"><span class="pre">tags</span></code> to pass to <strong class="program">sphinx-build</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">defines</span></code></dt>
<dd>(optional) Dictionary of defines to overwrite values of the <code class="file docutils literal notranslate"><span class="pre">conf.py</span></code> file.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code></dt>
<dd>(optional) String, one of <code class="docutils literal notranslate"><span class="pre">full</span></code> or <code class="docutils literal notranslate"><span class="pre">incremental</span></code> (the default).
If set to <code class="docutils literal notranslate"><span class="pre">full</span></code>, indicates to Sphinx to rebuild everything without re-using the previous build results.</dd>
</dl>
</div>
<div class="section" id="pylint">
<span id="step-pylint"></span><span id="step-PyLint"></span><h6><a class="toc-backref" href="#id60">PyLint</a><a class="headerlink" href="#pylint" title="Permalink to this headline">¶</a></h6>
<p>Similarly, the <a class="reference internal" href="#step-PyLint" title="PyLint"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">PyLint</span></code></a> step will run <strong class="command">pylint</strong> and analyze the results.</p>
<p>You must supply the command line to be used.
There is no default.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">PyLint</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pylint&quot;</span><span class="p">,</span> <span class="s2">&quot;src&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="trial">
<span id="step-trial"></span><span id="step-Trial"></span><h6><a class="toc-backref" href="#id61">Trial</a><a class="headerlink" href="#trial" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python_twisted.Trial">
<em class="property">class </em><code class="descclassname">buildbot.steps.python_twisted.</code><code class="descname">Trial</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python_twisted.Trial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This step runs a unit test suite using <strong class="command">trial</strong>, a unittest-like testing framework that is a component of Twisted Python.
Trial is used to implement Twisted’s own unit tests, and is the unittest-framework of choice for many projects that use Twisted internally.</p>
<p>Projects that use trial typically have all their test cases in a ‘test’ subdirectory of their top-level library directory.
For example, for a package <code class="docutils literal notranslate"><span class="pre">petmail</span></code>, the tests might be in <code class="file docutils literal notranslate"><span class="pre">petmail/test/test_*.py</span></code>.
More complicated packages (like Twisted itself) may have multiple test directories, like <code class="file docutils literal notranslate"><span class="pre">twisted/test/test_*.py</span></code> for the core functionality and <code class="file docutils literal notranslate"><span class="pre">twisted/mail/test/test_*.py</span></code> for the email-specific tests.</p>
<p>To run trial tests manually, you run the <strong class="command">trial</strong> executable and tell it where the test cases are located.
The most common way of doing this is with a module name.
For petmail, this might look like <strong class="command">trial petmail.test</strong>, which would locate all the <code class="file docutils literal notranslate"><span class="pre">test_*.py</span></code> files under <code class="file docutils literal notranslate"><span class="pre">petmail/test/</span></code>, running every test case it could find in them.
Unlike the <code class="docutils literal notranslate"><span class="pre">unittest.py</span></code> that comes with Python, it is not necessary to run the <code class="file docutils literal notranslate"><span class="pre">test_foo.py</span></code> as a script; you always let trial do the importing and running.
The step’s <code class="docutils literal notranslate"><span class="pre">tests`</span></code> parameter controls which tests trial will run: it can be a string or a list of strings.</p>
<p>To find the test cases, the Python search path must allow something like <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">petmail.test</span></code> to work.
For packages that don’t use a separate top-level <code class="file docutils literal notranslate"><span class="pre">lib</span></code> directory, <code class="docutils literal notranslate"><span class="pre">PYTHONPATH=.</span></code> will work, and will use the test cases (and the code they are testing) in-place.
<code class="docutils literal notranslate"><span class="pre">PYTHONPATH=build/lib</span></code> or <code class="docutils literal notranslate"><span class="pre">PYTHONPATH=build/lib.somearch</span></code> are also useful when you do a <code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build</span></code> step first.
The <code class="docutils literal notranslate"><span class="pre">testpath</span></code> attribute of this class controls what <span class="target" id="index-27"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> is set to before running <strong class="command">trial</strong>.</p>
<p>Trial has the ability, through the <code class="docutils literal notranslate"><span class="pre">--testmodule</span></code> flag, to run only the set of test cases named by special <code class="docutils literal notranslate"><span class="pre">test-case-name</span></code> tags in source files.
We can get the list of changed source files from our parent Build and provide them to trial, thus running the minimal set of test cases needed to cover the Changes.
This is useful for quick builds, especially in trees with a lot of test cases.
The <code class="docutils literal notranslate"><span class="pre">testChanges</span></code> parameter controls this feature: if set, it will override <code class="docutils literal notranslate"><span class="pre">tests</span></code>.</p>
<p>The trial executable itself is typically just <strong class="command">trial</strong>, and is typically found in the shell search path.
It can be overridden with the <code class="docutils literal notranslate"><span class="pre">trial</span></code> parameter.
This is useful for Twisted’s own unittests, which want to use the copy of bin/trial that comes with the sources.</p>
<p>To influence the version of Python being used for the tests, or to add flags to the command, set the <code class="docutils literal notranslate"><span class="pre">python</span></code> parameter.
This can be a string (like <code class="docutils literal notranslate"><span class="pre">python2.2</span></code>) or a list (like <code class="docutils literal notranslate"><span class="pre">['python2.3',</span> <span class="pre">'-Wall']</span></code>).</p>
<p>Trial creates and switches into a directory named <code class="file docutils literal notranslate"><span class="pre">_trial_temp/</span></code> before running the tests, and sends the twisted log (which includes all exceptions) to a file named <code class="file docutils literal notranslate"><span class="pre">test.log</span></code>.
This file will be pulled up to the master where it can be seen as part of the status output.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trial</span><span class="p">(</span><span class="n">tests</span><span class="o">=</span><span class="s1">&#39;petmail.test&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Trial has the ability to run tests on several workers in parallel (beginning with Twisted 12.3.0).
Set <code class="docutils literal notranslate"><span class="pre">jobs</span></code> to the number of workers you want to run.
Note that running <strong class="command">trial</strong> in this way will create multiple log files (named <code class="file docutils literal notranslate"><span class="pre">test.N.log</span></code>, <code class="file docutils literal notranslate"><span class="pre">err.N.log</span></code> and <code class="file docutils literal notranslate"><span class="pre">out.N.log</span></code> starting with <code class="docutils literal notranslate"><span class="pre">N=0</span></code>) rather than a single <code class="file docutils literal notranslate"><span class="pre">test.log</span></code>.</p>
<p>This step takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">jobs</span></code></dt>
<dd>(optional) Number of worker-resident trial workers to use when running the tests.
Defaults to 1 worker.
Only works with Twisted&gt;=12.3.0.</dd>
</dl>
</div>
<div class="section" id="removepycs">
<span id="step-RemovePYCs"></span><h6><a class="toc-backref" href="#id62">RemovePYCs</a><a class="headerlink" href="#removepycs" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python_twisted.RemovePYCs">
<em class="property">class </em><code class="descclassname">buildbot.steps.python_twisted.</code><code class="descname">RemovePYCs</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python_twisted.RemovePYCs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is a simple built-in step that will remove <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> files from the workdir.
This is useful in builds that update their source (and thus do not automatically delete <code class="docutils literal notranslate"><span class="pre">.pyc</span></code> files) but where some part of the build process is dynamically searching for Python modules.
Notably, trial has a bad habit of finding old test modules.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">RemovePYCs</span><span class="p">())</span>
</pre></div>
</div>
<span class="target" id="index-28"></span><span class="target" id="step-FileUpload"></span></div>
</div>
<div class="section" id="transferring-files">
<span id="step-FileDownload"></span><h5><a class="toc-backref" href="#id63">2.5.10.7. Transferring Files</a><a class="headerlink" href="#transferring-files" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.FileUpload">
<em class="property">class </em><code class="descclassname">buildbot.steps.transfer.</code><code class="descname">FileUpload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.FileUpload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.FileDownload">
<em class="property">class </em><code class="descclassname">buildbot.steps.transfer.</code><code class="descname">FileDownload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.FileDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Most of the work involved in a build will take place on the worker.
But occasionally it is useful to do some work on the buildmaster side.
The most basic way to involve the buildmaster is simply to move a file from the worker to the master, or vice versa.
There are a pair of steps named <a class="reference internal" href="#step-FileUpload" title="FileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileUpload</span></code></a> and <a class="reference internal" href="#step-FileDownload" title="FileDownload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileDownload</span></code></a> to provide this functionality.
<a class="reference internal" href="#step-FileUpload" title="FileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileUpload</span></code></a> moves a file <em>up to</em> the master, while <a class="reference internal" href="#step-FileDownload" title="FileDownload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileDownload</span></code></a> moves a file <em>down from</em> the master.</p>
<p>As an example, let’s assume that there is a step which produces an HTML file within the source tree that contains some sort of generated project documentation.
And let’s assume that we run nginx web server on buildmaster host for serving static files.
We want to move this file to the buildmaster, into a <code class="file docutils literal notranslate"><span class="pre">/usr/share/nginx/www/</span></code> directory, so it can be visible to developers.
This file will wind up in the worker-side working directory under the name <code class="file docutils literal notranslate"><span class="pre">docs/reference.html</span></code>.
We want to put it into the master-side <code class="file docutils literal notranslate"><span class="pre">/usr/share/nginx/www/ref.html</span></code>, and add a link to the HTML status to the uploaded file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">FileUpload</span><span class="p">(</span><span class="n">workersrc</span><span class="o">=</span><span class="s2">&quot;docs/reference.html&quot;</span><span class="p">,</span>
                           <span class="n">masterdest</span><span class="o">=</span><span class="s2">&quot;/usr/share/nginx/www/ref.html&quot;</span><span class="p">,</span>
                           <span class="n">url</span><span class="o">=</span><span class="s2">&quot;http://somesite/~buildbot/ref.html&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">masterdest=</span></code> argument will be passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">os.path.expanduser</span></code>, so things like <code class="docutils literal notranslate"><span class="pre">~</span></code> will be expanded properly.
Non-absolute paths will be interpreted relative to the buildmaster’s base directory.
Likewise, the <code class="docutils literal notranslate"><span class="pre">workersrc=</span></code> argument will be expanded and interpreted relative to the builder’s working directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The copied file will have the same permissions on the master as on the worker, look at the <code class="docutils literal notranslate"><span class="pre">mode=</span></code> parameter to set it differently.</p>
</div>
<p>To move a file from the master to the worker, use the <a class="reference internal" href="#step-FileDownload" title="FileDownload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileDownload</span></code></a> command.
For example, let’s assume that some step requires a configuration file that, for whatever reason, could not be recorded in the source code repository or generated on the worker side:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">FileDownload</span><span class="p">(</span><span class="n">mastersrc</span><span class="o">=</span><span class="s2">&quot;~/todays_build_config.txt&quot;</span><span class="p">,</span>
                             <span class="n">workerdest</span><span class="o">=</span><span class="s2">&quot;build_config.txt&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;config&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Like <a class="reference internal" href="#step-FileUpload" title="FileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileUpload</span></code></a>, the <code class="docutils literal notranslate"><span class="pre">mastersrc=</span></code> argument is interpreted relative to the buildmaster’s base directory, and the <code class="docutils literal notranslate"><span class="pre">workerdest=</span></code> argument is relative to the builder’s working directory.
If the worker is running in <code class="file docutils literal notranslate"><span class="pre">~worker</span></code>, and the builder’s <code class="docutils literal notranslate"><span class="pre">builddir</span></code> is something like <code class="file docutils literal notranslate"><span class="pre">tests-i386</span></code>, then the workdir is going to be <code class="file docutils literal notranslate"><span class="pre">~worker/tests-i386/build</span></code>, and a <code class="docutils literal notranslate"><span class="pre">workerdest=</span></code> of <code class="file docutils literal notranslate"><span class="pre">foo/bar.html</span></code> will get put in <code class="file docutils literal notranslate"><span class="pre">~worker/tests-i386/build/foo/bar.html</span></code>.
Both of these commands will create any missing intervening directories.</p>
<div class="section" id="other-parameters">
<h6><a class="toc-backref" href="#id64">Other Parameters</a><a class="headerlink" href="#other-parameters" title="Permalink to this headline">¶</a></h6>
<p>The <code class="docutils literal notranslate"><span class="pre">maxsize=</span></code> argument lets you set a maximum size for the file to be transferred.
This may help to avoid surprises: transferring a 100MB coredump when you were expecting to move a 10kB status file might take an awfully long time.
The <code class="docutils literal notranslate"><span class="pre">blocksize=</span></code> argument controls how the file is sent over the network: larger blocksizes are slightly more efficient but also consume more memory on each end, and there is a hard-coded limit of about 640kB.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">mode=</span></code> argument allows you to control the access permissions of the target file, traditionally expressed as an octal integer.
The most common value is probably <code class="docutils literal notranslate"><span class="pre">0755</span></code>, which sets the <cite>x</cite> executable bit on the file (useful for shell scripts and the like).
The default value for <code class="docutils literal notranslate"><span class="pre">mode=</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, which means the permission bits will default to whatever the umask of the writing process is.
The default umask tends to be fairly restrictive, but at least on the worker you can make it less restrictive with a <code class="docutils literal notranslate"><span class="pre">--umask</span></code> command-line option at creation time (<a class="reference internal" href="#worker-options"><span class="std std-ref">Worker Options</span></a>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">keepstamp=</span></code> argument is a boolean that, when <code class="docutils literal notranslate"><span class="pre">True</span></code>, forces the modified and accessed time of the destination file to match the times of the source file.
When <code class="docutils literal notranslate"><span class="pre">False</span></code> (the default), the modified and accessed times of the destination file are set to the current time on the buildmaster.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">url=</span></code> argument allows you to specify an url that will be displayed in the HTML status.
The title of the url will be the name of the item transferred (directory for <code class="xref py py-class docutils literal notranslate"><span class="pre">DirectoryUpload</span></code> or file for <code class="xref py py-class docutils literal notranslate"><span class="pre">FileUpload</span></code>).
This allows the user to add a link to the uploaded item if that one is uploaded to an accessible place.</p>
<p>For <a class="reference internal" href="#step-FileUpload" title="FileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileUpload</span></code></a>, the <code class="docutils literal notranslate"><span class="pre">urlText=</span></code> argument allows you to specify the url title that will be displayed in the web UI.</p>
</div>
<div class="section" id="transferring-directories">
<span id="step-DirectoryUpload"></span><h6><a class="toc-backref" href="#id65">Transferring Directories</a><a class="headerlink" href="#transferring-directories" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.DirectoryUpload">
<em class="property">class </em><code class="descclassname">buildbot.steps.transfer.</code><code class="descname">DirectoryUpload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.DirectoryUpload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>To transfer complete directories from the worker to the master, there is a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> named <a class="reference internal" href="#step-DirectoryUpload" title="DirectoryUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">DirectoryUpload</span></code></a>.
It works like <a class="reference internal" href="#step-FileUpload" title="FileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileUpload</span></code></a>, just for directories.
However it does not support the <code class="docutils literal notranslate"><span class="pre">maxsize</span></code>, <code class="docutils literal notranslate"><span class="pre">blocksize</span></code> and <code class="docutils literal notranslate"><span class="pre">mode</span></code> arguments.
As an example, let’s assume an generated project documentation, which consists of many files (like the output of <strong class="command">doxygen</strong> or <strong class="command">epydoc</strong>).
And let’s assume that we run nginx web server on buildmaster host for serving static files.
We want to move the entire documentation to the buildmaster, into a <code class="file docutils literal notranslate"><span class="pre">/usr/share/nginx/www/docs</span></code> directory, and add a link to the uploaded documentation on the HTML status page.
On the worker-side the directory can be found under <code class="file docutils literal notranslate"><span class="pre">docs</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">DirectoryUpload</span><span class="p">(</span><span class="n">workersrc</span><span class="o">=</span><span class="s2">&quot;docs&quot;</span><span class="p">,</span>
                                <span class="n">masterdest</span><span class="o">=</span><span class="s2">&quot;/usr/share/nginx/www/docs&quot;</span><span class="p">,</span>
                                <span class="n">url</span><span class="o">=</span><span class="s2">&quot;~buildbot/docs&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#step-DirectoryUpload" title="DirectoryUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">DirectoryUpload</span></code></a> step will create all necessary directories and transfers empty directories, too.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">maxsize</span></code> and <code class="docutils literal notranslate"><span class="pre">blocksize</span></code> parameters are the same as for <a class="reference internal" href="#step-FileUpload" title="FileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileUpload</span></code></a>, although note that the size of the transferred data is implementation-dependent, and probably much larger than you expect due to the encoding used (currently tar).</p>
<p>The optional <code class="docutils literal notranslate"><span class="pre">compress</span></code> argument can be given as <code class="docutils literal notranslate"><span class="pre">'gz'</span></code> or <code class="docutils literal notranslate"><span class="pre">'bz2'</span></code> to compress the datastream.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The permissions on the copied files will be the same on the master as originally on the worker, see option <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <span class="pre">--umask</span></code> to change the default one.</p>
</div>
</div>
<div class="section" id="transferring-multiple-files-at-once">
<span id="step-MultipleFileUpload"></span><h6><a class="toc-backref" href="#id66">Transferring Multiple Files At Once</a><a class="headerlink" href="#transferring-multiple-files-at-once" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.MultipleFileUpload">
<em class="property">class </em><code class="descclassname">buildbot.steps.transfer.</code><code class="descname">MultipleFileUpload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.MultipleFileUpload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>In addition to the <a class="reference internal" href="#step-FileUpload" title="FileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileUpload</span></code></a> and <a class="reference internal" href="#step-DirectoryUpload" title="DirectoryUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">DirectoryUpload</span></code></a> steps there is the <a class="reference internal" href="#step-MultipleFileUpload" title="MultipleFileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MultipleFileUpload</span></code></a> step for uploading a bunch of files (and directories) in a single <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>.
The step supports all arguments that are supported by <a class="reference internal" href="#step-FileUpload" title="FileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileUpload</span></code></a> and <a class="reference internal" href="#step-DirectoryUpload" title="DirectoryUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">DirectoryUpload</span></code></a>, but instead of a the single <code class="docutils literal notranslate"><span class="pre">workersrc</span></code> parameter it takes a (plural) <code class="docutils literal notranslate"><span class="pre">workersrcs</span></code> parameter.
This parameter should either be a list, something that can be rendered as a list or a string which will be converted to a list.
Additionally it supports the <code class="docutils literal notranslate"><span class="pre">glob</span></code> parameter if this parameter is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> all arguments in <code class="docutils literal notranslate"><span class="pre">workersrcs</span></code> will be parsed through <code class="docutils literal notranslate"><span class="pre">glob</span></code> and the results will be uploaded to <code class="docutils literal notranslate"><span class="pre">masterdest</span></code>.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;docs&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MultipleFileUpload</span><span class="p">(</span><span class="n">workersrcs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;docs&quot;</span><span class="p">,</span> <span class="s2">&quot;test-results.html&quot;</span><span class="p">],</span>
                                   <span class="n">masterdest</span><span class="o">=</span><span class="s2">&quot;/usr/share/nginx/www/&quot;</span><span class="p">,</span>
                                   <span class="n">url</span><span class="o">=</span><span class="s2">&quot;~buildbot&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">url=</span></code> parameter, can be used to specify a link to be displayed in the HTML status of the step.</p>
<p>The way URLs are added to the step can be customized by extending the <a class="reference internal" href="#step-MultipleFileUpload" title="MultipleFileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MultipleFileUpload</span></code></a> class.
The <cite>allUploadsDone</cite> method is called after all files have been uploaded and sets the URL.
The <cite>uploadDone</cite> method is called once for each uploaded file and can be used to create file-specific links.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="k">class</span> <span class="nc">CustomFileUpload</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MultipleFileUpload</span><span class="p">):</span>
    <span class="n">linkTypes</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;.html&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">linkFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basename</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">basename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ext</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkTypes</span>

    <span class="k">def</span> <span class="nf">uploadDone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">masterdest</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkFile</span><span class="p">(</span><span class="n">basename</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">basename</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">allUploadsDone</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">sources</span><span class="p">,</span> <span class="n">masterdest</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">:</span>
            <span class="n">notLinked</span> <span class="o">=</span> <span class="p">[</span><span class="n">src</span> <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">sources</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">linkFile</span><span class="p">(</span><span class="n">src</span><span class="p">)]</span>
            <span class="n">numFiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">notLinked</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">numFiles</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="s1">&#39;... </span><span class="si">%d</span><span class="s1"> more&#39;</span> <span class="o">%</span> <span class="n">numFiles</span><span class="p">)</span>
</pre></div>
</div>
<span class="target" id="step-StringDownload"></span><span class="target" id="step-JSONStringDownload"></span></div>
</div>
<div class="section" id="transferring-strings">
<span id="step-JSONPropertiesDownload"></span><h5><a class="toc-backref" href="#id67">2.5.10.8. Transferring Strings</a><a class="headerlink" href="#transferring-strings" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.StringDownload">
<em class="property">class </em><code class="descclassname">buildbot.steps.transfer.</code><code class="descname">StringDownload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.StringDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.JSONStringDownload">
<em class="property">class </em><code class="descclassname">buildbot.steps.transfer.</code><code class="descname">JSONStringDownload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.JSONStringDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.JSONPropertiesDownload">
<em class="property">class </em><code class="descclassname">buildbot.steps.transfer.</code><code class="descname">JSONPropertiesDownload</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.JSONPropertiesDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes it is useful to transfer a calculated value from the master to the worker.
Instead of having to create a temporary file and then use FileDownload, you can use one of the string download steps.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">StringDownload</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(src::branch)s-%(prop:got_revision)s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="n">workerdest</span><span class="o">=</span><span class="s2">&quot;buildid.txt&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="#step-StringDownload" title="StringDownload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">StringDownload</span></code></a> works just like <a class="reference internal" href="#step-FileDownload" title="FileDownload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">FileDownload</span></code></a> except it takes a single argument, <code class="docutils literal notranslate"><span class="pre">s</span></code>, representing the string to download instead of a <code class="docutils literal notranslate"><span class="pre">mastersrc</span></code> argument.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">buildinfo</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;branch&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;branch&#39;</span><span class="p">),</span>
    <span class="s1">&#39;got_revision&#39;</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;got_revision&#39;</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">JSONStringDownload</span><span class="p">(</span><span class="n">buildinfo</span><span class="p">,</span> <span class="n">workerdest</span><span class="o">=</span><span class="s2">&quot;buildinfo.json&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="#step-JSONStringDownload" title="JSONStringDownload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">JSONStringDownload</span></code></a> is similar, except it takes an <code class="docutils literal notranslate"><span class="pre">o</span></code> argument, which must be JSON serializable, and transfers that as a JSON-encoded string to the worker.</p>
<div class="highlight-default notranslate" id="index-29"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">JSONPropertiesDownload</span><span class="p">(</span><span class="n">workerdest</span><span class="o">=</span><span class="s2">&quot;build-properties.json&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="#step-JSONPropertiesDownload" title="JSONPropertiesDownload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">JSONPropertiesDownload</span></code></a> transfers a json-encoded string that represents a dictionary where properties maps to a dictionary of build property <code class="docutils literal notranslate"><span class="pre">name</span></code> to property <code class="docutils literal notranslate"><span class="pre">value</span></code>; and <code class="docutils literal notranslate"><span class="pre">sourcestamp</span></code> represents the build’s sourcestamp.</p>
</div>
<div class="section" id="running-commands-on-the-master">
<span id="step-MasterShellCommand"></span><h5><a class="toc-backref" href="#id68">2.5.10.9. Running Commands on the Master</a><a class="headerlink" href="#running-commands-on-the-master" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.MasterShellCommand">
<em class="property">class </em><code class="descclassname">buildbot.steps.master.</code><code class="descname">MasterShellCommand</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.MasterShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Occasionally, it is useful to execute some task on the master, for example to create a directory, deploy a build result, or trigger some other centralized processing.
This is possible, in a limited fashion, with the <a class="reference internal" href="#step-MasterShellCommand" title="MasterShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MasterShellCommand</span></code></a> step.</p>
<p>This step operates similarly to a regular <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>, but executes on the master, instead of the worker.
To be clear, the enclosing <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> object must still have a worker object, just as for any other step – only, in this step, the worker does not do anything.</p>
<p>In this example, the step renames a tarball based on the day of the week.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">FileUpload</span><span class="p">(</span><span class="n">workersrc</span><span class="o">=</span><span class="s2">&quot;widgetsoft.tar.gz&quot;</span><span class="p">,</span>
                     <span class="n">masterdest</span><span class="o">=</span><span class="s2">&quot;/var/buildoutputs/widgetsoft-new.tar.gz&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MasterShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;mv widgetsoft-new.tar.gz widgetsoft-`date +%a`.tar.gz&quot;</span><span class="p">,</span>
    <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;/var/buildoutputs&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, this step passes a copy of the buildmaster’s environment variables to the subprocess.
To pass an explicit environment instead, add an <code class="docutils literal notranslate"><span class="pre">env={..}</span></code> argument.</p>
</div>
<p>Environment variables constructed using the <code class="docutils literal notranslate"><span class="pre">env</span></code> argument support expansion so that if you just want to prepend  <code class="file docutils literal notranslate"><span class="pre">/home/buildbot/bin</span></code> to the <span class="target" id="index-30"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> environment variable, you can do it by putting the value <code class="docutils literal notranslate"><span class="pre">${PATH}</span></code> at the end of the value like in the example below.
Variables that don’t exist on the master will be replaced by <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MasterShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;www&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PATH&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/home/buildbot/bin&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;$</span><span class="si">{PATH}</span><span class="s2">&quot;</span><span class="p">]}))</span>
</pre></div>
</div>
<p>Note that environment values must be strings (or lists that are turned into strings).
In particular, numeric properties such as <code class="docutils literal notranslate"><span class="pre">buildnumber</span></code> must be substituted using <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt>
<dd>(optional) The directory from which the command will be ran.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">interruptSignal</span></code></dt>
<dd>(optional) Signal to use to end the process, if the step is interrupted.</dd>
</dl>
<div class="section" id="logrenderable">
<span id="step-LogRenderable"></span><h6><a class="toc-backref" href="#id69">LogRenderable</a><a class="headerlink" href="#logrenderable" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.LogRenderable">
<em class="property">class </em><code class="descclassname">buildbot.steps.master.</code><code class="descname">LogRenderable</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.LogRenderable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This build step takes content which can be renderable and logs it in a pretty-printed format.
It can be useful for debugging properties during a build.</p>
</div>
<div class="section" id="assert">
<span id="step-Assert"></span><h6><a class="toc-backref" href="#id70">Assert</a><a class="headerlink" href="#assert" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.Assert">
<em class="property">class </em><code class="descclassname">buildbot.steps.master.</code><code class="descname">Assert</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.Assert" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This build step takes a Renderable or constant passed in as first argument. It will test if the expression evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code> and succeed the step or fail the step otherwise.</p>
</div>
</div>
<div class="section" id="setting-properties">
<span id="index-31"></span><span id="id17"></span><h5><a class="toc-backref" href="#id71">2.5.10.10. Setting Properties</a><a class="headerlink" href="#setting-properties" title="Permalink to this headline">¶</a></h5>
<p>These steps set properties on the master based on information from the worker.</p>
<div class="section" id="setproperty">
<span id="step-setproperty"></span><span id="step-SetProperty"></span><h6><a class="toc-backref" href="#id72">SetProperty</a><a class="headerlink" href="#setproperty" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.SetProperty">
<em class="property">class </em><code class="descclassname">buildbot.steps.master.</code><code class="descname">SetProperty</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.SetProperty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#step-SetProperty" title="SetProperty"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SetProperty</span></code></a> takes two arguments of <code class="docutils literal notranslate"><span class="pre">property</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> where the <code class="docutils literal notranslate"><span class="pre">value</span></code> is to be assigned to the <code class="docutils literal notranslate"><span class="pre">property</span></code> key.
It is usually called with the <code class="docutils literal notranslate"><span class="pre">value</span></code> argument being specified as a <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> object which allows the value to be built from other property values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span>
    <span class="n">steps</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span>
        <span class="nb">property</span><span class="o">=</span><span class="s2">&quot;SomeProperty&quot;</span><span class="p">,</span>
        <span class="n">value</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;sch=%(prop:scheduler)s, worker=%(prop:workername)s&quot;</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setproperties-step">
<span id="step-setproperties"></span><span id="step-SetProperties"></span><h6><a class="toc-backref" href="#id73"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetProperties</span></code> step</a><a class="headerlink" href="#setproperties-step" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.steps.master.</code><code class="descname">SetProperty</code></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#step-SetProperties" title="SetProperties"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SetProperties</span></code></a> takes a dictionary to be turned into build properties.</p>
<p>It is similar to <a class="reference internal" href="#step-SetProperty" title="SetProperty"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SetProperty</span></code></a>, and meant to be used with a <a class="reference internal" href="#renderer"><span class="std std-ref">Renderer</span></a> function or a dictionary of  <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> objects which allows the value to be built from other property values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Example borrowed from Julia&#39;s master.cfg</span>
<span class="sd">   https://github.com/staticfloat/julia-buildbot (MIT)&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>

<span class="nd">@util.renderer</span>
<span class="k">def</span> <span class="nf">compute_artifact_filename</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="c1"># Get the output of the `make print-BINARYDIST_FILENAME` step</span>
    <span class="n">reported_filename</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;artifact_filename&#39;</span><span class="p">)</span>

    <span class="c1"># First, see if we got a BINARYDIST_FILENAME output</span>
    <span class="k">if</span> <span class="n">reported_filename</span><span class="p">[:</span><span class="mi">26</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BINARYDIST_FILENAME=&quot;</span><span class="p">:</span>
        <span class="n">local_filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">reported_filename</span><span class="p">[</span><span class="mi">26</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot;%(prop:os_pkg_ext)s&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If not, use non-sf/consistent_distnames naming</span>
        <span class="k">if</span> <span class="n">is_mac</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
            <span class="n">local_filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;contrib/mac/app/Julia-%(prop:version)s-%(prop:shortcommit)s.%(prop:os_pkg_ext)s&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">is_winnt</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
            <span class="n">local_filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;julia-%(prop:version)s-%(prop:tar_arch)s.%(prop:os_pkg_ext)s&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">local_filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;julia-%(prop:shortcommit)s-Linux-%(prop:tar_arch)s.%(prop:os_pkg_ext)s&quot;</span><span class="p">)</span>

    <span class="c1"># upload_filename always follows sf/consistent_distname rules</span>
    <span class="n">upload_filename</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;julia-%(prop:shortcommit)s-%(prop:os_name)s%(prop:bits)s.%(prop:os_pkg_ext)s&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;local_filename&quot;</span><span class="p">:</span> <span class="n">local_filename</span>
        <span class="s2">&quot;upload_filename&quot;</span><span class="p">:</span> <span class="n">upload_filename</span>
    <span class="p">}</span>

<span class="n">f1</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SetProperties</span><span class="p">(</span><span class="n">properties</span><span class="o">=</span><span class="n">compute_artifact_filename</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="setpropertyfromcommand">
<span id="step-SetPropertyFromCommand"></span><h6><a class="toc-backref" href="#id74">SetPropertyFromCommand</a><a class="headerlink" href="#setpropertyfromcommand" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.SetPropertyFromCommand">
<em class="property">class </em><code class="descclassname">buildbot.steps.shell.</code><code class="descname">SetPropertyFromCommand</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.SetPropertyFromCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This buildstep is similar to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>, except that it captures the output of the command into a property.
It is usually used like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SetPropertyFromCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;uname -a&quot;</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s2">&quot;uname&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This runs <code class="docutils literal notranslate"><span class="pre">uname</span> <span class="pre">-a</span></code> and captures its stdout, stripped of leading and trailing whitespace, in the property <code class="docutils literal notranslate"><span class="pre">uname</span></code>.
To avoid stripping, add <code class="docutils literal notranslate"><span class="pre">strip=False</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">property</span></code> argument can be specified as a  <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> object, allowing the property name to be built from other property values.</p>
<p>Passing <code class="docutils literal notranslate"><span class="pre">includeStdout=False</span></code> (default <code class="docutils literal notranslate"><span class="pre">True</span></code>) stops capture from stdout.</p>
<p>Passing <code class="docutils literal notranslate"><span class="pre">includeStderr=True</span></code> (default <code class="docutils literal notranslate"><span class="pre">False</span></code>) allows capture from stderr.</p>
<p>The more advanced usage allows you to specify a function to extract properties from the command output.
Here you can use regular expressions, string interpolation, or whatever you would like.
In this form, <code class="xref py py-func docutils literal notranslate"><span class="pre">extract_fn</span></code> should be passed, and not <code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code>.
The <code class="xref py py-func docutils literal notranslate"><span class="pre">extract_fn</span></code> function is called with three arguments: the exit status of the command, its standard output as a string, and its standard error as a string.
It should return a dictionary containing all new properties.</p>
<p>Note that passing in <code class="xref py py-func docutils literal notranslate"><span class="pre">extract_fn</span></code> will set <code class="docutils literal notranslate"><span class="pre">includeStderr</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">glob2list</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
    <span class="n">jpgs</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;jpgs&#39;</span><span class="p">:</span> <span class="n">jpgs</span><span class="p">}</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SetPropertyFromCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;ls -1 *.jpg&quot;</span><span class="p">,</span> <span class="n">extract_fn</span><span class="o">=</span><span class="n">glob2list</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that any ordering relationship of the contents of stdout and stderr is lost.
For example, given:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SetPropertyFromCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s2">&quot;echo output1; echo error &gt;&amp;2; echo output2&quot;</span><span class="p">,</span>
    <span class="n">extract_fn</span><span class="o">=</span><span class="n">my_extract</span><span class="p">))</span>
</pre></div>
</div>
<p>Then <code class="docutils literal notranslate"><span class="pre">my_extract</span></code> will see <code class="docutils literal notranslate"><span class="pre">stdout=&quot;output1\noutput2\n&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr=&quot;error\n&quot;</span></code>.</p>
<p>Avoid using the <code class="docutils literal notranslate"><span class="pre">extract_fn</span></code> form of this step with commands that produce a great deal of output, as the output is buffered in memory until complete.</p>
<span class="target" id="step-SetPropertiesFromEnv"></span><dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.worker.SetPropertiesFromEnv">
<em class="property">class </em><code class="descclassname">buildbot.steps.worker.</code><code class="descname">SetPropertiesFromEnv</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.worker.SetPropertiesFromEnv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="setpropertiesfromenv">
<h6><a class="toc-backref" href="#id75">SetPropertiesFromEnv</a><a class="headerlink" href="#setpropertiesfromenv" title="Permalink to this headline">¶</a></h6>
<p>Buildbot workers (later than version 0.8.3) provide their environment variables to the master on connect.
These can be copied into Buildbot properties with the <a class="reference internal" href="#step-SetPropertiesFromEnv" title="SetPropertiesFromEnv"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SetPropertiesFromEnv</span></code></a> step.
Pass a variable or list of variables in the <code class="docutils literal notranslate"><span class="pre">variables</span></code> parameter, then simply use the values as properties in a later step.</p>
<p>Note that on Windows, environment variables are case-insensitive, but Buildbot property names are case sensitive.
The property will have exactly the variable name you specify, even if the underlying environment variable is capitalized differently.
If, for example, you use <code class="docutils literal notranslate"><span class="pre">variables=['Tmp']</span></code>, the result will be a property named <code class="docutils literal notranslate"><span class="pre">Tmp</span></code>, even though the environment variable is displayed as <span class="target" id="index-32"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">TMP</span></code> in the Windows GUI.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SetPropertiesFromEnv</span><span class="p">(</span><span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SOME_JAVA_LIB_HOME&quot;</span><span class="p">,</span> <span class="s2">&quot;JAVAC&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">commands</span><span class="o">=</span><span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(prop:JAVAC)s&quot;</span><span class="p">),</span>
                                  <span class="s2">&quot;-cp&quot;</span><span class="p">,</span>
                                  <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(prop:SOME_JAVA_LIB_HOME)s&quot;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>Note that this step requires that the worker be at least version 0.8.3.
For previous versions, no environment variables are available (the worker environment will appear to be empty).</p>
<span class="target" id="index-33"></span></div>
</div>
<div class="section" id="triggering-schedulers">
<span id="step-Trigger"></span><span id="id18"></span><h5><a class="toc-backref" href="#id76">2.5.10.11. Triggering Schedulers</a><a class="headerlink" href="#triggering-schedulers" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.trigger.Trigger">
<em class="property">class </em><code class="descclassname">buildbot.steps.trigger.</code><code class="descname">Trigger</code><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.trigger.Trigger" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The counterpart to the <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> scheduler is the <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> build step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;build-prep&#39;</span><span class="p">],</span>
                        <span class="n">waitForFinish</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">updateSourceStamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">set_properties</span><span class="o">=</span><span class="p">{</span> <span class="s1">&#39;quick&#39;</span> <span class="p">:</span> <span class="kc">False</span> <span class="p">}))</span>
</pre></div>
</div>
<p>The SourceStamps to use for the triggered build are controlled by the arguments <code class="docutils literal notranslate"><span class="pre">updateSourceStamp</span></code>, <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code>, and <code class="docutils literal notranslate"><span class="pre">sourceStamps</span></code>.</p>
<p>Hyperlinks are added to the build detail web pages for each triggered build.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">schedulerNames</span></code></dt>
<dd><p class="first">lists the <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> schedulers that should be triggered when this step is executed.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible, but not advisable, to create a cycle where a build continually triggers itself, because the schedulers are specified by name.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unimportantSchedulerNames</span></code></dt>
<dd>When <code class="docutils literal notranslate"><span class="pre">waitForFinish</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, all schedulers in this list will not cause the trigger step to fail. unimportantSchedulerNames must be a subset of schedulerNames
If <code class="docutils literal notranslate"><span class="pre">waitForFinish</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, unimportantSchedulerNames will simply be ignored.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">waitForFinish</span></code></dt>
<dd><p class="first">If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the step will not finish until all of the builds from the triggered schedulers have finished.</p>
<p class="last">If <code class="docutils literal notranslate"><span class="pre">False</span></code> (the default) or not given, then the buildstep succeeds immediately after triggering the schedulers.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">updateSourceStamp</span></code></dt>
<dd><p class="first">If <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default), then step updates the source stamps given to the <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> schedulers to include <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> (the revision actually used in this build) as <code class="docutils literal notranslate"><span class="pre">revision</span></code> (the revision to use in the triggered builds).
This is useful to ensure that all of the builds use exactly the same source stamps, even if other <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s have occurred while the build was running.</p>
<p class="last">If <code class="docutils literal notranslate"><span class="pre">False</span></code> (and neither of the other arguments are specified), then the exact same SourceStamps are used.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code></dt>
<dd>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, then no SourceStamps are given, corresponding to using the latest revisions of the repositories specified in the Source steps.
This is useful if the triggered builds use to a different source repository.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sourceStamps</span></code></dt>
<dd>Accepts a list of dictionaries containing the keys <code class="docutils literal notranslate"><span class="pre">branch</span></code>, <code class="docutils literal notranslate"><span class="pre">revision</span></code>, <code class="docutils literal notranslate"><span class="pre">repository</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, and optionally <code class="docutils literal notranslate"><span class="pre">patch_level</span></code>, <code class="docutils literal notranslate"><span class="pre">patch_body</span></code>, <code class="docutils literal notranslate"><span class="pre">patch_subdir</span></code>, <code class="docutils literal notranslate"><span class="pre">patch_author</span></code> and <code class="docutils literal notranslate"><span class="pre">patch_comment</span></code> and creates the corresponding SourceStamps.
If only one sourceStamp has to be specified then the argument <code class="docutils literal notranslate"><span class="pre">sourceStamp</span></code> can be used for a dictionary containing the keys mentioned above.
The arguments <code class="docutils literal notranslate"><span class="pre">updateSourceStamp</span></code>, <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code>, and <code class="docutils literal notranslate"><span class="pre">sourceStamp</span></code> can be specified using properties.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">set_properties</span></code></dt>
<dd><p class="first">allows control of the properties that are passed to the triggered scheduler.
The parameter takes a dictionary mapping property names to values.
You may use <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> here to dynamically construct new property values.
For the simple case of copying a property, this might look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">set_properties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;my_prop1&quot;</span> <span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s2">&quot;my_prop1&quot;</span><span class="p">),</span>
                <span class="s2">&quot;my_prop2&quot;</span> <span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s2">&quot;my_prop2&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">Property</span></code> is an instance of <code class="docutils literal notranslate"><span class="pre">buildbot.process.properties.Property</span></code></p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">copy_properties</span></code> parameter, given a list of properties to copy into the new build request, has been deprecated in favor of explicit use of <code class="docutils literal notranslate"><span class="pre">set_properties</span></code>.</p>
</div>
</dd>
</dl>
<div class="section" id="dynamic-trigger">
<span id="id19"></span><h6><a class="toc-backref" href="#id77">Dynamic Trigger</a><a class="headerlink" href="#dynamic-trigger" title="Permalink to this headline">¶</a></h6>
<p>Sometimes it is desirable to select which scheduler to trigger, and which properties to set dynamically, at the time of the build.
For this purpose, Trigger step supports a method that you can customize in order to override statically defined <code class="docutils literal notranslate"><span class="pre">schedulernames</span></code>, <code class="docutils literal notranslate"><span class="pre">set_properties</span></code> and optionally <code class="docutils literal notranslate"><span class="pre">unimportant</span></code>.</p>
<dl class="method">
<dt id="buildbot.steps.source.getSchedulersAndProperties">
<code class="descclassname">buildbot.steps.source.</code><code class="descname">getSchedulersAndProperties</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.steps.source.getSchedulersAndProperties" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of dictionaries containing the keys ‘sched_name’, ‘props_to_set’ and ‘unimportant’ optionally via deferred</td>
</tr>
</tbody>
</table>
<p>This method returns a list of dictionaries describing what scheduler to trigger, with which properties and if the scheduler is unimportant.
Old style list of tuples is still supported, in which case unimportant is considered <code class="docutils literal notranslate"><span class="pre">False</span></code>.
The properties should already be rendered (ie, concrete value, not objects wrapped by <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code> or
<code class="docutils literal notranslate"><span class="pre">Property</span></code>). Since this function happens at build-time, the property values are available from the
step and can be used to decide what schedulers or properties to use.</p>
<p>With this method, you can also trigger the same scheduler multiple times with different set of properties.
The sourcestamp configuration is however the same for each triggered build request.</p>
</dd></dl>

</div>
</div>
<div class="section" id="rpm-related-steps">
<h5><a class="toc-backref" href="#id78">2.5.10.12. RPM-Related Steps</a><a class="headerlink" href="#rpm-related-steps" title="Permalink to this headline">¶</a></h5>
<p>These steps work with RPMs and spec files.</p>
<div class="section" id="rpmbuild">
<span id="step-RpmBuild"></span><h6><a class="toc-backref" href="#id79">RpmBuild</a><a class="headerlink" href="#rpmbuild" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-RpmBuild" title="RpmBuild"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">RpmBuild</span></code></a> step builds RPMs based on a spec file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">RpmBuild</span><span class="p">(</span><span class="n">specfile</span><span class="o">=</span><span class="s2">&quot;proj.spec&quot;</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="s1">&#39;.el5&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">specfile</span></code></dt>
<dd>The <code class="docutils literal notranslate"><span class="pre">.spec</span></code> file to build from</dd>
<dt><code class="docutils literal notranslate"><span class="pre">topdir</span></code></dt>
<dd>Definition for <code class="docutils literal notranslate"><span class="pre">_topdir</span></code>, defaulting to the workdir.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builddir</span></code></dt>
<dd>Definition for <code class="docutils literal notranslate"><span class="pre">_builddir</span></code>, defaulting to the workdir.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rpmdir</span></code></dt>
<dd>Definition for <code class="docutils literal notranslate"><span class="pre">_rpmdir</span></code>, defaulting to the workdir.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sourcedir</span></code></dt>
<dd>Definition for <code class="docutils literal notranslate"><span class="pre">_sourcedir</span></code>, defaulting to the workdir.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">srcrpmdir</span></code></dt>
<dd>Definition for <code class="docutils literal notranslate"><span class="pre">_srcrpmdir</span></code>, defaulting to the workdir.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dist</span></code></dt>
<dd>Distribution to build, used as the definition for <code class="docutils literal notranslate"><span class="pre">_dist</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">define</span></code></dt>
<dd>A dictionary of additional definitions to declare.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">autoRelease</span></code></dt>
<dd>If true, use the auto-release mechanics.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">vcsRevision</span></code></dt>
<dd>If true, use the version-control revision mechanics.
This uses the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property to determine the revision and define <code class="docutils literal notranslate"><span class="pre">_revision</span></code>.
Note that this will not work with multi-codebase builds.</dd>
</dl>
</div>
<div class="section" id="rpmlint">
<span id="step-RpmLint"></span><h6><a class="toc-backref" href="#id80">RpmLint</a><a class="headerlink" href="#rpmlint" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-RpmLint" title="RpmLint"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">RpmLint</span></code></a> step checks for common problems in RPM packages or spec files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">RpmLint</span><span class="p">())</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">fileloc</span></code></dt>
<dd>The file or directory to check.
In case of a directory, it is recursively searched for RPMs and spec files to check.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">config</span></code></dt>
<dd>Path to a rpmlint config file.
This is passed as the user configuration file if present.</dd>
</dl>
</div>
<div class="section" id="mock-steps">
<h6><a class="toc-backref" href="#id81">Mock Steps</a><a class="headerlink" href="#mock-steps" title="Permalink to this headline">¶</a></h6>
<p>Mock (<a class="reference external" href="http://fedoraproject.org/wiki/Projects/Mock">http://fedoraproject.org/wiki/Projects/Mock</a>) creates chroots and builds packages in them.
It populates the changeroot with a basic system and the packages listed as build requirement.
The type of chroot to build is specified with the <code class="docutils literal notranslate"><span class="pre">root</span></code> parameter.
To use mock your Buildbot user must be added to the <code class="docutils literal notranslate"><span class="pre">mock</span></code> group.</p>
</div>
<div class="section" id="mockbuildsrpm-step">
<span id="step-MockBuildSRPM"></span><h6><a class="toc-backref" href="#id82">MockBuildSRPM Step</a><a class="headerlink" href="#mockbuildsrpm-step" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-MockBuildSRPM" title="MockBuildSRPM"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MockBuildSRPM</span></code></a> step builds a SourceRPM based on a spec file and optionally a source directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MockBuildSRPM</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="s1">&#39;mypkg.spec&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">root</span></code></dt>
<dd>Use chroot configuration defined in <code class="docutils literal notranslate"><span class="pre">/etc/mock/&lt;root&gt;.cfg</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">resultdir</span></code></dt>
<dd>The directory where the logfiles and the SourceRPM are written to.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">spec</span></code></dt>
<dd>Build the SourceRPM from this spec file.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sources</span></code></dt>
<dd>Path to the directory containing the sources, defaulting to <code class="docutils literal notranslate"><span class="pre">.</span></code>.</dd>
</dl>
</div>
<div class="section" id="mockrebuild-step">
<span id="step-MockRebuild"></span><h6><a class="toc-backref" href="#id83">MockRebuild Step</a><a class="headerlink" href="#mockrebuild-step" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-MockRebuild" title="MockRebuild"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MockRebuild</span></code></a> step rebuilds a SourceRPM package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MockRebuild</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="s1">&#39;mypkg-1.0-1.src.rpm&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">root</span></code></dt>
<dd>Uses chroot configuration defined in <code class="docutils literal notranslate"><span class="pre">/etc/mock/&lt;root&gt;.cfg</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">resultdir</span></code></dt>
<dd>The directory where the logfiles and the SourceRPM are written to.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">srpm</span></code></dt>
<dd>The path to the SourceRPM to rebuild.</dd>
</dl>
</div>
</div>
<div class="section" id="debian-build-steps">
<h5><a class="toc-backref" href="#id84">2.5.10.13. Debian Build Steps</a><a class="headerlink" href="#debian-build-steps" title="Permalink to this headline">¶</a></h5>
<div class="section" id="debpbuilder">
<span id="step-DebPbuilder"></span><h6><a class="toc-backref" href="#id85">DebPbuilder</a><a class="headerlink" href="#debpbuilder" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-DebPbuilder" title="DebPbuilder"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">DebPbuilder</span></code></a> step builds Debian packages within a chroot built by <strong class="command">pbuilder</strong>.
It populates the chroot with a basic system and the packages listed as build requirement.
The type of the chroot to build is specified with the <code class="docutils literal notranslate"><span class="pre">distribution</span></code>, <code class="docutils literal notranslate"><span class="pre">distribution</span></code> and <code class="docutils literal notranslate"><span class="pre">mirror</span></code> parameter.
To use pbuilder your Buildbot user must have the right to run <strong class="command">pbuilder</strong> as root using <strong class="command">sudo</strong>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">DebPbuilder</span><span class="p">())</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">architecture</span></code></dt>
<dd>Architecture to build chroot for.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">distribution</span></code></dt>
<dd>Name, or nickname, of the distribution.
Defaults to ‘stable’.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">basetgz</span></code></dt>
<dd>Path of the basetgz to use for building.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mirror</span></code></dt>
<dd>URL of the mirror used to download the packages from.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extrapackages</span></code></dt>
<dd>List if packages to install in addition to the base system.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">keyring</span></code></dt>
<dd>Path to a gpg keyring to verify the downloaded packages.
This is necessary if you build for a foreign distribution.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">components</span></code></dt>
<dd>Repos to activate for chroot building.</dd>
</dl>
</div>
<div class="section" id="debcowbuilder">
<span id="step-DebCowbuilder"></span><h6><a class="toc-backref" href="#id86">DebCowbuilder</a><a class="headerlink" href="#debcowbuilder" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-DebCowbuilder" title="DebCowbuilder"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">DebCowbuilder</span></code></a> step is a subclass of <a class="reference internal" href="#step-DebPbuilder" title="DebPbuilder"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">DebPbuilder</span></code></a>, which use cowbuilder instead of pbuilder.</p>
</div>
<div class="section" id="deblintian">
<span id="step-DebLintian"></span><h6><a class="toc-backref" href="#id87">DebLintian</a><a class="headerlink" href="#deblintian" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-DebLintian" title="DebLintian"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">DebLintian</span></code></a> step checks a build .deb for bugs and policy violations.
The packages or changes file to test is specified in <code class="docutils literal notranslate"><span class="pre">fileloc</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">DebLintian</span><span class="p">(</span><span class="n">fileloc</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;%(prop:deb-changes)s&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="miscellaneous-buildsteps">
<h5><a class="toc-backref" href="#id88">2.5.10.14. Miscellaneous BuildSteps</a><a class="headerlink" href="#miscellaneous-buildsteps" title="Permalink to this headline">¶</a></h5>
<p>A number of steps do not fall into any particular category.</p>
<div class="section" id="hlint">
<span id="step-HLint"></span><h6><a class="toc-backref" href="#id89">HLint</a><a class="headerlink" href="#hlint" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-HLint" title="HLint"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">HLint</span></code></a> step runs Twisted Lore, a lint-like checker over a set of <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code> files.
Any deviations from recommended style is flagged and put in the output log.</p>
<p>The step looks at the list of changes in the build to determine which files to check - it does not check all files.
It specifically excludes any <code class="docutils literal notranslate"><span class="pre">.xhtml</span></code> files in the top-level <code class="docutils literal notranslate"><span class="pre">sandbox/</span></code> directory.</p>
<p>The step takes a single, optional, parameter: <code class="docutils literal notranslate"><span class="pre">python</span></code>.
This specifies the Python executable to use to run Lore.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">HLint</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="maxq">
<h6><a class="toc-backref" href="#id90">MaxQ</a><a class="headerlink" href="#maxq" title="Permalink to this headline">¶</a></h6>
<p id="step-MaxQ">MaxQ (<a class="reference external" href="http://maxq.tigris.org/">http://maxq.tigris.org/</a>) is a web testing tool that allows you to record HTTP sessions and play them back.
The <a class="reference internal" href="#step-MaxQ" title="MaxQ"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MaxQ</span></code></a> step runs this framework.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">MaxQ</span><span class="p">(</span><span class="n">testdir</span><span class="o">=</span><span class="s1">&#39;tests/&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The single argument, <code class="docutils literal notranslate"><span class="pre">testdir</span></code>, specifies where the tests should be run.
This directory will be passed to the <code class="docutils literal notranslate"><span class="pre">run_maxq.py</span></code> command, and the results analyzed.</p>
<span class="target" id="index-34"></span><span class="target" id="step-HTTPStep"></span><span class="target" id="step-POST"></span><span class="target" id="step-GET"></span><span class="target" id="step-PUT"></span><span class="target" id="step-DELETE"></span><span class="target" id="step-HEAD"></span></div>
<div class="section" id="http-requests">
<span id="step-OPTIONS"></span><h6><a class="toc-backref" href="#id91">HTTP Requests</a><a class="headerlink" href="#http-requests" title="Permalink to this headline">¶</a></h6>
<p>Using the <a class="reference internal" href="#step-HTTPStep" title="HTTPStep"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">HTTPStep</span></code></a> step, it is possible to perform HTTP requests in order to trigger another REST service about the progress of the build.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This step requires the <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> and <a class="reference external" href="http://python-requests.org">requests</a> Python libraries.</p>
</div>
<p>The parameters are the following:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">url</span></code></dt>
<dd>(mandatory) The URL where to send the request</dd>
<dt><code class="docutils literal notranslate"><span class="pre">method</span></code></dt>
<dd>The HTTP method to use (out of <code class="docutils literal notranslate"><span class="pre">POST</span></code>, <code class="docutils literal notranslate"><span class="pre">GET</span></code>, <code class="docutils literal notranslate"><span class="pre">PUT</span></code>, <code class="docutils literal notranslate"><span class="pre">DELETE</span></code>, <code class="docutils literal notranslate"><span class="pre">HEAD</span></code> or <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code>), default to <code class="docutils literal notranslate"><span class="pre">POST</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">params</span></code></dt>
<dd>Dictionary of URL parameters to append to the URL.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt>
<dd>The body to attach the request.
If a dictionary is provided, form-encoding will take place.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">headers</span></code></dt>
<dd>Dictionary of headers to send.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">other</span> <span class="pre">params</span></code></dt>
<dd><p class="first">Any other keywords supported by the <code class="docutils literal notranslate"><span class="pre">requests</span></code>
<a class="reference external" href="http://docs.python-requests.org/en/master/api/#main-interface">api</a>
can be passed to this step.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The entire Buildbot master process shares a single Requests <code class="docutils literal notranslate"><span class="pre">Session</span></code> object.
This has the advantage of supporting connection re-use and other HTTP/1.1 features.
However, it also means that any cookies or other state changed by one step will be visible to other steps, causing unexpected results.
This behavior may change in future versions.</p>
</div>
</dd>
</dl>
<p>When the method is known in advance, class with the name of the method can also be used.
In this case, it is not necessary to specify the method.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">POST</span><span class="p">(</span><span class="s1">&#39;http://myRESTService.example.com/builds&#39;</span><span class="p">,</span>
                     <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;builder&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;buildername&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;buildnumber&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;buildnumber&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;workername&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;revision&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;got_revision&#39;</span><span class="p">)</span>
                     <span class="p">}))</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-manual/configuration/interlocks"></span><div class="section" id="interlocks">
<span id="id1"></span><h4>2.5.11. Interlocks<a class="headerlink" href="#interlocks" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#access-modes" id="id9">Access Modes</a></li>
<li><a class="reference internal" href="#count" id="id10">Count</a></li>
<li><a class="reference internal" href="#scope" id="id11">Scope</a></li>
<li><a class="reference internal" href="#examples" id="id12">Examples</a></li>
</ul>
</div>
<p>Until now, we assumed that a master can run builds at any worker whenever needed or desired.
Some times, you want to enforce additional constraints on builds.
For reasons like limited network bandwidth, old worker machines, or a self-willed data base server, you may want to limit the number of builds (or build steps) that can access a resource.</p>
<div class="section" id="access-modes">
<span id="id2"></span><h5><a class="toc-backref" href="#id9">2.5.11.1. Access Modes</a><a class="headerlink" href="#access-modes" title="Permalink to this headline">¶</a></h5>
<p>The mechanism used by Buildbot is known as the read/write lock <a class="footnote-reference" href="#id6" id="id3">[1]</a>.
It allows either many readers or a single writer but not a combination of readers and writers.
The general lock has been modified and extended for use in Buildbot.
Firstly, the general lock allows an infinite number of readers.
In Buildbot, we often want to put an upper limit on the number of readers, for example allowing two out of five possible builds at the same time.
To do this, the lock counts the number of active readers.
Secondly, the terms <em>read mode</em> and <em>write mode</em> are confusing in Buildbot context.
They have been replaced by <em>counting mode</em> (since the lock counts them) and <em>exclusive mode</em>.
As a result of these changes, locks in Buildbot allow a number of builds (up to some fixed number) in counting mode, or they allow one build in exclusive mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Access modes are specified when a lock is used.
That is, it is possible to have a single lock that is used by several workers in counting mode, and several workers in exclusive mode.
In fact, this is the strength of the modes: accessing a lock in exclusive mode will prevent all counting-mode accesses.</p>
</div>
</div>
<div class="section" id="count">
<h5><a class="toc-backref" href="#id10">2.5.11.2. Count</a><a class="headerlink" href="#count" title="Permalink to this headline">¶</a></h5>
<p>Often, not all workers are equal.
To allow for this situation, Buildbot allows to have a separate upper limit on the count for each worker.
In this way, you can have at most 3 concurrent builds at a fast worker, 2 at a slightly older worker, and 1 at all other workers.</p>
</div>
<div class="section" id="scope">
<h5><a class="toc-backref" href="#id11">2.5.11.3. Scope</a><a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h5>
<p>The final thing you can specify when you introduce a new lock is its scope.
Some constraints are global – they must be enforced over all workers.
Other constraints are local to each worker.
A <em>master lock</em> is used for the global constraints.
You can ensure for example that at most one build (of all builds running at all workers) accesses the data base server.
With a <em>worker lock</em> you can add a limit local to each worker.
With such a lock, you can for example enforce an upper limit to the number of active builds at a worker, like above.</p>
</div>
<div class="section" id="examples">
<h5><a class="toc-backref" href="#id12">2.5.11.4. Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<p>Time for a few examples.
Below a master lock is defined to protect a data base, and a worker lock is created to limit the number of builds at each worker.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="n">db_lock</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">MasterLock</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">)</span>
<span class="n">build_lock</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">WorkerLock</span><span class="p">(</span><span class="s2">&quot;worker_builds&quot;</span><span class="p">,</span>
                             <span class="n">maxCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">maxCountForWorker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
<p><code class="xref py py-data docutils literal notranslate"><span class="pre">db_lock</span></code> is defined to be a master lock.
The <code class="docutils literal notranslate"><span class="pre">database</span></code> string is used for uniquely identifying the lock.
At the next line, a worker lock called <code class="xref py py-data docutils literal notranslate"><span class="pre">build_lock</span></code> is created.
It is identified by the <code class="docutils literal notranslate"><span class="pre">worker_builds</span></code> string.
Since the requirements of the lock are a bit more complicated, two optional arguments are also specified.
The <code class="docutils literal notranslate"><span class="pre">maxCount</span></code> parameter sets the default limit for builds in counting mode to <code class="docutils literal notranslate"><span class="pre">1</span></code>.
For the worker called <code class="docutils literal notranslate"><span class="pre">'fast'</span></code> however, we want to have at most three builds, and for the worker called <code class="docutils literal notranslate"><span class="pre">'new'</span></code> the upper limit is two builds running at the same time.</p>
<p>The next step is accessing the locks in builds.
Buildbot allows a lock to be used during an entire build (from beginning to end), or only during a single build step.
In the latter case, the lock is claimed for use just before the step starts, and released again when the step ends.
To prevent deadlocks, <a class="footnote-reference" href="#id7" id="id4">[2]</a> it is not possible to claim or release locks at other times.</p>
<p>To use locks, you add them with a <code class="docutils literal notranslate"><span class="pre">locks</span></code> argument to a build or a step.
Each use of a lock is either in counting mode (that is, possibly shared with other builds) or in exclusive mode, and this is indicated with the syntax <code class="docutils literal notranslate"><span class="pre">lock.access(mode)</span></code>, where <code class="xref py py-data docutils literal notranslate"><span class="pre">mode</span></code> is one of <code class="docutils literal notranslate"><span class="pre">&quot;counting&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;exclusive&quot;</span></code>.</p>
<p>A build or build step proceeds only when it has acquired all locks.
If a build or step needs a lot of locks, it may be starved <a class="footnote-reference" href="#id8" id="id5">[3]</a> by other builds that need fewer locks.</p>
<p>To illustrate use of locks, a few examples.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">steps</span>

<span class="n">db_lock</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">MasterLock</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">)</span>
<span class="n">build_lock</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">WorkerLock</span><span class="p">(</span><span class="s2">&quot;worker_builds&quot;</span><span class="p">,</span>
                             <span class="n">maxCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">maxCountForWorker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;http://example.org/svn/Trunk&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;make all&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;make test&quot;</span><span class="p">,</span>
                             <span class="n">locks</span><span class="o">=</span><span class="p">[</span><span class="n">db_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;exclusive&#39;</span><span class="p">)]))</span>

<span class="n">b1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;full1&#39;</span><span class="p">,</span> <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;fast&#39;</span><span class="p">,</span>  <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s1">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;full2&#39;</span><span class="p">,</span> <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span>   <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;f2&#39;</span><span class="p">,</span> <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s1">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b3</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;full3&#39;</span><span class="p">,</span> <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;old&#39;</span><span class="p">,</span>   <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;f3&#39;</span><span class="p">,</span> <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s1">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b4</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;full4&#39;</span><span class="p">,</span> <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;f4&#39;</span><span class="p">,</span> <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s1">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">]</span>
</pre></div>
</div>
<p>Here we have four workers <code class="xref py py-data docutils literal notranslate"><span class="pre">fast</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">new</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">old</span></code>, and <code class="xref py py-data docutils literal notranslate"><span class="pre">other</span></code>.
Each worker performs the same checkout, make, and test build step sequence.
We want to enforce that at most one test step is executed between all workers due to restrictions with the data base server.
This is done by adding the <code class="docutils literal notranslate"><span class="pre">locks=</span></code> parameter with the third step.
It takes a list of locks with their access mode.
Alternatively, this can take a renderable that returns an list of locks with their access mode.</p>
<p>In this case only the <code class="xref py py-data docutils literal notranslate"><span class="pre">db_lock</span></code> is needed.
The exclusive access mode is used to ensure there is at most one worker that executes the test step.</p>
<p>In addition to exclusive accessing the data base, we also want workers to stay responsive even under the load of a large number of builds being triggered.
For this purpose, the worker lock called <code class="xref py py-data docutils literal notranslate"><span class="pre">build_lock</span></code> is defined.
Since the restraint holds for entire builds, the lock is specified in the builder with <code class="docutils literal notranslate"><span class="pre">'locks':</span> <span class="pre">[build_lock.access('counting')]</span></code>.</p>
<p>Note that you will occasionally see <code class="docutils literal notranslate"><span class="pre">lock.access(mode)</span></code> written as <code class="docutils literal notranslate"><span class="pre">LockAccess(lock,</span> <span class="pre">mode)</span></code>.
The two are equivalent, but the former is preferred.</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>See <a class="reference external" href="http://en.wikipedia.org/wiki/Read/write_lock_pattern">http://en.wikipedia.org/wiki/Read/write_lock_pattern</a> for more information.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>Deadlock is the situation where two or more workers each hold a lock in exclusive mode, and in addition want to claim the lock held by the other worker exclusively as well.
Since locks allow at most one exclusive user, both workers will wait forever.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td>Starving is the situation that only a few locks are available, and they are immediately grabbed by another build.
As a result, it may take a long time before all locks needed by the starved build are free at the same time.</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-manual/configuration/reporters"></span><div class="section" id="reporters">
<span id="cfg-reporter"></span><span id="id1"></span><h4>2.5.12. Reporters<a class="headerlink" href="#reporters" title="Permalink to this headline">¶</a></h4>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#mailnotifier" id="id5">MailNotifier</a><ul>
<li><a class="reference internal" href="#mailnotifier-arguments" id="id6">MailNotifier arguments</a></li>
<li><a class="reference internal" href="#messageformatter-arguments" id="id7">MessageFormatter arguments</a></li>
<li><a class="reference internal" href="#messageformattermissingworkers-arguments" id="id8">MessageFormatterMissingWorkers arguments</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pushover-notifications" id="id9">Pushover Notifications</a></li>
<li><a class="reference internal" href="#pushjet-notifications" id="id10">Pushjet Notifications</a></li>
<li><a class="reference internal" href="#irc-bot" id="id11">IRC Bot</a></li>
<li><a class="reference internal" href="#gerritstatuspush" id="id12">GerritStatusPush</a></li>
<li><a class="reference internal" href="#httpstatuspush" id="id13">HttpStatusPush</a><ul>
<li><a class="reference internal" href="#json-object-spec" id="id14">Json object spec</a></li>
</ul>
</li>
<li><a class="reference internal" href="#githubstatuspush" id="id15">GitHubStatusPush</a></li>
<li><a class="reference internal" href="#githubcommentpush" id="id16">GitHubCommentPush</a></li>
<li><a class="reference internal" href="#bitbucketserverstatuspush" id="id17">BitbucketServerStatusPush</a></li>
<li><a class="reference internal" href="#bitbucketserverprcommentpush" id="id18">BitbucketServerPRCommentPush</a></li>
<li><a class="reference internal" href="#bitbucketstatuspush" id="id19">BitbucketStatusPush</a></li>
<li><a class="reference internal" href="#gitlabstatuspush" id="id20">GitLabStatusPush</a></li>
<li><a class="reference internal" href="#hipchatstatuspush" id="id21">HipchatStatusPush</a><ul>
<li><a class="reference internal" href="#id3" id="id22">Json object spec</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gerritverifystatuspush" id="id23">GerritVerifyStatusPush</a></li>
</ul>
</div>
<p>The Buildmaster has a variety of ways to present build status to various users.
Each such delivery method is a <cite>Reporter Target</cite> object in the configuration’s <code class="docutils literal notranslate"><span class="pre">services</span></code> list.
To add reporter targets, you just append more objects to this list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;buildbot@localhost&quot;</span><span class="p">,</span>
                           <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;builds@lists.example.com&quot;</span><span class="p">],</span>
                           <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reporters</span><span class="o">.</span><span class="n">IRC</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s2">&quot;irc.example.com&quot;</span><span class="p">,</span> <span class="n">nick</span><span class="o">=</span><span class="s2">&quot;bb&quot;</span><span class="p">,</span>
                                  <span class="n">channels</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;#example1&quot;</span><span class="p">},</span>
                                            <span class="p">{</span><span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;#example2&quot;</span><span class="p">,</span>
                                             <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;somesecretpassword&quot;</span><span class="p">}]))</span>
</pre></div>
</div>
<p>Most reporter objects take a <code class="docutils literal notranslate"><span class="pre">tags=</span></code> argument, which can contain a list of tag names: in this case, it will only show status for Builders that contains the named tags.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Implementation Note</p>
<p class="last">Each of these objects should be a <code class="xref py py-class docutils literal notranslate"><span class="pre">service.BuildbotService</span></code> which will be attached to the BuildMaster object when the configuration is processed.</p>
</div>
<p>The remainder of this section describes each built-in reporters.
A full list of reporters is available in the <a class="reference internal" href="bb-reporter.html" title="Reporter Target Index"><em>Reporter Target Index</em></a>.</p>
<span class="target" id="reporter-MailNotifier"></span><div class="section" id="mailnotifier">
<span id="index-0"></span><h5><a class="toc-backref" href="#id5">2.5.12.1. MailNotifier</a><a class="headerlink" href="#mailnotifier" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.mail.MailNotifier">
<em class="property">class </em><code class="descclassname">buildbot.reporters.mail.</code><code class="descname">MailNotifier</code><a class="headerlink" href="#buildbot.reporters.mail.MailNotifier" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The Buildbot can send email when builds finish.
The most common use of this is to tell developers when their change has caused the build to fail.
It is also quite common to send a message to a mailing list (usually named <cite>builds</cite> or similar) about every build.</p>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> reporter is used to accomplish this.
You configure it by specifying who mail should be sent to, under what circumstances mail should be sent, and how to deliver the mail.
It can be configured to only send out mail for certain builders, and only send messages when the build fails, or when the builder transitions from success to failure.
It can also be configured to include various build logs in each message.</p>
<p>If a proper lookup function is configured, the message will be sent to the “interested users” list (<a class="reference internal" href="#doing-things-with-users"><span class="std std-ref">Doing Things With Users</span></a>), which includes all developers who made changes in the build.
By default, however, Buildbot does not know how to construct an email addressed based on the information from the version control system.
See the <code class="docutils literal notranslate"><span class="pre">lookup</span></code> argument, below, for more information.</p>
<p>You can add additional, statically-configured, recipients with the <code class="docutils literal notranslate"><span class="pre">extraRecipients</span></code> argument.
You can also add interested users by setting the <code class="docutils literal notranslate"><span class="pre">owners</span></code> build property to a list of users in the scheduler constructor (<a class="reference internal" href="#configuring-schedulers"><span class="std std-ref">Configuring Schedulers</span></a>).</p>
<p>Each <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> sends mail to a single set of recipients.
To send different kinds of mail to different recipients, use multiple <code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code>s.
TODO: or subclass MailNotifier and override getRecipients()</p>
<p>The following simple example will send an email upon the completion of each build, to just those developers whose <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s were included in the build.
The email contains a description of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>, its results, and URLs where more information can be obtained.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>
<span class="n">mn</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                            <span class="n">lookup</span><span class="o">=</span><span class="s2">&quot;example.org&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span>
</pre></div>
</div>
<p>To get a simple one-message-per-build (say, for a mailing list), use the following form instead.
This form does not send mail to individual developers (and thus does not need the <code class="docutils literal notranslate"><span class="pre">lookup=</span></code> argument, explained below), instead it only ever sends mail to the <cite>extra recipients</cite> named in the arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mn</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                            <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;listaddr@example.org&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>If your SMTP host requires authentication before it allows you to send emails, this can also be done by specifying <code class="docutils literal notranslate"><span class="pre">smtpUser</span></code> and <code class="docutils literal notranslate"><span class="pre">smtpPassword</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mn</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;myuser@example.com&quot;</span><span class="p">,</span>
                            <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;listaddr@example.org&quot;</span><span class="p">],</span>
                            <span class="n">relayhost</span><span class="o">=</span><span class="s2">&quot;smtp.example.com&quot;</span><span class="p">,</span> <span class="n">smtpPort</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span>
                            <span class="n">smtpUser</span><span class="o">=</span><span class="s2">&quot;myuser@example.com&quot;</span><span class="p">,</span>
                            <span class="n">smtpPassword</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If for some reasons you are not able to send a notification with TLS enabled and specified user name and password, you might want to use <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/check_smtp.py">master/contrib/check_smtp.py</a> to see if it works at all.</p>
</div>
<p>If you want to require Transport Layer Security (TLS), then you can also set <code class="docutils literal notranslate"><span class="pre">useTls</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mn</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;myuser@example.com&quot;</span><span class="p">,</span>
                            <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;listaddr@example.org&quot;</span><span class="p">],</span>
                            <span class="n">useTls</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">relayhost</span><span class="o">=</span><span class="s2">&quot;smtp.example.com&quot;</span><span class="p">,</span>
                            <span class="n">smtpPort</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span> <span class="n">smtpUser</span><span class="o">=</span><span class="s2">&quot;myuser@example.com&quot;</span><span class="p">,</span>
                            <span class="n">smtpPassword</span><span class="o">=</span><span class="s2">&quot;mypassword&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you see <code class="docutils literal notranslate"><span class="pre">twisted.mail.smtp.TLSRequiredError</span></code> exceptions in the log while using TLS, this can be due <em>either</em> to the server not supporting TLS or to a missing <a class="reference external" href="http://pyopenssl.sourceforge.net/">PyOpenSSL</a> package on the BuildMaster system.</p>
</div>
<p>In some cases it is desirable to have different information then what is provided in a standard MailNotifier message.
For this purpose MailNotifier provides the argument <code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code> (an instance of <code class="docutils literal notranslate"><span class="pre">MessageFormatter</span></code>) which allows for the creation of messages with unique content.</p>
<p>For example, if only short emails are desired (e.g., for delivery to phones):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>
<span class="n">mn</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                            <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;problem&#39;</span><span class="p">,),</span>
                            <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;listaddr@example.org&#39;</span><span class="p">],</span>
                            <span class="n">messageFormatter</span><span class="o">=</span><span class="n">reporters</span><span class="o">.</span><span class="n">MessageFormatter</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;STATUS: {{ summary }}&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Another example of a function delivering a customized html email is given below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>

<span class="n">template</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">&lt;h4&gt;Build status: {{ summary }}&lt;/h4&gt;</span>
<span class="s1">&lt;p&gt; Worker used: {{ workername }}&lt;/p&gt;</span>
<span class="s1">{</span><span class="si">% f</span><span class="s1">or step in build[&#39;steps&#39;] %}</span>
<span class="s1">&lt;p&gt; {{ step[&#39;name&#39;] }}: {{ step[&#39;result&#39;] }}&lt;/p&gt;</span>
<span class="s1">{</span><span class="si">% e</span><span class="s1">ndfor %}</span>
<span class="s1">&lt;p&gt;&lt;b&gt; -- The Buildbot&lt;/b&gt;&lt;/p&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">mn</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                            <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;failing&#39;</span><span class="p">,),</span>
                            <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;listaddr@example.org&#39;</span><span class="p">],</span>
                            <span class="n">messageFormatter</span><span class="o">=</span><span class="n">reporters</span><span class="o">.</span><span class="n">MessageFormatter</span><span class="p">(</span>
                                <span class="n">template</span><span class="o">=</span><span class="n">template</span><span class="p">,</span> <span class="n">template_type</span><span class="o">=</span><span class="s1">&#39;html&#39;</span><span class="p">,</span>
                                <span class="n">wantProperties</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wantSteps</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="mailnotifier-arguments">
<h6><a class="toc-backref" href="#id6">MailNotifier arguments</a><a class="headerlink" href="#mailnotifier-arguments" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">fromaddr</span></code></dt>
<dd>The email address to be used in the ‘From’ header.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sendToInterestedUsers</span></code></dt>
<dd>(boolean).
If <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default), send mail to all of the Interested Users.
Interested Users are authors of changes and users from the <code class="docutils literal notranslate"><span class="pre">owners</span></code> build property.
Override <code class="docutils literal notranslate"><span class="pre">MailNotifier</span></code> <code class="docutils literal notranslate"><span class="pre">getResponsibleUsersForBuild</span></code> method to change that.
If <code class="docutils literal notranslate"><span class="pre">False</span></code>, only send mail to the <code class="docutils literal notranslate"><span class="pre">extraRecipients</span></code> list.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extraRecipients</span></code></dt>
<dd>(list of strings).
A list of email addresses to which messages should be sent (in addition to the InterestedUsers list, which includes any developers who made <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>s that went into this build).
It is a good idea to create a small mailing list and deliver to that, then let subscribers come and go as they please.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">subject</span></code></dt>
<dd>(string).
A string to be used as the subject line of the message.
<code class="docutils literal notranslate"><span class="pre">%(builder)s</span></code> will be replaced with the name of the builder which provoked the message.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mode</span></code></dt>
<dd><p class="first">Mode is a list of strings; however there are two strings which can be used as shortcuts instead of the full lists.
The possible shortcuts are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">all</span></code></dt>
<dd>Always send mail about builds.
Equivalent to (<code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">failing</span></code>, <code class="docutils literal notranslate"><span class="pre">passing</span></code>, <code class="docutils literal notranslate"><span class="pre">problem</span></code>, <code class="docutils literal notranslate"><span class="pre">warnings</span></code>, <code class="docutils literal notranslate"><span class="pre">exception</span></code>).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">warnings</span></code></dt>
<dd>Equivalent to (<code class="docutils literal notranslate"><span class="pre">warnings</span></code>, <code class="docutils literal notranslate"><span class="pre">failing</span></code>).</dd>
</dl>
<p>Set these shortcuts as actual strings in the configuration:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>
<span class="n">mn</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s2">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;warnings&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span>
</pre></div>
</div>
<p>(list of strings).
A combination of:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">cancelled</span></code></dt>
<dd>Send mail about builds which were cancelled.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">change</span></code></dt>
<dd>Send mail about builds which change status.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">failing</span></code></dt>
<dd>Send mail about builds which fail.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">passing</span></code></dt>
<dd>Send mail about builds which succeed.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">problem</span></code></dt>
<dd>Send mail about a build which failed when the previous build has passed.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">warnings</span></code></dt>
<dd>Send mail about builds which generate warnings.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">exception</span></code></dt>
<dd>Send mail about builds which generate exceptions.</dd>
</dl>
<p class="last">Defaults to (<code class="docutils literal notranslate"><span class="pre">failing</span></code>, <code class="docutils literal notranslate"><span class="pre">passing</span></code>, <code class="docutils literal notranslate"><span class="pre">warnings</span></code>).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builders</span></code></dt>
<dd>(list of strings).
A list of builder names for which mail should be sent.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> (send mail for all builds).
Use either builders or tags, but not both.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tags</span></code></dt>
<dd>(list of strings).
A list of tag names to serve status information for.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> (all tags).
Use either builders or tags, but not both.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">schedulers</span></code></dt>
<dd>(list of strings).
A list of scheduler names to serve status information for.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> (all schedulers).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branches</span></code></dt>
<dd>(list of strings).
A list of branch names to serve status information for.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> (all branches).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">addLogs</span></code></dt>
<dd>(boolean).
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, include all build logs as attachments to the messages.
These can be quite large.
This can also be set to a list of log names, to send a subset of the logs.
Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">addPatch</span></code></dt>
<dd>(boolean).
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, include the patch content if a patch was present.
Patches are usually used on a <code class="xref py py-class docutils literal notranslate"><span class="pre">Try</span></code> server.
Defaults to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buildSetSummary</span></code></dt>
<dd>(boolean).
If <code class="docutils literal notranslate"><span class="pre">True</span></code>, send a single summary email consisting of the concatenation of all build completion messages rather than a completion message for each build.
Defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">relayhost</span></code></dt>
<dd>(string).
The host to which the outbound SMTP connection should be made.
Defaults to ‘localhost’</dd>
<dt><code class="docutils literal notranslate"><span class="pre">smtpPort</span></code></dt>
<dd>(int).
The port that will be used on outbound SMTP connections.
Defaults to 25.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">useTls</span></code></dt>
<dd>(boolean).
When this argument is <code class="docutils literal notranslate"><span class="pre">True</span></code> (default is <code class="docutils literal notranslate"><span class="pre">False</span></code>) <code class="docutils literal notranslate"><span class="pre">MailNotifier</span></code> requires that STARTTLS encryption is used for the connection with the <code class="docutils literal notranslate"><span class="pre">relayhost</span></code>.
Authentication is required for STARTTLS so the arguments <code class="docutils literal notranslate"><span class="pre">smtpUser</span></code> and <code class="docutils literal notranslate"><span class="pre">smtpPassword</span></code> must also be specified.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">useSmtps</span></code></dt>
<dd>(boolean).
When this argument is <code class="docutils literal notranslate"><span class="pre">True</span></code> (default is <code class="docutils literal notranslate"><span class="pre">False</span></code>) <code class="docutils literal notranslate"><span class="pre">MailNotifier</span></code> connects to <code class="docutils literal notranslate"><span class="pre">relayhost</span></code> over an encrypted SSL/TLS connection.
This configuration is typically used over port 465.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">smtpUser</span></code></dt>
<dd>(string).
The user name to use when authenticating with the <code class="docutils literal notranslate"><span class="pre">relayhost</span></code>.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">smtpPassword</span></code></dt>
<dd>(string).
The password that will be used when authenticating with the <code class="docutils literal notranslate"><span class="pre">relayhost</span></code>.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lookup</span></code></dt>
<dd><p class="first">(implementer of <code class="xref py py-class docutils literal notranslate"><span class="pre">IEmailLookup</span></code>).
Object which provides <code class="xref py py-class docutils literal notranslate"><span class="pre">IEmailLookup</span></code>, which is responsible for mapping User names (which come from the VC system) into valid email addresses.</p>
<p>If the argument is not provided, the <code class="docutils literal notranslate"><span class="pre">MailNotifier</span></code> will attempt to build the <code class="docutils literal notranslate"><span class="pre">sendToInterestedUsers</span></code> from the authors of the Changes that led to the Build via <a class="reference internal" href="#user-objects"><span class="std std-ref">User Objects</span></a>.
If the author of one of the Build’s Changes has an email address stored, it will added to the recipients list.
With this method, <code class="docutils literal notranslate"><span class="pre">owners</span></code> are still added to the recipients.
Note that, in the current implementation of user objects, email addresses are not stored; as a result, unless you have specifically added email addresses to the user database, this functionality is unlikely to actually send any emails.</p>
<p>Most of the time you can use a simple Domain instance.
As a shortcut, you can pass as string: this will be treated as if you had provided <code class="docutils literal notranslate"><span class="pre">Domain(str)</span></code>.
For example, <code class="docutils literal notranslate"><span class="pre">lookup='example.com'</span></code> will allow mail to be sent to all developers whose SVN usernames match their <code class="docutils literal notranslate"><span class="pre">example.com</span></code> account names.
See <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/reporters/mail.py">master/buildbot/reporters/mail.py</a> for more details.</p>
<p class="last">Regardless of the setting of <code class="docutils literal notranslate"><span class="pre">lookup</span></code>, <code class="docutils literal notranslate"><span class="pre">MailNotifier</span></code> will also send mail to addresses in the <code class="docutils literal notranslate"><span class="pre">extraRecipients</span></code> list.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code></dt>
<dd>This is an optional instance of the <code class="docutils literal notranslate"><span class="pre">reporters.MessageFormatter</span></code> class that can be used to generate a custom mail message.
This class uses the <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/">Jinja2</a> templating language to generate the body and optionally the subject of the mails.
Templates can either be given inline (as string), or read from the filesystem.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">extraHeaders</span></code></dt>
<dd>(dictionary).
A dictionary containing key/value pairs of extra headers to add to sent e-mails.
Both the keys and the values may be a <cite>Interpolate</cite> instance.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">watchedWorkers</span></code></dt>
<dd>This is a list of names of workers, which should be watched. In case a worker get missing, a notification is sent.
The value of <code class="docutils literal notranslate"><span class="pre">watchedWorkers</span></code> can also be set to <em>all</em> (default) or <code class="docutils literal notranslate"><span class="pre">None</span></code>. You also need to specify email address to which the notification is sent in the worker configuration.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">messageFormatterMissingWorker</span></code></dt>
<dd>This is an optional instance of the <code class="docutils literal notranslate"><span class="pre">reporters.messageFormatterMissingWorker</span></code> class that can be used to generate a custom mail message for missing workers.
This class uses the <a class="reference external" href="http://jinja.pocoo.org/docs/dev/templates/">Jinja2</a> templating language to generate the body and optionally the subject of the mails.
Templates can either be given inline (as string), or read from the filesystem.</dd>
</dl>
</div>
<div class="section" id="messageformatter-arguments">
<h6><a class="toc-backref" href="#id7">MessageFormatter arguments</a><a class="headerlink" href="#messageformatter-arguments" title="Permalink to this headline">¶</a></h6>
<p>The easiest way to use the <code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code> parameter is to create a new instance of the <code class="docutils literal notranslate"><span class="pre">reporters.MessageFormatter</span></code> class.
The constructor to that class takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">template_dir</span></code></dt>
<dd>This is the directory that is used to look for the various templates.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">template_filename</span></code></dt>
<dd>This is the name of the file in the <code class="docutils literal notranslate"><span class="pre">template_dir</span></code> directory that will be used to generate the body of the mail.
It defaults to <code class="docutils literal notranslate"><span class="pre">default_mail.txt</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">template</span></code></dt>
<dd>If this parameter is set, this parameter indicates the content of the template used to generate the body of the mail as string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">template_type</span></code></dt>
<dd>This indicates the type of the generated template.
Use either ‘plain’ (the default) or ‘html’.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">subject_filename</span></code></dt>
<dd>This is the name of the file in the <code class="docutils literal notranslate"><span class="pre">template_dir</span></code> directory that contains the content of the subject of the mail.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">subject</span></code></dt>
<dd>Alternatively, this is the content of the subject of the mail as string.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctx</span></code></dt>
<dd><p class="first">This is an extension of the standard context that will be given to the templates.
Use this to add content to the templates that is otherwise not available.</p>
<p>Alternatively, you can subclass MessageFormatter and override the <a class="reference internal" href="#buildAdditionalContext" title="buildAdditionalContext"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildAdditionalContext</span></code></a> in order to grab more context from the data API.</p>
<dl class="last method">
<dt id="buildAdditionalContext">
<code class="descname">buildAdditionalContext</code><span class="sig-paren">(</span><em>master</em>, <em>ctx</em><span class="sig-paren">)</span><a class="headerlink" href="#buildAdditionalContext" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>master</strong> – the master object</li>
<li><strong>ctx</strong> – the context dictionary to enhance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">optionally deferred</p>
</td>
</tr>
</tbody>
</table>
<p>default implementation will add <code class="docutils literal notranslate"><span class="pre">self.ctx</span></code> into the current template context</p>
</dd></dl>

</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wantProperties</span></code></dt>
<dd>This parameter (defaults to True) will extend the content of the given <code class="docutils literal notranslate"><span class="pre">build</span></code> object with the Properties from the build.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wantSteps</span></code></dt>
<dd>This parameter (defaults to False) will extend the content of the given <code class="docutils literal notranslate"><span class="pre">build</span></code> object with information about the steps of the build.
Use it only when necessary as this increases the overhead in term of CPU and memory on the master.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">wantLogs</span></code></dt>
<dd>This parameter (defaults to False) will extend the content of the steps of the given <code class="docutils literal notranslate"><span class="pre">build</span></code> object with the full Logs of each steps from the build.
This requires <code class="docutils literal notranslate"><span class="pre">wantSteps</span></code> to be True.
Use it only when mandatory as this increases the overhead in term of CPU and memory on the master greatly.</dd>
</dl>
<p>As a help to those writing Jinja2 templates the following table describes how to get some useful pieces of information from the various data objects:</p>
<dl class="docutils">
<dt>Name of the builder that generated this event</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">buildername</span> <span class="pre">}}</span></code></dd>
<dt>Title of the BuildMaster</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">projects</span> <span class="pre">}}</span></code></dd>
<dt>MailNotifier mode</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">mode</span> <span class="pre">}}</span></code> (a combination of <code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">failing</span></code>, <code class="docutils literal notranslate"><span class="pre">passing</span></code>, <code class="docutils literal notranslate"><span class="pre">problem</span></code>, <code class="docutils literal notranslate"><span class="pre">warnings</span></code>, <code class="docutils literal notranslate"><span class="pre">exception</span></code>, <code class="docutils literal notranslate"><span class="pre">all</span></code>)</dd>
<dt>URL to build page</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">build_url</span> <span class="pre">}}</span></code></dd>
<dt>URL to buildbot main page</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">buildbot_url</span> <span class="pre">}}</span></code></dd>
<dt>Status of the build as string.</dt>
<dd><p class="first">This require extending the context of the Formatter via the <code class="docutils literal notranslate"><span class="pre">ctx</span></code> parameter with: <code class="docutils literal notranslate"><span class="pre">ctx=dict(statuses=util.Results)</span></code>.</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">statuses[results]</span> <span class="pre">}}</span></code></p>
</dd>
<dt>Build text</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">build['state_string']</span> <span class="pre">}}</span></code></dd>
<dt>Mapping of property names to (values, source)</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">build['properties']</span> <span class="pre">}}</span></code></dd>
<dt>For instance the build reason (from a forced build)</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">build['properties']['reason'][0]</span> <span class="pre">}}</span></code></dd>
<dt>Worker name</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">workername</span> <span class="pre">}}</span></code></dd>
<dt>List of responsible users</dt>
<dd><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">blamelist</span> <span class="pre">|</span> <span class="pre">join(',</span> <span class="pre">')</span> <span class="pre">}}</span></code></dd>
</dl>
</div>
<div class="section" id="messageformattermissingworkers-arguments">
<h6><a class="toc-backref" href="#id8">MessageFormatterMissingWorkers arguments</a><a class="headerlink" href="#messageformattermissingworkers-arguments" title="Permalink to this headline">¶</a></h6>
<p>The easiest way to use the <code class="docutils literal notranslate"><span class="pre">messageFormatterMissingWorkers</span></code> parameter is to create a new instance of the <code class="docutils literal notranslate"><span class="pre">reporters.MessageFormatterMissingWorkers</span></code> class.</p>
<p>The constructor to that class takes the same arguments as MessageFormatter, minus <code class="docutils literal notranslate"><span class="pre">wantLogs</span></code>, <code class="docutils literal notranslate"><span class="pre">wantProperties</span></code>, <code class="docutils literal notranslate"><span class="pre">wantSteps</span></code>.</p>
<p>The default <code class="docutils literal notranslate"><span class="pre">ctx</span></code> for the missing worker email is made of:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">buildbot_title</span></code></dt>
<dd>The buildbot title as per <code class="docutils literal notranslate"><span class="pre">c['title']</span></code> from the <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">buildbot_url</span></code></dt>
<dd>The buildbot title as per <code class="docutils literal notranslate"><span class="pre">c['title']</span></code> from the <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">worker</span></code></dt>
<dd><p class="first">The worker object as defined in the REST api plus two attributes:</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">notify</span></code></dt>
<dd>List of emails to be notified for this worker.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">last_connection</span></code></dt>
<dd>String describing the approximate the time of last connection for this worker.</dd>
</dl>
</dd>
</dl>
<span class="target" id="reporter-PushoverNotifier"></span></div>
</div>
<div class="section" id="pushover-notifications">
<span id="index-1"></span><h5><a class="toc-backref" href="#id9">2.5.12.2. Pushover Notifications</a><a class="headerlink" href="#pushover-notifications" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.pushover.PushoverNotifier">
<em class="property">class </em><code class="descclassname">buildbot.reporters.pushover.</code><code class="descname">PushoverNotifier</code><a class="headerlink" href="#buildbot.reporters.pushover.PushoverNotifier" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Apart of sending mail, Buildbot can send <a class="reference external" href="https://pushover.net/">Pushover</a> notifications. It can be used by administrators to receive an instant message to an iPhone or an Android device if a build fails. The <code class="xref py py-class docutils literal notranslate"><span class="pre">PushoverNotifier</span></code> reporter is used to accomplish this. Its configuration is very similar to the mail notifications, however—due to the notification size constrains—the logs and patches cannot be attached.</p>
<p>To use this reporter, you need to generate and application on the Pushover website <a class="reference external" href="https://pushover.net/apps/">https://pushover.net/apps/</a> and provide your user key and the API token.</p>
<p>The following simple example will send a Pushover notification upon the completion of each build.
The notification contains a description of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>, its results, and URLs where more information can be obtained. The <code class="docutils literal notranslate"><span class="pre">user_key</span></code> and <code class="docutils literal notranslate"><span class="pre">api_token</span></code> values should be replaced with proper ones obtained from the Pushover website for your application.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>
<span class="n">pn</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">PushoverNotifier</span><span class="p">(</span><span class="n">user_key</span><span class="o">=</span><span class="s2">&quot;1234&quot;</span><span class="p">,</span> <span class="n">api_token</span><span class="o">=</span><span class="s1">&#39;abcd&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pn</span><span class="p">)</span>
</pre></div>
</div>
<p>This notifier supports parameters <code class="docutils literal notranslate"><span class="pre">subject</span></code>, <code class="docutils literal notranslate"><span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">builders</span></code>, <code class="docutils literal notranslate"><span class="pre">tags</span></code>, <code class="docutils literal notranslate"><span class="pre">schedulers</span></code>, <code class="docutils literal notranslate"><span class="pre">branches</span></code>, <code class="docutils literal notranslate"><span class="pre">buildSetSummary</span></code>, <code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code>, <code class="docutils literal notranslate"><span class="pre">watchedWorkers</span></code>, and <code class="docutils literal notranslate"><span class="pre">messageFormatterMissingWorker</span></code> from the <a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">mail</span> <span class="pre">notifier</span></code></a>. See above for their explanation.
However, <code class="docutils literal notranslate"><span class="pre">watchedWorkers</span></code> defaults to <em>None</em>.</p>
<p>The following additional parameters are accepted by this class:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">user_key</span></code></dt>
<dd>The user key from the Pushover website. It is used to identify the notification recipient.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">api_token</span></code></dt>
<dd>API token for a custom application from the Pushover website.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">priorities</span></code></dt>
<dd>Dictionary of Pushover notification priorities. The keys of the dictionary can be <code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">failing</span></code>, <code class="docutils literal notranslate"><span class="pre">passing</span></code>, <code class="docutils literal notranslate"><span class="pre">warnings</span></code>, <code class="docutils literal notranslate"><span class="pre">exception</span></code> and are equivalent to the <code class="docutils literal notranslate"><span class="pre">mode</span></code> strings. The values are integers between -2…2, specifying notification priority. In case a mode is missing from this dictionary, the default value of 0 is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">otherParams</span></code></dt>
<dd>Other parameters send to Pushover API. Check <a class="reference external" href="https://pushover.net/api/">https://pushover.net/api/</a> for their list.</dd>
</dl>
<span class="target" id="reporter-PushjetNotifier"></span></div>
<div class="section" id="pushjet-notifications">
<span id="index-2"></span><h5><a class="toc-backref" href="#id10">2.5.12.3. Pushjet Notifications</a><a class="headerlink" href="#pushjet-notifications" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.pushover.PushjetNotifier">
<em class="property">class </em><code class="descclassname">buildbot.reporters.pushover.</code><code class="descname">PushjetNotifier</code><a class="headerlink" href="#buildbot.reporters.pushover.PushjetNotifier" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="https://pushjet.io/">Pushjet</a> is another instant notification service, similar to <a class="reference internal" href="#reporter-PushoverNotifier" title="PushoverNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">Pushover</span></code></a>.
To use this reporter, you need to generate a Pushjet service and provide its secret.</p>
<p>The parameters <code class="docutils literal notranslate"><span class="pre">subject</span></code>, <code class="docutils literal notranslate"><span class="pre">mode</span></code>, <code class="docutils literal notranslate"><span class="pre">builders</span></code>, <code class="docutils literal notranslate"><span class="pre">tags</span></code>, <code class="docutils literal notranslate"><span class="pre">schedulers</span></code>, <code class="docutils literal notranslate"><span class="pre">branches</span></code>, <code class="docutils literal notranslate"><span class="pre">buildSetSummary</span></code>, <code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code>, <code class="docutils literal notranslate"><span class="pre">watchedWorkers</span></code>, and <code class="docutils literal notranslate"><span class="pre">messageFormatterMissingWorker</span></code> are common with <a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">mail</span></code></a> and <a class="reference internal" href="#reporter-PushoverNotifier" title="PushoverNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">Pushover</span></code></a> notifier.</p>
<p>The Pushjet specific parameters are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">secret</span></code></dt>
<dd>This is a secret token for your Pushjet service. See <a class="reference external" href="http://docs.pushjet.io/docs/creating-a-new-service">http://docs.pushjet.io/docs/creating-a-new-service</a> to learn how to create a new Pushjet service and get its secret token.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">levels</span></code></dt>
<dd>Dictionary of Pushjet notification levels. The keys of the dictionary can be <code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">failing</span></code>, <code class="docutils literal notranslate"><span class="pre">passing</span></code>, <code class="docutils literal notranslate"><span class="pre">warnings</span></code>, <code class="docutils literal notranslate"><span class="pre">exception</span></code> and are equivalent to the <code class="docutils literal notranslate"><span class="pre">mode</span></code> strings. The values are integers between 0…5, specifying notification priority. In case a mode is missing from this dictionary, the default value set by Pushover is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">base_url</span></code></dt>
<dd>Base URL for custom Pushjet instances. Defaults to <a class="reference external" href="https://api.pushjet.io">https://api.pushjet.io</a>.</dd>
</dl>
<span class="target" id="reporter-IRC"></span></div>
<div class="section" id="irc-bot">
<span id="index-3"></span><h5><a class="toc-backref" href="#id11">2.5.12.4. IRC Bot</a><a class="headerlink" href="#irc-bot" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> reporter creates an IRC bot which will attach to certain channels and be available for status queries.
It can also be asked to announce builds as they occur, or be told to shut up.</p>
<p>The IRC Bot in buildbot nine, is mostly a rewrite, and not all functionality has been ported yet.
Patches are very welcome for restoring the full functionality.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Security Note</p>
<p class="last">Please note that any user having access to your irc channel or can PM the bot will be able to create or stop builds <a class="reference external" href="http://trac.buildbot.net/ticket/3377">bug #3377</a>.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>
<span class="n">irc</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">IRC</span><span class="p">(</span><span class="s2">&quot;irc.example.org&quot;</span><span class="p">,</span> <span class="s2">&quot;botnickname&quot;</span><span class="p">,</span>
                 <span class="n">useColors</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">channels</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;#example1&quot;</span><span class="p">},</span>
                           <span class="p">{</span><span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="s2">&quot;#example2&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;somesecretpassword&quot;</span><span class="p">}],</span>
                 <span class="n">password</span><span class="o">=</span><span class="s2">&quot;mysecretnickservpassword&quot;</span><span class="p">,</span>
                 <span class="n">notify_events</span><span class="o">=</span><span class="p">{</span>
                   <span class="s1">&#39;exception&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;successToFailure&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                   <span class="s1">&#39;failureToSuccess&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="p">})</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irc</span><span class="p">)</span>
</pre></div>
</div>
<p>The following parameters are accepted by this class:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">host</span></code></dt>
<dd>(mandatory)
The IRC server address to connect to.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">nick</span></code></dt>
<dd>(mandatory)
The name this bot will use on the IRC server.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">channels</span></code></dt>
<dd>(mandatory)
This is a list of channels to join on the IRC server.
Each channel can be a string (e.g. <code class="docutils literal notranslate"><span class="pre">#buildbot</span></code>), or a dictionary <code class="docutils literal notranslate"><span class="pre">{'channel':</span> <span class="pre">'#buildbot',</span> <span class="pre">'password':</span> <span class="pre">'secret'}</span></code> if each channel requires a different password.
A global password can be set with the <code class="docutils literal notranslate"><span class="pre">password</span></code> parameter.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pm_to_nicks</span></code></dt>
<dd>(optional)
This is a list of person to contact on the IRC server.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt>
<dd>(optional, default to 6667)
The port to connect to on the IRC server.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">allowForce</span></code></dt>
<dd>(optional, disabled by default)
This allow user to force builds via this bot.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tags</span></code></dt>
<dd>(optional)
When set, this bot will only communicate about builders containing those tags.
(tags functionality is not yet ported)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt>
<dd>(optional)
The global password used to register the bot to the IRC server.
If provided, it will be sent to Nickserv to claim the nickname: some IRC servers will not allow clients to send private messages until they have logged in with a password.
Can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">notify_events</span></code></dt>
<dd>(optional)
A dictionary of events to be notified on the IRC channels.
At the moment, irc bot can listen to build ‘start’ and ‘finish’ events.
This parameter can be changed during run-time by sending the <code class="docutils literal notranslate"><span class="pre">notify</span></code> command to the bot.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">noticeOnChannel</span></code></dt>
<dd>(optional, disabled by default)
Whether to send notices rather than messages when communicating with a channel.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">showBlameList</span></code></dt>
<dd>(optional, disabled by default)
Whether or not to display the blame list for failed builds.
(blame list functionality is not ported yet)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">useRevisions</span></code></dt>
<dd>(optional, disabled by default)
Whether or not to display the revision leading to the build the messages are about.
(useRevisions functionality is not ported yet)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">useSSL</span></code></dt>
<dd>(optional, disabled by default)
Whether or not to use SSL when connecting to the IRC server.
Note that this option requires <a class="reference external" href="http://pyopenssl.sourceforge.net/">PyOpenSSL</a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lostDelay</span></code></dt>
<dd>(optional)
Delay to wait before reconnecting to the server when the connection has been lost.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">failedDelay</span></code></dt>
<dd>(optional)
Delay to wait before reconnecting to the IRC server when the connection failed.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">useColors</span></code></dt>
<dd>(optional, enabled by default)
The bot can add color to some of its messages.
You might turn it off by setting this parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">allowShutdown</span></code></dt>
<dd>(optional, disabled by default)
This allow users to shutdown the master.</dd>
</dl>
<p>To use the service, you address messages at the Buildbot, either normally (<code class="docutils literal notranslate"><span class="pre">botnickname:</span> <span class="pre">status</span></code>) or with private messages (<code class="docutils literal notranslate"><span class="pre">/msg</span> <span class="pre">botnickname</span> <span class="pre">status</span></code>).
The Buildbot will respond in kind.</p>
<p>If you issue a command that is currently not available, the Buildbot will respond with an error message.
If the <code class="docutils literal notranslate"><span class="pre">noticeOnChannel=True</span></code> option was used, error messages will be sent as channel notices instead of messaging.</p>
<p>Some of the commands currently available:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">list</span> <span class="pre">builders</span></code></dt>
<dd>Emit a list of all configured builders</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">status</span> <em><span class="pre">BUILDER</span></em></code></dt>
<dd>Announce the status of a specific Builder: what it is doing right now.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">status</span> <span class="pre">all</span></code></dt>
<dd>Announce the status of all Builders</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">watch</span> <em><span class="pre">BUILDER</span></em></code></dt>
<dd>If the given <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> is currently running, wait until the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> is finished and then announce the results.</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">last</span> <em><span class="pre">BUILDER</span></em></code></dt>
<dd>Return the results of the last build to run on the given <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">join</span> <em><span class="pre">CHANNEL</span></em></code></dt>
<dd>Join the given IRC channel</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">leave</span> <em><span class="pre">CHANNEL</span></em></code></dt>
<dd>Leave the given IRC channel</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">notify</span> <span class="pre">on|off|list</span> <em><span class="pre">EVENT</span></em></code></dt>
<dd><p class="first">Report events relating to builds.
If the command is issued as a private message, then the report will be sent back as a private message to the user who issued the command.
Otherwise, the report will be sent to the channel.
Available events to be notified are:</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">started</span></code></dt>
<dd>A build has started</dd>
<dt><code class="docutils literal notranslate"><span class="pre">finished</span></code></dt>
<dd>A build has finished</dd>
<dt><code class="docutils literal notranslate"><span class="pre">success</span></code></dt>
<dd>A build finished successfully</dd>
<dt><code class="docutils literal notranslate"><span class="pre">failure</span></code></dt>
<dd>A build failed</dd>
<dt><code class="docutils literal notranslate"><span class="pre">exception</span></code></dt>
<dd>A build generated and exception</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xToY</span></code></dt>
<dd>The previous build was x, but this one is Y, where x and Y are each one of success, warnings, failure, exception (except Y is capitalized).
For example: <code class="docutils literal notranslate"><span class="pre">successToFailure</span></code> will notify if the previous build was successful, but this one failed</dd>
</dl>
</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">help</span> <em><span class="pre">COMMAND</span></em></code></dt>
<dd>Describe a command.
Use <strong class="command">help commands</strong> to get a list of known commands.</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">shutdown</span> <em><span class="pre">ARG</span></em></code></dt>
<dd><p class="first">Control the shutdown process of the Buildbot master.
Available arguments are:</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">check</span></code></dt>
<dd>Check if the Buildbot master is running or shutting down</dd>
<dt><code class="docutils literal notranslate"><span class="pre">start</span></code></dt>
<dd>Start clean shutdown</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stop</span></code></dt>
<dd>Stop clean shutdown</dd>
<dt><code class="docutils literal notranslate"><span class="pre">now</span></code></dt>
<dd>Shutdown immediately without waiting for the builders to finish</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">source</span></code></dt>
<dd>Announce the URL of the Buildbot’s home page.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">version</span></code></dt>
<dd>Announce the version of this Buildbot.</dd>
</dl>
<p>Additionally, the config file may specify default notification options as shown in the example earlier.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">allowForce=True</span></code> option was used, some additional commands will be available:</p>
<dl class="docutils" id="index-4">
<dt><code class="samp docutils literal notranslate"><span class="pre">force</span> <span class="pre">build</span> <span class="pre">[--codebase=</span><em><span class="pre">CODEBASE</span></em><span class="pre">]</span> <span class="pre">[--branch=</span><em><span class="pre">BRANCH</span></em><span class="pre">]</span> <span class="pre">[--revision=</span><em><span class="pre">REVISION</span></em><span class="pre">]</span> <span class="pre">[--props=PROP1=VAL1,PROP2=VAL2...]</span> <em><span class="pre">BUILDER</span></em> <em><span class="pre">REASON</span></em></code></dt>
<dd>Tell the given <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> to start a build of the latest code.
The user requesting the build and <em>REASON</em> are recorded in the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> status.
The Buildbot will announce the build’s status when it finishes.The user can specify a branch and/or revision with the optional parameters <code class="samp docutils literal notranslate"><span class="pre">--branch=</span><em><span class="pre">BRANCH</span></em></code> and <code class="samp docutils literal notranslate"><span class="pre">--revision=</span><em><span class="pre">REVISION</span></em></code>.
The user can also give a list of properties with <code class="samp docutils literal notranslate"><span class="pre">--props=</span><em><span class="pre">PROP1=VAL1,PROP2=VAL2..</span></em></code>.</dd>
<dt><code class="samp docutils literal notranslate"><span class="pre">stop</span> <span class="pre">build</span> <em><span class="pre">BUILDER</span></em> <em><span class="pre">REASON</span></em></code></dt>
<dd>Terminate any running build in the given <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.
<em>REASON</em> will be added to the build status to explain why it was stopped.
You might use this if you committed a bug, corrected it right away, and don’t want to wait for the first build (which is destined to fail) to complete before starting the second (hopefully fixed) build.</dd>
</dl>
<p>If the <cite>tags</cite> is set (see the tags option in <a class="reference internal" href="#builder-configuration"><span class="std std-ref">Builder Configuration</span></a>) changes related to only builders belonging to those tags of builders will be sent to the channel.</p>
<p>If the <cite>useRevisions</cite> option is set to <cite>True</cite>, the IRC bot will send status messages that replace the build number with a list of revisions that are contained in that build.
So instead of seeing <cite>build #253 of …</cite>, you would see something like <cite>build containing revisions [a87b2c4]</cite>.
Revisions that are stored as hashes are shortened to 7 characters in length, as multiple revisions can be contained in one build and may exceed the IRC message length limit.</p>
<p>Two additional arguments can be set to control how fast the IRC bot tries to reconnect when it encounters connection issues.
<code class="docutils literal notranslate"><span class="pre">lostDelay</span></code> is the number of seconds the bot will wait to reconnect when the connection is lost, where as <code class="docutils literal notranslate"><span class="pre">failedDelay</span></code> is the number of seconds until the bot tries to reconnect when the connection failed.
<code class="docutils literal notranslate"><span class="pre">lostDelay</span></code> defaults to a random number between 1 and 5, while <code class="docutils literal notranslate"><span class="pre">failedDelay</span></code> defaults to a random one between 45 and 60.
Setting random defaults like this means multiple IRC bots are less likely to deny each other by flooding the server.</p>
</div>
<div class="section" id="gerritstatuspush">
<span id="reporter-GerritStatusPush"></span><h5><a class="toc-backref" href="#id12">2.5.12.5. GerritStatusPush</a><a class="headerlink" href="#gerritstatuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.status.status_gerrit.GerritStatusPush">
<em class="property">class </em><code class="descclassname">buildbot.status.status_gerrit.</code><code class="descname">GerritStatusPush</code><a class="headerlink" href="#buildbot.status.status_gerrit.GerritStatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#GerritStatusPush" title="GerritStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> sends review of the <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> back to the Gerrit server, optionally also sending a message when a build is started.
GerritStatusPush can send a separate review for each build that completes, or a single review summarizing the results for all of the builds.</p>
<dl class="class">
<dt id="GerritStatusPush">
<em class="property">class </em><code class="descname">GerritStatusPush</code><span class="sig-paren">(</span><em>server</em>, <em>username</em>, <em>reviewCB</em>, <em>startCB</em>, <em>port</em>, <em>reviewArg</em>, <em>startArg</em>, <em>summaryCB</em>, <em>summaryArg</em>, <em>identity_file</em>, <em>builders</em>, <em>notify...</em><span class="sig-paren">)</span><a class="headerlink" href="#GerritStatusPush" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>server</strong> (<em>string</em>) – Gerrit SSH server’s address to use for push event notifications.</li>
<li><strong>username</strong> (<em>string</em>) – Gerrit SSH server’s username.</li>
<li><strong>identity_file</strong> – (optional) Gerrit SSH identity file.</li>
<li><strong>port</strong> (<em>int</em>) – (optional) Gerrit SSH server’s port (default: 29418)</li>
<li><strong>reviewCB</strong> – (optional) Called each time a build finishes. Build properties are available. Can be a deferred.</li>
<li><strong>reviewArg</strong> – <p>(optional) argument passed to the review callback.</p>
<p>If <code class="xref py py-func docutils literal notranslate"><span class="pre">reviewCB</span></code> callback is specified, it must return a message and optionally labels. If no message is specified, nothing will be sent to Gerrit.
It should return a dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
 <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">label</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="n">label</span><span class="o">-</span><span class="n">score</span><span class="p">,</span>
            <span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gerritReviewCB</span><span class="p">(</span><span class="n">builderName</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">util</span><span class="o">.</span><span class="n">RETRY</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="n">message</span> <span class="o">=</span>  <span class="s2">&quot;Buildbot finished compiling your patchset</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;on configuration: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">builderName</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;The result is: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">util</span><span class="o">.</span><span class="n">Results</span><span class="p">[</span><span class="n">result</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">arg</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">For more details visit:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="n">build</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">util</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
        <span class="n">verified</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">verified</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Verified&#39;</span><span class="p">:</span> <span class="n">verified</span><span class="p">})</span>
</pre></div>
</div>
<p>Which require an extra import in the config:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
</pre></div>
</div>
</li>
<li><strong>startCB</strong> – (optional) Called each time a build is started. Build properties are available. Can be a deferred.</li>
<li><strong>startArg</strong> – <p>(optional) argument passed to the start callback.</p>
<p>If <code class="xref py py-func docutils literal notranslate"><span class="pre">startCB</span></code> is specified, it must return a message and optionally labels. If no message is specified, nothing will be sent to Gerrit.
It should return a dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
 <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">label</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="n">label</span><span class="o">-</span><span class="n">score</span><span class="p">,</span>
            <span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gerritStartCB</span><span class="p">(</span><span class="n">builderName</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Buildbot started compiling your patchset</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;on configuration: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">builderName</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;See your build here: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">build</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><strong>summaryCB</strong> – (optional) Called each time a buildset finishes. Each build in the buildset has properties available. Can be a deferred.</li>
<li><strong>summaryArg</strong> – <p>(optional) argument passed to the summary callback.</p>
<p>If <code class="xref py py-func docutils literal notranslate"><span class="pre">summaryCB</span></code> callback is specified, it must return a message and optionally labels. If no message is specified, nothing will be sent to Gerrit.
The message and labels should be a summary of all the builds within the buildset.
It should return a dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
 <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">label</span><span class="o">-</span><span class="n">name</span><span class="p">:</span> <span class="n">label</span><span class="o">-</span><span class="n">score</span><span class="p">,</span>
            <span class="o">...</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gerritSummaryCB</span><span class="p">(</span><span class="n">buildInfoList</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="n">success</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">failure</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="n">msgs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">buildInfo</span> <span class="ow">in</span> <span class="n">buildInfoList</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Builder </span><span class="si">%(name)s</span><span class="s2"> </span><span class="si">%(resultText)s</span><span class="s2"> (</span><span class="si">%(text)s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">buildInfo</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">buildInfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;url&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">link</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">link</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;.&quot;</span>

        <span class="n">msgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">buildInfo</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">util</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">failure</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="n">success</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">failure</span><span class="p">:</span>
        <span class="n">verified</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">verified</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msgs</span><span class="p">),</span>
                <span class="n">labels</span><span class="o">=</span><span class="p">{</span>
                    <span class="s1">&#39;Verified&#39;</span><span class="p">:</span> <span class="n">verified</span>
                <span class="p">})</span>
</pre></div>
</div>
</li>
<li><strong>builders</strong> – (optional) list of builders to send results for.
This method allows to filter results for a specific set of builder.
By default, or if builders is None, then no filtering is performed.</li>
<li><strong>notify</strong> – (optional) control who gets notified by Gerrit once the status is posted.
The possible values for <cite>notify</cite> can be found in your version of the
Gerrit documentation for the <cite>gerrit review</cite> command.</li>
<li><strong>wantSteps</strong> – (optional, defaults to False) Extends the given <code class="docutils literal notranslate"><span class="pre">build</span></code> object with information about steps of the build.
Use it only when necessary as this increases the overhead in term of CPU and memory on the master.</li>
<li><strong>wantLogs</strong> – (optional, default to False) Extends the steps of the given <code class="docutils literal notranslate"><span class="pre">build</span></code> object with the full logs of the build.
This requires <code class="docutils literal notranslate"><span class="pre">wantSteps</span></code> to be True.
Use it only when mandatory as this increases the overhead in term of CPU and memory on the master greatly.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, a single summary review is sent; that is, a default <code class="xref py py-func docutils literal notranslate"><span class="pre">summaryCB</span></code> is provided, but no <code class="xref py py-func docutils literal notranslate"><span class="pre">reviewCB</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">startCB</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <code class="xref py py-func docutils literal notranslate"><span class="pre">reviewCB</span></code> or <code class="xref py py-func docutils literal notranslate"><span class="pre">summaryCB</span></code> do not return any labels, only a message will be pushed to the Gerrit server.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/docs/examples/git_gerrit.cfg">master/docs/examples/git_gerrit.cfg</a> and <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/docs/examples/repo_gerrit.cfg">master/docs/examples/repo_gerrit.cfg</a> in the Buildbot distribution provide a full example setup of Git+Gerrit or Repo+Gerrit of <a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a>.</p>
</div>
</div>
<div class="section" id="httpstatuspush">
<span id="reporter-HttpStatusPush"></span><h5><a class="toc-backref" href="#id13">2.5.12.6. HttpStatusPush</a><a class="headerlink" href="#httpstatuspush" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">HttpStatusPush</span><span class="p">(</span><span class="n">serverUrl</span><span class="o">=</span><span class="s2">&quot;http://example.com/submit&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#HttpStatusPush" title="HttpStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpStatusPush</span></code></a> builds on <code class="xref py py-class docutils literal notranslate"><span class="pre">StatusPush</span></code> and sends HTTP requests to <code class="docutils literal notranslate"><span class="pre">serverUrl</span></code>, with all the items json-encoded.
It is useful to create a status front end outside of Buildbot for better scalability.</p>
<p>It requires either <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> or <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> to be installed to allow interaction with http server.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The json data object sent is completely different from the one that was generated by 0.8.x buildbot.
It is indeed generated using data api.</p>
</div>
<dl class="class">
<dt id="HttpStatusPush">
<em class="property">class </em><code class="descname">HttpStatusPush</code><span class="sig-paren">(</span><em>serverUrl</em>, <em>user=None</em>, <em>password=None</em>, <em>auth=None</em>, <em>format_fn=None</em>, <em>builders=None</em>, <em>wantProperties=False</em>, <em>wantSteps=False</em>, <em>wantPreviousBuild=False</em>, <em>wantLogs=False</em><span class="sig-paren">)</span><a class="headerlink" href="#HttpStatusPush" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>serverUrl</strong> (<em>string</em>) – the url where to do the http post</li>
<li><strong>user</strong> (<em>string</em>) – the BasicAuth user to post as</li>
<li><strong>password</strong> (<em>string</em>) – the BasicAuth user’s password (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>).</li>
<li><strong>auth</strong> – the authentication method to use.
Refer to the documentation of the requests library for more information.</li>
<li><strong>format_fn</strong> (<em>function</em>) – a function that takes the build as parameter and returns a dictionary to be pushed to the server (as json).</li>
<li><strong>builders</strong> (<em>list</em>) – only send update for specified builders</li>
<li><strong>wantProperties</strong> (<em>boolean</em>) – include ‘properties’ in the build dictionary</li>
<li><strong>wantSteps</strong> (<em>boolean</em>) – include ‘steps’ in the build dictionary</li>
<li><strong>wantLogs</strong> (<em>boolean</em>) – include ‘logs’ in the steps dictionaries.
This needs wantSteps=True.
This dumps the <em>full</em> content of logs and may consume lots of memory and CPU depending on the log size.</li>
<li><strong>wantPreviousBuild</strong> (<em>boolean</em>) – include ‘prev_build’ in the build dictionary</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="json-object-spec">
<h6><a class="toc-backref" href="#id14">Json object spec</a><a class="headerlink" href="#json-object-spec" title="Permalink to this headline">¶</a></h6>
<p>The default json object sent is a build object augmented with some more data as follow.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://yourbot/path/to/build&quot;</span><span class="p">,</span>
    <span class="nt">&quot;&lt;build data api values&gt;&quot;</span><span class="p">:</span> <span class="s2">&quot;[...]&quot;</span><span class="p">,</span>
    <span class="nt">&quot;buildset&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;buildset data api values&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;builder&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;builder data api values&gt;&quot;</span><span class="p">,</span>
    <span class="nt">&quot;buildrequest&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;buildrequest data api values&gt;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want another format, don’t hesitate to use the <code class="docutils literal notranslate"><span class="pre">format_fn</span></code> parameter to customize the payload.
The <code class="docutils literal notranslate"><span class="pre">build</span></code> parameter given to that function is of type <a class="reference internal" href="#rtype-build" title="build"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">build</span></code></a>, optionally enhanced with properties, steps, and logs information.</p>
</div>
</div>
<div class="section" id="githubstatuspush">
<span id="reporter-GitHubStatusPush"></span><h5><a class="toc-backref" href="#id15">2.5.12.7. GitHubStatusPush</a><a class="headerlink" href="#githubstatuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.github.GitHubStatusPush">
<em class="property">class </em><code class="descclassname">buildbot.reporters.github.</code><code class="descname">GitHubStatusPush</code><a class="headerlink" href="#buildbot.reporters.github.GitHubStatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span><span class="p">,</span> <span class="n">util</span>

<span class="n">context</span> <span class="o">=</span> <span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;buildbot/%(prop:buildername)s&quot;</span><span class="p">)</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">GitHubStatusPush</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;githubAPIToken&#39;</span><span class="p">,</span>
                                <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span>
                                <span class="n">startDescription</span><span class="o">=</span><span class="s1">&#39;Build started.&#39;</span><span class="p">,</span>
                                <span class="n">endDescription</span><span class="o">=</span><span class="s1">&#39;Build done.&#39;</span><span class="p">)</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">buildbot_bbtools</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuilderConfig</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;builder-name&#39;</span><span class="p">,</span>
    <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;worker1&#39;</span><span class="p">],</span>
    <span class="n">factory</span><span class="o">=</span><span class="n">factory</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buildbot_bbtools</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gs</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#GitHubStatusPush" title="GitHubStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubStatusPush</span></code></a> publishes a build status using <a class="reference external" href="http://developer.github.com/v3/repos/statuses">GitHub Status API</a>.</p>
<p>It requires <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> package to allow interaction with GitHub REST API.</p>
<p>It is configured with at least a GitHub API token.</p>
<p>You can create a token from you own <a class="reference external" href="https://github.com/settings/applications">GitHub - Profile - Applications - Register new application</a> or use an external tool to generate one.</p>
<dl class="class">
<dt id="GitHubStatusPush">
<em class="property">class </em><code class="descname">GitHubStatusPush</code><span class="sig-paren">(</span><em>token</em>, <em>startDescription=None</em>, <em>endDescription=None</em>, <em>context=None</em>, <em>baseURL=None</em>, <em>verbose=False</em>, <em>builders=None</em><span class="sig-paren">)</span><a class="headerlink" href="#GitHubStatusPush" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>token</strong> (<em>string</em>) – token used for authentication. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>string startDescription</strong> (<em>rendereable</em>) – Custom start message (default: ‘Build started.’)</li>
<li><strong>string endDescription</strong> (<em>rendereable</em>) – Custom end message (default: ‘Build done.’)</li>
<li><strong>string context</strong> (<em>rendereable</em>) – Passed to GitHub to differentiate between statuses.
A static string can be passed or <code class="xref py py-class docutils literal notranslate"><span class="pre">Interpolate</span></code> for dynamic substitution.
The default context is <cite>buildbot/%(prop:buildername)s</cite>.</li>
<li><strong>baseURL</strong> (<em>string</em>) – specify the github api endpoint if you work with GitHub Enterprise</li>
<li><strong>verbose</strong> (<em>boolean</em>) – if True, logs a message for each successful status push</li>
<li><strong>builders</strong> (<em>list</em>) – only send update for specified builders</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="githubcommentpush">
<span id="reporter-GitHubCommentPush"></span><h5><a class="toc-backref" href="#id16">2.5.12.8. GitHubCommentPush</a><a class="headerlink" href="#githubcommentpush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.github.GitHubCommentPush">
<em class="property">class </em><code class="descclassname">buildbot.reporters.github.</code><code class="descname">GitHubCommentPush</code><a class="headerlink" href="#buildbot.reporters.github.GitHubCommentPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span><span class="p">,</span> <span class="n">util</span>

<span class="n">gc</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">GitHubCommentPush</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;githubAPIToken&#39;</span><span class="p">,</span>
                                 <span class="n">startDescription</span><span class="o">=</span><span class="s1">&#39;Build started.&#39;</span><span class="p">,</span>
                                 <span class="n">endDescription</span><span class="o">=</span><span class="s1">&#39;Build done.&#39;</span><span class="p">)</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">buildbot_bbtools</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuilderConfig</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;builder-name&#39;</span><span class="p">,</span>
    <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;worker1&#39;</span><span class="p">],</span>
    <span class="n">factory</span><span class="o">=</span><span class="n">factory</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">buildbot_bbtools</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#GitHubCommentPush" title="GitHubCommentPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubCommentPush</span></code></a> publishes a comment on a PR using <a class="reference external" href="https://developer.github.com/v3/pulls/comments/">GitHub Review Comments API</a>.</p>
<p>It requires <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> package to allow interaction with GitHub REST API.</p>
<p>It is configured with at least a GitHub API token. By default, it will only comment at the end of a build unless a <code class="docutils literal notranslate"><span class="pre">startDescription</span></code> is provided.</p>
<p>You can create a token from you own <a class="reference external" href="https://github.com/settings/applications">GitHub - Profile - Applications - Register new application</a> or use an external tool to generate one.</p>
<dl class="class">
<dt id="GitHubCommentPush">
<em class="property">class </em><code class="descname">GitHubCommentPush</code><span class="sig-paren">(</span><em>token</em>, <em>startDescription=None</em>, <em>endDescription=None</em>, <em>baseURL=None</em>, <em>verbose=False</em>, <em>builders=None</em><span class="sig-paren">)</span><a class="headerlink" href="#GitHubCommentPush" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>token</strong> (<em>string</em>) – token used for authentication. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>string startDescription</strong> (<em>rendereable</em>) – Custom start message (default: None)</li>
<li><strong>string endDescription</strong> (<em>rendereable</em>) – Custom end message (default: ‘Build done.’)</li>
<li><strong>baseURL</strong> (<em>string</em>) – specify the github api endpoint if you work with GitHub Enterprise</li>
<li><strong>verbose</strong> (<em>boolean</em>) – if True, logs a message for each successful status push</li>
<li><strong>builders</strong> (<em>list</em>) – only send update for specified builders</li>
<li><strong>verify</strong> (<em>boolean</em>) – disable ssl verification for the case you use temporary self signed certificates</li>
<li><strong>debug</strong> (<em>boolean</em>) – logs every requests and their response</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">string for comment, must be less than 65536 bytes.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Here’s a complete example of posting build results as a github comment:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@util.renderer</span>
<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">getresults</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="n">all_logs</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">master</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">master</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">props</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;builders&#39;</span><span class="p">,</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;buildername&#39;</span><span class="p">),</span> <span class="s1">&#39;builds&#39;</span><span class="p">,</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;buildnumber&#39;</span><span class="p">),</span> <span class="s1">&#39;steps&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">step</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">util</span><span class="o">.</span><span class="n">Results</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;failure&#39;</span><span class="p">):</span>
            <span class="n">logs</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s2">&quot;steps&quot;</span><span class="p">,</span> <span class="n">step</span><span class="p">[</span><span class="s1">&#39;stepid&#39;</span><span class="p">],</span> <span class="s1">&#39;logs&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
                <span class="n">all_logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Step : {0} Result : {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">util</span><span class="o">.</span><span class="n">Results</span><span class="p">[</span><span class="n">step</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]]))</span>
                <span class="n">all_logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;```&#39;</span><span class="p">)</span>
                <span class="n">l</span><span class="p">[</span><span class="s1">&#39;stepname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">step</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="n">l</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="n">l</span><span class="p">[</span><span class="s1">&#39;logid&#39;</span><span class="p">],</span> <span class="s1">&#39;contents&#39;</span><span class="p">))</span>
                <span class="n">step_logs</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">include</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">step_logs</span><span class="p">):</span>
                    <span class="n">all_logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sl</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">all_logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;```&#39;</span><span class="p">)</span>
    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">all_logs</span><span class="p">))</span>

<span class="n">gc</span> <span class="o">=</span> <span class="n">GitHubCommentPush</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="s1">&#39;githubAPIToken&#39;</span><span class="p">,</span>
                       <span class="n">endDescription</span><span class="o">=</span><span class="n">getresults</span><span class="p">,</span>
                       <span class="n">context</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;buildbot/%(prop:buildername)s&#39;</span><span class="p">))</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="bitbucketserverstatuspush">
<span id="reporter-BitbucketServerStatusPush"></span><h5><a class="toc-backref" href="#id17">2.5.12.9. BitbucketServerStatusPush</a><a class="headerlink" href="#bitbucketserverstatuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.BitbucketServer.BitbucketServerStatusPush">
<em class="property">class </em><code class="descclassname">buildbot.reporters.BitbucketServer.</code><code class="descname">BitbucketServerStatusPush</code><a class="headerlink" href="#buildbot.reporters.BitbucketServer.BitbucketServerStatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>

<span class="n">ss</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">BitbucketServerStatusPush</span><span class="p">(</span><span class="s1">&#39;https://bitbucketserver.example.com:8080/&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;bitbucketserver_username&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;secret_password&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#BitbucketServerStatusPush" title="BitbucketServerStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitbucketServerStatusPush</span></code></a> publishes build status using <a class="reference external" href="https://developer.atlassian.com/static/rest/bitbucket-server/5.1.0/bitbucket-build-rest.html#idm46185565214672">BitbucketServer Build Integration REST API</a>.
The build status is published to a specific commit SHA in Bitbucket Server.
It tracks the last build for each builderName for each commit built.</p>
<p>Specifically, it follows the <a class="reference external" href="https://developer.atlassian.com/stash/docs/latest/how-tos/updating-build-status-for-commits.html">Updating build status for commits</a> document.</p>
<p>It requires <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> package to allow interaction with Bitbucket Server REST API.</p>
<p>It uses HTTP Basic AUTH.
As a result, we recommend you use https in your base_url rather than http.</p>
<dl class="class">
<dt id="BitbucketServerStatusPush">
<em class="property">class </em><code class="descname">BitbucketServerStatusPush</code><span class="sig-paren">(</span><em>base_url</em>, <em>user</em>, <em>password</em>, <em>key=None</em>, <em>statusName=None</em>, <em>startDescription=None</em>, <em>endDescription=None</em>, <em>verbose=False</em>, <em>builders=None</em><span class="sig-paren">)</span><a class="headerlink" href="#BitbucketServerStatusPush" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>base_url</strong> (<em>string</em>) – The base url of the Bitbucket Server host, up to and optionally including the first <cite>/</cite> of the path.</li>
<li><strong>user</strong> (<em>string</em>) – The Bitbucket Server user to post as. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>password</strong> (<em>string</em>) – The Bitbucket Server user’s password. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>string key</strong> (<em>renderable</em>) – Passed to Bitbucket Server to differentiate between statuses.
A static string can be passed or <code class="xref py py-class docutils literal notranslate"><span class="pre">Interpolate</span></code> for dynamic substitution.
The default key is <cite>%(prop:buildername)s</cite>.</li>
<li><strong>string statusName</strong> (<em>renderable</em>) – The name that is displayed for this status.
The default name is nothing, so Bitbucket Server will use the <code class="docutils literal notranslate"><span class="pre">key</span></code> parameter.</li>
<li><strong>string startDescription</strong> (<em>renderable</em>) – Custom start message (default: ‘Build started.’)</li>
<li><strong>string endDescription</strong> (<em>renderable</em>) – Custom end message (default: ‘Build done.’)</li>
<li><strong>verbose</strong> (<em>boolean</em>) – If True, logs a message for each successful status push.</li>
<li><strong>builders</strong> (<em>list</em>) – Only send update for specified builders.</li>
<li><strong>verify</strong> (<em>boolean</em>) – disable ssl verification for the case you use temporary self signed certificates</li>
<li><strong>debug</strong> (<em>boolean</em>) – logs every requests and their response</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="bitbucketserverprcommentpush">
<span id="reporter-BitbucketServerPRCommentPush"></span><h5><a class="toc-backref" href="#id18">2.5.12.10. BitbucketServerPRCommentPush</a><a class="headerlink" href="#bitbucketserverprcommentpush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.BitbucketServer.BitbucketServerPRCommentPush">
<em class="property">class </em><code class="descclassname">buildbot.reporters.BitbucketServer.</code><code class="descname">BitbucketServerPRCommentPush</code><a class="headerlink" href="#buildbot.reporters.BitbucketServer.BitbucketServerPRCommentPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>

<span class="n">ss</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">BitbucketServerPRCommentPush</span><span class="p">(</span><span class="s1">&#39;https://bitbucket-server.example.com:8080/&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;bitbucket_server__username&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;secret_password&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">BitbucketServerPRCommentPush</span></code>  publishes a comment on a PR using <a class="reference external" href="https://developer.atlassian.com/static/rest/bitbucket-server/5.0.1/bitbucket-rest.html#idm45993793481168">Bitbucket Server REST API</a>.</p>
<dl class="class">
<dt>
<code class="descname">BitBucketServerPRCommentPush(base_url, user, password, messageFormatter=None, verbose=False, debug=None, verify=None, mode=('failing', 'passing', 'warnings'), tags=None, builders=None, schedulers=None, branches=None, buildSetSummary=False):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>base_url</strong> (<em>string</em>) – The base url of the Bitbucket server host</li>
<li><strong>user</strong> (<em>string</em>) – The Bitbucket server user to post as. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>password</strong> (<em>string</em>) – The Bitbucket server user’s password. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>messageFormatter</strong> – This is an optional instance of <code class="xref py py-class docutils literal notranslate"><span class="pre">MessageFormatter</span></code> that can be used to generate a custom comment.</li>
<li><strong>verbose</strong> (<em>boolean</em>) – If True, logs a message for each successful status push.</li>
<li><strong>debug</strong> (<em>boolean</em>) – logs every requests and their response</li>
<li><strong>verify</strong> (<em>boolean</em>) – disable ssl verification for the case you use temporary self signed certificates</li>
<li><strong>mode</strong> (<em>list</em>) – <p>A list of strings which will determine the build status that will be reported.
The values could be <code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">failing</span></code>, <code class="docutils literal notranslate"><span class="pre">passing</span></code>, <code class="docutils literal notranslate"><span class="pre">problem</span></code>, <code class="docutils literal notranslate"><span class="pre">warnings</span></code> or <code class="docutils literal notranslate"><span class="pre">exception</span></code>.
There are two shortcuts:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">all</span></code></dt>
<dd>Equivalent to (<code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">failing</span></code>, <code class="docutils literal notranslate"><span class="pre">passing</span></code>, <code class="docutils literal notranslate"><span class="pre">problem</span></code>, <code class="docutils literal notranslate"><span class="pre">warnings</span></code>, <code class="docutils literal notranslate"><span class="pre">exception</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">warnings</span></code></dt>
<dd>Equivalent to (<code class="docutils literal notranslate"><span class="pre">warnings</span></code>, <code class="docutils literal notranslate"><span class="pre">failing</span></code>).</dd>
</dl>
</div></blockquote>
</li>
<li><strong>tags</strong> (<em>list</em>) – A list of tag names to serve status information for.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> (all tags).
Use either builders or tags, but not both.</li>
<li><strong>builders</strong> (<em>list</em>) – Only send update for specified builders.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> (all builders).
Use either builders or tags, but not both</li>
<li><strong>schedulers</strong> (<em>list</em>) – A list of scheduler names to serve status information for.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> (all schedulers).</li>
<li><strong>branches</strong> (<em>list</em>) – A list of branch names to serve status information for.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code> (all branches).</li>
<li><strong>buildSetSummary</strong> (<em>boolean</em>) – If true, post a comment when a build set is finished with all build completion messages in it, instead of doing it for each separate build.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This reporter depends on the Bitbucket server hook to get the pull request url.</p>
</div>
</div>
<div class="section" id="bitbucketstatuspush">
<span id="reporter-BitbucketStatusPush"></span><h5><a class="toc-backref" href="#id19">2.5.12.11. BitbucketStatusPush</a><a class="headerlink" href="#bitbucketstatuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.bitbucket.BitbucketStatusPush">
<em class="property">class </em><code class="descclassname">buildbot.reporters.bitbucket.</code><code class="descname">BitbucketStatusPush</code><a class="headerlink" href="#buildbot.reporters.bitbucket.BitbucketStatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>
<span class="n">bs</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">BitbucketStatusPush</span><span class="p">(</span><span class="s1">&#39;oauth_key&#39;</span><span class="p">,</span> <span class="s1">&#39;oauth_secret&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#BitbucketStatusPush" title="BitbucketStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitbucketStatusPush</span></code></a> publishes build status using <a class="reference external" href="https://confluence.atlassian.com/bitbucket/buildstatus-resource-779295267.html">Bitbucket Build Status API</a>.
The build status is published to a specific commit SHA in Bitbucket.
It tracks the last build for each builderName for each commit built.</p>
<p>It requires <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> package to allow interaction with the Bitbucket REST and OAuth APIs.</p>
<p>It uses OAuth 2.x to authenticate with Bitbucket.
To enable this, you need to go to your Bitbucket Settings -&gt; OAuth page.
Click “Add consumer”.
Give the new consumer a name, eg ‘buildbot’, and put in any URL as the callback (this is needed for Oauth 2.x but is not used by this reporter, eg ‘<a class="reference external" href="http://localhost:8010/callback">http://localhost:8010/callback</a>’).
Give the consumer Repositories:Write access.
After creating the consumer, you will then be able to see the OAuth key and secret.</p>
<dl class="class">
<dt id="BitbucketStatusPush">
<em class="property">class </em><code class="descname">BitbucketStatusPush</code><span class="sig-paren">(</span><em>oauth_key</em>, <em>oauth_secret</em>, <em>base_url='https://api.bitbucket.org/2.0/repositories'</em>, <em>oauth_url='https://bitbucket.org/site/oauth2/access_token'</em>, <em>builders=None</em><span class="sig-paren">)</span><a class="headerlink" href="#BitbucketStatusPush" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>oauth_key</strong> (<em>string</em>) – The OAuth consumer key. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>oauth_secret</strong> (<em>string</em>) – The OAuth consumer secret. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>base_url</strong> (<em>string</em>) – Bitbucket’s Build Status API URL</li>
<li><strong>oauth_url</strong> (<em>string</em>) – Bitbucket’s OAuth API URL</li>
<li><strong>builders</strong> (<em>list</em>) – only send update for specified builders</li>
<li><strong>verify</strong> (<em>boolean</em>) – disable ssl verification for the case you use temporary self signed certificates</li>
<li><strong>debug</strong> (<em>boolean</em>) – logs every requests and their response</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="gitlabstatuspush">
<span id="reporter-GitLabStatusPush"></span><h5><a class="toc-backref" href="#id20">2.5.12.12. GitLabStatusPush</a><a class="headerlink" href="#gitlabstatuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.gitlab.GitLabStatusPush">
<em class="property">class </em><code class="descclassname">buildbot.reporters.gitlab.</code><code class="descname">GitLabStatusPush</code><a class="headerlink" href="#buildbot.reporters.gitlab.GitLabStatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>

<span class="n">gl</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">GitLabStatusPush</span><span class="p">(</span><span class="s1">&#39;private-token&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;continuous-integration/buildbot&#39;</span><span class="p">,</span> <span class="n">baseURL</span><span class="o">=</span><span class="s1">&#39;https://git.yourcompany.com&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gl</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#GitLabStatusPush" title="GitLabStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitLabStatusPush</span></code></a> publishes build status using <a class="reference external" href="http://doc.gitlab.com/ce/api/commits.html#commit-status">GitLab Commit Status API</a>.
The build status is published to a specific commit SHA in GitLab.</p>
<p>It requires <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> package to allow interaction with GitLab Commit Status API.</p>
<p>It uses private token auth, and the token owner is required to have at least developer access to each repository. As a result, we recommend you use https in your base_url rather than http.</p>
<dl class="class">
<dt id="GitLabStatusPush">
<em class="property">class </em><code class="descname">GitLabStatusPush</code><span class="sig-paren">(</span><em>token</em>, <em>startDescription=None</em>, <em>endDescription=None</em>, <em>context=None</em>, <em>baseURL=None</em>, <em>verbose=False</em><span class="sig-paren">)</span><a class="headerlink" href="#GitLabStatusPush" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>token</strong> (<em>string</em>) – Private token of user permitted to update status for commits. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>startDescription</strong> (<em>string</em>) – Description used when build starts</li>
<li><strong>endDescription</strong> (<em>string</em>) – Description used when build ends</li>
<li><strong>context</strong> (<em>string</em>) – Name of your build system, eg. continuous-integration/buildbot</li>
<li><strong>baseURL</strong> (<em>string</em>) – the base url of the GitLab host, up to and optionally including the first <cite>/</cite> of the path. Do not include /api/</li>
<li><strong>verbose</strong> (<em>string</em>) – Be more verbose</li>
<li><strong>verify</strong> (<em>boolean</em>) – disable ssl verification for the case you use temporary self signed certificates</li>
<li><strong>debug</strong> (<em>boolean</em>) – logs every requests and their response</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="hipchatstatuspush">
<span id="reporter-HipchatStatusPush"></span><h5><a class="toc-backref" href="#id21">2.5.12.13. HipchatStatusPush</a><a class="headerlink" href="#hipchatstatuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.reporters.hipchat.HipchatStatusPush">
<em class="property">class </em><code class="descclassname">buildbot.reporters.hipchat.</code><code class="descname">HipchatStatusPush</code><a class="headerlink" href="#buildbot.reporters.hipchat.HipchatStatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">reporters</span>

<span class="n">hs</span> <span class="o">=</span> <span class="n">reporters</span><span class="o">.</span><span class="n">HipchatStatusPush</span><span class="p">(</span><span class="s1">&#39;private-token&#39;</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s1">&#39;https://chat.yourcompany.com&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">HipchatStatusPush</span></code> publishes a custom message using <a class="reference external" href="https://www.hipchat.com/docs/apiv2">Hipchat API v2</a>.
The message is published to a user and/or room in Hipchat,</p>
<p>It requires <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> package to allow interaction with Hipchat API.</p>
<p>It uses API token auth, and the token owner is required to have at least message/notification access to each destination.</p>
<dl class="class">
<dt>
<code class="descname">HipchatStatusPush(auth_token, endpoint=&quot;https://api.hipchat.com&quot;,</code></dt>
<dt>
<code class="descname">builder_room_map=None, builder_user_map=None,</code></dt>
<dt>
<code class="descname">wantProperties=False, wantSteps=False, wantPreviousBuild=False, wantLogs=False)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>auth_token</strong> (<em>string</em>) – Private API token with access to the “Send Message” and “Send Notification” scopes. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)</li>
<li><strong>endpoint</strong> (<em>string</em>) – (optional) URL of your Hipchat server. Defaults to <a class="reference external" href="https://api.hipchat.com">https://api.hipchat.com</a></li>
<li><strong>builder_room_map</strong> (<em>dictionary</em>) – (optional) If specified, will forward events about a builder (based on name) to the corresponding room ID.</li>
<li><strong>builder_user_map</strong> (<em>dictionary</em>) – (optional) If specified, will forward events about a builder (based on name) to the corresponding user ID.</li>
<li><strong>wantProperties</strong> (<em>boolean</em>) – (optional) include ‘properties’ in the build dictionary</li>
<li><strong>wantSteps</strong> (<em>boolean</em>) – (optional) include ‘steps’ in the build dictionary</li>
<li><strong>wantLogs</strong> (<em>boolean</em>) – (optional) include ‘logs’ in the steps dictionaries.
This needs wantSteps=True.
This dumps the <em>full</em> content of logs.</li>
<li><strong>wantPreviousBuild</strong> (<em>boolean</em>) – (optional) include ‘prev_build’ in the build dictionary</li>
<li><strong>verify</strong> (<em>boolean</em>) – disable ssl verification for the case you use temporary self signed certificates</li>
<li><strong>debug</strong> (<em>boolean</em>) – logs every requests and their response</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">No message will be sent if the message is empty or there is no destination found.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a builder name appears in both the room and user map, the same message will be sent to both destinations.</p>
</div>
<div class="section" id="id3">
<h6><a class="toc-backref" href="#id22">Json object spec</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h6>
<p>The default json object contains the minimal required parameters to send a message to Hipchat.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Buildbot started/finished build MyBuilderName (with result success) here: http://mybuildbot.com/#/builders/23&quot;</span><span class="p">,</span>
    <span class="nt">&quot;id_or_email&quot;</span><span class="p">:</span> <span class="s2">&quot;12&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you require different parameters, the Hipchat reporter utilizes the template design pattern and will call <a class="reference internal" href="#getRecipientList" title="getRecipientList"><code class="xref py py-func docutils literal notranslate"><span class="pre">getRecipientList</span></code></a> <a class="reference internal" href="#getMessage" title="getMessage"><code class="xref py py-func docutils literal notranslate"><span class="pre">getMessage</span></code></a> <a class="reference internal" href="#getExtraParams" title="getExtraParams"><code class="xref py py-func docutils literal notranslate"><span class="pre">getExtraParams</span></code></a>
before sending a message. This allows you to easily override the default implementation for those methods. All of those methods can be deferred.</p>
<p>Method signatures:</p>
<dl class="method">
<dt id="getRecipientList">
<code class="descname">getRecipientList</code><span class="sig-paren">(</span><em>self</em>, <em>build</em>, <em>event_name</em><span class="sig-paren">)</span><a class="headerlink" href="#getRecipientList" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>build</strong> – A <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> object</li>
<li><strong>event_name</strong> (<em>string</em>) – the name of the event trigger for this invocation. either ‘new’ or ‘finished’</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>The deferred should return a dictionary containing the key(s) ‘id_or_email’ for a private user message and/or
‘room_id_or_name’ for room notifications.</p>
</dd></dl>

<dl class="method">
<dt id="getMessage">
<code class="descname">getMessage</code><span class="sig-paren">(</span><em>self</em>, <em>build</em>, <em>event_name</em><span class="sig-paren">)</span><a class="headerlink" href="#getMessage" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>build</strong> – A <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> object</li>
<li><strong>event_name</strong> (<em>string</em>) – the name of the event trigger for this invocation. either ‘new’ or ‘finished’</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>The deferred should return a string to send to Hipchat.</p>
</dd></dl>

<dl class="method">
<dt id="getExtraParams">
<code class="descname">getExtraParams</code><span class="sig-paren">(</span><em>self</em>, <em>build</em>, <em>event_name</em><span class="sig-paren">)</span><a class="headerlink" href="#getExtraParams" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>build</strong> – A <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> object</li>
<li><strong>event_name</strong> (<em>string</em>) – the name of the event trigger for this invocation. either ‘new’ or ‘finished’</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>The deferred should return a dictionary containing any extra parameters you wish to include in your JSON POST
request that the Hipchat API can consume.</p>
</dd></dl>

<p>Here’s a complete example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyHipchatStatusPush</span><span class="p">(</span><span class="n">HipChatStatusPush</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;MyHipchatStatusPush&quot;</span>

    <span class="c1"># send all messages to the same room</span>
    <span class="k">def</span> <span class="nf">getRecipientList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">event_name</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;room_id_or_name&#39;</span><span class="p">:</span> <span class="s1">&#39;AllBuildNotifications&#39;</span>
        <span class="p">}</span>

    <span class="c1"># only send notifications on finished events</span>
    <span class="k">def</span> <span class="nf">getMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">event_name</span><span class="p">):</span>
        <span class="n">event_messages</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;finished&#39;</span><span class="p">:</span> <span class="s1">&#39;Build finished.&#39;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">event_messages</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event_name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># color notifications based on the build result</span>
    <span class="c1"># and alert room on build failure</span>
    <span class="k">def</span> <span class="nf">getExtraParams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">event_name</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">event_name</span> <span class="o">==</span> <span class="s1">&#39;finished&#39;</span><span class="p">:</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;green&#39;</span> <span class="k">if</span> <span class="n">build</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;notify&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">build</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="gerritverifystatuspush">
<span id="reporter-GerritVerifyStatusPush"></span><h5><a class="toc-backref" href="#id23">2.5.12.14. GerritVerifyStatusPush</a><a class="headerlink" href="#gerritverifystatuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.status.status_gerrit_verify_status.GerritVerifyStatusPush">
<em class="property">class </em><code class="descclassname">buildbot.status.status_gerrit_verify_status.</code><code class="descname">GerritVerifyStatusPush</code><a class="headerlink" href="#buildbot.status.status_gerrit_verify_status.GerritVerifyStatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="xref py py-class docutils literal notranslate"><span class="pre">GerritVerifyStatusPush</span></code> sends a verify status to Gerrit using the <a class="reference external" href="https://gerrit.googlesource.com/plugins/verify-status">verify-status</a> Gerrit plugin.</p>
<p>It is an alternate method to <a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a>, which uses the SSH API to send reviews.</p>
<p>The <a class="reference external" href="https://gerrit.googlesource.com/plugins/verify-status">verify-status</a> plugin allows several CI statuses to be sent for the same change, and display them separately in the Gerrit UI.</p>
<p>Most parameters are <span class="target" id="index-5"></span>renderables</p>
<dl class="class">
<dt>
<code class="descname">GerritVerifyStatusPush(</code></dt>
<dt>
<code class="descname">baseURL, auth,</code></dt>
<dt>
<code class="descname">startDescription=&quot;Build started.&quot;, endDescription=&quot;Build done.&quot;,</code></dt>
<dt>
<code class="descname">verification_name=Interpolate(&quot;%(prop:buildername)s&quot;), abstain=False, category=None, reporter=None,</code></dt>
<dt>
<code class="descname">verbose=False, **kwargs)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>baseURL</strong> (<em>string</em>) – Gerrit HTTP base URL</li>
<li><strong>auth</strong> (<em>string</em>) – a requests authentication configuration. (can be a <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>)
if Gerrit is configured with <code class="docutils literal notranslate"><span class="pre">BasicAuth</span></code>, then it shall be <code class="docutils literal notranslate"><span class="pre">('login',</span> <span class="pre">'password')</span></code>
if Gerrit is configured with <code class="docutils literal notranslate"><span class="pre">DigestAuth</span></code>, then it shall be <code class="docutils literal notranslate"><span class="pre">requests.auth.HTTPDigestAuth('login',</span> <span class="pre">'password')</span></code> from the requests module.</li>
<li><strong>string startDescription</strong> (<em>renderable</em>) – the comment sent when the build is starting.</li>
<li><strong>string endDescription</strong> (<em>renderable</em>) – the comment sent when the build is finishing.</li>
<li><strong>string verification_name</strong> (<em>renderable</em>) – the name of the job displayed in the Gerrit UI.</li>
<li><strong>boolean abstain</strong> (<em>renderable</em>) – whether this results should be counted as voting.</li>
<li><strong>boolean category</strong> (<em>renderable</em>) – Category of the build.</li>
<li><strong>boolean reporter</strong> (<em>renderable</em>) – The user that verified this build</li>
<li><strong>verbose</strong> (<em>boolean</em>) – Whether to log every requests.</li>
<li><strong>builders</strong> (<em>list</em>) – only send update for specified builders</li>
<li><strong>verify</strong> (<em>boolean</em>) – disable ssl verification for the case you use temporary self signed certificates</li>
<li><strong>debug</strong> (<em>boolean</em>) – logs every requests and their response</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This reporter is integrated with <code class="xref py py-class docutils literal notranslate"><span class="pre">GerritChangeSource</span></code>, and will update changes detected by this change source.</p>
<p>This reporter can also send reports for changes triggered manually provided that there is a property in the build named <code class="docutils literal notranslate"><span class="pre">gerrit_changes</span></code>, containing the list of changes that were tested.
This property must be a list of dictionaries, containing <code class="docutils literal notranslate"><span class="pre">change_id</span></code> and <code class="docutils literal notranslate"><span class="pre">revision_id</span></code> keys, as defined in the revision endpoints of the <a class="reference external" href="https://gerrit-review.googlesource.com/Documentation/rest-api-changes.html#revision-endpoints">Gerrit documentation</a></p>
</div>
</div>
<span id="document-manual/configuration/www"></span><div class="section" id="web-server">
<span id="cfg-www"></span><h4>2.5.13. Web Server<a class="headerlink" href="#web-server" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of Buildbot 0.9.0, the built-in web server replaces the old <code class="docutils literal notranslate"><span class="pre">WebStatus</span></code> plugin.</p>
</div>
<p>Buildbot contains a built-in web server.
This server is configured with the <code class="docutils literal notranslate"><span class="pre">www</span></code> configuration key, which specifies a dictionary with the following keys:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt>
<dd>The TCP port on which to serve requests.
Note that SSL is not supported.
To host Buildbot with SSL, use an HTTP proxy such as lighttpd, nginx, or Apache.
If this is <code class="docutils literal notranslate"><span class="pre">None</span></code>, the default, then the master will not implement a web server.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">json_cache_seconds</span></code></dt>
<dd>The number of seconds into the future at which an HTTP API response should expire.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rest_minimum_version</span></code></dt>
<dd>The minimum supported REST API version.
Any versions less than this value will not be available.
This can be used to ensure that no clients are depending on API versions that will soon be removed from Buildbot.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">plugins</span></code></dt>
<dd><p class="first">This key gives a dictionary of additional UI plugins to load, along with configuration for those plugins.
These plugins must be separately installed in the Python environment, e.g., <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">buildbot-waterfall-view</span></code>.
See <a class="reference internal" href="#ui-plugins"><span class="std std-ref">UI plugins</span></a>
For example:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;waterfall_view&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">debug</span></code></dt>
<dd>If true, then debugging information will be output to the browser.
This is best set to false (the default) on production systems, to avoid the possibility of information leakage.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">allowed_origins</span></code></dt>
<dd>This gives a list of origins which are allowed to access the Buildbot API (including control via JSONRPC 2.0).
It implements cross-origin request sharing (CORS), allowing pages at origins other than the Buildbot UI to use the API.
Each origin is interpreted as filename match expression, with <code class="docutils literal notranslate"><span class="pre">?</span></code> matching one character and <code class="docutils literal notranslate"><span class="pre">*</span></code> matching anything.
Thus <code class="docutils literal notranslate"><span class="pre">['*']</span></code> will match all origins, and <code class="docutils literal notranslate"><span class="pre">['https://*.buildbot.net']</span></code> will match secure sites under <code class="docutils literal notranslate"><span class="pre">buildbot.net</span></code>.
The Buildbot UI will operate correctly without this parameter; it is only useful for allowing access from other web applications.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">auth</span></code></dt>
<dd>Authentication module to use for the web server.
See <a class="reference internal" href="#web-authentication"><span class="std std-ref">Authentication plugins</span></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">avatar_methods</span></code></dt>
<dd><p class="first">List of methods that can be used to get avatar pictures to use for the web server.
By default, buildbot uses Gravatar to get images associated with each users, if you want to disable this you can just specify empty list:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;avatar_methods&#39;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last">For use of corporate pictures, you can use LdapUserInfo, which can also acts as an avatar provider.
See <a class="reference internal" href="#web-authentication"><span class="std std-ref">Authentication plugins</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logfileName</span></code></dt>
<dd>Filename used for http access logs, relative to the master directory.
If set to <code class="docutils literal notranslate"><span class="pre">None</span></code> or the empty string, the content of the logs will land in the main <code class="file docutils literal notranslate"><span class="pre">twisted.log</span></code> log file.
(Default to <code class="docutils literal notranslate"><span class="pre">http.log</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logRotateLength</span></code></dt>
<dd>The amount of bytes after which the <code class="file docutils literal notranslate"><span class="pre">http.log</span></code> file will be rotated.
(Default to the same value as for the <code class="file docutils literal notranslate"><span class="pre">twisted.log</span></code> file, set in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxRotatedFiles</span></code></dt>
<dd>The amount of log files that will be kept when rotating
(Default to the same value as for the <code class="file docutils literal notranslate"><span class="pre">twisted.log</span></code> file, set in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">versions</span></code></dt>
<dd><p class="first">Custom component versions that you’d like to display on the About page.
Buildbot will automatically prepend the versions of Python, twisted and buildbot itself to the list.</p>
<p><code class="docutils literal notranslate"><span class="pre">versions</span></code> should be a list of tuples. for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;versions&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;master.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;OS&#39;</span><span class="p">,</span> <span class="s1">&#39;Ubuntu 14.04&#39;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="last">The first element of a tuple stands for the name of the component, the second stands for the corresponding version.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">custom_templates_dir</span></code></dt>
<dd><p class="first">This directory will be parsed for custom angularJS templates to replace the one of the original website templates.
if the directory string is relative, it will be joined to the master’s basedir.
Either <code class="docutils literal notranslate"><span class="pre">*.jade</span></code> files or <code class="docutils literal notranslate"><span class="pre">*.html</span></code> files can be used, and will be used to override <code class="docutils literal notranslate"><span class="pre">views/&lt;filename&gt;.html</span></code> templates in the angularjs templateCache.
Unlike with the regular nodejs based angularjs build system, Python only jade interpreter is used to parse the jade templates.
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pyjade</span></code> is be required to use jade templates.
You can also override plugin’s directives, but they have to be in another directory.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># replace the template whose source is in:
# www/base/src/app/builders/build/build.tpl.jade
build.jade

# replace the template whose source is in
# www/console_view/src/module/view/builders-header/buildersheader.tpl.jade
console_view/buildersheader.html
</pre></div>
</div>
<p>Known differences between nodejs jade and pyjade:</p>
<blockquote class="last">
<div><ul class="simple">
<li>quotes in attributes are not quoted. <a class="reference external" href="https://github.com/syrusakbary/pyjade/issues/132">https://github.com/syrusakbary/pyjade/issues/132</a>
This means you should use double quotes for attributes e.g: <code class="docutils literal notranslate"><span class="pre">tr(ng-repeat=&quot;br</span> <span class="pre">in</span> <span class="pre">buildrequests</span> <span class="pre">|</span> <span class="pre">orderBy:'-submitted_at'&quot;)</span></code></li>
</ul>
</div></blockquote>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">change_hook_dialects</span></code></dt>
<dd>See <a class="reference internal" href="#change-hooks"><span class="std std-ref">Change Hooks</span></a>.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">cookie_expiration_time</span></code></p>
<blockquote>
<div><p>This allows to define the timeout of the session cookie.
Should be a <a class="reference external" href="https://docs.python.org/2/library/datetime.html#timedelta-objects">datetime.timedelta</a>.
Default is one week.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;cookie_expiration_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ui_default_config</span></code></p>
<blockquote>
<div><p>Settings in the settings page are stored per browser.
This configuration parameter allows to override the default settings for all your users.
If a user already have changed a value from the default, this will have no effect to him/her.
The settings page in the UI will tell you what to insert in your master.cfg to reproduce the configuration you have in your own browser.
Example use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;ui_default_config&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Builders.buildFetchLimit&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="s1">&#39;Workers.showWorkerBuilders&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="#cfg-buildbotURL" title="buildbotURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildbotURL</span></code></a> configuration value gives the base URL that all masters will use to generate links.
The <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span></code></a> configuration gives the settings for the webserver.
In simple cases, the <code class="docutils literal notranslate"><span class="pre">buildbotURL</span></code> contains the hostname and port of the master, e.g., <code class="docutils literal notranslate"><span class="pre">http://master.example.com:8010/</span></code>.
In more complex cases, with multiple masters, web proxies, or load balancers, the correspondence may be less obvious.</p>
</div>
<div class="section" id="ui-plugins">
<span id="id1"></span><h5>2.5.13.1. UI plugins<a class="headerlink" href="#ui-plugins" title="Permalink to this headline">¶</a></h5>
<div class="section" id="waterfall-view">
<span id="waterfallview"></span><h6>Waterfall View<a class="headerlink" href="#waterfall-view" title="Permalink to this headline">¶</a></h6>
<p>Waterfall shows the whole buildbot activity in vertical time line.
Builds are represented with boxes whose height vary according to their duration.
Builds are sorted by builders in the horizontal axes, which allows you to see how builders are scheduled together.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-waterfall-view
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;waterfall_view&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Waterfall is the emblematic view of Buildbot Eight.
It allowed to see the whole Buildbot activity very quickly.
Waterfall however had big scalability issues, and larger installs had to disable the page in order to avoid tens of seconds master hang because of a big waterfall page rendering.
The whole Buildbot Eight internal status API has been tailored in order to make Waterfall possible.
This is not the case anymore with Buildbot Nine, which has a more generic and scalable <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a> and <a class="reference internal" href="#rest-api"><span class="std std-ref">REST API</span></a>.
This is the reason why Waterfall does not display the steps details anymore.
However nothing is impossible.
We could make a specific REST api available to generate all the data needed for waterfall on the server.
Please step-in if you want to help improve Waterfall view.</p>
</div>
</div>
<div class="section" id="console-view">
<span id="consoleview"></span><h6>Console View<a class="headerlink" href="#console-view" title="Permalink to this headline">¶</a></h6>
<p>Console view shows the whole buildbot activity arranged by changes as discovered by <a class="reference internal" href="#change-sources"><span class="std std-ref">Change Sources and Changes</span></a> vertically and builders horizontally.
If a builder has no build in the current time range, it will not be displayed.
If no change is available for a build, then it will generate a fake change according to the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property.</p>
<p>Console view will also group the builders by tags.
When there are several tags defined per builders, it will first group the builders by the tag that is defined for most builders.
Then given those builders, it will group them again in another tag cluster.
In order to keep the UI usable, you have to keep your tags short!</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-console-view
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;console_view&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Nine’s Console View is the equivalent of Buildbot Eight’s Console and tgrid views.
Unlike Waterfall, we think it is now feature equivalent and even better, with its live update capabilities.
Please submit an issue if you think there is an issue displaying your data, with screen shots of what happen and suggestion on what to improve.</p>
</div>
</div>
<div class="section" id="grid-view">
<span id="gridview"></span><h6>Grid View<a class="headerlink" href="#grid-view" title="Permalink to this headline">¶</a></h6>
<p>Grid view shows the whole buildbot activity arranged by builders vertically and changes horizontally.
It is equivalent to Buildbot Eight’s grid view.</p>
<p>By default, changes on all branches are displayed but only one branch may be filtered by the user.
Builders can also be filtered by tags.
This feature is similar to the one in the builder list.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-grid-view
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;grid_view&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="badges">
<span id="id2"></span><h6>Badges<a class="headerlink" href="#badges" title="Permalink to this headline">¶</a></h6>
<p>Buildbot badges plugin produces an image in SVG or PNG format with information about the last build for the given builder name.
PNG generation is based on the <a class="reference external" href="https://www.cairographics.org/">CAIRO</a> SVG engine, it requires a bit more CPU to generate.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-badges
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;badges&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>You can the access your builder’s badges using urls like <code class="docutils literal notranslate"><span class="pre">http://&lt;buildbotURL&gt;/badges/&lt;buildername&gt;.svg</span></code>.
The default templates are very much configurable via the following options.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;left_text&quot;</span><span class="p">:</span> <span class="s2">&quot;Build Status&quot;</span><span class="p">,</span>  <span class="c1"># text on the left part of the image</span>
    <span class="s2">&quot;left_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#555&quot;</span><span class="p">,</span>  <span class="c1"># color of the left part of the image</span>
    <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;flat&quot;</span><span class="p">,</span>  <span class="c1"># style of the template availables are &quot;flat&quot;, &quot;flat-square&quot;, &quot;plastic&quot;</span>
    <span class="s2">&quot;template_name&quot;</span><span class="p">:</span> <span class="s2">&quot;{style}.svg.j2&quot;</span><span class="p">,</span>  <span class="c1"># name of the template</span>
    <span class="s2">&quot;font_face&quot;</span><span class="p">:</span> <span class="s2">&quot;DejaVu Sans&quot;</span><span class="p">,</span>
    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;color_scheme&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># color to be used for right part of the image</span>
        <span class="s2">&quot;exception&quot;</span><span class="p">:</span> <span class="s2">&quot;#007ec6&quot;</span><span class="p">,</span>  <span class="c1"># blue</span>
        <span class="s2">&quot;failure&quot;</span><span class="p">:</span> <span class="s2">&quot;#e05d44&quot;</span><span class="p">,</span>    <span class="c1"># red</span>
        <span class="s2">&quot;retry&quot;</span><span class="p">:</span> <span class="s2">&quot;#007ec6&quot;</span><span class="p">,</span>      <span class="c1"># blue</span>
        <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="s2">&quot;#007ec6&quot;</span><span class="p">,</span>    <span class="c1"># blue</span>
        <span class="s2">&quot;skipped&quot;</span><span class="p">:</span> <span class="s2">&quot;a4a61d&quot;</span><span class="p">,</span>     <span class="c1"># yellowgreen</span>
        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="s2">&quot;#4c1&quot;</span><span class="p">,</span>       <span class="c1"># brightgreen</span>
        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;#9f9f9f&quot;</span><span class="p">,</span>    <span class="c1"># lightgrey</span>
        <span class="s2">&quot;warnings&quot;</span><span class="p">:</span> <span class="s2">&quot;#dfb317&quot;</span>    <span class="c1"># yellow</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Those options can be configured either using the plugin configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;badges&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;left_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#222&quot;</span><span class="p">}}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or via the URL arguments like <code class="docutils literal notranslate"><span class="pre">http://&lt;buildbotURL&gt;/badges/&lt;buildername&gt;.svg?left_color=222</span></code>.
Custom templates can also be specified in a <code class="docutils literal notranslate"><span class="pre">template</span></code> directory nearby the <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code>.</p>
</div>
</div>
<div class="section" id="authentication-plugins">
<span id="web-authentication"></span><h5>2.5.13.2. Authentication plugins<a class="headerlink" href="#authentication-plugins" title="Permalink to this headline">¶</a></h5>
<p>By default, Buildbot does not require people to authenticate in order to access control features in the web UI.
To secure Buildbot, you will need to configure an authentication plugin.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>To secure the Buildbot web interface, authorization rules must be provided via the ‘authz’ configuration.
If you simply wish to lock down a Buildbot instance so that only read only access is permitted, you can
restrict access to control endpoints to an unpopulated ‘admin’ role. For example:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span><span class="n">allowRules</span><span class="o">=</span><span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">)],</span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As of Buildbot 0.9.4, user session is managed via a <a class="reference external" href="https://en.wikipedia.org/wiki/JSON_Web_Token">JWT</a> token, using <a class="reference external" href="https://pyjwt.readthedocs.io/en/latest/algorithms.html">HS256</a> algorithm.
The session secret is stored in the database in the <code class="docutils literal notranslate"><span class="pre">object_state</span></code> table with <code class="docutils literal notranslate"><span class="pre">name</span></code> column being <code class="docutils literal notranslate"><span class="pre">session_secret</span></code>.
Please make sure appropriate access restriction is made to this database table.</p>
</div>
<p>Authentication plugins are implemented as classes, and passed as the <code class="docutils literal notranslate"><span class="pre">auth</span></code> parameter to <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span></code></a>.</p>
<p>The available classes are described here:</p>
<dl class="class">
<dt id="buildbot.www.auth.NoAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.auth.</code><code class="descname">NoAuth</code><a class="headerlink" href="#buildbot.www.auth.NoAuth" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is the default authentication plugin, which disables authentication</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.auth.UserPasswordAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.auth.</code><code class="descname">UserPasswordAuth</code><span class="sig-paren">(</span><em>users</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.UserPasswordAuth" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>users</strong> – list of <code class="docutils literal notranslate"><span class="pre">(&quot;user&quot;,&quot;password&quot;)</span></code> tuples, or a dictionary of <code class="docutils literal notranslate"><span class="pre">{&quot;user&quot;:</span> <span class="pre">&quot;password&quot;,</span> <span class="pre">..}</span></code></td>
</tr>
</tbody>
</table>
<p>Simple username/password authentication using a list of user/password tuples provided in the configuration file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">UserPasswordAuth</span><span class="p">({</span><span class="s2">&quot;homer&quot;</span><span class="p">:</span> <span class="s2">&quot;doh!&quot;</span><span class="p">}),</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.auth.CustomAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.auth.</code><code class="descname">CustomAuth</code><a class="headerlink" href="#buildbot.www.auth.CustomAuth" title="Permalink to this definition">¶</a></dt>
<dd><p>This authentication class means to be overridden with a custom <code class="docutils literal notranslate"><span class="pre">check_credentials</span></code> method that gets username and password
as arguments and check if the user can login. You may use it e.g. to check the credentials against an external database or file.</p>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">from buildbot.plugins import util</p>
<dl class="docutils">
<dt>class MyAuth(util.CustomAuth):</dt>
<dd><dl class="first last docutils">
<dt>def check_credentials(self, user, password):</dt>
<dd><dl class="first last docutils">
<dt>if user == ‘snow’ and password == ‘white’:</dt>
<dd>return True</dd>
<dt>else:</dt>
<dd>return False</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p class="last">from buildbot.plugins import util
c[‘www’][‘auth’] = MyAuth()</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.auth.HTPasswdAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.auth.</code><code class="descname">HTPasswdAuth</code><span class="sig-paren">(</span><em>passwdFile</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.HTPasswdAuth" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>passwdFile</strong> – An <code class="file docutils literal notranslate"><span class="pre">.htpasswd</span></code> file to read</td>
</tr>
</tbody>
</table>
<p>This class implements simple username/password authentication against a standard <code class="file docutils literal notranslate"><span class="pre">.htpasswd</span></code> file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">HTPasswdAuth</span><span class="p">(</span><span class="s2">&quot;my_htpasswd&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.oauth2.GoogleAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.oauth2.</code><code class="descname">GoogleAuth</code><span class="sig-paren">(</span><em>clientId</em>, <em>clientSecret</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.GoogleAuth" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>clientId</strong> – The client ID of your buildbot application</li>
<li><strong>clientSecret</strong> – The client secret of your buildbot application</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class implements an authentication with <a class="reference external" href="https://developers.google.com/accounts/docs/OAuth2">Google</a> single sign-on.
You can look at the <a class="reference external" href="https://developers.google.com/accounts/docs/OAuth2">Google</a> oauth2 documentation on how to register your Buildbot instance to the Google systems.
The developer console will give you the two parameters you have to give to <code class="docutils literal notranslate"><span class="pre">GoogleAuth</span></code></p>
<p>Register your Buildbot instance with the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_URL/auth/login</span></code> url as the allowed redirect URI.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GoogleAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>in order to use this module, you need to install the Python <code class="docutils literal notranslate"><span class="pre">requests</span></code> module</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install requests
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.oauth2.GitHubAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.oauth2.</code><code class="descname">GitHubAuth</code><span class="sig-paren">(</span><em>clientId</em>, <em>clientSecret</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.GitHubAuth" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">param clientId:</th><td class="field-body">The client ID of your buildbot application</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">param clientSecret:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">The client secret of your buildbot application</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">param serverURL:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">The server URL if this is a GitHub Enterprise server.</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">param apiVersion:</th></tr>
<tr class="field-even field"><td>&#160;</td><td class="field-body">The GitHub API version to use. One of <code class="docutils literal notranslate"><span class="pre">3</span></code> or <code class="docutils literal notranslate"><span class="pre">4</span></code>
(V3/REST or V4/GraphQL). Default=3.</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">param getTeamsMembership:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body">When <code class="docutils literal notranslate"><span class="pre">True</span></code> fetch all team memberships for each or the
organizations the user belongs to. The teams will be included in the
user’s groups as <code class="docutils literal notranslate"><span class="pre">org-name/team-name</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">param debug:</th><td class="field-body">When <code class="docutils literal notranslate"><span class="pre">True</span></code> and using <code class="docutils literal notranslate"><span class="pre">apiVersion=4</span></code> show some additional log calls with the
GraphQL queries and responses for debugging purposes.</td>
</tr>
</tbody>
</table>
<p>This class implements an authentication with <a class="reference external" href="http://developer.github.com/v3/oauth_authorizations/">GitHub</a> single sign-on.
It functions almost identically to the <a class="reference internal" href="#buildbot.www.oauth2.GoogleAuth" title="buildbot.www.oauth2.GoogleAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleAuth</span></code></a> class.</p>
<p>Register your Buildbot instance with the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_URL/auth/login</span></code> url as the allowed redirect URI.</p>
<p>The user’s email-address (for e.g. authorization) is set to the “primary” address set by the user in GitHub.
When using group-based authorization, the user’s groups are equal to the names of the GitHub organizations the user
is a member of.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GitHubAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example for Enterprise GitHub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GitHubAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">,</span> <span class="s2">&quot;https://git.corp.mycompany.com&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An example on fetching team membership could be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GitHubAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">,</span> <span class="n">apiVersion</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">getTeamsMembership</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="s1">&#39;authz&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
        <span class="n">allowRules</span><span class="o">=</span><span class="p">[</span>
          <span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;core-developers&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
          <span class="n">util</span><span class="o">.</span><span class="n">RolesFromGroups</span><span class="p">(</span><span class="n">groupPrefix</span><span class="o">=</span><span class="s1">&#39;buildbot/&#39;</span><span class="p">)</span>
        <span class="p">]</span>
      <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>If the <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> organization had two teams, for example, ‘core-developers’ and ‘contributors’,
with the above example, any user belonging to those teams would be granted the roles matching those
team names.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.oauth2.GitLabAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.oauth2.</code><code class="descname">GitLabAuth</code><span class="sig-paren">(</span><em>instanceUri</em>, <em>clientId</em>, <em>clientSecret</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.GitLabAuth" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>instanceUri</strong> – The URI of your GitLab instance</li>
<li><strong>clientId</strong> – The client ID of your buildbot application</li>
<li><strong>clientSecret</strong> – The client secret of your buildbot application</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class implements an authentication with <a class="reference external" href="http://doc.gitlab.com/ce/integration/oauth_provider.html">GitLab</a> single sign-on.
It functions almost identically to the <a class="reference internal" href="#buildbot.www.oauth2.GoogleAuth" title="buildbot.www.oauth2.GoogleAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleAuth</span></code></a> class.</p>
<p>Register your Buildbot instance with the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_URL/auth/login</span></code> url as the allowed redirect URI.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GitLabAuth</span><span class="p">(</span><span class="s2">&quot;https://gitlab.com&quot;</span><span class="p">,</span> <span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.oauth2.BitbucketAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.oauth2.</code><code class="descname">BitbucketAuth</code><span class="sig-paren">(</span><em>clientId</em>, <em>clientSecret</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.BitbucketAuth" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>clientId</strong> – The client ID of your buildbot application</li>
<li><strong>clientSecret</strong> – The client secret of your buildbot application</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class implements an authentication with <a class="reference external" href="https://confluence.atlassian.com/bitbucket/oauth-on-bitbucket-cloud-238027431.html">Bitbucket</a> single sign-on.
It functions almost identically to the <a class="reference internal" href="#buildbot.www.oauth2.GoogleAuth" title="buildbot.www.oauth2.GoogleAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleAuth</span></code></a> class.</p>
<p>Register your Buildbot instance with the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_URL/auth/login</span></code> url as the allowed redirect URI.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BitbucketAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.auth.RemoteUserAuth">
<em class="property">class </em><code class="descclassname">buildbot.www.auth.</code><code class="descname">RemoteUserAuth</code><a class="headerlink" href="#buildbot.www.auth.RemoteUserAuth" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>header</strong> – header to use to get the username (defaults to <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code>)</li>
<li><strong>headerRegex</strong> – regular expression to get the username from header value (defaults to <code class="docutils literal notranslate"><span class="pre">&quot;(?P&lt;username&gt;[^</span> <span class="pre">&#64;]+)&#64;(?P&lt;realm&gt;[^</span> <span class="pre">&#64;]+)&quot;)</span></code>.
Note that your at least need to specify a <code class="docutils literal notranslate"><span class="pre">?P&lt;username&gt;</span></code> regular expression named group.</li>
<li><strong>userInfoProvider</strong> – user info provider; see <a class="reference internal" href="#user-information"><span class="std std-ref">User Information</span></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If the Buildbot UI is served through a reverse proxy that supports HTTP-based authentication (like apache or lighttpd), it’s possible to to tell Buildbot to trust the web server and get the username from th request headers.</p>
<p>Administrator must make sure that it’s impossible to get access to Buildbot using other way than through frontend.
Usually this means that Buildbot should listen for incoming connections only on localhost (or on some firewall-protected port).
The reverse proxy must require HTTP authentication to access Buildbot pages (using any source for credentials, such as htpasswd, PAM, LDAP, Kerberos).</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">RemoteUserAuth</span><span class="p">(),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A corresponding Apache configuration example</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Location &quot;/&quot;&gt;
        AuthType Kerberos
        AuthName &quot;Buildbot login via Kerberos&quot;
        KrbMethodNegotiate On
        KrbMethodK5Passwd On
        KrbAuthRealms &lt;&lt;YOUR CORP REALMS&gt;&gt;
        KrbVerifyKDC off
        KrbServiceName Any
        Krb5KeyTab /etc/krb5/krb5.keytab
        KrbSaveCredentials Off
        require valid-user
        Order allow,deny

        Satisfy Any

        #] SSO
        RewriteEngine On
        RewriteCond %{LA-U:REMOTE_USER} (.+)$
        RewriteRule . - [E=RU:%1,NS]
        RequestHeader set REMOTE_USER %{RU}e

&lt;/Location&gt;
</pre></div>
</div>
<p>The advantage of this sort of authentication is that it is uses a proven and fast implementation for authentication.
The problem is that the only information that is passed to Buildbot is the username, and there is no way to pass any other information like user email, user groups, etc.
That information can be very useful to the mailstatus plugin, or for authorization processes.
See <a class="reference internal" href="#user-information"><span class="std std-ref">User Information</span></a> for a mechanism to supply that information.</p>
</dd></dl>

</div>
<div class="section" id="user-information">
<span id="id3"></span><h5>2.5.13.3. User Information<a class="headerlink" href="#user-information" title="Permalink to this headline">¶</a></h5>
<p>For authentication mechanisms which cannot provide complete information about a user, Buildbot needs another way to get user data.
This is useful both for authentication (to fetch more data about the logged-in user) and for avatars (to fetch data about other users).</p>
<p>This extra information is provided by, appropriately enough, user info providers.
These can be passed to <a class="reference internal" href="#buildbot.www.auth.RemoteUserAuth" title="buildbot.www.auth.RemoteUserAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteUserAuth</span></code></a> and as an element of <code class="docutils literal notranslate"><span class="pre">avatar_methods</span></code>.</p>
<p>This can also be passed to oauth2 authentication plugins.
In this case the username provided by oauth2 will be used, and all other information will be taken from ldap (Full Name, email, and groups):</p>
<p>Currently only one provider is available:</p>
<dl class="class">
<dt id="buildbot.ldapuserinfo.LdapUserInfo">
<em class="property">class </em><code class="descclassname">buildbot.ldapuserinfo.</code><code class="descname">LdapUserInfo</code><span class="sig-paren">(</span><em>uri</em>, <em>bindUser</em>, <em>bindPw</em>, <em>accountBase</em>, <em>accountPattern</em>, <em>groupBase=None</em>, <em>groupMemberPattern=None</em>, <em>groupName=None</em>, <em>accountFullName</em>, <em>accountEmail</em>, <em>avatarPattern=None</em>, <em>avatarData=None</em>, <em>accountExtraFields=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.ldapuserinfo.LdapUserInfo" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>uri</strong> – uri of the ldap server</li>
<li><strong>bindUser</strong> – username of the ldap account that is used to get the infos for other users (usually a “faceless” account)</li>
<li><strong>bindPw</strong> – password of the <code class="docutils literal notranslate"><span class="pre">bindUser</span></code></li>
<li><strong>accountBase</strong> – the base dn (distinguished name)of the user database</li>
<li><strong>accountPattern</strong> – the pattern for searching in the account database.
This must contain the <code class="docutils literal notranslate"><span class="pre">%(username)s</span></code> string, which is replaced by the searched username</li>
<li><strong>accountFullName</strong> – the name of the field in account ldap database where the full user name is to be found.</li>
<li><strong>accountEmail</strong> – the name of the field in account ldap database where the user email is to be found.</li>
<li><strong>groupBase</strong> – the base dn of the groups database.</li>
<li><strong>groupMemberPattern</strong> – the pattern for searching in the group database.
This must contain the <code class="docutils literal notranslate"><span class="pre">%(dn)s</span></code> string, which is replaced by the searched username’s dn</li>
<li><strong>groupName</strong> – the name of the field in groups ldap database where the group name is to be found.</li>
<li><strong>avatarPattern</strong> – the pattern for searching avatars from emails in the account database.
This must contain the <code class="docutils literal notranslate"><span class="pre">%(email)s</span></code> string, which is replaced by the searched email</li>
<li><strong>avatarData</strong> – the name of the field in groups ldap database where the avatar picture is to be found.
This field is supposed to contain the raw picture, format is automatically detected from jpeg, png or git.</li>
<li><strong>accountExtraFields</strong> – extra fields to extracts for use with the authorization policies.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If one of the three optional groups parameters is supplied, then all of them become mandatory. If none is supplied, the retrieved user info has an empty list of groups.</p>
</dd></dl>

<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="c1"># this configuration works for MS Active Directory ldap implementation</span>
<span class="c1"># we use it for user info, and avatars</span>
<span class="n">userInfoProvider</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">LdapUserInfo</span><span class="p">(</span>
    <span class="n">uri</span><span class="o">=</span><span class="s1">&#39;ldap://ldap.mycompany.com:3268&#39;</span><span class="p">,</span>
    <span class="n">bindUser</span><span class="o">=</span><span class="s1">&#39;ldap_user&#39;</span><span class="p">,</span>
    <span class="n">bindPw</span><span class="o">=</span><span class="s1">&#39;p4$$wd&#39;</span><span class="p">,</span>
    <span class="n">accountBase</span><span class="o">=</span><span class="s1">&#39;dc=corp,dc=mycompany,dc=com&#39;</span><span class="p">,</span>
    <span class="n">groupBase</span><span class="o">=</span><span class="s1">&#39;dc=corp,dc=mycompany,dc=com&#39;</span><span class="p">,</span>
    <span class="n">accountPattern</span><span class="o">=</span><span class="s1">&#39;(&amp;(objectClass=person)(sAMAccountName=</span><span class="si">%(username)s</span><span class="s1">))&#39;</span><span class="p">,</span>
    <span class="n">accountFullName</span><span class="o">=</span><span class="s1">&#39;displayName&#39;</span><span class="p">,</span>
    <span class="n">accountEmail</span><span class="o">=</span><span class="s1">&#39;mail&#39;</span><span class="p">,</span>
    <span class="n">groupMemberPattern</span><span class="o">=</span><span class="s1">&#39;(&amp;(objectClass=group)(member=</span><span class="si">%(dn)s</span><span class="s1">))&#39;</span><span class="p">,</span>
    <span class="n">groupName</span><span class="o">=</span><span class="s1">&#39;cn&#39;</span><span class="p">,</span>
    <span class="n">avatarPattern</span><span class="o">=</span><span class="s1">&#39;(&amp;(objectClass=person)(mail=</span><span class="si">%(email)s</span><span class="s1">))&#39;</span><span class="p">,</span>
    <span class="n">avatarData</span><span class="o">=</span><span class="s1">&#39;thumbnailPhoto&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">PORT</span><span class="p">,</span> <span class="n">allowed_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
                <span class="n">url</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;buildbotURL&#39;</span><span class="p">],</span>
                <span class="n">auth</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">RemoteUserAuth</span><span class="p">(</span><span class="n">userInfoProvider</span><span class="o">=</span><span class="n">userInfoProvider</span><span class="p">),</span>
                <span class="n">avatar_methods</span><span class="o">=</span><span class="p">[</span><span class="n">userInfoProvider</span><span class="p">,</span>
                                <span class="n">util</span><span class="o">.</span><span class="n">AvatarGravatar</span><span class="p">()])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In order to use this module, you need to install the <code class="docutils literal notranslate"><span class="pre">ldap3</span></code> module:</p>
<div class="last highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install ldap3
</pre></div>
</div>
</div>
<p>In the case of oauth2 authentications, you have to pass the userInfoProvider as keyword argument:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="n">userInfoProvider</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">LdapUserInfo</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GoogleAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">,</span> <span class="n">userInfoProvider</span><span class="o">=</span><span class="n">userInfoProvider</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="reverse-proxy-configuration">
<span id="reverse-proxy-config"></span><h5>2.5.13.4. Reverse Proxy Configuration<a class="headerlink" href="#reverse-proxy-configuration" title="Permalink to this headline">¶</a></h5>
<p>It is usually better to put buildbot behind a reverse proxy in production.</p>
<ul class="simple">
<li>Provides automatic gzip compression</li>
<li>Provides SSL support with a widely used implementation</li>
<li>Provides support for http/2 or spdy for fast parallel REST api access from the browser</li>
</ul>
<p>Reverse proxy however might be problematic for websocket, you have to configure it specifically to pass web socket requests.
Here is an nginx configuration that is known to work (nginx 1.6.2):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>server {
        # Enable SSL and http2
        listen 443 ssl http2 default_server;

        server_name yourdomain.com;

        root html;
        index index.html index.htm;

        ssl on;
        ssl_certificate /etc/nginx/ssl/server.cer;
        ssl_certificate_key /etc/nginx/ssl/server.key;

        # put a one day session timeout for websockets to stay longer
        ssl_session_cache      shared:SSL:10m;
        ssl_session_timeout  1440m;

        # please consult latest nginx documentation for current secure encryption settings
        ssl_protocols ..
        ssl_ciphers ..
        ssl_prefer_server_ciphers   on;
        #

        # force https
        add_header Strict-Transport-Security &quot;max-age=31536000; includeSubdomains;&quot;;
        spdy_headers_comp 5;

        proxy_set_header HOST $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto  $scheme;
        proxy_set_header X-Forwarded-Server  $host;
        proxy_set_header X-Forwarded-Host  $host;

        # you could use / if you use domain based proxy instead of path based proxy
        location /buildbot/ {
            proxy_pass http://127.0.0.1:5000/;
        }
        location /buildbot/sse/ {
            # proxy buffering will prevent sse to work
            proxy_buffering off;
            proxy_pass http://127.0.0.1:5000/sse/;
        }
        # required for websocket
        location /buildbot/ws {
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection &quot;upgrade&quot;;
            proxy_pass http://127.0.0.1:5000/ws;
            # raise the proxy timeout for the websocket
            proxy_read_timeout 6000s;
        }
}
</pre></div>
</div>
<p>To run with Apache2, you’ll need <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_wstunnel.html">mod_proxy_wstunnel</a> in addition to <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_http.html">mod_proxy_http</a>. Serving HTTPS (<a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_ssl.html">mod_ssl</a>) is advised to prevent issues with enterprise proxies (see <a class="reference internal" href="#sse"><span class="std std-ref">Server Sent Events</span></a>), even if you don’t need the encryption itself.</p>
<p>Here is a configuration that is known to work (Apache 2.4.10 / Debian 8, Apache 2.4.25 / Debian 9, Apache 2.4.6 / CentOS 7), directly at the top of the domain.</p>
<p>If you want to add access control directives, just put them in a
<code class="docutils literal notranslate"><span class="pre">&lt;Location</span> <span class="pre">/&gt;</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;VirtualHost *:443&gt;
    ServerName buildbot.example
    ServerAdmin webmaster@buildbot.example

    # replace with actual port of your Buildbot master
    ProxyPass /ws ws://127.0.0.1:8020/ws
    ProxyPassReverse /ws ws://127.0.0.1:8020/ws
    ProxyPass / http://127.0.0.1:8020/
    ProxyPassReverse / http://127.0.0.1:8020/

    SetEnvIf X-Url-Scheme https HTTPS=1
    ProxyPreserveHost On

    SSLEngine on
    SSLCertificateFile /path/to/cert.pem
    SSLCertificateKeyFile /path/to/cert.key

    # check Apache2 documentation for current safe SSL settings
    # This is actually the Debian 8 default at the time of this writing:
    SSLProtocol all -SSLv3

&lt;/VirtualHost&gt;
</pre></div>
</div>
</div>
<div class="section" id="authorization-rules">
<span id="web-authorization"></span><h5>2.5.13.5. Authorization rules<a class="headerlink" href="#authorization-rules" title="Permalink to this headline">¶</a></h5>
<p>The authorization framework in Buildbot is very generic and flexible.
Drawback is that it is not very obvious for newcomers.
The ‘simple’ example will however allow you to easily start by implementing an admins-have-all-rights setup.</p>
<p>Please carefully read the following documentation to understand how to setup authorization in Buildbot.</p>
<p>Authorization framework is tightly coupled to the REST API.
Authorization framework only works for HTTP, not for other means of interaction like IRC or try scheduler.
It allows or denies access to the REST APIs according to rules.</p>
<div><svg height="120" viewBox="0 0 1216 120" width="1216" xmlns="http://www.w3.org/2000/svg" xmlns:inkspace="http://www.inkscape.org/namespaces/inkscape" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs id="defs_block">
    <filter height="1.504" id="filter_blur" inkspace:collect="always" width="1.1575" x="-0.07875" y="-0.252">
      <feGaussianBlur id="feGaussianBlur3780" inkspace:collect="always" stdDeviation="4.2" />
    </filter>
  </defs>
  <title>blockdiag</title>
  <desc />
  <polygon fill="rgb(0,0,0)" points="133,60 133,63 143,63 143,66 133,66 133,69 141,78 137,78 131,72 125,78 121,78 129,69 129,66 119,66 119,63 129,63 129,60" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <ellipse cx="131" cy="57" fill="rgb(0,0,0)" rx="4" ry="4" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <polygon fill="rgb(0,0,0)" points="325,60 325,63 335,63 335,66 325,66 325,69 333,78 329,78 323,72 317,78 313,78 321,69 321,66 311,66 311,63 321,63 321,60" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <ellipse cx="323" cy="57" fill="rgb(0,0,0)" rx="4" ry="4" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <polygon fill="rgb(0,0,0)" points="515,38 587,66 515,94 443,66 515,38" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="643" y="46" />
  <polygon fill="rgb(0,0,0)" points="899,38 971,66 899,94 827,66 899,38" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="1027" y="46" />
  <polygon fill="rgb(255,255,255)" points="130,54 130,57 140,57 140,60 130,60 130,63 138,72 134,72 128,66 122,72 118,72 126,63 126,60 116,60 116,57 126,57 126,54" stroke="rgb(0,0,0)" />
  <ellipse cx="128" cy="51" fill="rgb(255,255,255)" rx="4" ry="4" stroke="rgb(0,0,0)" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="24" x="128" y="85">User</text>
  <polygon fill="rgb(255,255,255)" points="322,54 322,57 332,57 332,60 322,60 322,63 330,72 326,72 320,66 314,72 310,72 318,63 318,60 308,60 308,57 318,57 318,54" stroke="rgb(0,0,0)" />
  <ellipse cx="320" cy="51" fill="rgb(255,255,255)" rx="4" ry="4" stroke="rgb(0,0,0)" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="102" x="320" y="85">AuthenticatedUser</text>
  <polygon fill="rgb(255,255,255)" points="512,32 584,60 512,88 440,60 512,32" stroke="rgb(0,0,0)" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="66" x="512" y="66">RoleMatcher</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="640" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="24" x="704" y="66">Role</text>
  <polygon fill="rgb(255,255,255)" points="896,32 968,60 896,88 824,60 896,32" stroke="rgb(0,0,0)" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="72" x="896" y="59">EndpointMatc</text>
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="18" x="896" y="72">her</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="1024" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="102" x="1088" y="66">REST API Endpoint</text>
  <path d="M 140 60 L 300 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="307,60 300,56 300,64 307,60" stroke="rgb(0,0,0)" />
  <path d="M 332 60 L 432 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="439,60 432,56 432,64 439,60" stroke="rgb(0,0,0)" />
  <path d="M 584 60 L 632 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="639,60 632,56 632,64 639,60" stroke="rgb(0,0,0)" />
  <path d="M 776 60 L 824 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="769,60 776,56 776,64 769,60" stroke="rgb(0,0,0)" />
  <path d="M 976 60 L 1024 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="969,60 976,56 976,64 969,60" stroke="rgb(0,0,0)" />
  <rect fill="white" height="15" stroke="rgb(0,0,0)" width="40" x="204" y="38" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="24" x="224" y="51">Auth</text>
</svg>
</div>
<ul>
<li><p class="first">Roles is a label that you give to a user.</p>
<p>It is similar but different to the usual notion of group:</p>
<ul class="simple">
<li>A user can have several roles, and a role can be given to several users.</li>
<li>Role is an application specific notion, while group is more organization specific notion.</li>
<li>Groups are given by the auth plugin, e.g <code class="docutils literal notranslate"><span class="pre">ldap</span></code>, <code class="docutils literal notranslate"><span class="pre">github</span></code>, and are not always in the precise control of the buildbot admins.</li>
<li>Roles can be dynamically assigned, according to the context.
For example, there is the <code class="docutils literal notranslate"><span class="pre">owner</span></code> role, which can be given to a user for a build that he is at the origin, so that he can stop or rebuild only builds of his own.</li>
</ul>
</li>
<li><p class="first">Endpoint matchers associate role requirements to REST API endpoints.
The default policy is allow in case no matcher matches (see below why)</p>
</li>
<li><p class="first">Role matchers associate authenticated users to roles.</p>
</li>
</ul>
<div class="section" id="authz-configuration">
<h6>Authz Configuration<a class="headerlink" href="#authz-configuration" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.www.authz.Authz">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.</code><code class="descname">Authz</code><span class="sig-paren">(</span><em>allowRules=[]</em>, <em>roleMatcher=[]</em>, <em>stringsMatcher=util.fnmatchStrMatcher</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.Authz" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>allowRules</strong> – List of <code class="xref py py-class docutils literal notranslate"><span class="pre">EndpointMatcherBase</span></code> processed in order for each endpoint grant request.</li>
<li><strong>roleMatcher</strong> – List of RoleMatchers</li>
<li><strong>stringsMatcher</strong> – Selects algorithm used to make strings comparison (used to compare roles and builder names).
can be <code class="xref py py-class docutils literal notranslate"><span class="pre">util.fnmatchStrMatcher</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">util.reStrMatcher</span></code> from <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">buildbot.plugins</span> <span class="pre">import</span> <span class="pre">util</span></code></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Authz</span></code> needs to be configured in <code class="docutils literal notranslate"><span class="pre">c['www']['authz']</span></code></p>
</dd></dl>

</div>
<div class="section" id="endpoint-matchers">
<h6>Endpoint matchers<a class="headerlink" href="#endpoint-matchers" title="Permalink to this headline">¶</a></h6>
<p>Endpoint matchers are responsible for creating rules to match REST endpoints, and requiring roles for them.
Endpoint matchers are processed in the order they are configured.
The first rule matching an endpoint will prevent further rules from being checked.
To continue checking other rules when the result is <cite>deny</cite>, set <cite>defaultDeny=False</cite>.
If no endpoint matcher matches, then the access is granted.</p>
<p>One can implement the default deny policy by putting an <code class="xref py py-class docutils literal notranslate"><span class="pre">AnyEndpointMatcher</span></code> with nonexistent role in the end of the list.
Please note that this will deny all REST apis, and most of the UI do not implement proper access denied message in case of such error.</p>
<p>The following sequence is implemented by each EndpointMatcher class.</p>
<ul class="simple">
<li>Check whether the requested endpoint is supported by this matcher</li>
<li>Get necessary info from data api, and decides whether it matches.</li>
<li>Look if the users has the required role.</li>
</ul>
<p>Several endpoints matchers are currently implemented.
If you need a very complex setup, you may need to implement your own endpoint matchers.
In this case, you can look at the source code for detailed examples on how to write endpoint matchers.</p>
<dl class="class">
<dt id="buildbot.www.authz.endpointmatchers.EndpointMatcherBase">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.endpointmatchers.</code><code class="descname">EndpointMatcherBase</code><span class="sig-paren">(</span><em>role</em>, <em>defaultDeny=True</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.EndpointMatcherBase" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>role</strong> – The role which grants access to this endpoint.
List of roles is not supported, but a <code class="docutils literal notranslate"><span class="pre">fnmatch</span></code> expression can be provided to match several roles.</li>
<li><strong>defaultDeny</strong> – The role matcher algorithm will stop if this value is true, and if the endpoint matched.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This is the base endpoint matcher.
Its arguments are inherited by all the other endpoint matchers.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.endpointmatchers.AnyEndpointMatcher">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.endpointmatchers.</code><code class="descname">AnyEndpointMatcher</code><span class="sig-paren">(</span><em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.AnyEndpointMatcher" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>role</strong> – The role which grants access to any endpoint.</td>
</tr>
</tbody>
</table>
<p>AnyEndpointMatcher grants all rights to people with given role (usually “admins”)</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.endpointmatchers.AnyControlEndpointMatcher">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.endpointmatchers.</code><code class="descname">AnyControlEndpointMatcher</code><span class="sig-paren">(</span><em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.AnyControlEndpointMatcher" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>role</strong> – The role which grants access to any control endpoint.</td>
</tr>
</tbody>
</table>
<p>AnyControlEndpointMatcher grants control rights to people with given role (usually “admins”)
This endpoint matcher is matches current and future control endpoints.
You need to add this in the end of your configuration to make sure it is future proof.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.endpointmatchers.ForceBuildEndpointMatcher">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.endpointmatchers.</code><code class="descname">ForceBuildEndpointMatcher</code><span class="sig-paren">(</span><em>builder</em>, <em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.ForceBuildEndpointMatcher" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>builder</strong> – name of the builder.</li>
<li><strong>role</strong> – The role needed to get access to such endpoints.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>ForceBuildEndpointMatcher grants right to force builds.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.endpointmatchers.StopBuildEndpointMatcher">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.endpointmatchers.</code><code class="descname">StopBuildEndpointMatcher</code><span class="sig-paren">(</span><em>builder</em>, <em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.StopBuildEndpointMatcher" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>builder</strong> – name of the builder.</li>
<li><strong>role</strong> – The role needed to get access to such endpoints.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>StopBuildEndpointMatcher grants rights to stop builds.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.endpointmatchers.RebuildBuildEndpointMatcher">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.endpointmatchers.</code><code class="descname">RebuildBuildEndpointMatcher</code><span class="sig-paren">(</span><em>builder</em>, <em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.RebuildBuildEndpointMatcher" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>builder</strong> – name of the builder.</li>
<li><strong>role</strong> – The role needed to get access to such endpoints.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>RebuildBuildEndpointMatcher grants rights to rebuild builds.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.endpointmatchers.EnableSchedulerEndpointMatcher">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.endpointmatchers.</code><code class="descname">EnableSchedulerEndpointMatcher</code><span class="sig-paren">(</span><em>builder</em>, <em>role</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.EnableSchedulerEndpointMatcher" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>builder</strong> – name of the builder.</li>
<li><strong>role</strong> – The role needed to get access to such endpoints.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>EnableSchedulerEndpointMatcher grants rights to enable and disable schedulers via the UI.</p>
</dd></dl>

</div>
<div class="section" id="role-matchers">
<h6>Role matchers<a class="headerlink" href="#role-matchers" title="Permalink to this headline">¶</a></h6>
<p>Endpoint matchers are responsible for creating rules to match people and grant them roles.
You can grant roles from groups information provided by the Auth plugins, or if you prefer directly to people’s email.</p>
<dl class="class">
<dt id="buildbot.www.authz.roles.RolesFromGroups">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.roles.</code><code class="descname">RolesFromGroups</code><span class="sig-paren">(</span><em>groupPrefix</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromGroups" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>groupPrefix</strong> – prefix to remove from each group</td>
</tr>
</tbody>
</table>
<p>RolesFromGroups grants roles from the groups of the user.
If a user has group <code class="docutils literal notranslate"><span class="pre">buildbot-admin</span></code>, and groupPrefix is <code class="docutils literal notranslate"><span class="pre">buildbot-</span></code>, then user will be granted the role ‘admin’</p>
<p>ex:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
  <span class="n">util</span><span class="o">.</span><span class="n">RolesFromGroups</span><span class="p">(</span><span class="n">groupPrefix</span><span class="o">=</span><span class="s2">&quot;buildbot-&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.roles.RolesFromEmails">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.roles.</code><code class="descname">RolesFromEmails</code><span class="sig-paren">(</span><em>roledict</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromEmails" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>roledict</strong> – dictionary with key=role, and value=list of email strings</td>
</tr>
</tbody>
</table>
<p>RolesFromEmails grants roles to users according to the hardcoded emails.</p>
<p>ex:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
  <span class="n">util</span><span class="o">.</span><span class="n">RolesFromEmails</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my@email.com&quot;</span><span class="p">])</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.roles.RolesFromDomain">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.roles.</code><code class="descname">RolesFromDomain</code><span class="sig-paren">(</span><em>roledict</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromDomain" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>roledict</strong> – dictionary with key=role, and value=list of domain strings</td>
</tr>
</tbody>
</table>
<p>RolesFromDomain grants roles to users according to their email domains.
If a user tried to login with email <code class="docutils literal notranslate"><span class="pre">foo&#64;gmail.com</span></code>, then user will be granted the role ‘admins’.</p>
<p>ex:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
  <span class="n">util</span><span class="o">.</span><span class="n">RolesFromDomain</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gmail.com&quot;</span><span class="p">])</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.roles.RolesFromOwner">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.roles.</code><code class="descname">RolesFromOwner</code><span class="sig-paren">(</span><em>roledict</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromOwner" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>roledict</strong> – dictionary with key=role, and value=list of email strings</td>
</tr>
</tbody>
</table>
<p>RolesFromOwner grants a given role when property owner matches the email of the user</p>
<p>ex:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">RolesFromOwner</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.authz.roles.RolesFromUsername">
<em class="property">class </em><code class="descclassname">buildbot.www.authz.roles.</code><code class="descname">RolesFromUsername</code><span class="sig-paren">(</span><em>roles</em>, <em>usernames</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromUsername" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>roles</strong> – roles to assign when the username matches.</li>
<li><strong>usernames</strong> – list of usernames that have the roles.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>RolesFromUsername grants the given roles when the <code class="docutils literal notranslate"><span class="pre">username</span></code> property is within the list of usernames.</p>
<p>ex:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">RolesFromUsername</span><span class="p">(</span><span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;admins&quot;</span><span class="p">],</span> <span class="n">usernames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">]),</span>
    <span class="n">RolesFromUsername</span><span class="p">(</span><span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;developers&quot;</span><span class="p">,</span> <span class="s2">&quot;integrators&quot;</span><span class="p">],</span> <span class="n">usernames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">])</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="example-configs">
<h6>Example Configs<a class="headerlink" href="#example-configs" title="Permalink to this headline">¶</a></h6>
<p>Simple config which allows admin people to control everything, but allow anonymous to look at build results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">authz</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
  <span class="n">allowRules</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">),</span>
  <span class="p">],</span>
  <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">RolesFromEmails</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my@email.com&quot;</span><span class="p">])</span>
  <span class="p">]</span>
<span class="p">)</span>
<span class="n">auth</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">UserPasswordAuth</span><span class="p">({</span><span class="s1">&#39;my@email.com&#39;</span><span class="p">:</span> <span class="s1">&#39;mypass&#39;</span><span class="p">})</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;auth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authz</span>
</pre></div>
</div>
<p>More complex config with separation per branch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">authz</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
    <span class="n">stringsMatcher</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">fnmatchStrMatcher</span><span class="p">,</span>  <span class="c1"># simple matcher with &#39;*&#39; glob character</span>
    <span class="c1"># stringsMatcher = util.reStrMatcher,   # if you prefer regular expressions</span>
    <span class="n">allowRules</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># admins can do anything,</span>
        <span class="c1"># defaultDeny=False: if user does not have the admin role, we continue parsing rules</span>
        <span class="n">util</span><span class="o">.</span><span class="n">AnyEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">,</span> <span class="n">defaultDeny</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>

        <span class="n">util</span><span class="o">.</span><span class="n">StopBuildEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;owner&quot;</span><span class="p">),</span>

        <span class="c1"># *-try groups can start &quot;try&quot; builds</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ForceBuildEndpointMatcher</span><span class="p">(</span><span class="n">builder</span><span class="o">=</span><span class="s2">&quot;try&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;*-try&quot;</span><span class="p">),</span>
        <span class="c1"># *-mergers groups can start &quot;merge&quot; builds</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ForceBuildEndpointMatcher</span><span class="p">(</span><span class="n">builder</span><span class="o">=</span><span class="s2">&quot;merge&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;*-mergers&quot;</span><span class="p">),</span>
        <span class="c1"># *-releasers groups can start &quot;release&quot; builds</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ForceBuildEndpointMatcher</span><span class="p">(</span><span class="n">builder</span><span class="o">=</span><span class="s2">&quot;release&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;*-releasers&quot;</span><span class="p">),</span>
        <span class="c1"># if future Buildbot implement new control, we are safe with this last rule</span>
        <span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
        <span class="n">RolesFromGroups</span><span class="p">(</span><span class="n">groupPrefix</span><span class="o">=</span><span class="s2">&quot;buildbot-&quot;</span><span class="p">),</span>
        <span class="n">RolesFromEmails</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;homer@springfieldplant.com&quot;</span><span class="p">],</span>
                        <span class="n">reaper</span><span class="o">-</span><span class="k">try</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;007@mi6.uk&quot;</span><span class="p">]),</span>
        <span class="c1"># role owner is granted when property owner matches the email of the user</span>
        <span class="n">RolesFromOwner</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authz</span>
</pre></div>
</div>
<p>Using GitHub authentication and allowing access to control endpoints for users in the “Buildbot” organization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">authz</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
  <span class="n">allowRules</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;BuildBot&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">RolesFromGroups</span><span class="p">()</span>
  <span class="p">]</span>
<span class="p">)</span>
<span class="n">auth</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">GitHubAuth</span><span class="p">(</span><span class="s1">&#39;CLIENT_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CLIENT_SECRET&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;auth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authz</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-manual/configuration/wwwhooks"></span><div class="section" id="change-hooks">
<span id="id1"></span><h4>2.5.14. Change Hooks<a class="headerlink" href="#change-hooks" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">/change_hook</span></code> url is a magic URL which will accept HTTP requests and translate them into changes for buildbot.
Implementations (such as a trivial json-based endpoint and a GitHub implementation) can be found in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/www/hooks">master/buildbot/www/hooks</a>.
The format of the url is <code class="samp docutils literal notranslate"><span class="pre">/change_hook/</span><em><span class="pre">DIALECT</span></em></code> where DIALECT is a package within the hooks directory.
Change_hook is disabled by default and each DIALECT has to be enabled separately, for security reasons</p>
<p>An example www configuration line which enables change_hook and two DIALECTS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
                          <span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                          <span class="s1">&#39;somehook&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;option1&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                                       <span class="s1">&#39;option2&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Within the <code class="docutils literal notranslate"><span class="pre">www</span></code> config dictionary arguments, the <code class="docutils literal notranslate"><span class="pre">change_hook</span></code> key enables/disables the module and <code class="docutils literal notranslate"><span class="pre">change_hook_dialects</span></code> whitelists DIALECTs where the keys are the module names and the values are optional arguments which will be passed to the hooks.</p>
<p>The <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/post_build_request.py">master/contrib/post_build_request.py</a> script allows for the submission of an arbitrary change request.
Run <strong class="command">post_build_request.py --help</strong> for more information.
The <code class="docutils literal notranslate"><span class="pre">base</span></code> dialect must be enabled for this to work.</p>
<div class="section" id="change-hooks-auth">
<span id="id2"></span><h5>2.5.14.1. Change Hooks Auth<a class="headerlink" href="#change-hooks-auth" title="Permalink to this headline">¶</a></h5>
<p>By default change hook URL is not protected.
Some hooks implement their own authentication method.
Other requires the generic method to be secured.</p>
<p>To protect URL against unauthorized access you you may use <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> option.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method uses <code class="docutils literal notranslate"><span class="pre">HTTP</span> <span class="pre">BasicAuth</span></code>, it implies the use of SSL via <a class="reference internal" href="#reverse-proxy-config"><span class="std std-ref">Reverse Proxy Configuration</span></a> in order to be fully secured.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.cred</span> <span class="kn">import</span> <span class="n">strcred</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
      <span class="n">change_hook_auth</span><span class="o">=</span><span class="p">[</span><span class="n">strcred</span><span class="o">.</span><span class="n">makeChecker</span><span class="p">(</span><span class="s2">&quot;file:changehook.passwd&quot;</span><span class="p">)],</span>
<span class="p">)</span>
</pre></div>
</div>
<p>create a file <code class="docutils literal notranslate"><span class="pre">changehook.passwd</span></code> with content:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>user:password
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> should be a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">ICredentialsChecker</span></code>.
See the details of available options in <a class="reference external" href="https://twistedmatrix.com/documents/current/core/howto/cred.html">Twisted documentation</a>.</p>
</div>
<div class="section" id="mercurial-hook">
<span id="chsrc-Mercurial"></span><h5>2.5.14.2. Mercurial hook<a class="headerlink" href="#mercurial-hook" title="Permalink to this headline">¶</a></h5>
<p>The Mercurial hook uses the base dialect:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;base&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Once this is configured on your buildmaster add the following hook on your server-side Mercurial repository’s <code class="docutils literal notranslate"><span class="pre">hgrc</span></code>:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[hooks]</span>
<span class="na">changegroup.buildbot</span> <span class="o">=</span> <span class="s">python:/path/to/hgbuildbot.py:hook</span>
</pre></div>
</div>
<p>You’ll find <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/hgbuildbot.py">master/contrib/hgbuildbot.py</a>, and its inline documentation, in the <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/../../">buildbot-contrib</a> repository.</p>
</div>
<div class="section" id="github-hook">
<span id="chsrc-GitHub"></span><h5>2.5.14.3. GitHub hook<a class="headerlink" href="#github-hook" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is a standalone HTTP server available for receiving GitHub notifications as well: <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/github_buildbot.py">master/contrib/github_buildbot.py</a>.
This script may be useful in cases where you cannot expose the WebStatus for public consumption. Alternatively, you can setup a reverse proxy <a class="reference internal" href="#reverse-proxy-config"><span class="std std-ref">Reverse Proxy Configuration</span></a></p>
</div>
<p>The GitHub hook has the following parameters:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">secret</span></code> (default <cite>None</cite>)</dt>
<dd>Secret token to use to validate payloads.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">strict</span></code> (default <cite>False</cite>)</dt>
<dd>If the hook must be strict regarding valid payloads.
If the value is <cite>False</cite> (default), the signature will only be checked if a secret is specified and a signature was supplied with the payload.
If the value is <cite>True</cite>, a secret must be provided, and payloads without signature will be ignored.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code> (default <cite>None</cite>)</dt>
<dd>The codebase value to include with created changes.
If the value is a function (or any other callable), it will be called with the GitHub event payload as argument and the function must return the codebase value to use for the event.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">class</span></code> (default <cite>None</cite>)</dt>
<dd><p class="first">A class to be used for processing incoming payloads.
If the value is <cite>None</cite> (default), the default class – <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.www.hooks.github.GitHubEventHandler</span></code> – will be used.
The default class handles <cite>ping</cite>, <cite>push</cite> and <cite>pull_request</cite> events only.
If you’d like to handle other events (see <a class="reference external" href="https://developer.github.com/v3/activity/events/types/">Event Types &amp; Payloads</a> for more information), you’d need to subclass <code class="docutils literal notranslate"><span class="pre">GitHubEventHandler</span></code> and add handler methods for the corresponding events.
For example, if you’d like to handle <cite>blah</cite> events, your code should look something like this:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.www.hooks.github</span> <span class="k">import</span> <span class="n">GitHubEventHandler</span>

<span class="k">class</span> <span class="nc">MyBlahHandler</span><span class="p">(</span><span class="n">GitHubEventHandler</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">handle_blah</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="c1"># Do some magic here</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="s1">&#39;git&#39;</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">skips</span></code> (default <code class="docutils literal notranslate"><span class="pre">[r'\[</span> <span class="pre">*skip</span> <span class="pre">*ci</span> <span class="pre">*\]',</span> <span class="pre">r'\[</span> <span class="pre">*ci</span> <span class="pre">*skip</span> <span class="pre">*\]']</span></code>)</dt>
<dd><p class="first">A list of regex pattern makes buildbot ignore the push event.
For instance, if user push 3 commits and the commit message of branch head
contains a key string <code class="docutils literal notranslate"><span class="pre">[ci</span> <span class="pre">skip]</span></code>, buildbot will ignore this push event.</p>
<p class="last">If you want to disable the skip checking, please set it to <code class="docutils literal notranslate"><span class="pre">[]</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">github_api_endpoint</span></code> (default <code class="docutils literal notranslate"><span class="pre">https://api.github.com</span></code>)</dt>
<dd>If you have a self-host GitHub Enterprise installation, please set
this url properly.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">token</span></code></dt>
<dd>If your GitHub or GitHub Enterprise instance does not allow anonymous communication, you need to provide an access token.  Instructions can be found here &lt;<a class="reference external" href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/</a>&gt;</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pullrequest_ref</span></code> (default <code class="docutils literal notranslate"><span class="pre">merge</span></code>)</dt>
<dd>Remote ref to test if a pull request is sent to the endpoint. See the GitHub developer manual
for possible values for pull requests. (e.g. <code class="docutils literal notranslate"><span class="pre">head</span></code>)</dd>
</dl>
<p>The simplest way to use GitHub hook is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;github&#39;</span><span class="p">:</span> <span class="p">{}},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Having added this line, you should add a webhook for your GitHub project (see <a class="reference external" href="https://developer.github.com/webhooks/creating/">Creating Webhooks page at GitHub</a>).
The parameters are:</p>
<dl class="docutils">
<dt><span class="guilabel">Payload URL</span></dt>
<dd>This URL should point to <code class="docutils literal notranslate"><span class="pre">/change_hook/github</span></code> relative to the root of the web status.
For example, if the base URL is <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/buildbot</span></code>, then point GitHub to <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/buildbot/change_hook/github</span></code>.
To specify a project associated to the repository, append <code class="docutils literal notranslate"><span class="pre">?project=name</span></code> to the URL.</dd>
<dt><span class="guilabel">Content Type</span></dt>
<dd>Specify <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code> or <code class="docutils literal notranslate"><span class="pre">application/json</span></code>.</dd>
<dt><span class="guilabel">Secret</span></dt>
<dd><p class="first">Any value.
If you provide a non-empty value (recommended), make sure that your hook is configured to use it:</p>
<div class="last highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;github&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;MY-SECRET&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><span class="guilabel">Which events would you like to trigger this webhook?</span></dt>
<dd>Click – <code class="docutils literal notranslate"><span class="pre">Let</span> <span class="pre">me</span> <span class="pre">select</span> <span class="pre">individual</span> <span class="pre">events</span></code>, then select <code class="docutils literal notranslate"><span class="pre">Push</span></code> and <code class="docutils literal notranslate"><span class="pre">Pull</span> <span class="pre">request</span></code> – other kind of events are not currently supported.</dd>
</dl>
<p>And then press the <code class="docutils literal notranslate"><span class="pre">Add</span> <span class="pre">Webhook</span></code> button.</p>
<p>Github hook creates 3 kinds of changes, distinguishable by their <code class="docutils literal notranslate"><span class="pre">category</span></code> field:</p>
<ul>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">None</span></code>: This change is a push to a branch.</dt>
<dd><p class="first last">Use <code class="docutils literal notranslate"><span class="pre">util.ChangeFilter(category=None,</span> <span class="pre">repository=&quot;http://github.com/&lt;org&gt;/&lt;project&gt;&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">'tag'</span></code>: This change is a push to a tag.</dt>
<dd><p class="first last">Use <code class="docutils literal notranslate"><span class="pre">util.ChangeFilter(category='tag',</span> <span class="pre">repository=&quot;http://github.com/&lt;org&gt;/&lt;project&gt;&quot;)</span></code></p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">'pull'</span></code>: This change is from a pull-request creation or update.</dt>
<dd><p class="first last">Use <code class="docutils literal notranslate"><span class="pre">util.ChangeFilter(category='pull',</span> <span class="pre">repository=&quot;http://github.com/&lt;org&gt;/&lt;project&gt;&quot;)</span></code>
In this case, the <a class="reference internal" href="#step-GitHub" title="GitHub"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitHub</span></code></a> step must be used instead of the standard <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> in order to be able to pull GitHub’s magic refs.
With this method, the <a class="reference internal" href="#step-GitHub" title="GitHub"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitHub</span></code></a> step will always checkout the branch merged with latest master.
This allows to test the result of the merge instead of just the source branch.
Note that you can use the <a class="reference internal" href="#step-GitHub" title="GitHub"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitHub</span></code></a> for all categories of event.</p>
</dd>
</dl>
</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web server can “fake” a request from GitHub, potentially causing the buildmaster to run arbitrary code.</p>
</div>
<p>To protect URL against unauthorized access you should use <a class="reference internal" href="#change-hooks-auth"><span class="std std-ref">Change Hooks Auth</span></a> option.
Then change the the <code class="docutils literal notranslate"><span class="pre">Payload</span> <span class="pre">URL</span></code> of your GitHub webhook to <code class="docutils literal notranslate"><span class="pre">https://user:password&#64;builds.example.com/bbot/change_hook/github</span></code>.</p>
</div>
<div class="section" id="bitbucket-hook">
<span id="chsrc-BitBucket"></span><h5>2.5.14.4. BitBucket hook<a class="headerlink" href="#bitbucket-hook" title="Permalink to this headline">¶</a></h5>
<p>The BitBucket hook is as simple as GitHub one and it takes no options.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bitbucket&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this is setup you should add a <cite>POST</cite> service pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/bitbucket</span></code> relative to the root of the web status.
For example, it the grid URL is <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/bbot/grid</span></code>, then point BitBucket to <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/change_hook/bitbucket</span></code>.
To specify a project associated to the repository, append <code class="docutils literal notranslate"><span class="pre">?project=name</span></code> to the URL.</p>
<p>Note that there is a standalone HTTP server available for receiving BitBucket notifications, as well: <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/bitbucket_buildbot.py">master/contrib/bitbucket_buildbot.py</a>.
This script may be useful in cases where you cannot expose the WebStatus for public consumption.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As in the previous case, the incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web status can “fake” a request from BitBucket, potentially causing the buildmaster to run arbitrary code.</p>
</div>
<p>To protect URL against unauthorized access you should use <a class="reference internal" href="#change-hooks-auth"><span class="std std-ref">Change Hooks Auth</span></a> option.
Then, create a BitBucket service hook (see <a class="reference external" href="https://confluence.atlassian.com/display/BITBUCKET/POST+Service+Management">https://confluence.atlassian.com/display/BITBUCKET/POST+Service+Management</a>) with a WebHook URL like <code class="docutils literal notranslate"><span class="pre">https://user:password&#64;builds.example.com/bbot/change_hook/bitbucket</span></code>.</p>
<p>Note that as before, not using <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> can expose you to security risks.</p>
</div>
<div class="section" id="bitbucket-cloud-hook">
<h5>2.5.14.5. Bitbucket Cloud hook<a class="headerlink" href="#bitbucket-cloud-hook" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bitbucketcloud&#39;</span><span class="p">:</span> <span class="p">{}},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this is setup you should add a webhook pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/bitbucketcloud</span></code> relative to the root of the web status.</p>
<p>According to the type of the event, the change category is set to <code class="docutils literal notranslate"><span class="pre">push</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-created</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-rejected</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-updated</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-fulfilled</span></code> or <code class="docutils literal notranslate"><span class="pre">ref-deleted</span></code>.</p>
<p>The Bitbucket Cloud hook may have the following optional parameters:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code> (default <cite>None</cite>)</dt>
<dd>The codebase value to include with changes or a callable object that will be passed the payload in order to get it.</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web server can “fake” a request from Bitbucket Cloud, potentially causing the buildmaster to run arbitrary code</p>
</div>
</div>
<div class="section" id="bitbucket-server-hook">
<h5>2.5.14.6. Bitbucket Server hook<a class="headerlink" href="#bitbucket-server-hook" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bitbucketserver&#39;</span><span class="p">:</span> <span class="p">{}},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this is setup you should add a webhook pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/bitbucketserver</span></code> relative to the root of the web status.</p>
<p>According to the type of the event, the change category is set to <code class="docutils literal notranslate"><span class="pre">push</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-created</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-rejected</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-updated</span></code>, <code class="docutils literal notranslate"><span class="pre">pull-fulfilled</span></code> or <code class="docutils literal notranslate"><span class="pre">ref-deleted</span></code>.</p>
<p>The Bitbucket Server hook may have the following optional parameters:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">codebase</span></code> (default <cite>None</cite>)</dt>
<dd>The codebase value to include with changes or a callable object that will be passed the payload in order to get it.</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web server can “fake” a request from Bitbucket Server, potentially causing the buildmaster to run arbitrary code</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This hook requires the <cite>bitbucket-webhooks</cite> plugin (see <a class="reference external" href="https://marketplace.atlassian.com/plugins/nl.topicus.bitbucket.bitbucket-webhooks/server/overview">https://marketplace.atlassian.com/plugins/nl.topicus.bitbucket.bitbucket-webhooks/server/overview</a>).</p>
</div>
</div>
<div class="section" id="poller-hook">
<h5>2.5.14.7. Poller hook<a class="headerlink" href="#poller-hook" title="Permalink to this headline">¶</a></h5>
<p>The poller hook allows you to use GET or POST requests to trigger polling.
One advantage of this is your buildbot instance can poll at launch (using the pollAtLaunch flag) to get changes that happened while it was down, but then you can still use a commit hook to get fast notification of new changes.</p>
<p>Suppose you have a poller configured like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/amanda&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">split_file_branches</span><span class="p">,</span>
    <span class="n">pollInterval</span><span class="o">=</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">pollAtLaunch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>And you configure your WebStatus to enable this hook:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;poller&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Then you will be able to trigger a poll of the SVN repository by poking the <code class="docutils literal notranslate"><span class="pre">/change_hook/poller</span></code> URL from a commit hook like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl -s -F <span class="nv">poller</span><span class="o">=</span>https://amanda.svn.sourceforge.net/svnroot/amanda/amanda <span class="se">\</span>
    http://yourbuildbot/change_hook/poller
</pre></div>
</div>
<p>If no <code class="docutils literal notranslate"><span class="pre">poller</span></code> argument is provided then the hook will trigger polling of all polling change sources.</p>
<p>You can restrict which pollers the webhook has access to using the <code class="docutils literal notranslate"><span class="pre">allowed</span></code> option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;poller&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;https://amanda.svn.sourceforge.net/svnroot/amanda/amanda&#39;</span><span class="p">]}}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="gitlab-hook">
<span id="chsrc-GitLab"></span><h5>2.5.14.8. GitLab hook<a class="headerlink" href="#gitlab-hook" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;gitlab&#39;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;secret&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The GitLab hook has the following parameters:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">secret</span></code> (default <cite>None</cite>)</dt>
<dd>Secret token to use to validate payloads.</dd>
</dl>
<p>When this is setup you should add a <cite>POST</cite> service pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/gitlab</span></code> relative to the root of the web status.
For example, it the grid URL is <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/bbot/grid</span></code>, then point GitLab to <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/change_hook/gitlab</span></code>.
The project and/or codebase can also be passed in the URL by appending <code class="docutils literal notranslate"><span class="pre">?project=name</span></code> or <code class="docutils literal notranslate"><span class="pre">?codebase=foo</span></code> to the URL.
These parameters will be passed along to the scheduler.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To handle merge requests from forks properly, it’s easiest to use a GitLab source step rather than a Git source step.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Your Git or GitLab step must be configured with a git&#64; repourl, not a https: one, else the change from the webhook will not trigger a build.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As in the previous case, the incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web status can “fake” a request from your GitLab server, potentially causing the buildmaster to run arbitrary code.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When applicable, you need to permit access to internal/local networks.
See <code class="docutils literal notranslate"><span class="pre">https://docs.gitlab.com/ee/security/webhooks.html</span></code> for details.</p>
</div>
<p>To protect URL against unauthorized access you should either</p>
<blockquote>
<div><ul class="simple">
<li>set secret token in the configuration above, then set it in the GitLab service hook declaration, or</li>
<li>use the <a class="reference internal" href="#change-hooks-auth"><span class="std std-ref">Change Hooks Auth</span></a> option. Then, create a GitLab service hook (see <code class="docutils literal notranslate"><span class="pre">https://your.gitlab.server/help/web_hooks</span></code>) with a WebHook URL like <code class="docutils literal notranslate"><span class="pre">https://user:password&#64;builds.example.com/bbot/change_hook/gitlab</span></code>.</li>
</ul>
</div></blockquote>
<p>Note that as before, not using <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> can expose you to security risks.</p>
</div>
<div class="section" id="gitorious-hook">
<span id="chsrc-Gitorious"></span><h5>2.5.14.9. Gitorious Hook<a class="headerlink" href="#gitorious-hook" title="Permalink to this headline">¶</a></h5>
<p>The Gitorious hook is as simple as GitHub one and it also takes no options.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;gitorious&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>When this is setup you should add a <cite>POST</cite> service pointing to <code class="docutils literal notranslate"><span class="pre">/change_hook/gitorious</span></code> relative to the root of the web status.
For example, it the grid URL is <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/bbot/grid</span></code>, then point Gitorious to <code class="docutils literal notranslate"><span class="pre">http://builds.example.com/change_hook/gitorious</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As in the previous case, the incoming HTTP requests for this hook are not authenticated by default.
Anyone who can access the web status can “fake” a request from your Gitorious server, potentially causing the buildmaster to run arbitrary code.</p>
</div>
<p>To protect URL against unauthorized access you should use <a class="reference internal" href="#change-hooks-auth"><span class="std std-ref">Change Hooks Auth</span></a> option.
Then, create a Gitorious web hook with a WebHook URL like <code class="docutils literal notranslate"><span class="pre">https://user:password&#64;builds.example.com/bbot/change_hook/gitorious</span></code>.</p>
<p>Note that as before, not using <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> can expose you to security risks.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Web hooks are only available for local Gitorious installations, since this feature is not offered as part of Gitorious.org yet.</p>
</div>
</div>
<div class="section" id="custom-hooks">
<h5>2.5.14.10. Custom Hooks<a class="headerlink" href="#custom-hooks" title="Permalink to this headline">¶</a></h5>
<p>Custom hooks are supported via the <a class="reference internal" href="#plugins"><span class="std std-ref">Plugin Infrastructure in Buildbot</span></a> mechanism.
You can subclass any of the available hook handler class available in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.www.hooks</span></code> and register it in the plugin system, via a custom python module.
For convenience, you ca also use the generic option <code class="docutils literal notranslate"><span class="pre">custom_class</span></code> e.g:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">webhooks</span>
<span class="k">class</span> <span class="nc">CustomBase</span><span class="p">(</span><span class="n">webhooks</span><span class="o">.</span><span class="n">base</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getChanges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span>
        <span class="n">chdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                      <span class="n">revision</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;revision&#39;</span><span class="p">),</span>
                      <span class="n">repository</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;repository&#39;</span><span class="p">),</span>
                      <span class="n">project</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;project&#39;</span><span class="p">),</span>
                      <span class="n">codebase</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;codebase&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">([</span><span class="n">chdict</span><span class="p">],</span> <span class="bp">None</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;base&#39;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;custom_class&#39;</span><span class="p">:</span> <span class="n">CustomBase</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<span id="document-manual/configuration/services"></span><div class="section" id="custom-services">
<span id="cfg-services"></span><h4>2.5.15. Custom Services<a class="headerlink" href="#custom-services" title="Permalink to this headline">¶</a></h4>
<p>For advanced users or plugins writers, the ‘services’ key is available, and holds a list of <a class="reference internal" href="#buildbot.util.service.BuildbotService" title="buildbot.util.service.BuildbotService"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.service.BuildbotService</span></code></a>.
As this feature for advanced users, it is described in the developer section of the manual.</p>
<p>This section will grow as soon as ready-to-use services are created.</p>
</div>
<span id="document-manual/configuration/dbconfig"></span><div class="section" id="dbconfig">
<span id="cfg-dbconfig"></span><h4>2.5.16. DbConfig<a class="headerlink" href="#dbconfig" title="Permalink to this headline">¶</a></h4>
<p>DbConfig is an utility for <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code> to get easy to use key/value storage in the Buildbot database</p>
<p>DbConfig can get and store any <code class="docutils literal notranslate"><span class="pre">json</span></code>-able object to the db for use by other masters or separate UI plugins to edit them.</p>
<p>The design is voluntary simplistic, the focus is on the easy use rather than efficiency.
A separate db connection is created each time <code class="docutils literal notranslate"><span class="pre">get()</span></code> or <code class="docutils literal notranslate"><span class="pre">set()</span></code> is called.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">worker</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">BuildmasterConfig</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mysql://username:password@mysqlserver/buildbot&#39;</span>
<span class="n">dbConfig</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">DbConfig</span><span class="p">(</span><span class="n">BuildmasterConfig</span><span class="p">,</span> <span class="n">basedir</span><span class="p">)</span>
<span class="n">workers</span> <span class="o">=</span> <span class="n">dbConfig</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;workers&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">Worker</span><span class="p">(</span><span class="n">worker</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">worker</span><span class="p">[</span><span class="s1">&#39;passwd&#39;</span><span class="p">],</span>
                  <span class="n">properties</span><span class="o">=</span><span class="n">worker</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;properties&#39;</span><span class="p">)),</span>
    <span class="k">for</span> <span class="n">worker</span> <span class="ow">in</span> <span class="n">workers</span>
<span class="p">]</span>
</pre></div>
</div>
<dl class="class">
<dt id="DbConfig">
<em class="property">class </em><code class="descname">DbConfig</code><a class="headerlink" href="#DbConfig" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="DbConfig.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>BuildmasterConfig</em>, <em>basedir</em><span class="sig-paren">)</span><a class="headerlink" href="#DbConfig.__init__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>BuildmasterConfig</strong> – the <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code>, where <code class="docutils literal notranslate"><span class="pre">db_url</span></code> is already configured</li>
<li><strong>basedir</strong> – <code class="docutils literal notranslate"><span class="pre">basedir</span></code> global variable of the <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code> run environment. SQLite urls are relative to this dir</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="DbConfig.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>name</em>, <em>default=MarkerClass</em><span class="sig-paren">)</span><a class="headerlink" href="#DbConfig.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – the name of the config variable to retrieve</li>
<li><strong>default</strong> – in case the config variable has not been set yet, default is returned if defined, else <code class="docutils literal notranslate"><span class="pre">KeyError</span></code> is raised</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="DbConfig.set">
<code class="descname">set</code><span class="sig-paren">(</span><em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#DbConfig.set" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – the name of the config variable to be set</li>
<li><strong>value</strong> – the value of the config variable to be set</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<span id="document-manual/configuration/configurators"></span><div class="section" id="configurators">
<span id="cfg-configurators"></span><h4>2.5.17. Configurators<a class="headerlink" href="#configurators" title="Permalink to this headline">¶</a></h4>
<p>For advanced users or plugins writers, the <code class="docutils literal notranslate"><span class="pre">configurators</span></code> key is available, and holds a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.IConfigurator</span></code>.
Configurators will run after the <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code> has been processed, and will modify the config dictionary.
Configurator implementers should make sure that they are interoperable with each other, which means carefully modifying the config to avoid overriding a setting already made by the user or by another configurator.
Configurators are run (thus prioritized) in the order of the <code class="docutils literal notranslate"><span class="pre">configurators</span></code> list.</p>
<div class="section" id="janitorconfigurator">
<span id="configurator-JanitorConfigurator"></span><h5>2.5.17.1. JanitorConfigurator<a class="headerlink" href="#janitorconfigurator" title="Permalink to this headline">¶</a></h5>
<p>Buildbot stores historical information in its database.
In a large installation, these can quickly consume disk space, yet in many cases developers never consult this historical information.</p>
<p><a class="reference internal" href="#configurator-JanitorConfigurator" title="JanitorConfigurator"><code class="xref bb bb-configurator docutils literal notranslate"><span class="pre">JanitorConfigurator</span></code></a> creates a builder and <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> scheduler which will regularly remove old information.
At the moment it only supports cleaning of logs, but it will contain more features as we implement them.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">timedelta</span>

<span class="c1"># configure a janitor which will delete all logs older than one month,</span>
<span class="c1"># and will run on sundays at noon</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;configurators&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">JanitorConfigurator</span><span class="p">(</span>
    <span class="n">logHorizon</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">hour</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">dayOfWeek</span><span class="o">=</span><span class="mi">6</span>
<span class="p">)]</span>
</pre></div>
</div>
<p>Parameters for <a class="reference internal" href="#configurator-JanitorConfigurator" title="JanitorConfigurator"><code class="xref bb bb-configurator docutils literal notranslate"><span class="pre">JanitorConfigurator</span></code></a> are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">logHorizon</span></code></dt>
<dd>a <code class="docutils literal notranslate"><span class="pre">timedelta</span></code> object describing the minimum time for which the log data should be maintained</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hour</span></code>, <code class="docutils literal notranslate"><span class="pre">dayOfWeek</span></code>, …</dt>
<dd>Arguments given to the <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> scheduler which is backing the <a class="reference internal" href="#configurator-JanitorConfigurator" title="JanitorConfigurator"><code class="xref bb bb-configurator docutils literal notranslate"><span class="pre">JanitorConfigurator</span></code></a>.
Determines when the cleanup will be done.
With this, you can configure it daily, weekly or even hourly if you wish.
You probably want to schedule it when Buildbot is less loaded.</dd>
</dl>
</div>
</div>
</div>
</div>
<span id="document-manual/customization"></span><div class="section" id="customization">
<h3>2.6. Customization<a class="headerlink" href="#customization" title="Permalink to this headline">¶</a></h3>
<p>For advanced users, Buildbot acts as a framework supporting a customized build application.
For the most part, such configurations consist of subclasses set up for use in a regular Buildbot configuration file.</p>
<p>This chapter describes some of the more common idioms in advanced Buildbot configurations.</p>
<p>At the moment, this chapter is an unordered set of suggestions:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#programmatic-configuration-generation" id="id13">Programmatic Configuration Generation</a></li>
<li><a class="reference internal" href="#collapse-request-functions" id="id14">Collapse Request Functions</a></li>
<li><a class="reference internal" href="#builder-priority-functions" id="id15">Builder Priority Functions</a></li>
<li><a class="reference internal" href="#build-priority-functions" id="id16">Build Priority Functions</a></li>
<li><a class="reference internal" href="#canstartbuild-functions" id="id17"><code class="docutils literal notranslate"><span class="pre">canStartBuild</span></code> Functions</a></li>
<li><a class="reference internal" href="#customizing-svnpoller" id="id18">Customizing SVNPoller</a><ul>
<li><a class="reference internal" href="#project-branchname-filepath-repositories" id="id19"><code class="samp docutils literal notranslate"><em><span class="pre">PROJECT</span></em><span class="pre">/</span><em><span class="pre">BRANCHNAME</span></em><span class="pre">/</span><em><span class="pre">FILEPATH</span></em></code> repositories</a></li>
<li><a class="reference internal" href="#branchname-project-filepath-repositories" id="id20"><code class="samp docutils literal notranslate"><em><span class="pre">BRANCHNAME</span></em><span class="pre">/</span><em><span class="pre">PROJECT</span></em><span class="pre">/</span><em><span class="pre">FILEPATH</span></em></code> repositories</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-change-sources" id="id21">Writing Change Sources</a><ul>
<li><a class="reference internal" href="#writing-a-notification-based-change-source" id="id22">Writing a Notification-based Change Source</a></li>
<li><a class="reference internal" href="#writing-a-change-poller" id="id23">Writing a Change Poller</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-a-new-latent-worker-implementation" id="id24">Writing a New Latent Worker Implementation</a><ul>
<li><a class="reference internal" href="#abstractlatentcontroller" id="id25">AbstractLatentController</a></li>
</ul>
</li>
<li><a class="reference internal" href="#custom-build-classes" id="id26">Custom Build Classes</a></li>
<li><a class="reference internal" href="#factory-workdir-functions" id="id27">Factory Workdir Functions</a></li>
<li><a class="reference internal" href="#writing-new-buildsteps" id="id28">Writing New BuildSteps</a><ul>
<li><a class="reference internal" href="#writing-buildstep-constructors" id="id29">Writing BuildStep Constructors</a></li>
<li><a class="reference internal" href="#step-execution-process" id="id30">Step Execution Process</a></li>
<li><a class="reference internal" href="#running-commands" id="id31">Running Commands</a></li>
<li><a class="reference internal" href="#updating-status-strings" id="id32">Updating Status Strings</a></li>
<li><a class="reference internal" href="#about-logfiles" id="id33">About Logfiles</a></li>
<li><a class="reference internal" href="#writing-log-files" id="id34">Writing Log Files</a></li>
<li><a class="reference internal" href="#reading-logfiles" id="id35">Reading Logfiles</a></li>
<li><a class="reference internal" href="#adding-logobservers" id="id36">Adding LogObservers</a></li>
<li><a class="reference internal" href="#using-properties" id="id37">Using Properties</a></li>
<li><a class="reference internal" href="#using-statistics" id="id38">Using Statistics</a></li>
<li><a class="reference internal" href="#buildstep-urls" id="id39">BuildStep URLs</a></li>
<li><a class="reference internal" href="#discovering-files" id="id40">Discovering files</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-dashboards-with-flask-or-bottle" id="id41">Writing Dashboards with Flask or Bottle</a></li>
<li><a class="reference internal" href="#a-somewhat-whimsical-example-or-it-s-now-customized-how-do-i-deploy-it" id="id42">A Somewhat Whimsical Example (or “It’s now customized, how do I deploy it?”)</a><ul>
<li><a class="reference internal" href="#inclusion-in-the-master-cfg-file" id="id43">Inclusion in the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file</a></li>
<li><a class="reference internal" href="#python-file-somewhere-on-the-system" id="id44">Python file somewhere on the system</a></li>
<li><a class="reference internal" href="#install-this-code-into-a-standard-python-library-directory" id="id45">Install this code into a standard Python library directory</a></li>
<li><a class="reference internal" href="#distribute-a-buildbot-plug-in" id="id46">Distribute a Buildbot Plug-In</a></li>
<li><a class="reference internal" href="#submit-the-code-for-inclusion-in-the-buildbot-distribution" id="id47">Submit the code for inclusion in the Buildbot distribution</a></li>
<li><a class="reference internal" href="#summary" id="id48">Summary</a></li>
</ul>
</li>
</ul>
</div>
<p>If you’d like to clean it up, fork the project on GitHub and get started!</p>
<div class="section" id="programmatic-configuration-generation">
<h4><a class="toc-backref" href="#id13">2.6.1. Programmatic Configuration Generation</a><a class="headerlink" href="#programmatic-configuration-generation" title="Permalink to this headline">¶</a></h4>
<p>Bearing in mind that <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code> is a Python file, large configurations can be shortened considerably by judicious use of Python loops.
For example, the following will generate a builder for each of a range of supported versions of Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pythons</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;python2.4&#39;</span><span class="p">,</span> <span class="s1">&#39;python2.5&#39;</span><span class="p">,</span> <span class="s1">&#39;python2.6&#39;</span><span class="p">,</span> <span class="s1">&#39;python2.7&#39;</span><span class="p">,</span>
           <span class="s1">&#39;python3.2&#39;</span><span class="p">,</span> <span class="s1">&#39;python3.3&#39;</span><span class="p">]</span>
<span class="n">pytest_workers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;worker</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
<span class="k">for</span> <span class="n">python</span> <span class="ow">in</span> <span class="n">pythons</span><span class="p">:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
    <span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="n">python</span><span class="p">,</span> <span class="s1">&#39;test.py&#39;</span><span class="p">]))</span>
    <span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">BuilderConfig</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;test-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">python</span><span class="p">,</span>
            <span class="n">factory</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
            <span class="n">workernames</span><span class="o">=</span><span class="n">pytest_workers</span><span class="p">))</span>
</pre></div>
</div>
<p>Next step would be the loading of <code class="docutils literal notranslate"><span class="pre">pythons</span></code> list from a .yaml/.ini file.</p>
</div>
<div class="section" id="collapse-request-functions">
<span id="id1"></span><h4><a class="toc-backref" href="#id14">2.6.2. Collapse Request Functions</a><a class="headerlink" href="#collapse-request-functions" title="Permalink to this headline">¶</a></h4>
<p id="index-0">The logic Buildbot uses to decide which build request can be merged can be customized by providing a Python function (a callable) instead of <code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code> described in <a class="reference internal" href="#collapsing-build-requests"><span class="std std-ref">Collapsing Build Requests</span></a>.</p>
<p>Arguments for the callable are:</p>
<blockquote>
<div><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">master</span></code></dt>
<dd>pointer to the master object, which can be used to make additional data api calls via <cite>master.data.get</cite></dd>
<dt><code class="docutils literal notranslate"><span class="pre">builder</span></code></dt>
<dd>dictionary of type <a class="reference internal" href="#rtype-builder" title="builder"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">builder</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req1</span></code></dt>
<dd>dictionary of type <a class="reference internal" href="#rtype-buildrequest" title="buildrequest"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildrequest</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">req2</span></code></dt>
<dd>dictionary of type <a class="reference internal" href="#rtype-buildrequest" title="buildrequest"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildrequest</span></code></a></dd>
</dl>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The number of invocations of the callable is proportional to the square of the request queue length, so a long-running callable may cause undesirable delays when the queue length grows.</p>
</div>
<p>It should return true if the requests can be merged, and False otherwise.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">collapseRequests</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">):</span>
    <span class="s2">&quot;any requests with the same branch can be merged&quot;</span>

    <span class="c1"># get the buildsets for each buildrequest</span>
    <span class="n">selfBuildset</span> <span class="p">,</span> <span class="n">otherBuildset</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">defer</span><span class="o">.</span><span class="n">gatherResults</span><span class="p">([</span>
        <span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;buildsets&#39;</span><span class="p">,</span> <span class="n">req1</span><span class="p">[</span><span class="s1">&#39;buildsetid&#39;</span><span class="p">])),</span>
        <span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;buildsets&#39;</span><span class="p">,</span> <span class="n">req2</span><span class="p">[</span><span class="s1">&#39;buildsetid&#39;</span><span class="p">]))</span>
        <span class="p">])</span>
    <span class="n">selfSourcestamps</span> <span class="o">=</span> <span class="n">selfBuildset</span><span class="p">[</span><span class="s1">&#39;sourcestamps&#39;</span><span class="p">]</span>
    <span class="n">otherSourcestamps</span> <span class="o">=</span> <span class="n">otherBuildset</span><span class="p">[</span><span class="s1">&#39;sourcestamps&#39;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selfSourcestamps</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">otherSourcestamps</span><span class="p">):</span>
        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">selfSourcestamp</span><span class="p">,</span> <span class="n">otherSourcestamp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">selfSourcestamps</span><span class="p">,</span> <span class="n">otherSourcestamps</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">selfSourcestamp</span><span class="p">[</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">otherSourcestamp</span><span class="p">[</span><span class="s1">&#39;branch&#39;</span><span class="p">]:</span>
            <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;collapseRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapseRequests</span>
</pre></div>
</div>
<p>In many cases, the details of the <a class="reference internal" href="#rtype-sourcestamp" title="sourcestamp"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">sourcestamp</span></code></a> and <a class="reference internal" href="#rtype-buildrequest" title="buildrequest"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildrequest</span></code></a> are important.</p>
<p>In the following example, only <a class="reference internal" href="#rtype-buildrequest" title="buildrequest"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildrequest</span></code></a> with the same “reason” are merged; thus developers forcing builds for different reasons will see distinct builds.</p>
<p>Note the use of the <code class="xref py py-meth docutils literal notranslate"><span class="pre">buildrequest.BuildRequest.canBeCollapsed</span></code> method to access the source stamp compatibility algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">collapseRequests</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">):</span>
    <span class="n">canBeCollapsed</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">buildrequest</span><span class="o">.</span><span class="n">BuildRequest</span><span class="o">.</span><span class="n">canBeCollapsed</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">canBeCollapsed</span> <span class="ow">and</span> <span class="n">req1</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">req2</span><span class="o">.</span><span class="n">reason</span><span class="p">:</span>
       <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;collapseRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapseRequests</span>
</pre></div>
</div>
<p>Another common example is to prevent collapsing of requests coming from a <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> step.
<a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> step can indeed be used in order to implement parallel testing of the same source.</p>
<p>Buildrequests will all have the same sourcestamp, but probably different properties, and shall not be collapsed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In most of the cases, just setting collapseRequests=False for triggered builders will do the trick.</p>
</div>
<p>In other cases, <code class="docutils literal notranslate"><span class="pre">parent_buildid</span></code> from buildset can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">collapseRequests</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">):</span>
    <span class="n">canBeCollapsed</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">buildrequest</span><span class="o">.</span><span class="n">BuildRequest</span><span class="o">.</span><span class="n">canBeCollapsed</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">)</span>
    <span class="n">selfBuildset</span> <span class="p">,</span> <span class="n">otherBuildset</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">defer</span><span class="o">.</span><span class="n">gatherResults</span><span class="p">([</span>
        <span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;buildsets&#39;</span><span class="p">,</span> <span class="n">req1</span><span class="p">[</span><span class="s1">&#39;buildsetid&#39;</span><span class="p">])),</span>
        <span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;buildsets&#39;</span><span class="p">,</span> <span class="n">req2</span><span class="p">[</span><span class="s1">&#39;buildsetid&#39;</span><span class="p">]))</span>
    <span class="p">])</span>
    <span class="k">if</span> <span class="n">canBeCollapsed</span> <span class="ow">and</span> <span class="n">selfBuildset</span><span class="p">[</span><span class="s1">&#39;parent_buildid&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">otherBuildset</span><span class="p">[</span><span class="s1">&#39;parent_buildid&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
       <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;collapseRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapseRequests</span>
</pre></div>
</div>
<p>If it’s necessary to perform some extended operation to determine whether two requests can be merged, then the <code class="docutils literal notranslate"><span class="pre">collapseRequests</span></code> callable may return its result via Deferred.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Again, the number of invocations of the callable is proportional to the square of the request queue length, so a long-running callable may cause undesirable delays when the queue length grows.</p>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">collapseRequests</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">builder</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">):</span>
    <span class="n">info1</span><span class="p">,</span> <span class="n">info2</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">defer</span><span class="o">.</span><span class="n">gatherResults</span><span class="p">([</span>
        <span class="n">getMergeInfo</span><span class="p">(</span><span class="n">req1</span><span class="p">),</span>
        <span class="n">getMergeInfo</span><span class="p">(</span><span class="n">req2</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">info1</span> <span class="o">==</span> <span class="n">info2</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;collapseRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collapseRequests</span>
</pre></div>
</div>
</div>
<div class="section" id="builder-priority-functions">
<span id="id2"></span><h4><a class="toc-backref" href="#id15">2.6.3. Builder Priority Functions</a><a class="headerlink" href="#builder-priority-functions" title="Permalink to this headline">¶</a></h4>
<p id="index-1">The <a class="reference internal" href="#cfg-prioritizeBuilders" title="prioritizeBuilders"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">prioritizeBuilders</span></code></a> configuration key specifies a function which is called with two arguments: a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code> and a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> objects.
It should return a list of the same <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code> objects, in the desired order.
It may also remove items from the list if builds should not be started on those builders.
If necessary, this function can return its results via a Deferred (it is called with <code class="docutils literal notranslate"><span class="pre">maybeDeferred</span></code>).</p>
<p>A simple <code class="docutils literal notranslate"><span class="pre">prioritizeBuilders</span></code> implementation might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prioritizeBuilders</span><span class="p">(</span><span class="n">buildmaster</span><span class="p">,</span> <span class="n">builders</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prioritize builders.  &#39;finalRelease&#39; builds have the highest</span>
<span class="sd">    priority, so they should be built before running tests, or</span>
<span class="sd">    creating builds.&quot;&quot;&quot;</span>
    <span class="n">builderPriorities</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;finalRelease&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;build&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">builders</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">builderPriorities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">builders</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;prioritizeBuilders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prioritizeBuilders</span>
</pre></div>
</div>
<p>If the change frequency is higher than the turn-around of the builders,
the following approach might be helpful:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">prioritizeBuilders</span><span class="p">(</span><span class="n">buildmaster</span><span class="p">,</span> <span class="n">builders</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prioritize builders. First, prioritize inactive builders.</span>
<span class="sd">    Second, consider the last time a job was completed (no job is infinite past).</span>
<span class="sd">    Third, consider the time the oldest request has been queued.</span>
<span class="sd">    This provides a simple round-robin scheme that works with collapsed builds.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">isBuilding</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">building</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">bool</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">old_building</span><span class="p">)</span>

    <span class="n">builders</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">isBuilding</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">getNewestCompleteTime</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">getOldestRequestTime</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">builders</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;prioritizeBuilders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prioritizeBuilders</span>
</pre></div>
</div>
</div>
<div class="section" id="build-priority-functions">
<span id="index-2"></span><span id="id3"></span><h4><a class="toc-backref" href="#id16">2.6.4. Build Priority Functions</a><a class="headerlink" href="#build-priority-functions" title="Permalink to this headline">¶</a></h4>
<p>When a builder has multiple pending build requests, it uses a <code class="docutils literal notranslate"><span class="pre">nextBuild</span></code> function to decide which build it should start first.
This function is given two parameters: the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>, and a list of <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> objects representing pending build requests.</p>
<p>A simple function to prioritize release builds over other builds might look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">nextBuild</span><span class="p">(</span><span class="n">bldr</span><span class="p">,</span> <span class="n">requests</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">branch</span> <span class="o">==</span> <span class="s1">&#39;release&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">requests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>If some non-immediate result must be calculated, the <code class="docutils literal notranslate"><span class="pre">nextBuild</span></code> function can also return a Deferred:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">nextBuild</span><span class="p">(</span><span class="n">bldr</span><span class="p">,</span> <span class="n">requests</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">get_request_priorities</span><span class="p">(</span><span class="n">requests</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pick</span><span class="p">(</span><span class="n">priorities</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">requests</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">priorities</span><span class="p">,</span> <span class="n">requests</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">pick</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">nextBuild</span></code> function is passed as parameter to <code class="xref py py-class docutils literal notranslate"><span class="pre">BuilderConfig</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span> <span class="n">BuilderConfig</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">nextBuild</span><span class="o">=</span><span class="n">nextBuild</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="canstartbuild-functions">
<span id="id4"></span><h4><a class="toc-backref" href="#id17">2.6.5. <code class="docutils literal notranslate"><span class="pre">canStartBuild</span></code> Functions</a><a class="headerlink" href="#canstartbuild-functions" title="Permalink to this headline">¶</a></h4>
<p>Sometimes, you cannot know in advance what workers to assign to a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuilderConfig</span></code>.
For example, you might need to check for the existence of a file on a worker before running a build on it.
It is possible to do that by setting the <code class="docutils literal notranslate"><span class="pre">canStartBuild</span></code> callback.</p>
<p>Here is an example that checks if there is a <code class="docutils literal notranslate"><span class="pre">vm</span></code> property set for the build request.
If it is set, it checks if a file named after it exists in the <code class="docutils literal notranslate"><span class="pre">/opt/vm</span></code> folder.
If the file does not exist on the given worker, refuse to run the build to force the master to select another worker.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">canStartBuild</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">wfb</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>

    <span class="n">vm</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vm&#39;</span><span class="p">,</span> <span class="n">builder</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vm&#39;</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">vm</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;/opt/vm&#39;</span><span class="p">,</span> <span class="n">vm</span><span class="p">)}</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">RemoteCommand</span><span class="p">(</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">stdioLogName</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">cmd</span><span class="o">.</span><span class="n">worker</span> <span class="o">=</span> <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span>
        <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">cmd</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">builder</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Here is a more complete example that checks if a worker is fit to start a build.
If the load average is higher than the number of CPU cores or if there is less than 2GB of free memory, refuse to run the build on that worker.
Also, put that worker in quarantine to make sure no other builds are scheduled on it for a while.
Otherwise, let the build start on that worker.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FakeBuild</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="n">Properties</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">FakeStep</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">build</span> <span class="o">=</span> <span class="n">FakeBuild</span><span class="p">()</span>

<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">shell</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">builder</span><span class="p">):</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="n">command</span><span class="p">,</span>
        <span class="s1">&#39;logEnviron&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s1">&#39;workdir&#39;</span><span class="p">:</span> <span class="n">worker</span><span class="o">.</span><span class="n">worker_basedir</span><span class="p">,</span>
        <span class="s1">&#39;want_stdout&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="s1">&#39;want_stderr&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">RemoteCommand</span><span class="p">(</span><span class="s1">&#39;shell&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">stdioLogName</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">worker</span> <span class="o">=</span> <span class="n">worker</span>
    <span class="k">yield</span> <span class="n">cmd</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">FakeStep</span><span class="p">(),</span> <span class="n">worker</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">builder</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">rc</span><span class="p">)</span>

<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">canStartBuild</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">wfb</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="c1"># check that load is not too high</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">shell</span><span class="p">(</span>
        <span class="s1">&#39;test &quot;$(cut -d. -f1 /proc/loadavg)&quot; -le &quot;$(nproc)&quot;&#39;</span><span class="p">,</span>
        <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="p">,</span> <span class="n">builder</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;loadavg is too high to take new builds&#39;</span><span class="p">,</span>
                <span class="n">system</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="p">))</span>
        <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">putInQuarantine</span><span class="p">()</span>
        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="c1"># check there is enough free memory</span>
    <span class="n">sed_expr</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;s/^MemAvailable:[[:space:]]+([0-9]+)[[:space:]]+kB$/\1/p&#39;</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">shell</span><span class="p">(</span>
        <span class="s1">&#39;test &quot;$(sed -nre </span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1"> /proc/meminfo)&quot; -gt 2000000&#39;</span> <span class="o">%</span> <span class="n">sed_expr</span><span class="p">,</span>
        <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="p">,</span> <span class="n">builder</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="s1">&#39;not enough free memory to take new builds&#39;</span><span class="p">,</span>
                <span class="n">system</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="p">))</span>
        <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">putInQuarantine</span><span class="p">()</span>
        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

    <span class="c1"># The build may now proceed.</span>
    <span class="c1">#</span>
    <span class="c1"># Prevent this worker from taking any other build while this one is</span>
    <span class="c1"># starting for 2 min. This leaves time for the build to start consuming</span>
    <span class="c1"># resources (disk, memory, cpu). When the quarantine is over, if the</span>
    <span class="c1"># same worker is subject to start another build, the above checks will</span>
    <span class="c1"># better reflect the actual state of the worker.</span>
    <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">quarantine_timeout</span> <span class="o">=</span> <span class="mi">120</span>
    <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">putInQuarantine</span><span class="p">()</span>

    <span class="c1"># This does not take the worker out of quarantine, it only resets the</span>
    <span class="c1"># timeout value to default.</span>
    <span class="n">wfb</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">resetQuarantine</span><span class="p">()</span>

    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>You can extend these examples using any remote command described in the <a class="reference internal" href="#document-developer/master-worker"><span class="doc">Master-Worker API</span></a>.</p>
</div>
<div class="section" id="customizing-svnpoller">
<span id="id5"></span><h4><a class="toc-backref" href="#id18">2.6.6. Customizing SVNPoller</a><a class="headerlink" href="#customizing-svnpoller" title="Permalink to this headline">¶</a></h4>
<p>Each source file that is tracked by a Subversion repository has a fully-qualified SVN URL in the following form: <code class="samp docutils literal notranslate"><span class="pre">(</span><em><span class="pre">REPOURL</span></em><span class="pre">)(</span><em><span class="pre">PROJECT-plus-BRANCH</span></em><span class="pre">)(</span><em><span class="pre">FILEPATH</span></em><span class="pre">)</span></code>.
When you create the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a>, you give it a <code class="docutils literal notranslate"><span class="pre">repourl</span></code> value that includes all of the <code class="samp docutils literal notranslate"><em><span class="pre">REPOURL</span></em></code> and possibly some portion of the <code class="samp docutils literal notranslate"><em><span class="pre">PROJECT-plus-BRANCH</span></em></code> string.
The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> is responsible for producing Changes that contain a branch name and a <code class="samp docutils literal notranslate"><em><span class="pre">FILEPATH</span></em></code> (which is relative to the top of a checked-out tree).
The details of how these strings are split up depend upon how your repository names its branches.</p>
<div class="section" id="project-branchname-filepath-repositories">
<h5><a class="toc-backref" href="#id19">2.6.6.1. <code class="samp docutils literal notranslate"><em><span class="pre">PROJECT</span></em><span class="pre">/</span><em><span class="pre">BRANCHNAME</span></em><span class="pre">/</span><em><span class="pre">FILEPATH</span></em></code> repositories</a><a class="headerlink" href="#project-branchname-filepath-repositories" title="Permalink to this headline">¶</a></h5>
<p>One common layout is to have all the various projects that share a repository get a single top-level directory each, with <code class="docutils literal notranslate"><span class="pre">branches</span></code>, <code class="docutils literal notranslate"><span class="pre">tags</span></code>, and <code class="docutils literal notranslate"><span class="pre">trunk</span></code> subdirectories:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>amanda/trunk
      /branches/3_2
               /3_3
      /tags/3_2_1
           /3_2_2
           /3_3_0
</pre></div>
</div>
<p>To set up a <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> that watches the Amanda trunk (and nothing else), we would use the following, using the default <code class="docutils literal notranslate"><span class="pre">split_file</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span>
   <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;https://svn.amanda.sourceforge.net/svnroot/amanda/amanda/trunk&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, every Change that our <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> produces will have its branch attribute set to <code class="docutils literal notranslate"><span class="pre">None</span></code>, to indicate that the Change is on the trunk.
No other sub-projects or branches will be tracked.</p>
<p>If we want our ChangeSource to follow multiple branches, we have to do two things.
First we have to change our <code class="docutils literal notranslate"><span class="pre">repourl=</span></code> argument to watch more than just <code class="docutils literal notranslate"><span class="pre">amanda/trunk</span></code>.
We will set it to <code class="docutils literal notranslate"><span class="pre">amanda</span></code> so that we’ll see both the trunk and all the branches.
Second, we have to tell <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> how to split the <code class="samp docutils literal notranslate"><span class="pre">(</span><em><span class="pre">PROJECT-plus-BRANCH</span></em><span class="pre">)(</span><em><span class="pre">FILEPATH</span></em><span class="pre">)</span></code> strings it gets from the repository out into <code class="samp docutils literal notranslate"><span class="pre">(</span><em><span class="pre">BRANCH</span></em><span class="pre">)</span></code> and <code class="samp docutils literal notranslate"><span class="pre">(</span><em><span class="pre">FILEPATH</span></em><span class="pre">)</span></code>.</p>
<p>We do the latter by providing a <code class="docutils literal notranslate"><span class="pre">split_file</span></code> function.
This function is responsible for splitting something like <code class="docutils literal notranslate"><span class="pre">branches/3_3/common-src/amanda.h</span></code> into <code class="docutils literal notranslate"><span class="pre">branch='branches/3_3'</span></code> and <code class="docutils literal notranslate"><span class="pre">filepath='common-src/amanda.h'</span></code>.
The function is always given a string that names a file relative to the subdirectory pointed to by the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a>’s <code class="docutils literal notranslate"><span class="pre">repourl=</span></code> argument.
It is expected to return a dictionary with at least the <code class="docutils literal notranslate"><span class="pre">path</span></code> key.
The splitter may optionally set <code class="docutils literal notranslate"><span class="pre">branch</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code> and <code class="docutils literal notranslate"><span class="pre">repository</span></code>.
For backwards compatibility it may return a tuple of <code class="docutils literal notranslate"><span class="pre">(branchname,</span> <span class="pre">path)</span></code>.
It may also return <code class="docutils literal notranslate"><span class="pre">None</span></code> to indicate that the file is of no interest.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The function should return <code class="docutils literal notranslate"><span class="pre">branches/3_3</span></code> rather than just <code class="docutils literal notranslate"><span class="pre">3_3</span></code> because the SVN checkout step, will append the branch name to the <code class="docutils literal notranslate"><span class="pre">baseURL</span></code>, which requires that we keep the <code class="docutils literal notranslate"><span class="pre">branches</span></code> component in there.
Other VC schemes use a different approach towards branches and may not require this artifact.</p>
</div>
<p>If your repository uses this same <code class="docutils literal notranslate"><span class="pre">{PROJECT}/{BRANCH}/{FILEPATH}</span></code> naming scheme, the following function will work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split_file_branches</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">pieces</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;trunk&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;branches&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
<p>In fact, this is the definition of the provided <code class="docutils literal notranslate"><span class="pre">split_file_branches</span></code> function.
So to have our Twisted-watching <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> follow multiple branches, we would use this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span><span class="s2">&quot;svn://svn.twistedmatrix.com/svn/Twisted&quot;</span><span class="p">,</span>
                                       <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>Changes for all sorts of branches (with names like <code class="docutils literal notranslate"><span class="pre">&quot;branches/1.5.x&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">None</span></code> to indicate the trunk) will be delivered to the Schedulers.
Each Scheduler is then free to use or ignore each branch as it sees fit.</p>
<p>If you have multiple projects in the same repository your split function can attach a project name to the Change to help the Scheduler filter out unwanted changes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>
<span class="k">def</span> <span class="nf">split_file_projects_branches</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">project</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_branches</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">info</span><span class="p">[</span><span class="s1">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
<p>Again, this is provided by default.
To use it you would do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span>
   <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;https://svn.amanda.sourceforge.net/svnroot/amanda/&quot;</span><span class="p">,</span>
   <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_projects_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>Note here that we are monitoring at the root of the repository, and that within that repository is a <code class="docutils literal notranslate"><span class="pre">amanda</span></code> subdirectory which in turn has <code class="docutils literal notranslate"><span class="pre">trunk</span></code> and <code class="docutils literal notranslate"><span class="pre">branches</span></code>.
It is that <code class="docutils literal notranslate"><span class="pre">amanda</span></code> subdirectory whose name becomes the <code class="docutils literal notranslate"><span class="pre">project</span></code> field of the Change.</p>
</div>
<div class="section" id="branchname-project-filepath-repositories">
<h5><a class="toc-backref" href="#id20">2.6.6.2. <code class="samp docutils literal notranslate"><em><span class="pre">BRANCHNAME</span></em><span class="pre">/</span><em><span class="pre">PROJECT</span></em><span class="pre">/</span><em><span class="pre">FILEPATH</span></em></code> repositories</a><a class="headerlink" href="#branchname-project-filepath-repositories" title="Permalink to this headline">¶</a></h5>
<p>Another common way to organize a Subversion repository is to put the branch name at the top, and the projects underneath.
This is especially frequent when there are a number of related sub-projects that all get released in a group.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">Divmod.org</span></code> hosts a project named <cite>Nevow</cite> as well as one named <cite>Quotient</cite>.
In a checked-out Nevow tree there is a directory named <cite>formless</cite> that contains a Python source file named <code class="file docutils literal notranslate"><span class="pre">webform.py</span></code>.
This repository is accessible via webdav (and thus uses an <cite>http:</cite> scheme) through the divmod.org hostname.
There are many branches in this repository, and they use a <code class="docutils literal notranslate"><span class="pre">({BRANCHNAME})/({PROJECT})</span></code> naming policy.</p>
<p>The fully-qualified SVN URL for the trunk version of <code class="file docutils literal notranslate"><span class="pre">webform.py</span></code> is <code class="docutils literal notranslate"><span class="pre">http://divmod.org/svn/Divmod/trunk/Nevow/formless/webform.py</span></code>.
The 1.5.x branch version of this file would have a URL of <code class="docutils literal notranslate"><span class="pre">http://divmod.org/svn/Divmod/branches/1.5.x/Nevow/formless/webform.py</span></code>.
The whole Nevow trunk would be checked out with <code class="docutils literal notranslate"><span class="pre">http://divmod.org/svn/Divmod/trunk/Nevow</span></code>, while the Quotient trunk would be checked out using <code class="docutils literal notranslate"><span class="pre">http://divmod.org/svn/Divmod/trunk/Quotient</span></code>.</p>
<p>Now suppose we want to have an <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> that only cares about the Nevow trunk.
This case looks just like the <code class="samp docutils literal notranslate"><em><span class="pre">PROJECT</span></em><span class="pre">/</span><em><span class="pre">BRANCH</span></em></code> layout described earlier:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span><span class="s2">&quot;http://divmod.org/svn/Divmod/trunk/Nevow&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>But what happens when we want to track multiple Nevow branches?
We have to point our <code class="docutils literal notranslate"><span class="pre">repourl=</span></code> high enough to see all those branches, but we also don’t want to include Quotient changes (since we’re only building Nevow).
To accomplish this, we must rely upon the <code class="docutils literal notranslate"><span class="pre">split_file</span></code> function to help us tell the difference between files that belong to Nevow and those that belong to Quotient, as well as figuring out which branch each one is on.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span><span class="s2">&quot;http://divmod.org/svn/Divmod&quot;</span><span class="p">,</span>
                                       <span class="n">split_file</span><span class="o">=</span><span class="n">my_file_splitter</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">my_file_splitter</span></code> function will be called with repository-relative pathnames like:</p>
<dl class="docutils">
<dt><code class="file docutils literal notranslate"><span class="pre">trunk/Nevow/formless/webform.py</span></code></dt>
<dd>This is a Nevow file, on the trunk.
We want the Change that includes this to see a filename of <code class="file docutils literal notranslate"><span class="pre">formless/webform.py</span></code>, and a branch of <code class="docutils literal notranslate"><span class="pre">None</span></code></dd>
<dt><code class="file docutils literal notranslate"><span class="pre">branches/1.5.x/Nevow/formless/webform.py</span></code></dt>
<dd>This is a Nevow file, on a branch.
We want to get <code class="docutils literal notranslate"><span class="pre">branch='branches/1.5.x'</span></code> and <code class="docutils literal notranslate"><span class="pre">filename='formless/webform.py'</span></code>.</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">trunk/Quotient/setup.py</span></code></dt>
<dd>This is a Quotient file, so we want to ignore it by having <code class="xref py py-meth docutils literal notranslate"><span class="pre">my_file_splitter</span></code> return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</dd>
<dt><code class="file docutils literal notranslate"><span class="pre">branches/1.5.x/Quotient/setup.py</span></code></dt>
<dd>This is also a Quotient file, which should be ignored.</dd>
</dl>
<p>The following definition for <code class="xref py py-meth docutils literal notranslate"><span class="pre">my_file_splitter</span></code> will do the job:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_file_splitter</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">pieces</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;trunk&#39;</span><span class="p">:</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">pieces</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># remove &#39;trunk&#39;</span>
    <span class="k">elif</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;branches&#39;</span><span class="p">:</span>
        <span class="n">pieces</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># remove &#39;branches&#39;</span>
        <span class="c1"># grab branch name</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="s1">&#39;branches/&#39;</span> <span class="o">+</span> <span class="n">pieces</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="c1"># something weird</span>
    <span class="n">projectname</span> <span class="o">=</span> <span class="n">pieces</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">projectname</span> <span class="o">!=</span> <span class="s1">&#39;Nevow&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span> <span class="c1"># wrong project</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">))</span>
</pre></div>
</div>
<p>If you later decide you want to get changes for Quotient as well you could replace the last 3 lines with simply:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">projectname</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="writing-change-sources">
<span id="id6"></span><h4><a class="toc-backref" href="#id21">2.6.7. Writing Change Sources</a><a class="headerlink" href="#writing-change-sources" title="Permalink to this headline">¶</a></h4>
<p>For some version-control systems, making Buildbot aware of new changes can be a challenge.
If the pre-supplied classes in <a class="reference internal" href="#change-sources"><span class="std std-ref">Change Sources and Changes</span></a> are not sufficient, then you will need to write your own.</p>
<p>There are three approaches, one of which is not even a change source.
The first option is to write a change source that exposes some service to which the version control system can “push” changes.
This can be more complicated, since it requires implementing a new service, but delivers changes to Buildbot immediately on commit.</p>
<p>The second option is often preferable to the first: implement a notification service in an external process (perhaps one that is started directly by the version control system, or by an email server) and delivers changes to Buildbot via <a class="reference internal" href="#pbchangesource"><span class="std std-ref">PBChangeSource</span></a>.
This section does not describe this particular approach, since it requires no customization within the buildmaster process.</p>
<p>The third option is to write a change source which polls for changes - repeatedly connecting to an external service to check for new changes.
This works well in many cases, but can produce a high load on the version control system if polling is too frequent, and can take too long to notice changes if the polling is not frequent enough.</p>
<div class="section" id="writing-a-notification-based-change-source">
<h5><a class="toc-backref" href="#id22">2.6.7.1. Writing a Notification-based Change Source</a><a class="headerlink" href="#writing-a-notification-based-change-source" title="Permalink to this headline">¶</a></h5>
<p>A custom change source must implement <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.IChangeSource</span></code>.</p>
<p>The easiest way to do this is to subclass <a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.changes.base.ChangeSource</span></code></a>, implementing the <code class="xref py py-meth docutils literal notranslate"><span class="pre">describe</span></code> method to describe the instance.
<code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code> is a Twisted service, so you will need to implement the <code class="xref py py-meth docutils literal notranslate"><span class="pre">startService</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">stopService</span></code> methods to control the means by which your change source receives notifications.</p>
<p>When the class does receive a change, it should call <code class="docutils literal notranslate"><span class="pre">self.master.addChange(..)</span></code> to submit it to the buildmaster.
This method shares the same parameters as <code class="docutils literal notranslate"><span class="pre">master.db.changes.addChange</span></code>, so consult the API documentation for that function for details on the available arguments.</p>
<p>You will probably also want to set <code class="docutils literal notranslate"><span class="pre">compare_attrs</span></code> to the list of object attributes which Buildbot will use to compare one change source to another when reconfiguring.
During reconfiguration, if the new change source is different from the old, then the old will be stopped and the new started.</p>
</div>
<div class="section" id="writing-a-change-poller">
<h5><a class="toc-backref" href="#id23">2.6.7.2. Writing a Change Poller</a><a class="headerlink" href="#writing-a-change-poller" title="Permalink to this headline">¶</a></h5>
<p>Polling is a very common means of seeking changes, so Buildbot supplies a utility parent class to make it easier.
A poller should subclass <a class="reference internal" href="#buildbot.changes.base.PollingChangeSource" title="buildbot.changes.base.PollingChangeSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.changes.base.PollingChangeSource</span></code></a>, which is a subclass of <a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code></a>.
This subclass implements the <code class="xref py py-meth docutils literal notranslate"><span class="pre">Service</span></code> methods, and calls the <code class="xref py py-meth docutils literal notranslate"><span class="pre">poll</span></code> method according to the <code class="docutils literal notranslate"><span class="pre">pollInterval</span></code> and <code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code> options.
The <code class="docutils literal notranslate"><span class="pre">poll</span></code> method should return a Deferred to signal its completion.</p>
<p>Aside from the service methods, the other concerns in the previous section apply here, too.</p>
</div>
</div>
<div class="section" id="writing-a-new-latent-worker-implementation">
<h4><a class="toc-backref" href="#id24">2.6.8. Writing a New Latent Worker Implementation</a><a class="headerlink" href="#writing-a-new-latent-worker-implementation" title="Permalink to this headline">¶</a></h4>
<p>Writing a new latent worker should only require subclassing <a class="reference internal" href="#buildbot.worker.AbstractLatentWorker" title="buildbot.worker.AbstractLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.AbstractLatentWorker</span></code></a> and implementing <a class="reference internal" href="#start_instance" title="start_instance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start_instance</span></code></a> and <a class="reference internal" href="#stop_instance" title="stop_instance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop_instance</span></code></a> at a minimum.</p>
<div class="section" id="abstractlatentcontroller">
<span id="worker-AbstractWorkerController"></span><h5><a class="toc-backref" href="#id25">2.6.8.1. AbstractLatentController</a><a class="headerlink" href="#abstractlatentcontroller" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.worker.AbstractLatentWorker">
<em class="property">class </em><code class="descclassname">buildbot.worker.</code><code class="descname">AbstractLatentWorker</code><a class="headerlink" href="#buildbot.worker.AbstractLatentWorker" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This class is the base class of all latent workers and implements some common functionality.
A custom worker should only need to override <a class="reference internal" href="#start_instance" title="start_instance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start_instance</span></code></a> and <a class="reference internal" href="#stop_instance" title="stop_instance"><code class="xref py py-meth docutils literal notranslate"><span class="pre">stop_instance</span></code></a> methods.</p>
<p>See <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.ec2.EC2LatentWorker</span></code></a> for an example.</p>
<blockquote>
<div><dl class="method">
<dt id="start_instance">
<code class="descname">start_instance</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#start_instance" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is responsible for starting instance that will try to connect with this master.
A deferred should be returned.
Any problems should use an errback.
The callback value can be <code class="docutils literal notranslate"><span class="pre">None</span></code>, or can be an iterable of short strings to include in the “substantiate success” status message, such as identifying the instance that started.</p>
</dd></dl>

<dl class="method">
<dt id="stop_instance">
<code class="descname">stop_instance</code><span class="sig-paren">(</span><em>self</em>, <em>fast=False</em><span class="sig-paren">)</span><a class="headerlink" href="#stop_instance" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is responsible for shutting down instance.
A deferred should be returned.
If <code class="docutils literal notranslate"><span class="pre">fast</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> then the function should call back as soon as it is safe to do so, as, for example, the master may be shutting down.
The value returned by the callback is ignored.</p>
</dd></dl>

</div></blockquote>
</div>
</div>
<div class="section" id="custom-build-classes">
<h4><a class="toc-backref" href="#id26">2.6.9. Custom Build Classes</a><a class="headerlink" href="#custom-build-classes" title="Permalink to this headline">¶</a></h4>
<p>The standard <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> object creates <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> objects by default.
These Builds will each execute a collection of <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s in a fixed sequence.
Each step can affect the results of the build, but in general there is little intelligence to tie the different steps together.</p>
<p>By setting the factory’s <code class="docutils literal notranslate"><span class="pre">buildClass</span></code> attribute to a different class, you can instantiate a different build class.
This might be useful, for example, to create a build class that dynamically determines which steps to run.
The skeleton of such a project would look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DynamicBuild</span><span class="p">(</span><span class="n">Build</span><span class="p">):</span>
    <span class="c1"># override some methods</span>
    <span class="o">...</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">buildClass</span> <span class="o">=</span> <span class="n">DynamicBuild</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="factory-workdir-functions">
<span id="id7"></span><h4><a class="toc-backref" href="#id27">2.6.10. Factory Workdir Functions</a><a class="headerlink" href="#factory-workdir-functions" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While factory workdir function is still supported, it is better to just use the fact that workdir is a <span class="target" id="index-3"></span>renderables attribute of every steps.
A Renderable has access to much more contextual information, and also can return a deferred.
So you could say <code class="docutils literal notranslate"><span class="pre">build_factory.workdir</span> <span class="pre">=</span> <span class="pre">util.Interpolate(&quot;%(src:repository)s</span></code> to achieve similar goal.</p>
</div>
<p>It is sometimes helpful to have a build’s workdir determined at runtime based on the parameters of the build.
To accomplish this, set the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> attribute of the build factory to a callable.
That callable will be invoked with the list of <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code> for the build, and should return the appropriate workdir.
Note that the value must be returned immediately - Deferreds are not supported.</p>
<p>This can be useful, for example, in scenarios with multiple repositories submitting changes to Buildbot.
In this case you likely will want to have a dedicated workdir per repository, since otherwise a sourcing step with mode = “update” will fail as a workdir with a working copy of repository A can’t be “updated” for changes from a repository B.
Here is an example how you can achieve workdir-per-repo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">workdir</span><span class="p">(</span><span class="n">source_stamps</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">source_stamps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">repository</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>

<span class="n">build_factory</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">build_factory</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">workdir</span>

<span class="n">build_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Git</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;update&quot;</span><span class="p">))</span>
<span class="c1"># ...</span>
<span class="n">builders</span><span class="o">.</span><span class="n">append</span> <span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;mybuilder&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;myworker&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;mybuilder&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">build_factory</span><span class="p">})</span>
</pre></div>
</div>
<p>The end result is a set of workdirs like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Repo1 =&gt; &lt;worker-base&gt;/mybuilder/a78890ba
Repo2 =&gt; &lt;worker-base&gt;/mybuilder/0823ba88
</pre></div>
</div>
<p>You could make the <code class="xref py py-func docutils literal notranslate"><span class="pre">workdir</span></code> function compute other paths, based on parts of the repo URL in the sourcestamp, or lookup in a lookup table based on repo URL.
As long as there is a permanent 1:1 mapping between repos and workdir, this will work.</p>
</div>
<div class="section" id="writing-new-buildsteps">
<span id="id8"></span><h4><a class="toc-backref" href="#id28">2.6.11. Writing New BuildSteps</a><a class="headerlink" href="#writing-new-buildsteps" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The API of writing custom build steps has changed significantly in Buildbot-0.9.0.
See <a class="reference internal" href="#new-style-build-steps"><span class="std std-ref">New-Style Build Steps</span></a> for details about what has changed since pre 0.9.0 releases.
This section documents new-style steps.</p>
</div>
<p>While it is a good idea to keep your build process self-contained in the source code tree, sometimes it is convenient to put more intelligence into your Buildbot configuration.
One way to do this is to write a custom <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a>.
Once written, this Step can be used in the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file.</p>
<p>The best reason for writing a custom <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> is to better parse the results of the command being run.
For example, a <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> that knows about JUnit could look at the logfiles to determine which tests had been run, how many passed and how many failed, and then report more detailed information than a simple <code class="docutils literal notranslate"><span class="pre">rc==0</span></code> -based <cite>good/bad</cite> decision.</p>
<p>Buildbot has acquired a large fleet of build steps, and sports a number of knobs and hooks to make steps easier to write.
This section may seem a bit overwhelming, but most custom steps will only need to apply one or two of the techniques outlined here.</p>
<p>For complete documentation of the build step interfaces, see <a class="reference internal" href="#document-developer/cls-buildsteps"><span class="doc">BuildSteps</span></a>.</p>
<div class="section" id="writing-buildstep-constructors">
<span id="id9"></span><h5><a class="toc-backref" href="#id29">2.6.11.1. Writing BuildStep Constructors</a><a class="headerlink" href="#writing-buildstep-constructors" title="Permalink to this headline">¶</a></h5>
<p>Build steps act as their own factories, so their constructors are a bit more complex than necessary.
The configuration file instantiates a <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> object, but the step configuration must be re-used for multiple builds, so Buildbot needs some way to create more steps.</p>
<p>Consider the use of a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> in <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MyStep</span><span class="p">(</span><span class="n">someopt</span><span class="o">=</span><span class="s2">&quot;stuff&quot;</span><span class="p">,</span> <span class="n">anotheropt</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>This creates a single instance of class <code class="docutils literal notranslate"><span class="pre">MyStep</span></code>.
However, Buildbot needs a new object each time the step is executed.
An instance of <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> remembers how it was constructed, and can create copies of itself.
When writing a new step class, then, keep in mind are that you cannot do anything “interesting” in the constructor – limit yourself to checking and storing arguments.</p>
<p>It is customary to call the parent class’s constructor with all otherwise-unspecified keyword arguments.
Keep a <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> argument on the end of your options, and pass that up to the parent class’s constructor.</p>
<p>The whole thing looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Frobnify</span><span class="p">(</span><span class="n">LoggingBuildStep</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">frob_what</span><span class="o">=</span><span class="s2">&quot;frobee&quot;</span><span class="p">,</span>
            <span class="n">frob_how_many</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">frob_how</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="c1"># check</span>
        <span class="k">if</span> <span class="n">frob_how_many</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Frobnify argument how_many is required&quot;</span><span class="p">)</span>

        <span class="c1"># override a parent option</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;parentOpt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;xyz&#39;</span>

        <span class="c1"># call parent</span>
        <span class="n">LoggingBuildStep</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># set Frobnify attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frob_what</span> <span class="o">=</span> <span class="n">frob_what</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frob_how_many</span> <span class="o">=</span> <span class="n">how_many</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frob_how</span> <span class="o">=</span> <span class="n">frob_how</span>

<span class="k">class</span> <span class="nc">FastFrobnify</span><span class="p">(</span><span class="n">Frobnify</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">speed</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Frobnify</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">speed</span> <span class="o">=</span> <span class="n">speed</span>
</pre></div>
</div>
</div>
<div class="section" id="step-execution-process">
<h5><a class="toc-backref" href="#id30">2.6.11.2. Step Execution Process</a><a class="headerlink" href="#step-execution-process" title="Permalink to this headline">¶</a></h5>
<p>A step’s execution occurs in its <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.run" title="buildbot.process.buildstep.BuildStep.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span></code></a> method.
When this method returns (more accurately, when the Deferred it returns fires), the step is complete.
The method’s result must be an integer, giving the result of the step.
Any other output from the step (logfiles, status strings, URLs, etc.) is the responsibility of the <code class="docutils literal notranslate"><span class="pre">run</span></code> method.</p>
<p>The <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> class implements this <code class="docutils literal notranslate"><span class="pre">run</span></code> method, and in most cases steps subclassing <code class="docutils literal notranslate"><span class="pre">ShellCommand</span></code> simply implement some of the subsidiary methods that its <code class="docutils literal notranslate"><span class="pre">run</span></code> method calls.</p>
</div>
<div class="section" id="running-commands">
<h5><a class="toc-backref" href="#id31">2.6.11.3. Running Commands</a><a class="headerlink" href="#running-commands" title="Permalink to this headline">¶</a></h5>
<p>To spawn a command in the worker, create a <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> instance in your step’s <code class="docutils literal notranslate"><span class="pre">run</span></code> method and run it with <code class="xref py py-meth docutils literal notranslate"><span class="pre">runCommand</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmd</span> <span class="o">=</span> <span class="n">RemoteCommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">CommandMixin</span></code> class offers a simple interface to several common worker-side commands.</p>
<p>For the much more common task of running a shell command on the worker, use <code class="xref py py-class docutils literal notranslate"><span class="pre">ShellMixin</span></code>.
This class provides a method to handle the myriad constructor arguments related to shell commands, as well as a method to create new <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> instances.
This mixin is the recommended method of implementing custom shell-based steps.
The older pattern of subclassing <code class="docutils literal notranslate"><span class="pre">ShellCommand</span></code> is no longer recommended.</p>
<p>A simple example of a step using the shell mixin is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RunCleanup</span><span class="p">(</span><span class="n">buildstep</span><span class="o">.</span><span class="n">ShellMixin</span><span class="p">,</span> <span class="n">buildstep</span><span class="o">.</span><span class="n">BuildStep</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cleanupScript</span><span class="o">=</span><span class="s1">&#39;./cleanup.sh&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cleanupScript</span> <span class="o">=</span> <span class="n">cleanupScript</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupShellMixin</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">prohibitArgs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;command&#39;</span><span class="p">])</span>
        <span class="n">buildstep</span><span class="o">.</span><span class="n">BuildStep</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeRemoteShellCommand</span><span class="p">(</span>
                <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cleanupScript</span><span class="p">])</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">didFail</span><span class="p">():</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeRemoteShellCommand</span><span class="p">(</span>
                    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cleanupScript</span><span class="p">,</span> <span class="s1">&#39;--force&#39;</span><span class="p">],</span>
                    <span class="n">logEnviron</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">results</span><span class="p">())</span>

<span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">RemoteCommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">addLog</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">)</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">useLog</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">closeWhenFinished</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-status-strings">
<h5><a class="toc-backref" href="#id32">2.6.11.4. Updating Status Strings</a><a class="headerlink" href="#updating-status-strings" title="Permalink to this headline">¶</a></h5>
<p>Each step can summarize its current status in a very short string.
For example, a compile step might display the file being compiled.
This information can be helpful users eager to see their build finish.</p>
<p>Similarly, a build has a set of short strings collected from its steps summarizing the overall state of the build.
Useful information here might include the number of tests run, but probably not the results of a <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code> step.</p>
<p>As a step runs, Buildbot calls its <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getCurrentSummary" title="buildbot.process.buildstep.BuildStep.getCurrentSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getCurrentSummary</span></code></a> method as necessary to get the step’s current status.
“As necessary” is determined by calls to <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.updateSummary" title="buildbot.process.buildstep.BuildStep.updateSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.updateSummary</span></code></a>.
Your step should call this method every time the status summary may have changed.
Buildbot will take care of rate-limiting summary updates.</p>
<p>When the step is complete, Buildbot calls its <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getResultSummary" title="buildbot.process.buildstep.BuildStep.getResultSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getResultSummary</span></code></a> method to get a final summary of the step along with a summary for the build.</p>
</div>
<div class="section" id="about-logfiles">
<h5><a class="toc-backref" href="#id33">2.6.11.5. About Logfiles</a><a class="headerlink" href="#about-logfiles" title="Permalink to this headline">¶</a></h5>
<p>Each BuildStep has a collection of log files.
Each one has a short name, like <cite>stdio</cite> or <cite>warnings</cite>.
Each log file contains an arbitrary amount of text, usually the contents of some output file generated during a build or test step, or a record of everything that was printed to <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>/<code class="file docutils literal notranslate"><span class="pre">stderr</span></code> during the execution of some command.</p>
<p>Each can contain multiple <cite>channels</cite>, generally limited to three basic ones: stdout, stderr, and <cite>headers</cite>.
For example, when a shell command runs, it writes a few lines to the headers channel to indicate the exact argv strings being run, which directory the command is being executed in, and the contents of the current environment variables.
Then, as the command runs, it adds a lot of <code class="file docutils literal notranslate"><span class="pre">stdout</span></code> and <code class="file docutils literal notranslate"><span class="pre">stderr</span></code> messages.
When the command finishes, a final <cite>header</cite> line is added with the exit code of the process.</p>
<p>Status display plugins can format these different channels in different ways.
For example, the web page shows log files as text/html, with header lines in blue text, stdout in black, and stderr in red.
A different URL is available which provides a text/plain format, in which stdout and stderr are collapsed together, and header lines are stripped completely.
This latter option makes it easy to save the results to a file and run <strong class="command">grep</strong> or whatever against the output.</p>
</div>
<div class="section" id="writing-log-files">
<h5><a class="toc-backref" href="#id34">2.6.11.6. Writing Log Files</a><a class="headerlink" href="#writing-log-files" title="Permalink to this headline">¶</a></h5>
<p>Most commonly, logfiles come from commands run on the worker.
Internally, these are configured by supplying the <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> instance with log files via the <code class="xref py py-meth docutils literal notranslate"><span class="pre">useLog</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">log</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">addLog</span><span class="p">(</span><span class="s1">&#39;stdio&#39;</span><span class="p">)</span>
    <span class="n">cmd</span><span class="o">.</span><span class="n">useLog</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">closeWhenFinished</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;stdio&#39;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
<p>The name passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">useLog</span></code> must match that configured in the command.
In this case, <code class="docutils literal notranslate"><span class="pre">stdio</span></code> is the default.</p>
<p>If the log file was already added by another part of the step, it can be retrieved with <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getLog" title="buildbot.process.buildstep.BuildStep.getLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getLog</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stdioLog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLog</span><span class="p">(</span><span class="s1">&#39;stdio&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Less frequently, some master-side processing produces a log file.
If this log file is short and easily stored in memory, this is as simple as a call to <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addCompleteLog</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
                         <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lint_results</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">addCompleteLog</span><span class="p">(</span><span class="s1">&#39;summary&#39;</span><span class="p">,</span> <span class="n">summary</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the log contents must be a unicode string.</p>
<p>Longer logfiles can be constructed line-by-line using the <code class="docutils literal notranslate"><span class="pre">add</span></code> methods of the log file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="n">updates</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">addLog</span><span class="p">(</span><span class="s1">&#39;updates&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="o">...</span>
        <span class="k">yield</span> <span class="n">updates</span><span class="o">.</span><span class="n">addStdout</span><span class="p">(</span><span class="n">some_update</span><span class="p">)</span>
</pre></div>
</div>
<p>Again, note that the log input must be a unicode string.</p>
<p>Finally, <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addHTMLLog" title="buildbot.process.buildstep.BuildStep.addHTMLLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addHTMLLog</span></code></a> is similar to <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addCompleteLog</span></code></a>, but the resulting log will be tagged as containing HTML.
The web UI will display the contents of the log using the browser.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">logfiles=</span></code> argument to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> and its subclasses creates new log files and fills them in realtime by asking the worker to watch a actual file on disk.
The worker will look for additions in the target file and report them back to the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>.
These additions will be added to the log file by calling <code class="xref py py-meth docutils literal notranslate"><span class="pre">addStdout</span></code>.</p>
<p>All log files can be used as the source of a <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> just like the normal <code class="file docutils literal notranslate"><span class="pre">stdio</span></code> <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code>.
In fact, it’s possible for one <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> to observe a logfile created by another.</p>
</div>
<div class="section" id="reading-logfiles">
<h5><a class="toc-backref" href="#id35">2.6.11.7. Reading Logfiles</a><a class="headerlink" href="#reading-logfiles" title="Permalink to this headline">¶</a></h5>
<p>For the most part, Buildbot tries to avoid loading the contents of a log file into memory as a single string.
For large log files on a busy master, this behavior can quickly consume a great deal of memory.</p>
<p>Instead, steps should implement a <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> to examine log files one chunk or line at a time.</p>
<p>For commands which only produce a small quantity of output, <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> will collect the command’s stdout into its <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.stdout" title="buildbot.process.remotecommand.RemoteCommand.stdout"><code class="xref py py-attr docutils literal notranslate"><span class="pre">stdout</span></code></a> attribute if given the <code class="docutils literal notranslate"><span class="pre">collectStdout=True</span></code> constructor argument.</p>
</div>
<div class="section" id="adding-logobservers">
<span id="id10"></span><h5><a class="toc-backref" href="#id36">2.6.11.8. Adding LogObservers</a><a class="headerlink" href="#adding-logobservers" title="Permalink to this headline">¶</a></h5>
<p>Most shell commands emit messages to stdout or stderr as they operate, especially if you ask them nicely with a option <cite>–verbose</cite> flag of some sort.
They may also write text to a log file while they run.
Your <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> can watch this output as it arrives, to keep track of how much progress the command has made or to process log output for later summarization.</p>
<p>To accomplish this, you will need to attach a <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> to the log.
This observer is given all text as it is emitted from the command, and has the opportunity to parse that output incrementally.</p>
<p>There are a number of pre-built <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> classes that you can choose from (defined in <a class="reference internal" href="#module-buildbot.process.buildstep" title="buildbot.process.buildstep"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.buildstep</span></code></a>, and of course you can subclass them to add further customization.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">LogLineObserver</span></code> class handles the grunt work of buffering and scanning for end-of-line delimiters, allowing your parser to operate on complete <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>/<code class="file docutils literal notranslate"><span class="pre">stderr</span></code> lines.</p>
<p>For example, let’s take a look at the <code class="xref py py-class docutils literal notranslate"><span class="pre">TrialTestCaseCounter</span></code>, which is used by the <a class="reference internal" href="#step-Trial" title="Trial"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trial</span></code></a> step to count test cases as they are run.
As Trial executes, it emits lines like the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot.test.test_config.ConfigTest.testDebugPassword ... [OK]
buildbot.test.test_config.ConfigTest.testEmpty ... [OK]
buildbot.test.test_config.ConfigTest.testIRC ... [FAIL]
buildbot.test.test_config.ConfigTest.testLocks ... [OK]
</pre></div>
</div>
<p>When the tests are finished, trial emits a long line of <cite>======</cite> and then some lines which summarize the tests that failed.
We want to avoid parsing these trailing lines, because their format is less well-defined than the <cite>[OK]</cite> lines.</p>
<p>A simple version of the parser for this output looks like this.
The full version is in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/steps/python_twisted.py">master/buildbot/steps/python_twisted.py</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>

<span class="k">class</span> <span class="nc">TrialTestCaseCounter</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">LogLineObserver</span><span class="p">):</span>
    <span class="n">_line_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^([\w\.]+) \.\.\. \[([^\]]+)\]$&#39;</span><span class="p">)</span>
    <span class="n">numTests</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">outLineReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">return</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">testname</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numTests</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numTests</span><span class="p">)</span>
</pre></div>
</div>
<p>This parser only pays attention to stdout, since that’s where trial writes the progress lines.
It has a mode flag named <code class="docutils literal notranslate"><span class="pre">finished</span></code> to ignore everything after the <code class="docutils literal notranslate"><span class="pre">====</span></code> marker, and a scary-looking regular expression to match each line while hopefully ignoring other messages that might get displayed as the test runs.</p>
<p>Each time it identifies a test has been completed, it increments its counter and delivers the new progress value to the step with <code class="docutils literal notranslate"><span class="pre">self.step.setProgress</span></code>.
This helps Buildbot to determine the ETA for the step.</p>
<p>To connect this parser into the <a class="reference internal" href="#step-Trial" title="Trial"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trial</span></code></a> build step, <code class="docutils literal notranslate"><span class="pre">Trial.__init__</span></code> ends with the following clause:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># this counter will feed Progress along the &#39;test cases&#39; metric</span>
<span class="n">counter</span> <span class="o">=</span> <span class="n">TrialTestCaseCounter</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addLogObserver</span><span class="p">(</span><span class="s1">&#39;stdio&#39;</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">progressMetrics</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<p>This creates a <code class="xref py py-class docutils literal notranslate"><span class="pre">TrialTestCaseCounter</span></code> and tells the step that the counter wants to watch the <code class="file docutils literal notranslate"><span class="pre">stdio</span></code> log.
The observer is automatically given a reference to the step in its <code class="xref py py-attr docutils literal notranslate"><span class="pre">step</span></code> attribute.</p>
</div>
<div class="section" id="using-properties">
<h5><a class="toc-backref" href="#id37">2.6.11.9. Using Properties</a><a class="headerlink" href="#using-properties" title="Permalink to this headline">¶</a></h5>
<p>In custom <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSteps</span></code>, you can get and set the build properties with the <a class="reference internal" href="#getProperty" title="getProperty"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getProperty</span></code></a> and <a class="reference internal" href="#setProperty" title="setProperty"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setProperty</span></code></a> methods.
Each takes a string for the name of the property, and returns or accepts an arbitrary JSON-able (lists, dicts, strings, and numbers) object.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MakeTarball</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s2">&quot;os&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;win&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCommand</span><span class="p">([</span> <span class="o">...</span> <span class="p">])</span> <span class="c1"># windows-only command</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCommand</span><span class="p">([</span> <span class="o">...</span> <span class="p">])</span> <span class="c1"># equivalent for other systems</span>
        <span class="n">ShellCommand</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Remember that properties set in a step may not be available until the next step begins.
In particular, any <code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">Interpolate</span></code> instances for the current step are interpolated before the step starts, so they cannot use the value of any properties determined in that step.</p>
</div>
<div class="section" id="using-statistics">
<span id="index-4"></span><h5><a class="toc-backref" href="#id38">2.6.11.10. Using Statistics</a><a class="headerlink" href="#using-statistics" title="Permalink to this headline">¶</a></h5>
<p>Statistics can be generated for each step, and then summarized across all steps in a build.
For example, a test step might set its <code class="docutils literal notranslate"><span class="pre">warnings</span></code> statistic to the number of warnings observed.
The build could then sum the <code class="docutils literal notranslate"><span class="pre">warnings</span></code> on all steps to get a total number of warnings.</p>
<p>Statistics are set and retrieved with the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.setStatistic" title="buildbot.process.buildstep.BuildStep.setStatistic"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setStatistic</span></code></a> and <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getStatistic" title="buildbot.process.buildstep.BuildStep.getStatistic"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getStatistic</span></code></a> methods.
The <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.hasStatistic" title="buildbot.process.buildstep.BuildStep.hasStatistic"><code class="xref py py-meth docutils literal notranslate"><span class="pre">hasStatistic</span></code></a> method determines whether a statistic exists.</p>
<p>The Build method <a class="reference internal" href="#buildbot.process.build.Build.getSummaryStatistic" title="buildbot.process.build.Build.getSummaryStatistic"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getSummaryStatistic</span></code></a> can be used to aggregate over all steps in a Build.</p>
</div>
<div class="section" id="buildstep-urls">
<h5><a class="toc-backref" href="#id39">2.6.11.11. BuildStep URLs</a><a class="headerlink" href="#buildstep-urls" title="Permalink to this headline">¶</a></h5>
<p>Each BuildStep has a collection of <cite>links</cite>.
Each has a name and a target URL.
The web display displays clickable links for each link, making them a useful way to point to extra information about a step.
For example, a step that uploads a build result to an external service might include a link to the uploaded file.</p>
<p>To set one of these links, the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> should call the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addURL" title="buildbot.process.buildstep.BuildStep.addURL"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addURL</span></code></a> method with the name of the link and the target URL.
Multiple URLs can be set.
For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span> <span class="c1"># create and upload report to coverage server</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://coverage.example.com/reports/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">reportname</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="s1">&#39;coverage&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>This also works from log observers, which is helpful for instance if the build output points to an external page such as a detailed log file. The following example parses output of <em>poudriere</em>, a tool for building packages on the FreeBSD operating system.</p>
<p>Example output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[00:00:00] Creating the reference jail... done
...
[00:00:01] Logs: /usr/local/poudriere/data/logs/bulk/103amd64-2018Q4/2018-10-03_05h47m30s
...
... build log without details (those are in the above logs directory) ...
</pre></div>
</div>
<p>Log observer implementation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">BuildmasterConfig</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;titleURL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://my-buildbot.example.com/&#39;</span>
<span class="c1"># ...</span>
<span class="k">class</span> <span class="nc">PoudriereLogLinkObserver</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">LogLineObserver</span><span class="p">):</span>
    <span class="n">_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;Logs: /usr/local/poudriere/data/logs/bulk/([-_/0-9A-Za-z]+)$&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">outLineReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="c1"># Short-circuit if URL already found</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regex</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_finished</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># Let&#39;s assume local directory /usr/local/poudriere/data/logs/bulk</span>
            <span class="c1"># is available as https://my-buildbot.example.com/poudriere/logs</span>
            <span class="n">poudriere_ui_url</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;titleURL&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;poudriere/logs/&#39;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># Add URLs for build overview page and for per-package log files</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="s1">&#39;Poudriere build web interface&#39;</span><span class="p">,</span> <span class="n">poudriere_ui_url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="s1">&#39;Poudriere logs&#39;</span><span class="p">,</span> <span class="n">poudriere_ui_url</span> <span class="o">+</span> <span class="s1">&#39;/logs/&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="discovering-files">
<h5><a class="toc-backref" href="#id40">2.6.11.12. Discovering files</a><a class="headerlink" href="#discovering-files" title="Permalink to this headline">¶</a></h5>
<p>When implementing a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> it may be necessary to know about files that are created during the build.
There are a few worker commands that can be used to find files on the worker and test for the existence (and type) of files and directories.</p>
<p>The worker provides the following file-discovery related commands:</p>
<ul class="simple">
<li><cite>stat</cite> calls <code class="xref py py-func docutils literal notranslate"><span class="pre">os.stat</span></code> for a file in the worker’s build directory.
This can be used to check if a known file exists and whether it is a regular file, directory or symbolic link.</li>
<li><cite>listdir</cite> calls <code class="xref py py-func docutils literal notranslate"><span class="pre">os.listdir</span></code> for a directory on the worker.
It can be used to obtain a list of files that are present in a directory on the worker.</li>
<li><cite>glob</cite> calls <code class="xref py py-func docutils literal notranslate"><span class="pre">glob.glob</span></code> on the worker, with a given shell-style pattern containing wildcards.</li>
</ul>
<p>For example, we could use stat to check if a given path exists and contains <code class="docutils literal notranslate"><span class="pre">*.pyc</span></code> files.
If the path does not exist (or anything fails) we mark the step as failed; if the path exists but is not a directory, we mark the step as having “warnings”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="kn">import</span> <span class="n">WorkerTooOldError</span>
<span class="kn">import</span> <span class="nn">stat</span>

<span class="k">class</span> <span class="nc">MyBuildStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">BuildStep</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">buildstep</span><span class="o">.</span><span class="n">BuildStep</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">dirname</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># make sure the worker knows about stat</span>
        <span class="n">workerver</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workerVersion</span><span class="p">(</span><span class="s1">&#39;stat&#39;</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">workerVersion</span><span class="p">(</span><span class="s1">&#39;glob&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">workerver</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">WorkerTooOldError</span><span class="p">(</span><span class="s1">&#39;need stat and glob&#39;</span><span class="p">)</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="n">buildstep</span><span class="o">.</span><span class="n">RemoteCommand</span><span class="p">(</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">})</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">res</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluateStat</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">evaluateStat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">didFail</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_status</span><span class="o">.</span><span class="n">setText</span><span class="p">([</span><span class="s2">&quot;File not found.&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">updates</span><span class="p">[</span><span class="s2">&quot;stat&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_ISDIR</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">stat</span><span class="o">.</span><span class="n">ST_MODE</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_status</span><span class="o">.</span><span class="n">setText</span><span class="p">([</span><span class="s2">&quot;&#39;tis not a directory&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">WARNINGS</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="n">buildstep</span><span class="o">.</span><span class="n">RemoteCommand</span><span class="p">(</span><span class="s1">&#39;glob&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">+</span> <span class="s1">&#39;/*.pyc&#39;</span><span class="p">})</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">res</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluateGlob</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
        <span class="n">d</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">evaluateGlob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">cmd</span><span class="o">.</span><span class="n">didFail</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_status</span><span class="o">.</span><span class="n">setText</span><span class="p">([</span><span class="s2">&quot;Glob failed.&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">FAILURE</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">updates</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_status</span><span class="o">.</span><span class="n">setText</span><span class="p">([</span><span class="s2">&quot;Found pycs&quot;</span><span class="p">]</span><span class="o">+</span><span class="n">files</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_status</span><span class="o">.</span><span class="n">setText</span><span class="p">([</span><span class="s2">&quot;No pycs found&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information on the available commands, see <a class="reference internal" href="#document-developer/master-worker"><span class="doc">Master-Worker API</span></a>.</p>
<div class="admonition-todo admonition" id="index-5">
<p class="first admonition-title">Todo</p>
<p class="last">Step Progress
BuildStepFailed</p>
</div>
</div>
</div>
<div class="section" id="writing-dashboards-with-flask-or-bottle">
<span id="buildbot-wsgi-dashboards"></span><h4>2.6.12. Writing Dashboards with <a class="reference external" href="http://flask.pocoo.org/">Flask</a> or <a class="reference external" href="https://bottlepy.org/docs/dev/">Bottle</a><a class="headerlink" href="#writing-dashboards-with-flask-or-bottle" title="Permalink to this headline">¶</a></h4>
<p>Buildbot Nine UI is written in Javascript.
This allows it to be reactive and real time, but comes at a price of a fair complexity.
Sometimes, you need a dashboard displaying your build results in your own manner but learning AngularJS for that is just too much.</p>
<p>There is a Buildbot plugin which allows to write a server side generated dashboard, and integrate it in the UI.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This needs buildbot and buildbot_www &gt;= 0.9.5</span>
<span class="n">pip</span> <span class="n">install</span> <span class="n">buildbot_wsgi_dashboards</span> <span class="n">flask</span>
</pre></div>
</div>
<ul>
<li><p class="first">This plugin can use any WSGI compatible web framework, <a class="reference external" href="http://flask.pocoo.org/">Flask</a> is a very common one, <a class="reference external" href="https://bottlepy.org/docs/dev/">Bottle</a> is another popular option.</p>
</li>
<li><p class="first">The application needs to implement a <code class="docutils literal notranslate"><span class="pre">/index.html</span></code> route, which will render the html code representing the dashboard.</p>
</li>
<li><p class="first">The application framework runs in a thread outside of Twisted.
No need to worry about Twisted and asynchronous code.
You can use <a class="reference external" href="http://docs.python-requests.org/en/master/">python-requests</a> or any library from the python ecosystem to access other servers.</p>
</li>
<li><p class="first">You could use HTTP in order to access Buildbot <a class="reference internal" href="#rest-api"><span class="std std-ref">REST API</span></a>, but you can also use the <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a>, via the provided synchronous wrapper.</p>
<blockquote>
<div><dl class="method">
<dt>
<code class="descname">buildbot_api.dataGet(path, filters=None, fields=None, order=None, limit=None, offset=None):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>path</strong> (<em>tuple</em>) – A tuple of path elements representing the API path to fetch.
Numbers can be passed as strings or integers.</li>
<li><strong>filters</strong> – result spec filters</li>
<li><strong>fields</strong> – result spec fields</li>
<li><strong>order</strong> – result spec order</li>
<li><strong>limit</strong> – result spec limit</li>
<li><strong>offset</strong> – result spec offset</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><a class="reference internal" href="#buildbot.data.exceptions.InvalidPathError" title="buildbot.data.exceptions.InvalidPathError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidPathError</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a resource or list, or None</p>
</td>
</tr>
</tbody>
</table>
<p>This is a blocking wrapper to master.data.get as described in <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a>.
The available paths are described in the <a class="reference internal" href="#rest-api"><span class="std std-ref">REST API</span></a>, as well as the nature of return values depending on the kind of data that is fetched.
Path can be either the REST path e.g. <code class="docutils literal notranslate"><span class="pre">&quot;builders/2/builds/4&quot;</span></code> or tuple e.g. <code class="docutils literal notranslate"><span class="pre">(&quot;builders&quot;,</span> <span class="pre">2,</span> <span class="pre">&quot;builds&quot;,</span> <span class="pre">4)</span></code>.
The latter form being more convenient if some path parts are coming from variables.
The <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a> and <a class="reference internal" href="#rest-api"><span class="std std-ref">REST API</span></a> are functionally equivalent except:</p>
<ul class="simple">
<li><a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a> does not have HTTP connection overhead.</li>
<li><a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a> does not enforce authorization rules.</li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">buildbot_api.dataGet</span></code> is accessible via the WSGI application object passed to <code class="docutils literal notranslate"><span class="pre">wsgi_dashboards</span></code> plugin (as per the example).</p>
</dd></dl>

</div></blockquote>
</li>
<li><p class="first">That html code output of the server runs inside AngularJS application.</p>
<ul class="simple">
<li>It will use the CSS of the AngularJS application (including the <a class="reference external" href="http://getbootstrap.com/css/">Bootstrap</a> CSS base).
You can use custom style-sheet with a standard <code class="docutils literal notranslate"><span class="pre">style</span></code> tag within your html.
Custom CSS will be shared with the whole Buildbot application once your dashboard is loaded.
So you should make sure your custom CSS rules only apply to your dashboard (e.g. by having a specific class for your dashboard’s main div)</li>
<li>It can use some of the AngularJS directives defined by Buildbot UI (currently only buildsummary is usable).</li>
<li>It has full access to the application JS context.</li>
</ul>
</li>
</ul>
<p>Here is an example of code that you can use in your <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code> to create a simple dashboard:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>

<span class="kn">from</span> <span class="nn">buildbot.process.results</span> <span class="kn">import</span> <span class="n">statusToString</span>

<span class="n">mydashboardapp</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">root_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="c1"># this allows to work on the template without having to restart Buildbot</span>
<span class="n">mydashboardapp</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;TEMPLATES_AUTO_RELOAD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>


<span class="nd">@mydashboardapp.route</span><span class="p">(</span><span class="s2">&quot;/index.html&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># This code fetches build data from the data api, and give it to the</span>
    <span class="c1"># template</span>
    <span class="n">builders</span> <span class="o">=</span> <span class="n">mydashboardapp</span><span class="o">.</span><span class="n">buildbot_api</span><span class="o">.</span><span class="n">dataGet</span><span class="p">(</span><span class="s2">&quot;/builders&quot;</span><span class="p">)</span>

    <span class="n">builds</span> <span class="o">=</span> <span class="n">mydashboardapp</span><span class="o">.</span><span class="n">buildbot_api</span><span class="o">.</span><span class="n">dataGet</span><span class="p">(</span><span class="s2">&quot;/builds&quot;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># properties are actually not used in the template example, but this is</span>
    <span class="c1"># how you get more properties</span>
    <span class="k">for</span> <span class="n">build</span> <span class="ow">in</span> <span class="n">builds</span><span class="p">:</span>
        <span class="n">build</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mydashboardapp</span><span class="o">.</span><span class="n">buildbot_api</span><span class="o">.</span><span class="n">dataGet</span><span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;builds&quot;</span><span class="p">,</span> <span class="n">build</span><span class="p">[</span><span class="s1">&#39;buildid&#39;</span><span class="p">],</span> <span class="s2">&quot;properties&quot;</span><span class="p">))</span>

        <span class="n">build</span><span class="p">[</span><span class="s1">&#39;results_text&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">statusToString</span><span class="p">(</span><span class="n">build</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">])</span>

    <span class="n">graph_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
    <span class="p">]</span>

    <span class="c1"># mydashboard.html is a template inside the template directory</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;mydashboard.html&#39;</span><span class="p">,</span> <span class="n">builders</span><span class="o">=</span><span class="n">builders</span><span class="p">,</span> <span class="n">builds</span><span class="o">=</span><span class="n">builds</span><span class="p">,</span>
                           <span class="n">graph_data</span><span class="o">=</span><span class="n">graph_data</span><span class="p">)</span>


<span class="c1"># Here we assume c[&#39;www&#39;][&#39;plugins&#39;] has already be created earlier.</span>
<span class="c1"># Please see the web server documentation to understand how to configure</span>
<span class="c1"># the other parts.</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;plugins&#39;</span><span class="p">][</span><span class="s1">&#39;wsgi_dashboards&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>  <span class="c1"># This is a list of dashboards, you can create several</span>
    <span class="p">{</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;mydashboard&#39;</span><span class="p">,</span>  <span class="c1"># as used in URLs</span>
        <span class="s1">&#39;caption&#39;</span><span class="p">:</span> <span class="s1">&#39;My Dashboard&#39;</span><span class="p">,</span>  <span class="c1"># Title displayed in the UI&#39;</span>
        <span class="s1">&#39;app&#39;</span><span class="p">:</span> <span class="n">mydashboardapp</span><span class="p">,</span>
        <span class="c1"># priority of the dashboard in the left menu (lower is higher in the</span>
        <span class="c1"># menu)</span>
        <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="c1"># available icon list can be found at http://fontawesome.io/icons/</span>
        <span class="s1">&#39;icon&#39;</span><span class="p">:</span> <span class="s1">&#39;area-chart&#39;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Then you need a <code class="docutils literal notranslate"><span class="pre">templates/mydashboard.html</span></code> file near your <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code>.</p>
<p>This template is a standard <a class="reference external" href="http://jinja.pocoo.org/">Jinja</a> template which is the default templating engine of <a class="reference external" href="http://flask.pocoo.org/">Flask</a>.</p>
<div class="highlight-guess notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container mydashboard&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;style&gt;</span>
    /* only modify th from this dashboard! */
    .mydashboard table th {
        font-size 24pt;
    }
    <span class="nt">&lt;/style&gt;</span>
    <span class="c">&lt;!-- Create a table of builds organised by builders in columns --&gt;</span>
    <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;table&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="c">&lt;!-- Generate the table header with name of builders --&gt;</span>
            <span class="cp">{%</span> <span class="k">for</span> <span class="nv">builder</span> <span class="k">in</span> <span class="nv">builders</span> <span class="cp">%}</span>
            <span class="nt">&lt;th&gt;</span>
                <span class="cp">{{</span><span class="nv">builder.name</span><span class="cp">}}</span>
            <span class="nt">&lt;/th&gt;</span>
            <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">build</span> <span class="k">in</span> <span class="nv">builds</span> <span class="cp">%}</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="cp">{%</span> <span class="k">for</span> <span class="nv">builder</span> <span class="k">in</span> <span class="nv">builders</span> <span class="cp">%}</span>
            <span class="nt">&lt;th&gt;</span>
                <span class="c">&lt;!-- If this build is from this builderid, then we render it in this cell --&gt;</span>
                <span class="cp">{%</span> <span class="k">if</span> <span class="nv">build.builderid</span> <span class="o">==</span> <span class="nv">builder.builderid</span> <span class="cp">%}</span>
                <span class="c">&lt;!-- for representing a build, you can choose one of those three forms --&gt;</span>
                    <span class="c">&lt;!-- 1) We use buildbot internal CSS styles display our builds, with links to the standard UI  --&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">&quot;badge-status badge results_</span><span class="cp">{{</span><span class="nv">build.results_text</span> <span class="o">|</span> <span class="nf">upper</span><span class="cp">}}</span><span class="s">&quot;</span> <span class="na">href=</span><span class="s">&quot;#/builders/</span><span class="cp">{{</span><span class="nv">build.builderid</span><span class="cp">}}</span><span class="s">/builds/</span><span class="cp">{{</span><span class="nv">build.number</span><span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                           <span class="cp">{{</span><span class="nv">build.number</span><span class="cp">}}</span>
                        <span class="nt">&lt;/a&gt;</span>
                    <span class="c">&lt;!-- 2) The buildsummary directive is very powerful and will display steps, sub-builds, logs, urls. --&gt;</span>
                       <span class="nt">&lt;buildsummary</span> <span class="na">buildid=</span><span class="s">&quot;</span><span class="cp">{{</span><span class="nv">build.buildid</span><span class="cp">}}</span><span class="s">&quot;</span> <span class="na">condensed=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
                    <span class="c">&lt;!-- 3) If you need something lighter, there is the build sticker directive --&gt;</span>
                       <span class="nt">&lt;buildsticker</span> <span class="na">buildid=</span><span class="s">&quot;</span><span class="cp">{{</span><span class="nv">build.buildid</span><span class="cp">}}</span><span class="s">&quot;</span><span class="nt">/&gt;</span>
                    <span class="c">&lt;!-- Note that those two directives will make additional HTTP requests from the browser in order to fetch the necessary data they need to be rendered. --&gt;</span>

               <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
            <span class="nt">&lt;/th&gt;</span>
            <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
        <span class="nt">&lt;/tr&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/table&gt;</span>
    <span class="c">&lt;!-- Example of line chart using Chart.js --&gt;</span>
    <span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;myChart&quot;</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;400&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
        <span class="nt">&lt;script&gt;</span>
        // We use Chart.js for rendering a chart, we first have to download it from internet
        // (will be cached by the browser)
        $.getScript(&quot;https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.bundle.min.js&quot;,
        // See http://www.chartjs.org/docs/ for more details
        function createChart() {
            var scatterChart = new Chart(&quot;myChart&quot;, {
            type: &#39;line&#39;,
            data: {
                datasets: [{
                    label: &#39;Github statistics&#39;,
                    // Here the data from the python is passed to the javascript via tojson and safe jinja filters
                    // http://flask.pocoo.org/docs/0.12/templating/#standard-filters
                    data: <span class="cp">{{</span><span class="nv">graph_data</span> <span class="o">|</span> <span class="nf">tojson</span> <span class="o">|</span><span class="nf">safe</span> <span class="cp">}}</span>
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        type: &#39;linear&#39;,
                        position: &#39;bottom&#39;
                    }]
                }
            }
        });
    });
    <span class="nt">&lt;/script&gt;</span>

<span class="nt">&lt;/div&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="a-somewhat-whimsical-example-or-it-s-now-customized-how-do-i-deploy-it">
<h4><a class="toc-backref" href="#id42">2.6.13. A Somewhat Whimsical Example (or “It’s now customized, how do I deploy it?”)</a><a class="headerlink" href="#a-somewhat-whimsical-example-or-it-s-now-customized-how-do-i-deploy-it" title="Permalink to this headline">¶</a></h4>
<p>Let’s say that we’ve got some snazzy new unit-test framework called Framboozle.
It’s the hottest thing since sliced bread.
It slices, it dices, it runs unit tests like there’s no tomorrow.
Plus if your unit tests fail, you can use its name for a Web 2.1 startup company, make millions of dollars, and hire engineers to fix the bugs for you, while you spend your afternoons lazily hang-gliding along a scenic pacific beach, blissfully unconcerned about the state of your tests.
<a class="footnote-reference" href="#framboozle-reg" id="id11">[1]</a></p>
<p>To run a Framboozle-enabled test suite, you just run the ‘framboozler’ command from the top of your source code tree.
The ‘framboozler’ command emits a bunch of stuff to stdout, but the most interesting bit is that it emits the line “FNURRRGH!” every time it finishes running a test case You’d like to have a test-case counting LogObserver that watches for these lines and counts them, because counting them will help the buildbot more accurately calculate how long the build will take, and this will let you know exactly how long you can sneak out of the office for your hang-gliding lessons without anyone noticing that you’re gone.</p>
<p>This will involve writing a new <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> (probably named “Framboozle”) which inherits from <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> class definition itself will look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="k">class</span> <span class="nc">FNURRRGHCounter</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">LogLineObserver</span><span class="p">):</span>
    <span class="n">numTests</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">outLineReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;FNURRRGH!&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numTests</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numTests</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Framboozle</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;framboozler&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>   <span class="c1"># always upcall!</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="n">FNURRRGHCounter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addLogObserver</span><span class="p">(</span><span class="s1">&#39;stdio&#39;</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressMetrics</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39;tests&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<p>So that’s the code that we want to wind up using.
How do we actually deploy it?</p>
<p>You have a number of different options:</p>
<div class="contents local topic" id="id12">
<ul class="simple">
<li><a class="reference internal" href="#inclusion-in-the-master-cfg-file" id="id49">Inclusion in the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file</a></li>
<li><a class="reference internal" href="#python-file-somewhere-on-the-system" id="id50">Python file somewhere on the system</a></li>
<li><a class="reference internal" href="#install-this-code-into-a-standard-python-library-directory" id="id51">Install this code into a standard Python library directory</a></li>
<li><a class="reference internal" href="#distribute-a-buildbot-plug-in" id="id52">Distribute a Buildbot Plug-In</a></li>
<li><a class="reference internal" href="#submit-the-code-for-inclusion-in-the-buildbot-distribution" id="id53">Submit the code for inclusion in the Buildbot distribution</a></li>
<li><a class="reference internal" href="#summary" id="id54">Summary</a></li>
</ul>
</div>
<div class="section" id="inclusion-in-the-master-cfg-file">
<h5><a class="toc-backref" href="#id49">2.6.13.1. Inclusion in the <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file</a><a class="headerlink" href="#inclusion-in-the-master-cfg-file" title="Permalink to this headline">¶</a></h5>
<p>The simplest technique is to simply put the step class definitions in your <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file, somewhere before the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> definition where you actually use it in a clause like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;stuff&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Framboozle</span><span class="p">())</span>
</pre></div>
</div>
<p>Remember that <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> is secretly just a Python program with one job: populating the <code class="xref py py-data docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code> dictionary.
And Python programs are allowed to define as many classes as they like.
So you can define classes and use them in the same file, just as long as the class is defined before some other code tries to use it.</p>
<p>This is easy, and it keeps the point of definition very close to the point of use, and whoever replaces you after that unfortunate hang-gliding accident will appreciate being able to easily figure out what the heck this stupid “Framboozle” step is doing anyways.
The downside is that every time you reload the config file, the Framboozle class will get redefined, which means that the buildmaster will think that you’ve reconfigured all the Builders that use it, even though nothing changed.
Bleh.</p>
</div>
<div class="section" id="python-file-somewhere-on-the-system">
<h5><a class="toc-backref" href="#id50">2.6.13.2. Python file somewhere on the system</a><a class="headerlink" href="#python-file-somewhere-on-the-system" title="Permalink to this headline">¶</a></h5>
<p>Instead, we can put this code in a separate file, and import it into the master.cfg file just like we would the normal buildsteps like <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> and <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a>.</p>
<p>Create a directory named <code class="file docutils literal notranslate"><span class="pre">~/lib/python</span></code>, put the step class definitions in <code class="file docutils literal notranslate"><span class="pre">~/lib/python/framboozle.py</span></code>, and run your buildmaster using:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">PYTHONPATH</span><span class="o">=</span>~/lib/python buildbot start MASTERDIR
</pre></div>
</div>
<p>or use the <code class="file docutils literal notranslate"><span class="pre">Makefile.buildbot</span></code> to control the way <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">start</span></code> works.
Or add something like this to something like your <code class="file docutils literal notranslate"><span class="pre">~/.bashrc</span></code> or <code class="file docutils literal notranslate"><span class="pre">~/.bash_profile</span></code> or <code class="file docutils literal notranslate"><span class="pre">~/.cshrc</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span>~/lib/python
</pre></div>
</div>
<p>Once we’ve done this, our <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> can look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">framboozle</span> <span class="k">import</span> <span class="n">Framboozle</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;stuff&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Framboozle</span><span class="p">())</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">framboozle</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;stuff&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">framboozle</span><span class="o">.</span><span class="n">Framboozle</span><span class="p">())</span>
</pre></div>
</div>
<p>(check out the Python docs for details about how <code class="docutils literal notranslate"><span class="pre">import</span></code> and <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">A</span> <span class="pre">import</span> <span class="pre">B</span></code> work).</p>
<p>What we’ve done here is to tell Python that every time it handles an “import” statement for some named module, it should look in our <code class="file docutils literal notranslate"><span class="pre">~/lib/python/</span></code> for that module before it looks anywhere else.
After our directories, it will try in a bunch of standard directories too (including the one where buildbot is installed).
By setting the <span class="target" id="index-6"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> environment variable, you can add directories to the front of this search list.</p>
<p>Python knows that once it “import”s a file, it doesn’t need to re-import it again.
This means that reconfiguring the buildmaster (with <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">reconfig</span></code>, for example) won’t make it think the Framboozle class has changed every time, so the Builders that use it will not be spuriously restarted.
On the other hand, you either have to start your buildmaster in a slightly weird way, or you have to modify your environment to set the <span class="target" id="index-7"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> variable.</p>
</div>
<div class="section" id="install-this-code-into-a-standard-python-library-directory">
<h5><a class="toc-backref" href="#id51">2.6.13.3. Install this code into a standard Python library directory</a><a class="headerlink" href="#install-this-code-into-a-standard-python-library-directory" title="Permalink to this headline">¶</a></h5>
<p>Find out what your Python’s standard include path is by asking it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>80:warner@luther% python
Python 2.4.4c0 (#2, Oct  2 2006, 00:57:46)
[GCC 4.1.2 20060928 (prerelease) (Debian 4.1.1-15)] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import sys
&gt;&gt;&gt; import pprint
&gt;&gt;&gt; pprint.pprint(sys.path)
[&#39;&#39;,
 &#39;/usr/lib/python24.zip&#39;,
 &#39;/usr/lib/python2.4&#39;,
 &#39;/usr/lib/python2.4/plat-linux2&#39;,
 &#39;/usr/lib/python2.4/lib-tk&#39;,
 &#39;/usr/lib/python2.4/lib-dynload&#39;,
 &#39;/usr/local/lib/python2.4/site-packages&#39;,
 &#39;/usr/lib/python2.4/site-packages&#39;,
 &#39;/usr/lib/python2.4/site-packages/Numeric&#39;,
 &#39;/var/lib/python-support/python2.4&#39;,
 &#39;/usr/lib/site-python&#39;]
</pre></div>
</div>
<p>In this case, putting the code into <code class="file docutils literal notranslate"><span class="pre">/usr/local/lib/python2.4/site-packages/framboozle.py</span></code> would work just fine.
We can use the same <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">framboozle</span></code> statement as in Option 2.
By putting it in a standard include directory (instead of the decidedly non-standard <code class="file docutils literal notranslate"><span class="pre">~/lib/python</span></code>), we don’t even have to set <span class="target" id="index-8"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> to anything special.
The downside is that you probably have to be root to write to one of those standard include directories.</p>
</div>
<div class="section" id="distribute-a-buildbot-plug-in">
<span id="plugin-module"></span><h5><a class="toc-backref" href="#id52">2.6.13.4. Distribute a Buildbot Plug-In</a><a class="headerlink" href="#distribute-a-buildbot-plug-in" title="Permalink to this headline">¶</a></h5>
<p>First of all, you must prepare a Python package (if you do not know what that is, please check <a class="reference internal" href="#document-developer/plugins-publish"><span class="doc">How to package Buildbot plugins</span></a>, where you can find a couple of pointers to tutorials).</p>
<p>When you have a package, you will have a special file called <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code>.
This file needs to be updated to include a pointer to your new step:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="n">entry_points</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s1">&#39;buildbot.steps&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;Framboozle = framboozle:Framboozle&#39;</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Where:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.steps</span></code> is the kind of plugin you offer (more information about possible kinds you can find in <a class="reference internal" href="#document-developer/plugins-publish"><span class="doc">How to package Buildbot plugins</span></a>)</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">framboozle:Framboozle</span></code> consists of two parts: <code class="docutils literal notranslate"><span class="pre">framboozle</span></code> is the name of the Python module where to look for <code class="docutils literal notranslate"><span class="pre">Framboozle</span></code> class, which implements the plugin</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">Framboozle</span></code> is the name of the plugin.</p>
<p>This will allow users of your plugin to use it just like any other Buildbot plugins:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span>

<span class="o">...</span> <span class="n">steps</span><span class="o">.</span><span class="n">Framboozle</span> <span class="o">...</span>
</pre></div>
</div>
</li>
</ul>
<p>Now you can upload it to <a class="reference external" href="http://pypi.python.org/">PyPI</a> where other people can download it from and use in their build systems.
Once again, the information about how to prepare and upload a package to <a class="reference external" href="http://pypi.python.org/">PyPI</a> can be found in tutorials listed in <a class="reference internal" href="#document-developer/plugins-publish"><span class="doc">How to package Buildbot plugins</span></a>.</p>
</div>
<div class="section" id="submit-the-code-for-inclusion-in-the-buildbot-distribution">
<h5><a class="toc-backref" href="#id53">2.6.13.5. Submit the code for inclusion in the Buildbot distribution</a><a class="headerlink" href="#submit-the-code-for-inclusion-in-the-buildbot-distribution" title="Permalink to this headline">¶</a></h5>
<p>Make a fork of buildbot on <a class="reference external" href="http://github.com/buildbot/buildbot">http://github.com/buildbot/buildbot</a> or post a patch in a bug at <a class="reference external" href="http://trac.buildbot.net/">http://trac.buildbot.net/</a>.
In either case, post a note about your patch to the mailing list, so others can provide feedback and, eventually, commit it.</p>
<p>When it’s committed to the master, the usage is the same as in the previous approach:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="o">...</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;stuff&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">Framboozle</span><span class="p">())</span>
<span class="o">...</span>
</pre></div>
</div>
<p>And then you don’t even have to install <code class="file docutils literal notranslate"><span class="pre">framboozle.py</span></code> anywhere on your system, since it will ship with Buildbot.
You don’t have to be root, you don’t have to set <span class="target" id="index-9"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>.
But you do have to make a good case for Framboozle being worth going into the main distribution, you’ll probably have to provide docs and some unit test cases, you’ll need to figure out what kind of beer the author likes (IPA’s and Stouts for Dustin), and then you’ll have to wait until the next release.
But in some environments, all this is easier than getting root on your buildmaster box, so the tradeoffs may actually be worth it.</p>
</div>
<div class="section" id="summary">
<h5><a class="toc-backref" href="#id54">2.6.13.6. Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h5>
<p>Putting the code in master.cfg (1) makes it available to that buildmaster instance.
Putting it in a file in a personal library directory (2) makes it available for any buildmasters you might be running.
Putting it in a file in a system-wide shared library directory (3) makes it available for any buildmasters that anyone on that system might be running.
Getting it into the buildbot’s upstream repository (4) makes it available for any buildmasters that anyone in the world might be running.
It’s all a matter of how widely you want to deploy that new class.</p>
<table class="docutils footnote" frame="void" id="framboozle-reg" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[1]</a></td><td>framboozle.com is still available.
Remember, I get 10% :).</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<span id="document-manual/cmdline"></span><div class="section" id="command-line-tool">
<span id="id1"></span><h3>2.7. Command-line Tool<a class="headerlink" href="#command-line-tool" title="Permalink to this headline">¶</a></h3>
<p>This section describes command-line tools available after buildbot installation.
Since version 0.8 the one-for-all <strong class="command">buildbot</strong> command-line tool was divided into two parts namely <strong class="command">buildbot</strong> and <strong class="command">buildslave</strong>, starting from version 0.9 <strong class="command">buildslave</strong> command was replaced with <strong class="command">buildbot-worker</strong> command.
The last one was separated from main command-line tool to minimize dependencies required for running a worker while leaving all other functions to <strong class="command">buildbot</strong> tool.</p>
<p>Every command-line tool has a list of global options and a set of commands which have their own options.
One can run these tools in the following way:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot [global options] command [command options]
buildbot-worker [global options] command [command options]
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> command is used on the master, while <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> is used on the worker.
Global options are the same for both tools which perform the following actions:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--help</span></kbd></td>
<td>Print general help about available commands and global options and exit.
All subsequent arguments are ignored.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--verbose</span></kbd></td>
<td>Set verbose output.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--version</span></kbd></td>
<td>Print current buildbot version and exit. All subsequent arguments are
ignored.</td></tr>
</tbody>
</table>
<p>You can get help on any command by specifying <code class="docutils literal notranslate"><span class="pre">--help</span></code> as a command option:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot command --help
</pre></div>
</div>
<p>You can also use manual pages for <strong class="command">buildbot</strong> and <strong class="command">buildbot-worker</strong> for quick reference on command-line options.</p>
<p>The remainder of this section describes each buildbot command.
See <a class="reference internal" href="bb-cmdline.html" title="Command Line Index"><em>Command Line Index</em></a> for a full list.</p>
<div class="section" id="buildbot">
<h4>2.7.1. buildbot<a class="headerlink" href="#buildbot" title="Permalink to this headline">¶</a></h4>
<p>The <strong class="command">buildbot</strong> command-line tool can be used to start or stop a buildmaster or buildbot, and to interact with a running buildmaster.
Some of its subcommands are intended for buildmaster admins, while some are for developers who are editing the code that the buildbot is monitoring.</p>
<div class="section" id="administrator-tools">
<h5>2.7.1.1. Administrator Tools<a class="headerlink" href="#administrator-tools" title="Permalink to this headline">¶</a></h5>
<p>The following <strong class="command">buildbot</strong> sub-commands are intended for buildmaster administrators:</p>
<div class="section" id="create-master">
<span id="cmdline-create-master"></span><h6>create-master<a class="headerlink" href="#create-master" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot create-master -r {BASEDIR}
</pre></div>
</div>
<p>This creates a new directory and populates it with files that allow it to be used as a buildmaster’s base directory.</p>
<p>You will usually want to use the option <cite>-r</cite> option to create a relocatable <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>.
This allows you to move the master directory without editing this file.</p>
</div>
<div class="section" id="upgrade-master">
<span id="cmdline-upgrade-master"></span><h6>upgrade-master<a class="headerlink" href="#upgrade-master" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot upgrade-master {BASEDIR}
</pre></div>
</div>
<p>This upgrades a previously created buildmaster’s base directory for a new version of buildbot master source code.
This will copy the web server static files, and potentially upgrade the db.</p>
</div>
<div class="section" id="start">
<span id="cmdline-start (buildbot)"></span><h6>start<a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot start [--nodaemon] {BASEDIR}
</pre></div>
</div>
<p>This starts a buildmaster which was already created in the given base directory.
The daemon is launched in the background, with events logged to a file named <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code>.</p>
<p>The option <cite>–nodaemon</cite> option instructs Buildbot to skip daemonizing.
The process will start in the foreground.
It will only return to the command-line when it is stopped.</p>
</div>
<div class="section" id="restart">
<span id="cmdline-restart (buildbot)"></span><h6>restart<a class="headerlink" href="#restart" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot restart [--nodaemon] {BASEDIR}
</pre></div>
</div>
<p>Restart the buildmaster.
This is equivalent to <code class="docutils literal notranslate"><span class="pre">stop</span></code> followed by <code class="docutils literal notranslate"><span class="pre">start</span></code>
The option <cite>–nodaemon</cite> option has the same meaning as for <code class="docutils literal notranslate"><span class="pre">start</span></code>.</p>
</div>
<div class="section" id="stop">
<span id="cmdline-stop (buildbot)"></span><h6>stop<a class="headerlink" href="#stop" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot stop {BASEDIR}
</pre></div>
</div>
<p>This terminates the daemon (either buildmaster or worker) running in the given directory.
The <code class="docutils literal notranslate"><span class="pre">--clean</span></code> option shuts down the buildmaster cleanly.
With <code class="docutils literal notranslate"><span class="pre">--no-wait</span></code> option <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">stop</span></code> command will send buildmaster shutdown signal and will immediately exit, not waiting for complete buildmaster shutdown.</p>
</div>
<div class="section" id="sighup">
<span id="cmdline-sighup"></span><h6>sighup<a class="headerlink" href="#sighup" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot sighup {BASEDIR}
</pre></div>
</div>
<p>This sends a SIGHUP to the buildmaster running in the given directory, which causes it to re-read its <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> file.</p>
</div>
<div class="section" id="checkconfig">
<span id="cmdline-checkconfig"></span><h6>checkconfig<a class="headerlink" href="#checkconfig" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot checkconfig {BASEDIR|CONFIG_FILE}
</pre></div>
</div>
<p>This checks if the buildmaster configuration is well-formed and contains no deprecated or invalid elements.
If no arguments are used or the base directory is passed as the argument the config file specified in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> is checked.
If the argument is the path to a config file then it will be checked without using the <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file.</p>
</div>
<div class="section" id="cleanupdb">
<span id="cmdline-cleanupdb"></span><h6>cleanupdb<a class="headerlink" href="#cleanupdb" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot cleanupdb {BASEDIR|CONFIG_FILE} [-q]
</pre></div>
</div>
<p>This command is frontend for various database maintenance jobs:</p>
<ul class="simple">
<li>optimiselogs: This optimization groups logs into bigger chunks
to apply higher level of compression.</li>
</ul>
</div>
</div>
<div class="section" id="developer-tools">
<h5>2.7.1.2. Developer Tools<a class="headerlink" href="#developer-tools" title="Permalink to this headline">¶</a></h5>
<p>These tools are provided for use by the developers who are working on
the code that the buildbot is monitoring.</p>
<div class="section" id="try">
<span id="cmdline-try"></span><h6>try<a class="headerlink" href="#try" title="Permalink to this headline">¶</a></h6>
<p>This lets a developer to ask the question <code class="docutils literal notranslate"><span class="pre">What</span> <span class="pre">would</span> <span class="pre">happen</span> <span class="pre">if</span> <span class="pre">I</span> <span class="pre">committed</span> <span class="pre">this</span> <span class="pre">patch</span> <span class="pre">right</span> <span class="pre">now?</span></code>.
It runs the unit test suite (across multiple build platforms) on the developer’s current code, allowing them to make sure they will not break the tree when they finally commit their changes.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">try</span></code> command is meant to be run from within a developer’s local tree, and starts by figuring out the base revision of that tree (what revision was current the last time the tree was updated), and a patch that can be applied to that revision of the tree to make it match the developer’s copy.
This <code class="docutils literal notranslate"><span class="pre">(revision,</span> <span class="pre">patch)</span></code> pair is then sent to the buildmaster, which runs a build with that <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code>.
If you want, the tool will emit status messages as the builds run, and will not terminate until the first failure has been detected (or the last success).</p>
<p>There is an alternate form which accepts a pre-made patch file (typically the output of a command like <strong class="command">svn diff</strong>).
This <code class="docutils literal notranslate"><span class="pre">--diff</span></code> form does not require a local tree to run from.
See <a class="reference internal" href="#try-diff"><span class="std std-ref">try –diff</span></a> concerning the <code class="docutils literal notranslate"><span class="pre">--diff</span></code> command option.</p>
<p>For this command to work, several pieces must be in place: the <a class="reference internal" href="#sched-Try_Jobdir" title="Try_Jobdir"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Try_Jobdir</span></code></a> or :<a class="reference internal" href="#sched-Try_Userpass" title="Try_Userpass"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Try_Userpass</span></code></a>, as well as some client-side configuration.</p>
<div class="section" id="locating-the-master">
<h7>Locating the master<a class="headerlink" href="#locating-the-master" title="Permalink to this headline">¶</a></h7>
<p>The <strong class="command">try</strong> command needs to be told how to connect to the try scheduler, and must know which of the authentication approaches described above is in use by the buildmaster.
You specify the approach by using <code class="docutils literal notranslate"><span class="pre">--connect=ssh</span></code> or <code class="docutils literal notranslate"><span class="pre">--connect=pb</span></code> (or <code class="docutils literal notranslate"><span class="pre">try_connect</span> <span class="pre">=</span> <span class="pre">'ssh'</span></code> or <code class="docutils literal notranslate"><span class="pre">try_connect</span> <span class="pre">=</span> <span class="pre">'pb'</span></code> in <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code>).</p>
<p>For the PB approach, the command must be given a option <cite>–master</cite> argument (in the form <code class="samp docutils literal notranslate"><em><span class="pre">HOST</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em></code>) that points to TCP port that you picked in the <code class="xref py py-class docutils literal notranslate"><span class="pre">Try_Userpass</span></code> scheduler.
It also takes a option <cite>–username</cite> and option <cite>–passwd</cite> pair of arguments that match one of the entries in the buildmaster’s <code class="docutils literal notranslate"><span class="pre">userpass</span></code> list.
These arguments can also be provided as <code class="docutils literal notranslate"><span class="pre">try_master</span></code>, <code class="docutils literal notranslate"><span class="pre">try_username</span></code>, and <code class="docutils literal notranslate"><span class="pre">try_password</span></code> entries in the <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code> file.</p>
<p>For the SSH approach, the command must be given option <cite>–host</cite> and option <cite>–username</cite>, to get to the buildmaster host.
It must also be given option <cite>–jobdir</cite>, which points to the inlet directory configured above.
The jobdir can be relative to the user’s home directory, but most of the time you will use an explicit path like <code class="file docutils literal notranslate"><span class="pre">~buildbot/project/trydir</span></code>.
These arguments can be provided in <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code> as <code class="docutils literal notranslate"><span class="pre">try_host</span></code>, <code class="docutils literal notranslate"><span class="pre">try_username</span></code>, <code class="docutils literal notranslate"><span class="pre">try_password</span></code>, and <code class="docutils literal notranslate"><span class="pre">try_jobdir</span></code>.</p>
<p>If you need to use something different from the default <code class="docutils literal notranslate"><span class="pre">ssh</span></code> command for
connecting to the remote system, you can use <cite>–ssh</cite> command line option or
<code class="docutils literal notranslate"><span class="pre">try_ssh</span></code> in the configuration file.</p>
<p>The SSH approach also provides a option <cite>–buildbotbin</cite> argument to allow specification of the buildbot binary to run on the buildmaster.
This is useful in the case where buildbot is installed in a <a class="reference internal" href="#installation-in-a-virtualenv"><span class="std std-ref">virtualenv</span></a> on the buildmaster host, or in other circumstances where the buildbot command is not on the path of the user given by option <cite>–username</cite>.
The option <cite>–buildbotbin</cite> argument can be provided in <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code> as <code class="docutils literal notranslate"><span class="pre">try_buildbotbin</span></code></p>
<p>The following command line arguments are deprecated, but retained for backward compatibility:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--tryhost</span></kbd></td>
<td>is replaced by option <cite>–host</cite></td></tr>
<tr><td class="option-group">
<kbd><span class="option">--trydir</span></kbd></td>
<td>is replaced by option <cite>–jobdir</cite></td></tr>
<tr><td class="option-group">
<kbd><span class="option">--master</span></kbd></td>
<td>is replaced by option <cite>–masterstatus</cite></td></tr>
</tbody>
</table>
<p>Likewise, the following <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code> file entries are deprecated, but retained for backward compatibility:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">try_dir</span></code> is replaced by <code class="docutils literal notranslate"><span class="pre">try_jobdir</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">masterstatus</span></code> is replaced by <code class="docutils literal notranslate"><span class="pre">try_masterstatus</span></code></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="waiting-for-results">
<h7>Waiting for results<a class="headerlink" href="#waiting-for-results" title="Permalink to this headline">¶</a></h7>
<p>If you provide the option <cite>–wait</cite> option (or <code class="docutils literal notranslate"><span class="pre">try_wait</span> <span class="pre">=</span> <span class="pre">True</span></code> in <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code>), the <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">try</span></code> command will wait until your changes have either been proven good or bad before exiting.
Unless you use the option <cite>–quiet</cite> option (or <code class="docutils literal notranslate"><span class="pre">try_quiet=True</span></code>), it will emit a progress message every 60 seconds until the builds have completed.</p>
<p>The SSH connection method does not support waiting for results.</p>
</div>
<div class="section" id="choosing-the-builders">
<h7>Choosing the Builders<a class="headerlink" href="#choosing-the-builders" title="Permalink to this headline">¶</a></h7>
<p>A trial build is performed on multiple Builders at the same time, and the developer gets to choose which Builders are used (limited to a set selected by the buildmaster admin with the <code class="xref py py-class docutils literal notranslate"><span class="pre">TryScheduler</span></code>’s <code class="docutils literal notranslate"><span class="pre">builderNames=</span></code> argument).
The set you choose will depend upon what your goals are: if you are concerned about cross-platform compatibility, you should use multiple Builders, one from each platform of interest.
You might use just one builder if that platform has libraries or other facilities that allow better test coverage than what you can accomplish on your own machine, or faster test runs.</p>
<p>The set of Builders to use can be specified with multiple option <cite>–builder</cite> arguments on the command line.
It can also be specified with a single <code class="docutils literal notranslate"><span class="pre">try_builders</span></code> option in <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code> that uses a list of strings to specify all the Builder names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">try_builders</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;full-OSX&quot;</span><span class="p">,</span> <span class="s2">&quot;full-win32&quot;</span><span class="p">,</span> <span class="s2">&quot;full-linux&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>If you are using the PB approach, you can get the names of the builders that are configured for the try scheduler using the <code class="docutils literal notranslate"><span class="pre">get-builder-names</span></code> argument:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>buildbot try --get-builder-names --connect<span class="o">=</span>pb --master<span class="o">=</span>... --username<span class="o">=</span>... --passwd<span class="o">=</span>...
</pre></div>
</div>
</div>
<div class="section" id="specifying-the-vc-system">
<h7>Specifying the VC system<a class="headerlink" href="#specifying-the-vc-system" title="Permalink to this headline">¶</a></h7>
<p>The <strong class="command">try</strong> command also needs to know how to take the developer’s current tree and extract the (revision, patch) source-stamp pair.
Each VC system uses a different process, so you start by telling the <strong class="command">try</strong> command which VC system you are using, with an argument like option <cite>–vc=cvs</cite> or option <cite>–vc=git</cite>.
This can also be provided as <code class="docutils literal notranslate"><span class="pre">try_vc</span></code> in <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code>.</p>
<p>The following names are recognized: <code class="docutils literal notranslate"><span class="pre">bzr</span></code> <code class="docutils literal notranslate"><span class="pre">cvs</span></code> <code class="docutils literal notranslate"><span class="pre">darcs</span></code> <code class="docutils literal notranslate"><span class="pre">hg</span></code> <code class="docutils literal notranslate"><span class="pre">git</span></code> <code class="docutils literal notranslate"><span class="pre">mtn</span></code> <code class="docutils literal notranslate"><span class="pre">p4</span></code> <code class="docutils literal notranslate"><span class="pre">svn</span></code></p>
</div>
<div class="section" id="finding-the-top-of-the-tree">
<h7>Finding the top of the tree<a class="headerlink" href="#finding-the-top-of-the-tree" title="Permalink to this headline">¶</a></h7>
<p>Some VC systems (notably CVS and SVN) track each directory more-or-less independently, which means the <strong class="command">try</strong> command needs to move up to the top of the project tree before it will be able to construct a proper full-tree patch.
To accomplish this, the <strong class="command">try</strong> command will crawl up through the parent directories until it finds a marker file.
The default name for this marker file is <code class="file docutils literal notranslate"><span class="pre">.buildbot-top</span></code>, so when you are using CVS or SVN you should <code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">.buildbot-top</span></code> from the top of your tree before running <strong class="command">buildbot try</strong>.
Alternatively, you can use a filename like <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> or <code class="file docutils literal notranslate"><span class="pre">README</span></code>, since many projects put one of these files in their top-most directory (and nowhere else).
To set this filename, use <code class="docutils literal notranslate"><span class="pre">--topfile=ChangeLog</span></code>, or set it in the options file with <code class="docutils literal notranslate"><span class="pre">try_topfile</span> <span class="pre">=</span> <span class="pre">'ChangeLog'</span></code>.</p>
<p>You can also manually set the top of the tree with <code class="docutils literal notranslate"><span class="pre">--topdir=~/trees/mytree</span></code>, or <code class="docutils literal notranslate"><span class="pre">try_topdir</span> <span class="pre">=</span> <span class="pre">'~/trees/mytree'</span></code>.
If you use <code class="docutils literal notranslate"><span class="pre">try_topdir</span></code>, in a <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code> file, you will need a separate options file for each tree you use, so it may be more convenient to use the <code class="docutils literal notranslate"><span class="pre">try_topfile</span></code> approach instead.</p>
<p>Other VC systems which work on full projects instead of individual directories (Darcs, Mercurial, Git, Monotone) do not require <strong class="command">try</strong> to know the top directory, so the option <cite>–try-topfile</cite> and option <cite>–try-topdir</cite> arguments will be ignored.</p>
<p>If the <strong class="command">try</strong> command cannot find the top directory, it will abort with an error message.</p>
<p>The following command line arguments are deprecated, but retained for backward compatibility:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">--try-topdir</span></code> is replaced by option <cite>–topdir</cite></li>
<li><code class="docutils literal notranslate"><span class="pre">--try-topfile</span></code> is replaced by option <cite>–topfile</cite></li>
</ul>
</div>
<div class="section" id="determining-the-branch-name">
<h7>Determining the branch name<a class="headerlink" href="#determining-the-branch-name" title="Permalink to this headline">¶</a></h7>
<p>Some VC systems record the branch information in a way that <code class="docutils literal notranslate"><span class="pre">try</span></code> can locate it.
For the others, if you are using something other than the default branch, you will have to tell the buildbot which branch your tree is using.
You can do this with either the option <cite>–branch</cite> argument, or a <code class="docutils literal notranslate"><span class="pre">try_branch</span></code> entry in the <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code> file.</p>
</div>
<div class="section" id="determining-the-revision-and-patch">
<h7>Determining the revision and patch<a class="headerlink" href="#determining-the-revision-and-patch" title="Permalink to this headline">¶</a></h7>
<p>Each VC system has a separate approach for determining the tree’s base revision and computing a patch.</p>
<dl class="docutils">
<dt>CVS</dt>
<dd><strong class="command">try</strong> pretends that the tree is up to date.
It converts the current time into a option <cite>-D</cite> time specification, uses it as the base revision, and computes the diff between the upstream tree as of that point in time versus the current contents.
This works, more or less, but requires that the local clock be in reasonably good sync with the repository.</dd>
<dt>SVN</dt>
<dd><strong class="command">try</strong> does a <strong class="command">svn status -u</strong> to find the latest repository revision number (emitted on the last line in the <code class="samp docutils literal notranslate"><span class="pre">Status</span> <span class="pre">against</span> <span class="pre">revision:</span> <em><span class="pre">NN</span></em></code> message).
It then performs an <code class="samp docutils literal notranslate"><span class="pre">svn</span> <span class="pre">diff</span> <span class="pre">-r</span><em><span class="pre">NN</span></em></code> to find out how your tree differs from the repository version, and sends the resulting patch to the buildmaster.
If your tree is not up to date, this will result in the <code class="docutils literal notranslate"><span class="pre">try</span></code> tree being created with the latest revision, then <em>backwards</em> patches applied to bring it <code class="docutils literal notranslate"><span class="pre">back</span></code> to the version you actually checked out (plus your actual code changes), but this will still result in the correct tree being used for the build.</dd>
<dt>bzr</dt>
<dd><strong class="command">try</strong> does a <code class="docutils literal notranslate"><span class="pre">bzr</span> <span class="pre">revision-info</span></code> to find the base revision, then a <code class="docutils literal notranslate"><span class="pre">bzr</span> <span class="pre">diff</span> <span class="pre">-r$base..</span></code> to obtain the patch.</dd>
<dt>Mercurial</dt>
<dd><code class="docutils literal notranslate"><span class="pre">hg</span> <span class="pre">parents</span> <span class="pre">--template</span> <span class="pre">'{node}\n'</span></code> emits the full revision id (as opposed to the common 12-char truncated) which is a SHA1 hash of the current revision’s contents.
This is used as the base revision.
<code class="docutils literal notranslate"><span class="pre">hg</span> <span class="pre">diff</span></code> then provides the patch relative to that revision.
For <strong class="command">try</strong> to work, your working directory must only have patches that are available from the same remotely-available repository that the build process’ <code class="docutils literal notranslate"><span class="pre">source.Mercurial</span></code> will use.</dd>
<dt>Perforce</dt>
<dd><strong class="command">try</strong> does a <code class="docutils literal notranslate"><span class="pre">p4</span> <span class="pre">changes</span> <span class="pre">-m1</span> <span class="pre">...</span></code> to determine the latest changelist and implicitly assumes that the local tree is synced to this revision.
This is followed by a <code class="docutils literal notranslate"><span class="pre">p4</span> <span class="pre">diff</span> <span class="pre">-du</span></code> to obtain the patch.
A p4 patch differs slightly from a normal diff.
It contains full depot paths and must be converted to paths relative to the branch top.
To convert the following restriction is imposed.
The p4base (see <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a>) is assumed to be <code class="docutils literal notranslate"><span class="pre">//depot</span></code></dd>
<dt>Darcs</dt>
<dd><strong class="command">try</strong> does a <code class="docutils literal notranslate"><span class="pre">darcs</span> <span class="pre">changes</span> <span class="pre">--context</span></code> to find the list of all patches back to and including the last tag that was made.
This text file (plus the location of a repository that contains all these patches) is sufficient to re-create the tree.
Therefore the contents of this <code class="docutils literal notranslate"><span class="pre">context</span></code> file <em>are</em> the revision stamp for a Darcs-controlled source tree.
It then does a <code class="docutils literal notranslate"><span class="pre">darcs</span> <span class="pre">diff</span> <span class="pre">-u</span></code> to compute the patch relative to that revision.</dd>
<dt>Git</dt>
<dd><code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">branch</span> <span class="pre">-v</span></code> lists all the branches available in the local repository along with the revision ID it points to and a short summary of the last commit.
The line containing the currently checked out branch begins with “*&nbsp;” (star and space) while all the others start with “&nbsp;&nbsp;” (two spaces).
<strong class="command">try</strong> scans for this line and extracts the branch name and revision from it.
Then it generates a diff against the base revision.</dd>
</dl>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">I’m not sure if this actually works the way it’s intended since the extracted base revision might not actually exist in the upstream repository.
Perhaps we need to add a –remote option to specify the remote tracking branch to generate a diff against.</p>
</div>
<dl class="docutils">
<dt>Monotone</dt>
<dd><strong class="command">mtn automate get_base_revision_id</strong> emits the full revision id which is a SHA1 hash of the current revision’s contents.
This is used as the base revision.
<strong class="command">mtn diff</strong> then provides the patch relative to that revision.
For <strong class="command">try</strong> to work, your working directory must only have patches that are available from the same remotely-available repository that the build process’ <code class="xref py py-class docutils literal notranslate"><span class="pre">source.Monotone</span></code> will use.</dd>
</dl>
</div>
<div class="section" id="patch-information">
<h7>patch information<a class="headerlink" href="#patch-information" title="Permalink to this headline">¶</a></h7>
<p>You can provide the option <cite>–who=dev</cite> to designate who is running the try build.
This will add the <code class="docutils literal notranslate"><span class="pre">dev</span></code> to the Reason field on the try build’s status web page.
You can also set <code class="docutils literal notranslate"><span class="pre">try_who</span> <span class="pre">=</span> <span class="pre">dev</span></code> in the <code class="file docutils literal notranslate"><span class="pre">.buildbot/options</span></code> file.
Note that option <cite>–who=dev</cite> will not work on version 0.8.3 or earlier masters.</p>
<p>Similarly, option <cite>–comment=COMMENT</cite> will specify the comment for the patch, which is also displayed in the patch information.
The corresponding config-file option is <code class="docutils literal notranslate"><span class="pre">try_comment</span></code>.</p>
</div>
<div class="section" id="sending-properties">
<h7>Sending properties<a class="headerlink" href="#sending-properties" title="Permalink to this headline">¶</a></h7>
<p>You can set properties to send with your change using either the option <cite>–property=key=value</cite> option, which sets a single property, or the option <cite>–properties=key1=value1,key2=value2…</cite> option, which sets multiple comma-separated properties.
Either of these can be specified multiple times.
Note that the option <cite>–properties</cite> option uses commas to split on properties, so if your property value itself contains a comma, you’ll need to use the option <cite>–property</cite> option to set it.</p>
</div>
</div>
<div class="section" id="try-diff">
<span id="id2"></span><h6>try –diff<a class="headerlink" href="#try-diff" title="Permalink to this headline">¶</a></h6>
<p>Sometimes you might have a patch from someone else that you want to submit to the buildbot.
For example, a user may have created a patch to fix some specific bug and sent it to you by email.
You’ve inspected the patch and suspect that it might do the job (and have at least confirmed that it doesn’t do anything evil).
Now you want to test it out.</p>
<p>One approach would be to check out a new local tree, apply the patch, run your local tests, then use <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">try</span></code> to run the tests on other platforms.
An alternate approach is to use the <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">try</span> <span class="pre">--diff</span></code> form to have the buildbot test the patch without using a local tree.</p>
<p>This form takes a option <cite>–diff</cite> argument which points to a file that contains the patch you want to apply.
By default this patch will be applied to the TRUNK revision, but if you give the optional option <cite>–baserev</cite> argument, a tree of the given revision will be used as a starting point instead of TRUNK.</p>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">try</span> <span class="pre">--diff=-</span></code> to read the patch from <code class="file docutils literal notranslate"><span class="pre">stdin</span></code>.</p>
<p>Each patch has a <code class="docutils literal notranslate"><span class="pre">patchlevel</span></code> associated with it.
This indicates the number of slashes (and preceding pathnames) that should be stripped before applying the diff.
This exactly corresponds to the option <cite>-p</cite> or option <cite>–strip</cite> argument to the <strong class="command">patch</strong> utility.
By default <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">try</span> <span class="pre">--diff</span></code> uses a patchlevel of 0, but you can override this with the option <cite>-p</cite> argument.</p>
<p>When you use option <cite>–diff</cite>, you do not need to use any of the other options that relate to a local tree, specifically option <cite>–vc</cite>, option <cite>–try-topfile</cite>, or option <cite>–try-topdir</cite>.
These options will be ignored.
Of course you must still specify how to get to the buildmaster (with option <cite>–connect</cite>, option <cite>–tryhost</cite>, etc).</p>
</div>
</div>
<div class="section" id="other-tools">
<h5>2.7.1.3. Other Tools<a class="headerlink" href="#other-tools" title="Permalink to this headline">¶</a></h5>
<p>These tools are generally used by buildmaster administrators.</p>
<div class="section" id="sendchange">
<span id="cmdline-sendchange"></span><h6>sendchange<a class="headerlink" href="#sendchange" title="Permalink to this headline">¶</a></h6>
<p>This command is used to tell the buildmaster about source changes.
It is intended to be used from within a commit script, installed on the VC server.
It requires that you have a <code class="xref py py-class docutils literal notranslate"><span class="pre">PBChangeSource</span></code> (<a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a>) running in the buildmaster (by being set in <code class="docutils literal notranslate"><span class="pre">c['change_source']</span></code>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot sendchange --master {MASTERHOST}:{PORT} --auth {USER}:{PASS}
        --who {USER} {FILENAMES..}
</pre></div>
</div>
<p>The option <cite>–auth</cite> option specifies the credentials to use to connect to the master, in the form <code class="docutils literal notranslate"><span class="pre">user:pass</span></code>.
If the password is omitted, then sendchange will prompt for it.
If both are omitted, the old default (username “change” and password “changepw”) will be used.
Note that this password is well-known, and should not be used on an internet-accessible port.</p>
<p>The option <cite>–master</cite> and option <cite>–username</cite> arguments can also be given in the options file (see <a class="reference internal" href="#buildbot-config-directory"><span class="std std-ref">.buildbot config directory</span></a>).
There are other (optional) arguments which can influence the <code class="docutils literal notranslate"><span class="pre">Change</span></code> that gets submitted:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--branch</span></kbd></td>
<td>(or option <code class="docutils literal notranslate"><span class="pre">branch</span></code>) This provides the (string) branch specifier.
If omitted, it defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, indicating the <code class="docutils literal notranslate"><span class="pre">default</span> <span class="pre">branch</span></code>.
All files included in this Change must be on the same branch.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--category</span></kbd></td>
<td>(or option <code class="docutils literal notranslate"><span class="pre">category</span></code>) This provides the (string) category specifier.
If omitted, it defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>, indicating <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">category</span></code>.
The category property can be used by schedulers to filter what changes they listen to.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--project</span></kbd></td>
<td>(or option <code class="docutils literal notranslate"><span class="pre">project</span></code>) This provides the (string) project to which this change applies, and defaults to ‘’.
The project can be used by schedulers to decide which builders should respond to a particular change.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--repository</span></kbd></td>
<td>(or option <code class="docutils literal notranslate"><span class="pre">repository</span></code>) This provides the repository from which this change came, and defaults to <code class="docutils literal notranslate"><span class="pre">''</span></code>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--revision</span></kbd></td>
<td>This provides a revision specifier, appropriate to the VC system in use.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--revision_file</span></kbd></td>
</tr>
<tr><td>&#160;</td><td>This provides a filename which will be opened and the contents used as the revision specifier.
This is specifically for Darcs, which uses the output of <code class="docutils literal notranslate"><span class="pre">darcs</span> <span class="pre">changes</span> <span class="pre">--context</span></code> as a revision specifier.
This context file can be a couple of kilobytes long, spanning a couple lines per patch, and would be a hassle to pass as a command-line argument.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--property</span></kbd></td>
<td>This parameter is used to set a property on the <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code> generated by <code class="docutils literal notranslate"><span class="pre">sendchange</span></code>.
Properties are specified as a <code class="samp docutils literal notranslate"><em><span class="pre">name</span></em><span class="pre">:</span><em><span class="pre">value</span></em></code> pair, separated by a colon.
You may specify many properties by passing this parameter multiple times.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--comments</span></kbd></td>
<td>This provides the change comments as a single argument.
You may want to use option <cite>–logfile</cite> instead.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--logfile</span></kbd></td>
<td>This instructs the tool to read the change comments from the given file.
If you use <code class="docutils literal notranslate"><span class="pre">-</span></code> as the filename, the tool will read the change comments from stdin.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--encoding</span></kbd></td>
<td>Specifies the character encoding for all other parameters, defaulting to <code class="docutils literal notranslate"><span class="pre">'utf8'</span></code>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--vc</span></kbd></td>
<td>Specifies which VC system the Change is coming from, one of: <code class="docutils literal notranslate"><span class="pre">cvs</span></code>, <code class="docutils literal notranslate"><span class="pre">svn</span></code>, <code class="docutils literal notranslate"><span class="pre">darcs</span></code>, <code class="docutils literal notranslate"><span class="pre">hg</span></code>, <code class="docutils literal notranslate"><span class="pre">bzr</span></code>, <code class="docutils literal notranslate"><span class="pre">git</span></code>, <code class="docutils literal notranslate"><span class="pre">mtn</span></code>, or <code class="docutils literal notranslate"><span class="pre">p4</span></code>.
Defaults to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="user">
<span id="cmdline-user"></span><h6>user<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h6>
<p>Note that in order to use this command, you need to configure a <cite>CommandlineUserManager</cite> instance in your <cite>master.cfg</cite> file, which is explained in <a class="reference internal" href="#users-options"><span class="std std-ref">Users Options</span></a>.</p>
<p>This command allows you to manage users in buildbot’s database.
No extra requirements are needed to use this command, aside from the Buildmaster running.
For details on how Buildbot manages users, see <a class="reference internal" href="#concepts-users"><span class="std std-ref">Users</span></a>.</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--master</span></kbd></td>
<td>The <strong class="command">user</strong> command can be run virtually anywhere provided a location of the running buildmaster.
The option <cite>–master</cite> argument is of the form <code class="samp docutils literal notranslate"><em><span class="pre">MASTERHOST</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em></code>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--username</span></kbd></td>
<td>PB connection authentication that should match the arguments to <cite>CommandlineUserManager</cite>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--passwd</span></kbd></td>
<td>PB connection authentication that should match the arguments to <cite>CommandlineUserManager</cite>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--op</span></kbd></td>
<td>There are four supported values for the option <cite>–op</cite> argument: <code class="docutils literal notranslate"><span class="pre">add</span></code>, <code class="docutils literal notranslate"><span class="pre">update</span></code>, <code class="docutils literal notranslate"><span class="pre">remove</span></code>, and <code class="docutils literal notranslate"><span class="pre">get</span></code>.
Each are described in full in the following sections.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--bb_username</span></kbd></td>
<td>Used with the option <cite>–op=update</cite> option, this sets the user’s username for web authentication in the database.
It requires option <cite>–bb_password</cite> to be set along with it.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--bb_password</span></kbd></td>
<td>Also used with the option <cite>–op=update</cite> option, this sets the password portion of a user’s web authentication credentials into the database.
The password is first encrypted prior to storage for security reasons.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--ids</span></kbd></td>
<td><p class="first">When working with users, you need to be able to refer to them by unique identifiers to find particular users in the database.
The option <cite>–ids</cite> option lets you specify a comma separated list of these identifiers for use with the <strong class="command">user</strong> command.</p>
<p class="last">The option <cite>–ids</cite> option is used only when using option <cite>–op=remove</cite> or option <cite>–op=get</cite>.</p>
</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--info</span></kbd></td>
<td><p class="first">Users are known in buildbot as a collection of attributes tied together by some unique identifier (see <a class="reference internal" href="#concepts-users"><span class="std std-ref">Users</span></a>).
These attributes are specified in the form <code class="docutils literal notranslate"><span class="pre">{TYPE}={VALUE}</span></code> when using the option <cite>–info</cite> option.
These <code class="docutils literal notranslate"><span class="pre">{TYPE}={VALUE}</span></code> pairs are specified in a comma separated list, so for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--info=svn=jdoe,git=&#39;John Doe &lt;joe@example.com&gt;&#39;
</pre></div>
</div>
<p>The option <cite>–info</cite> option can be specified multiple times in the <strong class="command">user</strong> command, as each specified option will be interpreted as a new user.
Note that option <cite>–info</cite> is only used with option <cite>–op=add</cite> or with option <cite>–op=update</cite>, and whenever you use option <cite>–op=update</cite> you need to specify the identifier of the user you want to update.
This is done by prepending the option <cite>–info</cite> arguments with <code class="docutils literal notranslate"><span class="pre">{ID:}</span></code>.
If we were to update <code class="docutils literal notranslate"><span class="pre">'jschmo'</span></code> from the previous example, it would look like this:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>--info=jdoe:git=&#39;Joe Doe &lt;joe@example.com&gt;&#39;
</pre></div>
</div>
</td></tr>
</tbody>
</table>
<p>Note that option <cite>–master</cite>, option <cite>–username</cite>, option <cite>–passwd</cite>, and option <cite>–op</cite> are always required to issue the <strong class="command">user</strong> command.</p>
<p>The option <cite>–master</cite>, option <cite>–username</cite>, and option <cite>–passwd</cite> options can be specified in the option file with keywords <code class="docutils literal notranslate"><span class="pre">user_master</span></code>, <code class="docutils literal notranslate"><span class="pre">user_username</span></code>, and <code class="docutils literal notranslate"><span class="pre">user_passwd</span></code>, respectively.
If <code class="docutils literal notranslate"><span class="pre">user_master</span></code> is not specified, then option <cite>–master</cite> from the options file will be used instead.</p>
<p>Below are examples of how each command should look.
Whenever a <strong class="command">user</strong> command is successful, results will be shown to whoever issued the command.</p>
<p>For option <cite>–op=add</cite>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot user --master={MASTERHOST} --op=add \
        --username={USER} --passwd={USERPW} \
        --info={TYPE}={VALUE},...
</pre></div>
</div>
<p>For option <cite>–op=update</cite>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot user --master={MASTERHOST} --op=update \
        --username={USER} --passwd={USERPW} \
        --info={ID}:{TYPE}={VALUE},...
</pre></div>
</div>
<p>For option <cite>–op=remove</cite>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot user --master={MASTERHOST} --op=remove \
        --username={USER} --passwd={USERPW} \
        --ids={ID1},{ID2},...
</pre></div>
</div>
<p>For option <cite>–op=get</cite>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot user --master={MASTERHOST} --op=get \
        --username={USER} --passwd={USERPW} \
        --ids={ID1},{ID2},...
</pre></div>
</div>
<p>A note on option <cite>–op=update</cite>: when updating the option <cite>–bb_username</cite> and option <cite>–bb_password</cite>, the option <cite>–info</cite> doesn’t need to have additional <code class="docutils literal notranslate"><span class="pre">{TYPE}={VALUE}</span></code> pairs to update and can just take the <code class="docutils literal notranslate"><span class="pre">{ID}</span></code> portion.</p>
</div>
</div>
<div class="section" id="buildbot-config-directory">
<span id="id3"></span><h5>2.7.1.4. <code class="file docutils literal notranslate"><span class="pre">.buildbot</span></code> config directory<a class="headerlink" href="#buildbot-config-directory" title="Permalink to this headline">¶</a></h5>
<p>Many of the <strong class="command">buildbot</strong> tools must be told how to contact the buildmaster that they interact with.
This specification can be provided as a command-line argument, but most of the time it will be easier to set them in an <code class="docutils literal notranslate"><span class="pre">options</span></code> file.
The <strong class="command">buildbot</strong> command will look for a special directory named <code class="file docutils literal notranslate"><span class="pre">.buildbot</span></code>, starting from the current directory (where the command was run) and crawling upwards, eventually looking in the user’s home directory.
It will look for a file named <code class="file docutils literal notranslate"><span class="pre">options</span></code> in this directory, and will evaluate it as a Python script, looking for certain names to be set.
You can just put simple <code class="docutils literal notranslate"><span class="pre">name</span> <span class="pre">=</span> <span class="pre">'value'</span></code> pairs in this file to set the options.</p>
<p>For a description of the names used in this file, please see the documentation for the individual <strong class="command">buildbot</strong> sub-commands.
The following is a brief sample of what this file’s contents could be.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># for status-reading tools
masterstatus = &#39;buildbot.example.org:12345&#39;
# for &#39;sendchange&#39; or the debug port
master = &#39;buildbot.example.org:18990&#39;
</pre></div>
</div>
<p>Note carefully that the names in the <code class="file docutils literal notranslate"><span class="pre">options</span></code> file usually do not match the command-line option name.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">master</span></code></dt>
<dd>Equivalent to option <cite>–master</cite> for <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">sendchange</span></code></a>.
It is the location of the <code class="xref py py-class docutils literal notranslate"><span class="pre">pb.PBChangeSource</span></code> for <code class="docutils literal notranslate"><span class="pre">`sendchange</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">username</span></code></dt>
<dd>Equivalent to option <cite>–username</cite> for the <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">sendchange</span></code></a> command.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">branch</span></code></dt>
<dd>Equivalent to option <cite>–branch</cite> for the <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">sendchange</span></code></a> command.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">category</span></code></dt>
<dd>Equivalent to option <cite>–category</cite> for the <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">sendchange</span></code></a> command.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">try_connect</span></code></dt>
<dd>Equivalent to option <cite>–connect</cite>, this specifies how the <a class="reference internal" href="#cmdline-try" title="try"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">try</span></code></a> command should deliver its request to the buildmaster.
The currently accepted values are <code class="docutils literal notranslate"><span class="pre">ssh</span></code> and <code class="docutils literal notranslate"><span class="pre">pb</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">try_builders</span></code></dt>
<dd>Equivalent to option <cite>–builders</cite>, specifies which builders should be used for the <a class="reference internal" href="#cmdline-try" title="try"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">try</span></code></a> build.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">try_vc</span></code></dt>
<dd>Equivalent to option <cite>–vc</cite> for <a class="reference internal" href="#cmdline-try" title="try"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">try</span></code></a>, this specifies the version control system being used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">try_branch</span></code></dt>
<dd>Equivalent to option <cite>–branch</cite>, this indicates that the current tree is on a non-trunk branch.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">try_topdir</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">try_topfile</span></code></dt>
<dd>Use <code class="docutils literal notranslate"><span class="pre">try_topdir</span></code>, equivalent to option <cite>–try-topdir</cite>, to explicitly indicate the top of your working tree, or <code class="docutils literal notranslate"><span class="pre">try_topfile</span></code>, equivalent to option <cite>–try-topfile</cite> to name a file that will only be found in that top-most directory.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">try_host</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">try_username</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">try_dir</span></code></dt>
<dd>When <code class="docutils literal notranslate"><span class="pre">try_connect</span></code> is <code class="docutils literal notranslate"><span class="pre">ssh</span></code>, the command will use <code class="docutils literal notranslate"><span class="pre">try_host</span></code> for option <cite>–tryhost</cite>, <code class="docutils literal notranslate"><span class="pre">try_username</span></code> for option <cite>–username</cite>, and <code class="docutils literal notranslate"><span class="pre">try_dir</span></code> for option <cite>–trydir</cite>.
Apologies for the confusing presence and absence of ‘try’.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">try_username</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">try_password</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">try_master</span></code></dt>
<dd>Similarly, when <code class="docutils literal notranslate"><span class="pre">try_connect</span></code> is <code class="docutils literal notranslate"><span class="pre">pb</span></code>, the command will pay attention to <code class="docutils literal notranslate"><span class="pre">try_username</span></code> for option <cite>–username</cite>, <code class="docutils literal notranslate"><span class="pre">try_password</span></code> for option <cite>–passwd</cite>, and <code class="docutils literal notranslate"><span class="pre">try_master</span></code> for option <cite>–master</cite>.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">try_wait</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">masterstatus</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">try_wait</span></code> and <code class="docutils literal notranslate"><span class="pre">masterstatus</span></code> (equivalent to option <cite>–wait</cite> and <code class="docutils literal notranslate"><span class="pre">master</span></code>, respectively) are used to ask the <a class="reference internal" href="#cmdline-try" title="try"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">try</span></code></a> command to wait for the requested build to complete.</dd>
</dl>
</div>
</div>
<div class="section" id="worker">
<h4>2.7.2. worker<a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h4>
<p><strong class="command">buildbot-worker</strong> command-line tool is used for worker management only and does not provide any additional functionality.
One can create, start, stop and restart the worker.</p>
<div class="section" id="create-worker">
<span id="cmdline-create-worker"></span><h5>2.7.2.1. create-worker<a class="headerlink" href="#create-worker" title="Permalink to this headline">¶</a></h5>
<p>This creates a new directory and populates it with files that let it be used as a worker’s base directory.
You must provide several arguments, which are used to create the initial <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> file.</p>
<p>The option <cite>-r</cite> option is advisable here, just like for <code class="docutils literal notranslate"><span class="pre">create-master</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot-worker create-worker -r {BASEDIR} {MASTERHOST}:{PORT} {WORKERNAME} {PASSWORD}
</pre></div>
</div>
<p>The create-worker options are described in <a class="reference internal" href="#worker-options"><span class="std std-ref">Worker Options</span></a>.</p>
</div>
<div class="section" id="cmdline-start (worker)">
<span id="id4"></span><h5>2.7.2.2. start<a class="headerlink" href="#cmdline-start (worker)" title="Permalink to this headline">¶</a></h5>
<p>This starts a worker which was already created in the given base directory.
The daemon is launched in the background, with events logged to a file named <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot-worker start [--nodaemon] BASEDIR
</pre></div>
</div>
<p>The option <cite>–nodaemon</cite> option instructs Buildbot to skip daemonizing.
The process will start in the foreground.
It will only return to the command-line when it is stopped.</p>
</div>
<div class="section" id="cmdline-restart (worker)">
<span id="id5"></span><h5>2.7.2.3. restart<a class="headerlink" href="#cmdline-restart (worker)" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot-worker restart [--nodaemon] BASEDIR
</pre></div>
</div>
<p>This restarts a worker which is already running.
It is equivalent to a <code class="docutils literal notranslate"><span class="pre">stop</span></code> followed by a <code class="docutils literal notranslate"><span class="pre">start</span></code>.</p>
<p>The option <cite>–nodaemon</cite> option has the same meaning as for <code class="docutils literal notranslate"><span class="pre">start</span></code>.</p>
</div>
<div class="section" id="cmdline-stop (worker)">
<span id="id6"></span><h5>2.7.2.4. stop<a class="headerlink" href="#cmdline-stop (worker)" title="Permalink to this headline">¶</a></h5>
<p>This terminates the daemon worker running in the given directory.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot stop BASEDIR
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-manual/resources"></span><div class="section" id="resources">
<span id="id1"></span><h3>2.8. Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h3>
<p>The Buildbot home page is <a class="reference external" href="http://buildbot.net/">http://buildbot.net/</a>.</p>
<p>For configuration questions and general discussion, please use the <code class="docutils literal notranslate"><span class="pre">buildbot-devel</span></code> mailing list.
The subscription instructions and archives are available at <a class="reference external" href="https://lists.buildbot.net/pipermail/devel/">https://lists.buildbot.net/pipermail/devel/</a></p>
<p>The <code class="docutils literal notranslate"><span class="pre">#buildbot</span></code> channel on Freenode’s IRC servers hosts development discussion, and often folks are available to answer questions there, as well.</p>
</div>
<span id="document-manual/optimization"></span><div class="section" id="optimization">
<span id="id1"></span><h3>2.9. Optimization<a class="headerlink" href="#optimization" title="Permalink to this headline">¶</a></h3>
<p>If you’re feeling your Buildbot is running a bit slow, here are some tricks that may help you, but use them at your own risk.</p>
<div class="section" id="properties-load-speedup">
<h4>2.9.1. Properties load speedup<a class="headerlink" href="#properties-load-speedup" title="Permalink to this headline">¶</a></h4>
<p>For example, if most of your build properties are strings, you can gain an approx. 30% speedup if you put this snippet of code inside your master.cfg file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">speedup_json_loads</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">re</span>

    <span class="n">original_decode</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">_default_decoder</span><span class="o">.</span><span class="n">decode</span>
    <span class="n">my_regexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^\[\&quot;([^&quot;]*)\&quot;,\s+\&quot;([^&quot;]*)\&quot;\]$&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decode_with_re</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">my_regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">original_decode</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">json</span><span class="o">.</span><span class="n">_default_decoder</span><span class="o">.</span><span class="n">decode</span> <span class="o">=</span> <span class="n">decode_with_re</span>

<span class="n">speedup_json_loads</span><span class="p">()</span>
</pre></div>
</div>
<p>It patches json decoder so that it would first try to extract a value from JSON that is a list of two strings (which is the case for a property being a string), and would fallback to general JSON decoder on any error.</p>
</div>
</div>
<span id="document-manual/plugins"></span><div class="section" id="plugin-infrastructure-in-buildbot">
<span id="plugins"></span><h3>2.10. Plugin Infrastructure in Buildbot<a class="headerlink" href="#plugin-infrastructure-in-buildbot" title="Permalink to this headline">¶</a></h3>
<div class="versionadded">
<p><span class="versionmodified">New in version 0.8.11.</span></p>
</div>
<p>Plugin infrastructure in Buildbot allows easy use of components that are not part of the core.
It also allows unified access to components that are included in the core.</p>
<p>The following snippet</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">kind</span>

<span class="o">...</span> <span class="n">kind</span><span class="o">.</span><span class="n">ComponentClass</span> <span class="o">...</span>
</pre></div>
</div>
<p>allows to use a component of kind <code class="docutils literal notranslate"><span class="pre">kind</span></code>.
Available <code class="docutils literal notranslate"><span class="pre">kind</span></code>s are:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">worker</span></code></dt>
<dd>workers, described in <a class="reference internal" href="#document-manual/configuration/workers"><span class="doc">Workers</span></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">changes</span></code></dt>
<dd>change source, described in <a class="reference internal" href="#document-manual/configuration/changesources"><span class="doc">Change Sources and Changes</span></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">schedulers</span></code></dt>
<dd>schedulers, described in <a class="reference internal" href="#document-manual/configuration/schedulers"><span class="doc">Schedulers</span></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">steps</span></code></dt>
<dd>build steps, described in <a class="reference internal" href="#document-manual/configuration/buildsteps"><span class="doc">Build Steps</span></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">reporters</span></code></dt>
<dd>reporters (or reporter targets), described in <a class="reference internal" href="#document-manual/configuration/reporters"><span class="doc">Reporters</span></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">util</span></code></dt>
<dd>utility classes.
For example, <a class="reference internal" href="#document-manual/configuration/builders"><span class="doc">BuilderConfig</span></a>, <a class="reference internal" href="#document-manual/configuration/buildfactories"><span class="doc">Build Factories</span></a>, <a class="reference internal" href="#change-filters"><span class="std std-ref">ChangeFilter</span></a> and <a class="reference internal" href="#document-manual/configuration/interlocks"><span class="doc">Locks</span></a> are accessible through <code class="docutils literal notranslate"><span class="pre">util</span></code>.</dd>
</dl>
<p>Web interface plugins are not used directly: as described in <a class="reference internal" href="#document-manual/configuration/www"><span class="doc">web server configuration</span></a> section, they are listed in the corresponding section of the web server configuration dictionary.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you are not very familiar with Python and you need to use different kinds of components, start your <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code> file with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
</div>
<p class="last">As a result, all listed above components will be available for use.
This is what sample <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code> file uses.</p>
</div>
<div class="section" id="finding-plugins">
<h4>2.10.1. Finding Plugins<a class="headerlink" href="#finding-plugins" title="Permalink to this headline">¶</a></h4>
<p>Buildbot maintains a list of plugins at <a class="reference external" href="http://trac.buildbot.net/wiki/Plugins">http://trac.buildbot.net/wiki/Plugins</a>.</p>
</div>
<div class="section" id="developing-plugins">
<h4>2.10.2. Developing Plugins<a class="headerlink" href="#developing-plugins" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#plugin-module"><span class="std std-ref">Distribute a Buildbot Plug-In</span></a> contains all necessary information for you to develop new plugins.
Please edit <a class="reference external" href="http://trac.buildbot.net/wiki/Plugins">http://trac.buildbot.net/wiki/Plugins</a> to add a link to your plugin!</p>
</div>
<div class="section" id="plugins-of-note">
<h4>2.10.3. Plugins of note<a class="headerlink" href="#plugins-of-note" title="Permalink to this headline">¶</a></h4>
<p>Plugins were introduced in Buildbot-0.8.11, so as of this writing, only components that are bundled with Buildbot are available as plugins.</p>
<p>If you have an idea/need about extending Buildbot, head to <a class="reference internal" href="#document-developer/plugins-publish"><span class="doc">How to package Buildbot plugins</span></a>, create your own plugins and let the world now how Buildbot can be made even more useful.</p>
</div>
</div>
<span id="document-manual/deploy"></span><div class="section" id="deployment">
<h3>2.11. Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h3>
<p>This page aims at describing the common pitfalls and best practices when deploying buildbot.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#using-a-database-server" id="id6">Using A Database Server</a></li>
<li><a class="reference internal" href="#maintenance" id="id7">Maintenance</a></li>
<li><a class="reference internal" href="#troubleshooting" id="id8">Troubleshooting</a></li>
</ul>
</div>
<div class="section" id="using-a-database-server">
<span id="database-server"></span><h4><a class="toc-backref" href="#id6">2.11.1. Using A Database Server</a><a class="headerlink" href="#using-a-database-server" title="Permalink to this headline">¶</a></h4>
<p>Buildbot uses the sqlite3 database backend by default.
If you plan to host a lot of data, you may consider using a more suitable database server.</p>
<p>If you want to use a database server (e.g., MySQL or Postgres) as the database backend for your Buildbot, use option <cite>buildbot create-master –db</cite> to specify the <a class="reference internal" href="#database-specification"><span class="std std-ref">connection string</span></a> for the database, and make sure that the same URL appears in the <code class="docutils literal notranslate"><span class="pre">db_url</span></code> of the <a class="reference internal" href="#cfg-db" title="db"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">db</span></code></a> parameter in your configuration file.</p>
<div class="section" id="additional-requirements">
<h5>2.11.1.1. Additional Requirements<a class="headerlink" href="#additional-requirements" title="Permalink to this headline">¶</a></h5>
<p>Depending on the selected database, further Python packages will be required.
Consult the <a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a> dialect list for a full description.
The most common choice for MySQL is <a class="reference external" href="https://github.com/PyMySQL/mysqlclient-python">mysqlclient</a>.
Any reasonably recent version should suffice.</p>
<p>The most common choice for Postgres is <a class="reference external" href="http://initd.org/psycopg/">Psycopg</a>
Any reasonably recent version should suffice.</p>
</div>
</div>
<div class="section" id="maintenance">
<span id="id1"></span><h4><a class="toc-backref" href="#id7">2.11.2. Maintenance</a><a class="headerlink" href="#maintenance" title="Permalink to this headline">¶</a></h4>
<p>The buildmaster can be configured to send out email notifications when a worker has been offline for a while.
Be sure to configure the buildmaster with a contact email address for each worker so these notifications are sent to someone who can bring it back online.</p>
<p>If you find you can no longer provide a worker to the project, please let the project admins know, so they can put out a call for a replacement.</p>
<p>The Buildbot records status and logs output continually, each time a build is performed.
The status tends to be small, but the build logs can become quite large.
Each build and log are recorded in a separate file, arranged hierarchically under the buildmaster’s base directory.
To prevent these files from growing without bound, you should periodically delete old build logs.
A simple cron job to delete anything older than, say, two weeks should do the job.
The only trick is to leave the <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> and other support files alone, for which <strong class="command">find</strong>’s <code class="docutils literal notranslate"><span class="pre">-mindepth</span></code> argument helps skip everything in the top directory.
You can use something like the following (assuming builds are stored in <code class="file docutils literal notranslate"><span class="pre">./builds/</span></code> directory):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@weekly cd BASEDIR &amp;&amp; find . -mindepth 2 i-path &#39;./builds/*&#39; \
    -prune -o -type f -mtime +14 -exec rm {} \;
@weekly cd BASEDIR &amp;&amp; find twistd.log* -mtime +14 -exec rm {} \;
</pre></div>
</div>
<p>Alternatively, you can configure a maximum number of old logs to be kept using the <code class="docutils literal notranslate"><span class="pre">--log-count</span></code> command line option when running <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code> or <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span></code>.</p>
</div>
<div class="section" id="troubleshooting">
<span id="id2"></span><h4><a class="toc-backref" href="#id8">2.11.3. Troubleshooting</a><a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h4>
<p>Here are a few hints on diagnosing common problems.</p>
<div class="section" id="starting-the-worker">
<span id="id3"></span><h5>2.11.3.1. Starting the worker<a class="headerlink" href="#starting-the-worker" title="Permalink to this headline">¶</a></h5>
<p>Cron jobs are typically run with a minimal shell (<code class="file docutils literal notranslate"><span class="pre">/bin/sh</span></code>, not <code class="file docutils literal notranslate"><span class="pre">/bin/bash</span></code>), and tilde expansion is not always performed in such commands.
You may want to use explicit paths, because the <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> is usually quite short and doesn’t include anything set by your shell’s startup scripts (<code class="file docutils literal notranslate"><span class="pre">.profile</span></code>, <code class="file docutils literal notranslate"><span class="pre">.bashrc</span></code>, etc).
If you’ve installed buildbot (or other Python libraries) to an unusual location, you may need to add a <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> specification (note that Python will do tilde-expansion on <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> elements by itself).
Sometimes it is safer to fully-specify everything:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>@reboot PYTHONPATH=~/lib/python /usr/local/bin/buildbot \
    start /usr/home/buildbot/basedir
</pre></div>
</div>
<p>Take the time to get the <code class="docutils literal notranslate"><span class="pre">&#64;reboot</span></code> job set up.
Otherwise, things will work fine for a while, but the first power outage or system reboot you have will stop the worker with nothing but the cries of sorrowful developers to remind you that it has gone away.</p>
</div>
<div class="section" id="connecting-to-the-buildmaster">
<span id="id4"></span><h5>2.11.3.2. Connecting to the buildmaster<a class="headerlink" href="#connecting-to-the-buildmaster" title="Permalink to this headline">¶</a></h5>
<p>If the worker cannot connect to the buildmaster, the reason should be described in the <code class="file docutils literal notranslate"><span class="pre">twistd.log</span></code> logfile.
Some common problems are an incorrect master hostname or port number, or a mistyped bot name or password.
If the worker loses the connection to the master, it is supposed to attempt to reconnect with an exponentially-increasing backoff.
Each attempt (and the time of the next attempt) will be logged.
If you get impatient, just manually stop and re-start the worker.</p>
<p>When the buildmaster is restarted, all workers will be disconnected, and will attempt to reconnect as usual.
The reconnect time will depend upon how long the buildmaster is offline (i.e. how far up the exponential backoff curve the workers have travelled).
Again, <code class="samp docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">restart</span> <em><span class="pre">BASEDIR</span></em></code> will speed up the process.</p>
</div>
<div class="section" id="contrib-scripts">
<span id="id5"></span><h5>2.11.3.3. Contrib Scripts<a class="headerlink" href="#contrib-scripts" title="Permalink to this headline">¶</a></h5>
<p>While some features of Buildbot are included in the distribution, others are only available in <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/">master/contrib/</a> in the <code class="docutils literal notranslate"><span class="pre">buildbot-contrib</span></code> source directory.
The latest versions of such scripts are available at <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib">master/contrib</a>.</p>
</div>
</div>
</div>
<span id="document-manual/upgrading/index"></span><div class="section" id="upgrading">
<h3>2.12. Upgrading<a class="headerlink" href="#upgrading" title="Permalink to this headline">¶</a></h3>
<p>This section describes the process of upgrading from old versions of Buildbot.</p>
<div class="toctree-wrapper compound">
<span id="document-manual/upgrading/nine-upgrade"></span><div class="section" id="upgrading-to-nine">
<span id="id1"></span><h4>2.12.1. Upgrading to Nine<a class="headerlink" href="#upgrading-to-nine" title="Permalink to this headline">¶</a></h4>
<p>Upgrading a Buildbot instance from 0.8.x to 0.9.x may require a number of changes to the master configuration.
Those changes are summarized here.
If you are starting fresh with 0.9.0 or later, you can safely skip this section.</p>
<p>First important note is that Buildbot does not support an upgrade of a 0.8.x instance to 0.9.x.
Notably the build data and logs will not be accessible anymore if you upgraded, thus the database migration scripts have been dropped.</p>
<p>You should not <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">upgrade</span> <span class="pre">-U</span> <span class="pre">buildbot</span></code>, but rather start from a clean virtualenv aside from your old master.
You can keep your old master instance to serve the old build status.</p>
<p>Buildbot is now composed of several Python packages and Javascript UI, and the easiest way to install it is to run the following command within a virtualenv:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install <span class="s1">&#39;buildbot[bundle]&#39;</span>
</pre></div>
</div>
<div class="section" id="config-file-syntax">
<h5>2.12.1.1. Config File Syntax<a class="headerlink" href="#config-file-syntax" title="Permalink to this headline">¶</a></h5>
<p>In preparation for compatibility with Python 3, Buildbot configuration files no longer allow the print statement:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="s2">&quot;foo&quot;</span>
</pre></div>
</div>
<p>To fix, simply enclose the print arguments in parentheses:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;foo&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="plugins">
<h5>2.12.1.2. Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h5>
<p>Although plugin support was available in 0.8.12, its use is now highly recommended.
Instead of importing modules directly in <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code>, import the plugin kind from <code class="docutils literal notranslate"><span class="pre">buildbot.plugins</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>
</pre></div>
</div>
<p>Then access the plugin itself as an attribute:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">steps</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="o">..</span><span class="p">)</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#plugins"><span class="std std-ref">Plugin Infrastructure in Buildbot</span></a> for more information.</p>
</div>
<div class="section" id="web-status">
<h5>2.12.1.3. Web Status<a class="headerlink" href="#web-status" title="Permalink to this headline">¶</a></h5>
<p>The most prominent change is that the existing <code class="docutils literal notranslate"><span class="pre">WebStatus</span></code> class is now gone, replaced by the new <code class="docutils literal notranslate"><span class="pre">www</span></code> functionality.</p>
<p>Thus an <code class="docutils literal notranslate"><span class="pre">html.WebStatus</span></code> entry in <code class="docutils literal notranslate"><span class="pre">c['status']</span></code> should be removed and replaced with configuration in <code class="docutils literal notranslate"><span class="pre">c['www']`</span></code>.
For example, replace:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.status</span> <span class="kn">import</span> <span class="n">html</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">WebStatus</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8010</span><span class="p">,</span> <span class="n">allowForce</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8010</span><span class="p">,</span>
                <span class="n">plugins</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">waterfall_view</span><span class="o">=</span><span class="p">{},</span>
                <span class="n">console_view</span><span class="o">=</span><span class="p">{}))</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span></code></a> for more information.</p>
</div>
<div class="section" id="status-classes">
<h5>2.12.1.4. Status Classes<a class="headerlink" href="#status-classes" title="Permalink to this headline">¶</a></h5>
<p>Where in 0.8.x most of the data about a build was available synchronously, it must now be fetched dynamically using the <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a>.
All classes under the Python package <code class="docutils literal notranslate"><span class="pre">buildbot.status</span></code> should be considered deprecated.
Many have already been removed, and the remainder have limited functionality.
Any custom code which refers to these classes must be rewritten to use the Data API.
Avoid the temptation to reach into the Buildbot source code to find other useful-looking methods!</p>
<p>Common uses of the status API are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">getBuild</span></code> in a custom renderable</li>
<li><code class="docutils literal notranslate"><span class="pre">MailNotifier</span></code> message formatters (see below for upgrade hints)</li>
<li><code class="docutils literal notranslate"><span class="pre">doIf</span></code> functions on steps</li>
</ul>
</div></blockquote>
<p>Import paths for several classes under the <code class="docutils literal notranslate"><span class="pre">buildbot.status</span></code> package but which remain useful have changed.
Most of these are now available as plugins (see above), but for the remainder, consult the source code.</p>
</div>
<div class="section" id="buildrequest-merging">
<h5>2.12.1.5. BuildRequest Merging<a class="headerlink" href="#buildrequest-merging" title="Permalink to this headline">¶</a></h5>
<p>Buildbot 0.9.x has replaced the old concept of request merging (<code class="docutils literal notranslate"><span class="pre">mergeRequests</span></code>) with a more flexible request-collapsing mechanism.
See <a class="reference internal" href="#cfg-collapseRequests" title="collapseRequests"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">collapseRequests</span></code></a> for more information.</p>
</div>
<div class="section" id="status-reporters">
<h5>2.12.1.6. Status Reporters<a class="headerlink" href="#status-reporters" title="Permalink to this headline">¶</a></h5>
<p>In fact, the whole <code class="docutils literal notranslate"><span class="pre">c['status']</span></code> configuration parameter is gone.</p>
<p>Many of the status listeners used in the status hierarchy in 0.8.x have been replaced with “reporters” that are available as buildbot plugins.
However, note that not all status listeners have yet been ported.
See the release notes for details.</p>
<p>Including the <code class="docutils literal notranslate"><span class="pre">&quot;status&quot;</span></code> key in the configuration object will cause a configuration error.
All reporters should be included in <code class="docutils literal notranslate"><span class="pre">c['services']</span></code> as described in <a class="reference internal" href="#reporters"><span class="std std-ref">Reporters</span></a>.</p>
<p>The available reporters as of 0.9.0 are</p>
<ul class="simple">
<li><a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a></li>
<li><a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a></li>
<li><a class="reference internal" href="#reporter-HttpStatusPush" title="HttpStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">HttpStatusPush</span></code></a></li>
<li><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a></li>
<li><a class="reference internal" href="#reporter-GitHubStatusPush" title="GitHubStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GitHubStatusPush</span></code></a> (replaces <code class="docutils literal notranslate"><span class="pre">buildbot.status.github.GitHubStatus</span></code>)</li>
</ul>
<p>See the reporter index for the full, current list.</p>
<p>A few notes on changes to the configuration of these reporters:</p>
<ul class="simple">
<li><a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> argument <code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code> should now be a <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.reporters.message.MessageFormatter</span></code>, due to the removal of the status classes (see above), such formatters must be re-implemented using the Data API.</li>
<li><a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> argument <code class="docutils literal notranslate"><span class="pre">previousBuildGetter</span></code> is not supported anymore</li>
<li><a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> no longer forces SSL 3.0 when <code class="docutils literal notranslate"><span class="pre">useTls</span></code> is true.</li>
<li><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> callbacks slightly changed signature, and include a master reference instead of a status reference.</li>
<li><a class="reference internal" href="#reporter-GitHubStatusPush" title="GitHubStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GitHubStatusPush</span></code></a> now accepts a <code class="docutils literal notranslate"><span class="pre">context</span></code> parameter to be passed to the GitHub Status API.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.status.builder.Results</span></code> and the constants <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.status.results.SUCCESS</span></code> should be imported from the <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.results</span></code></a> module instead.</li>
</ul>
</div>
<div class="section" id="steps">
<h5>2.12.1.7. Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h5>
<p>Buildbot-0.8.9 introduced “new-style steps”, with an asynchronous <code class="docutils literal notranslate"><span class="pre">run</span></code> method.
In the remaining 0.8.x releases, use of new-style and old-style steps were supported side-by-side.
In 0.9.x, old-style steps are emulated using a collection of hacks to allow asynchronous calls to be called from synchronous code.
This emulation is imperfect, and you are strongly encouraged to rewrite any custom steps as <a class="reference internal" href="#new-style-build-steps"><span class="std std-ref">New-Style Build Steps</span></a>.</p>
<p>Note that new-style steps now “push” their status when it changes, so the <code class="docutils literal notranslate"><span class="pre">describe</span></code> method no longer exists.</p>
</div>
<div class="section" id="identifiers">
<h5>2.12.1.8. Identifiers<a class="headerlink" href="#identifiers" title="Permalink to this headline">¶</a></h5>
<p>Many strings in Buildbot must now be identifiers.
Identifiers are designed to fit easily and unambiguously into URLs, AMQP routes, and the like.
An “identifier” is a nonempty unicode string of limited length, containing only ASCII alphanumeric characters along with <code class="docutils literal notranslate"><span class="pre">-</span></code> (dash) and <code class="docutils literal notranslate"><span class="pre">_</span></code> (underscore), and not beginning with a digit</p>
<p>Unfortunately, many existing names do not fit this pattern.</p>
<p>The following fields are identifiers:</p>
<ul class="simple">
<li>worker name (50-character)</li>
<li>builder name (70-character)</li>
<li>step name (50-character)</li>
</ul>
</div>
<div class="section" id="serving-static-files">
<h5>2.12.1.9. Serving static files<a class="headerlink" href="#serving-static-files" title="Permalink to this headline">¶</a></h5>
<p>Since version 0.9.0 Buildbot doesn’t use and don’t serve master’s <code class="docutils literal notranslate"><span class="pre">public_html</span></code> directory.
You need to use third-party HTTP server for serving static files.</p>
</div>
<div class="section" id="transition-to-worker-terminology">
<h5>2.12.1.10. Transition to “worker” terminology<a class="headerlink" href="#transition-to-worker-terminology" title="Permalink to this headline">¶</a></h5>
<p>Since version 0.9.0 of Buildbot “slave”-based terminology is deprecated
in favor of “worker”-based terminology.</p>
<p>All identifiers, messages and documentation were updated to use “worker”
instead of “slave”.
Old API names are still available, but deprecated.</p>
<p>For details about changed API and how to control generated warnings see
<a class="reference internal" href="#transition-to-worker-terminology"><span class="std std-ref">Transition to “worker” terminology</span></a>.</p>
</div>
<div class="section" id="other-config-settings">
<h5>2.12.1.11. Other Config Settings<a class="headerlink" href="#other-config-settings" title="Permalink to this headline">¶</a></h5>
<p>The default master.cfg file contains some new changes, which you should look over:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">c['protocols']</span> <span class="pre">=</span> <span class="pre">{'pb':</span> <span class="pre">{'port':</span> <span class="pre">9989}}</span></code> (the default port used by the workers)</li>
<li>Waterfall View: requires installation (<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">buildbot-waterfall-view</span></code>) and configuration (<code class="docutils literal notranslate"><span class="pre">c['www']</span> <span class="pre">=</span> <span class="pre">{</span> <span class="pre">...,</span> <span class="pre">'plugins':</span> <span class="pre">{'waterfall_view':</span> <span class="pre">{}</span> <span class="pre">}</span></code>).</li>
</ul>
</div>
<div class="section" id="build-history">
<h5>2.12.1.12. Build History<a class="headerlink" href="#build-history" title="Permalink to this headline">¶</a></h5>
<p>There is no support for importing build history from 0.8.x (where the history was stored on-disk in pickle files) into 0.9.x (where it is stored in the database).</p>
</div>
<div class="section" id="data-lifetime">
<h5>2.12.1.13. Data LifeTime<a class="headerlink" href="#data-lifetime" title="Permalink to this headline">¶</a></h5>
<p>Buildbot Nine data being implemented fully in an SQL database, the <code class="docutils literal notranslate"><span class="pre">buildHorizon</span></code> feature had to be reworked.
Instead of being number-of-things based, it is now time based.
This makes more sense from a user perspective but makes it harder to predict the database average size.
Please be careful to provision enough disk space for your database.</p>
<p>The old <code class="docutils literal notranslate"><span class="pre">c['logHorizon']</span></code> way of configuring is not supported anymore.
See <a class="reference internal" href="#configurator-JanitorConfigurator" title="JanitorConfigurator"><code class="xref bb bb-configurator docutils literal notranslate"><span class="pre">JanitorConfigurator</span></code></a> to learn how to configure.
A new <code class="docutils literal notranslate"><span class="pre">__Janitor</span></code> builder will be created to help keep an eye on the cleanup activities.</p>
</div>
<div class="section" id="more-information">
<h5>2.12.1.14. More Information<a class="headerlink" href="#more-information" title="Permalink to this headline">¶</a></h5>
<p>For minor changes not mentioned here, consult the release notes for the versions over which you are upgrading.</p>
<p>Buildbot-0.9.0 represents several years’ work, and as such we may have missed potential migration issues.</p>
</div>
</div>
<span id="document-manual/upgrading/new-style-steps"></span><div class="section" id="new-style-build-steps">
<span id="id1"></span><h4>2.12.2. New-Style Build Steps<a class="headerlink" href="#new-style-build-steps" title="Permalink to this headline">¶</a></h4>
<p>In Buildbot-0.9.0, many operations performed by BuildStep subclasses return a Deferred.
As a result, custom build steps which call these methods will need to be rewritten.</p>
<p>Buildbot-0.8.9 supports old-style steps natively, while new-style steps are emulated.
Buildbot-0.9.0 supports new-style steps natively, while old-style steps are emulated.
Later versions of Buildbot will not support old-style steps at all.
All custom steps should be rewritten in the new style as soon as possible.</p>
<p>Buildbot distinguishes new-style from old-style steps by the presence of a <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.run" title="buildbot.process.buildstep.BuildStep.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span></code></a> method.
If this method is present, then the step is a new-style step.</p>
<div class="section" id="summary-of-changes">
<h5>2.12.2.1. Summary of Changes<a class="headerlink" href="#summary-of-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>New-style steps have a <code class="docutils literal notranslate"><span class="pre">run</span></code> method that is simpler to implement than the old <code class="docutils literal notranslate"><span class="pre">start</span></code> method.</li>
<li>Many methods are now asynchronous (return Deferreds), as they perform operations on the database.</li>
<li>Logs are now implemented by a completely different class.
This class supports the same log-writing methods (<code class="docutils literal notranslate"><span class="pre">addStderr</span></code> and so on), although they are now asynchronous.
However, it does not support log-reading methods such as <code class="docutils literal notranslate"><span class="pre">getText</span></code>.
It was never advisable to handle logs as enormous strings.
New-style steps should, instead, use a LogObserver or (in Buildbot-0.9.0) fetch log lines bit by bit using the data API.</li>
<li><a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep" title="buildbot.process.buildstep.LoggingBuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.buildstep.LoggingBuildStep</span></code></a> is deprecated and cannot be used in new-style steps.
Mix in <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.buildstep.ShellMixin</span></code> instead.</li>
<li>Step strings, derived by parameters like <code class="docutils literal notranslate"><span class="pre">description</span></code>, <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code>, and <code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code>, are no longer treated as lists.
For backward compatibility, the parameters may still be given as lists, but will be joined with spaces during execution (using <a class="reference internal" href="#buildbot.util.join_list" title="buildbot.util.join_list"><code class="xref py py-func docutils literal notranslate"><span class="pre">join_list</span></code></a>).</li>
</ul>
</div>
<div class="section" id="backward-compatibility">
<h5>2.12.2.2. Backward Compatibility<a class="headerlink" href="#backward-compatibility" title="Permalink to this headline">¶</a></h5>
<p>Some hacks are in place to support old-style steps.
These hacks are only activated when an old-style step is detected.
Support for old-style steps will be dropped soon after Buildbot-0.9.0 is released.</p>
<ul class="simple">
<li>The Deferreds from all asynchronous methods invoked during step execution are gathered internally.
The step is not considered finished until all such Deferreds have fired, and is marked EXCEPTION if any fail.
For logfiles, this is accomplished by means of a synchronous wrapper class.</li>
<li>Logfile data is available while the step is still in memory.
This means that logs returned from <code class="docutils literal notranslate"><span class="pre">step.getLog</span></code> have the expected methods <code class="docutils literal notranslate"><span class="pre">getText</span></code>, <code class="docutils literal notranslate"><span class="pre">readlines</span></code> and so on.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellCommand</span></code> subclasses implicitly gather all stdio output in memory and provide it to the <code class="docutils literal notranslate"><span class="pre">createSummary</span></code> method.</li>
</ul>
</div>
<div class="section" id="rewriting-start">
<h5>2.12.2.3. Rewriting <code class="docutils literal notranslate"><span class="pre">start</span></code><a class="headerlink" href="#rewriting-start" title="Permalink to this headline">¶</a></h5>
<p>If your custom buildstep implements the <code class="docutils literal notranslate"><span class="pre">start</span></code> method, then rename that method to <code class="docutils literal notranslate"><span class="pre">run</span></code> and set it up to return a Deferred, either explicitly or via <code class="docutils literal notranslate"><span class="pre">inlineCallbacks</span></code>.
The value of the Deferred should be the result of the step (one of the codes in <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.results</span></code></a>), or a Twisted failure instance to complete the step as EXCEPTION.
The new <code class="docutils literal notranslate"><span class="pre">run</span></code> method should <em>not</em> call <code class="docutils literal notranslate"><span class="pre">self.finished</span></code> or <code class="docutils literal notranslate"><span class="pre">self.failed</span></code>, instead signalling the same via Deferred.</p>
<p>For example, the following old-style <code class="docutils literal notranslate"><span class="pre">start</span></code> method</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1">## old style</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">remotecommand</span><span class="o">.</span><span class="n">RemoteCommand</span><span class="p">(</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="p">})</span>
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="k">lambda</span> <span class="n">res</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">convertResult</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">)</span>
</pre></div>
</div>
<p>Becomes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1">## new style</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">remotecommand</span><span class="o">.</span><span class="n">RemoteCommand</span><span class="p">(</span><span class="s1">&#39;stat&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;file&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="p">})</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convertResult</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="newly-asynchronous-methods">
<h5>2.12.2.4. Newly Asynchronous Methods<a class="headerlink" href="#newly-asynchronous-methods" title="Permalink to this headline">¶</a></h5>
<p>The following methods now return a Deferred:</p>
<ul class="simple">
<li><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addLog" title="buildbot.process.buildstep.BuildStep.addLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.addLog</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">log.addStdout</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">log.addStderr</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">log.addHeader</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">log.finish</span></code> (see “Log Objects”, below)</li>
<li><a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.addStdout" title="buildbot.process.remotecommand.RemoteCommand.addStdout"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.remotecommand.RemoteCommand.addStdout</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.addStderr" title="buildbot.process.remotecommand.RemoteCommand.addStderr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.remotecommand.RemoteCommand.addStderr</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.addHeader" title="buildbot.process.remotecommand.RemoteCommand.addHeader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.remotecommand.RemoteCommand.addHeader</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.addToLog" title="buildbot.process.remotecommand.RemoteCommand.addToLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.remotecommand.RemoteCommand.addToLog</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.addCompleteLog</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addHTMLLog" title="buildbot.process.buildstep.BuildStep.addHTMLLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.addHTMLLog</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addURL" title="buildbot.process.buildstep.BuildStep.addURL"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.addURL</span></code></a></li>
</ul>
<p>Any custom code in a new-style step that calls these methods must handle the resulting Deferred.
In some cases, that means that the calling method’s signature will change.
For example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1">## old-style</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MESSAGES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addCompleteLog</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summaries</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;count-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">m</span><span class="p">,</span> <span class="n">counts</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="s2">&quot;counter&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Is a synchronous function, not returning a Deferred.
However, when converted to a new-style test, it must handle Deferreds from the methods it calls, so it must be asynchronous.
Syntactically, <code class="docutils literal notranslate"><span class="pre">inlineCallbacks</span></code> makes the change fairly simple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1">## new-style</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MESSAGES</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">counts</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">addCompleteLog</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">summaries</span><span class="p">[</span><span class="n">m</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setProperty</span><span class="p">(</span><span class="s2">&quot;count-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">m</span><span class="p">,</span> <span class="n">counts</span><span class="p">[</span><span class="n">m</span><span class="p">],</span> <span class="s2">&quot;counter&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>However, this method’s callers must now handle the Deferred that it returns.
All methods that can be overridden in custom steps can return a Deferred.</p>
</div>
<div class="section" id="properties">
<h5>2.12.2.5. Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h5>
<p>Good news!
The API for properties is the same synchronous API as was available in old-style steps.
Properties are handled synchronously during the build, and persisted to the database at completion of each step.</p>
</div>
<div class="section" id="log-objects">
<h5>2.12.2.6. Log Objects<a class="headerlink" href="#log-objects" title="Permalink to this headline">¶</a></h5>
<p>Old steps had two ways of interacting with logfiles, both of which have changed.</p>
<p>The first is writing to logs while a step is executing.
When using <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addCompleteLog</span></code></a> or <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addHTMLLog" title="buildbot.process.buildstep.BuildStep.addHTMLLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addHTMLLog</span></code></a>, this is straightforward, except that in new-style steps these methods return a Deferred.</p>
<p>The second method is via <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addLog" title="buildbot.process.buildstep.BuildStep.addLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.addLog</span></code></a>.
In new-style steps, the returned object (via Deferred) has the following methods to add log content:</p>
<ul class="simple">
<li><a class="reference internal" href="#buildbot.process.log.StreamLog.addStdout" title="buildbot.process.log.StreamLog.addStdout"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addStdout</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.log.StreamLog.addStderr" title="buildbot.process.log.StreamLog.addStderr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addStderr</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.log.StreamLog.addHeader" title="buildbot.process.log.StreamLog.addHeader"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addHeader</span></code></a></li>
<li><a class="reference internal" href="#buildbot.process.log.Log.finish" title="buildbot.process.log.Log.finish"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finish</span></code></a></li>
</ul>
<p>All of these methods now return Deferreds.
None of the old log-reading methods are available on this object:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">hasContents</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">getText</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">readLines</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">getTextWithHeaders</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">getChunks</span></code></li>
</ul>
<p>If your step uses such methods, consider using a <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> instead, or using the Data API to get the required data.</p>
<p>The undocumented and unused <code class="docutils literal notranslate"><span class="pre">subscribeConsumer</span></code> method of logfiles has also been removed.</p>
<p>The <a class="reference internal" href="#buildbot.process.log.Log.subscribe" title="buildbot.process.log.Log.subscribe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">subscribe</span></code></a> method now takes a callable, rather than an instance, and does not support catchup.
This method was primarily used by <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a>, the implementation of which has been modified accordingly.
Any other uses of the subscribe method should be refactored to use a <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a>.</p>
</div>
<div class="section" id="status-strings">
<h5>2.12.2.7. Status Strings<a class="headerlink" href="#status-strings" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">self.step_status.setText</span></code> and <code class="docutils literal notranslate"><span class="pre">setText2</span></code> methods have been removed.
Similarly, the <code class="docutils literal notranslate"><span class="pre">_describe</span></code> and <code class="docutils literal notranslate"><span class="pre">describe</span></code> methods are not used in new-style steps.
In fact, steps no longer set their status directly.</p>
<p>Instead, steps call <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.updateSummary" title="buildbot.process.buildstep.BuildStep.updateSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.updateSummary</span></code></a> whenever the status may have changed.
This method calls <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getCurrentSummary" title="buildbot.process.buildstep.BuildStep.getCurrentSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getCurrentSummary</span></code></a> or <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getResultSummary" title="buildbot.process.buildstep.BuildStep.getResultSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getResultSummary</span></code></a> as appropriate and update displays of the step’s status.
Steps override the latter two methods to provide appropriate summaries.</p>
</div>
<div class="section" id="statistics">
<h5>2.12.2.8. Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h5>
<p>Support for statistics has been moved to the <code class="docutils literal notranslate"><span class="pre">BuildStep</span></code> and <code class="docutils literal notranslate"><span class="pre">Build</span></code> objects.
Calls to <code class="docutils literal notranslate"><span class="pre">self.step_status.setStatistic</span></code> should be rewritten as <code class="docutils literal notranslate"><span class="pre">self.setStatistic</span></code>.</p>
</div>
</div>
<span id="document-manual/upgrading/worker-transition"></span><div class="section" id="transition-to-worker-terminology">
<span id="id1"></span><h4>2.12.3. Transition to “worker” terminology<a class="headerlink" href="#transition-to-worker-terminology" title="Permalink to this headline">¶</a></h4>
<p>Since version 0.9.0 of Buildbot “slave”-based terminology is deprecated
in favor of “worker”-based terminology.</p>
<p>API change is done in backward compatible way, so old “slave”-containing
classes, functions and attributes are still available and can be used.
Old API support will be removed in the future versions of Buildbot.</p>
<p>Rename of API introduced in beta versions of Buildbot 0.9.0 done without
providing fallback.
See release notes for the list of breaking changes of private interfaces.</p>
<div class="section" id="old-names-fallback-settings">
<h5>2.12.3.1. Old names fallback settings<a class="headerlink" href="#old-names-fallback-settings" title="Permalink to this headline">¶</a></h5>
<p>Use of obsolete names will raise Python warnings with category
<code class="xref py py-exc docutils literal notranslate"><span class="pre">buildbot.worker_transition.DeprecatedWorkerAPIWarning</span></code>.
By default these warnings are printed in the application log.
This behaviour can be changed by setting appropriate Python warnings settings
via Python’s <code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code> module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">buildbot.worker_transition</span> <span class="kn">import</span> <span class="n">DeprecatedWorkerAPIWarning</span>
<span class="c1"># Treat old-name usage as errors:</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="n">DeprecatedWorkerAPIWarning</span><span class="p">)</span>
</pre></div>
</div>
<p>See Python’s <code class="xref py py-mod docutils literal notranslate"><span class="pre">warnings</span></code> module documentation for complete list of
available actions, in particular warnings can be disabled using
<code class="docutils literal notranslate"><span class="pre">&quot;ignore&quot;</span></code> action.</p>
<p>It’s recommended to configure warnings inside <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>, before
using any other Buildbot classes.</p>
</div>
<div class="section" id="changed-api">
<h5>2.12.3.2. Changed API<a class="headerlink" href="#changed-api" title="Permalink to this headline">¶</a></h5>
<p>In general “Slave” and “Buildslave” parts in identifiers and messages were
replaced with “Worker”; “SlaveBuilder” with “WorkerForBuilder”.</p>
<p>Below is the list of changed API (use of old names from this list will work).
Note that some of these symbols are not included in Buildbot’s public API.
Compatibility is provided as a convenience to those using the private symbols
anyway.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.IBuildSlave</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">IWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.NoSlaveError</span></code> (private)</td>
<td>left as is, but deprecated (it shouldn’t be used at all)</td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.BuildSlaveTooOldError</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerTooOldError</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.LatentBuildSlaveFailedToSubstantiate</span></code>
(private)</td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">LatentWorkerFailedToSubstantiate</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.ILatentBuildSlave</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">ILatentWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.ISlaveStatus</span></code> (will be removed in 0.9.x)</td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">IWorkerStatus</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.buildslave</span></code> module with all contents</td>
<td><a class="reference internal" href="#module-buildbot.worker" title="buildbot.worker"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.slavename</span></code> (private)</td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.workername</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractLatentBuildSlave</span></code></td>
<td><a class="reference internal" href="#buildbot.worker.AbstractLatentWorker" title="buildbot.worker.AbstractLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.AbstractLatentWorker</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.BuildSlave</span></code></td>
<td><a class="reference internal" href="#buildbot.worker.Worker" title="buildbot.worker.Worker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.Worker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.buildslave.ec2</span></code></td>
<td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker.ec2</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.ec2.EC2LatentBuildSlave</span></code></td>
<td><a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.ec2.EC2LatentWorker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.buildslave.libvirt</span></code></td>
<td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker.libvirt</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.libvirt.LibVirtSlave</span></code></td>
<td><a class="reference internal" href="#buildbot.worker.libvirt.LibVirtWorker" title="buildbot.worker.libvirt.LibVirtWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.libvirt.LibVirtWorker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.buildslave.openstack</span></code></td>
<td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker.openstack</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.openstack.OpenStackLatentBuildSlave</span></code></td>
<td><a class="reference internal" href="#buildbot.worker.openstack.OpenStackLatentWorker" title="buildbot.worker.openstack.OpenStackLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.openstack.OpenStackLatentWorker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.config.MasterConfig.slaves</span></code></td>
<td><a class="reference internal" href="#buildbot.config.MasterConfig.workers" title="buildbot.config.MasterConfig.workers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">workers</span></code></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#buildbot.config.BuilderConfig" title="buildbot.config.BuilderConfig"><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.config.BuilderConfig</span></code></a> constructor keyword argument
<code class="docutils literal notranslate"><span class="pre">slavename</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workername</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#buildbot.config.BuilderConfig" title="buildbot.config.BuilderConfig"><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.config.BuilderConfig</span></code></a> constructor keyword argument
<code class="docutils literal notranslate"><span class="pre">slavenames</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workernames</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#buildbot.config.BuilderConfig" title="buildbot.config.BuilderConfig"><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.config.BuilderConfig</span></code></a> constructor keyword argument
<code class="docutils literal notranslate"><span class="pre">slavebuilddir</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workerbuilddir</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#buildbot.config.BuilderConfig" title="buildbot.config.BuilderConfig"><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.config.BuilderConfig</span></code></a> constructor keyword argument
<code class="docutils literal notranslate"><span class="pre">nextSlave</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">nextWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.config.BuilderConfig.slavenames</span></code></td>
<td><a class="reference internal" href="#buildbot.config.BuilderConfig.workernames" title="buildbot.config.BuilderConfig.workernames"><code class="xref py py-attr docutils literal notranslate"><span class="pre">workernames</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.config.BuilderConfig.slavebuilddir</span></code></td>
<td><a class="reference internal" href="#buildbot.config.BuilderConfig.workerbuilddir" title="buildbot.config.BuilderConfig.workerbuilddir"><code class="xref py py-attr docutils literal notranslate"><span class="pre">workerbuilddir</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.config.BuilderConfig.nextSlave</span></code></td>
<td><a class="reference internal" href="#buildbot.config.BuilderConfig.nextWorker" title="buildbot.config.BuilderConfig.nextWorker"><code class="xref py py-attr docutils literal notranslate"><span class="pre">nextWorker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.slavebuilder</span></code></td>
<td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.workerforbuilder</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.slavebuilder.AbstractSlaveBuilder</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.workerforbuilder.AbstractWorkerForBuilder</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.slavebuilder.AbstractSlaveBuilder.slave</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.workerforbuilder.AbstractWorkerForBuilder.worker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.slavebuilder.SlaveBuilder</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.workerforbuilder.WorkerForBuilder</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.slavebuilder.LatentSlaveBuilder</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.workerforbuilder.LatentWorkerForBuilder</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.build.Build.getSlaveName</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">getWorkerName</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.build.Build.slavename</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">workername</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.process.builder.enforceChosenSlave</span></code></td>
<td><code class="xref py py-func docutils literal notranslate"><span class="pre">enforceChosenWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.builder.Builder.canStartWithSlavebuilder</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">canStartWithWorkerForBuilder</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.builder.Builder.attaching_slaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">attaching_workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.builder.Builder.slaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workers</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.builder.Builder.addLatentSlave</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">addLatentWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.builder.Builder.getAvailableSlaves</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">getAvailableWorkers</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.schedulers.forcesched.BuildslaveChoiceParameter</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerChoiceParameter</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.buildslave</span></code></td>
<td><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.worker" title="buildbot.process.buildstep.BuildStep.worker"><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.worker</span></code></a>
(also it was moved from class static attribute to instance attribute)</td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.setBuildSlave</span></code></td>
<td><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.setWorker" title="buildbot.process.buildstep.BuildStep.setWorker"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.setWorker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.slaveVersion</span></code></td>
<td><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.workerVersion" title="buildbot.process.buildstep.BuildStep.workerVersion"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.workerVersion</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.slaveVersionIsOlderThan</span></code></td>
<td><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.workerVersionIsOlderThan" title="buildbot.process.buildstep.BuildStep.workerVersionIsOlderThan"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.workerVersionIsOlderThan</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.checkSlaveHasCommand</span></code></td>
<td><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.checkWorkerHasCommand" title="buildbot.process.buildstep.BuildStep.checkWorkerHasCommand"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.checkWorkerHasCommand</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.getSlaveName</span></code></td>
<td><a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getWorkerName" title="buildbot.process.buildstep.BuildStep.getWorkerName"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.getWorkerName</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.SlaveLock</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.WorkerLock</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.locks.SlaveLock.maxCountForSlave</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.locks.WorkerLock.maxCountForWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.SlaveLock</span></code> constructor argument
<code class="docutils literal notranslate"><span class="pre">maxCountForSlave</span></code> was renamed</td>
<td><code class="docutils literal notranslate"><span class="pre">maxCountForWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.steps.slave</span></code></td>
<td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.steps.worker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.slave.SlaveBuildStep</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.worker.WorkerBuildStep</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.slave.CompositeStepMixin.getFileContentFromSlave</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.worker.CompositeStepMixin.getFileContentFromWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.transfer.FileUpload.slavesrc</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workersrc</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.transfer.FileUpload</span></code>
constructor argument <code class="docutils literal notranslate"><span class="pre">slavesrc</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workersrc</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.transfer.DirectoryUpload.slavesrc</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workersrc</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.transfer.DirectoryUpload</span></code>
constructor argument <code class="docutils literal notranslate"><span class="pre">slavesrc</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workersrc</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.transfer.MultipleFileUpload.slavesrcs</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workersrcs</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.transfer.MultipleFileUpload</span></code>
constructor argument <code class="docutils literal notranslate"><span class="pre">slavesrcs</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workersrcs</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.transfer.FileDownload.slavedest</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workerdest</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.transfer.FileDownload</span></code>
constructor argument <code class="docutils literal notranslate"><span class="pre">slavedest</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workerdest</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.transfer.StringDownload.slavedest</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workerdest</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.transfer.StringDownload</span></code>
constructor argument <code class="docutils literal notranslate"><span class="pre">slavedest</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workerdest</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.transfer.JSONStringDownload.slavedest</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workerdest</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.transfer.JSONStringDownload</span></code>
constructor argument <code class="docutils literal notranslate"><span class="pre">slavedest</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workerdest</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.transfer.JSONPropertiesDownload.slavedest</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workerdest</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.steps.transfer.JSONPropertiesDownload</span></code>
constructor argument <code class="docutils literal notranslate"><span class="pre">slavedest</span></code> was renamed to</td>
<td><code class="docutils literal notranslate"><span class="pre">workerdest</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.remotecommand.RemoteCommand.buildslave</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="plugins">
<h5>2.12.3.3. Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">buildbot.buildslave</span></code> entry point was renamed to <code class="docutils literal notranslate"><span class="pre">buildbot.worker</span></code>, new
plugins should be updated accordingly.</p>
<p>Plugins that use old <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave</span></code> entry point are still available
in the configuration file in the same way, as they were in versions prior
0.9.0:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">buildslave</span>  <span class="c1"># deprecated, use &quot;worker&quot; instead</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">buildslave</span><span class="o">.</span><span class="n">ThirdPartyWorker</span><span class="p">()</span>
</pre></div>
</div>
<p>But also they available using new namespace inside configuration
file, so its recommended to use <code class="docutils literal notranslate"><span class="pre">buildbot.plugins.worker</span></code>
name even if plugin uses old entry points:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">worker</span>
<span class="c1"># ThirdPartyWorker can be defined in using `buildbot.buildslave` entry</span>
<span class="c1"># point, this still will work.</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">worker</span><span class="o">.</span><span class="n">ThirdPartyWorker</span><span class="p">()</span>
</pre></div>
</div>
<p>Other changes:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">buildbot.plugins.util.BuildslaveChoiceParameter</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">WorkerChoiceParameter</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot.plugins.util.enforceChosenSlave</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">enforceChosenWorker</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot.plugins.util.SlaveLock</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">WorkerLock</span></code>.</li>
</ul>
</div>
<div class="section" id="buildmasterconfig-changes">
<h5>2.12.3.4. <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code> changes<a class="headerlink" href="#buildmasterconfig-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">c['slaves']</span></code> was replaced with <code class="docutils literal notranslate"><span class="pre">c['workers']</span></code>.
Use of <code class="docutils literal notranslate"><span class="pre">c['slaves']</span></code> will work, but is considered deprecated, and will be
removed in the future versions of Buildbot.</li>
<li>Configuration key <code class="docutils literal notranslate"><span class="pre">c['slavePortnum']</span></code> is deprecated in favor of
<code class="docutils literal notranslate"><span class="pre">c['protocols']['pb']['port']</span></code>.</li>
</ul>
</div>
<div class="section" id="docker-latent-worker-changes">
<h5>2.12.3.5. Docker latent worker changes<a class="headerlink" href="#docker-latent-worker-changes" title="Permalink to this headline">¶</a></h5>
<p>In addition to class being renamed, environment variables that are set inside
container <code class="docutils literal notranslate"><span class="pre">SLAVENAME</span></code> and <code class="docutils literal notranslate"><span class="pre">SLAVEPASS</span></code> were renamed to
<code class="docutils literal notranslate"><span class="pre">WORKERNAME</span></code> and <code class="docutils literal notranslate"><span class="pre">WORKERPASS</span></code> accordingly.
Old environment variable are still available, but are deprecated and will be
removed in the future.</p>
</div>
<div class="section" id="ec2-latent-worker-changes">
<h5>2.12.3.6. EC2 latent worker changes<a class="headerlink" href="#ec2-latent-worker-changes" title="Permalink to this headline">¶</a></h5>
<p>Use of default values of <code class="docutils literal notranslate"><span class="pre">keypair_name</span></code> and <code class="docutils literal notranslate"><span class="pre">security_name</span></code>
constructor arguments of <a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.ec2.EC2LatentWorker</span></code></a>
is deprecated. Please specify them explicitly.</p>
</div>
<div class="section" id="steps-slave-setpropertiesfromenv-changes">
<h5>2.12.3.7. <code class="docutils literal notranslate"><span class="pre">steps.slave.SetPropertiesFromEnv</span></code> changes<a class="headerlink" href="#steps-slave-setpropertiesfromenv-changes" title="Permalink to this headline">¶</a></h5>
<p>In addition to <code class="docutils literal notranslate"><span class="pre">buildbot.steps.slave</span></code> module being renamed to
<code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.steps.worker</span></code>, default <code class="docutils literal notranslate"><span class="pre">source</span></code> value for
<code class="xref py py-class docutils literal notranslate"><span class="pre">SetPropertiesFromEnv</span></code> was changed from
<code class="docutils literal notranslate"><span class="pre">&quot;SlaveEnvironment&quot;</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;WorkerEnvironment&quot;</span></code>.</p>
</div>
<div class="section" id="local-worker-changes">
<h5>2.12.3.8. Local worker changes<a class="headerlink" href="#local-worker-changes" title="Permalink to this headline">¶</a></h5>
<p>Working directory for local workers were changed from
<code class="docutils literal notranslate"><span class="pre">master-basedir/slaves/name</span></code> to <code class="docutils literal notranslate"><span class="pre">master-basedir/workers/name</span></code>.</p>
</div>
<div class="section" id="worker-manager-changes">
<h5>2.12.3.9. Worker Manager changes<a class="headerlink" href="#worker-manager-changes" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">slave_config</span></code> function argument was renamed to <code class="docutils literal notranslate"><span class="pre">worker_config</span></code>.</p>
</div>
<div class="section" id="properties">
<h5>2.12.3.10. Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">slavename</span></code> property is deprecated in favor of <code class="docutils literal notranslate"><span class="pre">workername</span></code> property.
Render of deprecated property will produce warning.</p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker</span></code>
(previously <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave</span></code>) <code class="docutils literal notranslate"><span class="pre">slavename</span></code>
property source were changed from <code class="docutils literal notranslate"><span class="pre">BuildSlave</span></code> to
<code class="docutils literal notranslate"><span class="pre">Worker</span> <span class="pre">(deprecated)</span></code></p>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractWorker</span></code> now sets <code class="docutils literal notranslate"><span class="pre">workername</span></code>
property with source <code class="docutils literal notranslate"><span class="pre">Worker</span></code> which should be used.</p>
</li>
</ul>
</div>
<div class="section" id="metrics">
<h5>2.12.3.11. Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.metrics.AttachedSlavesWatcher</span></code> was renamed to
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.metrics.AttachedWorkersWatcher</span></code>.</li>
<li><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.manager.WorkerManager.name</span></code>
(previously <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.manager.BuildslaveManager.name</span></code>) metric
measurement class name changed from <code class="docutils literal notranslate"><span class="pre">BuildslaveManager</span></code> to <code class="docutils literal notranslate"><span class="pre">WorkerManager</span></code></li>
<li><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.manager.WorkerManager.managed_services_name</span></code>
(previously <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.manager.BuildslaveManager.managed_services_name`)</span>
<span class="pre">metric</span> <span class="pre">measurement</span> <span class="pre">managed</span> <span class="pre">service</span> <span class="pre">name</span> <span class="pre">changed</span> <span class="pre">from</span> <span class="pre">``buildslaves</span></code> to
<code class="docutils literal notranslate"><span class="pre">workers</span></code></li>
</ul>
<p>Renamed events:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">AbstractBuildSlave.attached_slaves</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">AbstractWorker.attached_workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">BotMaster.attached_slaves</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">BotMaster.attached_workers</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">BotMaster.slaveLost()</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">BotMaster.workerLost()</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">BotMaster.getBuildersForSlave()</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">BotMaster.getBuildersForWorker()</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">AttachedSlavesWatcher</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">AttachedWorkersWatcher</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">attached_slaves</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">attached_workers</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="database">
<h5>2.12.3.12. Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h5>
<p>Schema changes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">buildslaves</span></code> table</td>
<td><code class="docutils literal notranslate"><span class="pre">workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">builds.buildslaveid</span></code> (not ForeignKey) column</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code> (now ForeignKey)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">configured_buildslaves</span></code> table</td>
<td><code class="docutils literal notranslate"><span class="pre">configured_workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">configured_buildslaves.buildslaveid</span></code> (ForeignKey) column</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">connected_buildslaves</span></code> table</td>
<td><code class="docutils literal notranslate"><span class="pre">connected_workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">connected_buildslaves.buildslaveid</span></code> (ForeignKey) column</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">buildslaves_name</span></code> index</td>
<td><code class="docutils literal notranslate"><span class="pre">workers_name</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">configured_slaves_buildmasterid</span></code> index</td>
<td><code class="docutils literal notranslate"><span class="pre">configured_workers_buildmasterid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">configured_slaves_slaves</span></code> index</td>
<td><code class="docutils literal notranslate"><span class="pre">configured_workers_workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">configured_slaves_identity</span></code> index</td>
<td><code class="docutils literal notranslate"><span class="pre">configured_workers_identity</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">connected_slaves_masterid</span></code> index</td>
<td><code class="docutils literal notranslate"><span class="pre">connected_workers_masterid</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">connected_slaves_slaves</span></code> index</td>
<td><code class="docutils literal notranslate"><span class="pre">connected_workers_workers</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">connected_slaves_identity</span></code> index</td>
<td><code class="docutils literal notranslate"><span class="pre">connected_workers_identity</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">builds_buildslaveid</span></code> index</td>
<td><code class="docutils literal notranslate"><span class="pre">builds_workerid</span></code></td>
</tr>
</tbody>
</table>
<p>List of database-related changes in API (fallback for old API is provided):</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.db.buildslaves</span></code></td>
<td><a class="reference internal" href="#module-buildbot.db.workers" title="buildbot.db.workers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">workers</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent</span></code></td>
<td><a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent" title="buildbot.db.workers.WorkersConnectorComponent"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.db.workers.WorkersConnectorComponent</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.getBuildslaves</span></code>
(rewritten in nine)</td>
<td><a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent.getWorkers" title="buildbot.db.workers.WorkersConnectorComponent.getWorkers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.workers.WorkersConnectorComponent.getWorkers</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.db.connector.DBConnector.buildslaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.db.connector.DBConnector.workers</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="usepty-changes">
<h5>2.12.3.13. <code class="docutils literal notranslate"><span class="pre">usePTY</span></code> changes<a class="headerlink" href="#usepty-changes" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">usePTY</span></code> default value has been changed from <code class="docutils literal notranslate"><span class="pre">slave-config</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> (use of <code class="docutils literal notranslate"><span class="pre">slave-config</span></code> will still work, but discouraged).</p>
</div>
<div class="section" id="buildbot-worker">
<span id="worker-transition-buildbot-worker"></span><h5>2.12.3.14. <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code><a class="headerlink" href="#buildbot-worker" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package has been renamed to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> has backward incompatible changes and requires buildmaster &gt;= 0.9.0b8.
<code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> from 0.8.x will work with both 0.8.x and 0.9.x versions of buildmaster, so there is no need to upgrade currently deployed buildbot-slaves during switch from 0.8.x to 0.9.x.</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text">Master/worker compatibility table</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head stub">&#160;</th>
<th class="head">master 0.8.x</th>
<th class="head">master 0.9.x</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><th class="stub">buildbot-slave</th>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-odd"><th class="stub">buildbot-worker</th>
<td>no</td>
<td>yes</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> doesn’t support worker-side specification of <code class="docutils literal notranslate"><span class="pre">usePTY</span></code> (with <code class="docutils literal notranslate"><span class="pre">--usepty</span></code> command line switch of <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code>), you need to specify this option on master side.</p>
<p><code class="docutils literal notranslate"><span class="pre">getSlaveInfo</span></code> remote command was renamed to <code class="docutils literal notranslate"><span class="pre">getWorkerInfo</span></code> in <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-developer/index"></span><div class="section" id="buildbot-development">
<span id="id1"></span><h2>3. Buildbot Development<a class="headerlink" href="#buildbot-development" title="Permalink to this headline">¶</a></h2>
<p>This chapter is the official repository for the collected wisdom of the Buildbot hackers.
It is intended both for developers writing patches that will be included in Buildbot itself, and for advanced users who wish to customize Buildbot.</p>
<div class="toctree-wrapper compound">
<span id="document-developer/quickstart"></span><div class="section" id="development-quick-start">
<h3>3.1. Development Quick-start<a class="headerlink" href="#development-quick-start" title="Permalink to this headline">¶</a></h3>
<p>Buildbot is a python based application.
It tries very hard to follow the python best practices, and to make is easy to dive into the code.</p>
<p>We won’t try to create a full step by step how to install python on whatever distribution.
Basically what you need is just a python environment with maybe some native packages required by our dependencies.
Because those dependencies sometimes change, we keep the most up to date list in the docker file we use to manage our CI (<a class="reference external" href="https://github.com/buildbot/metabbotcfg/blob/nine/docker/metaworker/Dockerfile">MetaBBotDockerFile</a>).</p>
<p>If you are completely new to python, the best is to first follow the tutorials that would come when you type “python virtualenv for dummies” in your favorite search engine.</p>
<div class="section" id="create-a-buildbot-python-environment">
<span id="pythondevquickstart"></span><h4>3.1.1. Create a Buildbot Python Environment<a class="headerlink" href="#create-a-buildbot-python-environment" title="Permalink to this headline">¶</a></h4>
<p>Buildbot uses Twisted <a class="reference external" href="http://twistedmatrix.com/trac/wiki/TwistedTrial">trial</a> to run its test suite.</p>
<p>Following is a quick shell session to put you on the right track, including running the test suite.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># the usual buildbot development bootstrap with git and virtualenv</span>
git clone https://github.com/buildbot/buildbot
<span class="nb">cd</span> buildbot

<span class="c1"># helper script which creates the virtualenv for development</span>
make virtualenv
. .venv/bin/activate

<span class="c1"># now we run the test suite</span>
trial buildbot

<span class="c1"># find all tests that talk about mail</span>
trial -n --reporter<span class="o">=</span>bwverbose buildbot <span class="p">|</span> grep mail

<span class="c1"># run only one test module</span>
trial buildbot.test.unit.test_reporters_mail
</pre></div>
</div>
</div>
<div class="section" id="create-a-javascript-frontend-environment">
<h4>3.1.2. Create a JavaScript Frontend Environment<a class="headerlink" href="#create-a-javascript-frontend-environment" title="Permalink to this headline">¶</a></h4>
<p>This section describes how to get set up quickly to hack on the JavaScript UI.
It does not assume familiarity with Python, although a Python installation is required, as well as <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>.
You will also need <code class="docutils literal notranslate"><span class="pre">NodeJS</span></code>, and <code class="docutils literal notranslate"><span class="pre">npm</span></code> installed.</p>
<div class="section" id="prerequisites">
<h5>3.1.2.1. Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h5>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Buildbot UI is only tested to build on node 4.x.x.</p>
</div>
<ul>
<li><p class="first">Install LTS release of node.js.</p>
<p><a class="reference external" href="http://nodejs.org/">http://nodejs.org/</a> is a good start for windows and osx</p>
<p>For Linux, as node.js is evolving very fast, distros versions are often too old, and sometimes distro maintainers make incompatible changes (i.e naming node binary nodejs instead of node)
For Ubuntu and other Debian based distros, you want to use following method:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>curl -sL https://deb.nodesource.com/setup_4.x | sudo bash -
</pre></div>
</div>
<p>Please feel free to update this documentation for other distros.
Know good source for Linux binary distribution is: <a class="reference external" href="https://github.com/nodesource/distributions">https://github.com/nodesource/distributions</a></p>
</li>
<li><p class="first">Install gulp globally. Gulp is the build system used for coffeescript development.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo npm install -g gulp
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="hacking-the-buildbot-javascript">
<span id="jsdevquickstart"></span><h5>3.1.2.2. Hacking the Buildbot JavaScript<a class="headerlink" href="#hacking-the-buildbot-javascript" title="Permalink to this headline">¶</a></h5>
<p>To effectively hack on the Buildbot JavaScript, you’ll need a running Buildmaster, configured to operate out of the source directory (unless you like editing minified JS).</p>
<p>thus you need to follow the <a class="reference internal" href="#pythondevquickstart"><span class="std std-ref">Create a Buildbot Python Environment</span></a></p>
<p>This should have created an isolated Python environment in which you can install packages without affecting other parts of the system.
You should see <code class="docutils literal notranslate"><span class="pre">(.venv)</span></code> in your shell prompt, indicating the sandbox is activated.</p>
<p>Next, install the Buildbot-WWW and Buildbot packages using <code class="docutils literal notranslate"><span class="pre">--editable</span></code>, which means that they should execute from the source directory.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>make frontend
</pre></div>
</div>
<p>This will fetch a number of dependencies from pypi, the Python package repository.
This will also fetch a bunch a bunch of node.js dependencies used for building the web application, and a bunch of client side js dependencies, with bower</p>
<p>Now you’ll need to create a master instance.
For a bit more detail, see the Buildbot tutorial (<a class="reference internal" href="#first-run-label"><span class="std std-ref">First Run</span></a>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot create-master .venv/testmaster
mv .venv/testmaster/master.cfg.sample .venv/testmaster/master.cfg
buildbot start .venv/testmaster
</pre></div>
</div>
<p>If all goes well, the master will start up and begin running in the background.
As you just installed www in editable mode (aka ‘develop’ mode), setup.py did build the web site in prod mode, so the everything is minified, making it hard to debug.</p>
<p>When doing web development, you usually run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd www/base
gulp dev
</pre></div>
</div>
<p>This will compile the base webapp in development mode, and automatically rebuild when files change.</p>
</div>
</div>
</div>
<span id="document-developer/general"></span><div class="section" id="general-documents">
<h3>3.2. General Documents<a class="headerlink" href="#general-documents" title="Permalink to this headline">¶</a></h3>
<p>This section gives some general information about Buildbot development.</p>
<div class="toctree-wrapper compound">
<span id="document-developer/master-overview"></span><div class="section" id="master-organization">
<span id="master-service-hierarchy"></span><h4>3.2.1. Master Organization<a class="headerlink" href="#master-organization" title="Permalink to this headline">¶</a></h4>
<p>Buildbot makes heavy use of Twisted Python’s support for services - software
modules that can be started and stopped dynamically.  Buildbot adds the ability
to reconfigure such services, too - see <a class="reference internal" href="#developer-reconfiguration"><span class="std std-ref">Reconfiguration</span></a>.
Twisted arranges services into trees; the following section describes the
service tree on a running master.</p>
<div class="section" id="buildmaster-object">
<h5>3.2.1.1. BuildMaster Object<a class="headerlink" href="#buildmaster-object" title="Permalink to this headline">¶</a></h5>
<p>The hierarchy begins with the master, a <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.master.BuildMaster</span></code>
instance.  Most other services contain a reference to this object in their
<code class="docutils literal notranslate"><span class="pre">master</span></code> attribute, and in general the appropriate way to access other
objects or services is to begin with <code class="docutils literal notranslate"><span class="pre">self.master</span></code> and navigate from there.</p>
<p>The master has a number of useful attributes:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">master.metrics</span></code></dt>
<dd>A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.metrics.MetricLogObserver</span></code> instance that
handles tracking and reporting on master metrics.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.caches</span></code></dt>
<dd>A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.caches.CacheManager</span></code> instance that provides
access to object caches.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.pbmanager</span></code></dt>
<dd>A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.pbmanager.PBManager</span></code> instance that handles incoming
PB connections, potentially on multiple ports, and dispatching those
connections to appropriate components based on the supplied username.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.workers</span></code></dt>
<dd>A <a class="reference internal" href="#buildbot.worker.manager.WorkerManager" title="buildbot.worker.manager.WorkerManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.manager.WorkerManager</span></code></a> instance that
provides wrapper around multiple master-worker protocols(e.g. PB) to unify
calls for them from higher level code</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.change_svc</span></code></dt>
<dd>A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.changes.manager.ChangeManager</span></code> instance that manages
the active change sources, as well as the stream of changes received from
those sources.  All active change sources are child services of this instance.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.botmaster</span></code></dt>
<dd><p class="first">A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.botmaster.BotMaster</span></code> instance that manages
all of the workers and builders as child services.</p>
<p class="last">The botmaster acts as the parent service for a
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.botmaster.BuildRequestDistributor</span></code> instance (at
<code class="docutils literal notranslate"><span class="pre">master.botmaster.brd</span></code>) as well as all active workers
(<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker</span></code> instances) and builders
(<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.builder.Builder</span></code> instances).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.scheduler_manager</span></code></dt>
<dd>A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.schedulers.manager.SchedulerManager</span></code> instance that
manages the active schedulers.  All active schedulers are child services of
this instance.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.user_manager</span></code></dt>
<dd>A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.users.manager.UserManagerManager</span></code> instance
that manages access to users.  All active user managers are child services
of this instance.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.db</span></code></dt>
<dd>A <a class="reference internal" href="#buildbot.db.connector.DBConnector" title="buildbot.db.connector.DBConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.db.connector.DBConnector</span></code></a> instance that manages
access to the buildbot database.  See <a class="reference internal" href="#developer-database"><span class="std std-ref">Database</span></a> for more
information.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.debug</span></code></dt>
<dd>A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.debug.DebugServices</span></code> instance that manages
debugging-related access – the manhole, in particular.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.status</span></code></dt>
<dd>A <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.status.master.Status</span></code> instance that provides access
to all status data.  This instance is also the service parent for all
status listeners.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master.masterid</span></code></dt>
<dd>This is the ID for this master, from the <code class="docutils literal notranslate"><span class="pre">masters</span></code> table.
It is used in the database and messages to uniquely identify this master.</dd>
</dl>
</div>
</div>
<span id="document-developer/style"></span><div class="section" id="buildbot-coding-style">
<h4>3.2.2. Buildbot Coding Style<a class="headerlink" href="#buildbot-coding-style" title="Permalink to this headline">¶</a></h4>
<div class="section" id="documentation">
<h5>3.2.2.1. Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h5>
<p>Buildbot strongly encourages developers to document the methods, behavior, and usage of classes that users might interact with.
However, this documentation should be in <code class="docutils literal notranslate"><span class="pre">.rst</span></code> files under <code class="docutils literal notranslate"><span class="pre">master/docs/developer</span></code>, rather than in docstrings within the code.
For private methods or where code deserves some kind of explanatory preface, use comments instead of a docstring.
While some docstrings remain within the code, these should be migrated to documentation files and removed as the code is modified.</p>
<p>Within the reStructuredText files, write with each English sentence on its own line.
While this does not affect the generated output, it makes git diffs between versions of the documentation easier to read, as they are not obscured by changes due to re-wrapping.
This convention is not followed everywhere, but we are slowly migrating documentation from the old (wrapped) style as we update it.</p>
</div>
<div class="section" id="symbol-names">
<h5>3.2.2.2. Symbol Names<a class="headerlink" href="#symbol-names" title="Permalink to this headline">¶</a></h5>
<p>Buildbot follows <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8</a> regarding the formatting of symbol names.
Because Buildbot uses Twisted so heavily, and Twisted uses interCaps, this is not very consistently applied throughout the codebase.</p>
<p>The single exception to PEP8 is in naming of functions and methods.
That is, you should spell methods and functions with the first character in lower-case, and the first letter of subsequent words capitalized, e.g., <code class="docutils literal notranslate"><span class="pre">compareToOther</span></code> or <code class="docutils literal notranslate"><span class="pre">getChangesGreaterThan</span></code>.</p>
<p>Symbols used as parameters to functions used in configuration files should use underscores.</p>
<p>In summary, then:</p>
<table border="1" class="docutils">
<colgroup>
<col width="65%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Symbol Type</th>
<th class="head">Format</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Methods</td>
<td>interCaps</td>
</tr>
<tr class="row-odd"><td>Functions</td>
<td>interCaps</td>
</tr>
<tr class="row-even"><td>Function Arguments</td>
<td>under_scores</td>
</tr>
<tr class="row-odd"><td>API method Arguments</td>
<td>interCaps</td>
</tr>
<tr class="row-even"><td>Classes</td>
<td>InitialCaps</td>
</tr>
<tr class="row-odd"><td>Variables</td>
<td>under_scores</td>
</tr>
<tr class="row-even"><td>Constants</td>
<td>ALL_CAPS</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="twisted-idioms">
<h5>3.2.2.3. Twisted Idioms<a class="headerlink" href="#twisted-idioms" title="Permalink to this headline">¶</a></h5>
<p>Programming with Twisted Python can be daunting.  But sticking to a few
well-defined patterns can help avoid surprises.</p>
<div class="section" id="prefer-to-return-deferreds">
<h6>Prefer to Return Deferreds<a class="headerlink" href="#prefer-to-return-deferreds" title="Permalink to this headline">¶</a></h6>
<p>If you’re writing a method that doesn’t currently block, but could conceivably
block sometime in the future, return a Deferred and document that it does so.
Just about anything might block - even getters and setters!</p>
</div>
<div class="section" id="helpful-twisted-classes">
<h6>Helpful Twisted Classes<a class="headerlink" href="#helpful-twisted-classes" title="Permalink to this headline">¶</a></h6>
<p>Twisted has some useful, but little-known classes.
Brief descriptions follow, but you should consult the API documentation or source code
for the full details.</p>
<dl class="docutils">
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.task.LoopingCall</span></code></dt>
<dd>Calls an asynchronous function repeatedly at set intervals.
Note that this will stop looping if the function fails.
In general, you will want to wrap the function to capture and log errors.</dd>
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.application.internet.TimerService</span></code></dt>
<dd>Similar to <code class="docutils literal notranslate"><span class="pre">t.i.t.LoopingCall</span></code>, but implemented as a service that will automatically start and stop the function calls when the service starts and stops.
See the warning about failing functions for <code class="docutils literal notranslate"><span class="pre">t.i.t.LoopingCall</span></code>.</dd>
</dl>
</div>
<div class="section" id="sequences-of-operations">
<h6>Sequences of Operations<a class="headerlink" href="#sequences-of-operations" title="Permalink to this headline">¶</a></h6>
<p>Especially in Buildbot, we’re often faced with executing a sequence of
operations, many of which may block.</p>
<p>In all cases where this occurs, there is a danger of pre-emption, so exercise
the same caution you would if writing a threaded application.</p>
<p>For simple cases, you can use nested callback functions. For more complex cases, inlineCallbacks is appropriate.
In all cases, please prefer maintainability and readability over performance.</p>
<div class="section" id="nested-callbacks">
<h7>Nested Callbacks<a class="headerlink" href="#nested-callbacks" title="Permalink to this headline">¶</a></h7>
<p>First, an admonition: do not create extra class methods that represent the continuations of the first:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="o">...</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_myMethod_2</span><span class="p">)</span> <span class="c1"># BAD!</span>
<span class="k">def</span> <span class="nf">_myMethod_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>         <span class="c1"># BAD!</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Invariably, this extra method gets separated from its parent as the code
evolves, and the result is completely unreadable. Instead, include all of the
code for a particular function or method within the same indented block, using
nested functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getRevInfo</span><span class="p">(</span><span class="n">revname</span><span class="p">):</span>
    <span class="c1"># for example only! See above a better implementation with inlineCallbacks</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rev_parse</span><span class="p">(</span><span class="n">_</span><span class="p">):</span> <span class="c1"># note use of &#39;_&#39; to quietly indicate an ignored parameter</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="n">revname</span> <span class="p">])</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">rev_parse</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parse_rev_parse</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;rev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;--format=</span><span class="si">%s</span><span class="s1">%n%b&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;rev&#39;</span><span class="p">]</span> <span class="p">])</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">parse_rev_parse</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parse_log</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">parse_log</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_results</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">set_results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>it is usually best to make the first operation occur within a callback, as the
deferred machinery will then handle any exceptions as a failure in the outer
Deferred.  As a shortcut, <code class="docutils literal notranslate"><span class="pre">d.addCallback</span></code> works as a decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="nd">@d.addCallback</span>
<span class="k">def</span> <span class="nf">rev_parse</span><span class="p">(</span><span class="n">_</span><span class="p">):</span> <span class="c1"># note use of &#39;_&#39; to quietly indicate an ignored parameter</span>
    <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="n">revname</span> <span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">d.addCallback</span></code> is not really a decorator as it does not return a modified function.
As a result in previous code, <code class="docutils literal notranslate"><span class="pre">rev_parse</span></code> value is actually the Deferred.
In general the <code class="xref py py-class docutils literal notranslate"><span class="pre">inlineCallbacks</span></code> method is preferred inside new code as it keeps the code easier to read.
As a general rule of thumb, when you need more than 2 callbacks in the same method, it’s time to switch it to  <code class="xref py py-class docutils literal notranslate"><span class="pre">inlineCallbacks</span></code>.
This would be for example the case for previous <code class="xref py py-func docutils literal notranslate"><span class="pre">getRevInfo</span></code>.
See this <a class="reference external" href="https://github.com/buildbot/buildbot/pull/2523">discussion</a> with Twisted experts for more information.</p>
</div>
<p>Be careful with local variables. For example, if <code class="docutils literal notranslate"><span class="pre">parse_rev_parse</span></code>, above,
merely assigned <code class="docutils literal notranslate"><span class="pre">rev</span> <span class="pre">=</span> <span class="pre">res.strip()</span></code>, then that variable would be local to
<code class="docutils literal notranslate"><span class="pre">parse_rev_parse</span></code> and not available in <code class="docutils literal notranslate"><span class="pre">set_results</span></code>. Mutable variables
(dicts and lists) at the outer function level are appropriate for this purpose.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">do not try to build a loop in this style by chaining multiple
Deferreds!  Unbounded chaining can result in stack overflows, at least on older
versions of Twisted. Use <code class="docutils literal notranslate"><span class="pre">inlineCallbacks</span></code> instead.</p>
</div>
<p>In most of the cases if you need more than two callbacks in a method, it is more readable and maintainable to use inlineCallbacks.</p>
</div>
<div class="section" id="inlinecallbacks">
<h7>inlineCallbacks<a class="headerlink" href="#inlinecallbacks" title="Permalink to this headline">¶</a></h7>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.defer.inlineCallbacks</span></code> is a great help to writing code
that makes a lot of asynchronous calls, particularly if those calls are made in
loop or conditionals.  Refer to the Twisted documentation for the details, but
the style within Buildbot is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span>

<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">mymethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">xval</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">getSomething</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="k">yield</span> <span class="n">getZValues</span><span class="p">()):</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">z</span>

    <span class="k">if</span> <span class="n">xval</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">xval</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">someOtherMethod</span><span class="p">()</span>
</pre></div>
</div>
<p>The key points to notice here:</p>
<ul class="simple">
<li>Always import <code class="docutils literal notranslate"><span class="pre">defer</span></code> as a module, not the names within it.</li>
<li>Use the decorator form of <code class="docutils literal notranslate"><span class="pre">inlineCallbacks</span></code>.</li>
<li>In most cases, the result of a <code class="docutils literal notranslate"><span class="pre">yield</span></code> expression should be assigned to a
variable.  It can be used in a larger expression, but remember that Python
requires that you enclose the expression in its own set of parentheses.</li>
<li>Python does not permit returning a value from a generator, so statements like
<code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">xval</span> <span class="pre">+</span> <span class="pre">y</span></code> are invalid.  Instead, yield the result of
<code class="docutils literal notranslate"><span class="pre">defer.returnValue</span></code>.  Although this function does cause an immediate
function exit, for clarity follow it with a bare <code class="docutils literal notranslate"><span class="pre">return</span></code>, as in
the example, unless it is the last statement in a function.</li>
</ul>
<p>The great advantage of <code class="docutils literal notranslate"><span class="pre">inlineCallbacks</span></code> is that it allows you to use all
of the usual Pythonic control structures in their natural form. In particular,
it is easy to represent a loop, or even nested loops, in this style without
losing any readability.</p>
<p>Note that code using <code class="docutils literal notranslate"><span class="pre">deferredGenerator</span></code> is no longer acceptable in Buildbot.</p>
<p>The previous <code class="xref py py-func docutils literal notranslate"><span class="pre">getRevInfo</span></code> example implementation should rather be written as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">getRevInfo</span><span class="p">(</span><span class="n">revname</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="n">revname</span> <span class="p">])</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;rev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;--format=</span><span class="si">%s</span><span class="s1">%n%b&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;rev&#39;</span><span class="p">]</span> <span class="p">])</span>
    <span class="n">results</span><span class="p">[</span><span class="s1">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="locking">
<h7>Locking<a class="headerlink" href="#locking" title="Permalink to this headline">¶</a></h7>
<p>Remember that asynchronous programming does not free you from the need to worry
about concurrency issues.  Particularly if you are executing a sequence of
operations, each time you wait for a Deferred, arbitrary other actions can take
place.</p>
<p>In general, you should try to perform actions atomically, but for the rare
situations that require synchronization, the following might be useful:</p>
<ul class="simple">
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.defer.DeferredLock</span></code></li>
<li><a class="reference internal" href="#buildbot.util.misc.deferredLocked" title="buildbot.util.misc.deferredLocked"><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.util.misc.deferredLocked</span></code></a></li>
</ul>
</div>
</div>
<div class="section" id="joining-sequences">
<h6>Joining Sequences<a class="headerlink" href="#joining-sequences" title="Permalink to this headline">¶</a></h6>
<p>It’s often the case that you’ll want to perform multiple operations in
parallel, and re-join the results at the end. For this purpose, you’ll want to
use a <a class="reference external" href="http://twistedmatrix.com/documents/current/api/twisted.internet.defer.DeferredList.html">DeferredList</a>
:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getRevInfo</span><span class="p">(</span><span class="n">revname</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rev_parse</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="n">rev_parse_d</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="n">revname</span> <span class="p">])</span>
    <span class="k">def</span> <span class="nf">parse_rev_parse</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">rev_parse_d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">parse_rev_parse</span><span class="p">)</span>

    <span class="n">log_d</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">,</span> <span class="s1">&#39;--format=</span><span class="si">%s</span><span class="s1">%n%b&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s1">&#39;rev&#39;</span><span class="p">]</span> <span class="p">])</span>
    <span class="k">def</span> <span class="nf">parse_log</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">log_d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">parse_log</span><span class="p">)</span>

    <span class="n">d</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredList</span><span class="p">([</span><span class="n">rev_parse_d</span><span class="p">,</span> <span class="n">log_d</span><span class="p">],</span> <span class="n">consumeErrors</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fireOnFirstErrback</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">handle_results</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">rev</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">log</span><span class="o">=</span><span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">handle_results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>Here the deferred list will wait for both <code class="docutils literal notranslate"><span class="pre">rev_parse_d</span></code> and <code class="docutils literal notranslate"><span class="pre">log_d</span></code> to
fire, or for one of them to fail. You may attach callbacks and errbacks to a
<code class="docutils literal notranslate"><span class="pre">DeferredList</span></code> just as for a deferred.</p>
</div>
<div class="section" id="functions-running-outside-of-the-main-thread">
<h6>Functions running outside of the main thread<a class="headerlink" href="#functions-running-outside-of-the-main-thread" title="Permalink to this headline">¶</a></h6>
<p>It is very important in Twisted to be able to distinguish functions that runs in the main thread and functions that don’t, as reactors and deferreds can only be used in the main thread.
To make this distinction clearer, every functions meant to be started in a secondary thread must be prefixed with <code class="docutils literal notranslate"><span class="pre">thd_</span></code>.</p>
</div>
</div>
</div>
<span id="document-developer/coffeescript-style"></span><div class="section" id="coffeescript-coding-style">
<h4>3.2.3. CoffeeScript Coding Style<a class="headerlink" href="#coffeescript-coding-style" title="Permalink to this headline">¶</a></h4>
<p>The Buildbot development team is primarily Python experts and not front-end experts.
Whlie we did spend lot of time looking for front end best practices, we are happy to accept suggestions to this coding-style and best-practices guide.</p>
<p>Here is a summary of what is the expected coding style for buildbot contributions, as well as some common gotcha’s for developers with a Python background.</p>
<div class="section" id="coffeescript-looks-like-python">
<h5>3.2.3.1. CoffeeScript looks like Python<a class="headerlink" href="#coffeescript-looks-like-python" title="Permalink to this headline">¶</a></h5>
<p>Buildbot follows Python pep8 coding style as much as possible, except for naming convention (where twisted’s interCaps are preferred).
The same rules apply for CoffeeScript, whenever they makes sense:</p>
<table border="1" class="docutils">
<colgroup>
<col width="60%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Symbol Type</th>
<th class="head">Format</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Methods</td>
<td>interCaps</td>
</tr>
<tr class="row-odd"><td>Functions</td>
<td>interCaps</td>
</tr>
<tr class="row-even"><td>Function Arguments</td>
<td>interCaps</td>
</tr>
<tr class="row-odd"><td>Classes</td>
<td>InitialCaps</td>
</tr>
<tr class="row-even"><td>Controllers</td>
<td>interCaps</td>
</tr>
<tr class="row-odd"><td>Services</td>
<td>interCaps</td>
</tr>
<tr class="row-even"><td>Filters</td>
<td>interCaps</td>
</tr>
<tr class="row-odd"><td>Constants</td>
<td>ALL_CAPS</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="coffeelint-should-be-happy">
<h5>3.2.3.2. Coffeelint should be happy<a class="headerlink" href="#coffeelint-should-be-happy" title="Permalink to this headline">¶</a></h5>
<p>Buildbot ships with a Gruntfile containing a coffeelint configuration which is expected to pass for buildbot CoffeeScript code.</p>
</div>
<div class="section" id="coffeescript-syntax-sugar">
<h5>3.2.3.3. CoffeeScript syntax sugar<a class="headerlink" href="#coffeescript-syntax-sugar" title="Permalink to this headline">¶</a></h5>
<p>CoffeeScript does not have inlineCallbacks, but have some syntax sugar for helping readability of nested callbacks.
However, those syntax sugars sometimes leads to surprises.
Make sure you check the generated javascript in case of weird behavior.</p>
<p>Follow the following suggestions:</p>
<ul class="simple">
<li>Use implicit parentheses for multi line function calls or object construction:</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOOD</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">then</span> <span class="nf">(res) -&gt;</span>
   <span class="nv">$scope.val = </span><span class="nx">res</span>

<span class="c1"># BAD</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nf">(res) -&gt;</span>
   <span class="nv">$scope.val = </span><span class="nx">res</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># push a dictionary into a list</span>
<span class="c1"># GOOD</span>
<span class="nx">l</span><span class="p">.</span><span class="nx">push</span>
    <span class="nv">k1: </span><span class="nx">v1</span>
    <span class="nv">k2: </span><span class="nx">v2</span>

<span class="c1"># BAD</span>
<span class="nx">l</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
    <span class="nv">k1: </span><span class="nx">v1</span>
    <span class="nv">k2: </span><span class="nx">v2</span>
<span class="p">)</span>

<span class="c1"># BAD</span>
<span class="nx">l</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
    <span class="nv">k1: </span><span class="nx">v1</span>
    <span class="nv">k2: </span><span class="nx">v2</span>
<span class="p">})</span>
</pre></div>
</div>
<ul class="simple">
<li>Use explicit parentheses for single line function calls</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOOD</span>
<span class="nx">myFunc</span><span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">getA</span><span class="p">(</span><span class="nx">b</span><span class="p">))</span>

<span class="c1"># BAD</span>
<span class="nx">myFunc</span> <span class="nx">service</span><span class="p">.</span><span class="nx">getA</span> <span class="nx">b</span>
<span class="c1"># (not enough visually-distinct from:)</span>
<span class="nx">myFunc</span> <span class="nx">service</span><span class="p">.</span><span class="nx">getA</span><span class="p">,</span> <span class="nx">b</span>
<span class="c1"># which means</span>
<span class="nx">myFunc</span><span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">getA</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p class="first">always use <code class="docutils literal notranslate"><span class="pre">return</span></code> for multiline functions</p>
<p>In CoffeeScript, “everything is an expression”, and the default return value is the result of the last expression.
This is considered too error prone for Python and JS developers who are used to “return None” by default.
In buildbot code, every multiline function must end with an explicit <code class="docutils literal notranslate"><span class="pre">return</span></code> statement.</p>
</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># BAD: implicitly returns the return value of b()</span>
<span class="nv">myFunc = </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span>
        <span class="nx">b</span><span class="p">()</span>

<span class="c1"># GOOD</span>
<span class="nv">myFunc = </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span>
        <span class="nx">b</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">null</span>

<span class="c1"># GOOD</span>
<span class="nv">myFunc = </span><span class="nf">-&gt;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="nx">b</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">null</span>
</pre></div>
</div>
<ul>
<li><p class="first">never use return for single line functions</p>
<blockquote>
<div><p>Single line functions is equivalent to Python <code class="docutils literal notranslate"><span class="pre">lambda</span></code> functions and thus must not use <code class="docutils literal notranslate"><span class="pre">return</span></code>.</p>
</div></blockquote>
</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOOD</span>
<span class="c1"># if p resolves with a non-null list, will return the list with all element incremented</span>
<span class="nv">p = </span><span class="nx">p</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span> <span class="nf">(res) -&gt;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nf">(a) -&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="coffeescript-does-not-include-batteries">
<h5>3.2.3.4. CoffeeScript does not include batteries<a class="headerlink" href="#coffeescript-does-not-include-batteries" title="Permalink to this headline">¶</a></h5>
<p>There is a very limited standard library in JS, and none in CoffeeScript.
However, de-facto general purpose libraries have emerged.</p>
<ul>
<li><p class="first">JQuery considered harmful to access the DOM directly.</p>
<blockquote>
<div><p>Buildbot ships with JQuery, because it is supposed to be more optimized than AngularJS’s own jqlite, and because some 3rd party directives are requiring it.
However, it must not be used in Buildbot services or controllers, and should be avoided in directives.
The Buildbot UI should follow AngularJS best practices and only modify DOM via templates.</p>
</div></blockquote>
</li>
<li><p class="first">Lodash is a clone of Underscore.js, and provides good utilities for standard types manipulation (array and objects).
Underscore-string is also available for string manipulation function (e.g. startsWith, endsWith )</p>
<p>Avoid using lodash decoration form.
Those are considered tricky to use.</p>
</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># GOOD</span>
<span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">res</span><span class="p">,</span> <span class="nf">(a) -&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># BAD</span>
<span class="nx">_</span><span class="p">(</span><span class="nx">res</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="nf">(a) -&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li>Require.js is used as technical solution for plugin loading.
It should not be used apart from this.</li>
<li>Moment.js is used for manipulating dates and displaying them to the user in a human readable form (e.g “one month ago”).
It can be used anywhere it is useful.</li>
</ul>
</div>
<div class="section" id="q-a-promises-vs-twisted-s-deferred">
<h5>3.2.3.5. $q “A+ promises” VS twisted’s deferred<a class="headerlink" href="#q-a-promises-vs-twisted-s-deferred" title="Permalink to this headline">¶</a></h5>
<p>The AngularJS <code class="docutils literal notranslate"><span class="pre">$q</span></code> module implements A+ promises.
At first sight, this looks like Twisted Deferreds.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">d.addCallbacks(successCb, errorCb) is not equivalent to p.then(successCb, errorCb)!</p>
</div>
<ul class="simple">
<li>Once a Twisted deferred has been “called”, its result is changed with the return value of each callback in the callback queue.</li>
<li>Once a $q promise has been “resolved”, its result is immutable.
p.then() itself returns another promise which can be used to alter result of another promise.</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">someFunction</span><span class="p">()</span>
<span class="nd">@d</span><span class="o">.</span><span class="n">addCallback</span>
<span class="k">def</span> <span class="nf">addOneToResult</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">res</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">return</span> <span class="n">d</span> <span class="c1"># we return the same deferred as the one returned by someFunction()</span>
</pre></div>
</div>
<p>Translate in coffeeScript to:</p>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="nv">p = </span><span class="nx">someFunction</span><span class="p">()</span>
<span class="nv">p = </span><span class="nx">p</span><span class="p">.</span><span class="nx">then</span> <span class="nf">(res) -&gt;</span>  <span class="c1">## note assignment</span>
    <span class="k">return</span> <span class="nx">res</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">return</span> <span class="nx">p</span>  <span class="c1"># we return the another promise as the one returned by someFunction()</span>
</pre></div>
</div>
<ul class="simple">
<li>With <code class="docutils literal notranslate"><span class="pre">$q</span></code>, only the promise creator can resolve it.</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="nv">someFunction = </span><span class="nf">-&gt;</span>
    <span class="nv">d = </span><span class="nx">$q</span><span class="p">.</span><span class="nx">defer</span><span class="p">()</span>
    <span class="nx">$timeout</span> <span class="nf">-&gt;</span>
            <span class="nx">d</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">)</span>
        <span class="p">,</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">promise</span>
<span class="nv">p = </span><span class="nx">someFunction</span><span class="p">()</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">resolve</span><span class="p">()</span> <span class="c1"># cannot work, we can only call the &quot;then&quot; method of a promise</span>
</pre></div>
</div>
</div>
</div>
<span id="document-developer/tests"></span><div class="section" id="buildbot-s-test-suite">
<h4>3.2.4. Buildbot’s Test Suite<a class="headerlink" href="#buildbot-s-test-suite" title="Permalink to this headline">¶</a></h4>
<p>Buildbot’s master tests are under <code class="docutils literal notranslate"><span class="pre">buildbot.test</span></code>, <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> package tests are under <code class="docutils literal notranslate"><span class="pre">buildbot_worker.test</span></code>.
Tests for the workers are similar to the master, although in some cases helpful functionality on the master is not re-implemented on the worker.</p>
<div class="section" id="quick-start">
<h5>3.2.4.1. Quick-Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">¶</a></h5>
<p>Buildbot uses Twisted <a class="reference external" href="http://twistedmatrix.com/trac/wiki/TwistedTrial">trial</a> to run its test suite.
Following is a quick shell session to put you on the right track.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># the usual buildbot development bootstrap with git and virtualenv</span>
git clone https://github.com/buildbot/buildbot
<span class="nb">cd</span> buildbot

<span class="c1"># helper script which creates the virtualenv for development</span>
make virtualenv
. .venv/bin/activate

<span class="c1"># now we run the test suite</span>
trial buildbot

<span class="c1"># find all tests that talk about mail</span>
trial -n --reporter<span class="o">=</span>bwverbose buildbot <span class="p">|</span> grep mail

<span class="c1"># run only one test module</span>
trial buildbot.test.unit.test_reporters_mail
</pre></div>
</div>
</div>
<div class="section" id="suites">
<h5>3.2.4.2. Suites<a class="headerlink" href="#suites" title="Permalink to this headline">¶</a></h5>
<p>Tests are divided into a few suites:</p>
<ul class="simple">
<li>Unit tests (<code class="docutils literal notranslate"><span class="pre">buildbot.test.unit</span></code>) - these follow unit-testing practices and
attempt to maximally isolate the system under test.  Unit tests are the main
mechanism of achieving test coverage, and all new code should be well-covered
by corresponding unit tests.<ul>
<li>Interface tests are a special type of unit tests, and are found in the same directory and often the same file.
In many cases, Buildbot has multiple implementations of the same interface – at least one “real” implementation and a fake implementation used in unit testing.
The interface tests ensure that these implementations all meet the same standards.
This ensures consistency between implementations, and also ensures that the unit tests are testing against realistic fakes.</li>
</ul>
</li>
<li>Integration tests (<code class="docutils literal notranslate"><span class="pre">buildbot.test.integration</span></code>) - these test combinations
of multiple units.  Of necessity, integration tests are incomplete - they
cannot test every condition; difficult to maintain - they tend to be complex
and touch a lot of code; and slow - they usually require considerable setup
and execute a lot of code.  As such, use of integration tests is limited to a
few, broad tests to act as a failsafe for the unit and interface tests.</li>
<li>Regression tests (<code class="docutils literal notranslate"><span class="pre">buildbot.test.regressions</span></code>) - these test to prevent
re-occurrence of historical bugs.  In most cases, a regression is better
tested by a test in the other suites, or unlike to recur, so this suite tends
to be small.</li>
<li>Fuzz tests (<code class="docutils literal notranslate"><span class="pre">buildbot.test.fuzz</span></code>) - these tests run for a long time and
apply randomization to try to reproduce rare or unusual failures.  The
Buildbot project does not currently have a framework to run fuzz tests
regularly.</li>
</ul>
<div class="section" id="unit-tests">
<h6>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h6>
<p>Every code module should have corresponding unit tests.  This is not currently
true of Buildbot, due to a large body of legacy code, but is a goal of the
project.  All new code must meet this requirement.</p>
<p>Unit test modules are be named after the package or class they test, replacing
<code class="docutils literal notranslate"><span class="pre">.</span></code> with <code class="docutils literal notranslate"><span class="pre">_</span></code> and omitting the <code class="docutils literal notranslate"><span class="pre">buildbot_</span></code>. For example,
<a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/unit/test_schedulers_timed_Periodic.py">test_schedulers_timed_Periodic.py</a>
tests the <code class="xref py py-class docutils literal notranslate"><span class="pre">Periodic</span></code> class in
<a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/schedulers/timed.py">master/buildbot/schedulers/timed.py</a>. Modules with only one class, or a few
trivial classes, can be tested in a single test module. For more complex
situations, prefer to use multiple test modules.</p>
<p>Unit tests using renderables require special handling. The following example
shows how the same test would be written with the ‘param’ parameter and with the
same parameter as a renderable.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConcreteClass</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">param</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When the parameter is renderable, you need to instantiate the Class before you
can you renderables:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">build</span> <span class="o">=</span> <span class="n">Properties</span><span class="p">(</span><span class="n">paramVal</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">)</span>

<span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">test_param_renderable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConcreteClass</span><span class="p">(</span><span class="n">param</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;%(kw:rendered_val)s&#39;</span><span class="p">,</span>
                           <span class="n">rendered_val</span><span class="o">=</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;paramVal&#39;</span><span class="p">))</span>
    <span class="k">yield</span> <span class="n">f</span><span class="o">.</span><span class="n">start_instance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">param</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="interface-tests">
<h6>Interface Tests<a class="headerlink" href="#interface-tests" title="Permalink to this headline">¶</a></h6>
<p>Interface tests exist to verify that multiple implementations of an interface
meet the same requirements.  Note that the name ‘interface’ should not be
confused with the sparse use of Zope Interfaces in the Buildbot code – in this
context, an interface is any boundary between testable units.</p>
<p>Ideally, all interfaces, both public and private, should be tested.  Certainly,
any <em>public</em> interfaces need interface tests.</p>
<p>Interface tests are most often found in files named for the “real” implementation, e.g., <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/unit/test_db_changes.py">test_db_changes.py</a>.
When there is ambiguity, test modules should be named after the interface they are testing.
Interface tests have the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.test.util</span> <span class="k">import</span> <span class="n">interfaces</span>
<span class="kn">from</span> <span class="nn">twistd.trial</span> <span class="k">import</span> <span class="n">unittest</span>

<span class="k">class</span> <span class="nc">Tests</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">InterfaceTests</span><span class="p">):</span>

    <span class="c1"># define methods that must be overridden per implementation</span>
    <span class="k">def</span> <span class="nf">someSetupMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="c1"># method signature tests</span>
    <span class="k">def</span> <span class="nf">test_signature_someMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@self</span><span class="o">.</span><span class="n">assertArgSpecMatches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">systemUnderTest</span><span class="o">.</span><span class="n">someMethod</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">someMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="c1"># tests that all implementations must pass</span>
    <span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">RealTests</span><span class="p">(</span><span class="n">Tests</span><span class="p">):</span>

    <span class="c1"># tests that only *real* implementations must pass</span>
    <span class="k">def</span> <span class="nf">test_something_else</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1"># ...</span>
</pre></div>
</div>
<p>All of the test methods are defined here, segregated into tests that all implementations must pass, and tests that the fake implementation is not expected to pass.
The <code class="docutils literal notranslate"><span class="pre">test_signature_someMethod</span></code> test above illustrates the <code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.test.util.interfaces.assertArgSpecMatches</span></code> decorator, which can be used to compare the argument specification of a callable with a reference signature conveniently written as a nested function.
Wherever possible, prefer to add tests to the <code class="docutils literal notranslate"><span class="pre">Tests</span></code> class, even if this means testing one method (e.g,. <code class="docutils literal notranslate"><span class="pre">setFoo</span></code>) in terms of another (e.g., <code class="docutils literal notranslate"><span class="pre">getFoo</span></code>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">assertArgSpecMatches</span></code> method can take multiple methods to test; it will check each one in turn.</p>
<p>At the bottom of the test module, a subclass is created for each implementation, implementing the setup methods that were stubbed out in the parent classes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestFakeThing</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">Tests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">someSetupMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">TestRealThing</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">RealTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">someSetupMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1"># ...</span>
</pre></div>
</div>
<p>For implementations which require optional software, such as an AMQP server, this is the appropriate place to signal that tests should be skipped when their prerequisites are not available.</p>
</div>
<div class="section" id="integration-tests">
<h6>Integration Tests<a class="headerlink" href="#integration-tests" title="Permalink to this headline">¶</a></h6>
<p>Integration test modules test several units at once, including their
interactions.  In general, they serve as a catch-all for failures and bugs that
were not detected by the unit and interface tests.  As such, they should not
aim to be exhaustive, but merely representative.</p>
<p>Integration tests are very difficult to maintain if they reach into the
internals of any part of Buildbot.  Where possible, try to use the same means
as a user would to set up, run, and check the results of an integration test.
That may mean writing a <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> to be parsed, and checking the
results by examining the database (or fake DB API) afterward.</p>
</div>
<div class="section" id="regression-tests">
<h6>Regression Tests<a class="headerlink" href="#regression-tests" title="Permalink to this headline">¶</a></h6>
<p>Regression tests are even more rare in Buildbot than integration tests.  In
many cases, a regression test is not necessary – either the test is
better-suited as a unit or interface test, or the failure is so specific that a
test will never fail again.</p>
<p>Regression tests tend to be closely tied to the code in which the error
occurred.  When that code is refactored, the regression test generally becomes
obsolete, and is deleted.</p>
</div>
<div class="section" id="fuzz-tests">
<h6>Fuzz Tests<a class="headerlink" href="#fuzz-tests" title="Permalink to this headline">¶</a></h6>
<p>Fuzz tests generally run for a fixed amount of time, running randomized tests
against a system.  They do not run at all during normal runs of the Buildbot
tests, unless <code class="docutils literal notranslate"><span class="pre">BUILDBOT_FUZZ</span></code> is defined. This is accomplished with something
like the following at the end of each test module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s1">&#39;BUILDBOT_FUZZ&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">LRUCacheFuzzer</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mixins">
<h5>3.2.4.3. Mixins<a class="headerlink" href="#mixins" title="Permalink to this headline">¶</a></h5>
<p>Buildbot provides a number of purpose-specific mixin classes in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/util">master/buildbot/util</a>.
These generally define a set of utility functions as well as <code class="docutils literal notranslate"><span class="pre">setUpXxx</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDownXxx</span></code> methods.
These methods should be called explicitly from your subclass’s <code class="docutils literal notranslate"><span class="pre">setUp</span></code> and <code class="docutils literal notranslate"><span class="pre">tearDown</span></code> methods.
Note that some of these methods return Deferreds, which should be handled properly by the caller.</p>
</div>
<div class="section" id="fakes">
<span id="id1"></span><h5>3.2.4.4. Fakes<a class="headerlink" href="#fakes" title="Permalink to this headline">¶</a></h5>
<p>Buildbot provides a number of pre-defined fake implementations of internal interfaces, in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/fake">master/buildbot/test/fake</a>.
These are designed to be used in unit tests to limit the scope of the test.
For example, the fake DB API eliminates the need to create a real database when testing code that uses the DB API, and isolates bugs in the system under test from bugs in the real DB implementation.</p>
<p>The danger of using fakes is that the fake interface and the real interface can
differ.  The interface tests exist to solve this problem.  All fakes should be
fully tested in an integration test, so that the fakes pass the same tests as
the “real” thing.  It is particularly important that the method signatures be
compared.</p>
</div>
<div class="section" id="type-validation">
<h5>3.2.4.5. Type Validation<a class="headerlink" href="#type-validation" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/util/validation.py">master/buildbot/test/util/validation.py</a> provides a set of classes and definitions for validating Buildbot data types.
It supports four types of data:</p>
<blockquote>
<div><ul class="simple">
<li>DB API dictionaries, as returned from the <code class="docutils literal notranslate"><span class="pre">getXxx</span></code> methods,</li>
<li>Data API dictionaries, as returned from <code class="docutils literal notranslate"><span class="pre">get</span></code>,</li>
<li>Data API messages, and</li>
<li>Simple data types.</li>
</ul>
</div></blockquote>
<p>These are validated from elsewhere in the codebase with calls to</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">verifyDbDict(testcase,</span> <span class="pre">type,</span> <span class="pre">value)</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">verifyData(testcase,</span> <span class="pre">type,</span> <span class="pre">options,</span> <span class="pre">value)</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">verifyMessage(testcase,</span> <span class="pre">routingKey,</span> <span class="pre">message)</span></code>, and</li>
<li><code class="docutils literal notranslate"><span class="pre">verifyType(testcase,</span> <span class="pre">name,</span> <span class="pre">value,</span> <span class="pre">validator)</span></code>.</li>
</ul>
</div></blockquote>
<p>respectively.
The <code class="docutils literal notranslate"><span class="pre">testcase</span></code> argument is used to fail the test case if the validation does not succeed.
For DB dictionaries and data dictionaries, the <code class="docutils literal notranslate"><span class="pre">type</span></code> identifies the expected data type.
For messages, the type is determined from the first element of the routing key.</p>
<p>All messages sent with the fake MQ implementation are automatically validated using <code class="docutils literal notranslate"><span class="pre">verifyMessage</span></code>.
The <code class="docutils literal notranslate"><span class="pre">verifyType</span></code> method is used to validate simple types, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">validation</span><span class="o">.</span><span class="n">verifyType</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;param1&#39;</span><span class="p">,</span> <span class="n">param1</span><span class="p">,</span> <span class="n">validation</span><span class="o">.</span><span class="n">StringValidator</span><span class="p">())</span>
</pre></div>
</div>
<p>In any case, if <code class="docutils literal notranslate"><span class="pre">testcase</span></code> is None, then the functions will raise an <code class="xref py py-exc docutils literal notranslate"><span class="pre">AssertionError</span></code> on failure.</p>
<div class="section" id="validator-classes">
<h6>Validator Classes<a class="headerlink" href="#validator-classes" title="Permalink to this headline">¶</a></h6>
<p>A validator is an instance of the <code class="docutils literal notranslate"><span class="pre">Validator</span></code> class.
Its <code class="docutils literal notranslate"><span class="pre">validate</span></code> method is a generator function that takes a name and an object to validate.
It yields error messages describing any deviations of <code class="docutils literal notranslate"><span class="pre">object</span></code> from the designated data type.
The <code class="docutils literal notranslate"><span class="pre">name</span></code> argument is used to make such messages more helpful.</p>
<p>A number of validators are supplied for basic types.
A few classes deserve special mention:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">NoneOk</span></code> wraps another validator, allowing the object to be None.</li>
<li><code class="docutils literal notranslate"><span class="pre">Any</span></code> will match any object without error.</li>
<li><code class="docutils literal notranslate"><span class="pre">IdentifierValidator</span></code> will match identifiers; see <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">DictValidator</span></code> takes key names as keyword arguments, with the values giving validators for each key.
The <code class="docutils literal notranslate"><span class="pre">optionalNames</span></code> argument is a list of keys which may be omitted without error.</li>
<li><code class="docutils literal notranslate"><span class="pre">SourcedPropertiesValidator</span></code> matches dictionaries with (value, source) keys, the representation used for properties in the data API.</li>
<li><code class="docutils literal notranslate"><span class="pre">MessageValidator</span></code> validates messages.
It checks that the routing key is a tuple of strings.
The first tuple element gives the message type.
The last tuple element is the event, and must be a member of the <code class="docutils literal notranslate"><span class="pre">events</span></code> set.
The remaining “middle” tuple elements must match the message values identified by <code class="docutils literal notranslate"><span class="pre">keyFields</span></code>.
The <code class="docutils literal notranslate"><span class="pre">messageValidator</span></code> should be a <code class="docutils literal notranslate"><span class="pre">DictValidator</span></code> configured to check the message body.
This validator’s <code class="docutils literal notranslate"><span class="pre">validate</span></code> method is called with a tuple <code class="docutils literal notranslate"><span class="pre">(routingKey,</span> <span class="pre">message)</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">Selector</span></code> allows different validators to be selected based on matching functions.
Its <code class="docutils literal notranslate"><span class="pre">add</span></code> method takes a matching function, which should return a boolean, and a validator to use if the matching function returns true.
If the matching function is None, it is used as a default.
This class is used for message and data validation.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="defining-validators">
<h6>Defining Validators<a class="headerlink" href="#defining-validators" title="Permalink to this headline">¶</a></h6>
<p>DB validators are defined in the <code class="docutils literal notranslate"><span class="pre">dbdict</span></code> dictionary, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dbdict</span><span class="p">[</span><span class="s1">&#39;foodict&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DictValidator</span><span class="p">(</span>
    <span class="nb">id</span><span class="o">=</span><span class="n">IntValidator</span><span class="p">(),</span>
    <span class="n">name</span><span class="o">=</span><span class="n">StringValidator</span><span class="p">(),</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Data validators are <code class="docutils literal notranslate"><span class="pre">Selector</span></code> validators, where the selector is the <code class="docutils literal notranslate"><span class="pre">options</span></code> passed to <code class="docutils literal notranslate"><span class="pre">verifyData</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="k">lambda</span> <span class="n">opts</span> <span class="p">:</span> <span class="n">opt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fanciness&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">DictValidator</span><span class="p">(</span>
        <span class="n">fooid</span><span class="o">=</span><span class="n">IntValidator</span><span class="p">(),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">StringValidator</span><span class="p">(),</span>
        <span class="o">...</span>
<span class="p">))</span>
</pre></div>
</div>
<p>Similarly, message validators are <code class="docutils literal notranslate"><span class="pre">Selector</span></code> validators, where the selector is the routing key.
The underlying validator should be a <code class="docutils literal notranslate"><span class="pre">MessageValidator</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Selector</span><span class="p">()</span>
<span class="n">message</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="k">lambda</span> <span class="n">rk</span> <span class="p">:</span> <span class="n">rk</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span>
    <span class="n">MessageValidator</span><span class="p">(</span>
        <span class="n">keyFields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fooid&#39;</span><span class="p">],</span>
        <span class="n">events</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;new&#39;</span><span class="p">,</span> <span class="s1">&#39;complete&#39;</span><span class="p">],</span>
        <span class="n">messageValidator</span><span class="o">=</span><span class="n">DictValidator</span><span class="p">(</span>
            <span class="n">fooid</span><span class="o">=</span><span class="n">IntValidator</span><span class="p">(),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">StringValidator</span><span class="p">(),</span>
            <span class="o">...</span>
       <span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="good-tests">
<h5>3.2.4.6. Good Tests<a class="headerlink" href="#good-tests" title="Permalink to this headline">¶</a></h5>
<p>Bad tests are worse than no tests at all, since they waste developers’ time
wondering “was that a spurious failure?” or “what the heck is this test trying
to do?”  Buildbot needs good tests.  So what makes a good test?</p>
<div class="section" id="independent-of-time">
<span id="tests-independent-of-time"></span><h6>Independent of Time<a class="headerlink" href="#independent-of-time" title="Permalink to this headline">¶</a></h6>
<p>Tests that depend on wall time will fail. As a bonus, they run very slowly. Do
not use <code class="xref py py-meth docutils literal notranslate"><span class="pre">reactor.callLater</span></code> to wait “long enough” for something to happen.</p>
<p>For testing things that themselves depend on time, consider using
<code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.tasks.Clock</span></code>.  This may mean passing a clock instance to
the code under test, and propagating that instance as necessary to ensure that
all of the code using <code class="xref py py-meth docutils literal notranslate"><span class="pre">callLater</span></code> uses it.  Refactoring code for
testability is difficult, but worthwhile.</p>
<p>For testing things that do not depend on time, but for which you cannot detect
the “end” of an operation: add a way to detect the end of the operation!</p>
</div>
<div class="section" id="clean-code">
<h6>Clean Code<a class="headerlink" href="#clean-code" title="Permalink to this headline">¶</a></h6>
<p>Make your tests readable. This is no place to skimp on comments! Others will
attempt to learn about the expected behavior of your class by reading the
tests. As a side note, if you use a <code class="xref py py-class docutils literal notranslate"><span class="pre">Deferred</span></code> chain in your test, write
the callbacks as nested functions, rather than using methods with funny names:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">testSomething</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">doThisFirst</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">andThisNext</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c1"># ...</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">andThisNext</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>This isolates the entire test into one indented block. It is OK to add methods
for common functionality, but give them real names and explain in detail what
they do.</p>
</div>
<div class="section" id="good-name">
<h6>Good Name<a class="headerlink" href="#good-name" title="Permalink to this headline">¶</a></h6>
<p>Test method names should follow the pattern <code class="samp docutils literal notranslate"><span class="pre">test_</span><em><span class="pre">METHOD</span></em><span class="pre">_</span><em><span class="pre">CONDITION</span></em></code>
where <em>METHOD</em> is the method being tested, and <em>CONDITION</em> is the
condition under which it’s tested. Since we can’t always test a single
method, this is not a hard-and-fast rule.</p>
</div>
<div class="section" id="assert-only-one-thing">
<h6>Assert Only One Thing<a class="headerlink" href="#assert-only-one-thing" title="Permalink to this headline">¶</a></h6>
<p>Where practical, each test should have a single assertion. This may require a
little bit of work to get several related pieces of information into a single
Python object for comparison. The problem with multiple assertions is that, if
the first assertion fails, the remainder are not tested.  The test results then
do not tell the entire story.</p>
</div>
<div class="section" id="prefer-fakes-to-mocks">
<h6>Prefer Fakes to Mocks<a class="headerlink" href="#prefer-fakes-to-mocks" title="Permalink to this headline">¶</a></h6>
<p>Mock objects are too “compliant”, and this often masks errors in the system
under test.  For example, a mis-spelled method name on a mock object will not
raise an exception.</p>
<p>Where possible, use one of the pre-written fake objects (see
<a class="reference internal" href="#fakes"><span class="std std-ref">Fakes</span></a>) instead of a mock object.  Fakes
themselves should be well-tested using interface tests.</p>
<p>Where they are appropriate, Mock objects can be constructed easily using the
aptly-named <a class="reference external" href="http://www.voidspace.org.uk/python/mock/">mock</a> module, which is
a requirement for Buildbot’s tests.</p>
</div>
<div class="section" id="small-tests">
<h6>Small Tests<a class="headerlink" href="#small-tests" title="Permalink to this headline">¶</a></h6>
<p>The shorter each test is, the better. Test as little code as possible in each test.</p>
<p>It is fine, and in fact encouraged, to write the code under test in such a way
as to facilitate this. As an illustrative example, if you are testing a new
Step subclass, but your tests require instantiating a BuildMaster, you’re
probably doing something wrong!</p>
<p>This also applies to test modules.  Several short, easily-digested test modules
are preferred over a 1000-line monster.</p>
</div>
<div class="section" id="isolation">
<h6>Isolation<a class="headerlink" href="#isolation" title="Permalink to this headline">¶</a></h6>
<p>Each test should be maximally independent of other tests. Do not leave files
laying around after your test has finished, and do not assume that some other
test has run beforehand. It’s fine to use caching techniques to avoid repeated,
lengthy setup times.</p>
</div>
<div class="section" id="be-correct">
<h6>Be Correct<a class="headerlink" href="#be-correct" title="Permalink to this headline">¶</a></h6>
<p>Tests should be as robust as possible, which at a basic level means using the
available frameworks correctly. All Deferreds should have callbacks and be
chained properly. Error conditions should be checked properly. Race conditions
should not exist (see <a class="reference internal" href="#tests-independent-of-time"><span class="std std-ref">Independent of Time</span></a>, above).</p>
</div>
<div class="section" id="be-helpful">
<h6>Be Helpful<a class="headerlink" href="#be-helpful" title="Permalink to this headline">¶</a></h6>
<p>Note that tests will pass most of the time, but the moment when they are most
useful is when they fail.</p>
<p>When the test fails, it should produce output that is helpful to the person
chasing it down. This is particularly important when the tests are run
remotely, in which case the person chasing down the bug does not have access to
the system on which the test fails. A test which fails sporadically with no
more information than “AssertionFailed” is a prime candidate for deletion if
the error isn’t obvious. Making the error obvious also includes adding comments
describing the ways a test might fail.</p>
</div>
<div class="section" id="keeping-state">
<h6>Keeping State<a class="headerlink" href="#keeping-state" title="Permalink to this headline">¶</a></h6>
<p>Python does not allow assignment to anything but the innermost local scope or
the global scope with the <code class="docutils literal notranslate"><span class="pre">global</span></code> keyword.  This presents a problem when
creating nested functions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_localVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">cb_called</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">def</span> <span class="nf">cb</span><span class="p">():</span>
        <span class="n">cb_called</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">cb</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">cb_called</span><span class="p">)</span> <span class="c1"># will fail!</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">cb_called</span> <span class="pre">=</span> <span class="pre">True</span></code> assigns to a <em>different variable</em> than
<code class="docutils literal notranslate"><span class="pre">cb_called</span> <span class="pre">=</span> <span class="pre">False</span></code>.  In production code, it’s usually best to work around
such problems, but in tests this is often the clearest way to express the
behavior under test.</p>
<p>The solution is to change something in a common mutable object.  While a simple
list can serve as such a mutable object, this leads to code that is hard to
read.  Instead, use <code class="xref py py-class docutils literal notranslate"><span class="pre">State</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.test.state</span> <span class="k">import</span> <span class="n">State</span>

<span class="k">def</span> <span class="nf">test_localVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">cb_called</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cb</span><span class="p">():</span>
        <span class="n">state</span><span class="o">.</span><span class="n">cb_called</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">cb</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">cb_called</span><span class="p">)</span> <span class="c1"># passes</span>
</pre></div>
</div>
<p>This is almost as readable as the first example, but it actually works.</p>
</div>
</div>
</div>
<span id="document-developer/config"></span><div class="section" id="module-buildbot.config">
<span id="configuration"></span><h4>3.2.5. Configuration<a class="headerlink" href="#module-buildbot.config" title="Permalink to this headline">¶</a></h4>
<p>Wherever possible, Buildbot components should access configuration information
as needed from the canonical source, <code class="docutils literal notranslate"><span class="pre">master.config</span></code>, which is an instance of
<a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MasterConfig</span></code></a>.  For example, components should not keep a copy of
the <code class="docutils literal notranslate"><span class="pre">buildbotURL</span></code> locally, as this value may change throughout the lifetime
of the master.</p>
<p>Components which need to be notified of changes in the configuration should be
implemented as services, subclassing <a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin" title="buildbot.config.ReconfigurableServiceMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReconfigurableServiceMixin</span></code></a>, as
described in <a class="reference internal" href="#developer-reconfiguration"><span class="std std-ref">Reconfiguration</span></a>.</p>
<dl class="class">
<dt id="buildbot.config.MasterConfig">
<em class="property">class </em><code class="descclassname">buildbot.config.</code><code class="descname">MasterConfig</code><a class="headerlink" href="#buildbot.config.MasterConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>The master object makes much of the configuration available from an object
named <code class="docutils literal notranslate"><span class="pre">master.config</span></code>.  Configuration is stored as attributes of this
object.  Where possible, other Buildbot components should access this
configuration directly and not cache the configuration values anywhere
else.  This avoids the need to ensure that update-from-configuration
methods are called on a reconfig.</p>
<p>Aside from validating the configuration, this class handles any
backward-compatibility issues - renamed parameters, type changes, and so on
- removing those concerns from other parts of Buildbot.</p>
<p>This class may be instantiated directly, creating an entirely default
configuration, or via <a class="reference internal" href="#buildbot.config.FileLoader.loadConfig" title="buildbot.config.FileLoader.loadConfig"><code class="xref py py-meth docutils literal notranslate"><span class="pre">FileLoader.loadConfig</span></code></a>, which will load the
configuration from a config file.</p>
<p>The following attributes are available from this class, representing the
current configuration.  This includes a number of global parameters:</p>
<dl class="attribute">
<dt id="buildbot.config.MasterConfig.title">
<code class="descname">title</code><a class="headerlink" href="#buildbot.config.MasterConfig.title" title="Permalink to this definition">¶</a></dt>
<dd><p>The title of this buildmaster, from <a class="reference internal" href="#cfg-title" title="title"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">title</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.titleURL">
<code class="descname">titleURL</code><a class="headerlink" href="#buildbot.config.MasterConfig.titleURL" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL corresponding to the title, from <a class="reference internal" href="#cfg-titleURL" title="titleURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">titleURL</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.buildbotURL">
<code class="descname">buildbotURL</code><a class="headerlink" href="#buildbot.config.MasterConfig.buildbotURL" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL of this buildmaster, for use in constructing WebStatus URLs;
from <a class="reference internal" href="#cfg-buildbotURL" title="buildbotURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildbotURL</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logCompressionLimit">
<code class="descname">logCompressionLimit</code><a class="headerlink" href="#buildbot.config.MasterConfig.logCompressionLimit" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log compression limit, from <a class="reference internal" href="#cfg-logCompressionLimit" title="logCompressionLimit"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logCompressionLimit</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logCompressionMethod">
<code class="descname">logCompressionMethod</code><a class="headerlink" href="#buildbot.config.MasterConfig.logCompressionMethod" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log compression method, from
<a class="reference internal" href="#cfg-logCompressionMethod" title="logCompressionMethod"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logCompressionMethod</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logMaxSize">
<code class="descname">logMaxSize</code><a class="headerlink" href="#buildbot.config.MasterConfig.logMaxSize" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log maximum size, from <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logMaxSize</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logMaxTailSize">
<code class="descname">logMaxTailSize</code><a class="headerlink" href="#buildbot.config.MasterConfig.logMaxTailSize" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log maximum size, from <a class="reference internal" href="#cfg-logMaxTailSize" title="logMaxTailSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logMaxTailSize</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logEncoding">
<code class="descname">logEncoding</code><a class="headerlink" href="#buildbot.config.MasterConfig.logEncoding" title="Permalink to this definition">¶</a></dt>
<dd><p>The encoding to expect when logs are provided as bytestrings, from <a class="reference internal" href="#cfg-logEncoding" title="logEncoding"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logEncoding</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.properties">
<code class="descname">properties</code><a class="headerlink" href="#buildbot.config.MasterConfig.properties" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Properties</span></code> instance
containing global properties, from <a class="reference internal" href="#cfg-properties" title="properties"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">properties</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.collapseRequests">
<code class="descname">collapseRequests</code><a class="headerlink" href="#buildbot.config.MasterConfig.collapseRequests" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable, or True or False, describing how to collapse requests; from
<a class="reference internal" href="#cfg-collapseRequests" title="collapseRequests"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">collapseRequests</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.prioritizeBuilders">
<code class="descname">prioritizeBuilders</code><a class="headerlink" href="#buildbot.config.MasterConfig.prioritizeBuilders" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable, or None, used to prioritize builders; from
<a class="reference internal" href="#cfg-prioritizeBuilders" title="prioritizeBuilders"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">prioritizeBuilders</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.codebaseGenerator">
<code class="descname">codebaseGenerator</code><a class="headerlink" href="#buildbot.config.MasterConfig.codebaseGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable, or None, used to determine the codebase from an incoming
<a class="reference internal" href="#buildbot.changes.changes.Change" title="buildbot.changes.changes.Change"><code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code></a>,
from <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">codebaseGenerator</span></code></a></p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.protocols">
<code class="descname">protocols</code><a class="headerlink" href="#buildbot.config.MasterConfig.protocols" title="Permalink to this definition">¶</a></dt>
<dd><p>The per-protocol port specification for worker connections.
Based on <a class="reference internal" href="#cfg-protocols" title="protocols"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">protocols</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.multiMaster">
<code class="descname">multiMaster</code><a class="headerlink" href="#buildbot.config.MasterConfig.multiMaster" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, then this master is part of a cluster; based on
<a class="reference internal" href="#cfg-multiMaster" title="multiMaster"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">multiMaster</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.manhole">
<code class="descname">manhole</code><a class="headerlink" href="#buildbot.config.MasterConfig.manhole" title="Permalink to this definition">¶</a></dt>
<dd><p>The manhole instance to use, or None; from <a class="reference internal" href="#cfg-manhole" title="manhole"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">manhole</span></code></a>.</p>
</dd></dl>

<p>The remaining attributes contain compound configuration structures, usually
dictionaries:</p>
<dl class="attribute">
<dt id="buildbot.config.MasterConfig.validation">
<code class="descname">validation</code><a class="headerlink" href="#buildbot.config.MasterConfig.validation" title="Permalink to this definition">¶</a></dt>
<dd><p>Validation regular expressions, a dictionary from <a class="reference internal" href="#cfg-validation" title="validation"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">validation</span></code></a>.
It is safe to assume that all expected keys are present.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.db">
<code class="descname">db</code><a class="headerlink" href="#buildbot.config.MasterConfig.db" title="Permalink to this definition">¶</a></dt>
<dd><p>Database specification, a dictionary with key <a class="reference internal" href="#cfg-db_url" title="db_url"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">db_url</span></code></a>.  It is
safe to assume that this key is present.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.metrics">
<code class="descname">metrics</code><a class="headerlink" href="#buildbot.config.MasterConfig.metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>The metrics configuration from <a class="reference internal" href="#cfg-metrics" title="metrics"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">metrics</span></code></a>, or an empty
dictionary by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.caches">
<code class="descname">caches</code><a class="headerlink" href="#buildbot.config.MasterConfig.caches" title="Permalink to this definition">¶</a></dt>
<dd><p>The cache configuration, from <a class="reference internal" href="#cfg-caches" title="caches"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">caches</span></code></a> as well as the
deprecated <a class="reference internal" href="#cfg-buildCacheSize" title="buildCacheSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildCacheSize</span></code></a> and <a class="reference internal" href="#cfg-changeCacheSize" title="changeCacheSize"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">changeCacheSize</span></code></a>
parameters.</p>
<p>The keys <code class="docutils literal notranslate"><span class="pre">Builds</span></code> and <code class="docutils literal notranslate"><span class="pre">Caches</span></code> are always available; other keys
should use <code class="docutils literal notranslate"><span class="pre">config.caches.get(cachename,</span> <span class="pre">1)</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.schedulers">
<code class="descname">schedulers</code><a class="headerlink" href="#buildbot.config.MasterConfig.schedulers" title="Permalink to this definition">¶</a></dt>
<dd><p>The dictionary of scheduler instances, by name, from <a class="reference internal" href="#cfg-schedulers" title="schedulers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">schedulers</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.builders">
<code class="descname">builders</code><a class="headerlink" href="#buildbot.config.MasterConfig.builders" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of <a class="reference internal" href="#buildbot.config.BuilderConfig" title="buildbot.config.BuilderConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuilderConfig</span></code></a> instances from
<a class="reference internal" href="#cfg-builders" title="builders"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">builders</span></code></a>.  Builders specified as dictionaries in the
configuration file are converted to instances.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.workers">
<code class="descname">workers</code><a class="headerlink" href="#buildbot.config.MasterConfig.workers" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code> instances from
<a class="reference internal" href="#cfg-workers" title="workers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">workers</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.change_sources">
<code class="descname">change_sources</code><a class="headerlink" href="#buildbot.config.MasterConfig.change_sources" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of <code class="xref py py-class docutils literal notranslate"><span class="pre">IChangeSource</span></code> providers from
<a class="reference internal" href="#cfg-change_source" title="change_source"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">change_source</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.user_managers">
<code class="descname">user_managers</code><a class="headerlink" href="#buildbot.config.MasterConfig.user_managers" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of user managers providers from <a class="reference internal" href="#cfg-user_managers" title="user_managers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">user_managers</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.www">
<code class="descname">www</code><a class="headerlink" href="#buildbot.config.MasterConfig.www" title="Permalink to this definition">¶</a></dt>
<dd><p>The web server configuration from <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span></code></a>.  The keys <code class="docutils literal notranslate"><span class="pre">port</span></code> and
<code class="docutils literal notranslate"><span class="pre">url</span></code> are always available.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.services">
<code class="descname">services</code><a class="headerlink" href="#buildbot.config.MasterConfig.services" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of additional plugin services</p>
</dd></dl>

<dl class="classmethod">
<dt id="buildbot.config.MasterConfig.loadFromDict">
<em class="property">classmethod </em><code class="descname">loadFromDict</code><span class="sig-paren">(</span><em>config_dict</em>, <em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.MasterConfig.loadFromDict" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>config_dict</strong> (<em>dict</em>) – The dictionary containing the configuration to load.</li>
<li><strong>filename</strong> (<em>string</em>) – The filename to use when reporting errors.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">new <a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MasterConfig</span></code></a> instance</p>
</td>
</tr>
</tbody>
</table>
<p>Load the configuration from the given dictionary.</p>
</dd></dl>

</dd></dl>

<p>Loading of the configuration file is generally triggered by the master,
using the following class:</p>
<dl class="class">
<dt id="buildbot.config.FileLoader">
<em class="property">class </em><code class="descclassname">buildbot.config.</code><code class="descname">FileLoader</code><a class="headerlink" href="#buildbot.config.FileLoader" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.config.FileLoader.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>basedir</em>, <em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.FileLoader.__init__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>basedir</strong> (<em>string</em>) – directory to which config is relative</li>
<li><strong>filename</strong> (<em>string</em>) – the configuration file to load</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The filename is treated as relative to the basedir, if it is not
absolute.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.config.FileLoader.loadConfig">
<code class="descname">loadConfig</code><span class="sig-paren">(</span><em>basedir</em>, <em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.FileLoader.loadConfig" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">new <a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MasterConfig</span></code></a> instance</td>
</tr>
</tbody>
</table>
<p>Load the configuration in the given file.  Aside from syntax errors,
this will also detect a number of semantic errors such as multiple
schedulers with the same name.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="buildbot.config.loadConfigDict">
<code class="descclassname">buildbot.config.</code><code class="descname">loadConfigDict</code><span class="sig-paren">(</span><em>basedir</em>, <em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.loadConfigDict" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>basedir</strong> (<em>string</em>) – directory to which config is relative</li>
<li><strong>filename</strong> (<em>string</em>) – the configuration file to load</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><a class="reference internal" href="#buildbot.config.ConfigErrors" title="buildbot.config.ConfigErrors"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConfigErrors</span></code></a> if any errors occur</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns dict:</th><td class="field-body"><p class="first last">The <code class="docutils literal notranslate"><span class="pre">BuildmasterConfig</span></code> dictionary.</p>
</td>
</tr>
</tbody>
</table>
<p>Load the configuration dictionary in the given file.</p>
<p>The filename is treated as relative to the basedir, if it is not
absolute.</p>
</dd></dl>

<div class="section" id="builder-configuration">
<h5>3.2.5.1. Builder Configuration<a class="headerlink" href="#builder-configuration" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.config.BuilderConfig">
<em class="property">class </em><code class="descclassname">buildbot.config.</code><code class="descname">BuilderConfig</code><span class="sig-paren">(</span><span class="optional">[</span><em>keyword args</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.BuilderConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>This class parameterizes configuration of builders; see
<a class="reference internal" href="#builder-configuration"><span class="std std-ref">Builder Configuration</span></a> for its arguments.  The constructor checks for
errors and applies defaults, and sets the properties described here.  Most
are simply copied from the constructor argument of the same name.</p>
<p>Users may subclass this class to add defaults, for example.</p>
<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.config.BuilderConfig.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s name.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.factory">
<code class="descname">factory</code><a class="headerlink" href="#buildbot.config.BuilderConfig.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s factory.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.workernames">
<code class="descname">workernames</code><a class="headerlink" href="#buildbot.config.BuilderConfig.workernames" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s worker names (a list, regardless of whether the names were
specified with <code class="docutils literal notranslate"><span class="pre">workername</span></code> or <code class="docutils literal notranslate"><span class="pre">workernames</span></code>).</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.builddir">
<code class="descname">builddir</code><a class="headerlink" href="#buildbot.config.BuilderConfig.builddir" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s builddir.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.workerbuilddir">
<code class="descname">workerbuilddir</code><a class="headerlink" href="#buildbot.config.BuilderConfig.workerbuilddir" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s worker-side builddir.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.category">
<code class="descname">category</code><a class="headerlink" href="#buildbot.config.BuilderConfig.category" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s category.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.nextWorker">
<code class="descname">nextWorker</code><a class="headerlink" href="#buildbot.config.BuilderConfig.nextWorker" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s nextWorker callable.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.nextBuild">
<code class="descname">nextBuild</code><a class="headerlink" href="#buildbot.config.BuilderConfig.nextBuild" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s nextBuild callable.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.canStartBuild">
<code class="descname">canStartBuild</code><a class="headerlink" href="#buildbot.config.BuilderConfig.canStartBuild" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s canStartBuild callable.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.locks">
<code class="descname">locks</code><a class="headerlink" href="#buildbot.config.BuilderConfig.locks" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s locks.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.env">
<code class="descname">env</code><a class="headerlink" href="#buildbot.config.BuilderConfig.env" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s environment variables.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.properties">
<code class="descname">properties</code><a class="headerlink" href="#buildbot.config.BuilderConfig.properties" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s properties, as a dictionary.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.collapseRequests">
<code class="descname">collapseRequests</code><a class="headerlink" href="#buildbot.config.BuilderConfig.collapseRequests" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s collapseRequests callable.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.description">
<code class="descname">description</code><a class="headerlink" href="#buildbot.config.BuilderConfig.description" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder’s description, displayed in the web status.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="error-handling">
<h5>3.2.5.2. Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h5>
<p>If any errors are encountered while loading the configuration <a class="reference internal" href="#buildbot.config.error" title="buildbot.config.error"><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.config.error</span></code></a>
should be called. This can occur both in the configuration-loading code,
and in the constructors of any objects that are instantiated in the
configuration - change sources, workers, schedulers, build steps, and so on.</p>
<dl class="function">
<dt id="buildbot.config.error">
<code class="descclassname">buildbot.config.</code><code class="descname">error</code><span class="sig-paren">(</span><em>error</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.error" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>error</strong> – error to report</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><a class="reference internal" href="#buildbot.config.ConfigErrors" title="buildbot.config.ConfigErrors"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConfigErrors</span></code></a> if called at build-time</td>
</tr>
</tbody>
</table>
<p>This function reports a configuration error. If a config file is being loaded,
then the function merely records the error, and allows the rest of the configuration
to be loaded. At any other time, it raises <a class="reference internal" href="#buildbot.config.ConfigErrors" title="buildbot.config.ConfigErrors"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConfigErrors</span></code></a>.  This is done
so all config errors can be reported, rather than just the first.</p>
</dd></dl>

<dl class="exception">
<dt id="buildbot.config.ConfigErrors">
<em class="property">exception </em><code class="descclassname">buildbot.config.</code><code class="descname">ConfigErrors</code><span class="sig-paren">(</span><span class="optional">[</span><em>errors</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.ConfigErrors" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>errors</strong> (<em>list</em>) – errors to report</td>
</tr>
</tbody>
</table>
<p>This exception represents errors in the configuration.  It supports
reporting multiple errors to the user simultaneously, e.g., when several
consistency checks fail.</p>
<dl class="attribute">
<dt id="buildbot.config.ConfigErrors.errors">
<code class="descname">errors</code><a class="headerlink" href="#buildbot.config.ConfigErrors.errors" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of detected errors, each given as a string.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.config.ConfigErrors.addError">
<code class="descname">addError</code><span class="sig-paren">(</span><em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.ConfigErrors.addError" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>msg</strong> (<em>string</em>) – the message to add</td>
</tr>
</tbody>
</table>
<p>Add another error message to the (presumably not-yet-raised) exception.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="configuration-in-angularjs">
<h4>3.2.6. Configuration in AngularJS<a class="headerlink" href="#configuration-in-angularjs" title="Permalink to this headline">¶</a></h4>
<p>The AngularJS frontend often needs access to the local master configuration.
This is accomplished automatically by converting various pieces of the master configuration to a dictionary.</p>
<p>The <a class="reference internal" href="#buildbot.config.buildbot.interfaces.IConfigured" title="buildbot.config.buildbot.interfaces.IConfigured"><code class="xref py py-class docutils literal notranslate"><span class="pre">IConfigured</span></code></a> interface represents a way to convert any object into a JSON-able dictionary.</p>
<dl class="class">
<dt id="buildbot.config.buildbot.interfaces.IConfigured">
<em class="property">class </em><code class="descclassname">buildbot.interfaces.</code><code class="descname">IConfigured</code><a class="headerlink" href="#buildbot.config.buildbot.interfaces.IConfigured" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div>Providers of this interface provide a method to get their configuration as a dictionary:</div></blockquote>
<dl class="method">
<dt id="buildbot.config.buildbot.interfaces.IConfigured.getConfigDict">
<code class="descname">getConfigDict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.buildbot.interfaces.IConfigured.getConfigDict" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">returns:</th><td class="field-body">object</td>
</tr>
</tbody>
</table>
<p>Return the configuration of this object.
Note that despite the name, the return value may not be a dictionary.</p>
</div></blockquote>
<p>Any object can be “cast” to an <a class="reference internal" href="#buildbot.config.buildbot.interfaces.IConfigured" title="buildbot.config.buildbot.interfaces.IConfigured"><code class="xref py py-class docutils literal notranslate"><span class="pre">IConfigured</span></code></a> provider.
The <code class="docutils literal notranslate"><span class="pre">getConfigDict</span></code> method for basic Python objects simply returns the value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IConfigured</span><span class="p">(</span><span class="n">someObject</span><span class="p">)</span><span class="o">.</span><span class="n">getConfigDict</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.config.buildbot.util.ConfiguredMixin">
<em class="property">class </em><code class="descclassname">buildbot.util.</code><code class="descname">ConfiguredMixin</code><a class="headerlink" href="#buildbot.config.buildbot.util.ConfiguredMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is a basic implementation of <a class="reference internal" href="#buildbot.config.buildbot.interfaces.IConfigured" title="buildbot.config.buildbot.interfaces.IConfigured"><code class="xref py py-class docutils literal notranslate"><span class="pre">IConfigured</span></code></a>.
Its <a class="reference internal" href="#buildbot.config.buildbot.util.ConfiguredMixin.getConfigDict" title="buildbot.config.buildbot.util.ConfiguredMixin.getConfigDict"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getConfigDict</span></code></a> method simply returns the instance’s <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute.</p>
<dl class="attribute">
<dt id="buildbot.config.buildbot.util.ConfiguredMixin.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.config.buildbot.util.ConfiguredMixin.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Each object configured must have a <code class="docutils literal notranslate"><span class="pre">name</span></code> attribute.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.config.buildbot.util.ConfiguredMixin.getConfigDict">
<code class="descname">getConfigDict</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.buildbot.util.ConfiguredMixin.getConfigDict" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">object</td>
</tr>
</tbody>
</table>
<p>Return a config dictionary representing this object.</p>
</dd></dl>

</dd></dl>

<p>All of this is used by to serve <code class="docutils literal notranslate"><span class="pre">/config.js</span></code> to the JavaScript frontend.</p>
<div class="section" id="reconfiguration">
<span id="developer-reconfiguration"></span><h5>3.2.6.1. Reconfiguration<a class="headerlink" href="#reconfiguration" title="Permalink to this headline">¶</a></h5>
<p>When the buildmaster receives a signal to begin a reconfig, it re-reads the
configuration file, generating a new <a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MasterConfig</span></code></a> instance, and
then notifies all of its child services via the reconfig mechanism described
below.  The master ensures that at most one reconfiguration is taking place at
any time.</p>
<p>See <a class="reference internal" href="#master-service-hierarchy"><span class="std std-ref">Master Organization</span></a> for the structure of the Buildbot service
tree.</p>
<p>To simplify initialization, a reconfiguration is performed immediately on
master startup.  As a result, services only need to implement their
configuration handling once, and can use <code class="docutils literal notranslate"><span class="pre">startService</span></code> for initialization.</p>
<p>See below for instructions on implementing configuration of common types of
components in Buildbot.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because Buildbot uses a pure-Python configuration file, it is not possible
to support all forms of reconfiguration.  In particular, when the
configuration includes custom subclasses or modules, reconfiguration can
turn up some surprising behaviors due to the dynamic nature of Python.  The
reconfig support in Buildbot is intended for “intermediate” uses of the
software, where there are fewer surprises.</p>
</div>
<div class="section" id="reconfigurable-services">
<span id="index-0"></span><h6>Reconfigurable Services<a class="headerlink" href="#reconfigurable-services" title="Permalink to this headline">¶</a></h6>
<p>Instances which need to be notified of a change in configuration should be
implemented as Twisted services, and mix in the
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin" title="buildbot.config.ReconfigurableServiceMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReconfigurableServiceMixin</span></code></a> class, overriding the
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin.reconfigServiceWithBuildbotConfig" title="buildbot.config.ReconfigurableServiceMixin.reconfigServiceWithBuildbotConfig"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reconfigServiceWithBuildbotConfig</span></code></a> method.</p>
<dl class="class">
<dt id="buildbot.config.ReconfigurableServiceMixin">
<em class="property">class </em><code class="descclassname">buildbot.config.</code><code class="descname">ReconfigurableServiceMixin</code><a class="headerlink" href="#buildbot.config.ReconfigurableServiceMixin" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.config.ReconfigurableServiceMixin.reconfigServiceWithBuildbotConfig">
<code class="descname">reconfigServiceWithBuildbotConfig</code><span class="sig-paren">(</span><em>new_config</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.config.ReconfigurableServiceMixin.reconfigServiceWithBuildbotConfig" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>new_config</strong> (<a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MasterConfig</span></code></a>) – new master configuration</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method notifies the service that it should make any changes
necessary to adapt to the new configuration values given.</p>
<p>This method will be called automatically after a service is started.</p>
<p>It is generally too late at this point to roll back the
reconfiguration, so if possible any errors should be detected in the
<a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MasterConfig</span></code></a> implementation.  Errors are handled as best as
possible and communicated back to the top level invocation, but such
errors may leave the master in an inconsistent state.
<a class="reference internal" href="#buildbot.config.ConfigErrors" title="buildbot.config.ConfigErrors"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ConfigErrors</span></code></a> exceptions will be displayed appropriately to
the user on startup.</p>
<p>Subclasses should always call the parent class’s implementation. For
<code class="xref py py-class docutils literal notranslate"><span class="pre">MultiService</span></code> instances, this will call any child services’
<code class="xref py py-meth docutils literal notranslate"><span class="pre">reconfigService</span></code> methods, as appropriate.  This will be done
sequentially, such that the Deferred from one service must fire before
the next service is reconfigured.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.ReconfigurableServiceMixin.priority">
<code class="descname">priority</code><a class="headerlink" href="#buildbot.config.ReconfigurableServiceMixin.priority" title="Permalink to this definition">¶</a></dt>
<dd><p>Child services are reconfigured in order of decreasing priority.  The
default priority is 128, so a service that must be reconfigured before
others should be given a higher priority.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="change-sources">
<h6>Change Sources<a class="headerlink" href="#change-sources" title="Permalink to this headline">¶</a></h6>
<p>When reconfiguring, there is no method by which Buildbot can determine that a
new <a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code></a> represents the same source
as an existing <a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code></a>, but with
different configuration parameters.  As a result, the change source manager
compares the lists of existing and new change sources using equality, stops any
existing sources that are not in the new list, and starts any new change
sources that do not already exist.</p>
<p><a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code></a> inherits
<a class="reference internal" href="#buildbot.util.ComparableMixin" title="buildbot.util.ComparableMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ComparableMixin</span></code></a>, so change sources are compared
based on the attributes described in their <code class="docutils literal notranslate"><span class="pre">compare_attrs</span></code>.</p>
<p>If a change source does not make reference to any global configuration
parameters, then there is no need to inherit
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin" title="buildbot.config.ReconfigurableServiceMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReconfigurableServiceMixin</span></code></a>, as a simple comparison and
<code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code> will be sufficient.</p>
<p>If the change source does make reference to global values, e.g., as default
values for its parameters, then it must inherit
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin" title="buildbot.config.ReconfigurableServiceMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ReconfigurableServiceMixin</span></code></a> to support the case where the global
values change.</p>
</div>
<div class="section" id="schedulers">
<h6>Schedulers<a class="headerlink" href="#schedulers" title="Permalink to this headline">¶</a></h6>
<p>Schedulers have names, so Buildbot can determine whether a scheduler has been
added, removed, or changed during a reconfig.  Old schedulers will be stopped,
new schedulers will be started, and both new and existing schedulers will see a
call to <code class="xref py py-meth docutils literal notranslate"><span class="pre">reconfigService</span></code>, if such a
method exists.  For backward compatibility, schedulers which do not support
reconfiguration will be stopped, and the new scheduler started, when their
configuration changes.</p>
<p>If, during a reconfiguration, a new and old scheduler’s fully qualified class
names differ, then the old class will be stopped and the new class started.
This supports the case when a user changes, for example, a <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> scheduler to a <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a> scheduler without changing the name.</p>
<p>Because Buildbot uses <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler" title="buildbot.schedulers.base.BaseScheduler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseScheduler</span></code></a>
instances directly in the configuration file, a reconfigured scheduler must
extract its new configuration information from another instance of itself.</p>
<div class="section" id="custom-subclasses">
<h7>Custom Subclasses<a class="headerlink" href="#custom-subclasses" title="Permalink to this headline">¶</a></h7>
<p>Custom subclasses are most often defined directly in the configuration file, or
in a Python module that is reloaded with <code class="docutils literal notranslate"><span class="pre">reload</span></code> every time the
configuration is loaded.  Because of the dynamic nature of Python, this creates
a new object representing the subclass every time the configuration is loaded
– even if the class definition has not changed.</p>
<p>Note that if a scheduler’s class changes in a reconfig, but the scheduler’s
name does not, it will still be treated as a reconfiguration of the existing
scheduler.  This means that implementation changes in custom scheduler
subclasses will not be activated with a reconfig.  This behavior avoids
stopping and starting such schedulers on every reconfig, but can make
development difficult.</p>
<p>One workaround for this is to change the name of the scheduler before each
reconfig - this will cause the old scheduler to be stopped, and the new
scheduler (with the new name and class) to be started.</p>
</div>
</div>
<div class="section" id="workers">
<h6>Workers<a class="headerlink" href="#workers" title="Permalink to this headline">¶</a></h6>
<p>Similar to schedulers, workers are specified by name, so new and old
configurations are first compared by name, and any workers to be added or
removed are noted.  Workers for which the fully-qualified class name has changed
are also added and removed.  All workers have their
<code class="xref py py-meth docutils literal notranslate"><span class="pre">reconfigService</span></code> method called.</p>
<p>This method takes care of the basic worker attributes, including changing the PB
registration if necessary.  Any subclasses that add configuration parameters
should override <code class="xref py py-meth docutils literal notranslate"><span class="pre">reconfigService</span></code> and
update those parameters.  As with Schedulers, because the
<code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractWorker</span></code> instance is given directly
in the configuration, on reconfig instances must extract the configuration from
a new instance.</p>
</div>
<div class="section" id="user-managers">
<h6>User Managers<a class="headerlink" href="#user-managers" title="Permalink to this headline">¶</a></h6>
<p>Since user managers are rarely used, and their purpose is unclear, they are
always stopped and re-started on every reconfig.  This may change in figure
versions.</p>
</div>
<div class="section" id="status-receivers">
<h6>Status Receivers<a class="headerlink" href="#status-receivers" title="Permalink to this headline">¶</a></h6>
<p>At every reconfig, all status listeners are stopped and new versions started.</p>
</div>
</div>
</div>
<span id="document-developer/schedulers"></span><div class="section" id="writing-schedulers">
<span id="id1"></span><h4>3.2.7. Writing Schedulers<a class="headerlink" href="#writing-schedulers" title="Permalink to this headline">¶</a></h4>
<p>Buildbot schedulers are the process objects responsible for requesting builds.</p>
<p>Schedulers are free to decide when to request builds, and to define the parameters of the builds.
Many schedulers (e.g., <a class="reference internal" href="#sched-SingleBranchScheduler" title="SingleBranchScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">SingleBranchScheduler</span></code></a>) request builds in response to changes from change sources.
Others, such as <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a>, request builds at specific times.
Still others, like <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a>, <a class="reference internal" href="#sched-Try_Jobdir" title="Try_Jobdir"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Try_Jobdir</span></code></a>, or <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a>, respond to external inputs.</p>
<p>Each scheduler has a unique name, and within a Buildbot cluster, can be active on at most one master.
If a scheduler is configured on multiple masters, it will be inactive on all but one master.
This provides a form of non-revertive failover for schedulers: if an active scheduler’s master fails, an inactive instance of that scheduler on another master will become active.</p>
<div class="section" id="api-stability">
<h5>3.2.7.1. API Stability<a class="headerlink" href="#api-stability" title="Permalink to this headline">¶</a></h5>
<p>Until Buildbot reaches version 1.0.0, API stability is not guaranteed.
The instructions in this document may change incompatibly until that time.</p>
</div>
<div class="section" id="implementing-a-scheduler">
<h5>3.2.7.2. Implementing A Scheduler<a class="headerlink" href="#implementing-a-scheduler" title="Permalink to this headline">¶</a></h5>
<p>A scheduler is a subclass of <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler" title="buildbot.schedulers.base.BaseScheduler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseScheduler</span></code></a>.</p>
<p>The constructor’s arguments form the scheduler’s configuration.
The first two arguments are <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">builderNames</span></code>, and are positional.
The remaining arguments are keyword arguments, and the subclass’s constructor should accept <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> to pass on to the parent class along with the positional arguments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyScheduler</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">BaseScheduler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">builderNames</span><span class="p">,</span> <span class="n">arg1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arg2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">base</span><span class="o">.</span><span class="n">BaseScheduler</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">builderNames</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span> <span class="o">=</span> <span class="n">arg1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg2</span> <span class="o">=</span> <span class="n">arg2</span>
</pre></div>
</div>
<p>Schedulers are Twisted services, so they can implement <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code>.
However, it is more common for scheduler subclasses to override <code class="docutils literal notranslate"><span class="pre">startActivity</span></code> and <code class="docutils literal notranslate"><span class="pre">stopActivity</span></code> instead.
See below.</p>
</div>
<div class="section" id="consuming-changes">
<h5>3.2.7.3. Consuming Changes<a class="headerlink" href="#consuming-changes" title="Permalink to this headline">¶</a></h5>
<p>A scheduler that needs to be notified of new changes should call <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.startConsumingChanges" title="buildbot.schedulers.base.BaseScheduler.startConsumingChanges"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startConsumingChanges</span></code></a> when it becomes active.
Change consumption will automatically stop when the scheduler becomes inactive.</p>
<p>Once consumption has started, the <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.gotChange" title="buildbot.schedulers.base.BaseScheduler.gotChange"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gotChange</span></code></a> method is invoked for each new change.
The scheduler is free to do whatever it likes in this method.</p>
</div>
<div class="section" id="adding-buildsets">
<h5>3.2.7.4. Adding Buildsets<a class="headerlink" href="#adding-buildsets" title="Permalink to this headline">¶</a></h5>
<p>To add a new buildset, subclasses should call one of the parent-class methods with the prefix <code class="docutils literal notranslate"><span class="pre">addBuildsetFor</span></code>.
These methods call <code class="xref py py-meth docutils literal notranslate"><span class="pre">addBuildset</span></code> after applying behaviors common to all schedulers</p>
<p>Any of these methods can be called at any time.</p>
</div>
<div class="section" id="handling-reconfiguration">
<h5>3.2.7.5. Handling Reconfiguration<a class="headerlink" href="#handling-reconfiguration" title="Permalink to this headline">¶</a></h5>
<p>When the configuration for a scheduler changes, Buildbot deactivates, stops and removes the old scheduler, then adds, starts, and maybe activates the new scheduler.
Buildbot determines whether a scheduler has changed by subclassing <a class="reference internal" href="#buildbot.util.ComparableMixin" title="buildbot.util.ComparableMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ComparableMixin</span></code></a>.
See the documentation for class for an explanation of the <code class="docutils literal notranslate"><span class="pre">compare_attrs</span></code> attribute.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In a future version, schedulers will be converted to handle reconfiguration as reconfigurable services, and will no longer require <code class="docutils literal notranslate"><span class="pre">compare_attrs</span></code> to be set.</p>
</div>
</div>
<div class="section" id="becoming-active-and-inactive">
<h5>3.2.7.6. Becoming Active and Inactive<a class="headerlink" href="#becoming-active-and-inactive" title="Permalink to this headline">¶</a></h5>
<p>An inactive scheduler should not do anything that might interfere with an active scheduler of the same name.</p>
<p>Simple schedulers can consult the <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.active" title="buildbot.schedulers.base.BaseScheduler.active"><code class="xref py py-attr docutils literal notranslate"><span class="pre">active</span></code></a> attribute to determine whether the scheduler is active.</p>
<p>Most schedulers, however, will implement the <code class="docutils literal notranslate"><span class="pre">activate</span></code> method to begin any processing expected of an active scheduler.
That may involve calling <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.startConsumingChanges" title="buildbot.schedulers.base.BaseScheduler.startConsumingChanges"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startConsumingChanges</span></code></a>, beginning a <code class="docutils literal notranslate"><span class="pre">LoopingCall</span></code>, or subscribing to messages.</p>
<p>Any processing begun by the <code class="docutils literal notranslate"><span class="pre">activate</span></code> method, or by an active scheduler, should be stopped by the <code class="docutils literal notranslate"><span class="pre">deactivate</span></code> method.
The <code class="docutils literal notranslate"><span class="pre">deactivate</span></code> method’s Deferred should not fire until such processing has completely stopped.
Schedulers must up-call the parent class’s <code class="docutils literal notranslate"><span class="pre">activate</span></code> and <code class="docutils literal notranslate"><span class="pre">deactivate</span></code> methods!</p>
</div>
<div class="section" id="keeping-state">
<h5>3.2.7.7. Keeping State<a class="headerlink" href="#keeping-state" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler" title="buildbot.schedulers.base.BaseScheduler"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseScheduler</span></code></a> class provides <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.getState" title="buildbot.schedulers.base.BaseScheduler.getState"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getState</span></code></a> and <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.setState" title="buildbot.schedulers.base.BaseScheduler.setState"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setState</span></code></a> methods to get and set state values for the scheduler.
Active scheduler instances should use these functions to store persistent scheduler state, such that if they fail or become inactive, other instances can pick up where they leave off.
A scheduler can cache its state locally, only calling <code class="docutils literal notranslate"><span class="pre">getState</span></code> when it first becomes active.
However, it is best to keep the state as up-to-date as possible, by calling <code class="docutils literal notranslate"><span class="pre">setState</span></code> any time the state changes.
This prevents loss of state from an unexpected master failure.</p>
<p>Note that the state-related methods do not use locks of any sort.
It is up to the caller to ensure that no race conditions exist between getting and setting state.
Generally, it is sufficient to rely on there being only one running instance of a scheduler, and cache state in memory.</p>
</div>
</div>
<span id="document-developer/utils"></span><div class="section" id="module-buildbot.util">
<span id="utilities"></span><h4>3.2.8. Utilities<a class="headerlink" href="#module-buildbot.util" title="Permalink to this headline">¶</a></h4>
<p>Several small utilities are available at the top-level <a class="reference internal" href="#module-buildbot.util" title="buildbot.util"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util</span></code></a> package.</p>
<dl class="function">
<dt id="buildbot.util.naturalSort">
<code class="descclassname">buildbot.util.</code><code class="descname">naturalSort</code><span class="sig-paren">(</span><em>list</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.naturalSort" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>list</strong> – list of strings</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">sorted strings</td>
</tr>
</tbody>
</table>
<p>This function sorts strings “naturally”, with embedded numbers sorted numerically.
This ordering is good for objects which might have a numeric suffix, e.g., <code class="docutils literal notranslate"><span class="pre">winworker1</span></code>, <code class="docutils literal notranslate"><span class="pre">winworker2</span></code></p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.formatInterval">
<code class="descclassname">buildbot.util.</code><code class="descname">formatInterval</code><span class="sig-paren">(</span><em>interval</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.formatInterval" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>interval</strong> – duration in seconds</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">human-readable (English) equivalent</td>
</tr>
</tbody>
</table>
<p>This function will return a human-readable string describing a length of time, given a number of seconds.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.ComparableMixin">
<em class="property">class </em><code class="descclassname">buildbot.util.</code><code class="descname">ComparableMixin</code><a class="headerlink" href="#buildbot.util.ComparableMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This mixin class adds comparability to a subclass.
Use it like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">FactoryProduct</span><span class="p">,</span> <span class="n">ComparableMixin</span><span class="p">):</span>
    <span class="n">compare_attrs</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;radius&#39;</span><span class="p">,</span> <span class="s1">&#39;thickness&#39;</span> <span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Any attributes not in <code class="docutils literal notranslate"><span class="pre">compare_attrs</span></code> will not be considered when comparing objects.
This is used to implement Buildbot’s reconfig logic, where a comparison between the new and existing objects is used to determine whether the new object should replace the existing object.
If the comparison shows the objects to be equivalent, then the old object is left in place.
If they differ, the old object is removed from the buildmaster and the new object added.</p>
<p>For use in configuration objects (schedulers, changesources, etc.), include any attributes which are set in the constructor based on the user’s configuration.
Be sure to also include the superclass’s list, e.g.:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyScheduler</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">BaseScheduler</span><span class="p">):</span>
    <span class="n">compare_attrs</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">BaseScheduler</span><span class="o">.</span><span class="n">compare_attrs</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;arg1&#39;</span><span class="p">,</span> <span class="s1">&#39;arg2&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A point to note is that the compare_attrs list is cumulative; that is, when a subclass also has a compare_attrs and the parent class has a compare_attrs, the subclass’ compare_attrs also includes the parent class’ compare_attrs.</p>
<p>This class also implements the <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.interfaces.IConfigured</span></code> interface.
The configuration is automatically generated, being the dict of all <code class="docutils literal notranslate"><span class="pre">compare_attrs</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.safeTranslate">
<code class="descclassname">buildbot.util.</code><code class="descname">safeTranslate</code><span class="sig-paren">(</span><em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.safeTranslate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>str</strong> – input string</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">safe version of the input</td>
</tr>
</tbody>
</table>
<p>This function will filter out some inappropriate characters for filenames; it is suitable for adapting strings from the configuration for use as filenames.
It is not suitable for use with strings from untrusted sources.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.epoch2datetime">
<code class="descclassname">buildbot.util.</code><code class="descname">epoch2datetime</code><span class="sig-paren">(</span><em>epoch</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.epoch2datetime" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>epoch</strong> – an epoch time (integer)</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">equivalent datetime object</td>
</tr>
</tbody>
</table>
<p>Convert a UNIX epoch timestamp to a Python datetime object, in the UTC timezone.
Note that timestamps specify UTC time (modulo leap seconds and a few other minor details).</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.datetime2epoch">
<code class="descclassname">buildbot.util.</code><code class="descname">datetime2epoch</code><span class="sig-paren">(</span><em>datetime</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.datetime2epoch" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>datetime</strong> – a datetime object</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">equivalent epoch time (integer)</td>
</tr>
</tbody>
</table>
<p>Convert an arbitrary Python datetime object into a UNIX epoch timestamp.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.util.UTC">
<code class="descclassname">buildbot.util.</code><code class="descname">UTC</code><a class="headerlink" href="#buildbot.util.UTC" title="Permalink to this definition">¶</a></dt>
<dd><p>A <code class="docutils literal notranslate"><span class="pre">datetime.tzinfo</span></code> subclass representing UTC time.
A similar class has finally been added to Python in version 3.2, but the implementation is simple enough to include here.
This is mostly used in tests to create timezone-aware datetime objects in UTC:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1978</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">UTC</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.diffSets">
<code class="descclassname">buildbot.util.</code><code class="descname">diffSets</code><span class="sig-paren">(</span><em>old</em>, <em>new</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.diffSets" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>old</strong> (<em>set</em><em> or </em><em>iterable</em>) – old set</li>
<li><strong>new</strong> (<em>set</em><em> or </em><em>iterable</em>) – new set</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a tuple, (removed, added)</p>
</td>
</tr>
</tbody>
</table>
<p>This function compares two sets of objects, returning elements that were added and elements that were removed.
This is largely a convenience function for reconfiguring services.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.makeList">
<code class="descclassname">buildbot.util.</code><code class="descname">makeList</code><span class="sig-paren">(</span><em>input</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.makeList" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>input</strong> – a thing</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a list of zero or more things</td>
</tr>
</tbody>
</table>
<p>This function is intended to support the many places in Buildbot where the user can specify either a string or a list of strings, but the implementation wishes to always consider lists.
It converts any string to a single-element list, <code class="docutils literal notranslate"><span class="pre">None</span></code> to an empty list, and any iterable to a list.
Input lists are copied, avoiding aliasing issues.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.now">
<code class="descclassname">buildbot.util.</code><code class="descname">now</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.now" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">epoch time (integer)</td>
</tr>
</tbody>
</table>
<p>Return the current time, using either <code class="docutils literal notranslate"><span class="pre">reactor.seconds</span></code> or <code class="docutils literal notranslate"><span class="pre">time.time()</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.flatten">
<code class="descclassname">buildbot.util.</code><code class="descname">flatten</code><span class="sig-paren">(</span><em>list</em><span class="optional">[</span>, <em>types</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.flatten" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>list</strong> – potentially nested list</li>
<li><strong>types</strong> – An optional iterable of the types to flatten.
By default, if unspecified, this flattens both lists and tuples</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">flat list</p>
</td>
</tr>
</tbody>
</table>
<p>Flatten nested lists into a list containing no other lists. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">flatten</span><span class="p">([</span> <span class="p">[</span>  <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span> <span class="p">[</span> <span class="mi">4</span> <span class="p">],</span> <span class="mi">5</span> <span class="p">]</span> <span class="p">])</span>
<span class="go">[ 1, 2, 3, 4, 5 ]</span>
</pre></div>
</div>
<p>Both lists and tuples are looked at by default.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.flattened_iterator">
<code class="descclassname">buildbot.util.</code><code class="descname">flattened_iterator</code><span class="sig-paren">(</span><em>list</em><span class="optional">[</span>, <em>types</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.flattened_iterator" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>list</strong> – potentially nested list</li>
<li><strong>types</strong> – An optional iterable of the types to flatten.
By default, if unspecified, this flattens both lists and tuples.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">iterator over every element that isn’t in types</p>
</td>
</tr>
</tbody>
</table>
<p>Returns a generator that doesn’t yield any lists/tuples.  For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   &gt;&gt;&gt; for x in flattened_iterator([ [  1, 2 ], 3, [ [ 4 ] ] ]):
   &gt;&gt;&gt;     print x
   1
   2
   3
   4

Use this for extremely large lists to keep memory-usage down and improve performance when you only need to iterate once.
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.none_or_str">
<code class="descclassname">buildbot.util.</code><code class="descname">none_or_str</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.none_or_str" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>obj</strong> – input value</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">string or <code class="docutils literal notranslate"><span class="pre">None</span></code></td>
</tr>
</tbody>
</table>
<p>If <code class="docutils literal notranslate"><span class="pre">obj</span></code> is not None, return its string representation.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">bytes2unicode(bytestr, encoding='utf-8', errors='strict'):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>bytestr</strong> – bytes</li>
<li><strong>encoding</strong> – unicode encoding to pass to <code class="xref py py-func docutils literal notranslate"><span class="pre">str.encode</span></code>, default <code class="docutils literal notranslate"><span class="pre">utf-8</span></code>.</li>
<li><strong>errors</strong> – error handler to pass to <code class="xref py py-func docutils literal notranslate"><span class="pre">str.encode</span></code>, default <code class="docutils literal notranslate"><span class="pre">strict</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">string as unicode</p>
</td>
</tr>
</tbody>
</table>
<p>This function is intended to convert bytes to unicode for user convenience.
If given a bytestring, it returns the string decoded using <code class="docutils literal notranslate"><span class="pre">encoding</span></code>.
If given a unicode string, it returns it directly.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">string2boolean(str):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>str</strong> – string</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><strong>KeyError</strong> – </td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
<p>This function converts a string to a boolean.
It is intended to be liberal in what it accepts: case-insensitive, “true”, “on”, “yes”, “1”, etc.
It raises <code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code> if the value is not recognized.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">toJson(obj):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>obj</strong> – object</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">UNIX epoch timestamp</td>
</tr>
</tbody>
</table>
<p>This function is a helper for json.dump, that allows to convert non-json able objects to json.
For now it supports converting datetime.datetime objects to unix timestamp.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.util.NotABranch">
<code class="descclassname">buildbot.util.</code><code class="descname">NotABranch</code><a class="headerlink" href="#buildbot.util.NotABranch" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a sentinel value used to indicate that no branch is specified.
It is necessary since schedulers and change sources consider <code class="docutils literal notranslate"><span class="pre">None</span></code> a valid name for a branch.
This is generally used as a default value in a method signature, and then tested against with <code class="docutils literal notranslate"><span class="pre">is</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">branch</span> <span class="ow">is</span> <span class="n">NotABranch</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.in_reactor">
<code class="descclassname">buildbot.util.</code><code class="descname">in_reactor</code><span class="sig-paren">(</span><em>fn</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.in_reactor" title="Permalink to this definition">¶</a></dt>
<dd><p>This decorator will cause the wrapped function to be run in the Twisted reactor, with the reactor stopped when the function completes.
It returns the result of the wrapped function.
If the wrapped function fails, its traceback will be printed, the reactor halted, and <code class="docutils literal notranslate"><span class="pre">None</span></code> returned.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.asyncSleep">
<code class="descclassname">buildbot.util.</code><code class="descname">asyncSleep</code><span class="sig-paren">(</span><em>secs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.asyncSleep" title="Permalink to this definition">¶</a></dt>
<dd><p>Yield a deferred that will fire with no result after <code class="docutils literal notranslate"><span class="pre">secs</span></code> seconds.
This is the asynchronous equivalent to <code class="docutils literal notranslate"><span class="pre">time.sleep</span></code>, and can be useful in tests.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.stripUrlPassword">
<code class="descclassname">buildbot.util.</code><code class="descname">stripUrlPassword</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.stripUrlPassword" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>url</strong> – a URL</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">URL with any password component replaced with <code class="docutils literal notranslate"><span class="pre">xxxx</span></code></td>
</tr>
</tbody>
</table>
<p>Sanitize a URL; use this before logging or displaying a DB URL.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.join_list">
<code class="descclassname">buildbot.util.</code><code class="descname">join_list</code><span class="sig-paren">(</span><em>maybe_list</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.join_list" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>maybe_list</strong> – list, tuple, byte string, or unicode</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">unicode</td>
</tr>
</tbody>
</table>
<p>If <code class="docutils literal notranslate"><span class="pre">maybe_list</span></code> is a list or tuple, join it with spaces, casting any strings into unicode using <code class="xref py py-func docutils literal notranslate"><span class="pre">bytes2unicode</span></code>.
This is useful for configuration parameters that may be strings or lists of strings.</p>
</dd></dl>

<dl class="class">
<dt>
<code class="descname">Notifier():</code></dt>
<dd><p>This is a helper for firing multiple deferreds with the same result.</p>
<dl class="method">
<dt id="buildbot.util.wait">
<code class="descclassname">buildbot.util.</code><code class="descname">wait</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.wait" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a deferred that will fire when when the notifier is notified.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.notify">
<code class="descclassname">buildbot.util.</code><code class="descname">notify</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.notify" title="Permalink to this definition">¶</a></dt>
<dd><p>Fire all the outstanding deferreds with the given value.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="buildbot.util.giturlparse">
<code class="descclassname">buildbot.util.</code><code class="descname">giturlparse</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.giturlparse" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>url</strong> – a git url</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a <code class="xref py py-class docutils literal notranslate"><span class="pre">GitUrl</span></code> with results of parsed url</td>
</tr>
</tbody>
</table>
<p>This function is intended to help various components to parse git urls.
It helps to find the <code class="docutils literal notranslate"><span class="pre">&lt;owner&gt;/&lt;repo&gt;</span></code> of a git repository url coming from a change, in order to call urls.
<code class="docutils literal notranslate"><span class="pre">owner</span></code> and <code class="docutils literal notranslate"><span class="pre">repo</span></code> is a common scheme for identifying git repository between various git hosting services like GitHub, GitLab, BitBucket, etc.
Each service have their own naming for similar things, but we choose to use the GitHub naming as a de-facto standard.
To simplify implementation, the parser is accepting invalid urls, but it should always parse valid urls correctly.
The unit tests in <code class="docutils literal notranslate"><span class="pre">test_util_giturlparse.py</span></code> is the references of what the parser is accepting.
Please feel free to update the parser and unit tests</p>
<p>Example use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.util</span> <span class="kn">import</span> <span class="n">giturlparse</span>
<span class="n">repourl</span> <span class="o">=</span> <span class="n">giturlparse</span><span class="p">(</span><span class="n">sourcestamp</span><span class="p">[</span><span class="s1">&#39;repository&#39;</span><span class="p">])</span>
<span class="n">repoOwner</span> <span class="o">=</span> <span class="n">repourl</span><span class="o">.</span><span class="n">owner</span>
<span class="n">repoName</span> <span class="o">=</span> <span class="n">repourl</span><span class="o">.</span><span class="n">repo</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt>
<code class="descname">GitUrl():</code></dt>
<dd><dl class="attribute">
<dt id="buildbot.util.proto">
<code class="descclassname">buildbot.util.</code><code class="descname">proto</code><a class="headerlink" href="#buildbot.util.proto" title="Permalink to this definition">¶</a></dt>
<dd><p>The protocol of the url</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.user">
<code class="descclassname">buildbot.util.</code><code class="descname">user</code><a class="headerlink" href="#buildbot.util.user" title="Permalink to this definition">¶</a></dt>
<dd><p>The user of the url (as in <code class="docutils literal notranslate"><span class="pre">user&#64;domain</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.domain">
<code class="descclassname">buildbot.util.</code><code class="descname">domain</code><a class="headerlink" href="#buildbot.util.domain" title="Permalink to this definition">¶</a></dt>
<dd><p>The domain part of the url</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.port">
<code class="descclassname">buildbot.util.</code><code class="descname">port</code><a class="headerlink" href="#buildbot.util.port" title="Permalink to this definition">¶</a></dt>
<dd><p>The optional port of the url</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.owner">
<code class="descclassname">buildbot.util.</code><code class="descname">owner</code><a class="headerlink" href="#buildbot.util.owner" title="Permalink to this definition">¶</a></dt>
<dd><p>The owner of the repository (in case of GitLab might be a nested group, i.e contain <code class="docutils literal notranslate"><span class="pre">/</span></code>, e.g <code class="docutils literal notranslate"><span class="pre">repo/subrepo/subsubrepo</span></code>)</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.repo">
<code class="descclassname">buildbot.util.</code><code class="descname">repo</code><a class="headerlink" href="#buildbot.util.repo" title="Permalink to this definition">¶</a></dt>
<dd><p>The owner of the repository (in case of GitLab might be a nested group, i.e contain <code class="docutils literal notranslate"><span class="pre">/</span></code>)</p>
</dd></dl>

</dd></dl>

<div class="section" id="module-buildbot.util.lru">
<span id="buildbot-util-lru"></span><h5>3.2.8.1. <a class="reference internal" href="#module-buildbot.util.lru" title="buildbot.util.lru"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.lru</span></code></a><a class="headerlink" href="#module-buildbot.util.lru" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt>
<code class="descname">LRUCache(miss_fn, max_size=50):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>miss_fn</strong> – function to call, with key as parameter, for cache misses.
The function should return the value associated with the key argument, or None if there is no value associated with the key.</li>
<li><strong>max_size</strong> – maximum number of objects in the cache.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This is a simple least-recently-used cache.
When the cache grows beyond the maximum size, the least-recently used items will be automatically removed from the cache.</p>
<p>This cache is designed to control memory usage by minimizing duplication of objects, while avoiding unnecessary re-fetching of the same rows from the database.</p>
<p>All values are also stored in a weak valued dictionary, even after they have expired from the cache.
This allows values that are used elsewhere in Buildbot to “stick” in the cache in case they are needed by another component.
Weak references cannot be used for some types, so these types are not compatible with this class.
Note that dictionaries can be weakly referenced if they are an instance of a subclass of <code class="docutils literal notranslate"><span class="pre">dict</span></code>.</p>
<p>If the result of the <code class="docutils literal notranslate"><span class="pre">miss_fn</span></code> is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then the value is not cached; this is intended to avoid caching negative results.</p>
<p>This is based on <a class="reference external" href="http://code.activestate.com/recipes/498245-lru-and-lfu-cache-decorators/">Raymond Hettinger’s implementation</a>, licensed under the PSF license, which is GPL-compatible.</p>
<dl class="attribute">
<dt id="buildbot.util.lru.hits">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">hits</code><a class="headerlink" href="#buildbot.util.lru.hits" title="Permalink to this definition">¶</a></dt>
<dd><p>cache hits so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.refhits">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">refhits</code><a class="headerlink" href="#buildbot.util.lru.refhits" title="Permalink to this definition">¶</a></dt>
<dd><p>cache misses found in the weak ref dictionary, so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.misses">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">misses</code><a class="headerlink" href="#buildbot.util.lru.misses" title="Permalink to this definition">¶</a></dt>
<dd><p>cache misses leading to re-fetches, so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.max_size">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">max_size</code><a class="headerlink" href="#buildbot.util.lru.max_size" title="Permalink to this definition">¶</a></dt>
<dd><p>maximum allowed size of the cache</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.get">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">get</code><span class="sig-paren">(</span><em>key</em>, <em>**miss_fn_kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> – cache key</li>
<li><strong>miss_fn_kwargs</strong> – keyword arguments to the <code class="docutils literal notranslate"><span class="pre">miss_fn</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">value via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Fetch a value from the cache by key, invoking <code class="docutils literal notranslate"><span class="pre">miss_fn(key,</span> <span class="pre">**miss_fn_kwargs)</span></code> if the key is not in the cache.</p>
<p>Any additional keyword arguments are passed to the <code class="docutils literal notranslate"><span class="pre">miss_fn</span></code> as keyword arguments; these can supply additional information relating to the key.
It is up to the caller to ensure that this information is functionally identical for each key value: if the key is already in the cache, the <code class="docutils literal notranslate"><span class="pre">miss_fn</span></code> will not be invoked, even if the keyword arguments differ.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.put">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">put</code><span class="sig-paren">(</span><em>key</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.put" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> – key at which to place the value</li>
<li><strong>value</strong> – value to place there</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Add the given key and value into the cache.
The purpose of this method is to insert a new value into the cache <em>without</em> invoking the miss_fn (e.g., to avoid unnecessary overhead).</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.inv">
<code class="descclassname">buildbot.util.lru.</code><code class="descname">inv</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lru.inv" title="Permalink to this definition">¶</a></dt>
<dd><p>Check invariants on the cache.
This is intended for debugging purposes.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<code class="descname">AsyncLRUCache(miss_fn, max_size=50):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>miss_fn</strong> – This is the same as the miss_fn for class LRUCache, with the difference that this function <em>must</em> return a Deferred.</li>
<li><strong>max_size</strong> – maximum number of objects in the cache.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class has the same functional interface as LRUCache, but asynchronous locking is used to ensure that in the common case of multiple concurrent requests for the same key, only one fetch is performed.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.bbcollections">
<span id="buildbot-util-bbcollections"></span><h5>3.2.8.2. <a class="reference internal" href="#module-buildbot.util.bbcollections" title="buildbot.util.bbcollections"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.bbcollections</span></code></a><a class="headerlink" href="#module-buildbot.util.bbcollections" title="Permalink to this headline">¶</a></h5>
<p>This package provides a few useful collection objects.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This module used to be named <code class="docutils literal notranslate"><span class="pre">collections</span></code>, but without absolute imports (<span class="target" id="index-0"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-0328"><strong>PEP 328</strong></a>), this precluded using the standard library’s <code class="docutils literal notranslate"><span class="pre">collections</span></code> module.</p>
</div>
<dl class="class">
<dt id="buildbot.util.bbcollections.defaultdict">
<em class="property">class </em><code class="descclassname">buildbot.util.bbcollections.</code><code class="descname">defaultdict</code><a class="headerlink" href="#buildbot.util.bbcollections.defaultdict" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a clone of the Python <code class="xref py py-class docutils literal notranslate"><span class="pre">collections.defaultdict</span></code> for use in Python-2.4.
In later versions, this is simply a reference to the built-in <a class="reference internal" href="#buildbot.util.bbcollections.defaultdict" title="buildbot.util.bbcollections.defaultdict"><code class="xref py py-class docutils literal notranslate"><span class="pre">defaultdict</span></code></a>, so Buildbot code can simply use <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.collections.defaultdict</span></code> everywhere.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.bbcollections.KeyedSets">
<em class="property">class </em><code class="descclassname">buildbot.util.bbcollections.</code><code class="descname">KeyedSets</code><a class="headerlink" href="#buildbot.util.bbcollections.KeyedSets" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a collection of named sets.
In principal, it contains an empty set for every name, and you can add things to sets, discard things from sets, and so on.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span> <span class="o">=</span> <span class="n">KeyedSets</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>                   <span class="c1"># get a named set</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;friendly&#39;</span><span class="p">)</span>   <span class="c1"># add an element to a set</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;dexterous&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>
<span class="go">set([&#39;friendly&#39;, &#39;dexterous&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;tim&#39;</span> <span class="ow">in</span> <span class="n">ks</span>                 <span class="c1"># membership testing</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s1">&#39;ron&#39;</span> <span class="ow">in</span> <span class="n">ks</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">,</span> <span class="s1">&#39;friendly&#39;</span><span class="p">)</span><span class="c1"># discard set element</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tim&#39;</span><span class="p">)</span>               <span class="c1"># return set and reset to empty</span>
<span class="go">set([&#39;dexterous&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s1">&#39;tim&#39;</span><span class="p">]</span>
<span class="go">set([])</span>
</pre></div>
</div>
<p>This class is careful to conserve memory space - empty sets do not occupy any space.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.eventual">
<span id="buildbot-util-eventual"></span><h5>3.2.8.3. <a class="reference internal" href="#module-buildbot.util.eventual" title="buildbot.util.eventual"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.eventual</span></code></a><a class="headerlink" href="#module-buildbot.util.eventual" title="Permalink to this headline">¶</a></h5>
<p>This function provides a simple way to say “please do this later”.
For example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.util.eventual</span> <span class="kn">import</span> <span class="n">eventually</span>
<span class="k">def</span> <span class="nf">do_what_I_say</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">where</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">d</span>
<span class="n">eventually</span><span class="p">(</span><span class="n">do_what_I_say</span><span class="p">,</span> <span class="s2">&quot;clean up&quot;</span><span class="p">,</span> <span class="s2">&quot;your bedroom&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The package defines “later” as “next time the reactor has control”, so this is a good way to avoid long loops that block other activity in the reactor.</p>
<dl class="function">
<dt id="buildbot.util.eventual.eventually">
<code class="descclassname">buildbot.util.eventual.</code><code class="descname">eventually</code><span class="sig-paren">(</span><em>cb</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.eventually" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>cb</strong> – callable to invoke later</li>
<li><strong>args</strong> – args to pass to <code class="docutils literal notranslate"><span class="pre">cb</span></code></li>
<li><strong>kwargs</strong> – kwargs to pass to <code class="docutils literal notranslate"><span class="pre">cb</span></code></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Invoke the callable <code class="docutils literal notranslate"><span class="pre">cb</span></code> in a later reactor turn.</p>
<p>Callables given to <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal notranslate"><span class="pre">eventually</span></code></a> are guaranteed to be called in the same order as the calls to <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal notranslate"><span class="pre">eventually</span></code></a> – writing <code class="docutils literal notranslate"><span class="pre">eventually(a);</span> <span class="pre">eventually(b)</span></code> guarantees that <code class="docutils literal notranslate"><span class="pre">a</span></code> will be called before <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<p>Any exceptions that occur in the callable will be logged with <code class="docutils literal notranslate"><span class="pre">log.err()</span></code>.
If you really want to ignore them, provide a callable that catches those exceptions.</p>
<p>This function returns None.
If you care to know when the callable was run, be sure to provide a callable that notifies somebody.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.eventual.fireEventually">
<code class="descclassname">buildbot.util.eventual.</code><code class="descname">fireEventually</code><span class="sig-paren">(</span><em>value=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.fireEventually" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> – value with which the Deferred should fire</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This function returns a Deferred which will fire in a later reactor turn, after the current call stack has been completed, and after all other Deferreds previously scheduled with <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><code class="xref py py-func docutils literal notranslate"><span class="pre">eventually</span></code></a>.
The returned Deferred will never fail.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.eventual.flushEventualQueue">
<code class="descclassname">buildbot.util.eventual.</code><code class="descname">flushEventualQueue</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.eventual.flushEventualQueue" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This returns a Deferred which fires when the eventual-send queue is finally empty.
This is useful for tests and other circumstances where it is useful to know that “later” has arrived.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.debounce">
<span id="buildbot-util-debounce"></span><h5>3.2.8.4. <a class="reference internal" href="#module-buildbot.util.debounce" title="buildbot.util.debounce"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.debounce</span></code></a><a class="headerlink" href="#module-buildbot.util.debounce" title="Permalink to this headline">¶</a></h5>
<p>It’s often necessary to perform some action in response to a particular type of event.
For example, steps need to update their status after updates arrive from the worker.
However, when many events arrive in quick succession, it’s more efficient to only perform the action once, after the last event has occurred.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">debounce.method(wait)</span></code> decorator is the tool for the job.</p>
<dl class="function">
<dt id="buildbot.util.debounce.method">
<code class="descclassname">buildbot.util.debounce.</code><code class="descname">method</code><span class="sig-paren">(</span><em>wait</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.method" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>wait</strong> – time to wait before invoking, in seconds</li>
<li><strong>get_reactor</strong> – A callable that takes the underlying instance and returns the reactor to use. Defaults to <code class="docutils literal notranslate"><span class="pre">instance.master.reactor</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Returns a decorator that debounces the underlying method.
The underlying method must take no arguments (except <code class="docutils literal notranslate"><span class="pre">self</span></code>).</p>
<p>For each call to the decorated method, the underlying method will be invoked at least once within <em>wait</em> seconds (plus the time the method takes to execute).
Calls are “debounced” during that time, meaning that multiple calls to the decorated method will result in a single invocation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This functionality is similar to Underscore’s <code class="docutils literal notranslate"><span class="pre">debounce</span></code>, except that the Underscore method resets its timer on every call.</p>
</div>
<p>The decorated method is an instance of <a class="reference internal" href="#buildbot.util.debounce.Debouncer" title="buildbot.util.debounce.Debouncer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Debouncer</span></code></a>, allowing it to be started and stopped.
This is useful when the method is a part of a Buildbot service: call <code class="docutils literal notranslate"><span class="pre">method.start()</span></code> from <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">method.stop()</span></code> from <code class="docutils literal notranslate"><span class="pre">stopService</span></code>, handling its Deferred appropriately.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.debounce.Debouncer">
<em class="property">class </em><code class="descclassname">buildbot.util.debounce.</code><code class="descname">Debouncer</code><a class="headerlink" href="#buildbot.util.debounce.Debouncer" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.util.debounce.Debouncer.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.Debouncer.stop" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Stop the debouncer.
While the debouncer is stopped, calls to the decorated method will be ignored.
If a call is pending when <code class="docutils literal notranslate"><span class="pre">stop</span></code> is called, that call will occur immediately.
When the Deferred that <code class="docutils literal notranslate"><span class="pre">stop</span></code> returns fires, the underlying method is not executing.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.debounce.Debouncer.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.debounce.Debouncer.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start the debouncer.
This reverses the effects of <code class="docutils literal notranslate"><span class="pre">stop</span></code>.
This method can be called on a started debouncer without issues.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.poll">
<span id="buildbot-util-poll"></span><h5>3.2.8.5. <a class="reference internal" href="#module-buildbot.util.poll" title="buildbot.util.poll"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.poll</span></code></a><a class="headerlink" href="#module-buildbot.util.poll" title="Permalink to this headline">¶</a></h5>
<p>Many Buildbot services perform some periodic, asynchronous operation.
Change sources, for example, contact the repositories they monitor on a regular basis.
The tricky bit is, the periodic operation must complete before the service stops.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;poll.method</span></code> decorator makes this behavior easy and reliable.</p>
<dl class="function">
<dt id="buildbot.util.poll.method">
<code class="descclassname">buildbot.util.poll.</code><code class="descname">method</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.poll.method" title="Permalink to this definition">¶</a></dt>
<dd><p>This decorator replaces the decorated method with a <a class="reference internal" href="#buildbot.util.poll.Poller" title="buildbot.util.poll.Poller"><code class="xref py py-class docutils literal notranslate"><span class="pre">Poller</span></code></a> instance configured to call the decorated method periodically.
The poller is initially stopped, so periodic calls will not begin until its <code class="docutils literal notranslate"><span class="pre">start</span></code> method is called.
The start polling interval is specified when the poller is started.</p>
<p>If the decorated method fails or raises an exception, the Poller logs the error and re-schedules the call for the next interval.</p>
<p>If a previous invocation of the method has not completed when the interval expires, then the next invocation is skipped and the interval timer starts again.</p>
<p>A common idiom is to call <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">stop</span></code> from <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WatchThings</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="nd">@poll.method</span>
    <span class="k">def</span> <span class="nf">watch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beginCheckingSomething</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">startService</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">watch</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pollingInterval</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stopService</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">watch</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.poll.Poller">
<em class="property">class </em><code class="descclassname">buildbot.util.poll.</code><code class="descname">Poller</code><a class="headerlink" href="#buildbot.util.poll.Poller" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.util.poll.Poller.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>interval=N</em>, <em>now=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.poll.Poller.start" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>interval</strong> – time, in seconds, between invocations</li>
<li><strong>now</strong> – if true, call the decorated method immediately on startup.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Start the poller.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.poll.Poller.stop">
<code class="descname">stop</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.poll.Poller.stop" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Stop the poller.
The returned Deferred fires when the decorated method is complete.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.poll.Poller.__call__">
<code class="descname">__call__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.poll.Poller.__call__" title="Permalink to this definition">¶</a></dt>
<dd><p>Force a call to the decorated method now.
If the decorated method is currently running, another call will begin as soon as it completes.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.maildir">
<span id="buildbot-util-maildir"></span><h5>3.2.8.6. <a class="reference internal" href="#module-buildbot.util.maildir" title="buildbot.util.maildir"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.maildir</span></code></a><a class="headerlink" href="#module-buildbot.util.maildir" title="Permalink to this headline">¶</a></h5>
<p>Several Buildbot components make use of <a class="reference external" href="http://www.courier-mta.org/maildir.html">maildirs</a> to hand off messages between components.
On the receiving end, there’s a need to watch a maildir for incoming messages and trigger some action when one arrives.</p>
<dl class="class">
<dt id="buildbot.util.maildir.MaildirService">
<em class="property">class </em><code class="descclassname">buildbot.util.maildir.</code><code class="descname">MaildirService</code><span class="sig-paren">(</span><em>basedir</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">param basedir:</th><td class="field-body">(optional) base directory of the maildir</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>A <a class="reference internal" href="#buildbot.util.maildir.MaildirService" title="buildbot.util.maildir.MaildirService"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaildirService</span></code></a> instance watches a maildir for new messages.
It should be a child service of some <code class="xref py py-class docutils literal notranslate"><span class="pre">MultiService</span></code> instance.
When running, this class uses the linux dirwatcher API (if available) or polls for new files in the ‘new’ maildir subdirectory.
When it discovers a new message, it invokes its <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal notranslate"><span class="pre">messageReceived</span></code></a> method.</p>
<p>To use this class, subclass it and implement a more interesting <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal notranslate"><span class="pre">messageReceived</span></code></a> function.</p>
<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.setBasedir">
<code class="descname">setBasedir</code><span class="sig-paren">(</span><em>basedir</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.setBasedir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>basedir</strong> – base directory of the maildir</td>
</tr>
</tbody>
</table>
<p>If no <code class="docutils literal notranslate"><span class="pre">basedir</span></code> is provided to the constructor, this method must be used to set the basedir before the service starts.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.messageReceived">
<code class="descname">messageReceived</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.messageReceived" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> – unqualified filename of the new message</td>
</tr>
</tbody>
</table>
<p>This method is called with the short filename of the new message.
The full name of the new file can be obtained with <code class="docutils literal notranslate"><span class="pre">os.path.join(maildir,</span> <span class="pre">'new',</span> <span class="pre">filename)</span></code>.
The method is un-implemented in the <a class="reference internal" href="#buildbot.util.maildir.MaildirService" title="buildbot.util.maildir.MaildirService"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaildirService</span></code></a> class, and must be implemented in subclasses.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.moveToCurDir">
<code class="descname">moveToCurDir</code><span class="sig-paren">(</span><em>filename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.maildir.MaildirService.moveToCurDir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> – unqualified filename of the new message</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">open file object</td>
</tr>
</tbody>
</table>
<p>Call this from <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><code class="xref py py-meth docutils literal notranslate"><span class="pre">messageReceived</span></code></a> to start processing the message; this moves the message file to the ‘cur’ directory and returns an open file handle for it.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.misc">
<span id="buildbot-util-misc"></span><h5>3.2.8.7. <a class="reference internal" href="#module-buildbot.util.misc" title="buildbot.util.misc"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.misc</span></code></a><a class="headerlink" href="#module-buildbot.util.misc" title="Permalink to this headline">¶</a></h5>
<dl class="function">
<dt id="buildbot.util.misc.deferredLocked">
<code class="descclassname">buildbot.util.misc.</code><code class="descname">deferredLocked</code><span class="sig-paren">(</span><em>lock</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.misc.deferredLocked" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>lock</strong> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.defer.DeferredLock</span></code> instance or a string naming an instance attribute containing one</td>
</tr>
</tbody>
</table>
<p>This is a decorator to wrap an event-driven method (one returning a <code class="docutils literal notranslate"><span class="pre">Deferred</span></code>) in an acquire/release pair of a designated <code class="xref py py-class docutils literal notranslate"><span class="pre">DeferredLock</span></code>.
For simple functions with a static lock, this is as easy as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">someLock</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredLock</span><span class="p">()</span>

<span class="nd">@util.deferredLocked</span><span class="p">(</span><span class="n">someLock</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someLockedFunction</span><span class="p">():</span>
    <span class="c1"># ..</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>For class methods which must access a lock that is an instance attribute, the lock can be specified by a string, which will be dynamically resolved to the specific instance at runtime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">someLock</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredLock</span><span class="p">()</span>

<span class="nd">@util.deferredLocked</span><span class="p">(</span><span class="s1">&#39;someLock&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someLockedFunction</span><span class="p">():</span>
    <span class="c1"># ..</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.misc.cancelAfter">
<code class="descclassname">buildbot.util.misc.</code><code class="descname">cancelAfter</code><span class="sig-paren">(</span><em>seconds</em>, <em>deferred</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.misc.cancelAfter" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>seconds</strong> – timeout in seconds</li>
<li><strong>deferred</strong> – deferred to cancel after timeout expires</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the deferred passed to the function</p>
</td>
</tr>
</tbody>
</table>
<p>Cancel the given deferred after the given time has elapsed, if it has not already been fired.
Whent his occurs, the deferred’s errback will be fired with a <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.internet.defer.CancelledError</span></code> failure.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.netstrings">
<span id="buildbot-util-netstrings"></span><h5>3.2.8.8. <a class="reference internal" href="#module-buildbot.util.netstrings" title="buildbot.util.netstrings"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.netstrings</span></code></a><a class="headerlink" href="#module-buildbot.util.netstrings" title="Permalink to this headline">¶</a></h5>
<p>Similar to maildirs, <a class="reference external" href="http://cr.yp.to/proto/netstrings.txt">netstrings</a> are used occasionally in Buildbot to encode data for interchange.
While Twisted supports a basic netstring receiver protocol, it does not have a simple way to apply that to a non-network situation.</p>
<dl class="class">
<dt id="buildbot.util.netstrings.NetstringParser">
<em class="property">class </em><code class="descclassname">buildbot.util.netstrings.</code><code class="descname">NetstringParser</code><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser" title="Permalink to this definition">¶</a></dt>
<dd><p>This class parses strings piece by piece, either collecting the accumulated strings or invoking a callback for each one.</p>
<dl class="method">
<dt id="buildbot.util.netstrings.NetstringParser.feed">
<code class="descname">feed</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser.feed" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – a portion of netstring-formatted data</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><code class="xref py py-exc docutils literal notranslate"><span class="pre">twisted.protocols.basic.NetstringParseError</span></code></td>
</tr>
</tbody>
</table>
<p>Add arbitrarily-sized <code class="docutils literal notranslate"><span class="pre">data</span></code> to the incoming-data buffer.
Any complete netstrings will trigger a call to the <code class="xref py py-meth docutils literal notranslate"><span class="pre">stringReceived</span></code> method.</p>
<p>Note that this method (like the Twisted class it is based on) cannot detect a trailing partial netstring at EOF - the data will be silently ignored.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">stringReceived(string):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> – the decoded string</td>
</tr>
</tbody>
</table>
<p>This method is called for each decoded string as soon as it is read completely.
The default implementation appends the string to the <a class="reference internal" href="#buildbot.util.netstrings.NetstringParser.strings" title="buildbot.util.netstrings.NetstringParser.strings"><code class="xref py py-attr docutils literal notranslate"><span class="pre">strings</span></code></a> attribute, but subclasses can do anything.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.netstrings.NetstringParser.strings">
<code class="descname">strings</code><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser.strings" title="Permalink to this definition">¶</a></dt>
<dd><p>The strings decoded so far, if <code class="xref py py-meth docutils literal notranslate"><span class="pre">stringReceived</span></code> is not overridden.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.sautils">
<span id="buildbot-util-sautils"></span><h5>3.2.8.9. <a class="reference internal" href="#module-buildbot.util.sautils" title="buildbot.util.sautils"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.sautils</span></code></a><a class="headerlink" href="#module-buildbot.util.sautils" title="Permalink to this headline">¶</a></h5>
<p>This module contains a few utilities that are not included with SQLAlchemy.</p>
<dl class="class">
<dt id="buildbot.util.sautils.InsertFromSelect">
<em class="property">class </em><code class="descclassname">buildbot.util.sautils.</code><code class="descname">InsertFromSelect</code><span class="sig-paren">(</span><em>table</em>, <em>select</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.sautils.InsertFromSelect" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>table</strong> – table into which insert should be performed</li>
<li><strong>select</strong> – select query from which data should be drawn</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class is taken directly from SQLAlchemy’s <a class="reference external" href="http://www.sqlalchemy.org/docs/core/compiler.html#compiling-sub-elements-of-a-custom-expression-construct">compiler.html</a>, and allows a Pythonic representation of <code class="docutils literal notranslate"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">..</span> <span class="pre">SELECT</span> <span class="pre">..</span></code> queries.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.sautils.sa_version">
<code class="descclassname">buildbot.util.sautils.</code><code class="descname">sa_version</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.sautils.sa_version" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a 3-tuple representing the SQLAlchemy version.
Note that older versions that did not have a <code class="docutils literal notranslate"><span class="pre">__version__</span></code> attribute are represented by <code class="docutils literal notranslate"><span class="pre">(0,0,0)</span></code>.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.pathmatch">
<span id="buildbot-util-pathmatch"></span><h5>3.2.8.10. <a class="reference internal" href="#module-buildbot.util.pathmatch" title="buildbot.util.pathmatch"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.pathmatch</span></code></a><a class="headerlink" href="#module-buildbot.util.pathmatch" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.util.pathmatch.Matcher">
<em class="property">class </em><code class="descclassname">buildbot.util.pathmatch.</code><code class="descname">Matcher</code><a class="headerlink" href="#buildbot.util.pathmatch.Matcher" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements the path-matching algorithm used by the data API.</p>
<p>Patterns are tuples of strings, with strings beginning with a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>) denoting variables.
A character can precede the colon to indicate the variable type:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">i</span></code> specifies an identifier (<a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>).</li>
<li><code class="docutils literal notranslate"><span class="pre">n</span></code> specifies a number (parseable by <code class="docutils literal notranslate"><span class="pre">int</span></code>).</li>
</ul>
<p>A tuple of strings matches a pattern if the lengths are identical, every variable matches and has the correct type, and every non-variable pattern element matches exactly.</p>
<p>A matcher object takes patterns using dictionary-assignment syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ep</span> <span class="o">=</span> <span class="n">ChangeEndpoint</span><span class="p">()</span>
<span class="n">matcher</span><span class="p">[(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;n:changeid&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">ep</span>
</pre></div>
</div>
<p>and performs matching using the dictionary-lookup syntax:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">changeEndpoint</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">matcher</span><span class="p">[(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">)]</span>
<span class="c1"># -&gt; (ep, {&#39;changeid&#39;: 13})</span>
</pre></div>
</div>
<p>where the result is a tuple of the original assigned object (the <code class="docutils literal notranslate"><span class="pre">Change</span></code> instance in this case) and the values of any variables in the path.</p>
<dl class="method">
<dt id="buildbot.util.pathmatch.Matcher.iterPatterns">
<code class="descname">iterPatterns</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.pathmatch.Matcher.iterPatterns" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an iterator which yields all patterns in the matcher as tuples of (pattern, endpoint).</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.topicmatch">
<span id="buildbot-util-topicmatch"></span><h5>3.2.8.11. <a class="reference internal" href="#module-buildbot.util.topicmatch" title="buildbot.util.topicmatch"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.topicmatch</span></code></a><a class="headerlink" href="#module-buildbot.util.topicmatch" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.util.topicmatch.TopicMatcher">
<em class="property">class </em><code class="descclassname">buildbot.util.topicmatch.</code><code class="descname">TopicMatcher</code><span class="sig-paren">(</span><em>topics</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.topicmatch.TopicMatcher" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>topics</strong> (<em>list</em>) – topics to match</td>
</tr>
</tbody>
</table>
<p>This class implements the AMQP-defined syntax: routing keys are treated as dot-separated sequences of words and matched against topics.
A star (<code class="docutils literal notranslate"><span class="pre">*</span></code>) in the topic will match any single word, while an octothorpe (<code class="docutils literal notranslate"><span class="pre">#</span></code>) will match zero or more words.</p>
<dl class="method">
<dt id="buildbot.util.topicmatch.TopicMatcher.matches">
<code class="descname">matches</code><span class="sig-paren">(</span><em>routingKey</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.topicmatch.TopicMatcher.matches" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>routingKey</strong> (<em>string</em>) – routing key to examine</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if the routing key matches a topic</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="buildbot-util-subscription">
<h5>3.2.8.12. <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.subscription</span></code><a class="headerlink" href="#buildbot-util-subscription" title="Permalink to this headline">¶</a></h5>
<p>The classes in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.subscription</span></code> module are used for master-local subscriptions.
In the near future, all uses of this module will be replaced with message-queueing implementations that allow subscriptions and subscribers to span multiple masters.</p>
</div>
<div class="section" id="buildbot-util-croniter">
<h5>3.2.8.13. <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.croniter</span></code><a class="headerlink" href="#buildbot-util-croniter" title="Permalink to this headline">¶</a></h5>
<p>This module is a copy of <a class="reference external" href="https://github.com/taichino/croniter">https://github.com/taichino/croniter</a>, and provides support for converting cron-like time specifications into actual times.</p>
</div>
<div class="section" id="module-buildbot.util.state">
<span id="buildbot-util-state"></span><h5>3.2.8.14. <a class="reference internal" href="#module-buildbot.util.state" title="buildbot.util.state"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.state</span></code></a><a class="headerlink" href="#module-buildbot.util.state" title="Permalink to this headline">¶</a></h5>
<p>The classes in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.subscription</span></code> module are used for dealing with object state stored in the database.</p>
<dl class="class">
<dt id="buildbot.util.state.StateMixin">
<em class="property">class </em><code class="descclassname">buildbot.util.state.</code><code class="descname">StateMixin</code><a class="headerlink" href="#buildbot.util.state.StateMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This class provides helper methods for accessing the object state stored in the database.</p>
<dl class="attribute">
<dt id="buildbot.util.state.StateMixin.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.util.state.StateMixin.name" title="Permalink to this definition">¶</a></dt>
<dd><p>This must be set to the name to be used to identify this object in the database.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.state.StateMixin.master">
<code class="descname">master</code><a class="headerlink" href="#buildbot.util.state.StateMixin.master" title="Permalink to this definition">¶</a></dt>
<dd><p>This must point to the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code> object.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.state.StateMixin.getState">
<code class="descname">getState</code><span class="sig-paren">(</span><em>name</em>, <em>default</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.state.StateMixin.getState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – name of the value to retrieve</li>
<li><strong>default</strong> – (optional) value to return if <cite>name</cite> is not present</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">state value via a Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><strong>KeyError</strong> – if <cite>name</cite> is not present and no default is given</li>
<li><strong>TypeError</strong> – if JSON parsing fails</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Get a named state value from the object’s state.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">getState</code><span class="sig-paren">(</span><em>name</em>, <em>value</em><span class="sig-paren">)</span></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – the name of the value to change</li>
<li><strong>value</strong> – the value to set - must be a JSONable object</li>
<li><strong>returns</strong> – Deferred</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><strong>TypeError</strong> – if JSONification fails</p>
</td>
</tr>
</tbody>
</table>
<p>Set a named state value in the object’s persistent state.
Note that value must be json-able.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.identifiers">
<span id="buildbot-util-identifiers"></span><h5>3.2.8.15. <a class="reference internal" href="#module-buildbot.util.identifiers" title="buildbot.util.identifiers"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.identifiers</span></code></a><a class="headerlink" href="#module-buildbot.util.identifiers" title="Permalink to this headline">¶</a></h5>
<p>This module makes it easy to manipulate identifiers.</p>
<dl class="function">
<dt id="buildbot.util.identifiers.isIdentifier">
<code class="descclassname">buildbot.util.identifiers.</code><code class="descname">isIdentifier</code><span class="sig-paren">(</span><em>maxLength</em>, <em>object</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.isIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>maxLength</strong> – maximum length of the identifier</li>
<li><strong>object</strong> – object to test for identifier-ness</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean</p>
</td>
</tr>
</tbody>
</table>
<p>Is object a <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>?</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.identifiers.forceIdentifier">
<code class="descclassname">buildbot.util.identifiers.</code><code class="descname">forceIdentifier</code><span class="sig-paren">(</span><em>maxLength</em>, <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.forceIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>maxLength</strong> – maximum length of the identifier</li>
<li><strong>str</strong> – string to coerce to an identifier</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">identifier of maximum length <code class="docutils literal notranslate"><span class="pre">maxLength</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>Coerce a string (assuming ASCII for bytestrings) into an identifier.
This method will replace any invalid characters with <code class="docutils literal notranslate"><span class="pre">_</span></code> and truncate to the given length.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.identifiers.incrementIdentifier">
<code class="descclassname">buildbot.util.identifiers.</code><code class="descname">incrementIdentifier</code><span class="sig-paren">(</span><em>maxLength</em>, <em>str</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.identifiers.incrementIdentifier" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>maxLength</strong> – maximum length of the identifier</li>
<li><strong>str</strong> – identifier to increment</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">identifier of maximum length <code class="docutils literal notranslate"><span class="pre">maxLength</span></code></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">ValueError if no suitable identifier can be constructed</p>
</td>
</tr>
</tbody>
</table>
<p>“Increment” an identifier by adding a numeric suffix, while keeping the total length limited.
This is useful when selecting a unique identifier for an object.
Maximum-length identifiers like <code class="docutils literal notranslate"><span class="pre">_999999</span></code> cannot be incremented and will raise <code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code>.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.lineboundaries">
<span id="buildbot-util-lineboundaries"></span><h5>3.2.8.16. <a class="reference internal" href="#module-buildbot.util.lineboundaries" title="buildbot.util.lineboundaries"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.lineboundaries</span></code></a><a class="headerlink" href="#module-buildbot.util.lineboundaries" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.util.lineboundaries.LineBoundaryFinder">
<em class="property">class </em><code class="descclassname">buildbot.util.lineboundaries.</code><code class="descname">LineBoundaryFinder</code><a class="headerlink" href="#buildbot.util.lineboundaries.LineBoundaryFinder" title="Permalink to this definition">¶</a></dt>
<dd><p>This class accepts a sequence of arbitrary strings and invokes a callback only with complete (newline-terminated) substrings.
It buffers any partial lines until a subsequent newline is seen.
It considers any of <code class="docutils literal notranslate"><span class="pre">\r</span></code>, <code class="docutils literal notranslate"><span class="pre">\n</span></code>, and <code class="docutils literal notranslate"><span class="pre">\r\n</span></code> to be newlines.
Because of the ambiguity of an append operation ending in the character <code class="docutils literal notranslate"><span class="pre">\r</span></code> (it may be a bare <code class="docutils literal notranslate"><span class="pre">\r</span></code> or half of <code class="docutils literal notranslate"><span class="pre">\r\n</span></code>), the last line of such an append operation will be buffered until the next append or flush.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>callback</strong> – asynchronous function to call with newline-terminated strings</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="buildbot.util.lineboundaries.LineBoundaryFinder.append">
<code class="descname">append</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lineboundaries.LineBoundaryFinder.append" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>text</strong> – text to append to the boundary finder</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Add additional text to the boundary finder.
If the addition of this text completes at least one line, the callback will be invoked with as many complete lines as possible.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lineboundaries.LineBoundaryFinder.flush">
<code class="descname">flush</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.lineboundaries.LineBoundaryFinder.flush" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Flush any remaining partial line by adding a newline and invoking the callback.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.service">
<span id="buildbot-util-service"></span><h5>3.2.8.17. <a class="reference internal" href="#module-buildbot.util.service" title="buildbot.util.service"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.service</span></code></a><a class="headerlink" href="#module-buildbot.util.service" title="Permalink to this headline">¶</a></h5>
<p>This module implements some useful subclasses of Twisted services.</p>
<p>The first two classes are more robust implementations of two Twisted classes, and should be used universally in Buildbot code.</p>
<dl class="class">
<dt id="buildbot.util.service.AsyncMultiService">
<em class="property">class </em><code class="descclassname">buildbot.util.service.</code><code class="descname">AsyncMultiService</code><a class="headerlink" href="#buildbot.util.service.AsyncMultiService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.application.service.MultiService</span></code>, except that it handles Deferreds returned from child services <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code> methods.</p>
<p>Twisted’s service implementation does not support asynchronous <code class="docutils literal notranslate"><span class="pre">startService</span></code> methods.
The reasoning is that all services should start at process startup, with no need to coordinate between them.
For Buildbot, this is not sufficient.
The framework needs to know when startup has completed, so it can begin scheduling builds.
This class implements the desired functionality, with a parent service’s <code class="docutils literal notranslate"><span class="pre">startService</span></code> returning a Deferred which will only fire when all child services <code class="docutils literal notranslate"><span class="pre">startService</span></code> methods have completed.</p>
<p>This class also fixes a bug with Twisted’s implementation of <code class="docutils literal notranslate"><span class="pre">stopService</span></code> which ignores failures in the <code class="docutils literal notranslate"><span class="pre">stopService</span></code> process.
With <a class="reference internal" href="#buildbot.util.service.AsyncMultiService" title="buildbot.util.service.AsyncMultiService"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncMultiService</span></code></a>, any errors in a child’s <code class="docutils literal notranslate"><span class="pre">stopService</span></code> will be propagated to the parent’s <code class="docutils literal notranslate"><span class="pre">stopService</span></code> method.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.service.AsyncService">
<em class="property">class </em><code class="descclassname">buildbot.util.service.</code><code class="descname">AsyncService</code><a class="headerlink" href="#buildbot.util.service.AsyncService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is similar to <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.application.service.Service</span></code>, except that its <code class="docutils literal notranslate"><span class="pre">setServiceParent</span></code> method will return a Deferred.
That Deferred will fire after the <code class="docutils literal notranslate"><span class="pre">startService</span></code> method has completed, if the service was started because the new parent was already running.</p>
</dd></dl>

<p id="index-1">Some services in buildbot must have only one “active” instance at any given time.
In a single-master configuration, this requirement is trivial to maintain.
In a multiple-master configuration, some arbitration is required to ensure that the service is always active on exactly one master in the cluster.</p>
<p>For example, a particular daily scheduler could be configured on multiple masters, but only one of them should actually trigger the required builds.</p>
<dl class="class">
<dt id="buildbot.util.service.ClusteredService">
<em class="property">class </em><code class="descclassname">buildbot.util.service.</code><code class="descname">ClusteredService</code><a class="headerlink" href="#buildbot.util.service.ClusteredService" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for a service that must have only one “active” instance in a buildbot configuration.</p>
<p>Each instance of the service is started and stopped via the usual twisted <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code> methods.
This utility class hooks into those methods in order to run an arbitration strategy to pick the one instance that should actually be “active”.</p>
<p>The arbitration strategy is implemented via a polling loop.
When each service instance starts, it immediately offers to take over as the active instance (via <code class="docutils literal notranslate"><span class="pre">_claimService</span></code>).</p>
<p>If successful, the <code class="docutils literal notranslate"><span class="pre">activate</span></code> method is called.
Once active, the instance remains active until it is explicitly stopped (eg, via <code class="docutils literal notranslate"><span class="pre">stopService</span></code>) or otherwise fails.
When this happens, the <code class="docutils literal notranslate"><span class="pre">deactivate</span></code> method is invoked and the “active” status is given back to the cluster (via <code class="docutils literal notranslate"><span class="pre">_unclaimService</span></code>).</p>
<p>If another instance is already active, this offer fails, and the instance will poll periodically to try again.
The polling strategy helps guard against active instances that might silently disappear and leave the service without any active instance running.</p>
<p>Subclasses should use these methods to hook into this activation scheme:</p>
<dl class="method">
<dt id="buildbot.util.service.ClusteredService.activate">
<code class="descname">activate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService.activate" title="Permalink to this definition">¶</a></dt>
<dd><p>When a particular instance of the service is chosen to be the one “active” instance, this method is invoked.
It is the corollary to twisted’s <code class="docutils literal notranslate"><span class="pre">startService</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.ClusteredService.deactivate">
<code class="descname">deactivate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService.deactivate" title="Permalink to this definition">¶</a></dt>
<dd><p>When the one “active” instance must be deactivated, this method is invoked.
It is the corollary to twisted’s <code class="docutils literal notranslate"><span class="pre">stopService</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.ClusteredService.isActive">
<code class="descname">isActive</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService.isActive" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns whether this particular instance is the active one.</p>
</dd></dl>

<p>The arbitration strategy is implemented via the following required methods:</p>
<dl class="method">
<dt id="buildbot.util.service.ClusteredService._getServiceId">
<code class="descname">_getServiceId</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService._getServiceId" title="Permalink to this definition">¶</a></dt>
<dd><p>The “service id” uniquely represents this service in the cluster.
Each instance of this service must have this same id, which will be used in the arbitration to identify candidates for activation.
This method may return a Deferred.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.ClusteredService._claimService">
<code class="descname">_claimService</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService._claimService" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance is attempting to become the one active instance in the cluster.
This method must return <cite>True</cite> or <cite>False</cite> (optionally via a Deferred) to represent whether this instance’s offer to be the active one was accepted.
If this returns <cite>True</cite>, the <code class="docutils literal notranslate"><span class="pre">activate</span></code> method will be called for this instance.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.ClusteredService._unclaimService">
<code class="descname">_unclaimService</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ClusteredService._unclaimService" title="Permalink to this definition">¶</a></dt>
<dd><p>Surrender the “active” status back to the cluster and make it available for another instance.
This will only be called on an instance that successfully claimed the service and has been activated and after its <code class="docutils literal notranslate"><span class="pre">deactivate</span></code> has been called.
Therefore, in this method it is safe to reassign the “active” status to another instance.
This method may return a Deferred.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.util.service.SharedService">
<em class="property">class </em><code class="descclassname">buildbot.util.service.</code><code class="descname">SharedService</code><a class="headerlink" href="#buildbot.util.service.SharedService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a generic Service that needs to be instantiated only once according to its parameters.
It is a common use case to need this for accessing remote services.
Having a shared service allows to limit the number of simultaneous access to the same remote service.
Thus, several completely independent Buildbot services can use that <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> to access the remote service, and automatically synchronize themselves to not overwhelm it.</p>
<dl class="method">
<dt id="buildbot.util.service.SharedService.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>self</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.SharedService.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor of the service.</p>
<p>Note that unlike <a class="reference internal" href="#buildbot.util.service.BuildbotService" title="buildbot.util.service.BuildbotService"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildbotService</span></code></a>, <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> is not reconfigurable and uses the classical constructor method.</p>
<p>Reconfigurability would mean to add some kind of reference counting of the users, which will make the design much more complicated to use.
This means that the SharedService will not be destroyed when there is no more users, it will be destroyed at the master’s stopService
It is important that those <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> life cycles are properly handled.
Twisted will indeed wait for any thread pool to finish at master stop, which will not happen if the thread pools are not properly closed.</p>
<p>The lifecycle of the SharedService is the same as a service, it must implement startService and stopService in order to allocate and free its resources.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.SharedService.getName">
<code class="descname">getName</code><span class="sig-paren">(</span><em>cls</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.SharedService.getName" title="Permalink to this definition">¶</a></dt>
<dd><p>Class method.
Takes same arguments as the constructor of the service.
Get a unique name for that instance of a service.
This returned name is the key inside the parent’s service dictionary that is used to decide if the instance has already been created before or if there is a need to create a new object.
Default implementation will hash args and kwargs and use <code class="docutils literal notranslate"><span class="pre">&lt;classname&gt;_&lt;hash&gt;</span></code> as the name.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.SharedService.getService">
<code class="descname">getService</code><span class="sig-paren">(</span><em>cls</em>, <em>parentService</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.SharedService.getService" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>parentService</strong> – an <a class="reference internal" href="#buildbot.util.service.AsyncMultiService" title="buildbot.util.service.AsyncMultiService"><code class="xref py py-class docutils literal notranslate"><span class="pre">AsyncMultiService</span></code></a> where to lookup and register the <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> (usually the root service, the master)</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">instance of the service via Deferred</td>
</tr>
</tbody>
</table>
<p>Class method.
Takes same arguments as the constructor of the service (plus the <cite>parentService</cite> at the beginning of the list).
Construct an instance of the service if needed, and place it at the beginning of the <cite>parentService</cite> service list.
Placing it at the beginning will guarantee that the <a class="reference internal" href="#buildbot.util.service.SharedService" title="buildbot.util.service.SharedService"><code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code></a> will be stopped after the other services.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.util.service.BuildbotService">
<em class="property">class </em><code class="descclassname">buildbot.util.service.</code><code class="descname">BuildbotService</code><a class="headerlink" href="#buildbot.util.service.BuildbotService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is the combinations of all <cite>Service</cite> classes implemented in buildbot.
It is Async, MultiService, and Reconfigurable, and designed to be eventually the base class for all buildbot services.
This class makes it easy to manage (re)configured services.</p>
<p>The design separates the check of the config and the actual configuration/start.
A service sibling is a configured object that has the same name of a previously started service.
The sibling configuration will be used to configure the running service.</p>
<p>Service lifecycle is as follow:</p>
<ul class="simple">
<li>Buildbot master start</li>
<li>Buildbot is evaluating the configuration file.
BuildbotServices are created, and checkConfig() are called by the generic constructor.</li>
<li>If everything is fine, all services are started.
BuildbotServices startService() is called, and call reconfigService() for the first time.</li>
<li>User reconfigures buildbot.</li>
<li>Buildbot is evaluating the configuration file.
BuildbotServices siblings are created, and checkConfig() are called by the generic constructor.</li>
<li>BuildbotServiceManager is figuring out added services, removed services, unchanged services</li>
<li>BuildbotServiceManager calls stopService() for services that disappeared from the configuration.</li>
<li>BuildbotServiceManager calls startService() like in buildbot start phase for services that appeared from the configuration.</li>
<li>BuildbotServiceManager calls reconfigService() for the second time for services that have their configuration changed.</li>
</ul>
<dl class="method">
<dt id="buildbot.util.service.BuildbotService.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>self</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor of the service.
The constructor initialize the service, and store the config arguments in private attributes.</p>
<p>This should <em>not</em> be overridden by subclasses, as they should rather override checkConfig.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.BuildbotService.checkConfig">
<code class="descname">checkConfig</code><span class="sig-paren">(</span><em>self</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.checkConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Please override this method to check the parameters of your config.
Please use <a class="reference internal" href="#buildbot.config.error" title="buildbot.config.error"><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.config.error</span></code></a> for error reporting.
You can replace them <code class="docutils literal notranslate"><span class="pre">*args,</span> <span class="pre">**kwargs</span></code> by actual constructor like arguments with default args, and it have to match self.reconfigService
This method is synchronous, and executed in the context of the master.cfg.
Please don’t block, or use deferreds in this method.
Remember that the object that runs checkConfig is not always the object that is actually started.
The checked configuration can be passed to another sibling service.
Any actual resource creation shall be handled in reconfigService() or startService()</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.BuildbotService.reconfigService">
<code class="descname">reconfigService</code><span class="sig-paren">(</span><em>self</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.reconfigService" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called at buildbot startup, and buildbot reconfig.
<cite>*args</cite> and <cite>**kwargs</cite> are the configuration arguments passed to the constructor in master.cfg.
You can replace <code class="docutils literal notranslate"><span class="pre">them</span> <span class="pre">*args,</span> <span class="pre">**kwargs</span></code> by actual constructor like arguments with default args, and it have to match self.checkConfig</p>
<p>Returns a deferred that should fire when the service is ready.
Builds are not started until all services are configured.</p>
<p>BuildbotServices must be aware that during reconfiguration, their methods can still be called by running builds.
So they should atomically switch old configuration and new configuration, so that the service is always available.</p>
<p>If this method raises <code class="xref py py-class docutils literal notranslate"><span class="pre">NotImplementedError</span></code>, it means the service is legacy, and do not support reconfiguration.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildbotServiceManager</span></code> parent, will detect this, and swap old service with new service.
This behaviour allow smooth transition of old code to new reconfigurable service lifecycle but shall not be used for new code.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.BuildbotService.reconfigServiceWithSibling">
<code class="descname">reconfigServiceWithSibling</code><span class="sig-paren">(</span><em>self</em>, <em>sibling</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.reconfigServiceWithSibling" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal method that finds the configuration bits in a sibling, an object with same class that is supposed to replace it from a new configuration.
We want to reuse the service started at master startup and just reconfigure it.
This method handles necessary steps to detect if the config has changed, and eventually call self.reconfigService()</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.BuildbotService.renderSecrets">
<code class="descname">renderSecrets</code><span class="sig-paren">(</span><em>self</em>, <em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.BuildbotService.renderSecrets" title="Permalink to this definition">¶</a></dt>
<dd><p>Utility method which renders a list of parameters which can be interpolated as a secret.
This is meant for services which have their secrets parameter configurable as positional arguments.
If there are several argument, the secrets are interpolated in parallel, and a list of result is returned via deferred.
If there is one argument, the result is directly returned.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For keyword arguments, a simpler method is to use the <code class="docutils literal notranslate"><span class="pre">secrets</span></code> class variable, which items
will be automatically interpolated just before reconfiguration.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">user</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderSecrets</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">token</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderSecrets</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">secrets</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;password&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">...</span><span class="p">):</span>
    <span class="c1"># nothing to do user and password will be automatically interpolated</span>
</pre></div>
</div>
</dd></dl>

<p>Advanced users can derive this class to make their own services that run inside buildbot, and follow the application lifecycle of buildbot master.</p>
<p>Such services are singletons accessible in nearly every objects of buildbot (buildsteps, status, changesources, etc) using self.master.namedServices[‘&lt;nameOfYourService’].</p>
<p>As such, they can be used to factorize access to external services, available e.g using a REST api.
Having a single service will help with caching, and rate-limiting access of those APIs.</p>
<p>Here is an example on how you would integrate and configure a simple service in your <cite>master.cfg</cite>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyShellCommand</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">getResultSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># access the service attribute</span>
        <span class="n">service</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">namedServices</span><span class="p">[</span><span class="s1">&#39;myService&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;arg value: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">arg1</span><span class="p">,))</span>

<span class="k">class</span> <span class="nc">MyService</span><span class="p">(</span><span class="n">BuildbotService</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;myService&quot;</span>

    <span class="k">def</span> <span class="nf">checkConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">config</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;arg1 must be an integer while it is </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,))</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">arg1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;arg1 must be positive while it is </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">arg1</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arg1</span> <span class="o">=</span> <span class="n">arg1</span>
        <span class="k">return</span> <span class="n">defer</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ForceScheduler</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;testy&quot;</span><span class="p">])]</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MyShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;echo hei&#39;</span><span class="p">))</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;testy&quot;</span><span class="p">,</span>
                  <span class="n">workernames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;local1&quot;</span><span class="p">],</span>
                  <span class="n">factory</span><span class="o">=</span><span class="n">f</span><span class="p">)]</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;services&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">MyService</span><span class="p">(</span><span class="n">arg1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="buildbot-util-httpclientservice">
<h5>3.2.8.18. <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.httpclientservice</span></code><a class="headerlink" href="#buildbot-util-httpclientservice" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.util.service.HTTPClientService">
<em class="property">class </em><code class="descclassname">buildbot.util.service.</code><code class="descname">HTTPClientService</code><a class="headerlink" href="#buildbot.util.service.HTTPClientService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements a SharedService for doing http client access.
The module automatically chooses from <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> and <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> and uses whichever is installed.
It provides minimalistic API similar to the one from <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> and <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a>.
Having a SharedService for this allows to limits the number of simultaneous connection for the same host.
While twisted application can managed thousands of connections at the same time, this is often not the case for the services buildbot controls.
Both <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> and <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> use keep-alive connection polling.
Lots of HTTP REST API will however force a connection close in the end of a transaction.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The API described here is voluntary minimalistic, and reflects what is tested.
As most of this module is implemented as a pass-through to the underlying libraries, other options can work but have not been tested to work in both backends.
If there is a need for more functionality, please add new tests before using them.</p>
</div>
<dl class="staticmethod">
<dt id="buildbot.util.service.HTTPClientService.getService">
<em class="property">static </em><code class="descname">getService</code><span class="sig-paren">(</span><em>master</em>, <em>base_url</em>, <em>auth=None</em>, <em>headers=None</em>, <em>debug=None</em>, <em>verify=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.getService" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>master</strong> – the instance of the master service (available in self.master for all the <a class="reference internal" href="#buildbot.util.service.BuildbotService" title="buildbot.util.service.BuildbotService"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildbotService</span></code></a> instances)</li>
<li><strong>base_url</strong> – The base http url of the service to access. e.g. <code class="docutils literal notranslate"><span class="pre">http://github.com/</span></code></li>
<li><strong>auth</strong> – Authentication information. If auth is a tuple then <code class="docutils literal notranslate"><span class="pre">BasicAuth</span></code> will be used. e.g <code class="docutils literal notranslate"><span class="pre">('user',</span> <span class="pre">'passwd')</span></code>
It can also be a <code class="xref py py-mod docutils literal notranslate"><span class="pre">requests.auth</span></code> authentication plugin.
In this case <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> will be forced, and <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> cannot be used.</li>
<li><strong>headers</strong> – The headers to pass to every requests for this url</li>
<li><strong>debug</strong> – log every requests and every response.</li>
<li><strong>verify</strong> – disable the SSL verification.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">instance of :<cite>HTTPClientService</cite></p>
</td>
</tr>
</tbody>
</table>
<p>Get an instance of the SharedService.
There is one instance per base_url and auth.</p>
<p>The constructor initialize the service, and store the config arguments in private attributes.</p>
<p>This should <em>not</em> be overridden by subclasses, as they should rather override checkConfig.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>endpoint</em>, <em>params=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>endpoint</strong> – endpoint relative to the base_url (starts with <code class="docutils literal notranslate"><span class="pre">/</span></code>)</li>
<li><strong>params</strong> – optional dictionary that will be encoded in the query part of the url (e.g. <code class="docutils literal notranslate"><span class="pre">?param1=foo</span></code>)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">implementation of :<cite>IHTTPResponse</cite> via deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Performs a HTTP <code class="docutils literal notranslate"><span class="pre">GET</span></code></p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.delete">
<code class="descname">delete</code><span class="sig-paren">(</span><em>endpoint</em>, <em>params=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.delete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>endpoint</strong> – endpoint relative to the base_url (starts with <code class="docutils literal notranslate"><span class="pre">/</span></code>)</li>
<li><strong>params</strong> – optional dictionary that will be encoded in the query part of the url (e.g. <code class="docutils literal notranslate"><span class="pre">?param1=foo</span></code>)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">implementation of :<cite>IHTTPResponse</cite> via deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Performs a HTTP <code class="docutils literal notranslate"><span class="pre">DELETE</span></code></p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.post">
<code class="descname">post</code><span class="sig-paren">(</span><em>endpoint</em>, <em>data=None</em>, <em>json=None</em>, <em>params=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.post" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>endpoint</strong> – endpoint relative to the base_url (starts with <code class="docutils literal notranslate"><span class="pre">/</span></code>)</li>
<li><strong>data</strong> – optional dictionary that will be encoded in the body of the http requests as <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code></li>
<li><strong>json</strong> – optional dictionary that will be encoded in the body of the http requests as <code class="docutils literal notranslate"><span class="pre">application/json</span></code></li>
<li><strong>params</strong> – optional dictionary that will be encoded in the query part of the url (e.g. <code class="docutils literal notranslate"><span class="pre">?param1=foo</span></code>)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">implementation of :<cite>IHTTPResponse</cite> via deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Performs a HTTP <code class="docutils literal notranslate"><span class="pre">POST</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">json and data cannot be used at the same time.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.HTTPClientService.put">
<code class="descname">put</code><span class="sig-paren">(</span><em>endpoint</em>, <em>data=None</em>, <em>json=None</em>, <em>params=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.HTTPClientService.put" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>endpoint</strong> – endpoint relative to the base_url (starts with <code class="docutils literal notranslate"><span class="pre">/</span></code>)</li>
<li><strong>data</strong> – optional dictionary that will be encoded in the body of the http requests as <code class="docutils literal notranslate"><span class="pre">application/x-www-form-urlencoded</span></code></li>
<li><strong>json</strong> – optional dictionary that will be encoded in the body of the http requests as <code class="docutils literal notranslate"><span class="pre">application/json</span></code></li>
<li><strong>params</strong> – optional dictionary that will be encoded in the query part of the url (e.g. <code class="docutils literal notranslate"><span class="pre">?param1=foo</span></code>)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">implementation of :<cite>IHTTPResponse</cite> via deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Performs a HTTP <code class="docutils literal notranslate"><span class="pre">PUT</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">json and data cannot be used at the same time.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.util.service.IHTTPResponse">
<em class="property">class </em><code class="descclassname">buildbot.util.service.</code><code class="descname">IHTTPResponse</code><a class="headerlink" href="#buildbot.util.service.IHTTPResponse" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="first admonition-title">Note</p>
<p><a class="reference internal" href="#buildbot.util.service.IHTTPResponse" title="buildbot.util.service.IHTTPResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">IHTTPResponse</span></code></a> is a subset of <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> <code class="xref py py-class docutils literal notranslate"><span class="pre">Response</span></code> API described <a class="reference external" href="https://treq.readthedocs.io/en/latest/api.html#module-treq.response">here</a>
The API it is voluntarily minimalistic and reflects what is tested and reliable to use with the three backends (including fake).
The api is a subset of the <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> API, which is itself a superset of <a class="reference external" href="https://twistedmatrix.com/documents/current/api/twisted.web.iweb.IResponse.html">twisted IResponse API</a>.
<a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> is thus implemented as passthrough.</p>
<p>Notably:</p>
<ul class="last simple">
<li>There is no api to automatically decode content, as this is not implemented the same in both backends.</li>
<li>There is no api to stream content as the two libraries have very different way for doing it, and we do not see use-case where buildbot would need to transfer large content to the master.</li>
</ul>
</div>
<dl class="method">
<dt id="buildbot.util.service.IHTTPResponse.content">
<code class="descname">content</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.IHTTPResponse.content" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">raw (<code class="docutils literal notranslate"><span class="pre">bytes</span></code>) content of the response via deferred</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.service.IHTTPResponse.json">
<code class="descname">json</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.IHTTPResponse.json" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">json decoded content of the response via deferred</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.service.IHTTPResponse.code">
<code class="descname">code</code><a class="headerlink" href="#buildbot.util.service.IHTTPResponse.code" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">http status code of the request’s response (e.g 200)</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="buildbot-test-fake-httpclientservice">
<h5>3.2.8.19. <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.test.fake.httpclientservice</span></code><a class="headerlink" href="#buildbot-test-fake-httpclientservice" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">buildbot.util.service.</code><code class="descname">HTTPClientService</code></dt>
<dd><p>This class implements a fake version of the <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.httpclientservice.HTTPClientService</span></code> that needs to be used for testing services which needs http client access.
It implements the same APIs as <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.httpclientservice.HTTPClientService</span></code>, plus one that should be used to register the expectations.
It should be registered by the test case before the tested service actually requests an HTTPClientService instance, with the same parameters.
It will then replace the original implementation automatically (no need to patch anything).
The testing methodology is based on <a class="reference external" href="https://docs.angularjs.org/api/ngMock/service/$httpBackend">AngularJS ngMock</a>.</p>
<dl class="method">
<dt>
<code class="descname">getFakeService(cls, master, case, *args, **kwargs):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>master</strong> – the instance of a fake master service</li>
<li><strong>case</strong> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">twisted.python.unittest.TestCase</span></code> instance</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p><code class="xref py py-meth docutils literal notranslate"><span class="pre">getFakeService</span></code> returns a fake <a class="reference internal" href="#buildbot.util.service.HTTPClientService" title="buildbot.util.service.HTTPClientService"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPClientService</span></code></a>, and should be used in place of <a class="reference internal" href="#buildbot.util.service.HTTPClientService.getService" title="buildbot.util.service.HTTPClientService.getService"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getService</span></code></a>.</p>
<p>on top of <a class="reference internal" href="#buildbot.util.service.HTTPClientService.getService" title="buildbot.util.service.HTTPClientService.getService"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getService</span></code></a> it will make sure the original <a class="reference internal" href="#buildbot.util.service.HTTPClientService" title="buildbot.util.service.HTTPClientService"><code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPClientService</span></code></a> is not called, and assert that all expected http requests have been described in the test case.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">expect(self, method, ep, params=None, data=None, json=None, code=200,</code></dt>
<dt>
<code class="descname">content=None, content_json=None):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> – expected HTTP method</li>
<li><strong>ep</strong> – expected endpoint</li>
<li><strong>params</strong> – optional expected query parameters</li>
<li><strong>data</strong> – optional expected non-json data (bytes)</li>
<li><strong>json</strong> – optional expected json data (dictionary or list or string)</li>
<li><strong>code</strong> – optional http code that will be received</li>
<li><strong>content</strong> – optional content that will be received</li>
<li><strong>content_json</strong> – optional content encoded in json that will be received</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Records an expectation of HTTP requests that will happen during the test.
The order of the requests is important.
All the request expectation must be defined in the test.</p>
<p>example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span>
<span class="kn">from</span> <span class="nn">twisted.trial</span> <span class="kn">import</span> <span class="n">unittest</span>

<span class="kn">from</span> <span class="nn">buildbot.test.fake</span> <span class="kn">import</span> <span class="n">httpclientservice</span> <span class="k">as</span> <span class="n">fakehttpclientservice</span>
<span class="kn">from</span> <span class="nn">buildbot.util</span> <span class="kn">import</span> <span class="n">httpclientservice</span>
<span class="kn">from</span> <span class="nn">buildbot.util</span> <span class="kn">import</span> <span class="n">service</span>


<span class="k">class</span> <span class="nc">myTestedService</span><span class="p">(</span><span class="n">service</span><span class="o">.</span><span class="n">BuildbotService</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;myTestedService&#39;</span>

    <span class="nd">@defer.inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">reconfigService</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">httpclientservice</span><span class="o">.</span><span class="n">HTTPClientService</span><span class="o">.</span><span class="n">getService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">)</span>

    <span class="nd">@defer.inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">doGetRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">_http</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="c1"># note that at this point, only the http response headers are received</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">: server did not succeed&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>
        <span class="n">res_json</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">res</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="c1"># res.json() returns a deferred to account for the time needed to fetch the entire body</span>
        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">res_json</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Test</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">SynchronousTestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">baseurl</span> <span class="o">=</span> <span class="s1">&#39;http://127.0.0.1:8080&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">MasterService</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successResultOf</span><span class="p">(</span><span class="n">fakehttpclientservice</span><span class="o">.</span><span class="n">HTTPClientService</span><span class="o">.</span><span class="n">getFakeService</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tested</span> <span class="o">=</span> <span class="n">myTestedService</span><span class="p">(</span><span class="n">baseurl</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">successResultOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">setServiceParent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">successResultOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">startService</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">test_root</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">content_json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">successResultOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">doGetRoot</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">test_root_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_http</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">content_json</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">},</span> <span class="n">code</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">failureResultOf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tested</span><span class="o">.</span><span class="n">doGetRoot</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getErrorMessage</span><span class="p">(),</span> <span class="s1">&#39;404: server did not succeed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="buildbot-util-ssl">
<h5>3.2.8.20. <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.ssl</span></code><a class="headerlink" href="#buildbot-util-ssl" title="Permalink to this headline">¶</a></h5>
<p>This module is a copy of <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.internet.ssl</span></code> except it won’t crash with <code class="xref py py-class docutils literal notranslate"><span class="pre">ImportError</span></code> if <code class="xref py py-mod docutils literal notranslate"><span class="pre">pyopenssl</span></code> is not installed.
If you need to use <code class="xref py py-mod docutils literal notranslate"><span class="pre">twisted.internet.ssl</span></code>, please instead use <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.ssl</span></code>, and call <code class="xref py py-func docutils literal notranslate"><span class="pre">ssl.ensureHasSSL</span></code> in <code class="xref py py-meth docutils literal notranslate"><span class="pre">checkConfig</span></code> to provide helpful message to the user, only if he enabled SSL for your plugin.</p>
<dl class="function">
<dt id="buildbot.util.service.ensureHasSSL">
<code class="descclassname">buildbot.util.service.</code><code class="descname">ensureHasSSL</code><span class="sig-paren">(</span><em>plugin_name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.ensureHasSSL" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>plugin_name</strong> – name of the plugin. Usually <code class="docutils literal notranslate"><span class="pre">self.__class__.__name__</span></code></td>
</tr>
</tbody>
</table>
<p>Call this function to provide helpful config error to the user in case of <code class="docutils literal notranslate"><span class="pre">OpenSSL</span></code> not installed.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.service.skipUnless">
<code class="descclassname">buildbot.util.service.</code><code class="descname">skipUnless</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.util.service.skipUnless" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>f</strong> – decorated test</td>
</tr>
</tbody>
</table>
<p>Test decorator which will skip the test if <code class="docutils literal notranslate"><span class="pre">OpenSSL</span></code> is not installed.</p>
</dd></dl>

</div>
</div>
<span id="document-developer/results"></span><div class="section" id="module-buildbot.process.results">
<span id="id1"></span><span id="build-result-codes"></span><h4>3.2.9. Build Result Codes<a class="headerlink" href="#module-buildbot.process.results" title="Permalink to this headline">¶</a></h4>
<p>Buildbot represents the status of a step, build, or buildset using a set of
numeric constants.  From Python, these constants are available in the module
<code class="docutils literal notranslate"><span class="pre">buildbot.process.results</span></code>, but the values also appear in the database and in
external tools, so the values are fixed.</p>
<dl class="data">
<dt id="buildbot.process.results.SUCCESS">
<code class="descclassname">buildbot.process.results.</code><code class="descname">SUCCESS</code><a class="headerlink" href="#buildbot.process.results.SUCCESS" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 0; color: green; a successful run.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.process.results.WARNINGS">
<code class="descclassname">buildbot.process.results.</code><code class="descname">WARNINGS</code><a class="headerlink" href="#buildbot.process.results.WARNINGS" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 1; color: orange; a successful run, with some warnings.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.process.results.FAILURE">
<code class="descclassname">buildbot.process.results.</code><code class="descname">FAILURE</code><a class="headerlink" href="#buildbot.process.results.FAILURE" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 2; color: red; a failed run, due to problems in the build itself, as
opposed to a Buildbot misconfiguration or bug.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.process.results.SKIPPED">
<code class="descclassname">buildbot.process.results.</code><code class="descname">SKIPPED</code><a class="headerlink" href="#buildbot.process.results.SKIPPED" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 3; color: white; a run that was skipped – usually a step skipped by
<code class="docutils literal notranslate"><span class="pre">doStepIf</span></code> (see <a class="reference internal" href="#buildstep-common-parameters"><span class="std std-ref">Common Parameters</span></a>)</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.process.results.EXCEPTION">
<code class="descclassname">buildbot.process.results.</code><code class="descname">EXCEPTION</code><a class="headerlink" href="#buildbot.process.results.EXCEPTION" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 4; color: purple; a run that failed due to a problem in Buildbot
itself.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.process.results.RETRY">
<code class="descclassname">buildbot.process.results.</code><code class="descname">RETRY</code><a class="headerlink" href="#buildbot.process.results.RETRY" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 5; color: purple; a run that should be retried, usually due to a
worker disconnection.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.process.results.CANCELLED">
<code class="descclassname">buildbot.process.results.</code><code class="descname">CANCELLED</code><a class="headerlink" href="#buildbot.process.results.CANCELLED" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 6; color: pink; a run that was cancelled by the user.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.process.results.Results">
<code class="descclassname">buildbot.process.results.</code><code class="descname">Results</code><a class="headerlink" href="#buildbot.process.results.Results" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary mapping result codes to their lowercase names.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.process.results.worst_status">
<code class="descclassname">buildbot.process.results.</code><code class="descname">worst_status</code><span class="sig-paren">(</span><em>a</em>, <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.results.worst_status" title="Permalink to this definition">¶</a></dt>
<dd><p>This function takes two status values, and returns the “worst” status of the two.
This is used to aggregate step statuses into build statuses, and build statuses into buildset statuses.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">computeResultAndTermination(obj, result, previousResult):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>obj</strong> – an object with the attributes of <a class="reference internal" href="#buildbot.process.results.ResultComputingConfigMixin" title="buildbot.process.results.ResultComputingConfigMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultComputingConfigMixin</span></code></a></li>
<li><strong>result</strong> – the new result</li>
<li><strong>previousResult</strong> – the previous aggregated result</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Building on <a class="reference internal" href="#buildbot.process.results.worst_status" title="buildbot.process.results.worst_status"><code class="xref py py-func docutils literal notranslate"><span class="pre">worst_status</span></code></a>, this function determines what the aggregated overall status is, as well as whether the attempt should be terminated, based on the configuration in <code class="docutils literal notranslate"><span class="pre">obj</span></code>.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.process.results.ResultComputingConfigMixin">
<em class="property">class </em><code class="descclassname">buildbot.process.results.</code><code class="descname">ResultComputingConfigMixin</code><a class="headerlink" href="#buildbot.process.results.ResultComputingConfigMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This simple mixin is intended to help implement classes that will use <code class="xref py py-meth docutils literal notranslate"><span class="pre">computeResultAndTermination</span></code>.
The class has, as class attributes, the result computing configuration parameters with default values:</p>
<dl class="attribute">
<dt id="buildbot.process.results.ResultComputingConfigMixin.haltOnFailure">
<code class="descname">haltOnFailure</code><a class="headerlink" href="#buildbot.process.results.ResultComputingConfigMixin.haltOnFailure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.results.ResultComputingConfigMixin.flunkOnWarnings">
<code class="descname">flunkOnWarnings</code><a class="headerlink" href="#buildbot.process.results.ResultComputingConfigMixin.flunkOnWarnings" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.results.ResultComputingConfigMixin.flunkOnFailure">
<code class="descname">flunkOnFailure</code><a class="headerlink" href="#buildbot.process.results.ResultComputingConfigMixin.flunkOnFailure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.results.ResultComputingConfigMixin.warnOnWarnings">
<code class="descname">warnOnWarnings</code><a class="headerlink" href="#buildbot.process.results.ResultComputingConfigMixin.warnOnWarnings" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.results.ResultComputingConfigMixin.warnOnFailure">
<code class="descname">warnOnFailure</code><a class="headerlink" href="#buildbot.process.results.ResultComputingConfigMixin.warnOnFailure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The names of these attributes are available in the following attribute:</p>
<dl class="attribute">
<dt id="buildbot.process.results.ResultComputingConfigMixin.resultConfig">
<code class="descname">resultConfig</code><a class="headerlink" href="#buildbot.process.results.ResultComputingConfigMixin.resultConfig" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<span id="document-developer/www-server"></span><div class="section" id="www-server">
<span id="www"></span><span id="id1"></span><h4>3.2.10. WWW Server<a class="headerlink" href="#www-server" title="Permalink to this headline">¶</a></h4>
<div class="section" id="history-and-motivation">
<h5>3.2.10.1. History and Motivation<a class="headerlink" href="#history-and-motivation" title="Permalink to this headline">¶</a></h5>
<p>One of the goals of the ‘nine’ project is to rework Buildbot’s web services to use a more modern, consistent design and implement UI features in client-side JavaScript instead of server-side Python.</p>
<p>The rationale behind this is that a client side UI relieves pressure on the server while being more responsive for the user.
The web server only concentrates on serving data via a REST interface wrapping the <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a>.
This removes a lot of sources of latency where, in previous versions, long synchronous calculations were made on the server to generate complex pages.</p>
<p>Another big advantage is live updates of status pages, without having to poll or reload.
The new system uses Comet techniques in order to relay Data API events to connected clients.</p>
<p>Finally, making web services an integral part of Buildbot, rather than a status plugin, allows tighter integration with the rest of the application.</p>
</div>
<div class="section" id="design-overview">
<h5>3.2.10.2. Design Overview<a class="headerlink" href="#design-overview" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">www</span></code> service exposes three pieces via HTTP:</p>
<ul class="simple">
<li>A REST interface wrapping <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a>;</li>
<li>HTTP-based messaging protocols wrapping the <a class="reference internal" href="#messaging-and-queues"><span class="std std-ref">Messaging and Queues</span></a> interface; and</li>
<li>Static resources implementing the client-side UI.</li>
</ul>
<p>The REST interface is a very thin wrapper: URLs are translated directly into Data API paths, and results are returned directly, in JSON format.
It is based on <a class="reference external" href="http://jsonapi.org/">JSON API</a>.
Control calls are handled with a simplified form of <a class="reference external" href="http://www.jsonrpc.org/specification">JSONRPC 2.0</a>.</p>
<p>The message interface is also a thin wrapper around Buildbot’s MQ mechanism.
Clients can subscribe to messages, and receive copies of the messages, in JSON, as they are received by the buildmaster.</p>
<p>The client-side UI is an AngularJS application.
Buildbot uses the Python setuptools entry-point mechanism to allow multiple packages to be combined into a single client-side experience.
This allows frontend developers and users to build custom components for the web UI without hacking Buildbot itself.</p>
<p>Python development and AngularJS development are very different processes, requiring different environment requirements and skillsets.
To maximize hackability, Buildbot separates the two cleanly.
An experienced AngularJS hacker should be quite comfortable in the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/www/">www/</a> directory, with a few exceptions described below.
Similarly, an experienced Python hacker can simply download the pre-built web UI (from pypi!) and never venture near the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/www/">www/</a> directory.</p>
<div class="section" id="urls">
<h6>URLs<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h6>
<p>The Buildbot web interface is rooted at its base URL, as configured by the user.
It is entirely possible for this base URL to contain path components, e.g., <code class="docutils literal notranslate"><span class="pre">http://build.example.org/buildbot/</span></code>, if hosted behind an HTTP proxy.
To accomplish this, all URLs are generated relative to the base URL.</p>
<p>Overall, the space under the base URL looks like this:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">/</span></code> – The HTML document that loads the UI</li>
<li><code class="docutils literal notranslate"><span class="pre">/api/v{version}</span></code> – The root of the REST APIs, each versioned numerically.
Users should, in general, use the latest version.</li>
<li><code class="docutils literal notranslate"><span class="pre">/ws</span></code> – The WebSocket endpoint to subscribe to messages from the mq system.</li>
<li><code class="docutils literal notranslate"><span class="pre">/sse</span></code> – The <a class="reference external" href="http://en.wikipedia.org/wiki/Server-sent_events">server sent event</a> endpoint where clients can subscribe to messages from the mq system.</li>
</ul>
</div>
</div>
<div class="section" id="rest-api">
<h5>3.2.10.3. REST API<a class="headerlink" href="#rest-api" title="Permalink to this headline">¶</a></h5>
<p>Rest API is described in its own section.</p>
</div>
<div class="section" id="server-side-session">
<h5>3.2.10.4. Server-Side Session<a class="headerlink" href="#server-side-session" title="Permalink to this headline">¶</a></h5>
<p>The web server keeps a session state for each user, keyed on a session cookie.
This session is available from <code class="docutils literal notranslate"><span class="pre">request.getSession()</span></code>, and data is stored as attributes.
The following attributes may be available:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">user_info</span></code></dt>
<dd><p class="first">A dictionary maintained by the <a class="reference internal" href="#document-developer/auth"><span class="doc">authentication subsystem</span></a>.
It may have the following information about the logged-in user:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">username</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">email</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">full_name</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">groups</span></code> (a list of group names)</li>
</ul>
<p>As well as additional fields specific to the user info implementation.</p>
<p class="last">The contents of the <code class="docutils literal notranslate"><span class="pre">user_info</span></code> dictionary are made available to the UI as <code class="docutils literal notranslate"><span class="pre">config.user</span></code>.</p>
</dd>
</dl>
<p>Message API</p>
<p>Currently messages are implemented with two protocols: WebSockets and <a class="reference external" href="http://en.wikipedia.org/wiki/Server-sent_events">server sent event</a>.
This may be supplemented with other mechanisms before release.</p>
<div class="section" id="websocket">
<h6>WebSocket<a class="headerlink" href="#websocket" title="Permalink to this headline">¶</a></h6>
<p>WebSocket is a protocol for arbitrary messaging to and from browser.
As an HTTP extension, the protocol is not yet well supported by all HTTP proxy technologies. Although, it has been reported to work well used behind the https protocol. Only one WebSocket connection is needed per browser.</p>
<p>Client can connect using url <code class="docutils literal notranslate"><span class="pre">ws[s]://&lt;BB_BASE_URL&gt;/ws</span></code></p>
<p>The protocol used is a simple in-house protocol based on json. Structure of a command from client is as following:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;cmd&quot;</span><span class="o">:</span> <span class="s2">&quot;&lt;command name&gt;&quot;</span><span class="p">,</span> <span class="s1">&#39;_id&#39;</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">id</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">command</span><span class="o">&gt;</span><span class="p">,</span> <span class="s2">&quot;arg1&quot;</span><span class="o">:</span> <span class="nx">arg1</span><span class="p">,</span> <span class="s2">&quot;arg2&quot;</span><span class="o">:</span> <span class="nx">arg2</span> <span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">cmd</span></code> is use to reference a command name</li>
<li><code class="docutils literal notranslate"><span class="pre">_id</span></code> is used to track the response, can be any unique number or string.
Generated by the client.
Needs to be unique per websocket session.</li>
</ul>
<p>Response is sent asynchronously, reusing <code class="docutils literal notranslate"><span class="pre">_id</span></code> to track which command is responded.</p>
<p>Success answer example would be:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;msg&quot;</span><span class="o">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span> <span class="s1">&#39;_id&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">code</span><span class="o">=</span><span class="mi">200</span> <span class="p">}</span>
</pre></div>
</div>
<p>Error answer example would be:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;code&quot;</span><span class="o">:</span><span class="mi">404</span><span class="p">,</span><span class="s2">&quot;error&quot;</span><span class="o">:</span><span class="s2">&quot;no such command \&#39;poing\&#39;&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Client can send several command without waiting response.</p>
<p>Responses are not guaranteed to be sent in order.</p>
<p>Several command are implemented:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">ping</span></code></dt>
<dd><div class="first highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;cmd&quot;</span><span class="o">:</span><span class="s2">&quot;ping&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>server will respond with a “pong” message:</p>
<div class="last highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;msg&quot;</span><span class="o">:</span><span class="s2">&quot;pong&quot;</span><span class="p">,</span><span class="s2">&quot;code&quot;</span><span class="o">:</span><span class="mi">200</span><span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">startConsuming</span></code></dt>
<dd><p class="first">start consuming events that match <code class="docutils literal notranslate"><span class="pre">path</span></code>.
<code class="docutils literal notranslate"><span class="pre">path</span></code> are described in the <a class="reference internal" href="#messaging-and-queues"><span class="std std-ref">Messaging and Queues</span></a> section.
For size optimization reasons, path are encoded joined with “/”, and with None wildcard replaced by ‘*’.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;cmd&quot;</span><span class="o">:</span><span class="s2">&quot;startConsuming&quot;</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;change/*/*&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Success answer example will be:</p>
<div class="last highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;msg&quot;</span><span class="o">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span> <span class="s1">&#39;_id&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">code</span><span class="o">=</span><span class="mi">200</span> <span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stopConsuming</span></code></dt>
<dd><p class="first">stop consuming events that was previously registered with <code class="docutils literal notranslate"><span class="pre">path</span></code>.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;cmd&quot;</span><span class="o">:</span><span class="s2">&quot;stopConsuming&quot;</span><span class="p">,</span> <span class="s2">&quot;path&quot;</span><span class="o">:</span> <span class="s2">&quot;change/*/*&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Success answer example will be:</p>
<div class="last highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span> <span class="s2">&quot;msg&quot;</span><span class="o">:</span> <span class="s2">&quot;OK&quot;</span><span class="p">,</span> <span class="s1">&#39;_id&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">code</span><span class="o">=</span><span class="mi">200</span> <span class="p">}</span>
</pre></div>
</div>
</dd>
</dl>
<p>Client will receive events as websocket frames encoded in json with following format:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;k&quot;</span><span class="o">:</span><span class="nx">key</span><span class="p">,</span><span class="s2">&quot;m&quot;</span><span class="o">:</span><span class="nx">message</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="server-sent-events">
<span id="sse"></span><h6>Server Sent Events<a class="headerlink" href="#server-sent-events" title="Permalink to this headline">¶</a></h6>
<p>SSE is a simpler protocol than WebSockets and is more REST compliant. It uses the chunk-encoding HTTP feature to stream the events. SSE also does not works well behind enterprise proxy, unless you use the https protocol</p>
<p>Client can connect using following endpoints</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">http[s]://&lt;BB_BASE_URL&gt;/sse/listen/&lt;path&gt;</span></code>: Start listening to events on the http connection.
Optionally setup a first event filter on <code class="docutils literal notranslate"><span class="pre">&lt;path&gt;</span></code>.
The first message send is a handshake, giving a uuid that can be used to add or remove event filters.</li>
<li><code class="docutils literal notranslate"><span class="pre">http[s]://&lt;BB_BASE_URL&gt;/sse/add/&lt;uuid&gt;/&lt;path&gt;</span></code>: Configure a sse session to add an event filter</li>
<li><code class="docutils literal notranslate"><span class="pre">http[s]://&lt;BB_BASE_URL&gt;/sse/remove/&lt;uuid&gt;/&lt;path&gt;</span></code>: Configure a sse session to remove an event filter</li>
</ul>
<p>Note that if a load balancer is setup as a front end to buildbot web masters, the load balancer must be configured to always use the same master given a client ip address for /sse endpoint.</p>
<p>Client will receive events as sse events, encoded with following format:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>event: event
data: {&#39;key&#39;: &lt;key&gt;, &#39;message&#39;: &lt;message&gt;}
</pre></div>
</div>
<p>The first event received is a handshake, and is used to inform the client about uuid to use for configuring additional event filters</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>event: handshake
data: &lt;uuid&gt;
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-developer/www-data-module"></span><div class="section" id="javascript-data-module">
<span id="www-data-module"></span><h4>3.2.11. Javascript Data Module<a class="headerlink" href="#javascript-data-module" title="Permalink to this headline">¶</a></h4>
<p>Data_module is a reusable angularJS module used to access buildbot’s data api from the browser.
Its main purpose is to handle the 3 way binding.</p>
<p>2 way binding is the angular MVVM concept, which seamlessly synchronise the view and the model.
Here we introduce an additional way of synchronisation, which is from the server to the model.</p>
<div><svg height="120" viewBox="0 0 640 120" width="640" xmlns="http://www.w3.org/2000/svg" xmlns:inkspace="http://www.inkscape.org/namespaces/inkscape" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs id="defs_block">
    <filter height="1.504" id="filter_blur" inkspace:collect="always" width="1.1575" x="-0.07875" y="-0.252">
      <feGaussianBlur id="feGaussianBlur3780" inkspace:collect="always" stdDeviation="4.2" />
    </filter>
  </defs>
  <title>blockdiag</title>
  <desc />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="46" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="46" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="451" y="46" />
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="24" x="128" y="66">View</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="30" x="320" y="66">Model</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="448" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="36" x="512" y="66">Server</text>
  <path d="M 200 60 L 256 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="193,60 200,56 200,64 193,60" stroke="rgb(0,0,0)" />
  <path d="M 392 60 L 448 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="385,60 392,56 392,64 385,60" stroke="rgb(0,0,0)" />
</svg>
</div>
<p>We use the message queue and the websocket interfaces to maintain synchronisation between the server and the client.</p>
<p>The client application just needs to query needed data using a highlevel API, and the data module is using the best approach to make the data always up to date.</p>
<p>Once the binding is setup by the controller, everything is automatically up-to-date.</p>
<div class="section" id="base-concepts">
<h5>3.2.11.1. Base Concepts<a class="headerlink" href="#base-concepts" title="Permalink to this headline">¶</a></h5>
<div class="section" id="collections">
<h6>Collections<a class="headerlink" href="#collections" title="Permalink to this headline">¶</a></h6>
<p>All the data you can get are Collections.
Even a query to a single resource returns a collection.
A collection is an Array subclass which has extra capabilities:</p>
<ul class="simple">
<li>It listen to the event stream and is able to maintain itself up-to-date</li>
<li>It implements client side query in order to guarantee up-to-date filtering, ordering and limiting queries.</li>
<li>It has a fast access to each item it contains via its id.</li>
<li>It has its own event handlers so that client code can react when the Collection is changing</li>
</ul>
</div>
<div class="section" id="wrappers">
<h6>Wrappers<a class="headerlink" href="#wrappers" title="Permalink to this headline">¶</a></h6>
<p>Each data type contain in a collection is wrapped in a javascript object.
This allows to create some custom enhancements to the data model.
For example the Change wrapper decodes the author name and email from the “author” field.</p>
<p>Each wrapper class also has specific access method, which allow to access more data from the REST hierarchy.</p>
<div><svg height="200" viewBox="0 0 832 200" width="832" xmlns="http://www.w3.org/2000/svg" xmlns:inkspace="http://www.inkscape.org/namespaces/inkscape" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs id="defs_block">
    <filter height="1.504" id="filter_blur" inkspace:collect="always" width="1.1575" x="-0.07875" y="-0.252">
      <feGaussianBlur id="feGaussianBlur3780" inkspace:collect="always" stdDeviation="4.2" />
    </filter>
  </defs>
  <title>blockdiag</title>
  <desc />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="46" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="259" y="46" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="451" y="46" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="451" y="126" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="643" y="46" />
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="84" x="128" y="66">data.getBuilds</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="256" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="60" x="320" y="66">Collection</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="448" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="36" x="512" y="66">Builds</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="448" y="120" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="30" x="512" y="146">Steps</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="640" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="11" font-style="normal" font-weight="normal" text-anchor="middle" textLength="60" x="704" y="66">b.getSteps</text>
  <path d="M 192 60 L 248 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="255,60 248,56 248,64 255,60" stroke="rgb(0,0,0)" />
  <path d="M 384 60 L 440 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="447,60 440,56 440,64 447,60" stroke="rgb(0,0,0)" />
  <path d="M 384 60 L 416 60" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 416 60 L 416 140" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 416 140 L 440 140" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="447,140 440,136 440,144 447,140" stroke="rgb(0,0,0)" />
  <path d="M 576 60 L 632 60" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="639,60 632,56 632,64 639,60" stroke="rgb(0,0,0)" />
  <path d="M 768 60 L 784 60" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 784 60 L 784 25" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 25 L 784 25" fill="none" stroke="rgb(0,0,0)" />
  <path d="M 320 25 L 320 32" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="320,39 316,32 324,32 320,39" stroke="rgb(0,0,0)" />
</svg>
</div>
</div>
<div class="section" id="installation">
<h6>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h6>
<p>The Data module is available as a standalone AngularJS module.
Installation via bower:</p>
<blockquote>
<div><div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>bower install buildbot-data --save
</pre></div>
</div>
</div></blockquote>
<p>It is recommended however for coherency to use the installation method via guanlecoja, in the bower section of guanlecoja/config.coffee:</p>
<blockquote>
<div><div class="highlight-coffee notranslate"><div class="highlight"><pre><span></span><span class="s">&#39;bower&#39;</span><span class="o">:</span>
    <span class="s">&#39;deps&#39;</span><span class="o">:</span>
        <span class="s">&#39;buildbot-data&#39;</span><span class="o">:</span>
            <span class="nv">version: </span><span class="s">&#39;~1.0.14&#39;</span>
            <span class="nv">files: </span><span class="s">&#39;dist/buildbot-data.js&#39;</span>
</pre></div>
</div>
</div></blockquote>
<p>Inject the <code class="docutils literal notranslate"><span class="pre">bbData</span></code> module to your application:</p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;myApp&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;bbData&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="service-api">
<h6>Service API<a class="headerlink" href="#service-api" title="Permalink to this headline">¶</a></h6>
<div class="section" id="dataservice">
<h7>DataService<a class="headerlink" href="#dataservice" title="Permalink to this headline">¶</a></h7>
<p>DataService is the service used for accessing the Buildbot data API.
It has a modern interface for accessing data in such a way that the updating of the data via web socket is transparent.</p>
<p>Methods:</p>
<p><code class="docutils literal notranslate"><span class="pre">.open()</span></code>: returns a DataAccessor, which handles 3 way data binding</p>
<blockquote>
<div><ul class="simple">
<li>open a new accessor every time you need updating data in a controller</li>
<li>it registers on $destroy event on the scope, and thus automatically unsubscribes from updates when the data is not used anymore.</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># open a new accessor every time you need updating data in a controller</span>
<span class="k">class</span> <span class="nx">DemoController</span> <span class="k">extends</span> <span class="nx">Controller</span>
    <span class="nv">constructor: </span><span class="nf">($scope, dataService) -&gt;</span>
        <span class="c1"># automatically closes all the bindings when the $scope is destroyed</span>
        <span class="nv">data = </span><span class="nx">dataService</span><span class="p">.</span><span class="nx">open</span><span class="p">().</span><span class="nx">closeOnDestroy</span><span class="p">(</span><span class="nx">$scope</span><span class="p">)</span>

        <span class="c1"># request new data, it updates automatically</span>
        <span class="vi">@builders = </span><span class="nx">data</span><span class="p">.</span><span class="nx">getBuilders</span><span class="p">(</span><span class="nv">limit: </span><span class="mi">10</span><span class="p">,</span> <span class="nv">order: </span><span class="s">&#39;-started_at&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.getXs([id],</span> <span class="pre">[query])</span></code>: returns Collection which will eventually contain all the requested data</p>
<blockquote>
<div><ul class="simple">
<li>it’s highly advised to use these instead of the lower level <code class="docutils literal notranslate"><span class="pre">.get('string')</span></code> function</li>
<li><code class="docutils literal notranslate"><span class="pre">Xs</span></code> can be the following: <code class="docutils literal notranslate"><span class="pre">Builds</span></code>, <code class="docutils literal notranslate"><span class="pre">Builders</span></code>, <code class="docutils literal notranslate"><span class="pre">Buildrequests</span></code>, <code class="docutils literal notranslate"><span class="pre">Buildsets</span></code>, <code class="docutils literal notranslate"><span class="pre">Workers</span></code>, <code class="docutils literal notranslate"><span class="pre">Changes</span></code>, <code class="docutils literal notranslate"><span class="pre">Changesources</span></code>, <code class="docutils literal notranslate"><span class="pre">Forceschedulers</span></code>, <code class="docutils literal notranslate"><span class="pre">Masters</span></code>, <code class="docutils literal notranslate"><span class="pre">Schedulers</span></code>, <code class="docutils literal notranslate"><span class="pre">Sourcestamps</span></code></li>
<li>The collections returns without using an accessor are not automatically updated.
So use those methods only when you know the data are not changing</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># assign builds to $scope.builds and then load the steps when the builds are discovered</span>
<span class="c1"># onNew is called at initial load</span>
<span class="nv">$scope.builds = </span><span class="nx">dataService</span><span class="p">.</span><span class="nx">getBuilds</span><span class="p">(</span><span class="nv">builderid: </span><span class="mi">1</span><span class="p">)</span>
<span class="nv">$scope.builds.onNew = </span><span class="nf">(build) -&gt;</span>
    <span class="nx">build</span><span class="p">.</span><span class="nx">loadSteps</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.get(endpoint,</span> <span class="pre">[id],</span> <span class="pre">[query])</span></code>: returns a &lt;Collection&gt;, when the promise is resolved, the Collection contains all the requested data</p>
<blockquote>
<div><div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># assign builds to $scope.builds once the Collection is filled</span>
<span class="nv">builderid = </span><span class="mi">1</span>
<span class="nv">$scope.builds = </span><span class="nx">dataService</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;builders/</span><span class="si">#{</span><span class="nx">builderid</span><span class="si">}</span><span class="s">/builds&quot;</span><span class="p">,</span> <span class="nv">limit: </span><span class="mi">1</span><span class="p">)</span>
<span class="nv">$scope.builds.onNew = </span><span class="nf">(build) -&gt;</span>
    <span class="nx">build</span><span class="p">.</span><span class="nx">loadSteps</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># assign builds to $scope.builds before the Collection is filled using the .getArray() function</span>
<span class="nv">$scope.builds = </span><span class="nx">dataService</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&#39;builds&#39;</span><span class="p">,</span> <span class="nv">builderid: </span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.control(url,</span> <span class="pre">method,</span> <span class="pre">[params])</span></code>: returns a promise, sends a JSON RPC2 POST request to the server</p>
<blockquote>
<div><div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># open a new accessor every time you need updating data in a controller</span>
<span class="nx">dataService</span><span class="p">.</span><span class="nx">control</span><span class="p">(</span><span class="s">&#39;forceschedulers/force&#39;</span><span class="p">,</span> <span class="s">&#39;force&#39;</span><span class="p">).</span><span class="nx">then</span> <span class="nf">(response) -&gt;</span>
    <span class="nx">$log</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span>
<span class="p">,</span> <span class="nf">(reason) -&gt;</span>
    <span class="nx">$log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="dataaccessor">
<h7>DataAccessor<a class="headerlink" href="#dataaccessor" title="Permalink to this headline">¶</a></h7>
<p>DataAccessor object is returned by the dataService.open() method.</p>
<p>Methods:</p>
<p><code class="docutils literal notranslate"><span class="pre">.closeOnDestroy($scope)</span></code>: registers scope destruction as waterfall destruction for all collection accessed via this accessor.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">.close()</span></code>: Destruct all collections previously accessed via this accessor.</dt>
<dd>Destroying a collection means it will unsubscribe to any events necessary to maintain it up-to-date.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.getXs([id],</span> <span class="pre">[query])</span></code>: returns Collection which will eventually contain all the requested data</dt>
<dd>Same methods as in the dataService, except here the data will be maintained up-to-date.</dd>
</dl>
</div>
<div class="section" id="id1">
<h7>Collections<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h7>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">.get(id)</span></code>: returns one element of the collection by id, or undefined, if this id is unknown to the collection.</dt>
<dd>This method does not do any network access, and thus only know about data already fetched.</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">.hasOwnProperty(id)</span></code>: returns true if this id is known by this collection.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">.close()</span></code>: forcefully unsubscribe this connection from auto-update.</dt>
<dd>Normally, this is done automatically on scope destruction, but sometimes, when you got enough data, you want to save bandwidth and disconnect the collection.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.put(object)</span></code>: insert one plain object to the collection.</dt>
<dd>As an external API, this method is only useful for the unit tests to simulate new data coming asynchronously.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.from(object_list)</span></code>: insert several plain objects to the collection.</dt>
<dd>This method is only useful for the unit tests to simulate new data coming asynchronously.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.onNew</span> <span class="pre">=</span> <span class="pre">(object)</span> <span class="pre">-&gt;</span></code>: Callback method which is called when a new object arrives in the collection.</dt>
<dd>This can be called either when initial data is coming via REST api, or when data is coming via the event stream.
The affected object is given in parameter.
<cite>this</cite> context is the collection.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.onUpdate</span> <span class="pre">=</span> <span class="pre">(object)</span> <span class="pre">-&gt;</span></code>: Callback method which is called when an object is modified.</dt>
<dd>This is called when data is coming via the event stream.
The affected object is given in parameter.
<cite>this</cite> context is the collection.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.onChange</span> <span class="pre">=</span> <span class="pre">(collection)</span> <span class="pre">-&gt;</span></code>: Callback method which is called when an object is modified.</dt>
<dd>This is called when data is coming via the event stream.
<cite>this</cite> context is the collection.
The full collection is given in parameter (in case you override <code class="docutils literal notranslate"><span class="pre">this</span></code> via fat arrow).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">.$ready</span></code>: attribute similar to what <code class="docutils literal notranslate"><span class="pre">ngResource</span></code> provides.</dt>
<dd>True after first server interaction is completed, false before that.
Knowing if the Collection has been resolved is useful in data-binding (for example to display a loading graphic).</dd>
</dl>
</div>
<div class="section" id="wrapper">
<h7>Wrapper<a class="headerlink" href="#wrapper" title="Permalink to this headline">¶</a></h7>
<p>Wrapper objects are objects stored in the collection.
Those objects have specific methods, depending on their types. methods:</p>
<p><code class="docutils literal notranslate"><span class="pre">.getXs([id],</span> <span class="pre">[query])</span></code>: returns a Collection, when the promise is resolved, the Collection contains all the requested data</p>
<blockquote>
<div><ul class="simple">
<li>same as <code class="docutils literal notranslate"><span class="pre">dataService.getXs</span></code>, but with relative endpoint</li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># assign builds to $scope.builds once the Collection is filled</span>
<span class="nv">$scope.builds = </span><span class="nx">dataService</span><span class="p">.</span><span class="nx">getBuilds</span><span class="p">(</span><span class="nv">builderid: </span><span class="mi">1</span><span class="p">)</span>
<span class="nv">$scope.builds.onNew = </span><span class="nf">(b) -&gt;</span>
    <span class="nv">b.complete_steps = </span><span class="nx">b</span><span class="p">.</span><span class="nx">getSteps</span><span class="p">(</span><span class="nx">complete</span><span class="o">:</span><span class="kc">true</span><span class="p">)</span>
    <span class="nv">b.running_steps = </span><span class="nx">b</span><span class="p">.</span><span class="nx">getSteps</span><span class="p">(</span><span class="nx">complete</span><span class="o">:</span><span class="kc">false</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.loadXs([id],</span> <span class="pre">[query])</span></code>: returns a Collection, the Collection contains all the requested data, which is also assigned to <code class="docutils literal notranslate"><span class="pre">o.Xs</span></code></p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">o.loadXs()</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">o.xs</span> <span class="pre">=</span> <span class="pre">o.getXs()</span></code></li>
</ul>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># get builder with id = 1</span>
<span class="nx">dataService</span><span class="p">.</span><span class="nx">getBuilders</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nv">onNew = </span><span class="nf">(builder) -&gt;</span>
    <span class="c1"># load all builds in builder.builds</span>
    <span class="nx">builder</span><span class="p">.</span><span class="nx">loadBuilds</span><span class="p">().</span><span class="nx">onNew</span> <span class="nf">(build) -&gt;</span>
        <span class="c1"># load all buildsteps in build.steps</span>
        <span class="nx">build</span><span class="p">.</span><span class="nx">loadSteps</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">.control(method,</span> <span class="pre">params)</span></code>: returns a promise, sends a JSON RPC2 POST request to the server</p>
</div>
</div>
</div>
</div>
<span id="document-developer/www-base-app"></span><div class="section" id="base-web-application">
<span id="www-base-app"></span><h4>3.2.12. Base web application<a class="headerlink" href="#base-web-application" title="Permalink to this headline">¶</a></h4>
<div class="section" id="javascript-application">
<h5>3.2.12.1. JavaScript Application<a class="headerlink" href="#javascript-application" title="Permalink to this headline">¶</a></h5>
<p>The client side of the web UI is written in JavaScript and based on the AngularJS framework and concepts.</p>
<p>This is a <a class="reference external" href="http://en.wikipedia.org/wiki/Single-page_application">Single Page Application</a>.
All Buildbot pages are loaded from the same path, at the master’s base URL.
The actual content of the page is dictated by the fragment in the URL (the portion following the <code class="docutils literal notranslate"><span class="pre">#</span></code> character).
Using the fragment is a common JS technique to avoid reloading the whole page over HTTP when the user changes the URI or clicks a link.</p>
<div class="section" id="angularjs">
<h6>AngularJS<a class="headerlink" href="#angularjs" title="Permalink to this headline">¶</a></h6>
<p>The best place to learn about AngularJS is <a class="reference external" href="http://docs.angularjs.org/guide/">its own documentation</a>.</p>
<p>AngularJS strong points are:</p>
<ul class="simple">
<li>A very powerful <a class="reference external" href="https://docs.angularjs.org/guide/concepts">MVC system</a> allowing automatic update of the UI, when data changes</li>
<li>A <a class="reference external" href="https://docs.angularjs.org/guide/dev_guide.e2e-testing">Testing Framework and philosophy</a></li>
<li>A <a class="reference external" href="https://docs.angularjs.org/api/ng.$q">deferred system</a> similar to the one from Twisted</li>
<li>A <a class="reference external" href="https://www.madewithangular.com/">fast growing community and ecosystem</a></li>
</ul>
<p>On top of Angular we use nodeJS tools to ease development</p>
<ul class="simple">
<li>gulp build system, seamlessly build the app, can watch files for modification, rebuild and reload browser in dev mode.
In production mode, the build system minifies html, css and js, so that the final app is only 3 files to download (+img)</li>
<li>Alternatively webpack build system can be used for the same purposes as gulp (in UI extensions)</li>
<li><a class="reference external" href="http://coffeescript.org/">coffeescript</a>, a very expressive language, preventing some of the major traps of JS</li>
<li><a class="reference external" href="https://pugjs.org/">pug template language  (aka jade)</a>, adds syntax sugar and readability to angular html templates</li>
<li><a class="reference external" href="https://getbootstrap.com/">Bootstrap</a> is a CSS library providing know good basis for our styles</li>
<li><a class="reference external" href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a> is a coherent and large icon library</li>
</ul>
<p>Modules we may or may not want to include:</p>
<ul class="simple">
<li><a class="reference external" href="http://momentjs.com/">momentjs</a> is a library implementing human readable relative timings (e.g. “one hour ago”)</li>
<li><a class="reference external" href="http://ui-grid.info/">Angular UI Grid</a> is a grid system for full featured searchable/sortable/csv exportable grids</li>
<li><a class="reference external" href="http://angular-ui.github.com/">angular-UI</a> is a collection of jquery based directives and filters. Probably not very useful for us</li>
<li><a class="reference external" href="http://jquery.com/">JQuery</a> the well known JS framework, allows all sort of dom manipulation.
Having it inside allows for all kind of hacks we may want to avoid</li>
</ul>
</div>
<div class="section" id="extensibility">
<h6>Extensibility<a class="headerlink" href="#extensibility" title="Permalink to this headline">¶</a></h6>
<p>Buildbot UI is designed for extensibility.
The base application should be pretty minimal, and only include very basic status pages.
Base application cannot be disabled so any page not absolutely necessary should be put in plugins.
You can also completely replace the default application by another application more suitable to your needs.</p>
<p>Some Web plugins are maintained inside buildbot’s git repository, but this is absolutely not necessary.
Unofficial plugins are encouraged, please be creative!</p>
<p>Please look at official plugins for working samples.</p>
<p>Typical plugin source code layout is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>setup.py                     <span class="c1"># standard setup script. Most plugins should use the same boilerplate, which helps building guanlecoja app as part of the setup. Minimal adaptation is needed</span>
&lt;pluginname&gt;/__init__.py     <span class="c1"># python entrypoint. Must contain an &quot;ep&quot; variable of type buildbot.www.plugin.Application. Minimal adaptation is needed</span>
guanlecoja/config.coffee     <span class="c1"># Configuration for guanlecoja. Few changes are needed here. Please see guanlecoja docs for details.</span>
src/..                       <span class="c1"># source code for the angularjs application. See guanlecoja doc for more info of how it is working.</span>
package.json                 <span class="c1"># declares npm dependency. normallly, only guanlecoja is needed. Typically, no change needed</span>
gulpfile.js                  <span class="c1"># entrypoint for gulp, should be a one line call to guanlecoja. Typically, no change needed</span>
MANIFEST.in                  <span class="c1"># needed by setup.py for sdist generation. You need to adapt this file to match the name of your plugin</span>
</pre></div>
</div>
<p>Alternatively it is possible to use webpack instead of gulp so <code class="docutils literal notranslate"><span class="pre">gulpfile.js</span></code> shall be replaced with <code class="docutils literal notranslate"><span class="pre">webpack.config.js</span></code> (with proper code inside of course).
When <code class="docutils literal notranslate"><span class="pre">gulpfile.js</span></code> found, gulp is used even <code class="docutils literal notranslate"><span class="pre">webpack.config.js</span></code> is defined.</p>
<p>Plugins are packaged as python entry-points for the <code class="docutils literal notranslate"><span class="pre">buildbot.www</span></code> namespace.
The python part is defined in the <code class="docutils literal notranslate"><span class="pre">buildbot.www.plugin</span></code> module.
The entrypoint must contain a <code class="docutils literal notranslate"><span class="pre">twisted.web</span></code> Resource, that is populated in the web server in <code class="docutils literal notranslate"><span class="pre">/&lt;pluginname&gt;/</span></code>.</p>
<p>The front-end part of the plugin system automatically loads <code class="docutils literal notranslate"><span class="pre">/&lt;pluginname&gt;/scripts.js</span></code> and <code class="docutils literal notranslate"><span class="pre">/&lt;pluginname&gt;/styles.css</span></code> into the angular.js application.
The scripts.js files can register itself as a dependency to the main “app” module, register some new states to <code class="docutils literal notranslate"><span class="pre">$stateProvider</span></code>, or new menu items via glMenuProvider.</p>
<p>The entrypoint containing a Resource, nothing forbids plugin writers to add more REST apis in <code class="docutils literal notranslate"><span class="pre">/&lt;pluginname&gt;/api</span></code>.
For that, a reference to the master singleton is provided in <code class="docutils literal notranslate"><span class="pre">master</span></code> attribute of the Application entrypoint.
You are even not restricted to twisted, and could even <a class="reference external" href="http://twistedmatrix.com/documents/13.1.0/web/howto/web-in-60/wsgi.html">load a wsgi application using flask, django, etc</a>.</p>
<p>It is also possible to make a web plugin which only adds http endpoint, and has no javascript UI.
For that the <code class="docutils literal notranslate"><span class="pre">Application</span></code> endpoint object should have <code class="docutils literal notranslate"><span class="pre">ui=False</span></code> argument.
You can look at the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/www/badges">www/badges</a> plugin for an example of a ui-less plugin.</p>
</div>
<div class="section" id="routing">
<span id="id1"></span><h6>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h6>
<p>AngularJS uses router to match URL and choose which page to display.
The router we use is <code class="docutils literal notranslate"><span class="pre">ui.router</span></code>.
Menu is managed by guanlecoja-ui’s glMenuProvider.
Please look at <code class="docutils literal notranslate"><span class="pre">ui.router</span></code>, and guanlecoja-ui documentation for details.</p>
<p>Typically, a route registration will look like following example.</p>
<div class="highlight-coffeescript notranslate"><div class="highlight"><pre><span></span><span class="c1"># ng-classify declaration. Declares a config class</span>
<span class="k">class</span> <span class="nx">State</span> <span class="k">extends</span> <span class="nx">Config</span>
    <span class="c1"># Dependency injection: we inject $stateProvider and glMenuServiceProvider</span>
    <span class="nv">constructor: </span><span class="nf">($stateProvider, glMenuServiceProvider) -&gt;</span>

        <span class="c1"># Name of the state</span>
        <span class="nv">name = </span><span class="s">&#39;console&#39;</span>

        <span class="c1"># Menu configuration.</span>
        <span class="nx">glMenuServiceProvider</span><span class="p">.</span><span class="nx">addGroup</span>
            <span class="nv">name: </span><span class="nx">name</span>
            <span class="nv">caption: </span><span class="s">&#39;Console View&#39;</span>     <span class="c1"># text of the menu</span>
            <span class="nv">icon: </span><span class="s">&#39;exclamation-circle&#39;</span>  <span class="c1"># icon, from Font-Awesome</span>
            <span class="nv">order: </span><span class="mi">5</span>                    <span class="c1"># order in the menu, as menu are declared in several places, we need this to control menu order</span>

        <span class="c1"># Configuration for the menu-item, here we only have one menu item per menu, glMenuProvider won&#39;t create submenus</span>
        <span class="nv">cfg =</span>
            <span class="nv">group: </span><span class="nx">name</span>
            <span class="nv">caption: </span><span class="s">&#39;Console View&#39;</span>

        <span class="c1"># Register new state</span>
        <span class="nv">state =</span>
            <span class="nv">controller: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">Controller&quot;</span>
            <span class="nv">controllerAs: </span><span class="s">&quot;c&quot;</span>
            <span class="nv">templateUrl: </span><span class="s">&quot;console_view/views/</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">.html&quot;</span>
            <span class="nv">name: </span><span class="nx">name</span>
            <span class="nv">url: </span><span class="s">&quot;/</span><span class="si">#{</span><span class="nx">name</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="nv">data: </span><span class="nx">cfg</span>

        <span class="nx">$stateProvider</span><span class="p">.</span><span class="nx">state</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="directives">
<h6>Directives<a class="headerlink" href="#directives" title="Permalink to this headline">¶</a></h6>
<p>We use angular directives as much as possible to implement reusable UI components.</p>
</div>
<div class="section" id="linking-with-buildbot">
<h6>Linking with Buildbot<a class="headerlink" href="#linking-with-buildbot" title="Permalink to this headline">¶</a></h6>
<p>A running buildmaster needs to be able to find the JavaScript source code it needs to serve the UI.
This needs to work in a variety of contexts - Python development, JavaScript development, and end-user installations.
To accomplish this, the gulp build process finishes by bundling all of the static data into a Python distribution tarball, along with a little bit of Python glue.
The Python glue implements the interface described below, with some care taken to handle multiple contexts.</p>
</div>
</div>
<div class="section" id="hacking-quick-start">
<h5>3.2.12.2. Hacking Quick-Start<a class="headerlink" href="#hacking-quick-start" title="Permalink to this headline">¶</a></h5>
<p>This section describes how to get set up quickly to hack on the JavaScript UI.
It does not assume familiarity with Python, although a Python installation is required, as well as <code class="docutils literal notranslate"><span class="pre">virtualenv</span></code>.
You will also need <code class="docutils literal notranslate"><span class="pre">NodeJS</span></code>, and <code class="docutils literal notranslate"><span class="pre">npm</span></code> installed.</p>
<div class="section" id="prerequisites">
<h6>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h6>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Buildbot UI is only tested to build on node 4.x.x.</p>
</div>
<ul>
<li><p class="first">Install LTS release of node.js.</p>
<p><a class="reference external" href="http://nodejs.org/">http://nodejs.org/</a> is a good start for windows and osx</p>
<p>For Linux, as node.js is evolving very fast, distros versions are often too old, and sometimes distro maintainers make incompatible changes (i.e naming node binary nodejs instead of node)
For Ubuntu and other Debian based distros, you want to use following method:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>curl -sL https://deb.nodesource.com/setup_4.x | sudo bash -
</pre></div>
</div>
<p>Please feel free to update this documentation for other distros.
Know good source for Linux binary distribution is: <a class="reference external" href="https://github.com/nodesource/distributions">https://github.com/nodesource/distributions</a></p>
</li>
<li><p class="first">Install gulp globally. Gulp is the build system used for coffeescript development.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo npm install -g gulp
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="hacking-the-buildbot-javascript">
<h6>Hacking the Buildbot JavaScript<a class="headerlink" href="#hacking-the-buildbot-javascript" title="Permalink to this headline">¶</a></h6>
<p>To effectively hack on the Buildbot JavaScript, you’ll need a running Buildmaster, configured to operate out of the source directory (unless you like editing minified JS).
Start by cloning the project and its git submodules:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git clone git://github.com/buildbot/buildbot.git
</pre></div>
</div>
<p>In the root of the source tree, create and activate a virtualenv to install everything in:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>virtualenv sandbox
source sandbox/bin/activate
</pre></div>
</div>
<p>This creates an isolated Python environment in which you can install packages without affecting other parts of the system.
You should see <code class="docutils literal notranslate"><span class="pre">(sandbox)</span></code> in your shell prompt, indicating the sandbox is activated.</p>
<p>Next, install the Buildbot-WWW and Buildbot packages using <code class="docutils literal notranslate"><span class="pre">--editable</span></code>, which means that they should execute from the source directory.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install --editable pkg
pip install --editable master/
make frontend
</pre></div>
</div>
<p>This will fetch a number of dependencies from pypi, the Python package repository.
This will also fetch a bunch a bunch of node.js dependencies used for building the web application, and a bunch of client side js dependencies, with bower</p>
<p>Now you’ll need to create a master instance.
For a bit more detail, see the Buildbot tutorial (<a class="reference internal" href="#first-run-label"><span class="std std-ref">First Run</span></a>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>buildbot create-master sandbox/testmaster
mv sandbox/testmaster/master.cfg.sample sandbox/testmaster/master.cfg
buildbot start sandbox/testmaster
</pre></div>
</div>
<p>If all goes well, the master will start up and begin running in the background.
As you just installed www in editable mode (aka ‘develop’ mode), setup.py did build the web site in prod mode, so the everything is minified, making it hard to debug.</p>
<p>When doing web development, you usually run:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd www/base
gulp dev
</pre></div>
</div>
<p>This will compile the base webapp in development mode, and automatically rebuild when files change.</p>
</div>
<div class="section" id="testing-with-real-data">
<h6>Testing with real data<a class="headerlink" href="#testing-with-real-data" title="Permalink to this headline">¶</a></h6>
<p>Front-end only hackers might want to just skip the master and worker setup, and just focus on the UI.
It can also be very useful to just try the UI with real data from your production.
For those use-cases, <code class="docutils literal notranslate"><span class="pre">gulp</span> <span class="pre">dev</span> <span class="pre">proxy</span></code> can be used.</p>
<p>This tool is a small nodejs app integrated in the gulp build that can proxy the data and websocket api from a production server to your development environment.
Having a proxy is slightly slower, but this can be very useful for testing with real complex data.</p>
<p>You still need to have python virtualenv configured with master package installed, like we described in previous paragraph.</p>
<p>Provided you run it in a buildbot master virtualenv, the following command will start the UI and redirect the api calls to the nine demo server:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gulp dev proxy --host nine.buildbot.net
</pre></div>
</div>
<p>You can then just point your browser to localhost:8080, and you will access <a class="reference external" href="http://nine.buildbot.net">http://nine.buildbot.net</a>, with your own version of the UI.</p>
<p>If your buildbot instance is served over HTTPS, use the <code class="docutils literal notranslate"><span class="pre">--secure</span></code> argument to access the host via <code class="docutils literal notranslate"><span class="pre">https://</span></code> and <code class="docutils literal notranslate"><span class="pre">wss://</span></code>, respectively. The argument <code class="docutils literal notranslate"><span class="pre">--ignoresslerrors</span></code> may be helpful if the server uses a self-signed certificate. Note that the <code class="docutils literal notranslate"><span class="pre">--host</span></code> parameter can specify port and URL path, in case buildbot is served on a non-standard port or not from the root path <code class="docutils literal notranslate"><span class="pre">/</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gulp dev proxy --host ssl-protected.ci.example.com --secure
gulp dev proxy --host self-signed-ssl.ci.example.com/buildbot --secure --ignoresslerrors
</pre></div>
</div>
</div>
</div>
<div class="section" id="guanlecoja">
<h5>3.2.12.3. Guanlecoja<a class="headerlink" href="#guanlecoja" title="Permalink to this headline">¶</a></h5>
<p>Buildbot’s build environment has been factorized for reuse in other projects and plugins, and is called Guanlecoja.</p>
<p>The documentation and meaning of this name is maintained in Guanlecoja’s own site. <a class="reference external" href="https://github.com/buildbot/guanlecoja/">https://github.com/buildbot/guanlecoja/</a></p>
</div>
<div class="section" id="testing-setup">
<h5>3.2.12.4. Testing Setup<a class="headerlink" href="#testing-setup" title="Permalink to this headline">¶</a></h5>
<p>buildbot_www uses <a class="reference external" href="http://karma-runner.github.io">Karma</a> to run the coffeescript test suite.
This is the official test framework made for angular.js.
We don’t run the front-end testsuite inside the python ‘trial’ test suite, because testing python and JS is technically very different.</p>
<p>Karma needs a browser to run the unit test in.
It supports all the major browsers.
Given our current experience, we did not see any bugs yet that would only happen on a particular browser this is the reason that at the moment, only headless browser “PhantomJS” is used for testing.</p>
<p>We enforce that the tests are run all the time after build.
This does not impact the build time by a great factor, and simplify the workflow.</p>
<p>In some case, this might not be desirable, for example if you run the build on headless system, without X.
PhantomJS, even if it is headless needs a X server like xvfb.
In the case where you are having difficulties to run Phantomjs, you can build without the tests using the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>gulp prod --notests
</pre></div>
</div>
<div class="section" id="debug-with-karma">
<h6>Debug with karma<a class="headerlink" href="#debug-with-karma" title="Permalink to this headline">¶</a></h6>
<p><code class="docutils literal notranslate"><span class="pre">console.log</span></code> is available via karma.
In order to debug the unit tests, you can also use the global variable <code class="docutils literal notranslate"><span class="pre">dump</span></code>, which dumps any object for inspection in the console.
This can be handy to be sure that you don’t let debug logs in your code to always use <code class="docutils literal notranslate"><span class="pre">dump</span></code></p>
</div>
</div>
</div>
<span id="document-developer/auth"></span><div class="section" id="authentication">
<h4>3.2.13. Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h4>
<p>Buildbot’s HTTP authentication subsystem supports a rich set of information about users:</p>
<ul>
<li><p class="first">User credentials: Username and proof of ownership of that username.</p>
</li>
<li><p class="first">User information: Additional information about the user, including</p>
<blockquote>
<div><ul class="simple">
<li>email address</li>
<li>full name</li>
<li>group membership</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Avatar information: a small image to represent the user.</p>
</li>
</ul>
<p>Buildbot’s authentication subsystem is designed to support several authentication modes:</p>
<ul>
<li><dl class="first docutils">
<dt>Simple username/password authentication.</dt>
<dd><p class="first last">The Buildbot UI prompts for a username and password and the backend verifies them.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>External authentication by an HTTP Proxy.</dt>
<dd><p class="first last">An HTTP proxy in front of Buildbot performs the authentication and passes the verified username to Buildbot in an HTTP Header.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Authentication by a third-party website.</dt>
<dd><p class="first last">Buildbot sends the user to another site such as GitHub to authenticate and receives a trustworthy assertion of the user’s identity from that site.</p>
</dd>
</dl>
</li>
</ul>
<div class="section" id="implementation">
<h5>3.2.13.1. Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h5>
<p>Authentication is implemented by an instance of <a class="reference internal" href="#buildbot.www.auth.AuthBase" title="buildbot.www.auth.AuthBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuthBase</span></code></a>.
This instance is supplied directly by the user in the configuration file.
A reference to the instance is available at <code class="docutils literal notranslate"><span class="pre">self.master.www.auth</span></code>.</p>
</div>
<div class="section" id="username-password-authentication">
<h5>3.2.13.2. Username / Password Authentication<a class="headerlink" href="#username-password-authentication" title="Permalink to this headline">¶</a></h5>
<p>In this mode, the Buildbot UI displays a form allowing the user to specify a username and password.
When this form is submitted, the UI makes an AJAX call to <code class="docutils literal notranslate"><span class="pre">/auth/login</span></code> including HTTP Basic Authentication headers.
The master verifies the contents of the header and updates the server-side session to indicate a successful login or to contain a failure message.
Once the AJAX call is complete, the UI reloads the page, re-fetching <code class="docutils literal notranslate"><span class="pre">/config.js</span></code>, which will include the username or failure message from the session.</p>
<p>Subsequent access is authorized based on the information in the session; the authentication credentials are not sent again.</p>
</div>
<div class="section" id="external-authentication">
<h5>3.2.13.3. External Authentication<a class="headerlink" href="#external-authentication" title="Permalink to this headline">¶</a></h5>
<p>Buildbot’s web service can be run behind an HTTP proxy.
Many such proxies can be configured to perform authentication on HTTP connections before forwarding the request to Buildbot.
In these cases, the results of the authentication are passed to Buildbot in an HTTP header.</p>
<p>In this mode, authentication proceeds as follows:</p>
<ul class="simple">
<li>The web browser connects to the proxy, requesting the Buildbot home page</li>
<li>The proxy negotiates authentication with the browser, as configured</li>
<li>Once the user is authenticated, the proxy forwards the request goes to the Buildbot web service.
The request includes a header, typically <code class="docutils literal notranslate"><span class="pre">Remote-User</span></code>, containing the authenticated username.</li>
<li>Buildbot reads the header and optionally connects to another service to fetch additional user information about the user.</li>
<li>Buildbot stores all of the collected information in the server-side session.</li>
<li>The UI fetches <code class="docutils literal notranslate"><span class="pre">/config.js</span></code>, which includes the user information from the server-side session.</li>
</ul>
<p>Note that in this mode, the HTTP proxy will send the header with every request, although it is only interpreted during the fetch of <code class="docutils literal notranslate"><span class="pre">/config.js</span></code>.</p>
<div class="section" id="kerberos-example">
<h6>Kerberos Example<a class="headerlink" href="#kerberos-example" title="Permalink to this headline">¶</a></h6>
<p>Kerberos is an authentication system which allows passwordless authentication on corporate networks.
Users authenticate once on their desktop environment, and the OS, browser, webserver, and corporate directory cooperate in a secure manner to share the authentication to a webserver.
This mechanism only takes care about the authentication problem, and no user information is shared other than the username.
The kerberos authentication is supported by a Apache front-end in <code class="docutils literal notranslate"><span class="pre">mod_kerberos</span></code>.</p>
</div>
</div>
<div class="section" id="third-party-authentication">
<h5>3.2.13.4. Third-Party Authentication<a class="headerlink" href="#third-party-authentication" title="Permalink to this headline">¶</a></h5>
<p>Third-party authentication involves Buildbot redirecting a user’s browser to another site to establish the user’s identity.
Once that is complete, that site redirects the user back to Buildbot, including a cryptographically signed assertion about the user’s identity.</p>
<p>The most common implementation of this sort of authentication is oAuth2.
Many big internet service companies are providing oAuth2 services to identify their users.
Most oAuth2 services provide authentication and user information in the same api.</p>
<p>The following process is used for third-party authentication:</p>
<ul class="simple">
<li>The web browser connects to buildbot ui</li>
<li>A session cookie is created, but user is not yet authenticated.
The UI adds a widget entitled <code class="docutils literal notranslate"><span class="pre">Login</span> <span class="pre">via</span> <span class="pre">GitHub</span></code> (or whatever third party is configured)</li>
<li>When the user clicks on the widget, the UI fetches <code class="docutils literal notranslate"><span class="pre">/auth/login</span></code>, which returns a bare URL on <code class="docutils literal notranslate"><span class="pre">github.com</span></code>.
The UI loads that URL in the browser, with an effect similar to a redirect.</li>
<li>GitHub authenticates the user, if necessary, and requests permission for Buildbot to access the user’s information.</li>
<li>On success, the GitHub web page redirects back to Buildbot’s <code class="docutils literal notranslate"><span class="pre">/auth/login?code=..</span></code>, with an authentication code.</li>
<li>Buildbot uses this code to request more information from GitHub, and stores the results in the server-side session.
Finally, Buildbot returns a redirect response, sending the user’s browser to the root of the Buildbot UI.
The UI code will fetch <code class="docutils literal notranslate"><span class="pre">/config.js</span></code>, which contains the login data from the session.</li>
</ul>
</div>
<div class="section" id="logout">
<h5>3.2.13.5. Logout<a class="headerlink" href="#logout" title="Permalink to this headline">¶</a></h5>
<p>A “logout” button is available in the simple and third-party modes.
Such a button doesn’t make sense for external authentication, since the proxy will immediately re-authenticate the user.</p>
<p>This button fetches <code class="docutils literal notranslate"><span class="pre">/auth/logout</span></code>, which destroys the server-side session.
After this point, any stored authentication information is gone and the user is logged out.</p>
</div>
<div class="section" id="future-additions">
<h5>3.2.13.6. Future Additions<a class="headerlink" href="#future-additions" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Browserid/Persona: This method is very similar to oauth2, and should be implemented in a similar way (i.e. two stage redirect + token-verify)</li>
<li>Use the User table in db: This is a very similar to the UserPasswordAuth use cases (form + local db verification). Eventually, this method will require some work on the UI in order to populate the db, add a “register” button, verification email, etc. This has to be done in a ui plugin.</li>
</ul>
</div>
</div>
<span id="document-developer/authz"></span><div class="section" id="authorization">
<h4>3.2.14. Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h4>
<p>Buildbot authorization is designed to address the following requirements</p>
<blockquote>
<div><ul>
<li><p class="first">Most of the configuration is only data: We avoid to require user to write callbacks for most of the use cases. This to allow to load the config from yaml or json and eventually do a UI for authorization config.</p>
</li>
<li><p class="first">Separation of concerns:</p>
<blockquote>
<div><ul class="simple">
<li>Mapping users to roles</li>
<li>Mapping roles to REST endpoints.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Configuration should not need hardcoding endpoint paths.</p>
</li>
<li><p class="first">Easy to extend</p>
</li>
</ul>
</div></blockquote>
<div class="section" id="use-cases">
<h5>3.2.14.1. Use cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Members of admin group should have access to all resources and actions</li>
<li>developers can run the “try” builders</li>
<li>Integrators can run the “merge” builders</li>
<li>Release team can run the “release” builders</li>
<li>There are separate teams for different branches or projects, but the roles are identical</li>
<li>Owners of builds can stop builds or buildrequests</li>
<li>Secret branch’s builds are hidden from people except explicitly authorized</li>
</ul>
</div>
</div>
<span id="document-developer/master-worker"></span><div class="section" id="master-worker-api">
<h4>3.2.15. Master-Worker API<a class="headerlink" href="#master-worker-api" title="Permalink to this headline">¶</a></h4>
<p>This section describes the master-worker interface.
It covers communication protocol of “classic” remote Worker, notice that there is other types of workers which behave a bit different, such as <a class="reference internal" href="#local-workers"><span class="std std-ref">Local Worker</span></a> and <a class="reference internal" href="#latent-workers"><span class="std std-ref">Latent Workers</span></a>.</p>
<div class="section" id="connection">
<h5>3.2.15.1. Connection<a class="headerlink" href="#connection" title="Permalink to this headline">¶</a></h5>
<p>The interface is based on Twisted’s Perspective Broker, which operates over TCP
connections.</p>
<p>The worker connects to the master, using the parameters supplied to
<strong class="command">buildbot-worker create-worker</strong>.  It uses a reconnecting process with an
exponential backoff, and will automatically reconnect on disconnection.</p>
<p>Once connected, the worker authenticates with the Twisted Cred (newcred)
mechanism, using the username and password supplied to
<strong class="command">buildbot-worker create-worker</strong>.
The <em>mind</em> is the worker bot instance (class <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot_worker.pb.BotPb</span></code>).</p>
<p>On the master side, the realm is implemented by
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.pbmanager.Dispatcher</span></code>, which examines the username of incoming
avatar requests.  There are special cases for <code class="docutils literal notranslate"><span class="pre">change</span></code>, <code class="docutils literal notranslate"><span class="pre">debug</span></code>, and
<code class="docutils literal notranslate"><span class="pre">statusClient</span></code>, which are not discussed here.  For all other usernames,
the botmaster is consulted, and if a worker with that name is configured, its
<a class="reference internal" href="#buildbot.worker.Worker" title="buildbot.worker.Worker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.Worker</span></code></a> instance is returned as the perspective.</p>
</div>
<div class="section" id="workers">
<h5>3.2.15.2. Workers<a class="headerlink" href="#workers" title="Permalink to this headline">¶</a></h5>
<p>At this point, the master-side Worker object has a pointer to the remote,
worker-side Bot object in its <code class="docutils literal notranslate"><span class="pre">self.worker</span></code>, and the worker-side Bot object has
a reference to the master-side Worker object in its <code class="docutils literal notranslate"><span class="pre">self.perspective</span></code>.</p>
<div class="section" id="bot-methods">
<h6>Bot methods<a class="headerlink" href="#bot-methods" title="Permalink to this headline">¶</a></h6>
<p>The worker-side Bot object has the following remote methods:</p>
<dl class="docutils">
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_getCommands</span></code></dt>
<dd>Returns a dictionary for all commands the worker recognizes: the key of the dictionary is command name and command version is the value.</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_setBuilderList</span></code></dt>
<dd><p class="first">Given a list of builders and their build directories, ensures that
those builders, and only those builders, are running.  This can be
called after the initial connection is established, with a new
list, to add or remove builders.</p>
<p class="last">This method returns a dictionary of <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> objects - see below.</p>
</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_print</span></code></dt>
<dd>Adds a message to the worker logfile.</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_getWorkerInfo</span></code></dt>
<dd><p class="first">Returns dictionary with the contents of the worker’s <code class="file docutils literal notranslate"><span class="pre">info/</span></code> directory (i.e. file name is used as key and file contents as the value).
This dictionary also contains the keys</p>
<dl class="last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">environ</span></code></dt>
<dd>copy of the workers environment</dd>
<dt><code class="docutils literal notranslate"><span class="pre">system</span></code></dt>
<dd>OS the worker is running (extracted from Python’s <code class="docutils literal notranslate"><span class="pre">os.name</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">basedir</span></code></dt>
<dd>base directory where worker is running</dd>
<dt><code class="docutils literal notranslate"><span class="pre">numcpus</span></code></dt>
<dd>number of CPUs on the worker, either as configured or as detected (since <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> version 0.9.0)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">version</span></code></dt>
<dd>worker’s version (same as the result of <code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_getVersion</span></code> call)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">worker_commands</span></code></dt>
<dd>worker supported commands (same as the result of <code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_getCommands</span></code> call)</dd>
</dl>
</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_getVersion</span></code></dt>
<dd>Returns the worker’s version.</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_shutdown</span></code></dt>
<dd>Shuts down the worker cleanly.</dd>
</dl>
</div>
<div class="section" id="worker-methods">
<h6>Worker methods<a class="headerlink" href="#worker-methods" title="Permalink to this headline">¶</a></h6>
<p>The master-side object has the following method:</p>
<dl class="docutils">
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">perspective_keepalive</span></code></dt>
<dd>Does nothing - used to keep traffic flowing over the TCP connection</dd>
</dl>
</div>
</div>
<div class="section" id="setup">
<h5>3.2.15.3. Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h5>
<p>After the initial connection and trading of a mind (<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot_worker.pb.BotPb</span></code>) for an avatar
(Worker), the master calls the Bot’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">setBuilderList</span></code> method to set
up the proper builders on the worker side.  This method returns a
reference to each of the new worker-side <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilderPb</span></code>
objects, described below.  Each of these is handed to the corresponding
master-side <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> object.</p>
<p>This immediately calls the remote <code class="xref py py-meth docutils literal notranslate"><span class="pre">setMaster</span></code> method, then the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">print</span></code> method.</p>
</div>
<div class="section" id="pinging">
<h5>3.2.15.4. Pinging<a class="headerlink" href="#pinging" title="Permalink to this headline">¶</a></h5>
<p>To ping a remote Worker, the master calls its <code class="xref py py-meth docutils literal notranslate"><span class="pre">print</span></code> method.</p>
</div>
<div class="section" id="building">
<h5>3.2.15.5. Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h5>
<p>When a build starts, the master calls the worker’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">startBuild</span></code> method.
Each BuildStep instance will subsequently call the <code class="xref py py-meth docutils literal notranslate"><span class="pre">startCommand</span></code> method,
passing a reference to itself as the <code class="docutils literal notranslate"><span class="pre">stepRef</span></code> parameter.  The
<code class="xref py py-meth docutils literal notranslate"><span class="pre">startCommand</span></code> method returns immediately, and the end of the command is
signalled with a call to a method on the master-side BuildStep object.</p>
</div>
<div class="section" id="worker-for-builders">
<span id="id1"></span><h5>3.2.15.6. Worker For Builders<a class="headerlink" href="#worker-for-builders" title="Permalink to this headline">¶</a></h5>
<p>Each worker has a set of builders which can run on it.  These are
represented by distinct classes on the master and worker, just like the
Worker and Bot objects described above.</p>
<p>On the worker side, builders are represented as instances of the
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot_worker.pb.WorkerForBuilderPb</span></code> class.  On the master side, they are
represented by the <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.workerforbuilder.WorkerForBuilder</span></code> class.
The identical names are a source of confusion.  The following will refer to
these as the worker-side and master-side Worker For Builder classes.  Each object
keeps a reference to its opposite in <code class="docutils literal notranslate"><span class="pre">self.remote</span></code>.</p>
<div class="section" id="worker-side-workerforbuilderpb-methods">
<h6>Worker-Side <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilderPb</span></code> Methods<a class="headerlink" href="#worker-side-workerforbuilderpb-methods" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_setMaster</span></code></dt>
<dd>Provides a reference to the master-side Worker For Builder</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_print</span></code></dt>
<dd>Adds a message to the worker logfile; used to check round-trip connectivity</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_startBuild</span></code></dt>
<dd>Indicates that a build is about to start, and that any subsequent
commands are part of that build</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_startCommand</span></code></dt>
<dd>Invokes a command on the worker side</dd>
<dt><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_interruptCommand</span></code></dt>
<dd>Interrupts the currently-running command</dd>
</dl>
</div>
<div class="section" id="master-side-workerforbuilder-methods">
<h6>Master-side <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> Methods<a class="headerlink" href="#master-side-workerforbuilder-methods" title="Permalink to this headline">¶</a></h6>
<p>The master side does not have any remotely-callable methods.</p>
</div>
</div>
<div class="section" id="commands">
<h5>3.2.15.7. Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h5>
<p>Actual work done by the worker is represented on the master side by a
<a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.remotecommand.RemoteCommand</span></code></a> instance.</p>
<p>The command instance keeps a reference to the worker-side
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot_worker.pb.WorkerForBuilderPb</span></code>, and calls methods like
<code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_startCommand</span></code> to start new commands.
Once that method is called, the <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilderPb</span></code> instance
keeps a reference to the command, and calls the following methods on it:</p>
<div class="section" id="master-side-remotecommand-methods">
<h6>Master-Side RemoteCommand Methods<a class="headerlink" href="#master-side-remotecommand-methods" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.remote_update" title="buildbot.process.remotecommand.RemoteCommand.remote_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_update</span></code></a></dt>
<dd>Update information about the running command.  See below for the format.</dd>
<dt><a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.remote_complete" title="buildbot.process.remotecommand.RemoteCommand.remote_complete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_complete</span></code></a></dt>
<dd>Signal that the command is complete, either successfully or with a Twisted failure.</dd>
</dl>
</div>
</div>
<div class="section" id="updates">
<span id="master-worker-updates"></span><h5>3.2.15.8. Updates<a class="headerlink" href="#updates" title="Permalink to this headline">¶</a></h5>
<p>Updates from the worker, sent via
<a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.remote_update" title="buildbot.process.remotecommand.RemoteCommand.remote_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_update</span></code></a>, are a list of
individual update elements.  Each update element is, in turn, a list of the
form <code class="docutils literal notranslate"><span class="pre">[data,</span> <span class="pre">0]</span></code> where the 0 is present for historical reasons.  The data is
a dictionary, with keys describing the contents.  The updates are handled by
<a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.remote_update" title="buildbot.process.remotecommand.RemoteCommand.remote_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_update</span></code></a>.</p>
<p>Updates with different keys can be combined into a single dictionary or
delivered sequentially as list elements, at the worker’s option.</p>
<p>To summarize, an <code class="docutils literal notranslate"><span class="pre">updates</span></code> parameter to
<a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.remote_update" title="buildbot.process.remotecommand.RemoteCommand.remote_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remote_update</span></code></a> might look like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s1">&#39;header&#39;</span> <span class="p">:</span> <span class="s1">&#39;running command..&#39;</span> <span class="p">},</span> <span class="mi">0</span> <span class="p">],</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s1">&#39;stdout&#39;</span> <span class="p">:</span> <span class="s1">&#39;abcd&#39;</span><span class="p">,</span> <span class="s1">&#39;stderr&#39;</span> <span class="p">:</span> <span class="s1">&#39;local modifications&#39;</span> <span class="p">},</span> <span class="mi">0</span> <span class="p">],</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s1">&#39;log&#39;</span> <span class="p">:</span> <span class="p">(</span> <span class="s1">&#39;cmd.log&#39;</span><span class="p">,</span> <span class="s1">&#39;cmd invoked at 12:33 pm</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="p">)</span> <span class="p">},</span> <span class="mi">0</span> <span class="p">],</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s1">&#39;rc&#39;</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="mi">0</span> <span class="p">],</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="defined-commands">
<h6>Defined Commands<a class="headerlink" href="#defined-commands" title="Permalink to this headline">¶</a></h6>
<p>The following commands are defined on the workers.</p>
<div class="section" id="shell">
<span id="shell-command-args"></span><h7>shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h7>
<p>Runs a shell command on the worker.  This command takes the following arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">command</span></code></p>
<blockquote>
<div>The command to run.  If this is a string, will be passed to the system
shell as a string.  Otherwise, it must be a list, which will be
executed directly.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">workdir</span></code></p>
<blockquote>
<div>Directory in which to run the command, relative to the builder dir.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">env</span></code></p>
<blockquote>
<div>A dictionary of environment variables to augment or replace the
existing environment on the worker.  In this dictionary, <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>
is treated specially: it should be a list of path components, rather
than a string, and will be prepended to the existing Python path.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">initial_stdin</span></code></p>
<blockquote>
<div>A string which will be written to the command’s standard input before
it is closed.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">want_stdout</span></code></p>
<blockquote>
<div>If false, then no updates will be sent for stdout.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">want_stderr</span></code></p>
<blockquote>
<div>If false, then no updates will be sent for stderr.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">usePTY</span></code></p>
<blockquote>
<div>If true, the command should be run with a PTY (POSIX only).  This
defaults to False.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">not_really</span></code></p>
<blockquote>
<div>If true, skip execution and return an update with rc=0.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">timeout</span></code></p>
<blockquote>
<div>Maximum time without output before the command is killed.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">maxTime</span></code></p>
<blockquote>
<div>Maximum overall time from the start before the command is killed.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">logfiles</span></code></p>
<blockquote>
<div><p>A dictionary specifying logfiles other than stdio.  Keys are the logfile
names, and values give the workdir-relative filename of the logfile.  Alternately,
a value can be a dictionary; in this case, the dictionary must have a <code class="docutils literal notranslate"><span class="pre">filename</span></code>
key specifying the filename, and can also have the following keys:</p>
<p><code class="docutils literal notranslate"><span class="pre">follow</span></code></p>
<blockquote>
<div>Only follow the file from its current end-of-file, rather that starting
from the beginning.</div></blockquote>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></p>
<blockquote>
<div>If false, the command’s environment will not be logged.</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">shell</span></code> command sends the following updates:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">stdout</span></code></dt>
<dd>The data is a bytestring which represents a continuation of the stdout
stream.  Note that the bytestring boundaries are not necessarily aligned
with newlines.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">stderr</span></code></dt>
<dd>Similar to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, but for the error stream.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt>
<dd>Similar to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, but containing data for a stream of
Buildbot-specific metadata.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rc</span></code></dt>
<dd>The exit status of the command, where – in keeping with UNIX tradition –
0 indicates success and any nonzero value is considered a failure.  No
further updates should be sent after an <code class="docutils literal notranslate"><span class="pre">rc</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">log</span></code></dt>
<dd>This update contains data for a logfile other than stdio.  The data
associated with the update is a tuple of the log name and the data for that
log.  Note that non-stdio logs do not distinguish output, error, and header
streams.</dd>
</dl>
</div>
<div class="section" id="uploadfile">
<h7>uploadFile<a class="headerlink" href="#uploadfile" title="Permalink to this headline">¶</a></h7>
<p>Upload a file from the worker to the master.  The arguments are</p>
<p><code class="docutils literal notranslate"><span class="pre">workdir</span></code></p>
<blockquote>
<div>The base directory for the filename, relative to the builder’s basedir.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">workersrc</span></code></p>
<blockquote>
<div>Name of the filename to read from., relative to the workdir.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">writer</span></code></p>
<blockquote>
<div>A remote reference to a writer object, described below.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">maxsize</span></code></p>
<blockquote>
<div>Maximum size, in bytes, of the file to write.  The operation will fail if
the file exceeds this size.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">blocksize</span></code></p>
<blockquote>
<div>The block size with which to transfer the file.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">keepstamp</span></code></p>
<blockquote>
<div>If true, preserve the file modified and accessed times.</div></blockquote>
<p>The worker calls a few remote methods on the writer object.  First, the
<code class="docutils literal notranslate"><span class="pre">write</span></code> method is called with a bytestring containing data, until all of the
data has been transmitted.  Then, the worker calls the writer’s <code class="docutils literal notranslate"><span class="pre">close</span></code>,
followed (if <code class="docutils literal notranslate"><span class="pre">keepstamp</span></code> is true) by a call to <code class="docutils literal notranslate"><span class="pre">upload(atime,</span> <span class="pre">mtime)</span></code>.</p>
<p>This command sends <code class="docutils literal notranslate"><span class="pre">rc</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr</span></code> updates, as defined for the <code class="docutils literal notranslate"><span class="pre">shell</span></code>
command.</p>
</div>
<div class="section" id="uploaddirectory">
<h7>uploadDirectory<a class="headerlink" href="#uploaddirectory" title="Permalink to this headline">¶</a></h7>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">uploadFile</span></code>, this command will upload an entire directory to the
master, in the form of a tarball.  It takes the following arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">workdir</span></code>
<code class="docutils literal notranslate"><span class="pre">workersrc</span></code>
<code class="docutils literal notranslate"><span class="pre">writer</span></code>
<code class="docutils literal notranslate"><span class="pre">maxsize</span></code>
<code class="docutils literal notranslate"><span class="pre">blocksize</span></code></p>
<blockquote>
<div>See <code class="docutils literal notranslate"><span class="pre">uploadFile</span></code></div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">compress</span></code></p>
<blockquote>
<div>Compression algorithm to use – one of <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">'bz2'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'gz'</span></code>.</div></blockquote>
<p>The writer object is treated similarly to the <code class="docutils literal notranslate"><span class="pre">uploadFile</span></code> command, but after
the file is closed, the worker calls the master’s <code class="docutils literal notranslate"><span class="pre">unpack</span></code> method with no
arguments to extract the tarball.</p>
<p>This command sends <code class="docutils literal notranslate"><span class="pre">rc</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr</span></code> updates, as defined for the <code class="docutils literal notranslate"><span class="pre">shell</span></code>
command.</p>
</div>
<div class="section" id="downloadfile">
<h7>downloadFile<a class="headerlink" href="#downloadfile" title="Permalink to this headline">¶</a></h7>
<p>This command will download a file from the master to the worker.  It takes the
following arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">workdir</span></code></p>
<blockquote>
<div>Base directory for the destination filename, relative to the builder basedir.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">workerdest</span></code></p>
<blockquote>
<div>Filename to write to, relative to the workdir.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">reader</span></code></p>
<blockquote>
<div>A remote reference to a reader object, described below.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">maxsize</span></code></p>
<blockquote>
<div>Maximum size of the file.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">blocksize</span></code></p>
<blockquote>
<div>The block size with which to transfer the file.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">mode</span></code></p>
<blockquote>
<div>Access mode for the new file.</div></blockquote>
<p>The reader object’s <code class="docutils literal notranslate"><span class="pre">read(maxsize)</span></code> method will be called with a maximum
size, which will return no more than that number of bytes as a bytestring.  At
EOF, it will return an empty string.  Once EOF is received, the worker will call
the remote <code class="docutils literal notranslate"><span class="pre">close</span></code> method.</p>
<p>This command sends <code class="docutils literal notranslate"><span class="pre">rc</span></code> and <code class="docutils literal notranslate"><span class="pre">stderr</span></code> updates, as defined for the <code class="docutils literal notranslate"><span class="pre">shell</span></code>
command.</p>
</div>
<div class="section" id="mkdir">
<h7>mkdir<a class="headerlink" href="#mkdir" title="Permalink to this headline">¶</a></h7>
<p>This command will create a directory on the worker.  It will also create any
intervening directories required.  It takes the following argument:</p>
<p><code class="docutils literal notranslate"><span class="pre">dir</span></code></p>
<blockquote>
<div>Directory to create.</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">mkdir</span></code> command produces the same updates as <code class="docutils literal notranslate"><span class="pre">shell</span></code>.</p>
</div>
<div class="section" id="rmdir">
<h7>rmdir<a class="headerlink" href="#rmdir" title="Permalink to this headline">¶</a></h7>
<p>This command will remove a directory or file on the worker.  It takes the following arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">dir</span></code></p>
<blockquote>
<div>Directory to remove.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">timeout</span></code>
<code class="docutils literal notranslate"><span class="pre">maxTime</span></code></p>
<blockquote>
<div>See <code class="docutils literal notranslate"><span class="pre">shell</span></code>, above.</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">rmdir</span></code> command produces the same updates as <code class="docutils literal notranslate"><span class="pre">shell</span></code>.</p>
</div>
<div class="section" id="cpdir">
<h7>cpdir<a class="headerlink" href="#cpdir" title="Permalink to this headline">¶</a></h7>
<p>This command will copy a directory from place to place on the worker.  It takes the following
arguments:</p>
<p><code class="docutils literal notranslate"><span class="pre">fromdir</span></code></p>
<blockquote>
<div>Source directory for the copy operation, relative to the builder’s basedir.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">todir</span></code></p>
<blockquote>
<div>Destination directory for the copy operation, relative to the builder’s basedir.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">timeout</span></code>
<code class="docutils literal notranslate"><span class="pre">maxTime</span></code></p>
<blockquote>
<div>See <code class="docutils literal notranslate"><span class="pre">shell</span></code>, above.</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">cpdir</span></code> command produces the same updates as <code class="docutils literal notranslate"><span class="pre">shell</span></code>.</p>
</div>
<div class="section" id="stat">
<h7>stat<a class="headerlink" href="#stat" title="Permalink to this headline">¶</a></h7>
<p>This command returns status information about a file or directory.  It takes a
single parameter, <code class="docutils literal notranslate"><span class="pre">file</span></code>, specifying the filename relative to the builder’s
basedir.</p>
<p>It produces two status updates:</p>
<p><code class="docutils literal notranslate"><span class="pre">stat</span></code></p>
<blockquote>
<div>The return value from Python’s <code class="docutils literal notranslate"><span class="pre">os.stat</span></code>.</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rc</span></code></p>
<blockquote>
<div>0 if the file is found, otherwise 1.</div></blockquote>
</div>
<div class="section" id="glob">
<h7>glob<a class="headerlink" href="#glob" title="Permalink to this headline">¶</a></h7>
<p>This command finds all pathnames matching a specified pattern that uses shell-style wildcards.
It takes a single parameter, <code class="docutils literal notranslate"><span class="pre">path</span></code>, specifying the pattern to pass to Python’s
<code class="docutils literal notranslate"><span class="pre">glob.glob</span></code> function.</p>
<p>It produces two status updates:</p>
<p><code class="docutils literal notranslate"><span class="pre">files</span></code></p>
<blockquote>
<div>The list of matching files returned from <code class="docutils literal notranslate"><span class="pre">glob.glob</span></code></div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rc</span></code></p>
<blockquote>
<div>0 if the <code class="docutils literal notranslate"><span class="pre">glob.glob</span></code> does not raise exception, otherwise 1.</div></blockquote>
</div>
<div class="section" id="listdir">
<h7>listdir<a class="headerlink" href="#listdir" title="Permalink to this headline">¶</a></h7>
<p>This command reads the directory and returns the list with directory contents. It
takes a single parameter, <code class="docutils literal notranslate"><span class="pre">dir</span></code>, specifying the directory relative to builder’s basedir.</p>
<p>It produces two status updates:</p>
<p><code class="docutils literal notranslate"><span class="pre">files</span></code></p>
<blockquote>
<div>The list of files in the directory returned from <code class="docutils literal notranslate"><span class="pre">os.listdir</span></code></div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">rc</span></code></p>
<blockquote>
<div>0 if the <code class="docutils literal notranslate"><span class="pre">os.listdir</span></code> does not raise exception, otherwise 1.</div></blockquote>
</div>
<div class="section" id="rmfile">
<h7>rmfile<a class="headerlink" href="#rmfile" title="Permalink to this headline">¶</a></h7>
<p>This command removes the file in the worker base directory.
It takes a single parameter, <code class="docutils literal notranslate"><span class="pre">path</span></code>, specifying the file path relative to builder’s basedir.</p>
<p>It produces one status updates:</p>
<p><code class="docutils literal notranslate"><span class="pre">rc</span></code></p>
<blockquote>
<div>0 if the <code class="docutils literal notranslate"><span class="pre">os.remove</span></code> does not raise exception, otherwise the corresponding errno.</div></blockquote>
</div>
</div>
</div>
</div>
<span id="document-developer/br-claiming"></span><div class="section" id="claiming-build-requests">
<span id="id1"></span><h4>3.2.16. Claiming Build Requests<a class="headerlink" href="#claiming-build-requests" title="Permalink to this headline">¶</a></h4>
<p>At Buildbot’s core, it is a distributed job (build) scheduling engine.
Future builds are represented by build requests, which are created by schedulers.</p>
<p>When a new build request is created, it is added to the <code class="docutils literal notranslate"><span class="pre">buildrequests</span></code> table and an appropriate message is sent.</p>
<div class="section" id="distributing">
<h5>3.2.16.1. Distributing<a class="headerlink" href="#distributing" title="Permalink to this headline">¶</a></h5>
<p>Each master distributes build requests among its builders by examining the list of available build requests, available workers, and accounting for user configuration for build request priority, worker priority, and so on.
This distribution process is re-run whenever an event occurs that may allow a new build to start.</p>
<p>Such events can be signalled to master with</p>
<ul class="simple">
<li><code class="xref py py-meth docutils literal notranslate"><span class="pre">maybeStartBuildsForBuilder</span></code> when a single builder is affected;</li>
<li><code class="xref py py-meth docutils literal notranslate"><span class="pre">maybeStartBuildsForWorker</span></code> when a single worker is affected; or</li>
<li><code class="xref py py-meth docutils literal notranslate"><span class="pre">maybeStartBuildsForAllBuilders</span></code> when all builders may be affected.</li>
</ul>
<p>In particular, when a master receives a new-build-request message, it performs the equivalent of <code class="xref py py-meth docutils literal notranslate"><span class="pre">maybeStartBuildsForBuilder</span></code> for the affected builder.</p>
</div>
<div class="section" id="claiming">
<h5>3.2.16.2. Claiming<a class="headerlink" href="#claiming" title="Permalink to this headline">¶</a></h5>
<p>If circumstances are right for a master to begin a build, then it attempts to “claim” the build request.
In fact, if several build requests were merged, it attempts to claim them as a group, using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">claimBuildRequests</span></code> DB method.
This method uses transactions and an insert into the <code class="docutils literal notranslate"><span class="pre">buildrequest_claims</span></code> table to ensure that exactly one master succeeds in claiming any particular build request.</p>
<p>If the claim fails, then another master has claimed the affected build requests, and the attempt is abandoned.</p>
<p>If the claim succeeds, then the master sends a message indicating that it has claimed the request.
This message can be used by other masters to abandon their attempts to claim this request, although this is not yet implemented.</p>
<p>If the build request is later abandoned (as can happen if, for example, the worker has disappeared), then master will send a message indicating that the request is again unclaimed; like a new-buildrequest message, this message indicates that other masters should try to distribute it once again.</p>
</div>
<div class="section" id="the-one-that-got-away">
<h5>3.2.16.3. The One That Got Away<a class="headerlink" href="#the-one-that-got-away" title="Permalink to this headline">¶</a></h5>
<p>The claiming process is complex, and things can go wrong at just about any point.
Through master failures or message/database race conditions, it’s quite possible for a build request to be “missed”, even when resources are available to process it.</p>
<p>To account for this possibility, masters periodically poll the <code class="docutils literal notranslate"><span class="pre">buildrequests</span></code> table for unclaimed requests and try to distribute them.
This resiliency avoids “lost” build requests, at the small cost of a polling delay before the requests are scheduled.</p>
</div>
</div>
<span id="document-developer/encodings"></span><div class="section" id="string-encodings">
<h4>3.2.17. String Encodings<a class="headerlink" href="#string-encodings" title="Permalink to this headline">¶</a></h4>
<p>Buildbot expects all strings used internally to be valid Unicode strings - not
bytestrings.</p>
<p>Note that Buildbot rarely feeds strings back into external tools in such a way
that those strings must match.  For example, Buildbot does not attempt to
access the filenames specified in a Change.  So it is more important to store
strings in a manner that will be most useful to a human reader (e.g., in
logfiles, web status, etc.) than to store them in a lossless format.</p>
<div class="section" id="inputs">
<h5>3.2.17.1. Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h5>
<p>On input, strings should be decoded, if their encoding is known.  Where
necessary, the assumed input encoding should be configurable.  In some cases,
such as filenames, this encoding is not known or not well-defined (e.g., a
utf-8 encoded filename in a latin-1 directory).  In these cases, the input
mechanisms should make a best effort at decoding, and use e.g., the
<code class="docutils literal notranslate"><span class="pre">errors='replace'</span></code> option to fail gracefully on un-decodable characters.</p>
</div>
<div class="section" id="outputs">
<h5>3.2.17.2. Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h5>
<p>At most points where Buildbot outputs a string, the target encoding is known.
For example, the web status can encode to utf-8.  In cases where it is not
known, it should be configurable, with a safe fallback (e.g., ascii with
<code class="docutils literal notranslate"><span class="pre">errors='replace'</span></code>.  For HTML/XML outputs, consider using
<code class="docutils literal notranslate"><span class="pre">errors='xmlcharrefreplace'</span></code> instead.</p>
</div>
</div>
<span id="document-developer/metrics"></span><div class="section" id="metrics">
<span id="id1"></span><h4>3.2.18. Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h4>
<p>New in buildbot 0.8.4 is support for tracking various performance metrics inside the buildbot master process.
Currently these are logged periodically according to the <code class="docutils literal notranslate"><span class="pre">log_interval</span></code> configuration setting of the <a class="reference internal" href="#cfg-metrics" title="metrics"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">metrics</span></code></a> configuration.</p>
<p>The metrics subsystem is implemented in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.metrics</span></code>.
It makes use of twisted’s logging system to pass metrics data from all over buildbot’s code to a central <code class="xref py py-class docutils literal notranslate"><span class="pre">MetricsLogObserver</span></code> object, which is available at <code class="docutils literal notranslate"><span class="pre">BuildMaster.metrics</span></code> or via <code class="docutils literal notranslate"><span class="pre">Status.getMetrics()</span></code>.</p>
<div class="section" id="metric-events">
<h5>3.2.18.1. Metric Events<a class="headerlink" href="#metric-events" title="Permalink to this headline">¶</a></h5>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">MetricEvent</span></code> objects represent individual items to monitor.
There are three sub-classes implemented:</p>
<dl class="docutils">
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">MetricCountEvent</span></code></dt>
<dd><p class="first">Records incremental increase or decrease of some value, or an absolute measure of some value.</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="k">import</span> <span class="n">MetricCountEvent</span>

<span class="c1"># We got a new widget!</span>
<span class="n">MetricCountEvent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;num_widgets&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># We have exactly 10 widgets</span>
<span class="n">MetricCountEvent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;num_widgets&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">MetricTimeEvent</span></code></dt>
<dd><p class="first">Measures how long things take. By default the average of the last 10 times will be reported.</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="k">import</span> <span class="n">MetricTimeEvent</span>

<span class="c1"># function took 0.001s</span>
<span class="n">MetricTimeEvent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;time_function&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">MetricAlarmEvent</span></code></dt>
<dd><p class="first">Indicates the health of various metrics.</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="k">import</span> <span class="n">MetricAlarmEvent</span><span class="p">,</span> <span class="n">ALARM_OK</span>

<span class="c1"># num_workers looks ok</span>
<span class="n">MetricAlarmEvent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;num_workers&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">ALARM_OK</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="metric-handlers">
<h5>3.2.18.2. Metric Handlers<a class="headerlink" href="#metric-handlers" title="Permalink to this headline">¶</a></h5>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">MetricsHandler</span></code> objects are responsible for collecting <code class="xref py py-class docutils literal notranslate"><span class="pre">MetricEvent</span></code>s of a specific type and keeping track of their values for future reporting.
There are <code class="xref py py-class docutils literal notranslate"><span class="pre">MetricsHandler</span></code> classes corresponding to each of the <code class="xref py py-class docutils literal notranslate"><span class="pre">MetricEvent</span></code> types.</p>
</div>
<div class="section" id="metric-watchers">
<h5>3.2.18.3. Metric Watchers<a class="headerlink" href="#metric-watchers" title="Permalink to this headline">¶</a></h5>
<p>Watcher objects can be added to <code class="xref py py-class docutils literal notranslate"><span class="pre">MetricsHandlers</span></code> to be called when metric events of a certain type are received.
Watchers are generally used to record alarm events in response to count or time events.</p>
</div>
<div class="section" id="metric-helpers">
<h5>3.2.18.4. Metric Helpers<a class="headerlink" href="#metric-helpers" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><code class="xref py py-func docutils literal notranslate"><span class="pre">countMethod(name)</span></code></dt>
<dd><p class="first">A function decorator that counts how many times the function is called.</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="k">import</span> <span class="n">countMethod</span>

<span class="nd">@countMethod</span><span class="p">(</span><span class="s1">&#39;foo_called&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;foo!&quot;</span>
</pre></div>
</div>
</dd>
<dt><code class="xref py py-func docutils literal notranslate"><span class="pre">Timer(name)</span></code></dt>
<dd><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">Timer</span></code> objects can be used to make timing events easier.
When <code class="docutils literal notranslate"><span class="pre">Timer.stop()</span></code> is called, a <code class="xref py py-class docutils literal notranslate"><span class="pre">MetricTimeEvent</span></code> is logged with the elapsed time since <code class="docutils literal notranslate"><span class="pre">timer.start()</span></code> was called.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="k">import</span> <span class="n">Timer</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;time_foo&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">calc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;foo!&quot;</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Timer</span></code> objects also provide a pair of decorators, <code class="xref py py-func docutils literal notranslate"><span class="pre">startTimer</span></code>/<code class="xref py py-func docutils literal notranslate"><span class="pre">stopTimer</span></code> to decorate other functions.</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="k">import</span> <span class="n">Timer</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="s1">&#39;time_thing&#39;</span><span class="p">)</span>

<span class="nd">@t</span><span class="o">.</span><span class="n">startTimer</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;foo!&quot;</span>

<span class="nd">@t</span><span class="o">.</span><span class="n">stopTimer</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;bar!&quot;</span>

<span class="n">foo</span><span class="p">()</span>
<span class="n">bar</span><span class="p">()</span>
</pre></div>
</div>
</dd>
<dt><code class="xref py py-func docutils literal notranslate"><span class="pre">timeMethod(name)</span></code></dt>
<dd><p class="first">A function decorator that measures how long a function takes to execute.
Note that many functions in buildbot return deferreds, so may return before all the work they set up has completed.
Using an explicit <code class="xref py py-class docutils literal notranslate"><span class="pre">Timer</span></code> is better in this case.</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="k">import</span> <span class="n">timeMethod</span>

<span class="nd">@timeMethod</span><span class="p">(</span><span class="s1">&#39;time_foo&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">calc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;foo!&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<span id="document-developer/secrets"></span><div class="section" id="secrets">
<h4>3.2.19. Secrets<a class="headerlink" href="#secrets" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SecretDetails</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ...</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</pre></div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">secretDetails</span></code> is a python object initialized with a provider name, a key and a value.
Each parameter is an object property.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">secretdetail</span> <span class="o">=</span> <span class="n">SecretDetails</span><span class="p">(</span><span class="s2">&quot;SourceProvider&quot;</span><span class="p">,</span> <span class="s2">&quot;myKey&quot;</span><span class="p">,</span> <span class="s2">&quot;myValue&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">secretdetail</span><span class="o">.</span><span class="n">source</span><span class="p">)</span>
<span class="s2">&quot;SourceProvider&quot;</span>
<span class="k">print</span><span class="p">(</span><span class="n">secretdetail</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
<span class="s2">&quot;myKey&quot;</span>
<span class="k">print</span><span class="p">(</span><span class="n">secretdetail</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="s2">&quot;myValue&quot;</span>
</pre></div>
</div>
<p>A Secret is defined by a key associated to a value, returned from a provider.
Secrets returned by providers are stored in a <code class="docutils literal notranslate"><span class="pre">secretDetails</span></code> object.</p>
</div>
<div class="section" id="secrets-manager">
<h4>3.2.20. Secrets manager<a class="headerlink" href="#secrets-manager" title="Permalink to this headline">¶</a></h4>
<p>The manager is a Buildbot service manager.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">secretsService</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">namedServices</span><span class="p">[</span><span class="s1">&#39;secrets&#39;</span><span class="p">]</span>
<span class="n">secretDetailsList</span> <span class="o">=</span> <span class="n">secretsService</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">secrets</span><span class="p">)</span>
</pre></div>
</div>
<p>The service executes a get method.
Depending on the kind of storage chosen and declared in the configuration, the manager gets the selected provider and returns a list of <code class="docutils literal notranslate"><span class="pre">secretDetails</span></code>.</p>
</div>
<div class="section" id="secrets-providers">
<h4>3.2.21. Secrets providers<a class="headerlink" href="#secrets-providers" title="Permalink to this headline">¶</a></h4>
<p>The secrets providers are implementing the specific getters, related to the storage chosen.</p>
<div class="section" id="file-provider">
<h5>3.2.21.1. File provider<a class="headerlink" href="#file-provider" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;secretsProviders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">secrets</span><span class="o">.</span><span class="n">SecretInAFile</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s2">&quot;/path/toSecretsFiles&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>In the master configuration the provider is instantiated through a Buildbot service secret manager with the file directory path.
File secrets provider reads the file named by the key wanted by Buildbot and returns the contained text value (removing trailing newlines if present).
SecretInAFile provider allows Buildbot to read secrets in the secret directory.</p>
</div>
<div class="section" id="vault-provider">
<h5>3.2.21.2. Vault provider<a class="headerlink" href="#vault-provider" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;secretsProviders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">secrets</span><span class="o">.</span><span class="n">SecretInVault</span><span class="p">(</span><span class="n">vaultToken</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;VAULT_TOKEN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span>
                                            <span class="n">vaultServer</span><span class="o">=</span><span class="s2">&quot;http://localhost:8200&quot;</span>
                                            <span class="p">)]</span>
</pre></div>
</div>
<p>In the master configuration, the provider is instantiated through a Buildbot service secret manager with the Vault token and the Vault server address.
Vault secrets provider accesses the Vault backend asking the key wanted by Buildbot and returns the contained text value.
SecretInVAult provider allows Buildbot to read secrets in the Vault.</p>
</div>
<div class="section" id="interpolate-secret">
<h5>3.2.21.3. Interpolate secret<a class="headerlink" href="#interpolate-secret" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;some text and %(secret:foo)s&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Secret keys are replaced in a string by the secret value using the class Interpolate and the keyword secret.
The secret is searched across the providers defined in the master configuration.</p>
</div>
<div class="section" id="secret-obfuscation">
<h5>3.2.21.4. Secret Obfuscation<a class="headerlink" href="#secret-obfuscation" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;some text and %(secret:foo)s&quot;</span><span class="p">)</span>
<span class="c1"># some text rendered</span>
<span class="n">rendered</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">cleantext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">build_status</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">cleanupTextFromSecrets</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span>
</pre></div>
</div>
<p>Secrets don’t have to be visible to the normal user via logs and thus are transmitted directly to the workers.
Secrets are rendered and can arrive anywhere in the logs.
The function <code class="docutils literal notranslate"><span class="pre">cleanupTextFromSecrets</span></code> defined in the class Properties helps to replace the secret value by the key value.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;the example value is:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cleantext</span><span class="p">))</span>
<span class="o">&gt;&gt;</span> <span class="n">the</span> <span class="n">example</span> <span class="n">value</span> <span class="ow">is</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">foo</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Secret is rendered and it is recorded in a dictionary, named <code class="docutils literal notranslate"><span class="pre">_used_secrets</span></code>, where the key is the secret value and the value the secret key.
Therefore anywhere logs are written having content with secrets, the secrets are replaced by the value from <code class="docutils literal notranslate"><span class="pre">_used_secrets</span></code>.</p>
</div>
<div class="section" id="how-to-use-a-secret-in-a-buildbotservice">
<h5>3.2.21.5. How to use a secret in a BuildbotService<a class="headerlink" href="#how-to-use-a-secret-in-a-buildbotservice" title="Permalink to this headline">¶</a></h5>
<p>Service configurations are loaded during a Buildbot start or modified during a Buildbot restart.
Secrets are used like renderables in a service and are rendered during the configuration load.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyService</span><span class="p">(</span><span class="n">BuildbotService</span><span class="p">):</span>
  <span class="n">secrets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">secrets</span></code> is a list containing all the secret keys that can be used as class attributes.
When the service is loaded during the Buildbot reconfigService function, secrets are rendered and the values are updated.
Everywhere the variable with the secret name (<cite>foo</cite> or <cite>other</cite> in the example) is used, the class attribute value is replaced by the secret value.
This is similar to the “renderable” annotation, but will only works for BuildbotServices, and will only interpolate secrets.
Others renderables can still be held in the service as attributes, and rendered dynamically at a later time.</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyService</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="n">secrets</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">]</span>

<span class="n">myService</span> <span class="o">=</span> <span class="n">MyService</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
<p>After a Buildbot reconfigService:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;myService returns secret value:&quot;</span><span class="p">,</span> <span class="n">myService</span><span class="o">.</span><span class="n">foo</span><span class="p">))</span>
<span class="o">&gt;&gt;</span> <span class="n">myService</span> <span class="n">returns</span> <span class="n">secret</span> <span class="n">value</span> <span class="n">bar</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
<span id="document-developer/stats-service"></span><div class="section" id="statistics-service">
<span id="stats-service"></span><h4>3.2.22. Statistics Service<a class="headerlink" href="#statistics-service" title="Permalink to this headline">¶</a></h4>
<p>The statistic service (or stats service) is implemented in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.statistics.stats_service</span></code>.
Please see <a class="reference internal" href="#cfg-stats-service" title="stats-service"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">stats-service</span></code></a> for more information.</p>
<p>Here is a diagram demonstrating the working of the stats service:</p>
<img alt="_images/stats-service.png" src="_images/stats-service.png" />
<div class="section" id="id1">
<h5>3.2.22.1. Stats Service<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.statistics.stats_service.StatsService">
<em class="property">class </em><code class="descclassname">buildbot.statistics.stats_service.</code><code class="descname">StatsService</code><a class="headerlink" href="#buildbot.statistics.stats_service.StatsService" title="Permalink to this definition">¶</a></dt>
<dd><p>An instance of this class functions as a <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildbotService</span></code>.
The instance of the running service is initialized in the master configuration file (see <a class="reference internal" href="#cfg-stats-service" title="stats-service"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">stats-service</span></code></a> for more information).
The running service is accessible everywhere in Buildbot via the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code>.
The service is available at <code class="docutils literal notranslate"><span class="pre">self.master.namedServices['&lt;service-name&gt;']</span></code>.
It takes the following initialization arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">storage_backends</span></code></dt>
<dd>A list of storage backends.
These are instance of subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">StatsStorageBase</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>(str) The name of this service.
This name can be used to access the running instance of this service using <code class="docutils literal notranslate"><span class="pre">self.master.namedServices[name]</span></code>.</dd>
</dl>
<p>Please see <a class="reference internal" href="#cfg-stats-service" title="stats-service"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">stats-service</span></code></a> for examples.</p>
<dl class="method">
<dt id="buildbot.statistics.stats_service.StatsService.checkConfig">
<code class="descname">checkConfig</code><span class="sig-paren">(</span><em>self</em>, <em>storage_backends</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.stats_service.StatsService.checkConfig" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">storage_backends</span></code></dt>
<dd>A list of storage backends.</dd>
</dl>
<p>This method is called automatically to verify that the list of storage backends contains instances of subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">StatsStorageBase</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.stats_service.StatsService.reconfigService">
<code class="descname">reconfigService</code><span class="sig-paren">(</span><em>self</em>, <em>storage_backends</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.stats_service.StatsService.reconfigService" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">storage_backends</span></code></dt>
<dd>A list of storage backends.</dd>
</dl>
<p>This method is called automatically to reconfigure the running service.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.stats_service.StatsService.registerConsumers">
<code class="descname">registerConsumers</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.stats_service.StatsService.registerConsumers" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal method for this class called to register all consumers (methods from Capture classes) to the MQ layer.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.stats_service.StatsService.stopService">
<code class="descname">stopService</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.stats_service.StatsService.stopService" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal method for this class to stop the stats service and clean up.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.stats_service.StatsService.removeConsumers">
<code class="descname">removeConsumers</code><span class="sig-paren">(</span><em>self</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.stats_service.StatsService.removeConsumers" title="Permalink to this definition">¶</a></dt>
<dd><p>Internal method for this class to stop and remove consumers from the MQ layer.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.stats_service.StatsService.yieldMetricsValue">
<code class="descname">yieldMetricsValue</code><span class="sig-paren">(</span><em>self</em>, <em>data_name</em>, <em>post_data</em>, <em>buildid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.stats_service.StatsService.yieldMetricsValue" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">data_name</span></code></dt>
<dd>(str) The name of the data being sent or storage.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">post_data</span></code></dt>
<dd>A dictionary of key value pair that is sent for storage.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buildid</span></code></dt>
<dd>The integer build id of the current build.
Obtainable in all <code class="docutils literal notranslate"><span class="pre">BuildSteps</span></code>.</dd>
</dl>
<p>This method should be called to post data that is not generated and stored as build-data in the database.
This method generates the <code class="docutils literal notranslate"><span class="pre">stats-yield-data</span></code> event to the mq layer which is then consumed in <code class="xref py py-class docutils literal notranslate"><span class="pre">postData</span></code>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="storage-backends">
<span id="storage-backend"></span><h5>3.2.22.2. Storage backends<a class="headerlink" href="#storage-backends" title="Permalink to this headline">¶</a></h5>
<p>Storage backends are responsible for storing any statistics/data sent to them.
A storage backend will generally be some sort of a database-server running on a machine.
.. note:: This machine may be different from the one running <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code></p>
<p>Data is captured according to the master config file and then, is sent to each of the storage backends provided by the master configuration (see <a class="reference internal" href="#cfg-stats-service" title="stats-service"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">stats-service</span></code></a>).</p>
<p>Each storage backend has a Python client defined as part of <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.statistics.storage_backends</span></code> to aid in posting data by <code class="xref py py-class docutils literal notranslate"><span class="pre">StatsService</span></code>.</p>
<p>Currently, only <a class="reference external" href="https://influxdata.com/time-series-platform/influxdb/">InfluxDB</a> is supported as a storage backend.</p>
<dl class="class">
<dt id="buildbot.statistis.storage_backends.base.StatsStorageBase">
<em class="property">class </em><code class="descclassname">buildbot.statistis.storage_backends.base.</code><code class="descname">StatsStorageBase</code><a class="headerlink" href="#buildbot.statistis.storage_backends.base.StatsStorageBase" title="Permalink to this definition">¶</a></dt>
<dd><p>A abstract class for all storage services.
It cannot be directly initialized - it would raise a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> otherwise.</p>
<dl class="method">
<dt id="buildbot.statistis.storage_backends.base.StatsStorageBase.thd_postStatsValue">
<code class="descname">thd_postStatsValue</code><span class="sig-paren">(</span><em>self</em>, <em>post_data</em>, <em>series_name</em>, <em>context</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistis.storage_backends.base.StatsStorageBase.thd_postStatsValue" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">post_data</span></code></dt>
<dd>A dict of key-value pairs that is sent for storage.
The keys of this dict can be thought of as columns in a database and the value is the data stored for that column.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">series_name</span></code></dt>
<dd>(str) The name of the time-series for this statistic.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">context</span></code></dt>
<dd>(Optional) Any other contextual information about the data.
It is a dict of key-value pairs.</dd>
</dl>
<p>An abstract method that needs to be implemented by every child class of this class.
Not doing so will result result in a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> when starting Buildbot.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.storage_backends.influxdb_client.InfluxStorageService">
<em class="property">class </em><code class="descclassname">buildbot.statistics.storage_backends.influxdb_client.</code><code class="descname">InfluxStorageService</code><a class="headerlink" href="#buildbot.statistics.storage_backends.influxdb_client.InfluxStorageService" title="Permalink to this definition">¶</a></dt>
<dd><p><a class="reference external" href="https://influxdata.com/time-series-platform/influxdb/">InfluxDB</a> is a distributed, time series database that employs a key-value pair storage system.</p>
<p>This class is a Buildbot client to the InfluxDB storage backend.
It is available in the configuration as <code class="docutils literal notranslate"><span class="pre">statistics.InfluxStorageService</span></code>.
It takes the following initialization arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">url</span></code></dt>
<dd>(str) The URL where the service is running.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt>
<dd>(int) The port on which the service is listening.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">user</span></code></dt>
<dd>(str) Username of a InfluxDB user.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt>
<dd>(str) Password for <code class="docutils literal notranslate"><span class="pre">user</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">db</span></code></dt>
<dd>(str) The name of database to be used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">captures</span></code></dt>
<dd>A list of instances of subclasses of <code class="xref py py-class docutils literal notranslate"><span class="pre">Capture</span></code>.
This tells which stats are to be stored in this storage backend.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name=None</span></code></dt>
<dd>(Optional) (str) The name of this storage backend.</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.storage_backends.influxdb_client.InfluxStorageService.thd_postStatsValue">
<code class="descname">thd_postStatsValue</code><span class="sig-paren">(</span><em>self</em>, <em>post_data</em>, <em>series_name</em>, <em>context={}</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.storage_backends.influxdb_client.InfluxStorageService.thd_postStatsValue" title="Permalink to this definition">¶</a></dt>
<dd><dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">post_data</span></code></dt>
<dd>A dict of key-value pairs that is sent for storage.
The keys of this dict can be thought of as columns in a database and the value is the data stored for that column.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">series_name</span></code></dt>
<dd>(str) The name of the time-series for this statistic.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">context</span></code></dt>
<dd>(Optional) Any other contextual information about the data.
It is a dict of key-value pairs.</dd>
</dl>
<p>This method constructs a dictionary of data to be sent to InfluxDB in the proper format and sends the data to the influxDB instance.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="capture-classes">
<h5>3.2.22.3. Capture Classes<a class="headerlink" href="#capture-classes" title="Permalink to this headline">¶</a></h5>
<p>Capture classes are used for declaring which data needs to captured and sent to storage backends for storage.</p>
<dl class="class">
<dt id="buildbot.statistics.capture.Capture">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">Capture</code><a class="headerlink" href="#buildbot.statistics.capture.Capture" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the abstract base class for all capture classes.
Not to be used directly.
Initlized with the following parameters:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">routingKey</span></code></dt>
<dd>(tuple) The routing key to be used by <code class="xref py py-class docutils literal notranslate"><span class="pre">StatsService</span></code> to register consumers to the MQ layer for the subclass of this class.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback</span></code></dt>
<dd>The callback registered with the MQ layer for the consumer of a subclass of this class.
Each subclass must provide a default callback for this purpose.</dd>
</dl>
<dl class="method">
<dt>
<code class="descname">_defaultContext(self, msg):</code></dt>
<dd><p>A method for providing default context to the storage backends.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">consume(self, routingKey, msg):</code></dt>
<dd><p>This is an abstract method - each subclass of this class should implement its own consume method.
If not, then the subclass can’t be instantiated.
The consume method, when called (from the mq layer), receives the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">routingKey</span></code></dt>
<dd>The routing key which was registered to the MQ layer.
Same as the <code class="docutils literal notranslate"><span class="pre">routingKey</span></code> provided to instantiate this class.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">msg</span></code></dt>
<dd>The message that was sent by the producer.</dd>
</dl>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">_store(self, post_data, series_name, context):</code></dt>
<dd><p>This is an abstract method of this class.
It must be implemented by all subclasses of this class.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">post_data</span></code></dt>
<dd>(dict) The key-value pair being sent to the storage backend.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">series_name</span></code></dt>
<dd>(str) The name of the series to which this data is stored.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">context</span></code></dt>
<dd>(dict) Any additional information pertaining to data being sent.</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CapturePropertyBase">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CapturePropertyBase</code><a class="headerlink" href="#buildbot.statistics.capture.CapturePropertyBase" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a base class for both <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureProperty</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">CapturePropertyAllBuilders</span></code> and abstracts away much of the common functionality between the two classes.
Cannot be initialized directly as it contains an abstract method and raises <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> if tried.
It is initialized with the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">property_name</span></code></dt>
<dd>(str) The name of property needed to be recorded as a statistic.
This can be a regular expression if <code class="docutils literal notranslate"><span class="pre">regex=True</span></code> (see below).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function that is used by <code class="docutils literal notranslate"><span class="pre">CaptureProperty.consumer</span></code> to post-process data before formatting it and sending it to the appropriate storage backends.
A default callback needs to be prois provided for this.</p>
<p>The default callback:</p>
<blockquote class="last">
<div><dl class="function">
<dt id="buildbot.statistics.capture.CapturePropertyBase.default_callback">
<code class="descname">default_callback</code><span class="sig-paren">(</span><em>props</em>, <em>property_name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CapturePropertyBase.default_callback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>It returns property value for <code class="docutils literal notranslate"><span class="pre">property_name</span></code>.
It receives the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">props</span></code></dt>
<dd>A dictionary of all build properties.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">property_name</span></code></dt>
<dd>(str) Name of the build property to return.</dd>
</dl>
</div></blockquote>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">regex=False</span></code></dt>
<dd>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the property name can be a regular expression.
All properties matching this regular expression will be sent for storage.</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CapturePropertyBase.consume">
<code class="descname">consume</code><span class="sig-paren">(</span><em>self</em>, <em>routingKey</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CapturePropertyBase.consume" title="Permalink to this definition">¶</a></dt>
<dd><p>The consumer for all CaptureProperty classes described below.
This method filters out the correct properties as per the configuration file and sends those properties for storage.
The subclasses of this method do not need to implement this method as it takes care of all the functionality itself.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">Capture</span></code> for more information.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">_builder_name_matches(self, builder_info):</code></dt>
<dd><p>This is an abstract method and needs to be implemented by all subclasses of this class.
This is a helper method to the <code class="docutils literal notranslate"><span class="pre">consume</span></code> method mentioned above.
It checks whether a builder is allowed to send properties to the storage backend according to the configuration file.
It takes one argument:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_info</span></code></dt>
<dd>(dict) The dictionary returned by the data API containing the builder information.</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureProperty">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureProperty</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureProperty" title="Permalink to this definition">¶</a></dt>
<dd><p>The capture class for capturing build properties.
It is available in the configuration as <code class="docutils literal notranslate"><span class="pre">statistics.CaptureProperty</span></code></p>
<p>It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>(str) The name of builder in which the property is recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">property_name</span></code></dt>
<dd>(str) The name of property needed to be recorded as a statistic.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>The callback function that is used by <code class="docutils literal notranslate"><span class="pre">CaptureProperty.consumer</span></code> to post-process data before formatting it and sending it to the appropriate storage backends.
A default callback is provided for this (see <code class="xref py py-class docutils literal notranslate"><span class="pre">CapturePropertyBase</span></code> for more information).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">regex=False</span></code></dt>
<dd>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the property name can be a regular expression.
All properties matching this regular expression will be sent for storage.</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureProperty._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureProperty._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CapturePropertyBase</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CapturePropertyAllBuilders">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CapturePropertyAllBuilders</code><a class="headerlink" href="#buildbot.statistics.capture.CapturePropertyAllBuilders" title="Permalink to this definition">¶</a></dt>
<dd><p>The capture class to use for capturing build properties on all builders.
It is available in the configuration as <code class="docutils literal notranslate"><span class="pre">statistics.CaptureProperty</span></code></p>
<p>It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">property_name</span></code></dt>
<dd>(str) The name of property needed to be recorded as a statistic.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>The callback function that is used by <code class="docutils literal notranslate"><span class="pre">CaptureProperty.consumer</span></code> to post-process data before formatting it and sending it to the appropriate storage backends.
A default callback is provided for this (see <code class="xref py py-class docutils literal notranslate"><span class="pre">CapturePropertyBase</span></code> for more information).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">regex=False</span></code></dt>
<dd>If this is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, then the property name can be a regular expression.
All properties matching this regular expression will be sent for storage.</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CapturePropertyAllBuilders._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CapturePropertyAllBuilders._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CapturePropertyBase</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureBuildTimes">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildTimes</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildTimes" title="Permalink to this definition">¶</a></dt>
<dd><p>A base class for all Capture classes that deal with build times (start/end/duration).
Not to be used directly.
Initialized with:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>(str) The name of builder whose times are to be recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback</span></code></dt>
<dd>The callback function that is used by subclass of this class to post-process data before formatting it and sending it to the appropriate storage backends.
A default callback is provided for this.
Each subclass must provide a default callback that is used in initialization of this class should the user not provide a callback.</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildTimes.consume">
<code class="descname">consume</code><span class="sig-paren">(</span><em>self</em>, <em>routingKey</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildTimes.consume" title="Permalink to this definition">¶</a></dt>
<dd><p>The consumer for all subclasses of this class.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">Capture</span></code> for more information.
.. note:: This consumer requires all subclasses to implement:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">self._time_type</span></code> (property)</dt>
<dd>A string used as a key in <code class="docutils literal notranslate"><span class="pre">post_data</span></code> sent to storage services.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">self._retValParams(msg)</span></code> (method)</dt>
<dd>A method that takes in the <code class="docutils literal notranslate"><span class="pre">msg</span></code> this consumer gets and returns a list of arguments for the capture callback.</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildTimes._retValParams">
<code class="descname">_retValParams</code><span class="sig-paren">(</span><em>self</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildTimes._retValParams" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an abstract method which needs to be implemented by subclasses.
This method needs to return a list of parameters that will be passed to the <code class="docutils literal notranslate"><span class="pre">callback</span></code> function.
See individual build <code class="docutils literal notranslate"><span class="pre">CaptureBuild*</span></code> classes for more information.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildTimes._err_msg">
<code class="descname">_err_msg</code><span class="sig-paren">(</span><em>self</em>, <em>build_data</em>, <em>builder_name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildTimes._err_msg" title="Permalink to this definition">¶</a></dt>
<dd><p>A helper method that returns an error message for the <code class="docutils literal notranslate"><span class="pre">consume</span></code> method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildTimes._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildTimes._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an abstract method and needs to be implemented by all subclasses of this class.
This is a helper method to the <code class="docutils literal notranslate"><span class="pre">consume</span></code> method mentioned above.
It checks whether a builder is allowed to send build times to the storage backend according to the configuration file.
It takes one argument:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_info</span></code></dt>
<dd>(dict) The dictionary returned by the data API containing the builder information.</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureBuildStartTime">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildStartTime</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildStartTime" title="Permalink to this definition">¶</a></dt>
<dd><p>A capture class for capturing build start times.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>(str) The name of builder whose times are to be recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function for this class.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information.</p>
<p>The default callback:</p>
<blockquote class="last">
<div><dl class="function">
<dt id="buildbot.statistics.capture.CaptureBuildStartTime.default_callback">
<code class="descname">default_callback</code><span class="sig-paren">(</span><em>start_time</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildStartTime.default_callback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>It returns the start time in ISO format.
It takes one argument:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">start_time</span></code></dt>
<dd>A python datetime object that denotes the build start time.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildStartTime._retValParams">
<code class="descname">_retValParams</code><span class="sig-paren">(</span><em>self</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildStartTime._retValParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a list containing one Python datetime object (start time) from <code class="docutils literal notranslate"><span class="pre">msg</span></code> dictionary.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildStartTime._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildStartTime._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureBuildStartTimeAllBuilders">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildStartTimeAllBuilders</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildStartTimeAllBuilders" title="Permalink to this definition">¶</a></dt>
<dd><p>A capture class for capturing build start times from all builders.
It is a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildStartTime</span></code>.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function for this class.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information.</p>
<p>The default callback:</p>
<blockquote class="last">
<div>See <code class="docutils literal notranslate"><span class="pre">CaptureBuildStartTime.__init__</span></code> for the definition.</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildStartTimeAllBuilders._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildStartTimeAllBuilders._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureBuildEndTime">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildEndTime</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildEndTime" title="Permalink to this definition">¶</a></dt>
<dd><p>A capture class for capturing build end times.
Takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>(str) The name of builder whose times are to be recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function for this class.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information.</p>
<p>The default callback:</p>
<blockquote class="last">
<div><dl class="function">
<dt id="buildbot.statistics.capture.CaptureBuildEndTime.default_callback">
<code class="descname">default_callback</code><span class="sig-paren">(</span><em>end_time</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildEndTime.default_callback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>It returns the end time in ISO format.
It takes one argument:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">end_time</span></code></dt>
<dd>A python datetime object that denotes the build end time.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildEndTime._retValParams">
<code class="descname">_retValParams</code><span class="sig-paren">(</span><em>self</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildEndTime._retValParams" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Returns a list containing two Python datetime object (start time and end time) from <code class="docutils literal notranslate"><span class="pre">msg</span></code> dictionary.</p>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildEndTime._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildEndTime._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureBuildEndTimeAllBuilders">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildEndTimeAllBuilders</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildEndTimeAllBuilders" title="Permalink to this definition">¶</a></dt>
<dd><p>A capture class for capturing build end times from all builders.
It is a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildEndTime</span></code>.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function for this class.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information.</p>
<p>The default callback:</p>
<blockquote class="last">
<div>See <code class="docutils literal notranslate"><span class="pre">CaptureBuildEndTime.__init__</span></code> for the definition.</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildEndTimeAllBuilders._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildEndTimeAllBuilders._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureBuildDuration">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildDuration</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildDuration" title="Permalink to this definition">¶</a></dt>
<dd><p>A capture class for capturing build duration.
Takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>(str) The name of builder whose times are to be recorded.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">report_in='seconds'</span></code></dt>
<dd>Can be one of three: <code class="docutils literal notranslate"><span class="pre">'seconds'</span></code>, <code class="docutils literal notranslate"><span class="pre">'minutes'</span></code>, or <code class="docutils literal notranslate"><span class="pre">'hours'</span></code>.
This is the units in which the build time will be reported.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function for this class.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information.</p>
<p>The default callback:</p>
<blockquote class="last">
<div><dl class="function">
<dt id="buildbot.statistics.capture.CaptureBuildDuration.default_callback">
<code class="descname">default_callback</code><span class="sig-paren">(</span><em>start_time</em>, <em>end_time</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildDuration.default_callback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>It returns the duration of the build as per the <code class="docutils literal notranslate"><span class="pre">report_in</span></code> argument.
It receives the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">start_time</span></code></dt>
<dd>A python datetime object that denotes the build start time.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">end_time</span></code></dt>
<dd>A python datetime object that denotes the build end time.</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildDuration._retValParams">
<code class="descname">_retValParams</code><span class="sig-paren">(</span><em>self</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildDuration._retValParams" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Returns a list containing one Python datetime object (end time) from <code class="docutils literal notranslate"><span class="pre">msg</span></code> dictionary.</p>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildDuration._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildDuration._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureBuildDurationAllBuilders">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureBuildDurationAllBuilders</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildDurationAllBuilders" title="Permalink to this definition">¶</a></dt>
<dd><p>A capture class for capturing build durations from all builders.
It is a subclass of <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildDuration</span></code>.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function for this class.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more.</p>
<p>The default callback:</p>
<blockquote class="last">
<div>See <code class="docutils literal notranslate"><span class="pre">CaptureBuildDuration.__init__</span></code> for the definition.</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureBuildDurationAllBuilders._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureBuildDurationAllBuilders._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureBuildTimes</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureDataBase">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureDataBase</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureDataBase" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a base class for both <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureData</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureDataAllBuilders</span></code> and abstracts away much of the common functionality between the two classes.
Cannot be initialized directly as it contains an abstract method and raises <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> if tried.
It is initialized with the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">data_name</span></code></dt>
<dd>(str) The name of data to be captured.
Same as in <code class="xref py py-meth docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function for this class.</p>
<p>The default callback:</p>
<blockquote class="last">
<div>The default callback takes a value <code class="docutils literal notranslate"><span class="pre">x</span></code> and return it without changing.
As such, <code class="docutils literal notranslate"><span class="pre">x</span></code> itself acts as the <code class="docutils literal notranslate"><span class="pre">post_data</span></code> sent to the storage backends.</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureDataBase.consume">
<code class="descname">consume</code><span class="sig-paren">(</span><em>self</em>, <em>routingKey</em>, <em>msg</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureDataBase.consume" title="Permalink to this definition">¶</a></dt>
<dd><p>The consumer for this class.
See <code class="xref py py-class docutils literal notranslate"><span class="pre">Capture</span></code> for more.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.statistics.capture.CaptureDataBase._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureDataBase._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an abstract method and needs to be implemented by all subclasses of this class.
This is a helper method to the <code class="docutils literal notranslate"><span class="pre">consume</span></code> method mentioned above.
It checks whether a builder is allowed to send properties to the storage backend according to the configuration file.
It takes one argument:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">builder_info</span></code></dt>
<dd>(dict) The dictionary returned by the data API containing the builder information.</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureData">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureData</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureData" title="Permalink to this definition">¶</a></dt>
<dd><p>A capture class for capturing arbitrary data that is not stored as build-data.
See <code class="xref py py-meth docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code> for more.
Takes the following arguments for initialization:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">data_name</span></code></dt>
<dd>(str) The name of data to be captured.
Same as in <code class="xref py py-meth docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">builder_name</span></code></dt>
<dd>(str) The name of the builder on which the data is captured.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd><p class="first">The callback function for this class.</p>
<p>The default callback:</p>
<blockquote class="last">
<div>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureDataBase</span></code> of definition.</div></blockquote>
</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureData._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureData._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureDataBase</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.statistics.capture.CaptureDataAllBuilders">
<em class="property">class </em><code class="descclassname">buildbot.statistics.capture.</code><code class="descname">CaptureDataAllBuilders</code><a class="headerlink" href="#buildbot.statistics.capture.CaptureDataAllBuilders" title="Permalink to this definition">¶</a></dt>
<dd><p>A capture class to capture arbitrary data on all builders.
See <code class="xref py py-meth docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code> for more.
It takes the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">data_name</span></code></dt>
<dd>(str) The name of data to be captured.
Same as in <code class="xref py py-meth docutils literal notranslate"><span class="pre">yieldMetricsValue</span></code>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">callback=None</span></code></dt>
<dd>The callback function for this class.</dd>
</dl>
<dl class="method">
<dt id="buildbot.statistics.capture.CaptureDataAllBuilders._builder_name_matches">
<code class="descname">_builder_name_matches</code><span class="sig-paren">(</span><em>self</em>, <em>builder_info</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.statistics.capture.CaptureDataAllBuilders._builder_name_matches" title="Permalink to this definition">¶</a></dt>
<dd><p>See <code class="xref py py-class docutils literal notranslate"><span class="pre">CaptureDataBase</span></code> for more information on this method.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-developer/plugins-publish"></span><div class="section" id="how-to-package-buildbot-plugins">
<h4>3.2.23. How to package Buildbot plugins<a class="headerlink" href="#how-to-package-buildbot-plugins" title="Permalink to this headline">¶</a></h4>
<p>If you customized an existing component (see <a class="reference internal" href="#document-manual/customization"><span class="doc">Customization</span></a>) or created a new component that you believe might be useful for others, you have two options:</p>
<ul class="simple">
<li>submit the change to the Buildbot main tree, however you need to adhere to certain requirements (see <a class="reference internal" href="#document-developer/style"><span class="doc">Buildbot Coding Style</span></a>)</li>
<li>prepare a Python package that contains the functionality you created</li>
</ul>
<p>Here we cover the second option.</p>
<div class="section" id="package-the-source">
<h5>3.2.23.1. Package the source<a class="headerlink" href="#package-the-source" title="Permalink to this headline">¶</a></h5>
<p>To begin with, you must package your changes.
If you do not know what a Python package is, these two tutorials will get you going:</p>
<ul class="simple">
<li><a class="reference external" href="https://packaging.python.org/en/latest/">Python Packaging User Guide</a></li>
<li><a class="reference external" href="https://the-hitchhikers-guide-to-packaging.readthedocs.org/en/latest/">The Hitchhiker’s Guide to Packaging</a></li>
</ul>
<p>The former is more recent and, while it addresses everything that you need to know about Python packages, is still work in progress.
The latter is a bit dated, though it was the most complete guide for quite some time available for Python developers looking to package their software.</p>
<p>You may also want to check the <a class="reference external" href="https://github.com/pypa/sampleproject">sample project</a>, which exemplifies the best Python packaging practices.</p>
</div>
<div class="section" id="making-the-plugin-package">
<h5>3.2.23.2. Making the plugin package<a class="headerlink" href="#making-the-plugin-package" title="Permalink to this headline">¶</a></h5>
<p>Buildbot supports several kinds of pluggable components:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">worker</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">changes</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">schedulers</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">steps</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">status</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">util</span></code></li>
</ul>
<p>(these are described in <a class="reference internal" href="#document-manual/plugins"><span class="doc">Plugin Infrastructure in Buildbot</span></a>), and</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">www</span></code></li>
</ul>
<p>which is described in <a class="reference internal" href="#document-manual/configuration/www"><span class="doc">web server configuration</span></a>.</p>
<p>Once you have your component packaged, it’s quite straightforward: you just need to add a few lines to the <code class="docutils literal notranslate"><span class="pre">entry_points</span></code> parameter of your call of <code class="docutils literal notranslate"><span class="pre">setup</span></code> function in <code class="file docutils literal notranslate"><span class="pre">setup.py</span></code> file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="p">(</span>
    <span class="o">...</span>
    <span class="n">entry_points</span> <span class="o">=</span> <span class="p">{</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="s1">&#39;buildbot.kind&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s1">&#39;PluginName = PluginModule:PluginClass&#39;</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>(You might have seen different ways to specify the value for <code class="docutils literal notranslate"><span class="pre">entry_points</span></code>, however they all do the same thing.
Full description of possible ways is available in <a class="reference external" href="https://setuptools.readthedocs.io/en/latest/setuptools.html#dynamic-discovery-of-services-and-plugins">setuptools documentation</a>.)</p>
<p>After the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/setup.py">setup.py</a> file is updated, you can build and install it:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python setup.py build
$ sudo python setup.py install
</pre></div>
</div>
<p>(depending on your particular setup, you might not need to use <strong class="command">sudo</strong>).</p>
<p>After that the plugin should be available for Buildbot and you can use it in your <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code> as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.kind</span> <span class="kn">import</span> <span class="n">PluginName</span>

<span class="o">...</span> <span class="n">PluginName</span> <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="publish-the-package">
<h5>3.2.23.3. Publish the package<a class="headerlink" href="#publish-the-package" title="Permalink to this headline">¶</a></h5>
<p>This is the last step before the plugin is available to others.</p>
<p>Once again, there is a number of options available for you:</p>
<ul class="simple">
<li>just put a link to your version control system</li>
<li>prepare a source tarball with the plugin (<code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">sdist</span></code>)</li>
<li>or publish it on <a class="reference external" href="https://pypi.python.org">PyPI</a></li>
</ul>
<p>The last option is probably the best one since it will make your plugin available pretty much to all Python developers.</p>
<p>Once you have published the package, please send a link to <a class="reference external" href="mailto:buildbot-devel&#37;&#52;&#48;lists&#46;sourceforge&#46;net">buildbot-devel</a> mailing list, so we can include a link to your plugin to <a class="reference internal" href="#document-manual/plugins"><span class="doc">Plugin Infrastructure in Buildbot</span></a>.</p>
</div>
</div>
</div>
</div>
<span id="document-developer/apis"></span><div class="section" id="apis">
<h3>3.3. APIs<a class="headerlink" href="#apis" title="Permalink to this headline">¶</a></h3>
<p>This section documents Buildbot’s APIs.
These are the interfaces against which externally-maintained code should be written.</p>
<div class="toctree-wrapper compound">
<span id="document-developer/rest"></span><div class="section" id="rest-api">
<span id="id1"></span><h4>3.3.1. REST API<a class="headerlink" href="#rest-api" title="Permalink to this headline">¶</a></h4>
<p>The REST API is a thin wrapper around the data API’s “Getter” and “Control” sections.
It is also designed, in keeping with REST principles, to be discoverable.
As such, the details of the paths and resources are not documented here.
Begin at the root URL, and see the <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a> documentation for more information.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#versions" id="id31">Versions</a></li>
<li><a class="reference internal" href="#getting" id="id32">Getting</a></li>
<li><a class="reference internal" href="#collections" id="id33">Collections</a><ul>
<li><a class="reference internal" href="#field-selection" id="id34">Field Selection</a></li>
<li><a class="reference internal" href="#filtering" id="id35">Filtering</a></li>
<li><a class="reference internal" href="#sorting" id="id36">Sorting</a></li>
<li><a class="reference internal" href="#pagination" id="id37">Pagination</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controlling" id="id38">Controlling</a></li>
<li><a class="reference internal" href="#authentication" id="id39">Authentication</a></li>
<li><a class="reference internal" href="#raml-specs" id="id40">Raml Specs</a><ul>
<li><a class="reference internal" href="#build" id="id41">Build</a><ul>
<li><a class="reference internal" href="#update-methods" id="id42">Update Methods</a></li>
<li><a class="reference internal" href="#endpoints" id="id43">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#builder" id="id44">builder</a><ul>
<li><a class="reference internal" href="#id3" id="id45">Update Methods</a></li>
<li><a class="reference internal" href="#id4" id="id46">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#buildrequest" id="id47">buildrequest</a><ul>
<li><a class="reference internal" href="#id5" id="id48">Update Methods</a></li>
<li><a class="reference internal" href="#id6" id="id49">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#buildset" id="id50">buildset</a><ul>
<li><a class="reference internal" href="#id7" id="id51">Update Methods</a></li>
<li><a class="reference internal" href="#id8" id="id52">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change" id="id53">change</a><ul>
<li><a class="reference internal" href="#id9" id="id54">Update Methods</a></li>
<li><a class="reference internal" href="#id10" id="id55">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changesource" id="id56">changesource</a><ul>
<li><a class="reference internal" href="#id11" id="id57">Update Methods</a></li>
<li><a class="reference internal" href="#id12" id="id58">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#forcescheduler" id="id59">forcescheduler</a><ul>
<li><a class="reference internal" href="#id13" id="id60">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#identifier" id="id61">identifier</a></li>
<li><a class="reference internal" href="#logs" id="id62">Logs</a><ul>
<li><a class="reference internal" href="#id14" id="id63">Update Methods</a></li>
<li><a class="reference internal" href="#id15" id="id64">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#logchunk" id="id65">logchunk</a><ul>
<li><a class="reference internal" href="#id16" id="id66">Update Methods</a></li>
<li><a class="reference internal" href="#id17" id="id67">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#master" id="id68">master</a><ul>
<li><a class="reference internal" href="#id18" id="id69">Update Methods</a></li>
<li><a class="reference internal" href="#id19" id="id70">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#patch" id="id71">patch</a><ul>
<li><a class="reference internal" href="#id20" id="id72">Update Methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rootlink" id="id73">rootlink</a><ul>
<li><a class="reference internal" href="#id21" id="id74">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#scheduler" id="id75">scheduler</a><ul>
<li><a class="reference internal" href="#id22" id="id76">Update Methods</a></li>
<li><a class="reference internal" href="#id23" id="id77">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sourcedproperties" id="id78">sourcedproperties</a><ul>
<li><a class="reference internal" href="#id24" id="id79">Update Methods</a></li>
<li><a class="reference internal" href="#id25" id="id80">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sourcestamp" id="id81">sourcestamp</a><ul>
<li><a class="reference internal" href="#id26" id="id82">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spec" id="id83">spec</a><ul>
<li><a class="reference internal" href="#id27" id="id84">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#step" id="id85">step</a><ul>
<li><a class="reference internal" href="#id28" id="id86">Update Methods</a></li>
<li><a class="reference internal" href="#id29" id="id87">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#worker" id="id88">worker</a><ul>
<li><a class="reference internal" href="#id30" id="id89">Endpoints</a></li>
</ul>
</li>
<li><a class="reference internal" href="#raw-endpoints" id="id90">Raw endpoints</a></li>
<li><a class="reference internal" href="#raml-spec-verbatim" id="id91">Raml spec verbatim</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="versions">
<h5><a class="toc-backref" href="#id31">3.3.1.1. Versions</a><a class="headerlink" href="#versions" title="Permalink to this headline">¶</a></h5>
<p>The API described here is version 2.
The ad-hoc API from Buildbot-0.8.x, version 1, is no longer supported <a class="footnote-reference" href="#apiv1" id="id2">[1]</a>.</p>
<p>The policy for incrementing the version is when there is incompatible change added.
Removing a field or endpoint is considered incompatible change.
Adding a field or endpoint is not considered incompatible, and thus will only be described as a change in release note.
The policy is that we will avoid as much as possible incrementing version.</p>
<table class="docutils footnote" frame="void" id="apiv1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>The JSON API defined by <code class="docutils literal notranslate"><span class="pre">status_json.py</span></code> in Buildbot-0.8.x is considered version 1, although its root path was <code class="docutils literal notranslate"><span class="pre">json</span></code>, not <code class="docutils literal notranslate"><span class="pre">api/v1</span></code>.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="getting">
<h5><a class="toc-backref" href="#id32">3.3.1.2. Getting</a><a class="headerlink" href="#getting" title="Permalink to this headline">¶</a></h5>
<p>To get data, issue a GET request to the appropriate path.
For example, with a base URL of <code class="docutils literal notranslate"><span class="pre">http://build.example.org/buildbot</span></code>, the list of masters for builder 9 is available at <code class="docutils literal notranslate"><span class="pre">http://build.example.org/buildbot/api/v2/builder/9/master</span></code>.</p>
<dl class="rtype" id="rtype-collection">
<dt>
<em class="property">resource type: </em><code class="descname">collection</code></dt>
<dd></dd></dl>

</div>
<div class="section" id="collections">
<h5><a class="toc-backref" href="#id33">3.3.1.3. Collections</a><a class="headerlink" href="#collections" title="Permalink to this headline">¶</a></h5>
<p>Results are formatted in keeping with the <a class="reference external" href="http://jsonapi.org/">JSON API</a> specification.
The top level of every response is an object.
Its keys are the plural names of the resource types, and the values are lists of objects, even for a single-resource request.
For example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;meta&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;total&quot;</span><span class="p">:</span> <span class="mi">2</span>
  <span class="p">},</span>
  <span class="nt">&quot;schedulers&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;master&quot;</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;smoketest&quot;</span><span class="p">,</span>
      <span class="nt">&quot;schedulerid&quot;</span><span class="p">:</span> <span class="mi">1</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="nt">&quot;master&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;active&quot;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nt">&quot;last_active&quot;</span><span class="p">:</span> <span class="mi">1369604067</span><span class="p">,</span>
        <span class="nt">&quot;link&quot;</span><span class="p">:</span> <span class="s2">&quot;http://build.example.org/api/v2/master/1&quot;</span><span class="p">,</span>
        <span class="nt">&quot;masterid&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;master3:/BB/master&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;goaheadtryme&quot;</span><span class="p">,</span>
      <span class="nt">&quot;schedulerid&quot;</span><span class="p">:</span> <span class="mi">2</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A response may optionally contain extra, related resources beyond those requested.
The <code class="docutils literal notranslate"><span class="pre">meta</span></code> key contains metadata about the response, including the total count of resources in a collection.</p>
<p>Several query parameters may be used to affect the results of a request.
These parameters are applied in the order described (so, it is not possible to sort on a field that is not selected, for example).</p>
<div class="section" id="field-selection">
<h6><a class="toc-backref" href="#id34">Field Selection</a><a class="headerlink" href="#field-selection" title="Permalink to this headline">¶</a></h6>
<p>If only certain fields of each resource are required, the <code class="docutils literal notranslate"><span class="pre">field</span></code> query parameter can be used to select them.
For example, the following will select just the names and id’s of all schedulers:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">http://build.example.org/api/v2/scheduler?field=name&amp;field=schedulerid</span></code></li>
</ul>
<p>Field selection can be used for either detail (single-entity) or collection (multi-entity) requests.
The remaining options only apply to collection requests.</p>
</div>
<div class="section" id="filtering">
<h6><a class="toc-backref" href="#id35">Filtering</a><a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h6>
<p>Collection responses may be filtered on any simple top-level field.</p>
<p>To select records with a specific value use the query parameter <code class="docutils literal notranslate"><span class="pre">{field}={value}</span></code>.
For example, <code class="docutils literal notranslate"><span class="pre">http://build.example.org/api/v2/scheduler?name=smoketest</span></code> selects the scheduler named “smoketest”.</p>
<p>Filters can use any of the operators listed below, with query parameters of the form <code class="docutils literal notranslate"><span class="pre">{field}__{operator}={value}</span></code>.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">eq</span></code></dt>
<dd>equality, or with the same parameter appearing multiple times, equality with one of the given values (so <cite>foo__eq=x&amp;foo__eq=y</cite> would match resources where foo is <cite>x</cite> or <cite>y</cite>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ne</span></code></dt>
<dd>inequality, or set exclusion</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lt</span></code></dt>
<dd>select resources where the field’s value is less than <code class="docutils literal notranslate"><span class="pre">{value}</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">le</span></code></dt>
<dd>select resources where the field’s value is less than or equal to <code class="docutils literal notranslate"><span class="pre">{value}</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">gt</span></code></dt>
<dd>select resources where the field’s value is greater than <code class="docutils literal notranslate"><span class="pre">{value}</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">ge</span></code></dt>
<dd>select resources where the field’s value is greater than or equal to <code class="docutils literal notranslate"><span class="pre">{value}</span></code></dd>
<dt><code class="docutils literal notranslate"><span class="pre">contains</span></code></dt>
<dd>Select resources where the field’s value contains <code class="docutils literal notranslate"><span class="pre">{value}</span></code>.
If the parameter is provided multiple times, results containing at least one of the values are returned (so <cite>foo__contains=x&amp;foo__contains=y</cite> would match resources where foo contains <cite>x</cite>, <cite>y</cite> or both).</dd>
</dl>
<p>For example:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">http://build.example.org/api/v2/builder?name__lt=cccc</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">http://build.example.org/api/v2/buildsets?complete__eq=false</span></code></li>
</ul>
<p>Boolean values can be given as <code class="docutils literal notranslate"><span class="pre">on</span></code>/<code class="docutils literal notranslate"><span class="pre">off</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code>/<code class="docutils literal notranslate"><span class="pre">false</span></code>, <code class="docutils literal notranslate"><span class="pre">yes</span></code>/<code class="docutils literal notranslate"><span class="pre">no</span></code>, or <code class="docutils literal notranslate"><span class="pre">1</span></code>/<code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</div>
<div class="section" id="sorting">
<h6><a class="toc-backref" href="#id36">Sorting</a><a class="headerlink" href="#sorting" title="Permalink to this headline">¶</a></h6>
<p>Collection responses may be ordered with the <code class="docutils literal notranslate"><span class="pre">order</span></code> query parameter.
This parameter takes a field name to sort on, optionally prefixed with <code class="docutils literal notranslate"><span class="pre">-</span></code> to reverse the sort.
The parameter can appear multiple times, and will be sorted lexically with the fields arranged in the given order.
For example:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">http://build.example.org/api/v2/buildrequest?order=builderid&amp;order=buildrequestid</span></code></li>
</ul>
</div>
<div class="section" id="pagination">
<h6><a class="toc-backref" href="#id37">Pagination</a><a class="headerlink" href="#pagination" title="Permalink to this headline">¶</a></h6>
<p>Collection responses may be paginated with the <code class="docutils literal notranslate"><span class="pre">offset</span></code> and <code class="docutils literal notranslate"><span class="pre">limit</span></code> query parameters.
The offset is the 0-based index of the first result to included, after filtering and sorting.
The limit is the maximum number of results to return.
Some resource types may impose a maximum on the limit parameter; be sure to check the resulting links to determine whether further data is available.
For example:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">http://build.example.org/api/v2/buildrequest?order=builderid&amp;limit=10</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">http://build.example.org/api/v2/buildrequest?order=builderid&amp;offset=20&amp;limit=10</span></code></li>
</ul>
</div>
</div>
<div class="section" id="controlling">
<h5><a class="toc-backref" href="#id38">3.3.1.4. Controlling</a><a class="headerlink" href="#controlling" title="Permalink to this headline">¶</a></h5>
<p>Data API control operations are handled by POST requests using a simplified form of <a class="reference external" href="http://www.jsonrpc.org/specification">JSONRPC 2.0</a>.
The JSONRPC “method” is mapped to the data API “action”, and the parameters are passed to that application.</p>
<p>The following parts of the protocol are not supported:</p>
<ul class="simple">
<li>positional parameters</li>
<li>batch requests</li>
</ul>
<p>Requests are sent as an HTTP POST, containing the request JSON in the body.
The content-type header must be <code class="docutils literal notranslate"><span class="pre">application/json</span></code>.</p>
<p>A simple example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>POST http://build.example.org/api/v2/scheduler/4
--&gt; {&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;force&quot;, &quot;params&quot;: {&quot;revision&quot;: &quot;abcd&quot;, &quot;branch&quot;: &quot;dev&quot;}, &quot;id&quot;: 843}
&lt;-- {&quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;result&quot;: {&quot;buildsetid&quot;: 44}, &quot;id&quot;: 843}
</pre></div>
</div>
</div>
<div class="section" id="authentication">
<h5><a class="toc-backref" href="#id39">3.3.1.5. Authentication</a><a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h5>
<p>Authentication to the REST API is performed in the same manner as authentication to the main web interface.  Once credentials have been established, a cookie will be set, which must be sent to the buildbot REST API with every request thereafter.  For those buildbot instances using OAuth2 authentication providers, access tokens can be used for automated access.  For example, GitHub’s personal access tokens can be used to access the buildbot as a github user without needing to store the username and password of the user.  To use an OAuth2 access token, send a <cite>GET</cite> request to the <cite>/auth/login</cite> with the <cite>token</cite> URL parameter set to the access token that the OAuth2 provider has given you.  A <cite>python</cite> example using <cite>requests</cite> is shown below, where we first authenticate with our OAuth2 access token, and then are able to request otherwise shielded endpoints:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://&lt;buildbot_url&gt;/auth/login&quot;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">OAUTH_TOKEN</span><span class="p">})</span>
<span class="n">builders</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://&lt;buildbot_url&gt;/api/v2/builders&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="raml-specs">
<span id="raml-spec"></span><h5><a class="toc-backref" href="#id40">3.3.1.6. Raml Specs</a><a class="headerlink" href="#raml-specs" title="Permalink to this headline">¶</a></h5>
<p>The Data API is documented in <a class="reference external" href="https://github.com/raml-org/raml-spec/blob/master/versions/raml-10/raml-10.md">RAML 1.0 format</a>.
RAML describes and documents all our data, rest, and javascript APIs in a format that can be easily manipulated by human and machines.</p>
<div class="section" id="build">
<h6><a class="toc-backref" href="#id41">Build</a><a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-build">
<dt>
<em class="property">resource type: </em><code class="descname">build</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>integer</em>) – the unique ID of this build</li>
<li><strong>number</strong> (<em>integer</em>) – the number of this build (sequential for a given builder)</li>
<li><strong>builderid</strong> (<em>integer</em>) – id of the builder for this build</li>
<li><strong>buildrequestid</strong> (<em>integer</em>) – build request for which this build was performed, or None if no such request exists</li>
<li><strong>workerid</strong> (<em>integer</em>) – the worker this build ran on</li>
<li><strong>masterid</strong> (<em>integer</em>) – the master this build ran on</li>
<li><strong>started_at</strong> (<em>date</em>) – time at which this build started</li>
<li><strong>complete</strong> (<em>boolean</em>) – true if this build is complete
Note that this is a calculated field (from complete_at != None).
Ordering by this field is not optimized by the database layer.</li>
<li><strong>complete_at?</strong> (<em>date</em>) – time at which this build was complete, or None if it’s still running</li>
<li><strong>properties?</strong> (<em>sourcedproperties</em>) – a dictionary of properties attached to build.</li>
<li><strong>results?</strong> (<em>integer</em>) – the results of the build (see <a class="reference internal" href="#build-result-codes"><span class="std std-ref">Build Result Codes</span></a>), or None if not complete</li>
<li><strong>state_string</strong> (<em>string</em>) – a string giving detail on the state of the build.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">example</span></code></p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;builderid&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s2">&quot;buildid&quot;</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s2">&quot;buildrequestid&quot;</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="s2">&quot;workerid&quot;</span><span class="o">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s2">&quot;complete&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">&quot;complete_at&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;masterid&quot;</span><span class="o">:</span> <span class="mi">824</span><span class="p">,</span>
    <span class="s2">&quot;number&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;results&quot;</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="s2">&quot;started_at&quot;</span><span class="o">:</span> <span class="mi">1451001600</span><span class="p">,</span>
    <span class="s2">&quot;state_string&quot;</span><span class="o">:</span> <span class="s2">&quot;created&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="o">:</span> <span class="p">{}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>This resource type describes completed and in-progress builds.
Much of the contextual data for a build is associated with the build request, and through it the buildset.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><em>properties</em></p>
<p>This properties dict is only filled out if the <cite>properties filterspec</cite> is set.</p>
<p>Meaning that, <cite>property filter</cite> allows one to request the Builds DATA API like so:</p>
<blockquote>
<div><ul class="simple">
<li>api/v2/builds?property=propKey1&amp;property=propKey2 (returns Build’s properties which match given keys)</li>
<li>api/v2/builds?property=* (returns all Build’s properties)</li>
<li>api/v2/builds?propKey1&amp;property=propKey2&amp;limit=30 (filters combination)</li>
</ul>
</div></blockquote>
<div class="last admonition important">
<p class="first admonition-title">Important</p>
<p>When combined with <code class="docutils literal notranslate"><span class="pre">field</span></code> filter, to get properties, one should ensure <strong>properties</strong> <code class="docutils literal notranslate"><span class="pre">field</span></code> is set.</p>
<ul class="last simple">
<li>api/v2/builds?field=buildid&amp;field=properties&amp;property=workername&amp;property=user</li>
</ul>
</div>
</div>
<div class="section" id="update-methods">
<h7><a class="toc-backref" href="#id42">Update Methods</a><a class="headerlink" href="#update-methods" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.builds.Build">
<em class="property">class </em><code class="descclassname">buildbot.data.builds.</code><code class="descname">Build</code><a class="headerlink" href="#buildbot.data.builds.Build" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.builds.Build.newBuild">
<code class="descname">newBuild</code><span class="sig-paren">(</span><em>builderid</em>, <em>buildrequestid</em>, <em>workerid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.builds.Build.newBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>builderid</strong> (<em>integer</em>) – builder performing this build</li>
<li><strong>buildrequstid</strong> (<em>integer</em>) – build request being built</li>
<li><strong>workerid</strong> (<em>integer</em>) – worker on which this build is performed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(buildid, number) via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Create a new build resource and return its ID.
The state strings for the new build will be set to ‘starting’.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.builds.Build.setBuildStateString">
<code class="descname">setBuildStateString</code><span class="sig-paren">(</span><em>buildid</em>, <em>state_string</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.builds.Build.setBuildStateString" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>integer</em>) – the build to modify</li>
<li><strong>state_string</strong> (<em>unicode</em>) – new state string for this build</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Replace the existing state strings for a build with a new list.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.builds.Build.finishBuild">
<code class="descname">finishBuild</code><span class="sig-paren">(</span><em>buildid</em>, <em>results</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.builds.Build.finishBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>integer</em>) – the build to modify</li>
<li><strong>results</strong> (<em>integer</em>) – the build’s results</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Mark the build as finished at the current time, with the given results.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="endpoints">
<h7><a class="toc-backref" href="#id43">Endpoints</a><a class="headerlink" href="#endpoints" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all builds for a builder (can return lots of data!)</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-build" title="build"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">build</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects a specific build by builderid, buildnumber</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-build" title="build"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">build</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="raction" id="raction-/builders/{builderid_or_buildername}/builds/{build_number} (method=stop)">
<dt>
<em class="property">POST with method: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number} (method=stop)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">stop</span></code></li>
<li><strong>reason</strong> (<em>string</em>) – The reason why the build was stopped</li>
<li><strong>results</strong> (<em>integer</em>) – optionally results value override (default CANCELLED)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="raction" id="raction-/builders/{builderid_or_buildername}/builds/{build_number} (method=rebuild)">
<dt>
<em class="property">POST with method: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number} (method=rebuild)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">rebuild</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="rpath" id="rpath-/buildrequests/{buildrequestid}/builds">
<dt>
<em class="property">path: </em><code class="descname">/buildrequests/{buildrequestid}/builds</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>buildrequestid</strong> (<em>number</em>) – the id of the buildrequest</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-build" title="build"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">build</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builds">
<dt>
<em class="property">path: </em><code class="descname">/builds</code></dt>
<dd></dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-build" title="build"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">build</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builds/{buildid}">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>buildid</strong> (<em>number</em>) – the id of the build</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects a build by id</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-build" title="build"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">build</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="raction" id="raction-/builds/{buildid} (method=stop)">
<dt>
<em class="property">POST with method: </em><code class="descname">/builds/{buildid} (method=stop)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">stop</span></code></li>
<li><strong>reason</strong> (<em>string</em>) – The reason why the build was stopped</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="raction" id="raction-/builds/{buildid} (method=rebuild)">
<dt>
<em class="property">POST with method: </em><code class="descname">/builds/{buildid} (method=rebuild)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">rebuild</span></code></td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="builder">
<h6><a class="toc-backref" href="#id44">builder</a><a class="headerlink" href="#builder" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-builder">
<dt>
<em class="property">resource type: </em><code class="descname">builder</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>builderid</strong> (<em>integer</em>) – the ID of this builder</li>
<li><strong>description?</strong> (<em>string</em>) – The description for that builder</li>
<li><strong>masterids[]</strong> (<em>integer</em>) – the ID of the masters this builder is running on</li>
<li><strong>name</strong> (<em>identifier</em>) – builder name</li>
<li><strong>tags[]</strong> (<em>string</em>) – list of tags for this builder</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This resource type describes a builder.</p>
<div class="section" id="id3">
<h7><a class="toc-backref" href="#id45">Update Methods</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.builders.Builder">
<em class="property">class </em><code class="descclassname">buildbot.data.builders.</code><code class="descname">Builder</code><a class="headerlink" href="#buildbot.data.builders.Builder" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.builders.Builder.updateBuilderList">
<code class="descname">updateBuilderList</code><span class="sig-paren">(</span><em>masterid</em>, <em>builderNames</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.builders.Builder.updateBuilderList" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>masterid</strong> (<em>integer</em>) – this master’s master ID</li>
<li><strong>builderNames</strong> (<em>list</em>) – list of names of currently-configured builders (unicode strings)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Record the given builders as the currently-configured set of builders on this master.
Masters should call this every time the list of configured builders changes.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id4">
<h7><a class="toc-backref" href="#id46">Endpoints</a><a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders">
<dt>
<em class="property">path: </em><code class="descname">/builders</code></dt>
<dd></dd></dl>

<p>This path selects all builders</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-builder" title="builder"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">builder</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects a builder by builderid</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-builder" title="builder"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">builder</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/builders">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/builders</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>masterid</strong> (<em>number</em>) – the id of the master</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all builders of a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-builder" title="builder"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">builder</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/builders/{builderid}">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/builders/{builderid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>masterid</strong> (<em>number</em>) – the id of the master</li>
<li><strong>builderid</strong> (<em>number</em>) – the id of the builder</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one builder by id of a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-builder" title="builder"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">builder</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="buildrequest">
<h6><a class="toc-backref" href="#id47">buildrequest</a><a class="headerlink" href="#buildrequest" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-buildrequest">
<dt>
<em class="property">resource type: </em><code class="descname">buildrequest</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildrequestid</strong> (<em>integer</em>) – the unique ID of this buildrequest</li>
<li><strong>builderid</strong> (<em>integer</em>) – the id of the builder linked to this buildrequest</li>
<li><strong>buildsetid</strong> (<em>integer</em>) – the id of the buildset that contains this buildrequest</li>
<li><strong>claimed</strong> (<em>boolean</em>) – True if this buildrequest has been claimed.
Note that this is a calculated field (from claimed_at != None).
Ordering by this field is not optimized by the database layer.</li>
<li><strong>claimed_at?</strong> (<em>date</em>) – time at which this build has last been claimed.
None if this buildrequest has never been claimed or has been unclaimed</li>
<li><strong>claimed_by_masterid?</strong> (<em>integer</em>) – the id of the master that claimed this buildrequest.
None if this buildrequest has never been claimed or has been unclaimed</li>
<li><strong>complete</strong> (<em>boolean</em>) – true if this buildrequest is complete</li>
<li><strong>complete_at?</strong> (<em>date</em>) – time at which this buildrequest was completed, or None if it’s still running</li>
<li><strong>priority</strong> (<em>integer</em>) – the priority of this buildrequest</li>
<li><strong>properties?</strong> (<em>sourcedproperties</em>) – a dictionary of properties corresponding to buildrequest.</li>
<li><strong>results?</strong> (<em>integer</em>) – the results of this buildrequest (see <a class="reference internal" href="#build-result-codes"><span class="std std-ref">Build Result Codes</span></a>), or None if not complete</li>
<li><strong>submitted_at</strong> (<em>date</em>) – time at which this buildrequest were submitted</li>
<li><strong>waited_for</strong> (<em>boolean</em>) – True if the entity that triggered this buildrequest is waiting for it to complete.
Should be used by an (unimplemented so far) clean shutdown to only start br that are waited_for.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This resource type describes completed and in-progress buildrequests.
Much of the contextual data for a buildrequest is associated with the buildset that contains this buildrequest.</p>
<div class="section" id="id5">
<h7><a class="toc-backref" href="#id48">Update Methods</a><a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.buildrequests.BuildRequest">
<em class="property">class </em><code class="descclassname">buildbot.data.buildrequests.</code><code class="descname">BuildRequest</code><a class="headerlink" href="#buildbot.data.buildrequests.BuildRequest" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.buildrequests.BuildRequest.claimBuildRequests">
<code class="descname">claimBuildRequests</code><span class="sig-paren">(</span><em>brids</em>, <em>claimed_at=None</em>, <em>_reactor=twisted.internet.reactor</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.buildrequests.BuildRequest.claimBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>brids</strong> (<em>list</em><em>(</em><em>integer</em><em>)</em>) – list of buildrequest id to claim</li>
<li><strong>claimed_at</strong> (<em>datetime</em>) – date and time when the buildrequest is claimed</li>
<li><strong>_reactor</strong> (<em>twisted.internet.interfaces.IReactorTime</em>) – reactor used to get current time if <code class="docutils literal notranslate"><span class="pre">claimed_at</span></code> is None</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(boolean) whether claim succeeded or not</p>
</td>
</tr>
</tbody>
</table>
<p>Claim a list of buildrequests</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.buildrequests.BuildRequest.unclaimBuildRequests">
<code class="descname">unclaimBuildRequests</code><span class="sig-paren">(</span><em>brids</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.buildrequests.BuildRequest.unclaimBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>brids</strong> (<em>list</em><em>(</em><em>integer</em><em>)</em>) – list of buildrequest id to unclaim</td>
</tr>
</tbody>
</table>
<p>Unclaim a list of buildrequests</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.buildrequests.BuildRequest.completeBuildRequests">
<code class="descname">completeBuildRequests</code><span class="sig-paren">(</span><em>brids</em>, <em>results</em>, <em>complete_at=None</em>, <em>_reactor=twisted.internet.reactor</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.buildrequests.BuildRequest.completeBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>brids</strong> (<em>list</em><em>(</em><em>integer</em><em>)</em>) – list of buildrequest id to complete</li>
<li><strong>results</strong> (<em>integer</em>) – the results of the buildrequest (see <a class="reference internal" href="#build-result-codes"><span class="std std-ref">Build Result Codes</span></a>)</li>
<li><strong>complete_at</strong> (<em>datetime</em>) – date and time when the buildrequest is completed</li>
<li><strong>_reactor</strong> (<em>twisted.internet.interfaces.IReactorTime</em>) – reactor used to get current time, if <code class="docutils literal notranslate"><span class="pre">complete_at</span></code> is None</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Complete a list of buildrequest with the <code class="docutils literal notranslate"><span class="pre">results</span></code> status</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id6">
<h7><a class="toc-backref" href="#id49">Endpoints</a><a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/buildrequests">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/buildrequests</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all buildrequests for a given builder (can return lots of data!)</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-buildrequest" title="buildrequest"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildrequest</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/buildrequests">
<dt>
<em class="property">path: </em><code class="descname">/buildrequests</code></dt>
<dd></dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-buildrequest" title="buildrequest"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildrequest</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/buildrequests/{buildrequestid}">
<dt>
<em class="property">path: </em><code class="descname">/buildrequests/{buildrequestid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>buildrequestid</strong> (<em>number</em>) – the id of the buildrequest</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-buildrequest" title="buildrequest"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildrequest</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="raction" id="raction-/buildrequests/{buildrequestid} (method=cancel)">
<dt>
<em class="property">POST with method: </em><code class="descname">/buildrequests/{buildrequestid} (method=cancel)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">cancel</span></code></li>
<li><strong>reason</strong> (<em>string</em>) – The reason why the buildrequest was cancelled</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="buildset">
<h6><a class="toc-backref" href="#id50">buildset</a><a class="headerlink" href="#buildset" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-buildset">
<dt>
<em class="property">resource type: </em><code class="descname">buildset</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>bsid</strong> (<em>integer</em>) – the ID of this buildset</li>
<li><strong>complete</strong> (<em>boolean</em>) – true if all of the build requests in this buildset are complete</li>
<li><strong>complete_at?</strong> (<em>integer</em>) – the time this buildset was completed, or None if not complete</li>
<li><strong>external_idstring?</strong> (<em>string</em>) – an identifier that external applications can use to identify a submitted buildset; can be None</li>
<li><strong>parent_buildid?</strong> (<em>integer</em>) – optional build id that is the parent for this buildset</li>
<li><strong>parent_relationship?</strong> (<em>string</em>) – relationship identifier for the parent, this is a configured relationship between the parent build, and the childs buildsets</li>
<li><strong>reason</strong> (<em>string</em>) – the reason this buildset was scheduled</li>
<li><strong>results?</strong> (<em>integer</em>) – the results of the buildset (see <a class="reference internal" href="#build-result-codes"><span class="std std-ref">Build Result Codes</span></a>), or None if not complete</li>
<li><strong>sourcestamps[]</strong> (<em>sourcestamp</em>) – the sourcestamps for this buildset; each element is a valid <a class="reference internal" href="#rtype-sourcestamp" title="sourcestamp"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">sourcestamp</span></code></a> entity</li>
<li><strong>submitted_at</strong> (<em>integer</em>) – the time this buildset was submitted</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A buildset gathers build requests that were scheduled at the same time, and which share a source stamp, properties, and so on.</p>
<div class="section" id="id7">
<h7><a class="toc-backref" href="#id51">Update Methods</a><a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.buildsets.Buildset">
<em class="property">class </em><code class="descclassname">buildbot.data.buildsets.</code><code class="descname">Buildset</code><a class="headerlink" href="#buildbot.data.buildsets.Buildset" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.buildsets.Buildset.addBuildset">
<code class="descname">addBuildset</code><span class="sig-paren">(</span><em>scheduler=None</em>, <em>sourcestamps=[]</em>, <em>reason=''</em>, <em>properties={}</em>, <em>builderids=[]</em>, <em>external_idstring=None</em>, <em>parent_buildid=None</em>, <em>parent_relationship=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.buildsets.Buildset.addBuildset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>scheduler</strong> (<em>string</em>) – the name of the scheduler creating this buildset</li>
<li><strong>sourcestamps</strong> (<em>list</em>) – sourcestamps for the new buildset; see below</li>
<li><strong>reason</strong> (<em>unicode</em>) – the reason for this build</li>
<li><strong>properties</strong> (<em>dictionary with unicode keys and</em><em> (</em><em>source</em><em>, </em><em>property value</em><em>) </em><em>values</em>) – properties to set on this buildset</li>
<li><strong>builderids</strong> (<em>list</em>) – names of the builderids for which build requests should be created</li>
<li><strong>external_idstring</strong> (<em>unicode</em>) – arbitrary identifier to recognize this buildset later</li>
<li><strong>parent_buildid</strong> (<em>int</em>) – optional build id that is the parent for this buildset</li>
<li><strong>parent_relationship</strong> (<em>unicode</em>) – relationship identifier for the parent, this is a configured relationship between the parent build, and the childs buildsets</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(buildset id, dictionary mapping builder ids to build request ids) via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Create a new buildset and corresponding buildrequests based on the given parameters.
This is the low-level interface for scheduling builds.</p>
<p>Each sourcestamp in the list of sourcestamps can be given either as an integer, assumed to be a sourcestamp ID, or a dictionary of keyword arguments to be passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">findSourceStampId</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.buildsets.Buildset.maybeBuildsetComplete">
<code class="descname">maybeBuildsetComplete</code><span class="sig-paren">(</span><em>bsid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.buildsets.Buildset.maybeBuildsetComplete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bsid</strong> (<em>integer</em>) – buildset that may be complete</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method should be called when a build request is finished.
It checks the given buildset to see if all of its buildrequests are finished.
If so, it updates the status of the buildset and send the appropriate messages.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id8">
<h7><a class="toc-backref" href="#id52">Endpoints</a><a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/buildsets">
<dt>
<em class="property">path: </em><code class="descname">/buildsets</code></dt>
<dd></dd></dl>

<p>this path selects all buildsets</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-buildset" title="buildset"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildset</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/buildsets/{bsid}">
<dt>
<em class="property">path: </em><code class="descname">/buildsets/{bsid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>bsid</strong> (<em>identifier</em>) – the id of the buildset</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>this path selects a buildset by id</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-buildset" title="buildset"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">buildset</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="change">
<h6><a class="toc-backref" href="#id53">change</a><a class="headerlink" href="#change" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-change">
<dt>
<em class="property">resource type: </em><code class="descname">change</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>changeid</strong> (<em>integer</em>) – the ID of this change</li>
<li><strong>author</strong> (<em>string</em>) – the author of the change in “name”, “name &lt;email&gt;” or just “email” (with &#64;) format</li>
<li><strong>branch?</strong> (<em>string</em>) – branch on which the change took place, or none for the “default branch”, whatever that might mean</li>
<li><strong>category?</strong> (<em>string</em>) – user-defined category of this change, or none</li>
<li><strong>codebase</strong> (<em>string</em>) – codebase in this repository</li>
<li><strong>comments</strong> (<em>string</em>) – user comments for this change (aka commit)</li>
<li><strong>files[]</strong> (<em>string</em>) – list of source-code filenames changed</li>
<li><strong>parent_changeids[]</strong> (<em>integer</em>) – The ID of the parents.
The data api allow for several parents, but the core buildbot does not yet support</li>
<li><strong>project</strong> (<em>string</em>) – user-defined project to which this change corresponds</li>
<li><strong>properties</strong> (<em>sourcedproperties</em>) – user-specified properties for this change, represented as an object mapping keys to tuple (value, source)</li>
<li><strong>repository</strong> (<em>string</em>) – repository where this change occurred</li>
<li><strong>revision?</strong> (<em>string</em>) – revision for this change, or none if unknown</li>
<li><strong>revlink?</strong> (<em>string</em>) – link to a web view of this change</li>
<li><strong>sourcestamp</strong> (<em>sourcestamp</em>) – the sourcestamp resource for this change</li>
<li><strong>when_timestamp</strong> (<em>integer</em>) – time of the change</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A change resource represents a change to the source code monitored by Buildbot.</p>
<div class="section" id="id9">
<h7><a class="toc-backref" href="#id54">Update Methods</a><a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.changes.Change">
<em class="property">class </em><code class="descclassname">buildbot.data.changes.</code><code class="descname">Change</code><a class="headerlink" href="#buildbot.data.changes.Change" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.changes.Change.addChange">
<code class="descname">addChange</code><span class="sig-paren">(</span><em>files=None</em>, <em>comments=None</em>, <em>author=None</em>, <em>revision=None</em>, <em>when_timestamp=None</em>, <em>branch=None</em>, <em>category=None</em>, <em>revlink=''</em>, <em>properties={}</em>, <em>repository=''</em>, <em>codebase=None</em>, <em>project=''</em>, <em>src=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.changes.Change.addChange" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>files</strong> (<em>list of unicode strings</em>) – a list of filenames that were changed</li>
<li><strong>comments</strong> (<em>unicode</em>) – user comments on the change</li>
<li><strong>author</strong> (<em>unicode</em>) – the author of this change</li>
<li><strong>revision</strong> (<em>unicode</em>) – the revision identifier for this change</li>
<li><strong>when_timestamp</strong> (<em>integer</em>) – when this change occurred (seconds since the epoch), or the current time if None</li>
<li><strong>branch</strong> (<em>unicode</em>) – the branch on which this change took place</li>
<li><strong>category</strong> (<em>unicode</em>) – category for this change</li>
<li><strong>revlink</strong> (<em>string</em>) – link to a web view of this revision</li>
<li><strong>properties</strong> (<em>dictionary with unicode keys and simple values</em><em> (</em><em>JSON-able</em><em>)</em><em></em>) – properties to set on this change.  Note that the property source is <em>not</em> included in this dictionary.</li>
<li><strong>repository</strong> (<em>unicode</em>) – the repository in which this change took place</li>
<li><strong>project</strong> (<em>unicode</em>) – the project this change is a part of</li>
<li><strong>src</strong> (<em>unicode</em>) – source of the change (vcs or other)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the ID of the new change, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new change to Buildbot.
This method is the interface between change sources and the rest of Buildbot.</p>
<p>All parameters should be passed as keyword arguments.</p>
<p>All parameters labeled ‘unicode’ must be unicode strings and not bytestrings.
Filenames in <code class="docutils literal notranslate"><span class="pre">files</span></code>, and property names, must also be unicode strings.
This is tested by the fake implementation.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id10">
<h7><a class="toc-backref" href="#id55">Endpoints</a><a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builds/{buildid}/changes">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}/changes</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>buildid</strong> (<em>number</em>) – the id of the build</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all changes tested by a build</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-change" title="change"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">change</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/changes">
<dt>
<em class="property">path: </em><code class="descname">/changes</code></dt>
<dd></dd></dl>

<p>This path selects <strong>all</strong> changes.
On a reasonably loaded master, this can quickly return a very large result, taking minutes to process.
A specific query configuration is optimized which allows to get the recent changes: <code class="docutils literal notranslate"><span class="pre">order:-changeid&amp;limit=&lt;n&gt;</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-change" title="change"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">change</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/changes/{changeid}">
<dt>
<em class="property">path: </em><code class="descname">/changes/{changeid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>changeid</strong> (<em>number</em>) – the id of a change</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>this path selects one change by id</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-change" title="change"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">change</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/sourcestamps/{ssid}/changes">
<dt>
<em class="property">path: </em><code class="descname">/sourcestamps/{ssid}/changes</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>ssid</strong> (<em>number</em>) – the id of the sourcestamp</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all changes associated to one sourcestamp</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-change" title="change"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">change</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="changesource">
<h6><a class="toc-backref" href="#id56">changesource</a><a class="headerlink" href="#changesource" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-changesource">
<dt>
<em class="property">resource type: </em><code class="descname">changesource</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>changesourceid</strong> (<em>integer</em>) – the ID of this changesource</li>
<li><strong>master?</strong> (<em>master</em>) – the master on which this worker is running, or None if it is inactive</li>
<li><strong>name</strong> (<em>string</em>) – name of this changesource</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A changesource generates change objects, for example in response to an update in some
repository. A particular changesource (by name) runs on at most one master at a time.</p>
<div class="section" id="id11">
<h7><a class="toc-backref" href="#id57">Update Methods</a><a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.changesources.ChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.data.changesources.</code><code class="descname">ChangeSource</code><a class="headerlink" href="#buildbot.data.changesources.ChangeSource" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.changesources.ChangeSource.findChangeSourceId">
<code class="descname">findChangeSourceId</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.changesources.ChangeSource.findChangeSourceId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> (<em>string</em>) – changesource name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">changesource ID via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the ID for the given changesource name, inventing one if necessary.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.changesources.ChangeSource.trySetChangeSourceMaster">
<code class="descname">trySetChangeSourceMaster</code><span class="sig-paren">(</span><em>changesourceid</em>, <em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.changesources.ChangeSource.trySetChangeSourceMaster" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>changesourceid</strong> (<em>integer</em>) – changesource ID to try to claim</li>
<li><strong>masterid</strong> (<em>integer</em>) – this master’s master ID</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Try to claim the given scheduler for the given master and return <code class="docutils literal notranslate"><span class="pre">True</span></code> if
the scheduler is to be activated on that master.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id12">
<h7><a class="toc-backref" href="#id58">Endpoints</a><a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/changesources">
<dt>
<em class="property">path: </em><code class="descname">/changesources</code></dt>
<dd></dd></dl>

<p>This path selects all changesource.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-changesource" title="changesource"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">changesource</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/changesources/{changesourceid}">
<dt>
<em class="property">path: </em><code class="descname">/changesources/{changesourceid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>changesourceid</strong> (<em>number</em>) – the id of a changesource</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one changesource given its id.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-changesource" title="changesource"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">changesource</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/changesources">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/changesources</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>masterid</strong> (<em>number</em>) – the id of the master</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all changesources for a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-changesource" title="changesource"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">changesource</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/changesources/{changesourceid}">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/changesources/{changesourceid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>masterid</strong> (<em>number</em>) – the id of the master</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one changesource by id for a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-changesource" title="changesource"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">changesource</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="forcescheduler">
<h6><a class="toc-backref" href="#id59">forcescheduler</a><a class="headerlink" href="#forcescheduler" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-forcescheduler">
<dt>
<em class="property">resource type: </em><code class="descname">forcescheduler</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>all_fields[]</strong> (<em>object</em>) – </li>
<li><strong>builder_names[]</strong> (<em>identifier</em>) – names of the builders that this scheduler can trigger</li>
<li><strong>button_name</strong> (<em>string</em>) – label of the button to use in the UI</li>
<li><strong>label</strong> (<em>string</em>) – label of this scheduler to be displayed in the ui</li>
<li><strong>name</strong> (<em>identifier</em>) – name of this scheduler</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A forcescheduler initiates builds, via a formular in the web UI.
At the moment, forceschedulers must be defined on all the masters where a web ui is configured. A particular forcescheduler runs on the master where the web request was sent.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This datatype and associated endpoints will be deprecated when <a class="reference external" href="http://trac.buildbot.net/ticket/2673">bug #2673</a> will be resolved.</p>
</div>
<div class="section" id="id13">
<h7><a class="toc-backref" href="#id60">Endpoints</a><a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/forceschedulers">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/forceschedulers</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all force-schedulers for a given builder</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-forcescheduler" title="forcescheduler"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">forcescheduler</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/forceschedulers">
<dt>
<em class="property">path: </em><code class="descname">/forceschedulers</code></dt>
<dd></dd></dl>

<p>This path selects all forceschedulers.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-forcescheduler" title="forcescheduler"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">forcescheduler</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/forceschedulers/{schedulername}">
<dt>
<em class="property">path: </em><code class="descname">/forceschedulers/{schedulername}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>schedulername</strong> (<em>identifier</em>) – the name of a scheduler</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all changesource.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-forcescheduler" title="forcescheduler"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">forcescheduler</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="raction" id="raction-/forceschedulers/{schedulername} (method=force)">
<dt>
<em class="property">POST with method: </em><code class="descname">/forceschedulers/{schedulername} (method=force)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">force</span></code></li>
<li><strong>owner</strong> (<em>string</em>) – The user who wants to create the buildrequest</li>
<li><strong>[]</strong> – content of the forcescheduler parameter is dependent on the configuration of the forcescheduler</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
<div class="section" id="identifier">
<h6><a class="toc-backref" href="#id61">identifier</a><a class="headerlink" href="#identifier" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-identifier">
<dt>
<em class="property">resource type: </em><code class="descname">identifier</code></dt>
<dd></dd></dl>

</div>
<div class="section" id="logs">
<h6><a class="toc-backref" href="#id62">Logs</a><a class="headerlink" href="#logs" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-log">
<dt>
<em class="property">resource type: </em><code class="descname">log</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>complete</strong> (<em>boolean</em>) – true if this log is complete and will not generate additional logchunks</li>
<li><strong>logid</strong> (<em>integer</em>) – the unique ID of this log</li>
<li><strong>name</strong> (<em>string</em>) – the name of this log (e.g., <code class="docutils literal notranslate"><span class="pre">err.html</span></code>)</li>
<li><strong>num_lines</strong> (<em>integer</em>) – total number of line of this log</li>
<li><strong>slug</strong> (<em>identifier</em>) – the “slug”, suitable for use in a URL, of this log (e.g., <code class="docutils literal notranslate"><span class="pre">err_html</span></code>)</li>
<li><strong>stepid</strong> (<em>integer</em>) – id of the step containing this log</li>
<li><strong>type</strong> (<em>identifier</em>) – log type, identified by a single ASCII letter; see <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a> for details.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p><code class="docutils literal notranslate"><span class="pre">example</span></code></p>
<blockquote>
<div><div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;logid&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;stdio&quot;</span><span class="p">,</span>
    <span class="s2">&quot;slug&quot;</span><span class="o">:</span> <span class="s2">&quot;stdio&quot;</span><span class="p">,</span>
    <span class="s2">&quot;stepid&quot;</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;complete&quot;</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="s2">&quot;num_lines&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;s&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>A log represents a stream of textual output from a step.
The actual output is encoded as a sequence of <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a> resources.
In-progress logs append logchunks as new data is added to the end, and event subscription allows a client to “follow” the log.</p>
<p>Each log has a “slug” which is unique within the step, and which can be used in paths.
The slug is generated by <a class="reference internal" href="#buildbot.data.logs.Log.addLog" title="buildbot.data.logs.Log.addLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addLog</span></code></a> based on the name, using <a class="reference internal" href="#buildbot.util.identifiers.forceIdentifier" title="buildbot.util.identifiers.forceIdentifier"><code class="xref py py-func docutils literal notranslate"><span class="pre">forceIdentifier</span></code></a> and <a class="reference internal" href="#buildbot.util.identifiers.incrementIdentifier" title="buildbot.util.identifiers.incrementIdentifier"><code class="xref py py-func docutils literal notranslate"><span class="pre">incrementIdentifier</span></code></a> to guarantee uniqueness.</p>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<dl class="event" id="event-build.$buildid.step.$number.log.$logid.newlog">
<dt>
<em class="property">event: </em><code class="descname">build.$buildid.step.$number.log.$logid.newlog</code></dt>
<dd><p>The log has just started.
Logs are started when they are created, so this also indicates the creation of a new log.</p>
</dd></dl>

<dl class="last event" id="event-build.$buildid.step.$number.log.$logid.complete">
<dt>
<em class="property">event: </em><code class="descname">build.$buildid.step.$number.log.$logid.complete</code></dt>
<dd><p>The log is complete.</p>
</dd></dl>

</div>
<div class="section" id="id14">
<h7><a class="toc-backref" href="#id63">Update Methods</a><a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.logs.Log">
<em class="property">class </em><code class="descclassname">buildbot.data.logs.</code><code class="descname">Log</code><a class="headerlink" href="#buildbot.data.logs.Log" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.logs.Log.addLog">
<code class="descname">addLog</code><span class="sig-paren">(</span><em>stepid</em>, <em>name</em>, <em>type</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.logs.Log.addLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stepid</strong> (<em>integer</em>) – stepid containing this log</li>
<li><strong>name</strong> (<em>string</em>) – name for the log</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><strong>KeyError</strong> – if a log by the given name already exists</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">logid via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Create a new log and return its ID.
The name need not be unique.
This method will generate a unique slug based on the name.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">appendLog(logid, content):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logid</strong> (<em>integer</em>) – the log to which content should be appended</li>
<li><strong>content</strong> (<em>unicode</em>) – the content to append</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Append the given content to the given log.
The content must end with a newline.
All newlines in the content should be UNIX-style (<code class="docutils literal notranslate"><span class="pre">\n</span></code>).</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.logs.Log.finishLog">
<code class="descname">finishLog</code><span class="sig-paren">(</span><em>logid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.logs.Log.finishLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>logid</strong> (<em>integer</em>) – the log to finish</td>
</tr>
</tbody>
</table>
<p>Mark the log as complete.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.logs.Log.compressLog">
<code class="descname">compressLog</code><span class="sig-paren">(</span><em>logid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.logs.Log.compressLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>logid</strong> (<em>integer</em>) – the log to compress</td>
</tr>
</tbody>
</table>
<p>Compress the given log, after it is finished.
This operation may take some time.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id15">
<h7><a class="toc-backref" href="#id64">Endpoints</a><a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}/logs">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}/logs</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_name</strong> (<em>identifier</em>) – the slug name of the step</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all logs for the given step.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}/logs/{log_slug}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}/logs/{log_slug}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_name</strong> (<em>identifier</em>) – the slug name of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}/logs">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}/logs</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_number</strong> (<em>number</em>) – the number of the step</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all log of a a specific step</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}/logs/{log_slug}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}/logs/{log_slug}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_number</strong> (<em>number</em>) – the number of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one log of a a specific step</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builds/{buildid}/steps/{step_number_or_name}/logs">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}/steps/{step_number_or_name}/logs</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>number</em>) – the id of the build</li>
<li><strong>| number step_number_or_name</strong> (<em>identifier</em>) – the name or number of the step</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all logs of a step of a build</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builds/{buildid}/steps/{step_number_or_name}/logs/{log_slug}">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}/steps/{step_number_or_name}/logs/{log_slug}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>number</em>) – the id of the build</li>
<li><strong>| number step_number_or_name</strong> (<em>identifier</em>) – the name or number of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one log of a a specific step</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/logs/{logid}">
<dt>
<em class="property">path: </em><code class="descname">/logs/{logid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>logid</strong> (<em>number</em>) – the id of the log</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one log</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/steps/{stepid}/logs">
<dt>
<em class="property">path: </em><code class="descname">/steps/{stepid}/logs</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>stepid</strong> (<em>number</em>) – the id of the step</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all logs for the given step.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/steps/{stepid}/logs/{log_slug}">
<dt>
<em class="property">path: </em><code class="descname">/steps/{stepid}/logs/{log_slug}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>stepid</strong> (<em>number</em>) – the id of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="logchunk">
<h6><a class="toc-backref" href="#id65">logchunk</a><a class="headerlink" href="#logchunk" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-logchunk">
<dt>
<em class="property">resource type: </em><code class="descname">logchunk</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>content</strong> (<em>string</em>) – content of the chunk</li>
<li><strong>firstline</strong> (<em>integer</em>) – zero-based line number of the first line in this chunk</li>
<li><strong>logid</strong> (<em>integer</em>) – the ID of log containing this chunk</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A logchunk represents a contiguous sequence of lines in a logfile.
Logs are not individually addressable in the data API; instead, they must be requested by line number range.
In a strict REST sense, many logchunk resources will contain the same line.</p>
<p>The chunk contents is represented as a single unicode string.
This string is the concatenation of each newline terminated-line.</p>
<p>Each log has a type, as identified by the “type” field of the corresponding <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a>.
While all logs are sequences of unicode lines, the type gives additional information fo interpreting the contents.
The defined types are:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">t</span></code> – text, a simple sequence of lines of text</li>
<li><code class="docutils literal notranslate"><span class="pre">s</span></code> – stdio, like text but with each line tagged with a stream</li>
<li><code class="docutils literal notranslate"><span class="pre">h</span></code> – HTML, represented as plain text</li>
<li><code class="docutils literal notranslate"><span class="pre">d</span></code> – Deleted, logchunks for this log have been deleted by the Janitor</li>
</ul>
</div></blockquote>
<p>In the stream type, each line is prefixed by a character giving the stream type for that line.
The types are <code class="docutils literal notranslate"><span class="pre">i</span></code> for input, <code class="docutils literal notranslate"><span class="pre">o</span></code> for stdout, <code class="docutils literal notranslate"><span class="pre">e</span></code> for stderr, and <code class="docutils literal notranslate"><span class="pre">h</span></code> for header.
The first three correspond to normal UNIX standard streams, while the header stream contains metadata produced by Buildbot itself.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">offset</span></code> and <code class="docutils literal notranslate"><span class="pre">limit</span></code> parameters can be used to select the desired lines.
These are specified as query parameters via the REST interface, or as arguments to the <code class="xref py py-meth docutils literal notranslate"><span class="pre">get</span></code> method in Python.
The result will begin with line <code class="docutils literal notranslate"><span class="pre">offset</span></code> (so the resulting <code class="docutils literal notranslate"><span class="pre">firstline</span></code> will be equal to the given <code class="docutils literal notranslate"><span class="pre">offset</span></code>), and will contain up to <code class="docutils literal notranslate"><span class="pre">limit</span></code> lines.</p>
<p>Following example will get the first 100 lines of a log:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.data</span> <span class="k">import</span> <span class="n">resultspec</span>
<span class="n">first_100_lines</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">[</span><span class="s1">&#39;logid&#39;</span><span class="p">],</span> <span class="s2">&quot;contents&quot;</span><span class="p">),</span>
    <span class="n">resultSpec</span><span class="o">=</span><span class="n">resultspec</span><span class="o">.</span><span class="n">ResultSpec</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<p>Following example will get the last 100 lines of a log:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.data</span> <span class="k">import</span> <span class="n">resultspec</span>
<span class="n">last_100_lines</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s2">&quot;logs&quot;</span><span class="p">,</span> <span class="n">log</span><span class="p">[</span><span class="s1">&#39;logid&#39;</span><span class="p">],</span> <span class="s2">&quot;contents&quot;</span><span class="p">),</span>
    <span class="n">resultSpec</span><span class="o">=</span><span class="n">resultspec</span><span class="o">.</span><span class="n">ResultSpec</span><span class="p">(</span><span class="n">offset</span><span class="o">=</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;num_lines&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is no event for a new chunk. Instead, the log resource is updated when new chunks are added, with the new number of lines.
Consumers can then request those lines, if desired.</p>
</div>
<div class="section" id="id16">
<h7><a class="toc-backref" href="#id66">Update Methods</a><a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h7>
<p>Log chunks are updated via <a class="reference internal" href="#rtype-log" title="log"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">log</span></code></a>.</p>
</div>
<div class="section" id="id17">
<h7><a class="toc-backref" href="#id67">Endpoints</a><a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}/logs/{log_slug}/contents">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}/logs/{log_slug}/contents</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_name</strong> (<em>identifier</em>) – the slug name of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}/logs/{log_slug}/contents">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}/logs/{log_slug}/contents</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_number</strong> (<em>number</em>) – the number of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builds/{buildid}/steps/{step_number_or_name}/logs/{log_slug}/contents">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}/steps/{step_number_or_name}/logs/{log_slug}/contents</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>number</em>) – the id of the build</li>
<li><strong>| number step_number_or_name</strong> (<em>identifier</em>) – the name or number of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/logs/{logid}/contents">
<dt>
<em class="property">path: </em><code class="descname">/logs/{logid}/contents</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>logid</strong> (<em>number</em>) – the id of the log</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/steps/{stepid}/logs/{log_slug}/contents">
<dt>
<em class="property">path: </em><code class="descname">/steps/{stepid}/logs/{log_slug}/contents</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>stepid</strong> (<em>number</em>) – the id of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="master">
<h6><a class="toc-backref" href="#id68">master</a><a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-master">
<dt>
<em class="property">resource type: </em><code class="descname">master</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>active</strong> (<em>boolean</em>) – true if the master is active</li>
<li><strong>last_active</strong> (<em>date</em>) – time this master was last marked active</li>
<li><strong>masterid</strong> (<em>integer</em>) – the ID of this master</li>
<li><strong>name</strong> (<em>string</em>) – master name (in the form “hostname:basedir”)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This resource type describes buildmasters in the buildmaster cluster.</p>
<div class="section" id="id18">
<h7><a class="toc-backref" href="#id69">Update Methods</a><a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.masters.Master">
<em class="property">class </em><code class="descclassname">buildbot.data.masters.</code><code class="descname">Master</code><a class="headerlink" href="#buildbot.data.masters.Master" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.masters.Master.masterActive">
<code class="descname">masterActive</code><span class="sig-paren">(</span><em>name</em>, <em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.masters.Master.masterActive" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<em>unicode</em>) – the name of this master (generally <code class="docutils literal notranslate"><span class="pre">hostname:basedir</span></code>)</li>
<li><strong>masterid</strong> (<em>integer</em>) – this master’s master ID</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Mark this master as still active.
This method should be called at startup and at least once per minute.
The master ID is acquired directly from the database early in the master startup process.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.masters.Master.expireMasters">
<code class="descname">expireMasters</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.masters.Master.expireMasters" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Scan the database for masters that have not checked in for ten minutes.
This method should be called about once per minute.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.masters.Master.masterStopped">
<code class="descname">masterStopped</code><span class="sig-paren">(</span><em>name</em>, <em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.masters.Master.masterStopped" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<em>unicode</em>) – the name of this master</li>
<li><strong>masterid</strong> (<em>integer</em>) – this master’s master ID</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Mark this master as inactive.
Masters should call this method before completing an expected shutdown, and on startup.
This method will take care of deactivating or removing configuration resources like builders and schedulers as well as marking lost builds and build requests for retry.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id19">
<h7><a class="toc-backref" href="#id70">Endpoints</a><a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/masters">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/masters</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all masters supporting a given builder</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-master" title="master"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">master</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/{masterid}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/{masterid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>masterid</strong> (<em>number</em>) – the id of the master</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects a master by id filtered by given builderid</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-master" title="master"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">master</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters">
<dt>
<em class="property">path: </em><code class="descname">/masters</code></dt>
<dd></dd></dl>

<p>This path selects all masters</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-master" title="master"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">master</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>masterid</strong> (<em>number</em>) – the id of the master</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one master given its id</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-master" title="master"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">master</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="patch">
<h6><a class="toc-backref" href="#id71">patch</a><a class="headerlink" href="#patch" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-patch">
<dt>
<em class="property">resource type: </em><code class="descname">patch</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>patchid</strong> (<em>integer</em>) – the unique ID of this patch</li>
<li><strong>body</strong> (<em>string</em>) – patch body as a binary string</li>
<li><strong>level</strong> (<em>integer</em>) – patch level - the number of directory names to strip from filenames in the patch</li>
<li><strong>subdir</strong> (<em>string</em>) – subdirectory in which patch should be applied</li>
<li><strong>author?</strong> (<em>string</em>) – patch author, or None</li>
<li><strong>comment?</strong> (<em>string</em>) – patch comment, or None</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This resource type describes a patch.
Patches have unique IDs, but only appear embedded in sourcestamps, so those IDs are not especially useful.</p>
<div class="section" id="id20">
<h7><a class="toc-backref" href="#id72">Update Methods</a><a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.patches.Patch">
<em class="property">class </em><code class="descclassname">buildbot.data.patches.</code><code class="descname">Patch</code><a class="headerlink" href="#buildbot.data.patches.Patch" title="Permalink to this definition">¶</a></dt>
<dd><p>(no update methods)</p>
</dd></dl>

</div>
</div>
<div class="section" id="rootlink">
<h6><a class="toc-backref" href="#id73">rootlink</a><a class="headerlink" href="#rootlink" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-rootlink">
<dt>
<em class="property">resource type: </em><code class="descname">rootlink</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><strong>name</strong> (<em>string</em>) – </td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="id21">
<h7><a class="toc-backref" href="#id74">Endpoints</a><a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/">
<dt>
<em class="property">path: </em><code class="descname">/</code></dt>
<dd></dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-rootlink" title="rootlink"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">rootlink</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="scheduler">
<h6><a class="toc-backref" href="#id75">scheduler</a><a class="headerlink" href="#scheduler" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-scheduler">
<dt>
<em class="property">resource type: </em><code class="descname">scheduler</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>master?</strong> (<em>master</em>) – the master on which this scheduler is running, or None if it is inactive</li>
<li><strong>name</strong> (<em>string</em>) – name of this scheduler</li>
<li><strong>schedulerid</strong> (<em>integer</em>) – the ID of this scheduler</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A scheduler initiates builds, often in response to changes from change sources.
A particular scheduler (by name) runs on at most one master at a time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This data type and associated endpoints is planned to be merged with forcescheduler data type when <a class="reference external" href="http://trac.buildbot.net/ticket/2673">bug #2673</a> will be resolved.</p>
</div>
<div class="section" id="id22">
<h7><a class="toc-backref" href="#id76">Update Methods</a><a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.schedulers.Scheduler">
<em class="property">class </em><code class="descclassname">buildbot.data.schedulers.</code><code class="descname">Scheduler</code><a class="headerlink" href="#buildbot.data.schedulers.Scheduler" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="findSchedulerId">
<code class="descname">findSchedulerId</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#findSchedulerId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> (<em>string</em>) – scheduler name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">scheduler ID via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the ID for the given scheduler name, inventing one if necessary.</p>
</dd></dl>

<dl class="method">
<dt id="trySetSchedulerMaster">
<code class="descname">trySetSchedulerMaster</code><span class="sig-paren">(</span><em>schedulerid</em>, <em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#trySetSchedulerMaster" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>schedulerid</strong> (<em>integer</em>) – scheduler ID to try to claim</li>
<li><strong>masterid</strong> (<em>integer</em>) – this master’s master ID</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Try to claim the given scheduler for the given master and return <code class="docutils literal notranslate"><span class="pre">True</span></code> if
the scheduler is to be activated on that master.</p>
</dd></dl>

</div>
<div class="section" id="id23">
<h7><a class="toc-backref" href="#id77">Endpoints</a><a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/masters/{masterid}/schedulers">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/schedulers</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>masterid</strong> (<em>number</em>) – the id of the master</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all schedulers for a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-scheduler" title="scheduler"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">scheduler</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/schedulers/{schedulerid}">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/schedulers/{schedulerid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>masterid</strong> (<em>number</em>) – the id of the master</li>
<li><strong>schedulerid</strong> (<em>number</em>) – the id of the scheduler</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one scheduler by id for a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-scheduler" title="scheduler"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">scheduler</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/schedulers">
<dt>
<em class="property">path: </em><code class="descname">/schedulers</code></dt>
<dd></dd></dl>

<p>This path selects all schedulers</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-scheduler" title="scheduler"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">scheduler</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/schedulers/{schedulerid}">
<dt>
<em class="property">path: </em><code class="descname">/schedulers/{schedulerid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>schedulerid</strong> (<em>number</em>) – the id of the scheduler</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one scheduler by id</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-scheduler" title="scheduler"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">scheduler</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="sourcedproperties">
<h6><a class="toc-backref" href="#id78">sourcedproperties</a><a class="headerlink" href="#sourcedproperties" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-sourcedproperties">
<dt>
<em class="property">resource type: </em><code class="descname">sourcedproperties</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><strong>[]</strong> (<em>object</em>) – Each key of this map is the name of a defined property
The value consist on a couple (source, value)</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>user-specified properties for this change, represented as an object mapping keys to tuple (value, source)</p>
<p>Properties are present in several data resources, but have a separate endpoints, because they can represent a large dataset.</p>
<div class="section" id="id24">
<h7><a class="toc-backref" href="#id79">Update Methods</a><a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.properties.Properties">
<em class="property">class </em><code class="descclassname">buildbot.data.properties.</code><code class="descname">Properties</code><a class="headerlink" href="#buildbot.data.properties.Properties" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.properties.Properties.setBuildProperty">
<code class="descname">setBuildProperty</code><span class="sig-paren">(</span><em>buildid</em>, <em>name</em>, <em>value</em>, <em>source</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.properties.Properties.setBuildProperty" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>integer</em>) – build ID</li>
<li><strong>name</strong> (<em>unicode</em>) – Name of the property to set</li>
<li><strong>value</strong> (<em>Any JSON-able type is accepted</em><em> (</em><em>lists</em><em>, </em><em>dicts</em><em>, </em><em>strings and numbers</em><em>)</em>) – Value of the property</li>
<li><strong>source</strong> (<em>unicode</em>) – Source of the property to set</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Set a build property.
If no property with that name exists in that build, a new property will be created.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.properties.Properties.setBuildProperties">
<code class="descname">setBuildProperties</code><span class="sig-paren">(</span><em>buildid</em>, <em>props</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.properties.Properties.setBuildProperties" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>integer</em>) – build ID</li>
<li><strong>props</strong> (<em>IProperties</em>) – Name of the property to set</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Synchronise build properties with the db.
This sends only one event in the end of the sync, and only if properties changed.
The event contains only the updated properties, for network efficiency reasons.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id25">
<h7><a class="toc-backref" href="#id80">Endpoints</a><a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builds/{buildid}/properties">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}/properties</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>buildid</strong> (<em>number</em>) – the id of the build</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all properties of a build</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-sourcedproperties" title="sourcedproperties"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">sourcedproperties</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/buildsets/{bsid}/properties">
<dt>
<em class="property">path: </em><code class="descname">/buildsets/{bsid}/properties</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>bsid</strong> (<em>identifier</em>) – the id of the buildset</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all properties of a buildset.
Buildset properties is part of the initial properties of a build.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-sourcedproperties" title="sourcedproperties"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">sourcedproperties</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="sourcestamp">
<h6><a class="toc-backref" href="#id81">sourcestamp</a><a class="headerlink" href="#sourcestamp" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-sourcestamp">
<dt>
<em class="property">resource type: </em><code class="descname">sourcestamp</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>ssid</strong> (<em>integer</em>) – <p>the ID of this sourcestamp</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For legacy reasons, the abbreviated name <code class="docutils literal notranslate"><span class="pre">ssid</span></code> is used instead of canonical <code class="docutils literal notranslate"><span class="pre">sourcestampid</span></code>.
This might change in the future (<a class="reference external" href="http://trac.buildbot.net/ticket/3509">bug #3509</a>).</p>
</div>
</li>
<li><strong>branch?</strong> (<em>string</em>) – code branch, or none for the “default branch”, whatever that might mean</li>
<li><strong>codebase</strong> (<em>string</em>) – revision for this sourcestamp, or none if unknown</li>
<li><strong>created_at</strong> (<em>date</em>) – the timestamp when this sourcestamp was created</li>
<li><strong>patch?</strong> (<em>patch</em>) – the patch for this sourcestamp, or none</li>
<li><strong>project</strong> (<em>string</em>) – user-defined project to which this sourcestamp corresponds</li>
<li><strong>repository</strong> (<em>string</em>) – repository where this sourcestamp occurred</li>
<li><strong>revision?</strong> (<em>string</em>) – revision for this sourcestamp, or none if unknown</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A source stamp represents a particular version of the source code.
Absolute sourcestamps specify this completely, while relative sourcestamps (with revision = None) specify the latest source at the current time.
Source stamps can also have patches; such stamps describe the underlying revision with the given patch applied.</p>
<p>Note that, depending on the underlying version-control system, the same revision may describe different code in different branches (e.g., SVN) or may be independent of the branch (e.g., Git).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">created_at</span></code> timestamp can be used to indicate the first time a sourcestamp was seen by Buildbot.
This provides a reasonable default ordering for sourcestamps when more reliable information is not available.</p>
<div class="section" id="id26">
<h7><a class="toc-backref" href="#id82">Endpoints</a><a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/sourcestamps">
<dt>
<em class="property">path: </em><code class="descname">/sourcestamps</code></dt>
<dd></dd></dl>

<p>This path selects all sourcestamps (can return lots of data!)</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-sourcestamp" title="sourcestamp"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">sourcestamp</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/sourcestamps/{ssid}">
<dt>
<em class="property">path: </em><code class="descname">/sourcestamps/{ssid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>ssid</strong> (<em>number</em>) – the id of the sourcestamp</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one sourcestamp by id</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-sourcestamp" title="sourcestamp"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">sourcestamp</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="spec">
<h6><a class="toc-backref" href="#id83">spec</a><a class="headerlink" href="#spec" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-spec">
<dt>
<em class="property">resource type: </em><code class="descname">spec</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>path</strong> (<em>string</em>) – </li>
<li><strong>plural</strong> (<em>string</em>) – </li>
<li><strong>type</strong> (<em>string</em>) – </li>
<li><strong>type_spec</strong> (<em>object</em>) – </li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="section" id="id27">
<h7><a class="toc-backref" href="#id84">Endpoints</a><a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/application.spec">
<dt>
<em class="property">path: </em><code class="descname">/application.spec</code></dt>
<dd></dd></dl>

<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-spec" title="spec"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">spec</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="step">
<h6><a class="toc-backref" href="#id85">step</a><a class="headerlink" href="#step" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-step">
<dt>
<em class="property">resource type: </em><code class="descname">step</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>stepid</strong> (<em>integer</em>) – the unique ID of this step</li>
<li><strong>buildid</strong> (<em>integer</em>) – id of the build containing this step</li>
<li><strong>complete</strong> (<em>boolean</em>) – true if this step is complete</li>
<li><strong>complete_at?</strong> (<em>date</em>) – time at which this step was complete, or None if it’s still running</li>
<li><strong>hidden</strong> (<em>boolean</em>) – true if the step should not be displayed</li>
<li><strong>name</strong> (<em>identifier</em>) – the step name, unique within the build</li>
<li><strong>number</strong> (<em>integer</em>) – the number of this step (sequential within the build)</li>
<li><strong>results?</strong> (<em>integer</em>) – the results of the step (see <a class="reference internal" href="#build-result-codes"><span class="std std-ref">Build Result Codes</span></a>), or None if not complete</li>
<li><strong>started_at?</strong> (<em>date</em>) – time at which this step started, or None if it hasn’t started yet</li>
<li><strong>state_string</strong> (<em>string</em>) – a string giving detail on the state of the build.
The first is usually one word or phrase; the remainder are sized for one-line display.</li>
<li><strong>urls[]</strong> – a list of URLs associated with this step.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This resource type describes a step in a build.
Steps have unique IDs, but are most commonly accessed by name in the context of their containing builds.</p>
<div class="section" id="id28">
<h7><a class="toc-backref" href="#id86">Update Methods</a><a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h7>
<p>All update methods are available as attributes of <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
<dl class="class">
<dt id="buildbot.data.steps.Step">
<em class="property">class </em><code class="descclassname">buildbot.data.steps.</code><code class="descname">Step</code><a class="headerlink" href="#buildbot.data.steps.Step" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.data.steps.Step.newStep">
<code class="descname">newStep</code><span class="sig-paren">(</span><em>buildid</em>, <em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.steps.Step.newStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>buildid</strong> (<em>integer</em>) – buildid containing this step</li>
<li><strong>name</strong> (50-character <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>) – name for the step</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(stepid, number, name) via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Create a new step and return its ID, number, and name.
Note that the name may be different from the requested name, if that name was already in use.
The state strings for the new step will be set to ‘pending’.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.steps.Step.startStep">
<code class="descname">startStep</code><span class="sig-paren">(</span><em>stepid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.steps.Step.startStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>stepid</strong> (<em>integer</em>) – the step to modify</td>
</tr>
</tbody>
</table>
<p>Start the step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.steps.Step.setStepStateString">
<code class="descname">setStepStateString</code><span class="sig-paren">(</span><em>stepid</em>, <em>state_string</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.steps.Step.setStepStateString" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>stepid</strong> (<em>integer</em>) – the step to modify</li>
<li><strong>state_string</strong> (<em>unicode</em>) – new state strings for this step</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Replace the existing state string for a step with a new list.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">addStepURL(stepid, name, url):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stepid</strong> (<em>integer</em>) – the step to modify</li>
<li><strong>name</strong> (<em>string</em>) – the url name</li>
<li><strong>url</strong> (<em>string</em>) – the actual url</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None via deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new url to a step.
The new url is added to the list of urls.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.steps.Step.finishStep">
<code class="descname">finishStep</code><span class="sig-paren">(</span><em>stepid</em>, <em>results</em>, <em>hidden</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.steps.Step.finishStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>stepid</strong> (<em>integer</em>) – the step to modify</li>
<li><strong>results</strong> (<em>integer</em>) – the step’s results</li>
<li><strong>hidden</strong> (<em>boolean</em>) – true if the step should not be displayed</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Mark the step as finished at the current time, with the given results.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id29">
<h7><a class="toc-backref" href="#id87">Endpoints</a><a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all steps for the given build.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-step" title="step"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">step</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_name</strong> (<em>identifier</em>) – the slug name of the step</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects a specific step for the given build.</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-step" title="step"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">step</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_number</strong> (<em>number</em>) – the number of the step</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects a specific step given its step number</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-step" title="step"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">step</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builds/{buildid}/steps">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}/steps</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>buildid</strong> (<em>number</em>) – the id of the build</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all steps of a build</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-step" title="step"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">step</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builds/{buildid}/steps/{step_number_or_name}">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}/steps/{step_number_or_name}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>number</em>) – the id of the build</li>
<li><strong>| number step_number_or_name</strong> (<em>identifier</em>) – the name or number of the step</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one step of a build</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-step" title="step"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">step</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="worker">
<h6><a class="toc-backref" href="#id88">worker</a><a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h6>
<dl class="rtype" id="rtype-worker">
<dt>
<em class="property">resource type: </em><code class="descname">worker</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Attributes:</th><td class="field-body"><ul class="first last simple">
<li><strong>workerid</strong> (<em>integer</em>) – the ID of this worker</li>
<li><strong>configured_on[]</strong> – list of builders on masters this worker is configured on</li>
<li><strong>connected_to[]</strong> – list of masters this worker is attached to</li>
<li><strong>name</strong> (<em>string</em>) – the name of the worker</li>
<li><strong>paused</strong> (<em>bool</em>) – the worker is paused if it is connected but doesn’t accept new builds.</li>
<li><strong>graceful</strong> (<em>bool</em>) – the worker is graceful if it doesn’t accept new builds, and will shutdown when builds are finished.</li>
<li><strong>workerinfo</strong> (<em>object</em>) – <p>information about the worker.</p>
<p>The worker information can be any JSON-able object.
In practice, it contains the following keys, based on information provided by the worker:</p>
<ul>
<li><code class="docutils literal notranslate"><span class="pre">admin</span></code> (the admin information)</li>
<li><code class="docutils literal notranslate"><span class="pre">host</span></code> (the name of the host)</li>
<li><code class="docutils literal notranslate"><span class="pre">access_uri</span></code> (the access URI)</li>
<li><code class="docutils literal notranslate"><span class="pre">version</span></code> (the version on the worker)</li>
</ul>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>A worker resource represents a worker to the source code monitored by Buildbot.</p>
<p>The contents of the <code class="docutils literal notranslate"><span class="pre">connected_to</span></code> and <code class="docutils literal notranslate"><span class="pre">configured_on</span></code> attributes are sensitive to the context of the request.
If a builder or master is specified in the path, then only the corresponding connections and configurations are included in the result.</p>
<div class="section" id="id30">
<h7><a class="toc-backref" href="#id89">Endpoints</a><a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h7>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/workers">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/workers</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all workers configured for a given builder</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/workers/{name}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/workers/{name}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>name</strong> (<em>identifier</em>) – the name of the worker</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects a worker by name filtered by given builderid</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/workers/{workerid}">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/workers/{workerid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>workerid</strong> (<em>number</em>) – the id of the worker</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects a worker by id filtered by given builderid</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="raction" id="raction-/builders/{builderid_or_buildername}/workers/{workerid} (method=stop)">
<dt>
<em class="property">POST with method: </em><code class="descname">/builders/{builderid_or_buildername}/workers/{workerid} (method=stop)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">stop</span></code></li>
<li><strong>reason</strong> (<em>string</em>) – The reason why the worker was stopped</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="raction" id="raction-/builders/{builderid_or_buildername}/workers/{workerid} (method=kill)">
<dt>
<em class="property">POST with method: </em><code class="descname">/builders/{builderid_or_buildername}/workers/{workerid} (method=kill)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">kill</span></code></li>
<li><strong>reason</strong> (<em>string</em>) – The reason why the worker was stopped</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="raction" id="raction-/builders/{builderid_or_buildername}/workers/{workerid} (method=pause)">
<dt>
<em class="property">POST with method: </em><code class="descname">/builders/{builderid_or_buildername}/workers/{workerid} (method=pause)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">pause</span></code></li>
<li><strong>reason</strong> (<em>string</em>) – The reason why the worker was paused</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="raction" id="raction-/builders/{builderid_or_buildername}/workers/{workerid} (method=unpause)">
<dt>
<em class="property">POST with method: </em><code class="descname">/builders/{builderid_or_buildername}/workers/{workerid} (method=unpause)</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Body keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>method</strong> (<em>string</em>) – must be <code class="docutils literal notranslate"><span class="pre">unpause</span></code></li>
<li><strong>reason</strong> (<em>string</em>) – The reason why the worker was un-paused</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="rpath" id="rpath-/masters/{masterid}/builders/{builderid}/workers">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/builders/{builderid}/workers</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>masterid</strong> (<em>number</em>) – the id of the master</li>
<li><strong>builderid</strong> (<em>number</em>) – the id of the builder</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all workers for a given builder and a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/builders/{builderid}/workers/{name}">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/builders/{builderid}/workers/{name}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>masterid</strong> (<em>number</em>) – the id of the master</li>
<li><strong>builderid</strong> (<em>number</em>) – the id of the builder</li>
<li><strong>name</strong> (<em>identifier</em>) – the name of the worker</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one workers by name for a given builder and a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/builders/{builderid}/workers/{workerid}">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/builders/{builderid}/workers/{workerid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>masterid</strong> (<em>number</em>) – the id of the master</li>
<li><strong>builderid</strong> (<em>number</em>) – the id of the builder</li>
<li><strong>workerid</strong> (<em>number</em>) – the id of the worker</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one workers by name for a given builder and a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/workers">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/workers</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>masterid</strong> (<em>number</em>) – the id of the master</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects all workers for a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/workers/{name}">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/workers/{name}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>masterid</strong> (<em>number</em>) – the id of the master</li>
<li><strong>name</strong> (<em>identifier</em>) – the name of the worker</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one worker by name for a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/masters/{masterid}/workers/{workerid}">
<dt>
<em class="property">path: </em><code class="descname">/masters/{masterid}/workers/{workerid}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>masterid</strong> (<em>number</em>) – the id of the master</li>
<li><strong>workerid</strong> (<em>number</em>) – the id of the worker</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path selects one worker by id for a given master</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/workers">
<dt>
<em class="property">path: </em><code class="descname">/workers</code></dt>
<dd></dd></dl>

<p>this path selects all workers</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
<dl class="rpath" id="rpath-/workers/{name_or_id}">
<dt>
<em class="property">path: </em><code class="descname">/workers/{name_or_id}</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>| number name_or_id</strong> (<em>identifier</em>) – the name or id of a worker</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>this path selects worker by name or id</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">GET</span></code></dt>
<dd><dl class="first last docutils">
<dt><code class="docutils literal notranslate"><span class="pre">returns</span></code></dt>
<dd><a class="reference internal" href="#rtype-collection" title="collection"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">collection</span></code></a> of <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a></dd>
</dl>
</dd>
</dl>
</div>
</div>
<div class="section" id="raw-endpoints">
<h6><a class="toc-backref" href="#id90">Raw endpoints</a><a class="headerlink" href="#raw-endpoints" title="Permalink to this headline">¶</a></h6>
<p>Raw endpoints allow to download content in their raw format (i.e. not within a json glue).
The <code class="docutils literal notranslate"><span class="pre">content-disposition</span></code> http header is set, so that the browser knows which file to store the content to.</p>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}/logs/{log_slug}/raw">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_name}/logs/{log_slug}/raw</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_name</strong> (<em>identifier</em>) – the slug name of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This endpoint allows to get the raw logs for downloading into a file.
This endpoint does not provide paging capabilities.
For stream log types, the type line header characters are dropped.
‘text/plain’ is used as the mime type except for html logs, where ‘text/html’ is used.
The ‘slug’ is used as the filename for the resulting download. Some browsers are appending <code class="docutils literal notranslate"><span class="pre">&quot;.txt&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;.html&quot;</span></code> to this filename according to the mime-type.</p>
<dl class="rpath" id="rpath-/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}/logs/{log_slug}/raw">
<dt>
<em class="property">path: </em><code class="descname">/builders/{builderid_or_buildername}/builds/{build_number}/steps/{step_number}/logs/{log_slug}/raw</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>| identifier builderid_or_buildername</strong> (<em>number</em>) – the ID or name of the builder</li>
<li><strong>build_number</strong> (<em>number</em>) – the number of the build within the builder</li>
<li><strong>step_number</strong> (<em>number</em>) – the number of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path downloads the whole log</p>
<dl class="rpath" id="rpath-/builds/{buildid}/steps/{step_number_or_name}/logs/{log_slug}/raw">
<dt>
<em class="property">path: </em><code class="descname">/builds/{buildid}/steps/{step_number_or_name}/logs/{log_slug}/raw</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildid</strong> (<em>number</em>) – the id of the build</li>
<li><strong>| number step_number_or_name</strong> (<em>identifier</em>) – the name or number of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path downloads the whole log</p>
<dl class="rpath" id="rpath-/logs/{logid}/raw">
<dt>
<em class="property">path: </em><code class="descname">/logs/{logid}/raw</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><strong>logid</strong> (<em>number</em>) – the id of the log</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path downloads the whole log</p>
<dl class="rpath" id="rpath-/steps/{stepid}/logs/{log_slug}/raw">
<dt>
<em class="property">path: </em><code class="descname">/steps/{stepid}/logs/{log_slug}/raw</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Path Keys:</th><td class="field-body"><ul class="first last simple">
<li><strong>stepid</strong> (<em>number</em>) – the id of the step</li>
<li><strong>log_slug</strong> (<em>identifier</em>) – the slug name of the log</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>This path downloads the whole log</p>
</div>
<div class="section" id="raml-spec-verbatim">
<h6><a class="toc-backref" href="#id91">Raml spec verbatim</a><a class="headerlink" href="#raml-spec-verbatim" title="Permalink to this headline">¶</a></h6>
<p>Sometimes Raml is just clearer than formatted text.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#%RAML 1.0</span>
<span class="l l-Scalar l-Scalar-Plain">title</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Buildbot Web API</span>
<span class="l l-Scalar l-Scalar-Plain">version</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">v2</span>
<span class="l l-Scalar l-Scalar-Plain">mediaType</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">application/json</span>
<span class="l l-Scalar l-Scalar-Plain">traits</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">responses</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">200</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">responseObjects.libraries.types.&lt;&lt;bbtype&gt;&gt;</span>
            <span class="l l-Scalar l-Scalar-Plain">404</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">text/plain</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">example</span><span class="p p-Indicator">:</span> <span class="s">&quot;not</span><span class="nv"> </span><span class="s">found&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">bbpost</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;reqtype&gt;&gt;</span>
        <span class="l l-Scalar l-Scalar-Plain">responses</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">200</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;&lt;resptype&gt;&gt;</span>
            <span class="l l-Scalar l-Scalar-Plain">404</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">text/plain</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">example</span><span class="p p-Indicator">:</span> <span class="s">&quot;not</span><span class="nv"> </span><span class="s">found&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">bbgetraw</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">responses</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">200</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">headers</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">content-disposition</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">content disposition header allows browser to save log file with proper filename</span>
                        <span class="l l-Scalar l-Scalar-Plain">example</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">attachment; filename=stdio</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">text/html</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;html</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">object</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">html&quot;</span>
                    <span class="l l-Scalar l-Scalar-Plain">text/plain</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;plain</span><span class="nv"> </span><span class="s">text</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">object</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">text&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">types</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">build</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/build.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">builder</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/builder.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">buildrequest</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/buildrequest.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">buildset</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/buildset.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/worker.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">change</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/change.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">changesource</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/changesource.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">forcescheduler</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/forcescheduler.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">identifier</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/identifier.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">log</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/log.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">logchunk</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/logchunk.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">master</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/master.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">rootlink</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/rootlink.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">scheduler</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/scheduler.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">sourcedproperties</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/sourcedproperties.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">sourcestamp</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/sourcestamp.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">patch</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/patch.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/spec.raml</span>
    <span class="l l-Scalar l-Scalar-Plain">step</span><span class="p p-Indicator">:</span> <span class="kt">!include</span> <span class="l l-Scalar l-Scalar-Plain">types/step.raml</span>
<span class="l l-Scalar l-Scalar-Plain">/</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">rootlink</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/application.spec</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">spec</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/builders</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all builders</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">builder</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{builderid_or_buildername}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">builderid_or_buildername</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number | identifier</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the ID or name of the builder</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects a builder by builderid</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">builder</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/forceschedulers</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all force-schedulers for a given builder</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">forcescheduler</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/buildrequests</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all buildrequests for a given builder (can return lots of data!)</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">buildrequest</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/builds</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all builds for a builder (can return lots of data!)</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">build</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{build_number}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">build_number</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the number of the build within the builder</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects a specific build by builderid, buildnumber</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">build</span><span class="p p-Indicator">}</span>
                <span class="l l-Scalar l-Scalar-Plain">/actions/stop</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                            <span class="no">stops one build.</span>
                        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">reason</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                                        <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The reason why the build was stopped</span>
                                    <span class="l l-Scalar l-Scalar-Plain">results</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">integer</span>
                                        <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">optionally results value override (default CANCELLED)</span>
                <span class="l l-Scalar l-Scalar-Plain">/actions/rebuild</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                            <span class="no">rebuilds one build.</span>
                        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">no parameter are needed</span>
                <span class="l l-Scalar l-Scalar-Plain">/steps</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all steps for the given build.</span>
                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">step</span><span class="p p-Indicator">}</span>
                    <span class="l l-Scalar l-Scalar-Plain">/{step_name}</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">step_name</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the slug name of the step</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects a specific step for the given build.</span>
                        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">step</span><span class="p p-Indicator">}</span>
                        <span class="l l-Scalar l-Scalar-Plain">/logs</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all logs for the given step.</span>
                            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
                            <span class="l l-Scalar l-Scalar-Plain">/{log_slug}</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">log_slug</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the slug name of the log</span>
                                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                                        <span class="no">This path selects a specific log in the given step.</span>
                                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
                                <span class="l l-Scalar l-Scalar-Plain">/contents</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                                            <span class="no">This path selects chunks from a specific log in the given step.</span>
                                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">logchunk</span><span class="p p-Indicator">}</span>
                                <span class="l l-Scalar l-Scalar-Plain">/raw</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                                            <span class="no">This endpoint allows to get the raw logs for downloading into a file.</span>
                                            <span class="no">This endpoint does not provide paging capabilities.</span>
                                            <span class="no">For stream log types, the type line header characters are dropped.</span>
                                            <span class="no">&#39;text/plain&#39; is used as the mime type except for html logs, where &#39;text/html&#39; is used.</span>
                                            <span class="no">The &#39;slug&#39; is used as the filename for the resulting download. Some browsers are appending ``&quot;.txt&quot;`` or ``&quot;.html&quot;`` to this filename according to the mime-type.</span>
                                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbgetraw</span><span class="p p-Indicator">:</span>

                    <span class="l l-Scalar l-Scalar-Plain">/{step_number}</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">step_number</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the number of the step</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects a specific step given its step number</span>
                        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">step</span><span class="p p-Indicator">}</span>
                        <span class="l l-Scalar l-Scalar-Plain">/logs</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all log of a a specific step</span>
                            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
                            <span class="l l-Scalar l-Scalar-Plain">/{log_slug}</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">log_slug</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the slug name of the log</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one log of a a specific step</span>
                                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
                                <span class="l l-Scalar l-Scalar-Plain">/contents</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                                            <span class="no">This path selects chunks from a specific log in the given step.</span>
                                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">logchunk</span><span class="p p-Indicator">}</span>
                                <span class="l l-Scalar l-Scalar-Plain">/raw</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                                            <span class="no">This path downloads the whole log</span>
                                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbgetraw</span><span class="p p-Indicator">:</span>

        <span class="l l-Scalar l-Scalar-Plain">/workers</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path selects all workers configured for a given builder</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{name}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                    <span class="no">This path selects a worker by name filtered by given builderid</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the name of the worker</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{workerid}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                    <span class="no">This path selects a worker by id filtered by given builderid</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">workerid</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the worker</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>

                <span class="l l-Scalar l-Scalar-Plain">/actions/stop</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                            <span class="no">gracefully shutdown one worker.</span>
                        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">reason</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                                        <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The reason why the worker was stopped</span>

                <span class="l l-Scalar l-Scalar-Plain">/actions/kill</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                            <span class="no">forcefully shutdown one worker.</span>
                        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">reason</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                                        <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The reason why the worker was stopped</span>

                <span class="l l-Scalar l-Scalar-Plain">/actions/pause</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                            <span class="no">Pause one worker. The worker will stop taking new build.</span>
                        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">reason</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                                        <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The reason why the worker was paused</span>
                <span class="l l-Scalar l-Scalar-Plain">/actions/unpause</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                            <span class="no">Unpause one worker. The worker will re-start taking builds.</span>
                        <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
                                    <span class="l l-Scalar l-Scalar-Plain">reason</span><span class="p p-Indicator">:</span>
                                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                                        <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The reason why the worker was un-paused</span>
        <span class="l l-Scalar l-Scalar-Plain">/masters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path selects all masters supporting a given builder</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">master</span><span class="p p-Indicator">}</span>

        <span class="l l-Scalar l-Scalar-Plain">/{masterid}</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">masterid</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the master</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path selects a master by id filtered by given builderid</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">master</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/buildrequests</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">/{buildrequestid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">buildrequestid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the buildrequest</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">buildrequest</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/builds</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">build</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/actions/cancel</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                    <span class="no">Cancel one buildrequest.</span>
                    <span class="no">If necessary, this will stop the builds generated by the buildrequest, including triggered builds.</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">reason</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                                <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The reason why the buildrequest was cancelled</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">buildrequest</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/builds</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">build</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{buildid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
            <span class="no">This path selects a build by id</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">buildid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the build</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">build</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/actions/stop</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                    <span class="no">stops one build.</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">reason</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                                <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The reason why the build was stopped</span>
        <span class="l l-Scalar l-Scalar-Plain">/actions/rebuild</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                    <span class="no">rebuilds one build.</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">no parameter are needed</span>
        <span class="l l-Scalar l-Scalar-Plain">/changes</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path selects all changes tested by a build</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">change</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/properties</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path selects all properties of a build</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">sourcedproperties</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/steps</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path selects all steps of a build</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">step</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{step_number_or_name}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">step_number_or_name</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier | number</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the name or number of the step</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                    <span class="no">This path selects one step of a build</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">step</span><span class="p p-Indicator">}</span>
                <span class="l l-Scalar l-Scalar-Plain">/logs</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                        <span class="no">This path selects all logs of a step of a build</span>
                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
                    <span class="l l-Scalar l-Scalar-Plain">/{log_slug}</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">log_slug</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the slug name of the log</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one log of a a specific step</span>
                        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
                        <span class="l l-Scalar l-Scalar-Plain">/contents</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                                    <span class="no">This path selects chunks from a specific log in the given step.</span>
                                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">logchunk</span><span class="p p-Indicator">}</span>
                        <span class="l l-Scalar l-Scalar-Plain">/raw</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                                    <span class="no">This path downloads the whole log</span>
                                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbgetraw</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">/buildsets</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this path selects all buildsets</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">buildset</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{bsid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this path selects a buildset by id</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">bsid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the buildset</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">buildset</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/properties</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path selects all properties of a buildset.</span>
                <span class="no">Buildset properties is part of the initial properties of a build.</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">sourcedproperties</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/workers</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this path selects all workers</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{name_or_id}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this path selects worker by name or id</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">name_or_id</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier | number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the name or id of a worker</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>

<span class="l l-Scalar l-Scalar-Plain">/changes</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">This path selects **all** changes.</span>
        <span class="no">On a reasonably loaded master, this can quickly return a very large result, taking minutes to process.</span>
        <span class="no">A specific query configuration is optimized which allows to get the recent changes: ``order:-changeid&amp;limit=&lt;n&gt;``</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">change</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{changeid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">this path selects one change by id</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">changeid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of a change</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">change</span><span class="p p-Indicator">}</span>

<span class="l l-Scalar l-Scalar-Plain">/changesources</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">This path selects all changesource.</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">changesource</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{changesourceid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">changesourceid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of a changesource</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
            <span class="no">This path selects one changesource given its id.</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">changesource</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/forceschedulers</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
        <span class="no">This path selects all forceschedulers.</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">forcescheduler</span><span class="p p-Indicator">}</span>

    <span class="l l-Scalar l-Scalar-Plain">/{schedulername}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
            <span class="no">This path selects all changesource.</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">schedulername</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the name of a scheduler</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">forcescheduler</span><span class="p p-Indicator">}</span>

        <span class="l l-Scalar l-Scalar-Plain">/actions/force</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">post</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                    <span class="no">Triggers the forcescheduler</span>
                <span class="l l-Scalar l-Scalar-Plain">body</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">application/json</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">properties</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">owner</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">string</span>
                                <span class="l l-Scalar l-Scalar-Plain">required</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">The user who wants to create the buildrequest</span>
                            <span class="s">&#39;[]&#39;</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">content of the forcescheduler parameter is dependent on the configuration of the forcescheduler</span>
<span class="l l-Scalar l-Scalar-Plain">/logs/{logid}</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">logid</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the log</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one log</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/contents</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path selects chunks from a specific log</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">logchunk</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/raw</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                <span class="no">This path downloads the whole log</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbgetraw</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">/masters</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all masters</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">master</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{masterid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one master given its id</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">masterid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the master</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">master</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/builders</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all builders of a given master</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">builder</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{builderid}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one builder by id of a given master</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">builderid</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the builder</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">builder</span><span class="p p-Indicator">}</span>
                <span class="l l-Scalar l-Scalar-Plain">/workers</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all workers for a given builder and a given master</span>
                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
                    <span class="l l-Scalar l-Scalar-Plain">/{name}</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one workers by name for a given builder and a given master</span>
                        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the name of the worker</span>
                        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
                    <span class="l l-Scalar l-Scalar-Plain">/{workerid}</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one workers by name for a given builder and a given master</span>
                        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">workerid</span><span class="p p-Indicator">:</span>
                                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the worker</span>
                        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/workers</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all workers for a given master</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{name}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one worker by name for a given master</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the name of the worker</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{workerid}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one worker by id for a given master</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">workerid</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the worker</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">worker</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/changesources</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all changesources for a given master</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">changesource</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{changesourceid}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one changesource by id for a given master</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">changesource</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/schedulers</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all schedulers for a given master</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">scheduler</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{schedulerid}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one scheduler by id for a given master</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">schedulerid</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the scheduler</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">scheduler</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/schedulers</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all schedulers</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">scheduler</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{schedulerid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">schedulerid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the scheduler</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one scheduler by id</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">scheduler</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/sourcestamps</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all sourcestamps (can return lots of data!)</span>
    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">sourcestamp</span><span class="p p-Indicator">}</span>
    <span class="l l-Scalar l-Scalar-Plain">/{ssid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one sourcestamp by id</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">ssid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the sourcestamp</span>
        <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">sourcestamp</span><span class="p p-Indicator">}</span>
        <span class="l l-Scalar l-Scalar-Plain">/changes</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all changes associated to one sourcestamp</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">change</span><span class="p p-Indicator">}</span>
<span class="l l-Scalar l-Scalar-Plain">/steps</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">/{stepid}</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects one step by id</span>
        <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">stepid</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">number</span>
                <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the id of the step</span>
        <span class="l l-Scalar l-Scalar-Plain">/logs</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">This path selects all logs for the given step.</span>
            <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
            <span class="l l-Scalar l-Scalar-Plain">/{log_slug}</span><span class="p p-Indicator">:</span>
                <span class="l l-Scalar l-Scalar-Plain">uriParameters</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">log_slug</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">identifier</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">the slug name of the log</span>
                <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                        <span class="no">This path selects a specific log in the given step.</span>
                    <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">log</span><span class="p p-Indicator">}</span>
                <span class="l l-Scalar l-Scalar-Plain">/contents</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                            <span class="no">This path selects chunks from a specific log in the given step.</span>
                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbget</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{</span><span class="nv">bbtype</span><span class="p p-Indicator">:</span> <span class="nv">logchunk</span><span class="p p-Indicator">}</span>
                <span class="l l-Scalar l-Scalar-Plain">/raw</span><span class="p p-Indicator">:</span>
                    <span class="l l-Scalar l-Scalar-Plain">get</span><span class="p p-Indicator">:</span>
                        <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
                            <span class="no">This path downloads the whole log</span>
                        <span class="l l-Scalar l-Scalar-Plain">is</span><span class="p p-Indicator">:</span>
                        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bbgetraw</span><span class="p p-Indicator">:</span>
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-developer/data"></span><div class="section" id="data-api">
<span id="id1"></span><h4>3.3.2. Data API<a class="headerlink" href="#data-api" title="Permalink to this headline">¶</a></h4>
<p>The data layer combines access to stored state and messages, ensuring consistency between them, and exposing a well-defined API that can be used both internally and externally.
Using caching and the clock information provided by the db and mq layers, this layer ensures that its callers can easily receive a dump of current state plus changes to that state, without missing or duplicating messages.</p>
<div class="section" id="sections">
<h5>3.3.2.1. Sections<a class="headerlink" href="#sections" title="Permalink to this headline">¶</a></h5>
<p>The data api is divided into four sections:</p>
<ul class="simple">
<li>getters - fetching data from the db API, and</li>
<li>subscriptions - subscribing to messages from the mq layer;</li>
<li>control - allows state to be changed in specific ways by sending appropriate messages (e.g., stopping a build); and</li>
<li>updates - direct updates to state appropriate messages.</li>
</ul>
<p>The getters and subscriptions are exposed everywhere.
Access to the control section should be authenticated at higher levels, as the data layer does no authentication.
The updates section is for use only by the process layer.</p>
<p>The interfaces for all sections but the updates sections are intended to be language-agnostic.
That is, they should be callable from JavaScript via HTTP, or via some other interface added to Buildbot after the fact.</p>
<div class="section" id="getter">
<h6>Getter<a class="headerlink" href="#getter" title="Permalink to this headline">¶</a></h6>
<p>The getter section can get either a single resource, or a list of resources.
Getting a single resource requires a resource identifier (a tuple of strings) and a set of options to support automatic expansion of links to other resources (thus saving round-trips).
Lists are requested with a partial resource identifier (a tuple of strings) and an optional set of filter options.
In some cases, certain filters are implicit in the path, e.g., the list of buildsteps for a particular build.</p>
</div>
<div class="section" id="subscriptions">
<h6>Subscriptions<a class="headerlink" href="#subscriptions" title="Permalink to this headline">¶</a></h6>
<p>Message subscriptions can be made to anything that can be listed or gotten from the getter sections, using the same resource identifiers.
Options and explicit filters are not supported - a message contains only the most basic information about a resource, and a list subscription results in a message for every new resource of the desired type.
Implicit filters are supported.</p>
</div>
<div class="section" id="control">
<h6>Control<a class="headerlink" href="#control" title="Permalink to this headline">¶</a></h6>
<p>The control sections defines a set of actions that cause Buildbot to behave in a certain way, e.g., rebuilding a build or shutting down a worker.
Actions correspond to a particular resource, although sometimes that resource is the root resource (an empty tuple).</p>
</div>
</div>
<div class="section" id="updates">
<h5>3.3.2.2. Updates<a class="headerlink" href="#updates" title="Permalink to this headline">¶</a></h5>
<p>The updates section defines a free-form set of methods that Buildbot’s process implementation calls to update data.
Most update methods both modify state via the db API and send a message via the mq API.
Some are simple wrappers for these APIs, while others contain more complex logic, e.g., building a source stamp set for a collection of changes.
This section is the proper place to put common functionality, e.g., rebuilding builds or assembling buildsets.</p>
</div>
<div class="section" id="concrete-interfaces">
<h5>3.3.2.3. Concrete Interfaces<a class="headerlink" href="#concrete-interfaces" title="Permalink to this headline">¶</a></h5>
<div class="section" id="module-buildbot.data.connector">
<span id="python-interface"></span><h6>Python Interface<a class="headerlink" href="#module-buildbot.data.connector" title="Permalink to this headline">¶</a></h6>
<p>Within the buildmaster process, the root of the data API is available at <cite>self.master.data</cite>, which is a <a class="reference internal" href="#buildbot.data.connector.DataConnector" title="buildbot.data.connector.DataConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataConnector</span></code></a> instance.</p>
<dl class="class">
<dt id="buildbot.data.connector.DataConnector">
<em class="property">class </em><code class="descclassname">buildbot.data.connector.</code><code class="descname">DataConnector</code><a class="headerlink" href="#buildbot.data.connector.DataConnector" title="Permalink to this definition">¶</a></dt>
<dd><p>This class implements the root of the data API.
Within the buildmaster process, the data connector is available at <cite>self.master.data</cite>.
The first three sections are implemented with the <code class="xref py py-meth docutils literal notranslate"><span class="pre">get</span></code> and <a class="reference internal" href="#buildbot.data.connector.DataConnector.control" title="buildbot.data.connector.DataConnector.control"><code class="xref py py-meth docutils literal notranslate"><span class="pre">control</span></code></a> methods, respectively, while the updates section is implemented using the <code class="xref py py-attr docutils literal notranslate"><span class="pre">updates</span></code> attribute.
The <code class="docutils literal notranslate"><span class="pre">path</span></code> arguments to these methods should always be tuples.
Integer arguments can be presented as either integers or strings that can be parsed by <code class="docutils literal notranslate"><span class="pre">int</span></code>; all other arguments must be strings.</p>
<dl class="method">
<dt>
<code class="descname">get(path, filters=None, fields=None, order=None, limit=None, offset=None):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>path</strong> (<em>tuple</em>) – A tuple of path elements representing the API path to fetch.
Numbers can be passed as strings or integers.</li>
<li><strong>filters</strong> – result spec filters</li>
<li><strong>fields</strong> – result spec fields</li>
<li><strong>order</strong> – result spec order</li>
<li><strong>limit</strong> – result spec limit</li>
<li><strong>offset</strong> – result spec offset</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><a class="reference internal" href="#buildbot.data.exceptions.InvalidPathError" title="buildbot.data.exceptions.InvalidPathError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidPathError</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a resource or list via Deferred, or None</p>
</td>
</tr>
</tbody>
</table>
<p>This method implements the getter section.
Depending on the path, it will return a single resource or a list of resources.
If a single resource is not specified, it returns <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">filters</span></code>, <code class="docutils literal notranslate"><span class="pre">fields</span></code>, <code class="docutils literal notranslate"><span class="pre">order</span></code>, <code class="docutils literal notranslate"><span class="pre">limit</span></code>, and <code class="docutils literal notranslate"><span class="pre">offset</span></code> are passed to the <a class="reference internal" href="#buildbot.data.resultspec.ResultSpec" title="buildbot.data.resultspec.ResultSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultSpec</span></code></a> constructor.</p>
<p>The return value is composed of simple Python objects - lists, dicts, strings, numbers, and None.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.connector.DataConnector.getEndpoint">
<code class="descname">getEndpoint</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.connector.DataConnector.getEndpoint" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<em>tuple</em>) – A tuple of path elements representing the API path.
Numbers can be passed as strings or integers.</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><a class="reference internal" href="#buildbot.data.exceptions.InvalidPathError" title="buildbot.data.exceptions.InvalidPathError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidPathError</span></code></a></td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">tuple of endpoint and a dictionary of keyword arguments from the path</td>
</tr>
</tbody>
</table>
<p>Get the endpoint responsible for the given path, along with any arguments extracted from the path.
This can be used by callers that need access to information from the endpoint beyond that returned from <code class="docutils literal notranslate"><span class="pre">get</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.connector.DataConnector.produceEvent">
<code class="descname">produceEvent</code><span class="sig-paren">(</span><em>rtype</em>, <em>msg</em>, <em>event</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.connector.DataConnector.produceEvent" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>rtype</strong> – the name identifying a resource type</li>
<li><strong>msg</strong> – a dictionary describing the msg to send</li>
<li><strong>event</strong> – the event to produce</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method implements the production of an event, for the rtype identified by its name string.
Usually, this is the role of the data layer to produce the events inside the update methods.
For the potential use cases where it would make sense to solely produce an event, and not update data, please use this API, rather than directly call mq.
It ensures the event is sent to all the routingkeys specified by eventPathPatterns.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.connector.DataConnector.control">
<code class="descname">control</code><span class="sig-paren">(</span><em>action</em>, <em>args</em>, <em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.connector.DataConnector.control" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>action</strong> – a short string naming the action to perform</li>
<li><strong>args</strong> – dictionary containing arguments for the action</li>
<li><strong>path</strong> (<em>tuple</em>) – A tuple of path elements representing the API path.
Numbers can be passed as strings or integers.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><a class="reference internal" href="#buildbot.data.exceptions.InvalidPathError" title="buildbot.data.exceptions.InvalidPathError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">InvalidPathError</span></code></a></p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a resource or list via Deferred, or None</p>
</td>
</tr>
</tbody>
</table>
<p>This method implements the control section.
Depending on the path, it may return a new created resource.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.connector.DataConnector.allEndpoints">
<code class="descname">allEndpoints</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.connector.DataConnector.allEndpoints" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of endpoint specifications</td>
</tr>
</tbody>
</table>
<p>This method returns the deprecated API spec.
Please use <a class="reference internal" href="#raml-spec"><span class="std std-ref">Raml Specs</span></a> instead.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.connector.DataConnector.rtypes">
<code class="descname">rtypes</code><a class="headerlink" href="#buildbot.data.connector.DataConnector.rtypes" title="Permalink to this definition">¶</a></dt>
<dd><p>This object has an attribute named for each resource type, named after the singular form (e.g., <cite>self.master.data.builder</cite>).
These attributes allow resource types to access one another for purposes of coordination.
They are <em>not</em> intended for external access – all external access to the data API should be via the methods above or update methods.</p>
</dd></dl>

</dd></dl>

<div class="section" id="id2">
<h7>Updates<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h7>
<p>The updates section is available at <cite>self.master.data.updates</cite>, and contains a number of ad-hoc methods needed by the process modules.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The update methods are implemented in resource type classes, but through some initialization-time magic, all appear as attributes of <code class="docutils literal notranslate"><span class="pre">self.master.data.updates</span></code>.</p>
</div>
<p>The update methods are found in the resource type pages.</p>
</div>
<div class="section" id="module-buildbot.data.exceptions">
<span id="exceptions"></span><h7>Exceptions<a class="headerlink" href="#module-buildbot.data.exceptions" title="Permalink to this headline">¶</a></h7>
<dl class="exception">
<dt id="buildbot.data.exceptions.DataException">
<em class="property">exception </em><code class="descclassname">buildbot.data.exceptions.</code><code class="descname">DataException</code><a class="headerlink" href="#buildbot.data.exceptions.DataException" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a base class for all other Data API exceptions.</p>
</dd></dl>

<dl class="exception">
<dt id="buildbot.data.exceptions.InvalidPathError">
<em class="property">exception </em><code class="descclassname">buildbot.data.exceptions.</code><code class="descname">InvalidPathError</code><a class="headerlink" href="#buildbot.data.exceptions.InvalidPathError" title="Permalink to this definition">¶</a></dt>
<dd><p>The path argument was invalid or unknown.</p>
</dd></dl>

<dl class="exception">
<dt id="buildbot.data.exceptions.InvalidOptionError">
<em class="property">exception </em><code class="descclassname">buildbot.data.exceptions.</code><code class="descname">InvalidOptionError</code><a class="headerlink" href="#buildbot.data.exceptions.InvalidOptionError" title="Permalink to this definition">¶</a></dt>
<dd><p>A value in the <code class="docutils literal notranslate"><span class="pre">options</span></code> argument was invalid or ill-formed.</p>
</dd></dl>

<dl class="exception">
<dt id="buildbot.data.exceptions.SchedulerAlreadyClaimedError">
<em class="property">exception </em><code class="descclassname">buildbot.data.exceptions.</code><code class="descname">SchedulerAlreadyClaimedError</code><a class="headerlink" href="#buildbot.data.exceptions.SchedulerAlreadyClaimedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Identical to <a class="reference internal" href="#buildbot.db.schedulers.SchedulerAlreadyClaimedError" title="buildbot.db.schedulers.SchedulerAlreadyClaimedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">SchedulerAlreadyClaimedError</span></code></a>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="web-interface">
<h6>Web Interface<a class="headerlink" href="#web-interface" title="Permalink to this headline">¶</a></h6>
<p>The HTTP interface is implemented by the <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.www</span></code> package, as configured by the user.
Part of that configuration is a base URL, which is considered a prefix for all paths mentioned here.</p>
<p>See <a class="reference internal" href="#www-base-app"><span class="std std-ref">Base web application</span></a> for more information.</p>
</div>
</div>
<div class="section" id="extending-the-data-api">
<span id="data-model"></span><h5>3.3.2.4. Extending the Data API<a class="headerlink" href="#extending-the-data-api" title="Permalink to this headline">¶</a></h5>
<p>The data API may be extended in various ways: adding new endpoints, new fields to resource types, new update methods, or entirely new resource types.
In any case, you should only extend the API if you plan to submit the extensions to be merged into Buildbot itself.
Private API extensions are strongly discouraged.</p>
<div class="section" id="adding-resource-types">
<h6>Adding Resource Types<a class="headerlink" href="#adding-resource-types" title="Permalink to this headline">¶</a></h6>
<p>You’ll need to use both plural and singular forms of the resource type; in this example, we’ll use ‘pub’ and ‘pubs’.
You can also follow an existing file, like <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/data/changes.py">master/buildbot/data/changes.py</a>, to see when to use which form.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">master/buildbot/data/pubs.py</span></code>, create a subclass of <a class="reference internal" href="#buildbot.data.base.ResourceType" title="buildbot.data.base.ResourceType"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceType</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.data</span> <span class="k">import</span> <span class="n">base</span>

<span class="k">class</span> <span class="nc">Pub</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">ResourceType</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;pub&quot;</span>
    <span class="n">endpoints</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">keyFields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;pubid&#39;</span><span class="p">]</span>

    <span class="k">class</span> <span class="nc">EntityType</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
        <span class="n">pubid</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
        <span class="n">num_taps</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
        <span class="n">closes_at</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>

    <span class="n">entityType</span> <span class="o">=</span> <span class="n">EntityType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<dl class="class">
<dt id="buildbot.data.base.ResourceType">
<em class="property">class </em><code class="descclassname">buildbot.data.base.</code><code class="descname">ResourceType</code><a class="headerlink" href="#buildbot.data.base.ResourceType" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="buildbot.data.base.ResourceType.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.data.base.ResourceType.name" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>The singular, lower-cased name of the resource type.
This becomes the first component in message routing keys.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.base.ResourceType.plural">
<code class="descname">plural</code><a class="headerlink" href="#buildbot.data.base.ResourceType.plural" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>The plural, lower-cased name of the resource type.
This becomes the key containing the data in REST responses.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.base.ResourceType.endpoints">
<code class="descname">endpoints</code><a class="headerlink" href="#buildbot.data.base.ResourceType.endpoints" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<p>Subclasses should set this to a list of endpoint classes for this resource type.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.base.ResourceType.eventPathPatterns">
<code class="descname">eventPathPatterns</code><a class="headerlink" href="#buildbot.data.base.ResourceType.eventPathPatterns" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
<p>This attribute should list the message routes where events should be sent, encoded as a REST like endpoint:</p>
<p><code class="docutils literal notranslate"><span class="pre">pub/:pubid</span></code></p>
<p>In the example above, a call to <code class="docutils literal notranslate"><span class="pre">produceEvent({'pubid':</span> <span class="pre">10,</span> <span class="pre">'name':</span> <span class="pre">'Winchester'},</span> <span class="pre">'opened')</span></code> would result in a message with routing key <code class="docutils literal notranslate"><span class="pre">('pub',</span> <span class="pre">'10',</span> <span class="pre">'opened')</span></code>.</p>
<p>Several paths can be specified in order to be consistent with rest endpoints.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.base.ResourceType.entityType">
<code class="descname">entityType</code><a class="headerlink" href="#buildbot.data.base.ResourceType.entityType" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference internal" href="#buildbot.data.types.Entity" title="buildbot.data.types.Entity"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.data.types.Entity</span></code></a></td>
</tr>
</tbody>
</table>
<p>The entity type describes the types of all of the fields in this particular resource type.
See <a class="reference internal" href="#buildbot.data.types.Entity" title="buildbot.data.types.Entity"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.data.types.Entity</span></code></a> and <a class="reference internal" href="#adding-fields-to-resource-types"><span class="std std-ref">Adding Fields to Resource Types</span></a>.</p>
</dd></dl>

<p>The parent class provides the following methods</p>
<dl class="method">
<dt id="buildbot.data.base.ResourceType.getEndpoints">
<code class="descname">getEndpoints</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.base.ResourceType.getEndpoints" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a list of <a class="reference internal" href="#buildbot.data.base.Endpoint" title="buildbot.data.base.Endpoint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Endpoint</span></code></a> instances</td>
</tr>
</tbody>
</table>
<p>This method returns a list of the endpoint instances associated with the resource type.</p>
<p>The base method instantiates each class in the <a class="reference internal" href="#buildbot.data.base.ResourceType.endpoints" title="buildbot.data.base.ResourceType.endpoints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">endpoints</span></code></a> attribute.
Most subclasses can simply list <a class="reference internal" href="#buildbot.data.base.Endpoint" title="buildbot.data.base.Endpoint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Endpoint</span></code></a> subclasses in <code class="docutils literal notranslate"><span class="pre">endpoints</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.base.ResourceType.produceEvent">
<code class="descname">produceEvent</code><span class="sig-paren">(</span><em>msg</em>, <em>event</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.base.ResourceType.produceEvent" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>msg</strong> (<em>dict</em>) – the message body</li>
<li><strong>event</strong> (<em>string</em>) – the name of the event that has occurred</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This is a convenience method to produce an event message for this resource type.
It formats the routing key correctly and sends the message, thereby ensuring consistent routing-key structure.</p>
</dd></dl>

</dd></dl>

<p>Like all Buildbot source files, every resource type module must have corresponding tests.
These should thoroughly exercise all update methods.</p>
<p>All resource types must be documented in the Buildbot documentation and linked from the bottom of this file (<a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/docs/developer/data.rst">master/docs/developer/data.rst</a>).</p>
</div>
<div class="section" id="adding-endpoints">
<h6>Adding Endpoints<a class="headerlink" href="#adding-endpoints" title="Permalink to this headline">¶</a></h6>
<p>Each resource path is implemented as an <a class="reference internal" href="#buildbot.data.base.Endpoint" title="buildbot.data.base.Endpoint"><code class="xref py py-class docutils literal notranslate"><span class="pre">Endpoint</span></code></a> instance.
In most cases, each instance is of a different class, but this is not required.</p>
<p>The data connector’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">get</span></code> and <a class="reference internal" href="#buildbot.data.connector.DataConnector.control" title="buildbot.data.connector.DataConnector.control"><code class="xref py py-meth docutils literal notranslate"><span class="pre">control</span></code></a> methods both take a <code class="docutils literal notranslate"><span class="pre">path</span></code> argument that is used to look up the corresponding endpoint.
The path matching is performed by <a class="reference internal" href="#module-buildbot.util.pathmatch" title="buildbot.util.pathmatch"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.util.pathmatch</span></code></a>, and supports automatically extracting variable fields from the path.
See that module’s description for details.</p>
<dl class="class">
<dt id="buildbot.data.base.Endpoint">
<em class="property">class </em><code class="descclassname">buildbot.data.base.</code><code class="descname">Endpoint</code><a class="headerlink" href="#buildbot.data.base.Endpoint" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="buildbot.data.base.Endpoint.pathPatterns">
<code class="descname">pathPatterns</code><a class="headerlink" href="#buildbot.data.base.Endpoint.pathPatterns" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>This attribute defines the path patterns which incoming paths must match to select this endpoint.
Paths are specified as URIs, and can contain variables as parsed by <a class="reference internal" href="#buildbot.util.pathmatch.Matcher" title="buildbot.util.pathmatch.Matcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.pathmatch.Matcher</span></code></a>.
Multiple paths are separated by whitespace.</p>
<p>For example, the following specifies two paths with the second having a single variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pathPatterns</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    /bugs</span>
<span class="s2">    /component/i:component_name/bugs</span>
<span class="s2">&quot;&quot;&quot;</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.base.Endpoint.rootLinkName">
<code class="descname">rootLinkName</code><a class="headerlink" href="#buildbot.data.base.Endpoint.rootLinkName" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>If set, then the first path pattern for this endpoint will be included as a link in the root of the API.
This should be set for any endpoints that begin an explorable tree.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.base.Endpoint.isCollection">
<code class="descname">isCollection</code><a class="headerlink" href="#buildbot.data.base.Endpoint.isCollection" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
<p>If true, then this endpoint returns collections of resources.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.base.Endpoint.isRaw">
<code class="descname">isRaw</code><a class="headerlink" href="#buildbot.data.base.Endpoint.isRaw" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
<p>If true, then this endpoint returns raw resource.</p>
<p>Raw resources are used to get the data not encoded in JSON via the rest API.
In the REST principles, this should be done via another endpoint, and not via a query parameter.
The get() method from endpoint should return following data structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;raw&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;raw data to be sent to the http client&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mime-type&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;&lt;mime-type&gt;&quot;</span><span class="p">,</span>
    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;filename_to_be_used_in_content_disposition_attachement_header&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.base.Endpoint.get">
<code class="descname">get</code><span class="sig-paren">(</span><em>options</em>, <em>resultSpec</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.base.Endpoint.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>options</strong> (<em>dict</em>) – model-specific options</li>
<li><strong>resultSpec</strong> – a <a class="reference internal" href="#buildbot.data.resultspec.ResultSpec" title="buildbot.data.resultspec.ResultSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultSpec</span></code></a> instance describing the desired results</li>
<li><strong>kwargs</strong> (<em>dict</em>) – fields extracted from the path</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">data via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get data from the endpoint.
This should return either a list of dictionaries (for list endpoints), a dictionary, or None (both for details endpoints).
The endpoint is free to handle any part of the result spec.
When doing so, it should remove the relevant configuration from the spec.
See below.</p>
<p>Any result spec configuration that remains on return will be applied automatically.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.base.Endpoint.control">
<code class="descname">control</code><span class="sig-paren">(</span><em>action</em>, <em>args</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.base.Endpoint.control" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>action</strong> – a short string naming the action to perform</li>
<li><strong>args</strong> – dictionary containing arguments for the action</li>
<li><strong>kwargs</strong> – fields extracted from the path</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p>Continuing the pub example, a simple endpoint would look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PubEndpoint</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">Endpoint</span><span class="p">):</span>
    <span class="n">pathPattern</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;pub&#39;</span><span class="p">,</span> <span class="s1">&#39;i:pubid&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resultSpec</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">pubs</span><span class="o">.</span><span class="n">getPub</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pubid&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Endpoint implementations must have unit tests.
An endpoint’s path should be documented in the <code class="docutils literal notranslate"><span class="pre">.rst</span></code> file for its resource type.</p>
<p>The initial pass at implementing any endpoint should just ignore the <code class="docutils literal notranslate"><span class="pre">resultSpec</span></code> argument to <code class="docutils literal notranslate"><span class="pre">get</span></code>.
After that initial pass, the argument can be used to optimize certain types of queries.
For example, if the resource type has many resources, but most real-life queries use the result spec to filter out all but a few resources from that group, then it makes sense for the endpoint to examine the result spec and allow the underlying DB API to do that filtering.</p>
<p>When an endpoint handles parts of the result spec, it must remove those parts from the spec before it returns.
See the documentation for <a class="reference internal" href="#buildbot.data.resultspec.ResultSpec" title="buildbot.data.resultspec.ResultSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultSpec</span></code></a> for methods to do so.</p>
<p>Note that endpoints must be careful not to alter the order of the filtering applied for a result spec.
For example, if an endpoint implements pagination, then it must also completely implement filtering and ordering, since those operations precede pagination in the result spec application.</p>
</div>
<div class="section" id="adding-messages">
<h6>Adding Messages<a class="headerlink" href="#adding-messages" title="Permalink to this headline">¶</a></h6>
<p>Message types are defined in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/util/validation.py">master/buildbot/test/util/validation.py</a>, via the <code class="docutils literal notranslate"><span class="pre">message</span></code> module-level value.
This is a dictionary of <code class="docutils literal notranslate"><span class="pre">MessageValidator</span></code> objects, one for each message type.
The message type is determined from the first atom of its routing key.
The <code class="docutils literal notranslate"><span class="pre">events</span></code> dictionary lists the possible last atoms of the routing key.
It should be identical to the attribute of the ResourceType with the same name.</p>
</div>
<div class="section" id="adding-update-methods">
<h6>Adding Update Methods<a class="headerlink" href="#adding-update-methods" title="Permalink to this headline">¶</a></h6>
<p>Update methods are for use by the Buildbot process code, and as such are generally designed to suit the needs of that code.
They generally encapsulate logic common to multiple users (e.g., creating buildsets), and finish by performing modifications in the database and sending a corresponding message.
In general, Buildbot does not depend on timing of either the database or message broker, so the order in which these operations are initiated is not important.</p>
<p>Update methods are considered part of Buildbot’s user-visible interface, and as such incompatible changes should be avoided wherever possible.
Instead, either add a new method (and potentially re-implement existing methods in terms of the new method) or add new, optional parameters to an existing method.
If an incompatible change is unavoidable, it should be described clearly in the release notes.</p>
<p>Update methods are implemented as methods of <a class="reference internal" href="#buildbot.data.base.ResourceType" title="buildbot.data.base.ResourceType"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceType</span></code></a> subclasses, decorated with <code class="docutils literal notranslate"><span class="pre">&#64;base.updateMethod</span></code>:</p>
<dl class="function">
<dt id="buildbot.data.base.updateMethod">
<code class="descclassname">buildbot.data.base.</code><code class="descname">updateMethod</code><span class="sig-paren">(</span><em>f</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.base.updateMethod" title="Permalink to this definition">¶</a></dt>
<dd><p>A decorator for <a class="reference internal" href="#buildbot.data.base.ResourceType" title="buildbot.data.base.ResourceType"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResourceType</span></code></a> subclass methods, indicating that the method should be copied to <code class="docutils literal notranslate"><span class="pre">master.data.updates</span></code>.</p>
</dd></dl>

<p>Returning to the pub example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PubResourceType</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">ResourceType</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="nd">@base</span><span class="o">.</span><span class="n">updateMethod</span>
    <span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
    <span class="k">def</span> <span class="nf">setPubTapList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pubid</span><span class="p">,</span> <span class="n">beers</span><span class="p">):</span>
        <span class="n">pub</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">pubs</span><span class="o">.</span><span class="n">getPub</span><span class="p">(</span><span class="n">pubid</span><span class="p">)</span>
        <span class="c1"># ...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">produceMessage</span><span class="p">(</span><span class="n">pub</span><span class="p">,</span> <span class="s1">&#39;taps-updated&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Update methods should be documented in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/docs/developer/data.rst">master/docs/developer/data.rst</a>.
They should be thoroughly tested with unit tests.
They should have a fake implementation in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/fake/fakedata.py">master/buildbot/test/fake/fakedata.py</a>.
That fake implementation should be tested to match the real implementation in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/unit/test_data_connector.py">master/buildbot/test/unit/test_data_connector.py</a>.</p>
</div>
<div class="section" id="module-buildbot.data.types">
<span id="id3"></span><span id="adding-fields-to-resource-types"></span><h6>Adding Fields to Resource Types<a class="headerlink" href="#module-buildbot.data.types" title="Permalink to this headline">¶</a></h6>
<p>The details of the fields of a resource type are rigorously enforced at several points in the Buildbot tests.
The enforcement is performed by the <a class="reference internal" href="#module-buildbot.data.types" title="buildbot.data.types"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.data.types</span></code></a> module.</p>
<p>The module provides a number of type classes for basic and compound types.
Each resource type class defines its entity type in its <a class="reference internal" href="#buildbot.data.base.ResourceType.entityType" title="buildbot.data.base.ResourceType.entityType"><code class="xref py py-attr docutils literal notranslate"><span class="pre">entityType</span></code></a> class attribute.
Other resource types may refer to this class attribute if they embed an entity of that type.</p>
<p>The types are used both for tests, and by the REST interface to properly decode user-supplied query parameters.</p>
<div class="section" id="basic-types">
<h7>Basic Types<a class="headerlink" href="#basic-types" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.data.types.Integer">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">Integer</code><a class="headerlink" href="#buildbot.data.types.Integer" title="Permalink to this definition">¶</a></dt>
<dd><p>An integer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myid</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.data.types.String">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">String</code><a class="headerlink" href="#buildbot.data.types.String" title="Permalink to this definition">¶</a></dt>
<dd><p>A string.
Strings must always be Unicode.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.data.types.Binary">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">Binary</code><a class="headerlink" href="#buildbot.data.types.Binary" title="Permalink to this definition">¶</a></dt>
<dd><p>A binary bytestring.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Binary</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.data.types.Boolean">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">Boolean</code><a class="headerlink" href="#buildbot.data.types.Boolean" title="Permalink to this definition">¶</a></dt>
<dd><p>A boolean value.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">complete</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Boolean</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.data.types.Identifier">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">Identifier</code><span class="sig-paren">(</span><em>length</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.types.Identifier" title="Permalink to this definition">¶</a></dt>
<dd><p>An identifier; see <a class="reference internal" href="#type-identifier"><span class="std std-ref">Identifier</span></a>.
The constructor argument specifies the maximum length.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ident</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="compound-types">
<h7>Compound Types<a class="headerlink" href="#compound-types" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.data.types.NoneOk">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">NoneOk</code><span class="sig-paren">(</span><em>nestedType</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.types.NoneOk" title="Permalink to this definition">¶</a></dt>
<dd><p>Either the nested type, or None.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">category</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">NoneOk</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.data.types.List">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">List</code><span class="sig-paren">(</span><em>of</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.types.List" title="Permalink to this definition">¶</a></dt>
<dd><p>An list of objects.
The named constructor argument <code class="docutils literal notranslate"><span class="pre">of</span></code> specifies the type of the list elements.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tags</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">of</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.data.types.SourcedProperties">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">SourcedProperties</code><a class="headerlink" href="#buildbot.data.types.SourcedProperties" title="Permalink to this definition">¶</a></dt>
<dd><p>A data structure representing properties with their sources, in the form <code class="docutils literal notranslate"><span class="pre">{name:</span> <span class="pre">(value,</span> <span class="pre">source)}</span></code>.
The property name and source must be Unicode, and the value must be JSON-able.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">props</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SourcedProperties</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="entity-type">
<h7>Entity Type<a class="headerlink" href="#entity-type" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.data.types.Entity">
<em class="property">class </em><code class="descclassname">buildbot.data.types.</code><code class="descname">Entity</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.types.Entity" title="Permalink to this definition">¶</a></dt>
<dd><p>A data resource is represented by a dictionary with well-known keys.
To define those keys and their values, subclass the <a class="reference internal" href="#buildbot.data.types.Entity" title="buildbot.data.types.Entity"><code class="xref py py-class docutils literal notranslate"><span class="pre">Entity</span></code></a> class within your ResourceType class and include each field as an attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStuff</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">ResourceType</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;mystuff&quot;</span>
    <span class="c1"># ...</span>
    <span class="k">class</span> <span class="nc">EntityType</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
        <span class="n">myid</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Binary</span><span class="p">()</span>
        <span class="n">complete</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Boolean</span><span class="p">()</span>
        <span class="n">ident</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Identifier</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">NoneOk</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">of</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">String</span><span class="p">())</span>
        <span class="n">props</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">SourcedProperties</span><span class="p">()</span>
</pre></div>
</div>
<p>Then instantiate the class with the resource type name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">entityType</span> <span class="o">=</span> <span class="n">EntityType</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>To embed another entity type, reference its entityType class attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EntityType</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">Entity</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">master</span> <span class="o">=</span> <span class="n">masters</span><span class="o">.</span><span class="n">Master</span><span class="o">.</span><span class="n">entityType</span>
</pre></div>
</div>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="id4">
<h5>3.3.2.5. Data Model<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>The data api enforces a strong and well-defined model on Buildbot’s data.
This model is influenced by REST, in the sense that it defines resources, representations for resources, and identifiers for resources.
For each resource type, the API specifies</p>
<ul class="simple">
<li>the attributes of the resource and their types (e.g., changes have a string specifying their project);</li>
<li>the format of links to other resources (e.g., buildsets to sourcestamp sets);</li>
<li>the paths relating to the resource type;</li>
<li>the format of routing keys for messages relating to the resource type;</li>
<li>the events that can occur on that resource (e.g., a buildrequest can be claimed); and</li>
<li>options and filters for getting resources.</li>
</ul>
<p>Some resource type attributes only appear in certain formats, as noted in the documentation for the resource types.
In general, messages do not include any optional attributes, nor links.</p>
<p>Paths are given here separated by slashes, with key names prefixed by <code class="docutils literal notranslate"><span class="pre">:</span></code> and described below.
Similarly, message routing keys given here are separated by dots, with key names prefixed by <code class="docutils literal notranslate"><span class="pre">$</span></code>.
The translation to tuples and other formats should be obvious.</p>
<p>All strings in the data model are unicode strings.</p>
</div>
</div>
<span id="document-developer/database"></span><div class="section" id="database">
<span id="developer-database"></span><h4>3.3.3. Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h4>
<p>As of version 0.8.0, Buildbot has used a database as part of its storage
backend.  This section describes the database connector classes, which allow
other parts of Buildbot to access the database.  It also describes how to
modify the database schema and the connector classes themselves.</p>
<div class="section" id="database-overview">
<h5>3.3.3.1. Database Overview<a class="headerlink" href="#database-overview" title="Permalink to this headline">¶</a></h5>
<p>All access to the Buildbot database is mediated by database connector classes.
These classes provide a functional, asynchronous interface to other parts of
Buildbot, and encapsulate the database-specific details in a single location in
the codebase.</p>
<p>The connector API, defined below, is a stable API in Buildbot, and can be
called from any other component.  Given a master <code class="docutils literal notranslate"><span class="pre">master</span></code>, the root of the
database connectors is available at <code class="docutils literal notranslate"><span class="pre">master.db</span></code>, so, for example, the state
connector’s <code class="docutils literal notranslate"><span class="pre">getState</span></code> method is <code class="docutils literal notranslate"><span class="pre">master.db.state.getState</span></code>.</p>
<p>The connectors all use <a class="reference external" href="http://www.sqlalchemy.org/docs/index.html">SQLAlchemy Core</a> to achieve (almost)
database-independent operation.  Note that the SQLAlchemy ORM is not used in
Buildbot.  Database queries are carried out in threads, and report their
results back to the main thread via Twisted Deferreds.</p>
</div>
<div class="section" id="schema">
<h5>3.3.3.2. Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h5>
<p>The database schema is maintained with <a class="reference external" href="https://github.com/openstack/sqlalchemy-migrate">SQLAlchemy-Migrate</a>.  This package handles the
details of upgrading users between different schema versions.</p>
<p>The schema itself is considered an implementation detail, and may change
significantly from version to version.  Users should rely on the API (below),
rather than performing queries against the database itself.</p>
</div>
<div class="section" id="api">
<h5>3.3.3.3. API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h5>
<div class="section" id="types">
<h6>types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h6>
<div class="section" id="identifier">
<h7>Identifier<a class="headerlink" href="#identifier" title="Permalink to this headline">¶</a></h7>
<p id="type-identifier">An “identifier” is a nonempty unicode string of limited length, containing only ASCII alphanumeric characters along with <code class="docutils literal notranslate"><span class="pre">-</span></code> (dash) and <code class="docutils literal notranslate"><span class="pre">_</span></code> (underscore), and not beginning with a digit
Wherever an identifier is used, the documentation will give the maximum length in characters.
The function <a class="reference internal" href="#buildbot.util.identifiers.isIdentifier" title="buildbot.util.identifiers.isIdentifier"><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.util.identifiers.isIdentifier</span></code></a> is useful to verify a well-formed identifier.</p>
</div>
</div>
<div class="section" id="module-buildbot.db.buildrequests">
<span id="buildrequests"></span><h6>buildrequests<a class="headerlink" href="#module-buildbot.db.buildrequests" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-0"></span><dl class="exception">
<dt id="buildbot.db.buildrequests.AlreadyClaimedError">
<em class="property">exception </em><code class="descclassname">buildbot.db.buildrequests.</code><code class="descname">AlreadyClaimedError</code><a class="headerlink" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when a build request is already claimed, usually by another master.</p>
</dd></dl>

<dl class="exception">
<dt id="buildbot.db.buildrequests.NotClaimedError">
<em class="property">exception </em><code class="descclassname">buildbot.db.buildrequests.</code><code class="descname">NotClaimedError</code><a class="headerlink" href="#buildbot.db.buildrequests.NotClaimedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when a build request is not claimed by this master.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.buildrequests.</code><code class="descname">BuildRequestsConnectorComponent</code><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles the complex process of claiming and unclaiming build
requests, based on a polling model: callers poll for unclaimed requests with
<a class="reference internal" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests" title="buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getBuildRequests</span></code></a>, then attempt to claim the requests with
<a class="reference internal" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.claimBuildRequests" title="buildbot.db.buildrequests.BuildRequestsConnectorComponent.claimBuildRequests"><code class="xref py py-meth docutils literal notranslate"><span class="pre">claimBuildRequests</span></code></a>.  The claim can fail if another master has claimed
the request in the interim.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.buildrequests</span></code>.</p>
<p id="index-1">Build requests are indexed by an ID referred to as a <em>brid</em>.  The contents
of a request are represented as build request dictionaries (brdicts) with
keys</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">buildrequestid</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">buildsetid</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">builderid</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">buildername</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">priority</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">claimed</span></code> (boolean, true if the request is claimed)</li>
<li><code class="docutils literal notranslate"><span class="pre">claimed_at</span></code> (datetime object, time this request was last claimed)</li>
<li><code class="docutils literal notranslate"><span class="pre">claimed_by_masterid</span></code> (integer, the id of the master that claimed this buildrequest)</li>
<li><code class="docutils literal notranslate"><span class="pre">complete</span></code> (boolean, true if the request is complete)</li>
<li><code class="docutils literal notranslate"><span class="pre">complete_at</span></code> (datetime object, time this request was completed)</li>
<li><code class="docutils literal notranslate"><span class="pre">submitted_at</span></code> (datetime object, time this request was completed)</li>
<li><code class="docutils literal notranslate"><span class="pre">results</span></code> (integer result code)</li>
<li><code class="docutils literal notranslate"><span class="pre">waited_for</span></code> (boolean)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequest">
<code class="descname">getBuildRequest</code><span class="sig-paren">(</span><em>brid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequest" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>brid</strong> – build request id to look up</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">brdict or <code class="docutils literal notranslate"><span class="pre">None</span></code>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a single BuildRequest, in the format described above.  This method
returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if there is no such buildrequest.  Note that build
requests are not cached, as the values in the database are not fixed.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests">
<code class="descname">getBuildRequests</code><span class="sig-paren">(</span><em>buildername=None</em>, <em>complete=None</em>, <em>claimed=None</em>, <em>bsid=None</em>, <em>branch=None</em>, <em>repository=None</em>, <em>resultSpec=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>buildername</strong> (<em>string</em>) – limit results to buildrequests for this builder</li>
<li><strong>complete</strong> – if true, limit to completed buildrequests; if false,
limit to incomplete buildrequests; if <code class="docutils literal notranslate"><span class="pre">None</span></code>, do not limit based on
completion.</li>
<li><strong>claimed</strong> – see below</li>
<li><strong>bsid</strong> – see below</li>
<li><strong>repository</strong> – the repository associated with the sourcestamps originating the requests</li>
<li><strong>branch</strong> – the branch associated with the sourcestamps originating the requests</li>
<li><strong>resultSpec</strong> – resultSpec containing filters sorting and paging request from data/REST API.
If possible, the db layer can optimize the SQL query using this information.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of brdicts, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a list of build requests matching the given characteristics.</p>
<p>Pass all parameters as keyword parameters to allow future expansion.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">claimed</span></code> parameter can be <code class="docutils literal notranslate"><span class="pre">None</span></code> (the default) to ignore the
claimed status of requests; <code class="docutils literal notranslate"><span class="pre">True</span></code> to return only claimed builds,
<code class="docutils literal notranslate"><span class="pre">False</span></code> to return only unclaimed builds, or a <code class="docutils literal notranslate"><span class="pre">master</span> <span class="pre">ID</span></code> to return only
builds claimed by a particular master instance.  A request is considered
unclaimed if its <code class="docutils literal notranslate"><span class="pre">claimed_at</span></code> column is either NULL or 0, and it is
not complete.  If <code class="docutils literal notranslate"><span class="pre">bsid</span></code> is specified, then only build requests for
that buildset will be returned.</p>
<p>A build is considered completed if its <code class="docutils literal notranslate"><span class="pre">complete</span></code> column is 1; the
<code class="docutils literal notranslate"><span class="pre">complete_at</span></code> column is not consulted.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.claimBuildRequests">
<code class="descname">claimBuildRequests</code><span class="sig-paren">(</span><em>brids</em><span class="optional">[</span>, <em>claimed_at=XX</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.claimBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>brids</strong> (<em>list</em>) – ids of buildrequests to claim</li>
<li><strong>claimed_at</strong> (<em>datetime</em>) – time at which the builds are claimed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="buildbot.db.buildrequests.AlreadyClaimedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AlreadyClaimedError</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Try to “claim” the indicated build requests for this buildmaster
instance.  The resulting deferred will fire normally on success, or
fail with <a class="reference internal" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="buildbot.db.buildrequests.AlreadyClaimedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AlreadyClaimedError</span></code></a> if <em>any</em> of the build
requests are already claimed by another master instance.  In this case,
none of the claims will take effect.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">claimed_at</span></code> is not given, then the current time will be used.</p>
<span class="target" id="index-2"></span><div class="admonition note" id="index-3">
<p class="first admonition-title">Note</p>
<p class="last">On database backends that do not enforce referential integrity
(e.g., SQLite), this method will not prevent claims for nonexistent
build requests.  On database backends that do not support
transactions (MySQL), this method will not properly roll back any
partial claims made before an <a class="reference internal" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="buildbot.db.buildrequests.AlreadyClaimedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">AlreadyClaimedError</span></code></a> is
generated.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.unclaimBuildRequests">
<code class="descname">unclaimBuildRequests</code><span class="sig-paren">(</span><em>brids</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.unclaimBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>brids</strong> (<em>list</em>) – ids of buildrequests to unclaim</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Release this master’s claim on all of the given build requests.  This
will not unclaim requests that are claimed by another master, but will
not fail in this case.  The method does not check whether a request is
completed.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.completeBuildRequests">
<code class="descname">completeBuildRequests</code><span class="sig-paren">(</span><em>brids</em>, <em>results</em><span class="optional">[</span>, <em>complete_at=XX</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.completeBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>brids</strong> (<em>integer</em>) – build request IDs to complete</li>
<li><strong>results</strong> (<em>integer</em>) – integer result code</li>
<li><strong>complete_at</strong> (<em>datetime</em>) – time at which the buildset was completed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#buildbot.db.buildrequests.NotClaimedError" title="buildbot.db.buildrequests.NotClaimedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotClaimedError</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Complete a set of build requests, all of which are owned by this master
instance.  This will fail with <a class="reference internal" href="#buildbot.db.buildrequests.NotClaimedError" title="buildbot.db.buildrequests.NotClaimedError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">NotClaimedError</span></code></a> if the build
request is already completed or does not exist.  If <code class="docutils literal notranslate"><span class="pre">complete_at</span></code> is
not given, the current time will be used.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.builds">
<span id="builds"></span><h6>builds<a class="headerlink" href="#module-buildbot.db.builds" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-4"></span><dl class="class">
<dt id="buildbot.db.builds.BuildsConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.builds.</code><code class="descname">BuildsConnectorComponent</code><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles builds.
One build record is created for each build performed by a master.
This record contains information on the status of the build, as well as links to the resources used in the build: builder, master, worker, etc.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.builds</span></code>.</p>
<p id="index-5">Builds are indexed by <em>buildid</em> and their contents represented as <em>builddicts</em> (build dictionaries), with the following keys:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> (the build ID, globally unique)</li>
<li><code class="docutils literal notranslate"><span class="pre">number</span></code> (the build number, unique only within the builder)</li>
<li><code class="docutils literal notranslate"><span class="pre">builderid</span></code> (the ID of the builder that performed this build)</li>
<li><code class="docutils literal notranslate"><span class="pre">buildrequestid</span></code> (the ID of the build request that caused this build)</li>
<li><code class="docutils literal notranslate"><span class="pre">workerid</span></code> (the ID of the worker on which this build was performed)</li>
<li><code class="docutils literal notranslate"><span class="pre">masterid</span></code> (the ID of the master on which this build was performed)</li>
<li><code class="docutils literal notranslate"><span class="pre">started_at</span></code> (datetime at which this build began)</li>
<li><code class="docutils literal notranslate"><span class="pre">complete_at</span></code> (datetime at which this build finished, or None if it is ongoing)</li>
<li><code class="docutils literal notranslate"><span class="pre">state_string</span></code> (short string describing the build’s state)</li>
<li><code class="docutils literal notranslate"><span class="pre">results</span></code> (results of this build; see <a class="reference internal" href="#build-result-codes"><span class="std std-ref">Build Result Codes</span></a>)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.getBuild">
<code class="descname">getBuild</code><span class="sig-paren">(</span><em>buildid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.getBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>buildid</strong> (<em>integer</em>) – build id</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Build dictionary as above or <code class="docutils literal notranslate"><span class="pre">None</span></code>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a single build, in the format described above.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if there is no such build.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.getBuildByNumber">
<code class="descname">getBuildByNumber</code><span class="sig-paren">(</span><em>builderid</em>, <em>number</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.getBuildByNumber" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>builder</strong> (<em>integer</em>) – builder id</li>
<li><strong>number</strong> (<em>integer</em>) – build number within that builder</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Build dictionary as above or <code class="docutils literal notranslate"><span class="pre">None</span></code>, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a single build, in the format described above, specified by builder and number, rather than build id.
Returns <code class="docutils literal notranslate"><span class="pre">None</span></code> if there is no such build.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.getPrevSuccessfulBuild">
<code class="descname">getPrevSuccessfulBuild</code><span class="sig-paren">(</span><em>builderid</em>, <em>number</em>, <em>ssBuild</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.getPrevSuccessfulBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>builderid</strong> (<em>integer</em>) – builder to get builds for</li>
<li><strong>number</strong> (<em>integer</em>) – the current build number. Previous build will be taken from this number</li>
<li><strong>ssBuild</strong> (<em>list</em>) – the list of sourcestamps for the current build number</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None or a build dictionary</p>
</td>
</tr>
</tbody>
</table>
<p>Returns the last successful build from the current build number with the same repository/repository/codebase</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.getBuilds">
<code class="descname">getBuilds</code><span class="sig-paren">(</span><em>builderid=None</em>, <em>buildrequestid=None</em>, <em>complete=None</em>, <em>resultSpec=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.getBuilds" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>builderid</strong> (<em>integer</em>) – builder to get builds for</li>
<li><strong>buildrequestid</strong> (<em>integer</em>) – buildrequest to get builds for</li>
<li><strong>complete</strong> (<em>boolean</em>) – if not None, filters results based on completeness</li>
<li><strong>resultSpec</strong> – resultSpec containing filters sorting and paging request from data/REST API.
If possible, the db layer can optimize the SQL query using this information.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of build dictionaries as above, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a list of builds, in the format described above.
Each of the parameters limit the resulting set of builds.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.addBuild">
<code class="descname">addBuild</code><span class="sig-paren">(</span><em>builderid</em>, <em>buildrequestid</em>, <em>workerid</em>, <em>masterid</em>, <em>state_string</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.addBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>builderid</strong> (<em>integer</em>) – builder to get builds for</li>
<li><strong>buildrequestid</strong> (<em>integer</em>) – build request id</li>
<li><strong>workerid</strong> (<em>integer</em>) – worker performing the build</li>
<li><strong>masterid</strong> (<em>integer</em>) – master performing the build</li>
<li><strong>state_string</strong> (<em>unicode</em>) – initial state of the build</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">tuple of build ID and build number, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new build to the db, recorded as having started at the current time.
This will invent a new number for the build, unique within the context of the builder.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">setBuildStateString(buildid, state_string):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>buildid</strong> (<em>integer</em>) – build id</li>
<li><strong>state_string</strong> (<em>unicode</em>) – updated state of the build</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Update the state strings for the given build.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.finishBuild">
<code class="descname">finishBuild</code><span class="sig-paren">(</span><em>buildid</em>, <em>results</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.finishBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>buildid</strong> (<em>integer</em>) – build id</li>
<li><strong>results</strong> (<em>integer</em>) – build result</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Mark the given build as finished, with <code class="docutils literal notranslate"><span class="pre">complete_at</span></code> set to the current time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This update is done unconditionally, even if the build is already finished.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.getBuildProperties">
<code class="descname">getBuildProperties</code><span class="sig-paren">(</span><em>buildid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.getBuildProperties" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>buildid</strong> – build ID</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">dictionary mapping property name to <code class="docutils literal notranslate"><span class="pre">value,</span> <span class="pre">source</span></code>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Return the properties for a build, in the same format they were given to <a class="reference internal" href="#buildbot.db.builds.BuildsConnectorComponent.addBuild" title="buildbot.db.builds.BuildsConnectorComponent.addBuild"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addBuild</span></code></a>.</p>
<p>Note that this method does not distinguish a non-existent build from a build with no properties, and returns <code class="docutils literal notranslate"><span class="pre">{}</span></code> in either case.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.setBuildProperty">
<code class="descname">setBuildProperty</code><span class="sig-paren">(</span><em>buildid</em>, <em>name</em>, <em>value</em>, <em>source</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.setBuildProperty" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>buildid</strong> (<em>integer</em>) – build ID</li>
<li><strong>name</strong> (<em>string</em>) – Name of the property to set</li>
<li><strong>value</strong> – Value of the property</li>
<li><strong>source</strong> (<em>string</em>) – Source of the Property to set</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Set a build property.
If no property with that name existed in that build, a new property will be created.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.steps">
<span id="steps"></span><h6>steps<a class="headerlink" href="#module-buildbot.db.steps" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-6"></span><dl class="class">
<dt id="buildbot.db.steps.StepsConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.steps.</code><code class="descname">StepsConnectorComponent</code><a class="headerlink" href="#buildbot.db.steps.StepsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles the steps performed within the context of a build.
Within a build, each step has a unique name and a unique, 0-based number.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.steps</span></code>.</p>
<p id="index-7">Builds are indexed by <em>stepid</em> and their contents represented as <em>stepdicts</em> (step dictionaries), with the following keys:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> (the step ID, globally unique)</li>
<li><code class="docutils literal notranslate"><span class="pre">number</span></code> (the step number, unique only within the build)</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> (the step name, an 50-character <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a> unique only within the build)</li>
<li><code class="docutils literal notranslate"><span class="pre">buildid</span></code> (the ID of the build containing this step)</li>
<li><code class="docutils literal notranslate"><span class="pre">started_at</span></code> (datetime at which this step began)</li>
<li><code class="docutils literal notranslate"><span class="pre">complete_at</span></code> (datetime at which this step finished, or None if it is ongoing)</li>
<li><code class="docutils literal notranslate"><span class="pre">state_string</span></code> (short string describing the step’s state)</li>
<li><code class="docutils literal notranslate"><span class="pre">results</span></code> (results of this step; see <a class="reference internal" href="#build-result-codes"><span class="std std-ref">Build Result Codes</span></a>)</li>
<li><code class="docutils literal notranslate"><span class="pre">urls</span></code> (list of URLs produced by this step. Each urls is stored as a dictionary with keys <cite>name</cite> and <cite>url</cite>)</li>
<li><code class="docutils literal notranslate"><span class="pre">hidden</span></code> (true if the step should be hidden in status displays)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.steps.StepsConnectorComponent.getStep">
<code class="descname">getStep</code><span class="sig-paren">(</span><em>stepid=None</em>, <em>buildid=None</em>, <em>number=None</em>, <em>name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.steps.StepsConnectorComponent.getStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stepid</strong> (<em>integer</em>) – the step id to retrieve</li>
<li><strong>buildid</strong> (<em>integer</em>) – the build from which to get the step</li>
<li><strong>number</strong> (<em>integer</em>) – the step number</li>
<li><strong>name</strong> (50-character <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>) – the step name</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">stepdict via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a single step.
The step can be specified by</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">stepid</span></code> alone;</li>
<li><code class="docutils literal notranslate"><span class="pre">buildid</span></code> and <code class="docutils literal notranslate"><span class="pre">number</span></code>, the step number within that build; or</li>
<li><code class="docutils literal notranslate"><span class="pre">buildid</span></code> and <code class="docutils literal notranslate"><span class="pre">name</span></code>, the unique step name within that build.</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.steps.StepsConnectorComponent.getSteps">
<code class="descname">getSteps</code><span class="sig-paren">(</span><em>buildid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.steps.StepsConnectorComponent.getSteps" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>buildid</strong> (<em>integer</em>) – the build from which to get the step</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of stepdicts, sorted by number, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get all steps in the given build, in order by number.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.steps.StepsConnectorComponent.addStep">
<code class="descname">addStep</code><span class="sig-paren">(</span><em>self</em>, <em>buildid</em>, <em>name</em>, <em>state_string</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.steps.StepsConnectorComponent.addStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>buildid</strong> (<em>integer</em>) – the build to which to add the step</li>
<li><strong>name</strong> (50-character <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>) – the step name</li>
<li><strong>state_string</strong> (<em>unicode</em>) – the initial state of the step</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">tuple of step ID, step number, and step name, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new step to a build.
The given name will be used if it is unique; otherwise, a unique numerical suffix will be appended.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">setStepStateString(stepid, state_string):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stepid</strong> (<em>integer</em>) – step ID</li>
<li><strong>state_string</strong> (<em>unicode</em>) – updated state of the step</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Update the state string for the given step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.steps.StepsConnectorComponent.finishStep">
<code class="descname">finishStep</code><span class="sig-paren">(</span><em>stepid</em>, <em>results</em>, <em>hidden</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.steps.StepsConnectorComponent.finishStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stepid</strong> (<em>integer</em>) – step ID</li>
<li><strong>results</strong> (<em>integer</em>) – step result</li>
<li><strong>hidden</strong> (<em>bool</em>) – true if the step should be hidden</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Mark the given step as finished, with <code class="docutils literal notranslate"><span class="pre">complete_at</span></code> set to the current time.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This update is done unconditionally, even if the steps are already finished.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.steps.StepsConnectorComponent.addURL">
<code class="descname">addURL</code><span class="sig-paren">(</span><em>self</em>, <em>stepid</em>, <em>name</em>, <em>url</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.steps.StepsConnectorComponent.addURL" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stepid</strong> (<em>integer</em>) – the stepid to add the url.</li>
<li><strong>name</strong> (<em>string</em>) – the url name</li>
<li><strong>url</strong> (<em>string</em>) – the actual url</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None via deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new url to a step.
The new url is added to the list of urls.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.logs">
<span id="logs"></span><h6>logs<a class="headerlink" href="#module-buildbot.db.logs" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-8"></span><dl class="class">
<dt id="buildbot.db.logs.LogsConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.logs.</code><code class="descname">LogsConnectorComponent</code><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles log data.
Build steps can have zero or more logs.
Logs are uniquely identified by name within a step.</p>
<p>Information about a log, apart from its contents, is represented as a dictionary with the following keys, referred to as a <em>logdict</em>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> (log ID, globally unique)</li>
<li><code class="docutils literal notranslate"><span class="pre">stepid</span></code> (step ID, indicating the containing step)</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> free-form name of this log</li>
<li><code class="docutils literal notranslate"><span class="pre">slug</span></code> (50-identifier for the log, unique within the step)</li>
<li><code class="docutils literal notranslate"><span class="pre">complete</span></code> (true if the log is complete and will not receive more lines)</li>
<li><code class="docutils literal notranslate"><span class="pre">num_lines</span></code> (number of lines in the log)</li>
<li><code class="docutils literal notranslate"><span class="pre">type</span></code> (log type; see below)</li>
</ul>
<p>Each log has a type that describes how to interpret its contents.
See the <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a> resource type for details.</p>
<p>A log is contains a sequence of newline-separated lines of unicode.
Log line numbering is zero-based.</p>
<p>Each line must be less than 64k when encoded in UTF-8.
Longer lines will be truncated, and a warning logged.</p>
<p>Lines are stored internally in “chunks”, and optionally compressed, but the implementation hides these details from callers.</p>
<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.getLog">
<code class="descname">getLog</code><span class="sig-paren">(</span><em>logid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.getLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>logid</strong> (<em>integer</em>) – ID of the requested log</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">logdict via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a log, identified by logid.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.getLogBySlug">
<code class="descname">getLogBySlug</code><span class="sig-paren">(</span><em>stepid</em>, <em>slug</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.getLogBySlug" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stepid</strong> (<em>integer</em>) – ID of the step containing this log</li>
<li><strong>slug</strong> – slug of the logfile to retrieve</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">logdict via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a log, identified by name within the given step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.getLogs">
<code class="descname">getLogs</code><span class="sig-paren">(</span><em>stepid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.getLogs" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>stepid</strong> (<em>integer</em>) – ID of the step containing the desired logs</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of logdicts via Deferred</td>
</tr>
</tbody>
</table>
<p>Get all logs within the given step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.getLogLines">
<code class="descname">getLogLines</code><span class="sig-paren">(</span><em>logid</em>, <em>first_line</em>, <em>last_line</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.getLogLines" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>logid</strong> (<em>integer</em>) – ID of the log</li>
<li><strong>first_line</strong> – first line to return</li>
<li><strong>last_line</strong> – last line to return</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">see below</p>
</td>
</tr>
</tbody>
</table>
<p>Get a subset of lines for a logfile.</p>
<p>The return value, via Deferred, is a concatenation of newline-terminated strings.
If the requested last line is beyond the end of the logfile, only existing lines will be included.
If the log does not exist, or has no associated lines, this method returns an empty string.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.addLog">
<code class="descname">addLog</code><span class="sig-paren">(</span><em>stepid</em>, <em>name</em>, <em>type</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.addLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stepid</strong> (<em>integer</em>) – ID of the step containing this log</li>
<li><strong>name</strong> (<em>string</em>) – name of the logfile</li>
<li><strong>slug</strong> (<em>50-character identifier</em>) – slug (unique identifier) of the logfile</li>
<li><strong>type</strong> (<em>string</em>) – log type (see above)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><strong>KeyError</strong> – if a log with the given slug already exists in the step</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">ID of the new log, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new log file to the given step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.appendLog">
<code class="descname">appendLog</code><span class="sig-paren">(</span><em>logid</em>, <em>content</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.appendLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>logid</strong> (<em>integer</em>) – ID of the requested log</li>
<li><strong>content</strong> (<em>string</em>) – new content to be appended to the log</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">tuple of first and last line numbers in the new chunk, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Append content to an existing log.
The content must end with a newline.
If the given log does not exist, the method will silently do nothing.</p>
<p>It is not safe to call this method more than once simultaneously for the same <code class="docutils literal notranslate"><span class="pre">logid</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.finishLog">
<code class="descname">finishLog</code><span class="sig-paren">(</span><em>logid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.finishLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>logid</strong> (<em>integer</em>) – ID of the log to mark complete</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Mark a log as complete.</p>
<p>Note that no checking for completeness is performed when appending to a log.
It is up to the caller to avoid further calls to <code class="docutils literal notranslate"><span class="pre">appendLog</span></code> after <code class="docutils literal notranslate"><span class="pre">finishLog</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.compressLog">
<code class="descname">compressLog</code><span class="sig-paren">(</span><em>logid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.compressLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>logid</strong> (<em>integer</em>) – ID of the log to compress</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Compress the given log.
This method performs internal optimizations of a log’s chunks to reduce the space used and make read operations more efficient.
It should only be called for finished logs.
This method may take some time to complete.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.logs.LogsConnectorComponent.deleteOldLogChunks">
<code class="descname">deleteOldLogChunks</code><span class="sig-paren">(</span><em>older_than_timestamp</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.logs.LogsConnectorComponent.deleteOldLogChunks" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>older_than_timestamp</strong> (<em>integer</em>) – the logs whose step’s <code class="docutils literal notranslate"><span class="pre">started_at</span></code> is older than <code class="docutils literal notranslate"><span class="pre">older_than_timestamp</span></code> will be deleted.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Delete old logchunks (helper for the <code class="docutils literal notranslate"><span class="pre">logHorizon</span></code> policy).
Old logs have their logchunks deleted from the database, but they keep their <code class="docutils literal notranslate"><span class="pre">num_lines</span></code> metadata.
They have their types changed to ‘d’, so that the UI can display something meaningful.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.buildsets">
<span id="buildsets"></span><h6>buildsets<a class="headerlink" href="#module-buildbot.db.buildsets" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-9"></span><dl class="class">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.buildsets.</code><code class="descname">BuildsetsConnectorComponent</code><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles getting buildsets into and out of the database.
Buildsets combine multiple build requests that were triggered together.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.buildsets</span></code>.</p>
<p id="index-10">Buildsets are indexed by <em>bsid</em> and their contents represented as <em>bsdicts</em>
(buildset dictionaries), with keys</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">bsid</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">external_idstring</span></code> (arbitrary string for mapping builds externally)</li>
<li><code class="docutils literal notranslate"><span class="pre">reason</span></code> (string; reason these builds were triggered)</li>
<li><code class="docutils literal notranslate"><span class="pre">sourcestamps</span></code> (list of sourcestamps for this buildset, by ID)</li>
<li><code class="docutils literal notranslate"><span class="pre">submitted_at</span></code> (datetime object; time this buildset was created)</li>
<li><code class="docutils literal notranslate"><span class="pre">complete</span></code> (boolean; true if all of the builds for this buildset are complete)</li>
<li><code class="docutils literal notranslate"><span class="pre">complete_at</span></code> (datetime object; time this buildset was completed)</li>
<li><code class="docutils literal notranslate"><span class="pre">results</span></code> (aggregate result of this buildset; see <a class="reference internal" href="#build-result-codes"><span class="std std-ref">Build Result Codes</span></a>)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.addBuildset">
<code class="descname">addBuildset</code><span class="sig-paren">(</span><em>sourcestamps</em>, <em>reason</em>, <em>properties</em>, <em>builderids</em>, <em>external_idstring=None</em>, <em>parent_buildid=None</em>, <em>parent_relationship=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.addBuildset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sourcestamps</strong> (<em>list</em>) – sourcestamps for the new buildset; see below</li>
<li><strong>reason</strong> (<em>short unicode string</em>) – reason for this buildset</li>
<li><strong>properties</strong> (<em>dictionary</em><em>, </em><em>where values are tuples of</em><em> (</em><em>value</em><em>, </em><em>source</em><em>)</em>) – properties for this buildset</li>
<li><strong>builderids</strong> (<em>list of int</em>) – builderids specified by this buildset</li>
<li><strong>external_idstring</strong> (<em>unicode string</em>) – external key to identify this buildset; defaults to None</li>
<li><strong>submitted_at</strong> (<em>datetime</em>) – time this buildset was created; defaults to the current time</li>
<li><strong>parent_buildid</strong> (<em>int</em>) – optional build id that is the parent for this buildset</li>
<li><strong>parent_relationship</strong> (<em>unicode</em>) – relationship identifier for the parent, this is is configured relationship between the parent build, and the childs buildsets</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">buildset ID and buildrequest IDs, via a Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new Buildset to the database, along with BuildRequests for each builder, returning the resulting bsid via a Deferred.
Arguments should be specified by keyword.</p>
<p>Each sourcestamp in the list of sourcestamps can be given either as an integer, assumed to be a sourcestamp ID, or a dictionary of keyword arguments to be passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">findSourceStampId</span></code>.</p>
<p>The return value is a tuple <code class="docutils literal notranslate"><span class="pre">(bsid,</span> <span class="pre">brids)</span></code> where <code class="docutils literal notranslate"><span class="pre">bsid</span></code> is the inserted buildset ID and <code class="docutils literal notranslate"><span class="pre">brids</span></code> is a dictionary mapping builderids to build request IDs.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.completeBuildset">
<code class="descname">completeBuildset</code><span class="sig-paren">(</span><em>bsid</em>, <em>results</em><span class="optional">[</span>, <em>complete_at=XX</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.completeBuildset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>bsid</strong> (<em>integer</em>) – buildset ID to complete</li>
<li><strong>results</strong> (<em>integer</em>) – integer result code</li>
<li><strong>complete_at</strong> (<em>datetime</em>) – time the buildset was completed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">KeyError</span></code> if the buildset does not exist or is
already complete</p>
</td>
</tr>
</tbody>
</table>
<p>Complete a buildset, marking it with the given <code class="docutils literal notranslate"><span class="pre">results</span></code> and setting
its <code class="docutils literal notranslate"><span class="pre">completed_at</span></code> to the current time, if the <code class="docutils literal notranslate"><span class="pre">complete_at</span></code>
argument is omitted.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildset">
<code class="descname">getBuildset</code><span class="sig-paren">(</span><em>bsid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bsid</strong> – buildset ID</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">bsdict, or <code class="docutils literal notranslate"><span class="pre">None</span></code>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a bsdict representing the given buildset, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no such
buildset exists.</p>
<p>Note that buildsets are not cached, as the values in the database are
not fixed.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildsets">
<code class="descname">getBuildsets</code><span class="sig-paren">(</span><em>complete=None</em>, <em>resultSpec=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildsets" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>complete</strong> – if true, return only complete buildsets; if false,
return only incomplete buildsets; if <code class="docutils literal notranslate"><span class="pre">None</span></code> or omitted, return all
buildsets</li>
<li><strong>resultSpec</strong> – resultSpec containing filters sorting and paging request from data/REST API.
If possible, the db layer can optimize the SQL query using this information.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of bsdicts, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a list of bsdicts matching the given criteria.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">getRecentBuildsets(count=None, branch=None, repository=None,</code></dt>
<dt>
<code class="descname">complete=None):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>count</strong> (<em>integer</em>) – maximum number of buildsets to retrieve (required).</li>
<li><strong>branch</strong> (<em>string</em>) – optional branch name. If specified, only buildsets
affecting such branch will be returned.</li>
<li><strong>repository</strong> (<em>string</em>) – optional repository name. If specified, only
buildsets affecting such repository will be returned.</li>
<li><strong>complete</strong> (<a class="reference internal" href="#buildbot.data.types.Boolean" title="buildbot.data.types.Boolean"><em>Boolean</em></a>) – if true, return only complete buildsets; if false,
return only incomplete buildsets; if <code class="docutils literal notranslate"><span class="pre">None</span></code> or omitted, return all
buildsets</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of bsdicts, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get “recent” buildsets, as defined by their <code class="docutils literal notranslate"><span class="pre">submitted_at</span></code> times.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildsetProperties">
<code class="descname">getBuildsetProperties</code><span class="sig-paren">(</span><em>buildsetid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildsetProperties" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bsid</strong> – buildset ID</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">dictionary mapping property name to <code class="docutils literal notranslate"><span class="pre">value,</span> <span class="pre">source</span></code>, via
Deferred</td>
</tr>
</tbody>
</table>
<p>Return the properties for a buildset, in the same format they were
given to <a class="reference internal" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.addBuildset" title="buildbot.db.buildsets.BuildsetsConnectorComponent.addBuildset"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addBuildset</span></code></a>.</p>
<p>Note that this method does not distinguish a nonexistent buildset from
a buildset with no properties, and returns <code class="docutils literal notranslate"><span class="pre">{}</span></code> in either case.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.workers">
<span id="workers"></span><h6>workers<a class="headerlink" href="#module-buildbot.db.workers" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-11"></span><dl class="class">
<dt id="buildbot.db.workers.WorkersConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.workers.</code><code class="descname">WorkersConnectorComponent</code><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles Buildbot’s notion of workers.
The worker information is returned as a dictionary:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> - the name of the worker</li>
<li><code class="docutils literal notranslate"><span class="pre">workerinfo</span></code> - worker information as dictionary</li>
<li><code class="docutils literal notranslate"><span class="pre">paused</span></code> - boolean indicating worker is paused and shall not take new builds</li>
<li><code class="docutils literal notranslate"><span class="pre">graceful</span></code> - boolean indicating worker will be shutdown as soon as build finished</li>
<li><code class="docutils literal notranslate"><span class="pre">connected_to</span></code> - a list of masters, by ID, to which this worker is currently connected.
This list will typically contain only one master, but in unusual circumstances the same worker may appear to be connected to multiple masters simultaneously.</li>
<li><code class="docutils literal notranslate"><span class="pre">configured_on</span></code> - a list of master-builder pairs, on which this worker is configured.
Each pair is represented by a dictionary with keys <code class="docutils literal notranslate"><span class="pre">buliderid</span></code> and <code class="docutils literal notranslate"><span class="pre">masterid</span></code>.</li>
</ul>
<p>The worker information can be any JSON-able object.
See <a class="reference internal" href="#rtype-worker" title="worker"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">worker</span></code></a> for more detail.</p>
<dl class="method">
<dt id="buildbot.db.workers.WorkersConnectorComponent.findWorkerId">
<code class="descname">findWorkerId</code><span class="sig-paren">(</span><em>name=name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent.findWorkerId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> (<em>50-character identifier</em>) – worker name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">worker ID via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the ID for a worker, adding a new worker to the database if necessary.
The worker information for a new worker is initialized to an empty dictionary.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.workers.WorkersConnectorComponent.getWorkers">
<code class="descname">getWorkers</code><span class="sig-paren">(</span><em>masterid=None</em>, <em>builderid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent.getWorkers" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>masterid</strong> (<em>integer</em>) – limit to workers configured on this master</li>
<li><strong>builderid</strong> (<em>integer</em>) – limit to workers configured on this builder</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of worker dictionaries, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a list of workers.
If either or both of the filtering parameters either specified, then the result is limited to workers configured to run on that master or builder.
The <code class="docutils literal notranslate"><span class="pre">configured_on</span></code> results are limited by the filtering parameters as well.
The <code class="docutils literal notranslate"><span class="pre">connected_to</span></code> results are limited by the <code class="docutils literal notranslate"><span class="pre">masterid</span></code> parameter.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.workers.WorkersConnectorComponent.getWorker">
<code class="descname">getWorker</code><span class="sig-paren">(</span><em>workerid=None</em>, <em>name=None</em>, <em>masterid=None</em>, <em>builderid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent.getWorker" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (<em>string</em>) – the name of the worker to retrieve</li>
<li><strong>workerid</strong> (<em>integer</em>) – the ID of the worker to retrieve</li>
<li><strong>masterid</strong> (<em>integer</em>) – limit to workers configured on this master</li>
<li><strong>builderid</strong> (<em>integer</em>) – limit to workers configured on this builder</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">info dictionary or None, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Looks up the worker with the given name or ID, returning <code class="docutils literal notranslate"><span class="pre">None</span></code> if no matching worker is found.
The <code class="docutils literal notranslate"><span class="pre">masterid</span></code> and <code class="docutils literal notranslate"><span class="pre">builderid</span></code> arguments function as they do for <a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent.getWorkers" title="buildbot.db.workers.WorkersConnectorComponent.getWorkers"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getWorkers</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.workers.WorkersConnectorComponent.workerConnected">
<code class="descname">workerConnected</code><span class="sig-paren">(</span><em>workerid</em>, <em>masterid</em>, <em>workerinfo</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent.workerConnected" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>workerid</strong> (<em>integer</em>) – the ID of the worker</li>
<li><strong>masterid</strong> (<em>integer</em>) – the ID of the master to which it connected</li>
<li><strong>workerinfo</strong> (<em>dict</em>) – the new worker information dictionary</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Record the given worker as attached to the given master, and update its cached worker information.
The supplied information completely replaces any existing information.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.workers.WorkersConnectorComponent.workerDisconnected">
<code class="descname">workerDisconnected</code><span class="sig-paren">(</span><em>workerid</em>, <em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent.workerDisconnected" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>workerid</strong> (<em>integer</em>) – the ID of the worker</li>
<li><strong>masterid</strong> (<em>integer</em>) – the ID of the master to which it connected</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Record the given worker as no longer attached to the given master.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.workers.WorkersConnectorComponent.workerConfigured">
<code class="descname">workerConfigured</code><span class="sig-paren">(</span><em>workerid</em>, <em>masterid</em>, <em>builderids</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent.workerConfigured" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>workerid</strong> (<em>integer</em>) – the ID of the worker</li>
<li><strong>masterid</strong> (<em>integer</em>) – the ID of the master to which it configured</li>
<li><strong>of integer builderids</strong> (<em>list</em>) – the ID of the builders to which it is configured</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Record the given worker as being configured on the given master and for given builders.
This method will also remove any other builder that were configured previously for same (worker, master) combination.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.workers.WorkersConnectorComponent.deconfigureAllWorkersForMaster">
<code class="descname">deconfigureAllWorkersForMaster</code><span class="sig-paren">(</span><em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent.deconfigureAllWorkersForMaster" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>masterid</strong> (<em>integer</em>) – the ID of the master to which it configured</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Unregister all the workers configured to a master for given builders.
This shall happen when master disabled or before reconfiguration</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.workers.WorkersConnectorComponent.setWorkerState">
<code class="descname">setWorkerState</code><span class="sig-paren">(</span><em>workerid</em>, <em>paused</em>, <em>graceful</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.workers.WorkersConnectorComponent.setWorkerState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>workerid</strong> (<em>integer</em>) – the ID of the worker whose state is being changed</li>
<li><strong>paused</strong> (<em>integer</em>) – the paused state</li>
<li><strong>graceful</strong> (<em>integer</em>) – the graceful state</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Change the state of a worker (see definition of states above in worker dict description)</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.changes">
<span id="changes"></span><h6>changes<a class="headerlink" href="#module-buildbot.db.changes" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-12"></span><dl class="class">
<dt id="buildbot.db.changes.ChangesConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.changes.</code><code class="descname">ChangesConnectorComponent</code><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles changes in the buildbot database, including pulling
information from the changes sub-tables.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.changes</span></code>.</p>
<p id="index-13">Changes are indexed by <em>changeid</em>, and are represented by a <em>chdict</em>, which
has the following keys:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">changeid</span></code> (the ID of this change)</li>
<li><code class="docutils literal notranslate"><span class="pre">parent_changeids</span></code> (list of ID; change’s parents)</li>
<li><code class="docutils literal notranslate"><span class="pre">author</span></code> (unicode; the author of the change)</li>
<li><code class="docutils literal notranslate"><span class="pre">files</span></code> (list of unicode; source-code filenames changed)</li>
<li><code class="docutils literal notranslate"><span class="pre">comments</span></code> (unicode; user comments)</li>
<li><code class="docutils literal notranslate"><span class="pre">is_dir</span></code> (deprecated)</li>
<li><code class="docutils literal notranslate"><span class="pre">links</span></code> (list of unicode; links for this change, e.g., to web views,
review)</li>
<li><code class="docutils literal notranslate"><span class="pre">revision</span></code> (unicode string; revision for this change, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if
unknown)</li>
<li><code class="docutils literal notranslate"><span class="pre">when_timestamp</span></code> (datetime instance; time of the change)</li>
<li><code class="docutils literal notranslate"><span class="pre">branch</span></code> (unicode string; branch on which the change took place, or
<code class="docutils literal notranslate"><span class="pre">None</span></code> for the “default branch”, whatever that might mean)</li>
<li><code class="docutils literal notranslate"><span class="pre">category</span></code> (unicode string; user-defined category of this change, or
<code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">revlink</span></code> (unicode string; link to a web view of this change)</li>
<li><code class="docutils literal notranslate"><span class="pre">properties</span></code> (user-specified properties for this change, represented as
a dictionary mapping keys to (value, source))</li>
<li><code class="docutils literal notranslate"><span class="pre">repository</span></code> (unicode string; repository where this change occurred)</li>
<li><code class="docutils literal notranslate"><span class="pre">project</span></code> (unicode string; user-defined project to which this change
corresponds)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getParentChangeIds">
<code class="descname">getParentChangeIds</code><span class="sig-paren">(</span><em>branch</em>, <em>repository</em>, <em>project</em>, <em>codebase</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getParentChangeIds" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>branch</strong> (<em>unicode string</em>) – the branch of the change</li>
<li><strong>repository</strong> (<em>unicode string</em>) – the repository in which this change took place</li>
<li><strong>project</strong> (<em>unicode string</em>) – the project this change is a part of</li>
<li><strong>codebase</strong> (<em>unicode string</em>) – </li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>return the last changeID which matches the repository/project/codebase</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.addChange">
<code class="descname">addChange</code><span class="sig-paren">(</span><em>author=None</em>, <em>files=None</em>, <em>comments=None</em>, <em>is_dir=0</em>, <em>links=None</em>, <em>revision=None</em>, <em>when_timestamp=None</em>, <em>branch=None</em>, <em>category=None</em>, <em>revlink=''</em>, <em>properties={}</em>, <em>repository=''</em>, <em>project=''</em>, <em>uid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.addChange" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>author</strong> (<em>unicode string</em>) – the author of this change</li>
<li><strong>files</strong> – a list of filenames that were changed</li>
<li><strong>comments</strong> – user comments on the change</li>
<li><strong>is_dir</strong> – deprecated</li>
<li><strong>links</strong> (<em>list of unicode strings</em>) – a list of links related to this change, e.g., to web
viewers or review pages</li>
<li><strong>revision</strong> (<em>unicode string</em>) – the revision identifier for this change</li>
<li><strong>when_timestamp</strong> (<em>datetime instance</em><em> or </em><em>None</em>) – when this change occurred, or the current time
if None</li>
<li><strong>branch</strong> (<em>unicode string</em>) – the branch on which this change took place</li>
<li><strong>category</strong> (<em>unicode string</em>) – category for this change (arbitrary use by Buildbot
users)</li>
<li><strong>revlink</strong> (<em>unicode string</em>) – link to a web view of this revision</li>
<li><strong>properties</strong> (<em>dictionary</em>) – properties to set on this change, where values are
tuples of (value, source).  At the moment, the source must be
<code class="docutils literal notranslate"><span class="pre">'Change'</span></code>, although this may be relaxed in later versions.</li>
<li><strong>repository</strong> (<em>unicode string</em>) – the repository in which this change took place</li>
<li><strong>project</strong> (<em>unicode string</em>) – the project this change is a part of</li>
<li><strong>uid</strong> (<em>integer</em>) – uid generated for the change author</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">new change’s ID via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a Change with the given attributes to the database, returning the
changeid via a Deferred.  All arguments should be given as keyword
arguments.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">project</span></code> and <code class="docutils literal notranslate"><span class="pre">repository</span></code> arguments must be strings; <code class="docutils literal notranslate"><span class="pre">None</span></code>
is not allowed.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getChange">
<code class="descname">getChange</code><span class="sig-paren">(</span><em>changeid</em>, <em>no_cache=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getChange" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>changeid</strong> – the id of the change instance to fetch</li>
<li><strong>no_cache</strong> (<em>boolean</em>) – bypass cache and always fetch from database</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">chdict via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a change dictionary for the given changeid, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no such
change exists.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getChangeUids">
<code class="descname">getChangeUids</code><span class="sig-paren">(</span><em>changeid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getChangeUids" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>changeid</strong> – the id of the change instance to fetch</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of uids via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the userids associated with the given changeid.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getRecentChanges">
<code class="descname">getRecentChanges</code><span class="sig-paren">(</span><em>count</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getRecentChanges" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>count</strong> – maximum number of instances to return</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of dictionaries via Deferred, ordered by changeid</td>
</tr>
</tbody>
</table>
<p>Get a list of the <code class="docutils literal notranslate"><span class="pre">count</span></code> most recent changes, represented as
dictionaries; returns fewer if that many do not exist.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For this function, “recent” is determined by the order of the
changeids, not by <code class="docutils literal notranslate"><span class="pre">when_timestamp</span></code>.  This is most apparent in
DVCS’s, where the timestamp of a change may be significantly
earlier than the time at which it is merged into a repository
monitored by Buildbot.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getChanges">
<code class="descname">getChanges</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getChanges" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of dictionaries via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a list of the changes, represented as
dictionaries; changes are sorted, and paged using generic data query options</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getChangesCount">
<code class="descname">getChangesCount</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getChangesCount" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of dictionaries via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the number changes, that the query option would return if no
paging option where set</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getLatestChangeid">
<code class="descname">getLatestChangeid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getLatestChangeid" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">changeid via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the most-recently-assigned changeid, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if there are no
changes at all.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getChangesForBuild">
<code class="descname">getChangesForBuild</code><span class="sig-paren">(</span><em>buildid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getChangesForBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>buildid</strong> – ID of the build</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of dictionaries via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the “blame” list of changes for a build.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getChangeFromSSid">
<code class="descname">getChangeFromSSid</code><span class="sig-paren">(</span><em>sourcestampid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getChangeFromSSid" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sourcestampid</strong> – ID of the sourcestampid</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">chdict via Deferred</td>
</tr>
</tbody>
</table>
<p>returns the change dictionary related to the sourcestamp ID.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.changesources">
<span id="changesources"></span><h6>changesources<a class="headerlink" href="#module-buildbot.db.changesources" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-14"></span><dl class="exception">
<dt id="buildbot.db.changesources.ChangeSourceAlreadyClaimedError">
<em class="property">exception </em><code class="descclassname">buildbot.db.changesources.</code><code class="descname">ChangeSourceAlreadyClaimedError</code><a class="headerlink" href="#buildbot.db.changesources.ChangeSourceAlreadyClaimedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when a changesource request is already claimed by another master.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.db.changesources.ChangeSourcesConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.changesources.</code><code class="descname">ChangeSourcesConnectorComponent</code><a class="headerlink" href="#buildbot.db.changesources.ChangeSourcesConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class manages the state of the Buildbot changesources.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.changesources</span></code>.</p>
<p>Changesources are identified by their changesourceid, which can be obtained from <a class="reference internal" href="#buildbot.db.changesources.ChangeSourcesConnectorComponent.findChangeSourceId" title="buildbot.db.changesources.ChangeSourcesConnectorComponent.findChangeSourceId"><code class="xref py py-meth docutils literal notranslate"><span class="pre">findChangeSourceId</span></code></a>.</p>
<p>Changesources are represented by dictionaries with the following keys:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> - changesource’s ID</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> - changesource’s name</li>
<li><code class="docutils literal notranslate"><span class="pre">masterid</span></code> - ID of the master currently running this changesource, or None if it is inactive</li>
</ul>
</div></blockquote>
<p>Note that this class is conservative in determining what changesources are inactive: a changesource linked to an inactive master is still considered active.
This situation should never occur, however; links to a master should be deleted when it is marked inactive.</p>
<dl class="method">
<dt id="buildbot.db.changesources.ChangeSourcesConnectorComponent.findChangeSourceId">
<code class="descname">findChangeSourceId</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changesources.ChangeSourcesConnectorComponent.findChangeSourceId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> – changesource name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">changesource ID via Deferred</td>
</tr>
</tbody>
</table>
<p>Return the changesource ID for the changesource with this name.
If such a changesource is already in the database, this returns the ID.
If not, the changesource is added to the database and its ID returned.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changesources.ChangeSourcesConnectorComponent.setChangeSourceMaster">
<code class="descname">setChangeSourceMaster</code><span class="sig-paren">(</span><em>changesourceid</em>, <em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changesources.ChangeSourcesConnectorComponent.setChangeSourceMaster" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>changesourceid</strong> – changesource to set the master for</li>
<li><strong>masterid</strong> – new master for this changesource, or None</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Set, or unset if <code class="docutils literal notranslate"><span class="pre">masterid</span></code> is None, the active master for this changesource.
If no master is currently set, or the current master is not active, this method will complete without error.
If the current master is active, this method will raise <code class="xref py py-exc docutils literal notranslate"><span class="pre">ChangeSourceAlreadyClaimedError</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changesources.ChangeSourcesConnectorComponent.getChangeSource">
<code class="descname">getChangeSource</code><span class="sig-paren">(</span><em>changesourceid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changesources.ChangeSourcesConnectorComponent.getChangeSource" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>changesourceid</strong> – changesource ID</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">changesource dictionary or None, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the changesource dictionary for the given changesource.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changesources.ChangeSourcesConnectorComponent.getChangeSources">
<code class="descname">getChangeSources</code><span class="sig-paren">(</span><em>active=None</em>, <em>masterid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.changesources.ChangeSourcesConnectorComponent.getChangeSources" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>active</strong> (<em>boolean</em>) – if specified, filter for active or inactive changesources</li>
<li><strong>masterid</strong> (<em>integer</em>) – if specified, only return changesources attached associated with this master</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of changesource dictionaries in unspecified order</p>
</td>
</tr>
</tbody>
</table>
<p>Get a list of changesources.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">active</span></code> is given, changesources are filtered according to whether they are active (true) or inactive (false).
An active changesource is one that is claimed by an active master.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">masterid</span></code> is given, the list is restricted to schedulers associated with that master.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.schedulers">
<span id="schedulers"></span><h6>schedulers<a class="headerlink" href="#module-buildbot.db.schedulers" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-15"></span><dl class="exception">
<dt id="buildbot.db.schedulers.SchedulerAlreadyClaimedError">
<em class="property">exception </em><code class="descclassname">buildbot.db.schedulers.</code><code class="descname">SchedulerAlreadyClaimedError</code><a class="headerlink" href="#buildbot.db.schedulers.SchedulerAlreadyClaimedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when a scheduler request is already claimed by another master.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.schedulers.</code><code class="descname">SchedulersConnectorComponent</code><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class manages the state of the Buildbot schedulers.  This state includes
classifications of as-yet un-built changes.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.schedulers</span></code>.</p>
<p>Schedulers are identified by their schedulerid, which can be obtained from <a class="reference internal" href="#findSchedulerId" title="findSchedulerId"><code class="xref py py-meth docutils literal notranslate"><span class="pre">findSchedulerId</span></code></a>.</p>
<p>Schedulers are represented by dictionaries with the following keys:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> - scheduler’s ID</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> - scheduler’s name</li>
<li><code class="docutils literal notranslate"><span class="pre">masterid</span></code> - ID of the master currently running this scheduler, or None if it is inactive</li>
</ul>
</div></blockquote>
<p>Note that this class is conservative in determining what schedulers are inactive: a scheduler linked to an inactive master is still considered active.
This situation should never occur, however; links to a master should be deleted when it is marked inactive.</p>
<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.classifyChanges">
<code class="descname">classifyChanges</code><span class="sig-paren">(</span><em>objectid</em>, <em>classifications</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.classifyChanges" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>schedulerid</strong> – ID of the scheduler classifying the changes</li>
<li><strong>classifications</strong> (<em>dictionary</em>) – mapping of changeid to boolean, where the boolean
is true if the change is important, and false if it is unimportant</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Record the given classifications.  This method allows a scheduler to
record which changes were important and which were not immediately,
even if the build based on those changes will not occur for some time
(e.g., a tree stable timer).  Schedulers should be careful to flush
classifications once they are no longer needed, using
<a class="reference internal" href="#buildbot.db.schedulers.SchedulersConnectorComponent.flushChangeClassifications" title="buildbot.db.schedulers.SchedulersConnectorComponent.flushChangeClassifications"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flushChangeClassifications</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.flushChangeClassifications">
<code class="descname">flushChangeClassifications</code><span class="sig-paren">(</span><em>objectid</em>, <em>less_than=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.flushChangeClassifications" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>schedulerid</strong> – ID of the scheduler owning the flushed changes</li>
<li><strong>less_than</strong> – (optional) lowest changeid that should <em>not</em> be flushed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Flush all scheduler_changes for the given scheduler, limiting to those
with changeid less than <code class="docutils literal notranslate"><span class="pre">less_than</span></code> if the parameter is supplied.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.getChangeClassifications">
<code class="descname">getChangeClassifications</code><span class="sig-paren">(</span><em>objectid</em><span class="optional">[</span>, <em>branch</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.getChangeClassifications" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>schedulerid</strong> (<em>integer</em>) – ID of scheduler to look up changes for</li>
<li><strong>branch</strong> (<em>string</em><em> or </em><em>None</em><em> (</em><em>for default branch</em><em>)</em>) – (optional) limit to changes with this branch</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Return the classifications made by this scheduler, in the form of a
dictionary mapping changeid to a boolean, just as supplied to
<a class="reference internal" href="#buildbot.db.schedulers.SchedulersConnectorComponent.classifyChanges" title="buildbot.db.schedulers.SchedulersConnectorComponent.classifyChanges"><code class="xref py py-meth docutils literal notranslate"><span class="pre">classifyChanges</span></code></a>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">branch</span></code> is specified, then only changes on that branch will be
given.  Note that specifying <code class="docutils literal notranslate"><span class="pre">branch=None</span></code> requests changes for the
default branch, and is not the same as omitting the <code class="docutils literal notranslate"><span class="pre">branch</span></code> argument
altogether.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.findSchedulerId">
<code class="descname">findSchedulerId</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.findSchedulerId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> – scheduler name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">scheduler ID via Deferred</td>
</tr>
</tbody>
</table>
<p>Return the scheduler ID for the scheduler with this name.
If such a scheduler is already in the database, this returns the ID.
If not, the scheduler is added to the database and its ID returned.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.setSchedulerMaster">
<code class="descname">setSchedulerMaster</code><span class="sig-paren">(</span><em>schedulerid</em>, <em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.setSchedulerMaster" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>schedulerid</strong> – scheduler to set the master for</li>
<li><strong>masterid</strong> – new master for this scheduler, or None</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Set, or unset if <code class="docutils literal notranslate"><span class="pre">masterid</span></code> is None, the active master for this scheduler.
If no master is currently set, or the current master is not active, this method will complete without error.
If the current master is active, this method will raise <code class="xref py py-exc docutils literal notranslate"><span class="pre">SchedulerAlreadyClaimedError</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.getScheduler">
<code class="descname">getScheduler</code><span class="sig-paren">(</span><em>schedulerid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.getScheduler" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>schedulerid</strong> – scheduler ID</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">scheduler dictionary or None via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the scheduler dictionary for the given scheduler.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.getSchedulers">
<code class="descname">getSchedulers</code><span class="sig-paren">(</span><em>active=None</em>, <em>masterid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.getSchedulers" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>active</strong> (<em>boolean</em>) – if specified, filter for active or inactive schedulers</li>
<li><strong>masterid</strong> (<em>integer</em>) – if specified, only return schedulers attached associated with this master</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of scheduler dictionaries in unspecified order</p>
</td>
</tr>
</tbody>
</table>
<p>Get a list of schedulers.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">active</span></code> is given, schedulers are filtered according to whether they are active (true) or inactive (false).
An active scheduler is one that is claimed by an active master.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">masterid</span></code> is given, the list is restricted to schedulers associated with that master.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.sourcestamps">
<span id="sourcestamps"></span><h6>sourcestamps<a class="headerlink" href="#module-buildbot.db.sourcestamps" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-16"></span><dl class="class">
<dt id="buildbot.db.sourcestamps.SourceStampsConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.sourcestamps.</code><code class="descname">SourceStampsConnectorComponent</code><a class="headerlink" href="#buildbot.db.sourcestamps.SourceStampsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class manages source stamps, as stored in the database.
A source stamp uniquely identifies a particular version a single codebase.
Source stamps are identified by their ID.
It is safe to use sourcestamp ID equality as a proxy for source stamp equality.
For example, all builds of a particular version of a codebase will share the same sourcestamp ID.
This equality does not extend to patches: two sourcestamps generated with exactly the same patch will have different IDs.</p>
<p>Relative source stamps have a <code class="docutils literal notranslate"><span class="pre">revision</span></code> of None, meaning “whatever the latest is when this sourcestamp is interpreted”.
While such source stamps may correspond to a wide array of revisions over the lifetime of a buildbot install, they will only ever have one ID.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.sourcestamps</span></code>.</p>
<ul class="simple" id="index-17">
<li><code class="docutils literal notranslate"><span class="pre">ssid</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">branch</span></code> (branch, or <code class="docutils literal notranslate"><span class="pre">None</span></code> for default branch)</li>
<li><code class="docutils literal notranslate"><span class="pre">revision</span></code> (revision, or <code class="docutils literal notranslate"><span class="pre">None</span></code> to indicate the latest revision, in
which case this is a relative source stamp)</li>
<li><code class="docutils literal notranslate"><span class="pre">patchid</span></code> (ID of the patch)</li>
<li><code class="docutils literal notranslate"><span class="pre">patch_body</span></code> (body of the patch, or <code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">patch_level</span></code> (directory stripping level of the patch, or <code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">patch_subdir</span></code> (subdirectory in which to apply the patch, or <code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">patch_author</span></code> (author of the patch, or <code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">patch_comment</span></code> (comment for the patch, or <code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">repository</span></code> (repository containing the source; never <code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">project</span></code> (project this source is for; never <code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">codebase</span></code> (codebase this stamp is in; never <code class="docutils literal notranslate"><span class="pre">None</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">created_at</span></code> (timestamp when this stamp was first created)</li>
</ul>
<p>Note that the patch body is a bytestring, not a unicode string.</p>
<dl class="method">
<dt>
<code class="descname">findSourceStampId(branch=None, revision=Node,</code></dt>
<dt>
<code class="descname">repository=None, project=None, patch_body=None,</code></dt>
<dt>
<code class="descname">patch_level=None, patch_author=None, patch_comment=None,</code></dt>
<dt>
<code class="descname">patch_subdir=None):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>branch</strong> (<em>unicode string</em><em> or </em><em>None</em>) – </li>
<li><strong>revision</strong> (<em>unicode string</em><em> or </em><em>None</em>) – </li>
<li><strong>repository</strong> (<em>unicode string</em><em> or </em><em>None</em>) – </li>
<li><strong>project</strong> (<em>unicode string</em><em> or </em><em>None</em>) – </li>
<li><strong>codebase</strong> (<em>unicode string</em><em> (</em><em>required</em><em>)</em>) – </li>
<li><strong>patch_body</strong> (<em>unicode string</em><em> or </em><em>None</em>) – patch body</li>
<li><strong>patch_level</strong> (<em>integer</em><em> or </em><em>None</em>) – patch level</li>
<li><strong>patch_author</strong> (<em>unicode string</em><em> or </em><em>None</em>) – patch author</li>
<li><strong>patch_comment</strong> (<em>unicode string</em><em> or </em><em>None</em>) – patch comment</li>
<li><strong>patch_subdir</strong> (<em>unicode string</em><em> or </em><em>None</em>) – patch subdir</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">ssid, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Create a new SourceStamp instance with the given attributes, or find an existing one.
In either case, return its ssid.
The arguments all have the same meaning as in an ssdict.</p>
<p>If a new SourceStamp is created, its <code class="docutils literal notranslate"><span class="pre">created_at</span></code> is set to the current time.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStamp">
<code class="descname">getSourceStamp</code><span class="sig-paren">(</span><em>ssid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStamp" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ssid</strong> – sourcestamp to get</li>
<li><strong>no_cache</strong> (<em>boolean</em>) – bypass cache and always fetch from database</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">ssdict, or <code class="docutils literal notranslate"><span class="pre">None</span></code>, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get an ssdict representing the given source stamp, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no
such source stamp exists.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStamps">
<code class="descname">getSourceStamps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStamps" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of ssdict, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get all sourcestamps in the database.
You probably don’t want to do this!
This method will be extended to allow appropriate filtering.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStampsForBuild">
<code class="descname">getSourceStampsForBuild</code><span class="sig-paren">(</span><em>buildid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStampsForBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>buildid</strong> – build ID</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of ssdict, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get sourcestamps related to a build.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.state">
<span id="state"></span><h6>state<a class="headerlink" href="#module-buildbot.db.state" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-18"></span><dl class="class">
<dt id="buildbot.db.state.StateConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.state.</code><code class="descname">StateConnectorComponent</code><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles maintaining arbitrary key/value state for Buildbot
objects.  Each object can store arbitrary key/value pairs, where the values
are any JSON-encodable value.  Each pair can be set and retrieved
atomically.</p>
<p>Objects are identified by their (user-visible) name and their
class.  This allows, for example, a <code class="docutils literal notranslate"><span class="pre">nightly_smoketest</span></code> object of class
<code class="docutils literal notranslate"><span class="pre">NightlyScheduler</span></code> to maintain its state even if it moves between
masters, but avoids cross-contaminating state between different classes
of objects with the same name.</p>
<p>Note that “class” is not interpreted literally, and can be any string that
will uniquely identify the class for the object; if classes are renamed,
they can continue to use the old names.</p>
<p>An instance of this class is available at <code class="docutils literal notranslate"><span class="pre">master.db.state</span></code>.</p>
<p id="index-19">Objects are identified by <em>objectid</em>.</p>
<dl class="method">
<dt id="buildbot.db.state.StateConnectorComponent.getObjectId">
<code class="descname">getObjectId</code><span class="sig-paren">(</span><em>name</em>, <em>class_name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent.getObjectId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – name of the object</li>
<li><strong>class_name</strong> – object class name</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the objectid, via a Deferred.</p>
</td>
</tr>
</tbody>
</table>
<p>Get the object ID for this combination of a name and a class.  This
will add a row to the ‘objects’ table if none exists already.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.state.StateConnectorComponent.getState">
<code class="descname">getState</code><span class="sig-paren">(</span><em>objectid</em>, <em>name</em><span class="optional">[</span>, <em>default</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent.getState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>objectid</strong> – objectid on which the state should be checked</li>
<li><strong>name</strong> – name of the value to retrieve</li>
<li><strong>default</strong> – (optional) value to return if <code class="docutils literal notranslate"><span class="pre">name</span></code> is not present</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">state value via a Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first"><strong>KeyError</strong> – if <code class="docutils literal notranslate"><span class="pre">name</span></code> is not present and no default is given</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">TypeError if JSON parsing fails</p>
</td>
</tr>
</tbody>
</table>
<p>Get the state value for key <code class="docutils literal notranslate"><span class="pre">name</span></code> for the object with id
<code class="docutils literal notranslate"><span class="pre">objectid</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.state.StateConnectorComponent.setState">
<code class="descname">setState</code><span class="sig-paren">(</span><em>objectid</em>, <em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent.setState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>objectid</strong> – the objectid for which the state should be changed</li>
<li><strong>name</strong> – the name of the value to change</li>
<li><strong>value</strong> (<em>JSON-able value</em>) – the value to set</li>
<li><strong>returns</strong> – value actually written via Deferred</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">TypeError if JSONification fails</p>
</td>
</tr>
</tbody>
</table>
<p>Set the state value for <code class="docutils literal notranslate"><span class="pre">name</span></code> for the object with id <code class="docutils literal notranslate"><span class="pre">objectid</span></code>,
overwriting any existing value.
In case of two racing writes, the first (as per db rule) one wins, the seconds returns the value from the first.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.state.StateConnectorComponent.atomicCreateState">
<code class="descname">atomicCreateState</code><span class="sig-paren">(</span><em>objectid</em>, <em>name</em>, <em>thd_create_callback</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent.atomicCreateState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>objectid</strong> – the objectid for which the state should be created</li>
<li><strong>name</strong> – the name of the value to create</li>
<li><strong>thd_create_callback</strong> – the function to call from thread to create the value if non-existent. (returns JSON-able value)</li>
<li><strong>returns</strong> – Deferred</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last">TypeError if JSONification fails</p>
</td>
</tr>
</tbody>
</table>
<p>Atomically creates the state value for <code class="docutils literal notranslate"><span class="pre">name</span></code> for the object with id <code class="docutils literal notranslate"><span class="pre">objectid</span></code>,
If there is an existing value, returns that instead.
This implementation ensures the state is created only once for the whole cluster.</p>
</dd></dl>

<p>Those 3 methods have their threaded equivalent, <code class="docutils literal notranslate"><span class="pre">thdGetObjectId</span></code>, <code class="docutils literal notranslate"><span class="pre">thdGetState</span></code>, <code class="docutils literal notranslate"><span class="pre">thdSetState</span></code> that are intended to run in synchronous code, (e.g master.cfg environment)</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.db.users">
<span id="users"></span><h6>users<a class="headerlink" href="#module-buildbot.db.users" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-20"></span><dl class="class">
<dt id="buildbot.db.users.UsersConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.users.</code><code class="descname">UsersConnectorComponent</code><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles Buildbot’s notion of users.  Buildbot tracks the usual
information about users – username and password, plus a display name.</p>
<p>The more complicated task is to recognize each user across multiple
interfaces with Buildbot.  For example, a user may be identified as
‘djmitche’ in Subversion, <a class="reference external" href="mailto:'dustin&#37;&#52;&#48;v&#46;igoro&#46;us">‘dustin<span>&#64;</span>v<span>&#46;</span>igoro<span>&#46;</span>us</a>’ in Git, and ‘dustin’ on IRC.
To support this functionality, each user as a set of attributes, keyed by
type.  The <a class="reference internal" href="#buildbot.db.users.UsersConnectorComponent.findUserByAttr" title="buildbot.db.users.UsersConnectorComponent.findUserByAttr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">findUserByAttr</span></code></a> method uses these attributes to match users,
adding a new user if no matching user is found.</p>
<p>Users are identified canonically by <em>uid</em>, and are represented by <em>usdicts</em> (user
dictionaries) with keys</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">uid</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">identifier</span></code> (display name for the user)</li>
<li><code class="docutils literal notranslate"><span class="pre">bb_username</span></code> (buildbot login username)</li>
<li><code class="docutils literal notranslate"><span class="pre">bb_password</span></code> (hashed login password)</li>
</ul>
<p>All attributes are also included in the dictionary, keyed by type.  Types
colliding with the keys above are ignored.</p>
<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.findUserByAttr">
<code class="descname">findUserByAttr</code><span class="sig-paren">(</span><em>identifier</em>, <em>attr_type</em>, <em>attr_data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.findUserByAttr" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>identifier</strong> – identifier to use for a new user</li>
<li><strong>attr_type</strong> – attribute type to search for and/or add</li>
<li><strong>attr_data</strong> – attribute data to add</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">userid via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get an existing user, or add a new one, based on the given attribute.</p>
<p>This method is intended for use by other components of Buildbot to
search for a user with the given attributes.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">identifier</span></code> is <em>not</em> used in the search for an existing
user.  It is only used when creating a new user.  The identifier should
be based deterministically on the attributes supplied, in some fashion
that will seem natural to users.</p>
<p>For future compatibility, always use keyword parameters to call this
method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.getUser">
<code class="descname">getUser</code><span class="sig-paren">(</span><em>uid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.getUser" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>uid</strong> – user id to look up</li>
<li><strong>no_cache</strong> (<em>boolean</em>) – bypass cache and always fetch from database</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">usdict via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a usdict for the given user, or <code class="docutils literal notranslate"><span class="pre">None</span></code> if no matching user is
found.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.getUserByUsername">
<code class="descname">getUserByUsername</code><span class="sig-paren">(</span><em>username</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.getUserByUsername" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>username</strong> (<em>string</em>) – username portion of user credentials</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">usdict or None via deferred</td>
</tr>
</tbody>
</table>
<p>Looks up the user with the bb_username, returning the usdict or
<code class="docutils literal notranslate"><span class="pre">None</span></code> if no matching user is found.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.getUsers">
<code class="descname">getUsers</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.getUsers" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of partial usdicts via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the entire list of users.  User attributes are not included, so the
results are not full userdicts.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.updateUser">
<code class="descname">updateUser</code><span class="sig-paren">(</span><em>uid=None</em>, <em>identifier=None</em>, <em>bb_username=None</em>, <em>bb_password=None</em>, <em>attr_type=None</em>, <em>attr_data=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.updateUser" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>uid</strong> (<em>int</em>) – the user to change</li>
<li><strong>identifier</strong> (<em>string</em>) – (optional) new identifier for this user</li>
<li><strong>bb_username</strong> (<em>string</em>) – (optional) new buildbot username</li>
<li><strong>bb_password</strong> (<em>string</em>) – (optional) new hashed buildbot password</li>
<li><strong>attr_type</strong> (<em>string</em>) – (optional) attribute type to update</li>
<li><strong>attr_data</strong> (<em>string</em>) – (optional) value for <code class="docutils literal notranslate"><span class="pre">attr_type</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Update information about the given user.  Only the specified attributes
are updated.  If no user with the given uid exists, the method will
return silently.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">bb_password</span></code> must be given if <code class="docutils literal notranslate"><span class="pre">bb_username</span></code> appears;
similarly, <code class="docutils literal notranslate"><span class="pre">attr_type</span></code> requires <code class="docutils literal notranslate"><span class="pre">attr_data</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.removeUser">
<code class="descname">removeUser</code><span class="sig-paren">(</span><em>uid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.removeUser" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>uid</strong> (<em>int</em>) – the user to remove</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Remove the user with the given uid from the database.  This will remove
the user from any associated tables as well.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.identifierToUid">
<code class="descname">identifierToUid</code><span class="sig-paren">(</span><em>identifier</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.identifierToUid" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>identifier</strong> (<em>string</em>) – identifier to search for</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">uid or <code class="docutils literal notranslate"><span class="pre">None</span></code>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Fetch a uid for the given identifier, if one exists.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.masters">
<span id="masters"></span><h6>masters<a class="headerlink" href="#module-buildbot.db.masters" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-21"></span><dl class="class">
<dt id="buildbot.db.masters.MastersConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.masters.</code><code class="descname">MastersConnectorComponent</code><a class="headerlink" href="#buildbot.db.masters.MastersConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles tracking the buildmasters in a multi-master configuration.
Masters “check in” periodically.
Other masters monitor the last activity times, and mark masters that have not recently checked in as inactive.</p>
<p>Masters are represented by master dictionaries with the following keys:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> – the ID of this master</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code> – the name of the master (generally of the form <code class="docutils literal notranslate"><span class="pre">hostname:basedir</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">active</span></code> – true if this master is running</li>
<li><code class="docutils literal notranslate"><span class="pre">last_active</span></code> – time that this master last checked in (a datetime object)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.masters.MastersConnectorComponent.findMasterId">
<code class="descname">findMasterId</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.masters.MastersConnectorComponent.findMasterId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> (<em>unicode</em>) – name of this master</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">master id via Deferred</td>
</tr>
</tbody>
</table>
<p>Return the master ID for the master with this master name (generally <code class="docutils literal notranslate"><span class="pre">hostname:basedir</span></code>).
If such a master is already in the database, this returns the ID.
If not, the master is added to the database, with <code class="docutils literal notranslate"><span class="pre">active=False</span></code>, and its ID returned.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.masters.MastersConnectorComponent.setMasterState">
<code class="descname">setMasterState</code><span class="sig-paren">(</span><em>masterid</em>, <em>active</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.masters.MastersConnectorComponent.setMasterState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>masterid</strong> (<em>integer</em>) – the master to check in</li>
<li><strong>active</strong> (<em>boolean</em>) – whether to mark this master as active or inactive</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Mark the given master as active or inactive, returning true if the state actually changed.
If <code class="docutils literal notranslate"><span class="pre">active</span></code> is true, the <code class="docutils literal notranslate"><span class="pre">last_active</span></code> time is updated to the current time.
If <code class="docutils literal notranslate"><span class="pre">active</span></code> is false, then any links to this master, such as schedulers, will be deleted.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.masters.MastersConnectorComponent.getMaster">
<code class="descname">getMaster</code><span class="sig-paren">(</span><em>masterid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.masters.MastersConnectorComponent.getMaster" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>masterid</strong> (<em>integer</em>) – the master to check in</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Master dict or None via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the indicated master.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.masters.MastersConnectorComponent.getMasters">
<code class="descname">getMasters</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.masters.MastersConnectorComponent.getMasters" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of Master dicts via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a list of the masters, represented as dictionaries; masters are sorted
and paged using generic data query options</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.masters.MastersConnectorComponent.setAllMastersActiveLongTimeAgo">
<code class="descname">setAllMastersActiveLongTimeAgo</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.masters.MastersConnectorComponent.setAllMastersActiveLongTimeAgo" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None via Deferred</td>
</tr>
</tbody>
</table>
<p>This method is intended to be call by upgrade-master, and will effectively force housekeeping on all masters at next startup.
This method is not intended to be called outside of housekeeping scripts.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.builders">
<span id="builders"></span><h6>builders<a class="headerlink" href="#module-buildbot.db.builders" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-22"></span><dl class="class">
<dt id="buildbot.db.builders.BuildersConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.builders.</code><code class="descname">BuildersConnectorComponent</code><a class="headerlink" href="#buildbot.db.builders.BuildersConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles the relationship between builder names and their IDs, as well as tracking which masters are configured for this builder.</p>
<p>Builders are represented by master dictionaries with the following keys:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">id</span></code> – the ID of this builder</li>
<li><code class="docutils literal notranslate"><span class="pre">name</span></code>  – the builder name, a 20-character <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a></li>
<li><code class="docutils literal notranslate"><span class="pre">masterids</span></code> – the IDs of the masters where this builder is configured (sorted by id)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.builders.BuildersConnectorComponent.findBuilderId">
<code class="descname">findBuilderId</code><span class="sig-paren">(</span><em>name</em>, <em>autoCreate=True</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builders.BuildersConnectorComponent.findBuilderId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> (20-character <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>) – name of this builder</li>
<li><strong>autoCreate</strong> (<em>bool</em>) – automatically create the builder if name not found</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">builder id via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Return the builder ID for the builder with this builder name.
If such a builder is already in the database, this returns the ID.
If not and <code class="docutils literal notranslate"><span class="pre">autoCreate</span></code> is True, the builder is added to the database.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builders.BuildersConnectorComponent.addBuilderMaster">
<code class="descname">addBuilderMaster</code><span class="sig-paren">(</span><em>builderid=None</em>, <em>masterid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builders.BuildersConnectorComponent.addBuilderMaster" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>builderid</strong> (<em>integer</em>) – the builder</li>
<li><strong>masterid</strong> (<em>integer</em>) – the master</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add the given master to the list of masters on which the builder is configured.
This will do nothing if the master and builder are already associated.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builders.BuildersConnectorComponent.removeBuilderMaster">
<code class="descname">removeBuilderMaster</code><span class="sig-paren">(</span><em>builderid=None</em>, <em>masterid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builders.BuildersConnectorComponent.removeBuilderMaster" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>builderid</strong> (<em>integer</em>) – the builder</li>
<li><strong>masterid</strong> (<em>integer</em>) – the master</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Remove the given master from the list of masters on which the builder is configured.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builders.BuildersConnectorComponent.getBuilder">
<code class="descname">getBuilder</code><span class="sig-paren">(</span><em>builderid</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builders.BuildersConnectorComponent.getBuilder" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>builderid</strong> (<em>integer</em>) – the builder to check in</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Builder dict or None via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the indicated builder.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builders.BuildersConnectorComponent.getBuilders">
<code class="descname">getBuilders</code><span class="sig-paren">(</span><em>masterid=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.builders.BuildersConnectorComponent.getBuilders" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>masterid</strong> (<em>integer</em>) – ID of the master to which the results should be limited</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of Builder dicts via Deferred</td>
</tr>
</tbody>
</table>
<p>Get all builders (in unspecified order).
If <code class="docutils literal notranslate"><span class="pre">masterid</span></code> is given, then only builders configured on that master are returned.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="writing-database-connector-methods">
<h5>3.3.3.4. Writing Database Connector Methods<a class="headerlink" href="#writing-database-connector-methods" title="Permalink to this headline">¶</a></h5>
<p>The information above is intended for developers working on the rest of
Buildbot, and treating the database layer as an abstraction.  The remainder of
this section describes the internals of the database implementation, and is
intended for developers modifying the schema or adding new methods to the
database layer.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It’s difficult to change the database schema significantly after it has
been released, and very disruptive to users to change the database API.
Consider very carefully the future-proofing of any changes here!</p>
</div>
<div class="section" id="module-buildbot.db.connector">
<span id="the-db-connector-and-components"></span><h6>The DB Connector and Components<a class="headerlink" href="#module-buildbot.db.connector" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.db.connector.DBConnector">
<em class="property">class </em><code class="descclassname">buildbot.db.connector.</code><code class="descname">DBConnector</code><a class="headerlink" href="#buildbot.db.connector.DBConnector" title="Permalink to this definition">¶</a></dt>
<dd><p>The root of the database connectors, <code class="docutils literal notranslate"><span class="pre">master.db</span></code>, is a
<a class="reference internal" href="#buildbot.db.connector.DBConnector" title="buildbot.db.connector.DBConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBConnector</span></code></a> instance.  Its main purpose is
to hold reference to each of the connector components, but it also handles
timed cleanup tasks.</p>
<p>If you are adding a new connector component, import its module and create
an instance of it in this class’s constructor.</p>
</dd></dl>

<span class="target" id="module-buildbot.db.base"></span><dl class="class">
<dt id="buildbot.db.base.DBConnectorComponent">
<em class="property">class </em><code class="descclassname">buildbot.db.base.</code><code class="descname">DBConnectorComponent</code><a class="headerlink" href="#buildbot.db.base.DBConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base class for connector components.</p>
<p>There should be no need to override the constructor defined by this base
class.</p>
<dl class="attribute">
<dt id="buildbot.db.base.DBConnectorComponent.db">
<code class="descname">db</code><a class="headerlink" href="#buildbot.db.base.DBConnectorComponent.db" title="Permalink to this definition">¶</a></dt>
<dd><p>A reference to the <a class="reference internal" href="#buildbot.db.connector.DBConnector" title="buildbot.db.connector.DBConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">DBConnector</span></code></a>, so that
connector components can use e.g., <code class="docutils literal notranslate"><span class="pre">self.db.pool</span></code> or
<code class="docutils literal notranslate"><span class="pre">self.db.model</span></code>.  In the unusual case that a connector component
needs access to the master, the easiest path is <code class="docutils literal notranslate"><span class="pre">self.db.master</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.base.DBConnectorComponent.checkLength">
<code class="descname">checkLength</code><span class="sig-paren">(</span><em>col</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.base.DBConnectorComponent.checkLength" title="Permalink to this definition">¶</a></dt>
<dd><p>For use by subclasses to check that ‘value’ will fit in ‘col’, where ‘col’ is a table column from the model.
Ignore this check for database engines that either provide this error themselves (postgres) or that do not enforce maximum-length restrictions (sqlite)</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.base.DBConnectorComponent.findSomethingId">
<code class="descname">findSomethingId</code><span class="sig-paren">(</span><em>self</em>, <em>tbl</em>, <em>whereclause</em>, <em>insert_values</em>, <em>_race_hook=None</em>, <em>autoCreate=True</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.base.DBConnectorComponent.findSomethingId" title="Permalink to this definition">¶</a></dt>
<dd><p>Find (using <code class="docutils literal notranslate"><span class="pre">whereclause</span></code>) or add (using <code class="docutils literal notranslate"><span class="pre">insert_values</span></code>) a row to
<code class="docutils literal notranslate"><span class="pre">table</span></code>, and return the resulting ID. If <code class="docutils literal notranslate"><span class="pre">autoCreate</span></code> == False, we will not automatically insert the row.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.base.DBConnectorComponent.hashColumns">
<code class="descname">hashColumns</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.base.DBConnectorComponent.hashColumns" title="Permalink to this definition">¶</a></dt>
<dd><p>Hash the given values in a consistent manner: None is represented as xf5, an invalid unicode byte; strings are converted to utf8; and integers are represented by their decimal expansion.
The values are then joined by ‘0’ and hashed with sha1.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.base.DBConnectorComponent.doBatch">
<code class="descname">doBatch</code><span class="sig-paren">(</span><em>batch</em>, <em>batch_n=500</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.base.DBConnectorComponent.doBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>returns an Iterator that batches stuff in order to not push to many thing in a single request.
Especially sqlite has 999 limit on argument it can take in a requests.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.pool">
<span id="direct-database-access"></span><h6>Direct Database Access<a class="headerlink" href="#module-buildbot.db.pool" title="Permalink to this headline">¶</a></h6>
<p>The connectors all use <a class="reference external" href="http://www.sqlalchemy.org/docs/index.html">SQLAlchemy Core</a> as a wrapper around database
client drivers.  Unfortunately, SQLAlchemy is a synchronous library, so some
extra work is required to use it in an asynchronous context like Buildbot.
This is accomplished by deferring all database operations to threads, and
returning a Deferred.  The <code class="xref py py-class docutils literal notranslate"><span class="pre">Pool</span></code> class takes care of
the details.</p>
<p>A connector method should look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">thd</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="o">...</span> <span class="c1"># construct a query</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
            <span class="o">...</span> <span class="c1"># do something with the results</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c1"># return an interesting value</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">thd</span><span class="p">)</span>
</pre></div>
</div>
<p>Picking that apart, the body of the method defines a function named <code class="docutils literal notranslate"><span class="pre">thd</span></code>
taking one argument, a <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> object.  It then calls
<code class="docutils literal notranslate"><span class="pre">self.db.pool.do</span></code>, passing the <code class="docutils literal notranslate"><span class="pre">thd</span></code> function.  This function is called in
a thread, and can make blocking calls to SQLAlchemy as desired.  The <code class="docutils literal notranslate"><span class="pre">do</span></code>
method will return a Deferred that will fire with the return value of <code class="docutils literal notranslate"><span class="pre">thd</span></code>,
or with a failure representing any exceptions raised by <code class="docutils literal notranslate"><span class="pre">thd</span></code>.</p>
<p>The return value of <code class="docutils literal notranslate"><span class="pre">thd</span></code> must not be an SQLAlchemy object - in particular,
any <code class="xref py py-class docutils literal notranslate"><span class="pre">ResultProxy</span></code>
objects must be parsed into lists or other data structures before they are
returned.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As the name <code class="docutils literal notranslate"><span class="pre">thd</span></code> indicates, the function runs in a thread.  It should
not interact with any other part of Buildbot, nor with any of the Twisted
components that expect to be accessed from the main thread – the reactor,
Deferreds, etc.</p>
</div>
<p>Queries can be constructed using any of the SQLAlchemy core methods, using
tables from <a class="reference internal" href="#buildbot.db.model.Model" title="buildbot.db.model.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a>, and executed with the connection
object, <code class="docutils literal notranslate"><span class="pre">conn</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SQLAlchemy requires the use of a syntax that is forbidden by pep8.
If in where clauses you need to select rows where a value is NULL,
you need to write (<cite>tbl.c.value == None</cite>). This form is forbidden by pep8
which requires the use of <cite>is None</cite> instead of <cite>== None</cite>. As sqlalchemy is using operator
overloading to implement pythonic SQL statements, and <cite>is</cite> operator is not overloadable,
we need to keep the <cite>==</cite> operators. In order to solve this issue, buildbot
uses <cite>buildbot.db.NULL</cite> constant, which is <cite>None</cite>.
So instead of writing <cite>tbl.c.value == None</cite>, please write <cite>tbl.c.value == NULL</cite>)</p>
</div>
<dl class="class">
<dt id="buildbot.db.pool.DBThreadPool">
<em class="property">class </em><code class="descclassname">buildbot.db.pool.</code><code class="descname">DBThreadPool</code><a class="headerlink" href="#buildbot.db.pool.DBThreadPool" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.db.pool.DBThreadPool.do">
<code class="descname">do</code><span class="sig-paren">(</span><em>callable</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.pool.DBThreadPool.do" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Call <code class="docutils literal notranslate"><span class="pre">callable</span></code> in a thread, with a <code class="xref py py-class docutils literal notranslate"><span class="pre">Connection</span></code> object as first
argument.  Returns a deferred that will fire with the results of the
callable, or with a failure representing any exception raised during
its execution.</p>
<p>Any additional positional or keyword arguments are passed to
<code class="docutils literal notranslate"><span class="pre">callable</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.pool.DBThreadPool.do_with_engine">
<code class="descname">do_with_engine</code><span class="sig-paren">(</span><em>callable</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.pool.DBThreadPool.do_with_engine" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Similar to <a class="reference internal" href="#buildbot.db.pool.DBThreadPool.do" title="buildbot.db.pool.DBThreadPool.do"><code class="xref py py-meth docutils literal notranslate"><span class="pre">do</span></code></a>, call <code class="docutils literal notranslate"><span class="pre">callable</span></code> in a thread, but with an
<code class="xref py py-class docutils literal notranslate"><span class="pre">Engine</span></code> object as
first argument.</p>
<p>This method is only used for schema manipulation, and should not be
used in a running master.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.model">
<span id="database-schema"></span><h6>Database Schema<a class="headerlink" href="#module-buildbot.db.model" title="Permalink to this headline">¶</a></h6>
<p>Database connector methods access the database through SQLAlchemy, which
requires access to Python objects representing the database tables.  That is
handled through the model.</p>
<dl class="class">
<dt id="buildbot.db.model.Model">
<em class="property">class </em><code class="descclassname">buildbot.db.model.</code><code class="descname">Model</code><a class="headerlink" href="#buildbot.db.model.Model" title="Permalink to this definition">¶</a></dt>
<dd><p>This class contains the canonical description of the buildbot schema, It is
presented in the form of SQLAlchemy <code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code> instances, as class variables.  At
runtime, the model is available at <code class="docutils literal notranslate"><span class="pre">master.db.model</span></code>, so for example the
<code class="docutils literal notranslate"><span class="pre">buildrequests</span></code> table can be referred to as
<code class="docutils literal notranslate"><span class="pre">master.db.model.buildrequests</span></code>, and columns are available in its <code class="docutils literal notranslate"><span class="pre">c</span></code>
attribute.</p>
<p>The source file, <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/db/model.py">master/buildbot/db/model.py</a>, contains comments describing each table; that information is not replicated in this documentation.</p>
<p>Note that the model is not used for new installations or upgrades of the
Buildbot database.  See <a class="reference internal" href="#modifying-the-database-schema"><span class="std std-ref">Modifying the Database Schema</span></a> for more
information.</p>
<dl class="attribute">
<dt id="buildbot.db.model.Model.metadata">
<code class="descname">metadata</code><a class="headerlink" href="#buildbot.db.model.Model.metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>The model object also has a <code class="docutils literal notranslate"><span class="pre">metadata</span></code> attribute containing a
<code class="xref py py-class docutils literal notranslate"><span class="pre">MetaData</span></code> instance.
Connector methods should not need to access this object.  The metadata
is not bound to an engine.</p>
</dd></dl>

<p>The <a class="reference internal" href="#buildbot.db.model.Model" title="buildbot.db.model.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> class also defines some migration-related methods:</p>
<dl class="method">
<dt id="buildbot.db.model.Model.is_current">
<code class="descname">is_current</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.model.Model.is_current" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">boolean via Deferred</td>
</tr>
</tbody>
</table>
<p>Returns true if the current database’s version is current.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.model.Model.upgrade">
<code class="descname">upgrade</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.model.Model.upgrade" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Upgrades the database to the most recent schema version.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="caching">
<h6>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h6>
<p>Connector component methods that get an object based on an ID are good
candidates for caching.  The <a class="reference internal" href="#buildbot.db.base.cached" title="buildbot.db.base.cached"><code class="xref py py-func docutils literal notranslate"><span class="pre">cached</span></code></a> decorator
makes this automatic:</p>
<dl class="function">
<dt id="buildbot.db.base.cached">
<code class="descclassname">buildbot.db.base.</code><code class="descname">cached</code><span class="sig-paren">(</span><em>cachename</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.db.base.cached" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>cache_name</strong> – name of the cache to use</td>
</tr>
</tbody>
</table>
<p>A decorator for “getter” functions that fetch an object from the database
based on a single key.  The wrapped method will only be called if the named
cache does not contain the key.</p>
<p>The wrapped function must take one argument (the key); the wrapper will
take a key plus an optional <code class="docutils literal notranslate"><span class="pre">no_cache</span></code> argument which, if true, will
cause it to invoke the underlying method even if the key is in the cache.</p>
<p>The resulting method will have a <code class="docutils literal notranslate"><span class="pre">cache</span></code> attribute which can be used to
access the underlying cache.</p>
</dd></dl>

<p>In most cases, getter methods return a well-defined dictionary.  Unfortunately,
Python does not handle weak references to bare dictionaries, so components must
instantiate a subclass of <code class="docutils literal notranslate"><span class="pre">dict</span></code>.  The whole assembly looks something like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ThDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ThingConnectorComponent</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">DBConnectorComponent</span><span class="p">):</span>

    <span class="nd">@base</span><span class="o">.</span><span class="n">cached</span><span class="p">(</span><span class="s1">&#39;thdicts&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getThing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thid</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">thd</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
            <span class="o">...</span>
            <span class="n">thdict</span> <span class="o">=</span> <span class="n">ThDict</span><span class="p">(</span><span class="n">thid</span><span class="o">=</span><span class="n">thid</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">thdict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">thd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tests">
<h6>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h6>
<p>It goes without saying that any new connector methods must be fully tested!</p>
<p>You will also want to add an in-memory implementation of the methods to the
fake classes in <code class="docutils literal notranslate"><span class="pre">master/buildbot/test/fake/fakedb.py</span></code>.  Non-DB Buildbot code
is tested using these fake implementations in order to isolate that code from
the database code, and to speed-up tests.</p>
<p>The keys and types used in the return value from a connector’s <code class="docutils literal notranslate"><span class="pre">get</span></code> methods are described in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/util/validation.py">master/buildbot/test/util/validation.py</a>, via the <code class="docutils literal notranslate"><span class="pre">dbdict</span></code> module-level value.
This is a dictionary of <code class="docutils literal notranslate"><span class="pre">DictValidator</span></code> objects, one for each return value.</p>
<p>These values are used within test methods like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rv</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">masters</span><span class="o">.</span><span class="n">getMaster</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">validation</span><span class="o">.</span><span class="n">verifyDbDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;masterdict&#39;</span><span class="p">,</span> <span class="n">rv</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="modifying-the-database-schema">
<span id="id2"></span><h5>3.3.3.5. Modifying the Database Schema<a class="headerlink" href="#modifying-the-database-schema" title="Permalink to this headline">¶</a></h5>
<p>Changes to the schema are accomplished through migration scripts, supported by
<a class="reference external" href="https://github.com/openstack/sqlalchemy-migrate">SQLAlchemy-Migrate</a>.  In fact,
even new databases are created with the migration scripts – a new database is
a migrated version of an empty database.</p>
<p>The schema is tracked by a version number, stored in the <code class="docutils literal notranslate"><span class="pre">migrate_version</span></code>
table.  This number is incremented for each change to the schema, and used to
determine whether the database must be upgraded.  The master will refuse to run
with an out-of-date database.</p>
<p>To make a change to the schema, first consider how to handle any existing data.
When adding new columns, this may not be necessary, but table refactorings can
be complex and require caution so as not to lose information.</p>
<p>Create a new script in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/db/migrate/versions">master/buildbot/db/migrate/versions</a>, following the numbering scheme already present.
The script should have an <code class="docutils literal notranslate"><span class="pre">update</span></code> method, which takes an engine as a parameter, and upgrades the database, both changing the schema and performing any required data migrations.
The engine passed to this parameter is “enhanced” by SQLAlchemy-Migrate, with methods to handle adding, altering, and dropping columns.
See the SQLAlchemy-Migrate documentation for details.</p>
<p>Next, modify <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/db/model.py">master/buildbot/db/model.py</a> to represent the updated schema.
Buildbot’s automated tests perform a rudimentary comparison of an upgraded database with the model, but it is important to check the details - key length, nullability, and so on can sometimes be missed by the checks.
If the schema and the upgrade scripts get out of sync, bizarre behavior can result.</p>
<p>Also, adjust the fake database table definitions in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/fake/fakedb.py">master/buildbot/test/fake/fakedb.py</a> according to your changes.</p>
<p>Your upgrade script should have unit tests.  The classes in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/util/migration.py">master/buildbot/test/util/migration.py</a> make this straightforward.
Unit test scripts should be named e.g., <code class="file docutils literal notranslate"><span class="pre">test_db_migrate_versions_015_remove_bad_master_objectid.py</span></code>.</p>
<p>The <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/test/integration/test_upgrade.py">master/buildbot/test/integration/test_upgrade.py</a> also tests
upgrades, and will confirm that the resulting database matches the model.  If
you encounter implicit indexes on MySQL, that do not appear on SQLite or
Postgres, add them to <code class="docutils literal notranslate"><span class="pre">implied_indexes</span></code> in
<code class="file docutils literal notranslate"><span class="pre">master/buidlbot/db/model.py</span></code>.</p>
</div>
<div class="section" id="foreign-key-checking">
<h5>3.3.3.6. Foreign key checking<a class="headerlink" href="#foreign-key-checking" title="Permalink to this headline">¶</a></h5>
<p>PostgreSQL and SQlite db backends are checking the foreign keys consistency.
<a class="reference external" href="http://trac.buildbot.net/ticket/2248">bug #2248</a> needs to be fixed so that we can support foreign key checking for MySQL.</p>
<p>To maintain consistency with real db, fakedb can check the foreign key consistency of your test data. For this, just enable it with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">fakedb</span><span class="o">.</span><span class="n">FakeDBConnector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">checkForeignKeys</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p>Note that tests that only use fakedb do not really need foreign key consistency, even if this is a good practice to enable it in new code.</p>
</div>
<div class="section" id="database-compatibility-notes">
<h5>3.3.3.7. Database Compatibility Notes<a class="headerlink" href="#database-compatibility-notes" title="Permalink to this headline">¶</a></h5>
<p>Or: “If you thought any database worked right, think again”</p>
<p>Because Buildbot works over a wide range of databases, it is generally limited
to database features present in all supported backends.  This section
highlights a few things to watch out for.</p>
<p>In general, Buildbot should be functional on all supported database backends.
If use of a backend adds minor usage restrictions, or cannot implement some
kinds of error checking, that is acceptable if the restrictions are
well-documented in the manual.</p>
<p>The metabuildbot tests Buildbot against all supported databases, so most
compatibility errors will be caught before a release.</p>
<div class="section" id="index-length-in-mysql">
<h6>Index Length in MySQL<a class="headerlink" href="#index-length-in-mysql" title="Permalink to this headline">¶</a></h6>
<p id="index-23">MySQL only supports about 330-character indexes. The actual index length is
1000 bytes, but MySQL uses 3-byte encoding for UTF8 strings.  This is a
longstanding bug in MySQL - see <a class="reference external" href="http://bugs.mysql.com/bug.php?id=4541">“Specified key was too long; max key
length is 1000 bytes” with utf8</a>.
While this makes sense for indexes used for record lookup, it limits the
ability to use unique indexes to prevent duplicate rows.</p>
<p>InnoDB only supports indexes up to 255 unicode characters, which is why
all indexed columns are limited to 255 characters in Buildbot.</p>
</div>
<div class="section" id="transactions-in-mysql">
<h6>Transactions in MySQL<a class="headerlink" href="#transactions-in-mysql" title="Permalink to this headline">¶</a></h6>
<p id="index-24">Unfortunately, use of the MyISAM storage engine precludes real transactions in
MySQL.  <code class="docutils literal notranslate"><span class="pre">transaction.commit()</span></code> and <code class="docutils literal notranslate"><span class="pre">transaction.rollback()</span></code> are essentially
no-ops: modifications to data in the database are visible to other users
immediately, and are not reverted in a rollback.</p>
</div>
<div class="section" id="referential-integrity-in-sqlite-and-mysql">
<h6>Referential Integrity in SQLite and MySQL<a class="headerlink" href="#referential-integrity-in-sqlite-and-mysql" title="Permalink to this headline">¶</a></h6>
<span class="target" id="index-25"></span><p id="index-26">Neither MySQL nor SQLite enforce referential integrity based on foreign keys.
Postgres does enforce, however.  If possible, test your changes on Postgres
before committing, to check that tables are added and removed in the proper
order.</p>
</div>
<div class="section" id="subqueries-in-mysql">
<h6>Subqueries in MySQL<a class="headerlink" href="#subqueries-in-mysql" title="Permalink to this headline">¶</a></h6>
<p id="index-27">MySQL’s query planner is easily confused by subqueries.  For example, a DELETE
query specifying id’s that are IN a subquery will not work.  The workaround is
to run the subquery directly, and then execute a DELETE query for each returned
id.</p>
<p>If this weakness has a significant performance impact, it would be acceptable to
conditionalize use of the subquery on the database dialect.</p>
</div>
<div class="section" id="too-many-variables-in-sqlite">
<h6>Too Many Variables in SQLite<a class="headerlink" href="#too-many-variables-in-sqlite" title="Permalink to this headline">¶</a></h6>
<p id="index-28">Sqlite has a limitation on the number of variables it can use.
This limitation is usually <a class="reference external" href="http://www.sqlite.org/c3ref/c_limit_attached.html#sqlitelimitvariablenumber">SQLITE_LIMIT_VARIABLE_NUMBER=999</a>.
There is currently no way with pysqlite to query the value of this limit.
The C-api <code class="docutils literal notranslate"><span class="pre">sqlite_limit</span></code> is just not bound to the python.</p>
<p>When you hit this problem, you will get error like the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sqlalchemy.exc.OperationalError: (OperationalError) too many SQL variables
u&#39;DELETE FROM scheduler_changes WHERE scheduler_changes.changeid IN (?, ?, ?, ......tons of ?? and IDs .... 9363, 9362, 9361)
</pre></div>
</div>
<p>You can use the method <code class="xref py py-meth docutils literal notranslate"><span class="pre">doBatch</span></code> in order to write batching code in a consistent manner.</p>
</div>
</div>
<div class="section" id="testing-migrations-with-real-databases">
<h5>3.3.3.8. Testing migrations with real databases<a class="headerlink" href="#testing-migrations-with-real-databases" title="Permalink to this headline">¶</a></h5>
<p>By default Buildbot test suite uses SQLite database for testings database
migrations.
To use other database set <code class="docutils literal notranslate"><span class="pre">BUILDBOT_TEST_DB_URL</span></code> environment variable to
value in <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/engines.html#database-urls">SQLAlchemy database URL specification</a>.</p>
<p>For example, to run tests with file-based SQLite database you can start
tests in the following way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">BUILDBOT_TEST_DB_URL</span><span class="o">=</span>sqlite:////tmp/test_db.sqlite trial buildbot.test
</pre></div>
</div>
<div class="section" id="run-databases-in-docker">
<h6>Run databases in Docker<a class="headerlink" href="#run-databases-in-docker" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="https://www.docker.com/">Docker</a> allows to easily install and configure
different databases locally in containers.</p>
<p>To run tests with PostgreSQL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install psycopg.</span>
pip install psycopg2
<span class="c1"># Start container with PostgreSQL 9.5.</span>
<span class="c1"># It will listen on port 15432 on localhost.</span>
sudo docker run --name bb-test-postgres -e <span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>password <span class="se">\</span>
    -p <span class="m">127</span>.0.0.1:15432:5432 -d postgres:9.5
<span class="c1"># Start interesting tests</span>
<span class="nv">BUILDBOT_TEST_DB_URL</span><span class="o">=</span>postgresql://postgres:password@localhost:15432/postgres <span class="se">\</span>
    trial buildbot.test
</pre></div>
</div>
<p>To run tests with MySQL:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install mysqlclient</span>
pip install mysqlclient
<span class="c1"># Start container with MySQL 5.5.</span>
<span class="c1"># It will listen on port 13306 on localhost.</span>
sudo docker run --name bb-test-mysql -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>password <span class="se">\</span>
    -p <span class="m">127</span>.0.0.1:13306:3306 -d mysql:5.5
<span class="c1"># Start interesting tests</span>
<span class="nv">BUILDBOT_TEST_DB_URL</span><span class="o">=</span>mysql+mysqldb://root:password@127.0.0.1:13306/mysql <span class="se">\</span>
    trial buildbot.test
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-developer/mq"></span><div class="section" id="messaging-and-queues">
<span id="id1"></span><h4>3.3.4. Messaging and Queues<a class="headerlink" href="#messaging-and-queues" title="Permalink to this headline">¶</a></h4>
<p>As of version 0.9.0, Buildbot uses a message-queueing structure to handle asynchronous notifications in a distributed fashion.
This avoids, for the most part, the need for each master to poll the database, allowing masters to react to events as they happen.</p>
<div class="section" id="overview">
<h5>3.3.4.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h5>
<p>Buildbot is structured as a hybrid state- and event-based application, which will probably offend adherents of either pattern.
In particular, the most current state is stored in the <a class="reference internal" href="#document-developer/database"><span class="doc">Database</span></a>, while any changes to the state are announced in the form of a message.
The content of the messages is sufficient to reconstruct the updated state, allowing external processes to represent “live” state without polling the database.</p>
<p>This split nature immediately brings to light the problem of synchronizing the two interfaces.
Queueing systems can introduce queueing delays as messages propagate.
Likewise, database systems may introduce a delay between committed modifications and the modified data appearing in queries; for example, with MySQL master/slave replication, there can be several seconds’ delay before a slave is updated.</p>
<p>Buildbot’s MQ connector simply relays messages, and makes no attempt to coordinate the timing of those messages with the corresponding database updates.
It is up to higher layers to apply such coordination.</p>
</div>
<div class="section" id="connector-api">
<h5>3.3.4.2. Connector API<a class="headerlink" href="#connector-api" title="Permalink to this headline">¶</a></h5>
<p>All access to the queueing infrastructure is mediated by an MQ connector.
The connector’s API is defined below.
The connector itself is always available as <code class="docutils literal notranslate"><span class="pre">master.mq</span></code>, where <code class="docutils literal notranslate"><span class="pre">master</span></code> is the current <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code> instance.</p>
<span class="target" id="module-buildbot.mq.base"></span><p>The connector API is quite simple.
It is loosely based on AMQP, although simplified because there is only one exchange (see <a class="reference internal" href="#queue-schema"><span class="std std-ref">Queue Schema</span></a>).</p>
<p>All messages include a “routing key”, which is a tuple of <em>7-bit ascii</em> strings describing the content of the message.
By convention, the first element of the tuple gives the type of the data in the message.
The last element of the tuple describes the event represented by the message.
The remaining elements of the tuple describe attributes of the data in the message that may be useful for filtering; for example, buildsets may usefully be filtered on buildsetids.
The topics and associated message types are described below in <a class="reference internal" href="#message-schema"><span class="std std-ref">Message Schema</span></a>.</p>
<p>Filters are also specified with tuples.
For a filter to match a routing key, it must have the same length, and each element of the filter that is not None must match the corresponding routing key element exactly.</p>
<dl class="class">
<dt id="buildbot.mq.base.MQConnector">
<em class="property">class </em><code class="descclassname">buildbot.mq.base.</code><code class="descname">MQConnector</code><a class="headerlink" href="#buildbot.mq.base.MQConnector" title="Permalink to this definition">¶</a></dt>
<dd><p>This is an abstract parent class for MQ connectors, and defines the interface.
It should not be instantiated directly.
It is a subclass of <a class="reference internal" href="#buildbot.util.service.AsyncService" title="buildbot.util.service.AsyncService"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.service.AsyncService</span></code></a>, and subclasses can override service methods to start and stop the connector.</p>
<dl class="method">
<dt id="buildbot.mq.base.MQConnector.produce">
<code class="descname">produce</code><span class="sig-paren">(</span><em>routing_key</em>, <em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.mq.base.MQConnector.produce" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>routing_key</strong> (<em>tuple</em>) – the routing key for this message</li>
<li><strong>data</strong> – JSON-serializable body of the message</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method produces a new message and queues it for delivery to any associated consumers.</p>
<p>The routing key and data should match one of the formats given in <a class="reference internal" href="#message-schema"><span class="std std-ref">Message Schema</span></a>.</p>
<p>The method returns immediately; the caller will not receive any indication of a failure to transmit the message, although errors will be displayed in <code class="docutils literal notranslate"><span class="pre">twistd.log</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.mq.base.MQConnector.startConsuming">
<code class="descname">startConsuming</code><span class="sig-paren">(</span><em>callback</em>, <em>filter</em><span class="optional">[</span>, <em>persistent_name=name</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.mq.base.MQConnector.startConsuming" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>callback</strong> – callable to invoke for matching messages</li>
<li><strong>filter</strong> (<em>tuple</em>) – filter for routing keys of interest</li>
<li><strong>persistent_name</strong> – persistent name for this consumer</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a <a class="reference internal" href="#buildbot.mq.base.QueueRef" title="buildbot.mq.base.QueueRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueueRef</span></code></a> instance via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>This method will begin consuming messages matching the filter, invoking <code class="docutils literal notranslate"><span class="pre">callback</span></code> for each message.
See above for the format of the filter.</p>
<p>The callback will be invoked with two arguments: the message’s routing key and the message body, as a Python data structure.
It may return a Deferred, but no special processing other than error handling will be applied to that Deferred.
In particular, note that the callback may be invoked a second time before the Deferred from the first invocation fires.</p>
<p>A message is considered delivered as soon as the callback is invoked - there is no support for acknowledgements or re-queueing unhandled messages.</p>
<p>Note that the timing of messages is implementation-dependent.
It is not guaranteed that messages sent before the <a class="reference internal" href="#buildbot.mq.base.MQConnector.startConsuming" title="buildbot.mq.base.MQConnector.startConsuming"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startConsuming</span></code></a> method completes will be received.
In fact, because the registration process may not be immediate, even messages sent after the method completes may not be received.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">persistent_name</span></code> is given, then the consumer is assumed to be persistent, and consumption can be resumed with the given name.
Messages that arrive when no consumer is active are queued and will be delivered when a consumer becomes active.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.mq.base.MQConnector.waitUntilEvent">
<code class="descname">waitUntilEvent</code><span class="sig-paren">(</span><em>filter</em>, <em>check_callback</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.mq.base.MQConnector.waitUntilEvent" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>filter</strong> (<em>tuple</em>) – filter for routing keys of interest</li>
<li><strong>check_callback</strong> (<em>function</em>) – a callback which check if the event has already happened</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a Deferred that fires when the event has been received, and contain tuple (routing_key, value) representing the event</p>
</td>
</tr>
</tbody>
</table>
<p>This method is a helper which returns a defer that fire when a certain event has occurred.
This is useful for waiting the end of a build or disconnection of a worker.
You shall make sure when using this method that this event will happen in the future, and take care of race conditions.
For that caller must provide a check_callback which will check of the event has already occurred.
The whole race-condition-free process is:</p>
<ul class="simple">
<li>Register to event</li>
<li>Check if it has already happened</li>
<li>If not wait for the event</li>
<li>Unregister from event</li>
</ul>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.mq.base.QueueRef">
<em class="property">class </em><code class="descclassname">buildbot.mq.base.</code><code class="descname">QueueRef</code><a class="headerlink" href="#buildbot.mq.base.QueueRef" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#buildbot.mq.base.QueueRef" title="buildbot.mq.base.QueueRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueueRef</span></code></a> returned (via Deferred) from <a class="reference internal" href="#buildbot.mq.base.MQConnector.startConsuming" title="buildbot.mq.base.MQConnector.startConsuming"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startConsuming</span></code></a> can be used to stop consuming messages when they are no longer needed.
Users should be <em>very</em> careful to ensure that consumption is terminated in all cases.</p>
<dl class="method">
<dt id="buildbot.mq.base.QueueRef.stopConsuming">
<code class="descname">stopConsuming</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.mq.base.QueueRef.stopConsuming" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop invoking the <code class="docutils literal notranslate"><span class="pre">callback</span></code> passed to <a class="reference internal" href="#buildbot.mq.base.MQConnector.startConsuming" title="buildbot.mq.base.MQConnector.startConsuming"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startConsuming</span></code></a>.
This method can be called multiple times for the same <a class="reference internal" href="#buildbot.mq.base.QueueRef" title="buildbot.mq.base.QueueRef"><code class="xref py py-class docutils literal notranslate"><span class="pre">QueueRef</span></code></a> instance without harm.</p>
<p>After the first call to this method has returned, the callback will not be invoked.</p>
</dd></dl>

</dd></dl>

<div class="section" id="implementations">
<h6>Implementations<a class="headerlink" href="#implementations" title="Permalink to this headline">¶</a></h6>
<p>Several concrete implementations of the MQ connector exist.
The simplest is intended for cases where only one master exists, similar to the SQLite database support.
The remainder use various existing queueing applications to support distributed communications.</p>
<div class="section" id="module-buildbot.mq.simple">
<span id="simple"></span><h7>Simple<a class="headerlink" href="#module-buildbot.mq.simple" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.mq.simple.SimpleMQ">
<em class="property">class </em><code class="descclassname">buildbot.mq.simple.</code><code class="descname">SimpleMQ</code><a class="headerlink" href="#buildbot.mq.simple.SimpleMQ" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#buildbot.mq.simple.SimpleMQ" title="buildbot.mq.simple.SimpleMQ"><code class="xref py py-class docutils literal notranslate"><span class="pre">SimpleMQ</span></code></a> class implements a local equivalent of a message-queueing server.
It is intended for Buildbot installations with only one master.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.mq.wamp">
<span id="wamp"></span><h7>Wamp<a class="headerlink" href="#module-buildbot.mq.wamp" title="Permalink to this headline">¶</a></h7>
<dl class="class">
<dt id="buildbot.mq.wamp.WampMQ">
<em class="property">class </em><code class="descclassname">buildbot.mq.wamp.</code><code class="descname">WampMQ</code><a class="headerlink" href="#buildbot.mq.wamp.WampMQ" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#buildbot.mq.wamp.WampMQ" title="buildbot.mq.wamp.WampMQ"><code class="xref py py-class docutils literal notranslate"><span class="pre">WampMQ</span></code></a> class implements message-queueing using a wamp router.
This class translates the semantics of the buildbot mq api to the semantics of the wamp messaging system.
The message route is translated to a wamp topic by joining with dot and prefixing with buildbot namespace.
Example message that is sent via wamp is:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">topic</span> <span class="o">=</span> <span class="s2">&quot;org.buildbot.mq.builds.1.new&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;builderid&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;buildid&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;buildrequestid&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="s1">&#39;workerid&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s1">&#39;complete&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s1">&#39;complete_at&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
    <span class="s1">&#39;masterid&#39;</span><span class="p">:</span> <span class="mi">824</span><span class="p">,</span>
    <span class="s1">&#39;number&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
    <span class="s1">&#39;started_at&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;state_string&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;created&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<span class="target" id="module-buildbot.wamp.connector"></span><dl class="class">
<dt id="buildbot.wamp.connector.WampConnector">
<em class="property">class </em><code class="descclassname">buildbot.wamp.connector.</code><code class="descname">WampConnector</code><a class="headerlink" href="#buildbot.wamp.connector.WampConnector" title="Permalink to this definition">¶</a></dt>
<dd><p>The <a class="reference internal" href="#buildbot.wamp.connector.WampConnector" title="buildbot.wamp.connector.WampConnector"><code class="xref py py-class docutils literal notranslate"><span class="pre">WampConnector</span></code></a> class implements a buildbot service for wamp.
It is managed outside of the mq module as this protocol can also be reused for worker protocol.
The connector support queuing of requests until the wamp connection is created, but do not support disconnection and reconnection.
Reconnection will be supported as part of a next release of AutobahnPython (<a class="reference external" href="https://github.com/crossbario/autobahn-python/issues/295">https://github.com/crossbario/autobahn-python/issues/295</a>).
There is a chicken and egg problem at the buildbot initialization phases, so the produce messages are actually not sent with deferred.</p>
</dd></dl>

</div>
</div>
</div>
<div class="section" id="queue-schema">
<span id="id2"></span><h5>3.3.4.3. Queue Schema<a class="headerlink" href="#queue-schema" title="Permalink to this headline">¶</a></h5>
<p>Buildbot uses a particularly simple architecture: in AMQP terms, all messages are sent to a single topic exchange, and consumers define anonymous queues bound to that exchange.</p>
<p>In future versions of Buildbot, some components (e.g., schedulers) may use durable queues to ensure that messages are not lost when one or more masters are disconnected.</p>
</div>
<div class="section" id="message-schema">
<span id="id3"></span><h5>3.3.4.4. Message Schema<a class="headerlink" href="#message-schema" title="Permalink to this headline">¶</a></h5>
<p>This section describes the general structure messages.
The specific routing keys and content of each message are described in the relevant sub-section of <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a>.</p>
<div class="section" id="routing-keys">
<h6>Routing Keys<a class="headerlink" href="#routing-keys" title="Permalink to this headline">¶</a></h6>
<p>Routing keys are a sequence of strings, usually written with dot separators.
Routing keys are represented with variables when one or more of the words in the key are defined by the content of the message.
For example, <code class="docutils literal notranslate"><span class="pre">buildset.$bsid</span></code> describes routing keys such as <code class="docutils literal notranslate"><span class="pre">buildset.1984</span></code>, where 1984 is the ID of the buildset described by the message body.
Internally, keys are represented as tuples of strings.</p>
</div>
<div class="section" id="body-format">
<h6>Body Format<a class="headerlink" href="#body-format" title="Permalink to this headline">¶</a></h6>
<p>Message bodies are encoded in JSON.
The top level of each message is an object (a dictionary).</p>
<p>Most simple Python types - strings, numbers, lists, and dictionaries - are mapped directly to the corresponding JSON types.
Timestamps are represented as seconds since the UNIX epoch in message bodies.</p>
</div>
<div class="section" id="cautions">
<h6>Cautions<a class="headerlink" href="#cautions" title="Permalink to this headline">¶</a></h6>
<p>Message ordering is generally maintained by the backend implementations, but this should not be depended on.
That is, messages originating from the same master are <em>usually</em> delivered to consumers in the order they were produced.
Thus, for example, a consumer can expect to see a build request claimed before it is completed.
That said, consumers should be resilient to messages delivered out of order, at the very least by scheduling a “reload” from state stored in the database when messages arrive in an invalid order.</p>
<p>Unit tests should be used to ensure this resiliency.</p>
<p>Some related messages are sent at approximately the same time.
Due to the non-blocking nature of message delivery, consumers should <em>not</em> assume that subsequent messages in a sequence remain queued.
For example, upon receipt of a <code class="docutils literal notranslate"><span class="pre">buildset.$bsid.new</span></code> message, it is already too late to try to subscribe to the associated build requests messages, as they may already have been consumed.</p>
</div>
<div class="section" id="schema-changes">
<h6>Schema Changes<a class="headerlink" href="#schema-changes" title="Permalink to this headline">¶</a></h6>
<p>Future versions of Buildbot may add keys to messages, or add new messages.
Consumers should expect unknown keys and, if using wildcard topics, unknown messages.</p>
</div>
</div>
</div>
</div>
</div>
<span id="document-developer/py3-compat"></span><div class="section" id="python3-compatibility">
<h3>3.4. Python3 compatibility<a class="headerlink" href="#python3-compatibility" title="Permalink to this headline">¶</a></h3>
<p>A good place to start looking for advice to ensure that any code is compatible with both Python-3.x and Python2.6/2.7 is too look at the python-future <a class="reference external" href="http://python-future.org/compatible_idioms.html">cheat sheet</a> .
Buildbot uses the python-future library to ensure compatibility with both Python2.6/2.7 and Python3.x.</p>
<div class="section" id="imports">
<h4>3.4.1. Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h4>
<p>All <code class="docutils literal notranslate"><span class="pre">__future__</span></code> import have to happen at the top of the module, anything else is seen as a syntax error.
All imports from the python-future package should happen below <code class="docutils literal notranslate"><span class="pre">__future__</span></code> imports, but before any other.</p>
<p>Yes:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">twisted.application</span> <span class="kn">import</span> <span class="n">internet</span>
<span class="kn">from</span> <span class="nn">twisted.spread</span> <span class="kn">import</span> <span class="n">pb</span>
</pre></div>
</div>
<p>No:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">twisted.application</span> <span class="kn">import</span> <span class="n">internet</span>
<span class="kn">from</span> <span class="nn">twisted.spread</span> <span class="kn">import</span> <span class="n">pb</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</pre></div>
</div>
</div>
<div class="section" id="dictionaries">
<h4>3.4.2. Dictionaries<a class="headerlink" href="#dictionaries" title="Permalink to this headline">¶</a></h4>
<p>In python3, <code class="docutils literal notranslate"><span class="pre">dict.iteritems</span></code> is no longer available.
While <code class="docutils literal notranslate"><span class="pre">dict.items()</span></code> does exist, it can be memory intensive in python2.
For this reason, please use the python.future function <code class="docutils literal notranslate"><span class="pre">iteritems()</span></code>.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cheese&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;milk&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;We have {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
</pre></div>
</div>
<p>should be written as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">future.utils</span> <span class="kn">import</span> <span class="n">iteritems</span>
<span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cheese&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;milk&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="k">for</span> <span class="n">item</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">iteritems</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;We have {} {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>
</pre></div>
</div>
<p>This also applies to the similar methods <code class="docutils literal notranslate"><span class="pre">dict.itervalues()</span></code> and <code class="docutils literal notranslate"><span class="pre">dict.values()</span></code>, which have an equivalent <code class="docutils literal notranslate"><span class="pre">itervalues()</span></code>.</p>
<p>If a list is required, please use <code class="docutils literal notranslate"><span class="pre">list(iteritems(dict))</span></code>.
This is for compatibility with the six library.</p>
<p>For iterating over dictionary keys, please use <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">key</span> <span class="pre">in</span> <span class="pre">dict:</span></code>.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cheese&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;bread&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;milk&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;We have {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
</pre></div>
</div>
<p>Similarly when you want a list of keys:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="new-style-classes">
<h4>3.4.3. New-style classes<a class="headerlink" href="#new-style-classes" title="Permalink to this headline">¶</a></h4>
<p>All classes in Python3 are newstyle, so any classes added to the code base must therefore be new-style.
This is done by inheriting <code class="docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Old-style:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">bar</span>
</pre></div>
</div>
<p>new-style:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">bar</span>
</pre></div>
</div>
<p>When creating new-style classes, it is advised to import <code class="docutils literal notranslate"><span class="pre">object</span></code> from the builtins module.
The reasoning for this can be read <a class="reference external" href="http://python-future.org/changelog.html#newobject-base-object-defines-fallback-py2-compatible-special-methods">in the python-future documentation</a></p>
</div>
<div class="section" id="strings">
<h4>3.4.4. Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This has not yet been implemented in the current code base, and will not be strictly adhered to yet.
But it is important to keep in mind when writing code, that there is a strict distinction between bytestrings and unicode in Python3’</p>
</div>
<p>In python2, there is only one type of string.
It can be both unicode and bytestring.
In python3, this is no longer the case.
For this reasons all string must be marked with either <code class="docutils literal notranslate"><span class="pre">u''</span></code> or <code class="docutils literal notranslate"><span class="pre">b''</span></code> to signify if the string is a unicode string or a bytestring respectively</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sa">u</span><span class="s1">&#39;this is a unicode string, a string for humans to read&#39;</span>
<span class="sa">b</span><span class="s1">&#39;This is a bytestring, a string for computers to read&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="exceptions">
<h4>3.4.5. Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h4>
<p>All exceptions should be written with the <code class="docutils literal notranslate"><span class="pre">as</span></code> statement.
Before:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">0</span>
<span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
<p>After:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">number</span> <span class="o">=</span> <span class="mi">5</span><span class="o">/</span><span class="mi">0</span>
<span class="k">except</span> <span class="ne">ZeroDivisionError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="basestring">
<h4>3.4.6. Basestring<a class="headerlink" href="#basestring" title="Permalink to this headline">¶</a></h4>
<p>In Python2 there is a basestring type, which both str and unicode inherit.
In Python3, only unicode should be of this type, while bytestrings are <code class="docutils literal notranslate"><span class="pre">type(byte)</span></code>.</p>
<p>For this reason, we use an import from python future.
Before:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;this is a string&quot;</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">)):</span>
    <span class="k">print</span> <span class="s2">&quot;This line will run&quot;</span>
</pre></div>
</div>
<p>After:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">future.utils</span> <span class="kn">import</span> <span class="n">text_type</span>
<span class="n">unicode_s</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;this is a unicode string&quot;</span>
<span class="n">byte_s</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;this is a bytestring&quot;</span>

<span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">unicode_s</span><span class="p">,</span> <span class="n">text_type</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;This line will print&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">unicode_s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;this line will not print&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">unicode_s</span><span class="p">,</span> <span class="p">(</span><span class="n">text_type</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;This line will print&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">byte_s</span><span class="p">,</span> <span class="n">text_type</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;this line will not print&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">byte_s</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;This line will print&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">byte_s</span><span class="p">,</span> <span class="p">(</span><span class="n">text_type</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;This line will print&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="print-statements">
<h4>3.4.7. Print statements<a class="headerlink" href="#print-statements" title="Permalink to this headline">¶</a></h4>
<p>Print statements are gone in python3.
Please import <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">print_function</span></code> at the very top of the module to enable use of python3 style print functions</p>
</div>
<div class="section" id="division">
<h4>3.4.8. Division<a class="headerlink" href="#division" title="Permalink to this headline">¶</a></h4>
<p>Integer division is slightly different in Python3.
<code class="docutils literal notranslate"><span class="pre">//</span></code> is integer division and <code class="docutils literal notranslate"><span class="pre">/</span></code> is floating point division.
For this reason, we use <code class="docutils literal notranslate"><span class="pre">division</span></code> from the future module.
Before:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>After:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>

<span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="mi">2</span> <span class="o">//</span> <span class="mi">3</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="types">
<h4>3.4.9. Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h4>
<p>The types standard library has changed in Python3.
Please make sure to read the <a class="reference external" href="https://docs.python.org/3.3/library/types.html">official documentation</a> for the library and adapt accordingly</p>
</div>
</div>
<span id="document-developer/classes"></span><div class="section" id="classes">
<h3>3.5. Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h3>
<p>The sections contained here document classes that can be used or subclassed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some of this information duplicates information available in the source code itself.
Consider this information authoritative, and the source code a demonstration of the current implementation which is subject to change.</p>
</div>
<div class="toctree-wrapper compound">
<span id="document-developer/cls-build"></span><div class="section" id="module-buildbot.process.build">
<span id="builds"></span><h4>3.5.1. Builds<a class="headerlink" href="#module-buildbot.process.build" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="#buildbot.process.build.Build" title="buildbot.process.build.Build"><code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code></a> class represents a running build, with associated steps.</p>
<div class="section" id="build">
<h5>3.5.1.1. Build<a class="headerlink" href="#build" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.process.build.Build">
<em class="property">class </em><code class="descclassname">buildbot.process.build.</code><code class="descname">Build</code><a class="headerlink" href="#buildbot.process.build.Build" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="buildbot.process.build.Build.buildid">
<code class="descname">buildid</code><a class="headerlink" href="#buildbot.process.build.Build.buildid" title="Permalink to this definition">¶</a></dt>
<dd><p>The ID of this build in the database.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.build.Build.getSummaryStatistic">
<code class="descname">getSummaryStatistic</code><span class="sig-paren">(</span><em>name</em>, <em>summary_fn</em>, <em>initial_value=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.build.Build.getSummaryStatistic" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – statistic name to summarize</li>
<li><strong>summary_fn</strong> – callable with two arguments that will combine two values</li>
<li><strong>initial_value</strong> – first value to pass to <code class="docutils literal notranslate"><span class="pre">summary_fn</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">summarized result</p>
</td>
</tr>
</tbody>
</table>
<p>This method summarizes the named step statistic over all steps in which it exists, using <code class="docutils literal notranslate"><span class="pre">combination_fn</span></code> and <code class="docutils literal notranslate"><span class="pre">initial_value</span></code> to combine multiple results into a single result.
This translates to a call to Python’s <code class="docutils literal notranslate"><span class="pre">reduce</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">reduce</span><span class="p">(</span><span class="n">summary_fn</span><span class="p">,</span> <span class="n">step_stats_list</span><span class="p">,</span> <span class="n">initial_value</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.build.Build.getUrl">
<code class="descname">getUrl</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.build.Build.getUrl" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Url as string</td>
</tr>
</tbody>
</table>
<p>Returns url of the build in the UI.
Build must be started.
This is useful for customs steps.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-developer/cls-worker"></span><div class="section" id="module-buildbot.worker">
<span id="workers"></span><h4>3.5.2. Workers<a class="headerlink" href="#module-buildbot.worker" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="#buildbot.worker.Worker" title="buildbot.worker.Worker"><code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code></a> class represents a worker, which may or may not be connected to the master.
Instances of this class are created directly in the Buildbot configuration file.</p>
<div class="section" id="worker">
<h5>3.5.2.1. Worker<a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.worker.Worker">
<em class="property">class </em><code class="descclassname">buildbot.worker.</code><code class="descname">Worker</code><a class="headerlink" href="#buildbot.worker.Worker" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="buildbot.worker.Worker.workerid">
<code class="descname">workerid</code><a class="headerlink" href="#buildbot.worker.Worker.workerid" title="Permalink to this definition">¶</a></dt>
<dd><p>The ID of this worker in the database.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-developer/cls-buildfactory"></span><div class="section" id="buildfactory">
<h4>3.5.3. BuildFactory<a class="headerlink" href="#buildfactory" title="Permalink to this headline">¶</a></h4>
<div class="section" id="buildfactory-implementation-note">
<h5>3.5.3.1. BuildFactory Implementation Note<a class="headerlink" href="#buildfactory-implementation-note" title="Permalink to this headline">¶</a></h5>
<p>The default <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code>, provided in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.factory</span></code> module, contains an internal list of <cite>BuildStep specifications</cite>: a list of <code class="docutils literal notranslate"><span class="pre">(step_class,</span> <span class="pre">kwargs)</span></code> tuples for each.
These specification tuples are constructed when the config file is read, by asking the instances passed to <code class="xref py py-meth docutils literal notranslate"><span class="pre">addStep</span></code> for their subclass and arguments.</p>
<p>To support config files from Buildbot version 0.7.5 and earlier, <code class="xref py py-meth docutils literal notranslate"><span class="pre">addStep</span></code> also accepts the <code class="docutils literal notranslate"><span class="pre">f.addStep(shell.Compile,</span> <span class="pre">command=[&quot;make&quot;,&quot;build&quot;])</span></code> form, although its use is discouraged because then the <code class="docutils literal notranslate"><span class="pre">Compile</span></code> step doesn’t get to validate or complain about its arguments until build time.
The modern pass-by-instance approach allows this validation to occur while the config file is being loaded, where the admin has a better chance of noticing problems.</p>
<p>When asked to create a <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code>, the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildFactory</span></code> puts a copy of the list of step specifications into the new <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> object.
When the <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> is actually started, these step specifications are used to create the actual set of <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s, which are then executed one at a time.
This serves to give each Build an independent copy of each step.</p>
<p>Each step can affect the build process in the following ways:</p>
<ul class="simple">
<li>If the step’s <code class="xref py py-attr docutils literal notranslate"><span class="pre">haltOnFailure</span></code> attribute is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then a failure in the step (i.e. if it completes with a result of <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>) will cause the whole build to be terminated immediately: no further steps will be executed, with the exception of steps with <code class="xref py py-attr docutils literal notranslate"><span class="pre">alwaysRun</span></code> set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
<code class="xref py py-attr docutils literal notranslate"><span class="pre">haltOnFailure</span></code> is useful for setup steps upon which the rest of the build depends: if the CVS checkout or <strong class="command">./configure</strong> process fails, there is no point in trying to compile or test the resulting tree.</li>
<li>If the step’s <code class="xref py py-attr docutils literal notranslate"><span class="pre">alwaysRun</span></code> attribute is <code class="docutils literal notranslate"><span class="pre">True</span></code>, then it will always be run, regardless of if previous steps have failed.
This is useful for cleanup steps that should always be run to return the build directory or worker into a good state.</li>
<li>If the <code class="xref py py-attr docutils literal notranslate"><span class="pre">flunkOnFailure</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">flunkOnWarnings</span></code> flag is set, then a result of <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> or <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code> will mark the build as a whole as <code class="docutils literal notranslate"><span class="pre">FAILED</span></code>.
However, the remaining steps will still be executed.
This is appropriate for things like multiple testing steps: a failure in any one of them will indicate that the build has failed, however it is still useful to run them all to completion.</li>
<li>Similarly, if the <code class="xref py py-attr docutils literal notranslate"><span class="pre">warnOnFailure</span></code> or <code class="xref py py-attr docutils literal notranslate"><span class="pre">warnOnWarnings</span></code> flag is set, then a result of <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> or <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code> will mark the build as having <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>, and the remaining steps will still be executed.
This may be appropriate for certain kinds of optional build or test steps.
For example, a failure experienced while building documentation files should be made visible with a <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code> result but not be serious enough to warrant marking the whole build with a <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>.</li>
</ul>
<p>In addition, each <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code> produces its own results, may create logfiles, etc.
However only the flags described above have any effect on the build as a whole.</p>
<p>The pre-defined <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code>s like <code class="xref py py-class docutils literal notranslate"><span class="pre">CVS</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">Compile</span></code> have reasonably appropriate flags set on them already.
For example, without a source tree there is no point in continuing the build, so the <code class="xref py py-class docutils literal notranslate"><span class="pre">CVS</span></code> class has the <code class="xref py py-attr docutils literal notranslate"><span class="pre">haltOnFailure</span></code> flag set to <code class="docutils literal notranslate"><span class="pre">True</span></code>.
Look in <code class="file docutils literal notranslate"><span class="pre">buildbot/steps/*.py</span></code> to see how the other <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code>s are marked.</p>
<p>Each <code class="xref py py-class docutils literal notranslate"><span class="pre">Step</span></code> is created with an additional <code class="docutils literal notranslate"><span class="pre">workdir</span></code> argument that indicates where its actions should take place.
This is specified as a subdirectory of the worker’s base directory, with a default value of <code class="file docutils literal notranslate"><span class="pre">build</span></code>.
This is only implemented as a step argument (as opposed to simply being a part of the base directory) because the CVS/SVN steps need to perform their checkouts from the parent directory.</p>
</div>
</div>
<span id="document-developer/cls-buildsetsummarynotifiermixin"></span><div class="section" id="buildsetsummarynotifiermixin">
<h4>3.5.4. BuildSetSummaryNotifierMixin<a class="headerlink" href="#buildsetsummarynotifiermixin" title="Permalink to this headline">¶</a></h4>
<p>Some status notifiers will want to report the status of all builds all at once for a particular buildset, instead of reporting each build individually as it finishes.
In order to do this, the status notifier must wait for all builds to finish, collect their results, and then report a kind of summary on all of the collected results.
The act of waiting for and collecting the results of all of the builders is implemented via <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSetSummaryNotifierMixin</span></code>, to be subclassed by a status notification implementation.</p>
<div class="section" id="id1">
<h5>3.5.4.1. BuildSetSummaryNotifierMixin<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt>
<code class="descname">buildbot.status.buildset.BuildSetSummaryNotifierMixin::</code></dt>
<dd><p>This class provides some helper methods for implementing a status notification that provides notifications for all build results for a buildset at once.</p>
<p>This class provides the following methods:</p>
<dl class="method">
<dt id="buildbot.status.buildset.summarySubscribe">
<code class="descclassname">buildbot.status.buildset.</code><code class="descname">summarySubscribe</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.status.buildset.summarySubscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Call this to start receiving <a class="reference internal" href="#buildbot.status.buildset.sendBuildSetSummary" title="buildbot.status.buildset.sendBuildSetSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sendBuildSetSummary</span></code></a> callbacks.
Typically this will be called from the subclass’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">startService</span></code> method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.status.buildset.summaryUnsubscribe">
<code class="descclassname">buildbot.status.buildset.</code><code class="descname">summaryUnsubscribe</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.status.buildset.summaryUnsubscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Call this to stop receiving <a class="reference internal" href="#buildbot.status.buildset.sendBuildSetSummary" title="buildbot.status.buildset.sendBuildSetSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">sendBuildSetSummary</span></code></a> callbacks.
Typically this will be called from the subclass’s <code class="xref py py-meth docutils literal notranslate"><span class="pre">stopService</span></code> method.</p>
</dd></dl>

<p>The following methods are hooks to be implemented by the subclass.</p>
<dl class="method">
<dt id="buildbot.status.buildset.sendBuildSetSummary">
<code class="descclassname">buildbot.status.buildset.</code><code class="descname">sendBuildSetSummary</code><span class="sig-paren">(</span><em>buildset</em>, <em>builds</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.status.buildset.sendBuildSetSummary" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>buildset</strong> – A <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildSet</span></code> object</li>
<li><strong>builds</strong> – A list of <code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code> objects</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method must be implemented by the subclass.
This method is called when all of the builds for a buildset have finished, and it should initiate sending a summary status for the buildset.</p>
</dd></dl>

<p>The following attributes must be provided by the subclass.</p>
<dl class="attribute">
<dt id="buildbot.status.buildset.master">
<code class="descclassname">buildbot.status.buildset.</code><code class="descname">master</code><a class="headerlink" href="#buildbot.status.buildset.master" title="Permalink to this definition">¶</a></dt>
<dd><p>This must point to the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code> object.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-developer/cls-changesources"></span><div class="section" id="module-buildbot.changes.base">
<span id="change-sources"></span><h4>3.5.5. Change Sources<a class="headerlink" href="#module-buildbot.changes.base" title="Permalink to this headline">¶</a></h4>
<div class="section" id="changesource">
<h5>3.5.5.1. ChangeSource<a class="headerlink" href="#changesource" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.base.ChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.base.</code><code class="descname">ChangeSource</code><a class="headerlink" href="#buildbot.changes.base.ChangeSource" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base class for change sources.</p>
<p>Subclasses should override the inherited <a class="reference internal" href="#buildbot.util.service.ClusteredService.activate" title="buildbot.util.service.ClusteredService.activate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">activate</span></code></a> and <a class="reference internal" href="#buildbot.util.service.ClusteredService.deactivate" title="buildbot.util.service.ClusteredService.deactivate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">deactivate</span></code></a> methods if necessary to handle initialization and shutdown.</p>
<p>Change sources which are active on every master should, instead, override <code class="docutils literal notranslate"><span class="pre">startService</span></code> and <code class="docutils literal notranslate"><span class="pre">stopService</span></code>.</p>
</dd></dl>

</div>
<div class="section" id="reconfigurablepollingchangesource">
<h5>3.5.5.2. ReconfigurablePollingChangeSource<a class="headerlink" href="#reconfigurablepollingchangesource" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.base.ReconfigurablePollingChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.base.</code><code class="descname">ReconfigurablePollingChangeSource</code><a class="headerlink" href="#buildbot.changes.base.ReconfigurablePollingChangeSource" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a subclass of <a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeSource</span></code></a> which adds polling behavior.
Its constructor accepts the <code class="docutils literal notranslate"><span class="pre">pollInterval</span></code> and <code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code> arguments as documented for most built-in change sources.</p>
<p>Subclasses should override the <code class="docutils literal notranslate"><span class="pre">poll</span></code> method.
This method may return a Deferred.
Calls to <code class="docutils literal notranslate"><span class="pre">poll</span></code> will not overlap.</p>
</dd></dl>

</div>
<div class="section" id="pollingchangesource">
<h5>3.5.5.3. PollingChangeSource<a class="headerlink" href="#pollingchangesource" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.base.PollingChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.base.</code><code class="descname">PollingChangeSource</code><a class="headerlink" href="#buildbot.changes.base.PollingChangeSource" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a legacy class for polling change sources not yet ported to the :py:class::<cite>BuildbotService</cite> component lifecycle.
Do not use for new code.</p>
</dd></dl>

</div>
</div>
<span id="document-developer/cls-remotecommands"></span><div class="section" id="remotecommands">
<h4>3.5.6. RemoteCommands<a class="headerlink" href="#remotecommands" title="Permalink to this headline">¶</a></h4>
<p>Most of the action in build steps consists of performing operations on the worker.
This is accomplished via <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> and its subclasses.
Each represents a single operation on the worker.</p>
<p>Most data is returned to a command via updates.
These updates are described in detail in <a class="reference internal" href="#master-worker-updates"><span class="std std-ref">Updates</span></a>.</p>
<div class="section" id="remotecommand">
<h5>3.5.6.1. RemoteCommand<a class="headerlink" href="#remotecommand" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.process.remotecommand.RemoteCommand">
<em class="property">class </em><code class="descclassname">buildbot.process.remotecommand.</code><code class="descname">RemoteCommand</code><span class="sig-paren">(</span><em>remote_command</em>, <em>args</em>, <em>collectStdout=False</em>, <em>ignore_updates=False</em>, <em>decodeRC=dict(0)</em>, <em>stdioLogName='stdio'</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>remote_command</strong> (<em>string</em>) – command to run on the worker</li>
<li><strong>args</strong> (<em>dictionary</em>) – arguments to pass to the command</li>
<li><strong>collectStdout</strong> – if True, collect the command’s stdout</li>
<li><strong>ignore_updates</strong> – true to ignore remote updates</li>
<li><strong>decodeRC</strong> – dictionary associating <code class="docutils literal notranslate"><span class="pre">rc</span></code> values to buildsteps results constants (e.g. <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>, <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>, <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>)</li>
<li><strong>stdioLogName</strong> – name of the log to which to write the command’s stdio</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class handles running commands, consisting of a command name and a dictionary of arguments.
If true, <code class="docutils literal notranslate"><span class="pre">ignore_updates</span></code> will suppress any updates sent from the worker.</p>
<p>This class handles updates for <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, <code class="docutils literal notranslate"><span class="pre">stderr</span></code>, and <code class="docutils literal notranslate"><span class="pre">header</span></code> by appending them to s stdio logfile named by the <code class="docutils literal notranslate"><span class="pre">stdioLogName</span></code> parameter.
Steps that run multiple commands and want to separate those commands’ stdio streams can use this parameter.</p>
<p>It handles updates for <code class="docutils literal notranslate"><span class="pre">rc</span></code> by recording the value in its <code class="docutils literal notranslate"><span class="pre">rc</span></code> attribute.</p>
<p>Most worker-side commands, even those which do not spawn a new process on the worker, generate logs and an <code class="docutils literal notranslate"><span class="pre">rc</span></code>, requiring this class or one of its subclasses.
See <a class="reference internal" href="#master-worker-updates"><span class="std std-ref">Updates</span></a> for the updates that each command may send.</p>
<dl class="attribute">
<dt id="buildbot.process.remotecommand.RemoteCommand.active">
<code class="descname">active</code><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.active" title="Permalink to this definition">¶</a></dt>
<dd><p>True if the command is currently running</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>step</em>, <em>remote</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.run" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>step</strong> – the buildstep invoking this command</li>
<li><strong>remote</strong> – a reference to the remote <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> instance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Run the command.
Call this method to initiate the command; the returned Deferred will fire when the command is complete.
The Deferred fires with the <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> instance as its value.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.interrupt">
<code class="descname">interrupt</code><span class="sig-paren">(</span><em>why</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.interrupt" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>why</strong> (<em>Twisted Failure</em>) – reason for interrupt</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method attempts to stop the running command early.
The Deferred it returns will fire when the interrupt request is received by the worker; this may be a long time before the command itself completes, at which time the Deferred returned from <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.run" title="buildbot.process.remotecommand.RemoteCommand.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span></code></a> will fire.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.results">
<code class="descname">results</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.results" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">results constant</td>
</tr>
</tbody>
</table>
<p>This method checks the <code class="docutils literal notranslate"><span class="pre">rc</span></code> against the decodeRC dictionary, and returns results constant</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.didFail">
<code class="descname">didFail</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.didFail" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
<p>This method returns True if the results() function returns FAILURE</p>
</dd></dl>

<p>The following methods are invoked from the worker.
They should not be called directly.</p>
<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.remote_update">
<code class="descname">remote_update</code><span class="sig-paren">(</span><em>updates</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.remote_update" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>updates</strong> – new information from the worker</td>
</tr>
</tbody>
</table>
<p>Handles updates from the worker on the running command.
See <a class="reference internal" href="#master-worker-updates"><span class="std std-ref">Updates</span></a> for the content of the updates.
This class splits the updates out, and handles the <code class="docutils literal notranslate"><span class="pre">ignore_updates</span></code> option, then calls <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.remoteUpdate" title="buildbot.process.remotecommand.RemoteCommand.remoteUpdate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remoteUpdate</span></code></a> to process the update.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.remote_complete">
<code class="descname">remote_complete</code><span class="sig-paren">(</span><em>failure=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.remote_complete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>failure</strong> – the failure that caused the step to complete, or None for success</td>
</tr>
</tbody>
</table>
<p>Called by the worker to indicate that the command is complete.
Normal completion (even with a nonzero <code class="docutils literal notranslate"><span class="pre">rc</span></code>) will finish with no failure; if <code class="docutils literal notranslate"><span class="pre">failure</span></code> is set, then the step should finish with status <a class="reference internal" href="#buildbot.process.results.EXCEPTION" title="buildbot.process.results.EXCEPTION"><code class="xref py py-attr docutils literal notranslate"><span class="pre">EXCEPTION</span></code></a>.</p>
</dd></dl>

<p>These methods are hooks for subclasses to add functionality.</p>
<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.remoteUpdate">
<code class="descname">remoteUpdate</code><span class="sig-paren">(</span><em>update</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.remoteUpdate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>update</strong> – the update to handle</td>
</tr>
</tbody>
</table>
<p>Handle a single update.  Subclasses must override this method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.remoteComplete">
<code class="descname">remoteComplete</code><span class="sig-paren">(</span><em>failure</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.remoteComplete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>failure</strong> – the failure that caused the step to complete, or None for success</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Handle command completion, performing any necessary cleanup.
Subclasses should override this method.
If <code class="docutils literal notranslate"><span class="pre">failure</span></code> is not None, it should be returned to ensure proper processing.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.remotecommand.RemoteCommand.logs">
<code class="descname">logs</code><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.logs" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary of <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code> instances representing active logs.
Do not modify this directly – use <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.useLog" title="buildbot.process.remotecommand.RemoteCommand.useLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">useLog</span></code></a> instead.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.remotecommand.RemoteCommand.rc">
<code class="descname">rc</code><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.rc" title="Permalink to this definition">¶</a></dt>
<dd><p>Set to the return code of the command, after the command has completed.
For compatibility with shell commands, 0 is taken to indicate success, while nonzero return codes indicate failure.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.remotecommand.RemoteCommand.stdout">
<code class="descname">stdout</code><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.stdout" title="Permalink to this definition">¶</a></dt>
<dd><p>If the <code class="docutils literal notranslate"><span class="pre">collectStdout</span></code> constructor argument is true, then this attribute will contain all data from stdout, as a single string.
This is helpful when running informational commands (e.g., <code class="docutils literal notranslate"><span class="pre">svnversion</span></code>), but is not appropriate for commands that will produce a large amount of output, as that output is held in memory.</p>
</dd></dl>

<p>To set up logging, use <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.useLog" title="buildbot.process.remotecommand.RemoteCommand.useLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">useLog</span></code></a> or <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.useLogDelayed" title="buildbot.process.remotecommand.RemoteCommand.useLogDelayed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">useLogDelayed</span></code></a> before starting the command:</p>
<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.useLog">
<code class="descname">useLog</code><span class="sig-paren">(</span><em>log</em>, <em>closeWhenFinished=False</em>, <em>logfileName=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.useLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>log</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code> instance to add to.</li>
<li><strong>closeWhenFinished</strong> – if true, call <code class="xref py py-meth docutils literal notranslate"><span class="pre">finish</span></code> when the command is finished.</li>
<li><strong>logfileName</strong> – the name of the logfile, as given to the worker.
This is <code class="docutils literal notranslate"><span class="pre">stdio</span></code> for standard streams.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Route log-related updates to the given logfile.
Note that <code class="docutils literal notranslate"><span class="pre">stdio</span></code> is not included by default, and must be added explicitly.
The <code class="docutils literal notranslate"><span class="pre">logfileName</span></code> must match the name given by the worker in any <code class="docutils literal notranslate"><span class="pre">log</span></code> updates.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.useLogDelayed">
<code class="descname">useLogDelayed</code><span class="sig-paren">(</span><em>logfileName</em>, <em>activateCallback</em>, <em>closeWhenFinished=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.useLogDelayed" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logfileName</strong> – the name of the logfile, as given to the worker.
This is <code class="docutils literal notranslate"><span class="pre">stdio</span></code> for standard streams.</li>
<li><strong>activateCallback</strong> – callback for when the log is added; see below</li>
<li><strong>closeWhenFinished</strong> – if true, call <code class="xref py py-meth docutils literal notranslate"><span class="pre">finish</span></code> when the command is finished.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Similar to <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.useLog" title="buildbot.process.remotecommand.RemoteCommand.useLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">useLog</span></code></a>, but the logfile is only actually added when an update arrives for it.
The callback, <code class="docutils literal notranslate"><span class="pre">activateCallback</span></code>, will be called with the <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> instance when the first update for the log is delivered.
It should return the desired log instance, optionally via a Deferred.</p>
</dd></dl>

<p>With that finished, run the command using the inherited <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.run" title="buildbot.process.remotecommand.RemoteCommand.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span></code></a> method.
During the run, you can inject data into the logfiles with any of these methods:</p>
<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.addStdout">
<code class="descname">addStdout</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.addStdout" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – data to add to the logfile</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Add stdout data to the <code class="docutils literal notranslate"><span class="pre">stdio</span></code> log.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.addStderr">
<code class="descname">addStderr</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.addStderr" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – data to add to the logfile</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Add stderr data to the <code class="docutils literal notranslate"><span class="pre">stdio</span></code> log.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.addHeader">
<code class="descname">addHeader</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.addHeader" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> – data to add to the logfile</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Add header data to the <code class="docutils literal notranslate"><span class="pre">stdio</span></code> log.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.remotecommand.RemoteCommand.addToLog">
<code class="descname">addToLog</code><span class="sig-paren">(</span><em>logname</em>, <em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteCommand.addToLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>logname</strong> – the logfile to receive the data</li>
<li><strong>data</strong> – data to add to the logfile</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add data to a logfile other than <code class="docutils literal notranslate"><span class="pre">stdio</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.process.remotecommand.RemoteShellCommand">
<em class="property">class </em><code class="descclassname">buildbot.process.remotecommand.</code><code class="descname">RemoteShellCommand</code><span class="sig-paren">(</span><em>workdir</em>, <em>command</em>, <em>env=None</em>, <em>want_stdout=True</em>, <em>want_stderr=True</em>, <em>timeout=20*60</em>, <em>maxTime=None</em>, <em>sigtermTime=None</em>, <em>logfiles={}</em>, <em>usePTY=None</em>, <em>logEnviron=True</em>, <em>collectStdio=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.remotecommand.RemoteShellCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>workdir</strong> – directory in which command should be executed, relative to the builder’s basedir.</li>
<li><strong>command</strong> (<em>string</em><em> or </em><em>list</em>) – shell command to run</li>
<li><strong>want_stdout</strong> – If false, then no updates will be sent for stdout.</li>
<li><strong>want_stderr</strong> – If false, then no updates will be sent for stderr.</li>
<li><strong>timeout</strong> – Maximum time without output before the command is killed.</li>
<li><strong>maxTime</strong> – Maximum overall time from the start before the command is killed.</li>
<li><strong>sigtermTime</strong> – Try to kill the command with SIGTERM and wait for sigtermTime seconds before firing SIGKILL.
If None, SIGTERM will not be fired.</li>
<li><strong>env</strong> – A dictionary of environment variables to augment or replace the existing environment on the worker.</li>
<li><strong>logfiles</strong> – Additional logfiles to request from the worker.</li>
<li><strong>usePTY</strong> – True to use a PTY, false to not use a PTY; the default value is False.</li>
<li><strong>logEnviron</strong> – If false, do not log the environment on the worker.</li>
<li><strong>collectStdout</strong> – If True, collect the command’s stdout.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Most of the constructor arguments are sent directly to the worker; see <a class="reference internal" href="#shell-command-args"><span class="std std-ref">shell</span></a> for the details of the formats.
The <code class="docutils literal notranslate"><span class="pre">collectStdout</span></code> parameter is as described for the parent class.</p>
<p>If shell command contains passwords, they can be hidden from log files by using <a class="reference internal" href="#document-manual/secretsmanagement"><span class="doc">Secret Management</span></a>.
This is the recommended procedure for new-style build steps. For legacy build steps password were hidden from the
log file by passing them as tuple in command argument.
Eg. <code class="docutils literal notranslate"><span class="pre">['print',</span> <span class="pre">('obfuscated',</span> <span class="pre">'password',</span> <span class="pre">'dummytext')]</span></code> is logged as <code class="docutils literal notranslate"><span class="pre">['print',</span> <span class="pre">'dummytext']</span></code>.</p>
<p>This class is used by the <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> step, and by steps that run multiple customized shell commands.</p>
</dd></dl>

</div>
</div>
<span id="document-developer/cls-buildsteps"></span><div class="section" id="module-buildbot.process.buildstep">
<span id="buildsteps"></span><h4>3.5.7. BuildSteps<a class="headerlink" href="#module-buildbot.process.buildstep" title="Permalink to this headline">¶</a></h4>
<p>There are a few parent classes that are used as base classes for real buildsteps.
This section describes the base classes.
The “leaf” classes are described in <a class="reference internal" href="#document-manual/configuration/buildsteps"><span class="doc">Build Steps</span></a>.</p>
<p>See <a class="reference internal" href="#writing-new-buildsteps"><span class="std std-ref">Writing New BuildSteps</span></a> for a guide to implementing new steps.</p>
<div class="section" id="buildstep">
<h5>3.5.7.1. BuildStep<a class="headerlink" href="#buildstep" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.process.buildstep.BuildStep">
<em class="property">class </em><code class="descclassname">buildbot.process.buildstep.</code><code class="descname">BuildStep</code><span class="sig-paren">(</span><em>name</em>, <em>description</em>, <em>descriptionDone</em>, <em>descriptionSuffix</em>, <em>locks</em>, <em>haltOnFailure</em>, <em>flunkOnWarnings</em>, <em>flunkOnFailure</em>, <em>warnOnWarnings</em>, <em>warnOnFailure</em>, <em>alwaysRun</em>, <em>progressMetrics</em>, <em>useProgress</em>, <em>doStepIf</em>, <em>hideStepIf</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep" title="Permalink to this definition">¶</a></dt>
<dd><p>All constructor arguments must be given as keyword arguments.
Each constructor parameter is copied to the corresponding attribute.</p>
<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the step.
Note that this value may change when the step is started, if the existing name was not unique.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.stepid">
<code class="descname">stepid</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.stepid" title="Permalink to this definition">¶</a></dt>
<dd><p>The ID of this step in the database.
This attribute is not set until the step starts.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.description">
<code class="descname">description</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.description" title="Permalink to this definition">¶</a></dt>
<dd><p>The description of the step.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.descriptionDone">
<code class="descname">descriptionDone</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.descriptionDone" title="Permalink to this definition">¶</a></dt>
<dd><p>The description of the step after it has finished.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.descriptionSuffix">
<code class="descname">descriptionSuffix</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.descriptionSuffix" title="Permalink to this definition">¶</a></dt>
<dd><p>Any extra information to append to the description.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.locks">
<code class="descname">locks</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.locks" title="Permalink to this definition">¶</a></dt>
<dd><p>List of locks for this step; see <a class="reference internal" href="#interlocks"><span class="std std-ref">Interlocks</span></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.progressMetrics">
<code class="descname">progressMetrics</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.progressMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>List of names of metrics that should be used to track the progress of this build, and build ETA’s for users.
This is generally set in the</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.useProgress">
<code class="descname">useProgress</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.useProgress" title="Permalink to this definition">¶</a></dt>
<dd><p>If true (the default), then ETAs will be calculated for this step using progress metrics.
If the step is known to have unpredictable timing (e.g., an incremental build), then this should be set to false.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.doStepIf">
<code class="descname">doStepIf</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.doStepIf" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable or bool to determine whether this step should be executed.
See <a class="reference internal" href="#buildstep-common-parameters"><span class="std std-ref">Common Parameters</span></a> for details.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.hideStepIf">
<code class="descname">hideStepIf</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.hideStepIf" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable or bool to determine whether this step should be shown in the waterfall and build details pages.
See <a class="reference internal" href="#buildstep-common-parameters"><span class="std std-ref">Common Parameters</span></a> for details.</p>
</dd></dl>

<p>The following attributes affect the behavior of the containing build:</p>
<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.haltOnFailure">
<code class="descname">haltOnFailure</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.haltOnFailure" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will halt on a failure of this step, and not execute subsequent tests (except those with <code class="docutils literal notranslate"><span class="pre">alwaysRun</span></code>).</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.flunkOnWarnings">
<code class="descname">flunkOnWarnings</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.flunkOnWarnings" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will be marked as a failure if this step ends with warnings.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.flunkOnFailure">
<code class="descname">flunkOnFailure</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.flunkOnFailure" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will be marked as a failure if this step fails.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.warnOnWarnings">
<code class="descname">warnOnWarnings</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.warnOnWarnings" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will be marked as warnings, or worse, if this step ends with warnings.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.warnOnFailure">
<code class="descname">warnOnFailure</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.warnOnFailure" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will be marked as warnings, or worse, if this step fails.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.alwaysRun">
<code class="descname">alwaysRun</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.alwaysRun" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the step will run even if a previous step halts the build with <code class="docutils literal notranslate"><span class="pre">haltOnFailure</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.logEncoding">
<code class="descname">logEncoding</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.logEncoding" title="Permalink to this definition">¶</a></dt>
<dd><p>The log encoding to use for logs produced in this step, or None to ues the global default.
See <a class="reference internal" href="#log-encodings"><span class="std std-ref">Log Handling</span></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.rendered">
<code class="descname">rendered</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.rendered" title="Permalink to this definition">¶</a></dt>
<dd><p>At the beginning of the step, the renderable attributes are rendered against the properties.
There is a slight delay however when those are not yet rendered, which lead to weird and difficult to reproduce bugs.
To address this problem, a <code class="docutils literal notranslate"><span class="pre">rendered</span></code> attribute is available for methods that could be called early in the buildstep creation.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.results">
<code class="descname">results</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.results" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the result (a code from <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.results</span></code></a>) of the step.
This attribute only exists after the step is finished, and should only be used in <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getResultSummary" title="buildbot.process.buildstep.BuildStep.getResultSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getResultSummary</span></code></a>.</p>
</dd></dl>

<p>A few important pieces of information are not available when a step is constructed, and are added later.
These are set by the following methods; the order in which these methods are called is not defined.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setBuild">
<code class="descname">setBuild</code><span class="sig-paren">(</span><em>build</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>build</strong> – the <a class="reference internal" href="#buildbot.process.build.Build" title="buildbot.process.build.Build"><code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code></a> instance controlling this step.</td>
</tr>
</tbody>
</table>
<p>This method is called during setup to set the build instance controlling this worker.
Subclasses can override this to get access to the build object as soon as it is available.
The default implementation sets the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.build" title="buildbot.process.buildstep.BuildStep.build"><code class="xref py py-attr docutils literal notranslate"><span class="pre">build</span></code></a> attribute.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.build">
<code class="descname">build</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.build" title="Permalink to this definition">¶</a></dt>
<dd><p>The build object controlling this step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setWorker">
<code class="descname">setWorker</code><span class="sig-paren">(</span><em>build</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setWorker" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>build</strong> – the <a class="reference internal" href="#buildbot.worker.Worker" title="buildbot.worker.Worker"><code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code></a> instance on which this step will run.</td>
</tr>
</tbody>
</table>
<p>Similarly, this method is called with the worker that will run this step.
The default implementation sets the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.worker" title="buildbot.process.buildstep.BuildStep.worker"><code class="xref py py-attr docutils literal notranslate"><span class="pre">worker</span></code></a> attribute.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.worker">
<code class="descname">worker</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.worker" title="Permalink to this definition">¶</a></dt>
<dd><p>The worker that will run this step.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.workdir">
<code class="descname">workdir</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.workdir" title="Permalink to this definition">¶</a></dt>
<dd><p>Implemented as a property.
Workdir where actions of the step are happening.
The workdir is by order of priority</p>
<ul>
<li><p class="first">workdir of the step, if defined via constructor argument</p>
</li>
<li><p class="first">workdir of the BuildFactory (itself defaults to ‘build’).</p>
<blockquote>
<div><p>BuildFactory workdir can be a function of sourcestamp. See <a class="reference internal" href="#factory-workdir-functions"><span class="std std-ref">Factory Workdir Functions</span></a></p>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setDefaultWorkdir">
<code class="descname">setDefaultWorkdir</code><span class="sig-paren">(</span><em>workdir</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setDefaultWorkdir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>workdir</strong> – the default workdir, from the build</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method is deprecated and should not be used anymore, as workdir is calculated automatically via a property</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setupProgress">
<code class="descname">setupProgress</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setupProgress" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called during build setup to give the step a chance to set up progress tracking.
It is only called if the build has <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.useProgress" title="buildbot.process.buildstep.BuildStep.useProgress"><code class="xref py py-attr docutils literal notranslate"><span class="pre">useProgress</span></code></a> set.
There is rarely any reason to override this method.</p>
</dd></dl>

<p>Execution of the step itself is governed by the following methods and attributes.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.startStep">
<code class="descname">startStep</code><span class="sig-paren">(</span><em>remote</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.startStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>remote</strong> – a remote reference to the worker-side
<code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerForBuilderPb</span></code> instance</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Begin the step.
This is the build’s interface to step execution.
Subclasses should override <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.run" title="buildbot.process.buildstep.BuildStep.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span></code></a> to implement custom behaviors.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.run" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">result via Deferred</td>
</tr>
</tbody>
</table>
<p>Execute the step.
When this method returns (or when the Deferred it returns fires), the step is complete.
The method’s return value must be an integer, giving the result of the step – a constant from <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.results</span></code></a>.
If the method raises an exception or its Deferred fires with failure, then the step will be completed with an EXCEPTION result.
Any other output from the step (logfiles, status strings, URLs, etc.) is the responsibility of the <code class="docutils literal notranslate"><span class="pre">run</span></code> method.</p>
<p>Subclasses should override this method.
Do <em>not</em> call <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code></a> or <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">failed</span></code></a> from this method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.start" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><code class="docutils literal notranslate"><span class="pre">None</span></code> or <a class="reference internal" href="#buildbot.process.results.SKIPPED" title="buildbot.process.results.SKIPPED"><code class="xref py py-data docutils literal notranslate"><span class="pre">SKIPPED</span></code></a>,
optionally via a Deferred.</td>
</tr>
</tbody>
</table>
<p>Begin the step.
BuildSteps written before Buildbot-0.9.0 often override this method instead of <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.run" title="buildbot.process.buildstep.BuildStep.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span></code></a>, but this approach is deprecated.</p>
<p>When the step is done, it should call <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code></a>, with a result – a constant from <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.results</span></code></a>.
The result will be handed off to the <a class="reference internal" href="#buildbot.process.build.Build" title="buildbot.process.build.Build"><code class="xref py py-class docutils literal notranslate"><span class="pre">Build</span></code></a>.</p>
<p>If the step encounters an exception, it should call <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">failed</span></code></a> with a Failure object.</p>
<p>If the step decides it does not need to be run, <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.start" title="buildbot.process.buildstep.BuildStep.start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start</span></code></a> can return the constant <a class="reference internal" href="#buildbot.process.results.SKIPPED" title="buildbot.process.results.SKIPPED"><code class="xref py py-data docutils literal notranslate"><span class="pre">SKIPPED</span></code></a>.
In this case, it is not necessary to call <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code></a> directly.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.finished">
<code class="descname">finished</code><span class="sig-paren">(</span><em>results</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.finished" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>results</strong> – a constant from <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-mod docutils literal notranslate"><span class="pre">results</span></code></a></td>
</tr>
</tbody>
</table>
<p>A call to this method indicates that the step is finished and the build should analyze the results and perhaps proceed to the next step.
The step should not perform any additional processing after calling this method.
This method must only be called from the (deprecated) <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.start" title="buildbot.process.buildstep.BuildStep.start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start</span></code></a> method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.failed">
<code class="descname">failed</code><span class="sig-paren">(</span><em>failure</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.failed" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>failure</strong> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">Failure</span></code> instance</td>
</tr>
</tbody>
</table>
<p>Similar to <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code></a>, this method indicates that the step is finished, but handles exceptions with appropriate logging and diagnostics.</p>
<p>This method handles <a class="reference internal" href="#buildbot.process.buildstep.BuildStepFailed" title="buildbot.process.buildstep.BuildStepFailed"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildStepFailed</span></code></a> specially, by calling <code class="docutils literal notranslate"><span class="pre">finished(FAILURE)</span></code>.
This provides subclasses with a shortcut to stop execution of a step by raising this failure in a context where <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">failed</span></code></a> will catch it.
This method must only be called from the (deprecated) <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.start" title="buildbot.process.buildstep.BuildStep.start"><code class="xref py py-meth docutils literal notranslate"><span class="pre">start</span></code></a> method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.interrupt">
<code class="descname">interrupt</code><span class="sig-paren">(</span><em>reason</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.interrupt" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>reason</strong> (string or <code class="xref py py-class docutils literal notranslate"><span class="pre">Failure</span></code>) – why the build was interrupted</td>
</tr>
</tbody>
</table>
<p>This method is used from various control interfaces to stop a running step.
The step should be brought to a halt as quickly as possible, by cancelling a remote command, killing a local process, etc.
The step must still finish with either <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finished</span></code></a> or <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">failed</span></code></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">reason</span></code> parameter can be a string or, when a worker is lost during step processing, a <code class="xref py py-exc docutils literal notranslate"><span class="pre">ConnectionLost</span></code> failure.</p>
<p>The parent method handles any pending lock operations, and should be called by implementations in subclasses.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.stopped">
<code class="descname">stopped</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.stopped" title="Permalink to this definition">¶</a></dt>
<dd><p>If false, then the step is running.
If true, the step is not running, or has been interrupted.</p>
</dd></dl>

<p>A step can indicate its up-to-the-moment status using a short summary string.
These methods allow step subclasses to produce such summaries.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.updateSummary">
<code class="descname">updateSummary</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.updateSummary" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the summary, calling <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getCurrentSummary" title="buildbot.process.buildstep.BuildStep.getCurrentSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getCurrentSummary</span></code></a> or <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getResultSummary" title="buildbot.process.buildstep.BuildStep.getResultSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getResultSummary</span></code></a> as appropriate.
New-style build steps should call this method any time the summary may have changed.
This method is debounced, so even calling it for every log line is acceptable.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getCurrentSummary">
<code class="descname">getCurrentSummary</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getCurrentSummary" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary, optionally via Deferred</td>
</tr>
</tbody>
</table>
<p>Returns a dictionary containing status information for a running step.
The dictionary can have a <code class="docutils literal notranslate"><span class="pre">step</span></code> key with a unicode value giving a summary for display with the step.
This method is only called while the step is running.</p>
<p>New-style build steps should override this method to provide a more interesting summary than the default <code class="docutils literal notranslate"><span class="pre">u&quot;running&quot;</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getResultSummary">
<code class="descname">getResultSummary</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getResultSummary" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary, optionally via Deferred</td>
</tr>
</tbody>
</table>
<p>Returns a dictionary containing status information for a completed step.
The dictionary can have keys <code class="docutils literal notranslate"><span class="pre">step</span></code> and <code class="docutils literal notranslate"><span class="pre">build</span></code>, each with unicode values.
The <code class="docutils literal notranslate"><span class="pre">step</span></code> key gives a summary for display with the step, while the <code class="docutils literal notranslate"><span class="pre">build</span></code> key gives a summary for display with the entire build.
The latter should be used sparingly, and include only information that the user would find relevant for the entire build, such as a number of test failures.
Either or both keys can be omitted.</p>
<p>This method is only called while the step is finished.
The step’s result is available in <code class="docutils literal notranslate"><span class="pre">self.results</span></code> at that time.</p>
<p>New-style build steps should override this method to provide a more interesting summary than the default, or to provide any build summary information.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getBuildResultSummary">
<code class="descname">getBuildResultSummary</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getBuildResultSummary" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">dictionary, optionally via Deferred</td>
</tr>
</tbody>
</table>
<p>Returns a dictionary containing status information for a completed step.
This method calls <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getResultSummary" title="buildbot.process.buildstep.BuildStep.getResultSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getResultSummary</span></code></a>, and automatically compute a <code class="docutils literal notranslate"><span class="pre">build</span></code> key from the <code class="docutils literal notranslate"><span class="pre">step</span></code> key according to the <code class="docutils literal notranslate"><span class="pre">updateBuildSummaryPolicy</span></code></p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.describe">
<code class="descname">describe</code><span class="sig-paren">(</span><em>done=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.describe" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>done</strong> – If true, the step is finished.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of strings</td>
</tr>
</tbody>
</table>
<p>Describe the step succinctly.
The return value should be a sequence of short strings suitable for display in a horizontally constrained space.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be careful not to assume that the step has been started in this method.
In relatively rare circumstances, steps are described before they have started.
Ideally, unit tests should be used to ensure that this method is resilient.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method is not called for new-style steps.
Instead, override <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getCurrentSummary" title="buildbot.process.buildstep.BuildStep.getCurrentSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getCurrentSummary</span></code></a> and <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getResultSummary" title="buildbot.process.buildstep.BuildStep.getResultSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getResultSummary</span></code></a>.</p>
</div>
</dd></dl>

<p>Build steps have statistics, a simple key/value store of data which can later be aggregated over all steps in a build.
Note that statistics are not preserved after a build is complete.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.hasStatistic">
<code class="descname">hasStatistic</code><span class="sig-paren">(</span><em>stat</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.hasStatistic" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>stat</strong> (<em>string</em>) – name of the statistic</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">True if the statistic exists on this step</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getStatistic">
<code class="descname">getStatistic</code><span class="sig-paren">(</span><em>stat</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getStatistic" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stat</strong> (<em>string</em>) – name of the statistic</li>
<li><strong>default</strong> – default value if the statistic does not exist</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">value of the statistic, or the default value</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getStatistics">
<code class="descname">getStatistics</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getStatistics" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">a dictionary of all statistics for this step</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setStatistic">
<code class="descname">setStatistic</code><span class="sig-paren">(</span><em>stat</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setStatistic" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>stat</strong> (<em>string</em>) – name of the statistic</li>
<li><strong>value</strong> – value to assign to the statistic</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">value of the statistic</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Build steps support progress metrics - values that increase roughly linearly during the execution of the step, and can thus be used to calculate an expected completion time for a running step.
A metric may be a count of lines logged, tests executed, or files compiled.
The build mechanics will take care of translating this progress information into an ETA for the user.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setProgress">
<code class="descname">setProgress</code><span class="sig-paren">(</span><em>metric</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setProgress" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>metric</strong> (<em>string</em>) – the metric to update</li>
<li><strong>value</strong> (<em>integer</em>) – the new value for the metric</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Update a progress metric.
This should be called by subclasses that can provide useful progress-tracking information.</p>
<p>The specified metric name must be included in <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.progressMetrics" title="buildbot.process.buildstep.BuildStep.progressMetrics"><code class="xref py py-attr docutils literal notranslate"><span class="pre">progressMetrics</span></code></a>.</p>
</dd></dl>

<p>The following methods are provided as utilities to subclasses.
These methods should only be invoked after the step is started.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.workerVersion">
<code class="descname">workerVersion</code><span class="sig-paren">(</span><em>command</em>, <em>oldversion=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.workerVersion" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> (<em>string</em>) – command to examine</li>
<li><strong>oldversion</strong> – return value if the worker does not specify a version</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">string</p>
</td>
</tr>
</tbody>
</table>
<p>Fetch the version of the named command, as specified on the worker.
In practice, all commands on a worker have the same version, but passing <code class="docutils literal notranslate"><span class="pre">command</span></code> is still useful to ensure that the command is implemented on the worker.
If the command is not implemented on the worker, <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.workerVersion" title="buildbot.process.buildstep.BuildStep.workerVersion"><code class="xref py py-meth docutils literal notranslate"><span class="pre">workerVersion</span></code></a> will return <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>Versions take the form <code class="docutils literal notranslate"><span class="pre">x.y</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are integers, and are compared as expected for version numbers.</p>
<p>Buildbot versions older than 0.5.0 did not support version queries; in this case, <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.workerVersion" title="buildbot.process.buildstep.BuildStep.workerVersion"><code class="xref py py-meth docutils literal notranslate"><span class="pre">workerVersion</span></code></a> will return <code class="docutils literal notranslate"><span class="pre">oldVersion</span></code>.
Since such ancient versions of Buildbot are no longer in use, this functionality is largely vestigial.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.workerVersionIsOlderThan">
<code class="descname">workerVersionIsOlderThan</code><span class="sig-paren">(</span><em>command</em>, <em>minversion</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.workerVersionIsOlderThan" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> (<em>string</em>) – command to examine</li>
<li><strong>minversion</strong> – minimum version</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean</p>
</td>
</tr>
</tbody>
</table>
<p>This method returns true if <code class="docutils literal notranslate"><span class="pre">command</span></code> is not implemented on the worker, or if it is older than <code class="docutils literal notranslate"><span class="pre">minversion</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.checkWorkerHasCommand">
<code class="descname">checkWorkerHasCommand</code><span class="sig-paren">(</span><em>command</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.checkWorkerHasCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>command</strong> (<em>string</em>) – command to examine</td>
</tr>
</tbody>
</table>
<p>This method raise <code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerTooOldError</span></code> if <code class="docutils literal notranslate"><span class="pre">command</span></code> is not implemented on the worker</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getWorkerName">
<code class="descname">getWorkerName</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getWorkerName" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>Get the name of the worker assigned to this step.</p>
</dd></dl>

<p>Most steps exist to run commands.
While the details of exactly how those commands are constructed are left to subclasses, the execution of those commands comes down to this method:</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.runCommand">
<code class="descname">runCommand</code><span class="sig-paren">(</span><em>command</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.runCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>command</strong> – <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> instance</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method connects the given command to the step’s worker and runs it, returning the Deferred from <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand.run" title="buildbot.process.remotecommand.RemoteCommand.run"><code class="xref py py-meth docutils literal notranslate"><span class="pre">run</span></code></a>.</p>
</dd></dl>

<p>The <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> class provides methods to add log data to the step.
Subclasses provide a great deal of user-configurable functionality on top of these methods.
These methods can be called while the step is running, but not before.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addLog">
<code class="descname">addLog</code><span class="sig-paren">(</span><em>name</em>, <em>type=&quot;s&quot;</em>, <em>logEncoding=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – log name</li>
<li><strong>type</strong> – log type; see <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a></li>
<li><strong>logEncoding</strong> – the log encoding, or None to use the step or global default (see <a class="reference internal" href="#log-encodings"><span class="std std-ref">Log Handling</span></a>)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#buildbot.process.log.Log" title="buildbot.process.log.Log"><code class="xref py py-class docutils literal notranslate"><span class="pre">Log</span></code></a> instance via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new logfile with the given name to the step, and return the log file instance.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getLog">
<code class="descname">getLog</code><span class="sig-paren">(</span><em>name</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>name</strong> – log name</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first simple">
<li><strong>KeyError</strong> – if there is no such log</li>
<li><strong>KeyError</strong> – if no such log is defined</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#buildbot.process.log.Log" title="buildbot.process.log.Log"><code class="xref py py-class docutils literal notranslate"><span class="pre">Log</span></code></a> instance</p>
</td>
</tr>
</tbody>
</table>
<p>Return an existing logfile, previously added with <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addLog" title="buildbot.process.buildstep.BuildStep.addLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addLog</span></code></a>.
Note that this return value is synchronous, and only available after <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addLog" title="buildbot.process.buildstep.BuildStep.addLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addLog</span></code></a>’s deferred has fired.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addCompleteLog">
<code class="descname">addCompleteLog</code><span class="sig-paren">(</span><em>name</em>, <em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – log name</li>
<li><strong>text</strong> – content of the logfile</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>This method adds a new log and sets <code class="docutils literal notranslate"><span class="pre">text</span></code> as its content.
This is often useful to add a short logfile describing activities performed on the master.
The logfile is immediately closed, and no further data can be added.</p>
<p>If the logfile’s content is a bytestring, it is decoded with the step’s log encoding or the global default log encoding.
To add a logfile with a different character encoding, perform the decode operation directly and pass the resulting unicode string to this method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addHTMLLog">
<code class="descname">addHTMLLog</code><span class="sig-paren">(</span><em>name</em>, <em>html</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addHTMLLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – log name</li>
<li><strong>html</strong> – content of the logfile</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Similar to <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addCompleteLog</span></code></a>, this adds a logfile containing pre-formatted HTML, allowing more expressiveness than the text format supported by <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addCompleteLog</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addLogObserver">
<code class="descname">addLogObserver</code><span class="sig-paren">(</span><em>logname</em>, <em>observer</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addLogObserver" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logname</strong> – log name</li>
<li><strong>observer</strong> – log observer instance</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Add a log observer for the named log.
The named log need not have been added already: the observer will be connected when the log is added.</p>
<p>See <a class="reference internal" href="#adding-logobservers"><span class="std std-ref">Adding LogObservers</span></a> for more information on log observers.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addLogWithFailure">
<code class="descname">addLogWithFailure</code><span class="sig-paren">(</span><em>why</em>, <em>logprefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addLogWithFailure" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>why</strong> (<em>Failure</em>) – the failure to log</li>
<li><strong>logprefix</strong> – prefix for the log name</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add log files displaying the given failure, named <code class="docutils literal notranslate"><span class="pre">&lt;logprefix&gt;err.text</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;logprefix&gt;err.html</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addLogWithException">
<code class="descname">addLogWithException</code><span class="sig-paren">(</span><em>why</em>, <em>logprefix=''</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addLogWithException" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>why</strong> (<em>Exception</em>) – the exception to log</li>
<li><strong>logprefix</strong> – prefix for the log name</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Similar to <code class="docutils literal notranslate"><span class="pre">addLogWithFailure</span></code>, but for an Exception instead of a Failure.</p>
</dd></dl>

<p>Along with logs, build steps have an associated set of links that can be used to provide additional information for developers.
Those links are added during the build with this method:</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addURL">
<code class="descname">addURL</code><span class="sig-paren">(</span><em>name</em>, <em>url</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addURL" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – URL name</li>
<li><strong>url</strong> – the URL</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Add a link to the given <code class="docutils literal notranslate"><span class="pre">url</span></code>, with the given <code class="docutils literal notranslate"><span class="pre">name</span></code> to displays of this step.
This allows a step to provide links to data that is not available in the log files.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="loggingbuildstep">
<h5>3.5.7.2. LoggingBuildStep<a class="headerlink" href="#loggingbuildstep" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.process.buildstep.LoggingBuildStep">
<em class="property">class </em><code class="descclassname">buildbot.process.buildstep.</code><code class="descname">LoggingBuildStep</code><span class="sig-paren">(</span><em>name</em>, <em>locks</em>, <em>haltOnFailure</em>, <em>flunkOnWarnings</em>, <em>flunkOnFailure</em>, <em>warnOnWarnings</em>, <em>warnOnFailure</em>, <em>alwaysRun</em>, <em>progressMetrics</em>, <em>useProgress</em>, <em>doStepIf</em>, <em>hideStepIf</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep" title="Permalink to this definition">¶</a></dt>
<dd><p>The remaining arguments are passed to the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> constructor.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Subclasses of this class are always old-style steps.
As such, this class will be removed after Buildbot-0.9.0.
Instead, subclass <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> and mix in <a class="reference internal" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin" title="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellMixin</span></code></a> to get similar behavior.</p>
</div>
<p>This subclass of <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> is designed to help its subclasses run remote commands that produce standard I/O logfiles.
It:</p>
<ul class="simple">
<li>tracks progress using the length of the stdout logfile</li>
<li>provides hooks for summarizing and evaluating the command’s result</li>
<li>supports lazy logfiles</li>
<li>handles the mechanics of starting, interrupting, and finishing remote commands</li>
<li>detects lost workers and finishes with a status of
<a class="reference internal" href="#buildbot.process.results.RETRY" title="buildbot.process.results.RETRY"><code class="xref py py-data docutils literal notranslate"><span class="pre">RETRY</span></code></a></li>
</ul>
<dl class="attribute">
<dt id="buildbot.process.buildstep.LoggingBuildStep.logfiles">
<code class="descname">logfiles</code><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.logfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>The logfiles to track, as described for <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a>.
The contents of the class-level <code class="docutils literal notranslate"><span class="pre">logfiles</span></code> attribute are combined with those passed to the constructor, so subclasses may add log files with a class attribute:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyStep</span><span class="p">(</span><span class="n">LoggingBuildStep</span><span class="p">):</span>
    <span class="n">logfiles</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="s1">&#39;debug.log&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that lazy logfiles cannot be specified using this method; they must be provided as constructor arguments.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">setupLogsRunCommandAndProcessResults(cmd, stdioLog=None, closeLogWhenFinished=True, errorMessages=None, logfiles=None, lazylogfiles=False):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> – the <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a>
instance to start</li>
<li><strong>stdioLog</strong> – an optional <a class="reference internal" href="#buildbot.process.log.Log" title="buildbot.process.log.Log"><code class="xref py py-class docutils literal notranslate"><span class="pre">Log</span></code></a> object where the
stdout of the command will be stored.</li>
<li><strong>closeLogWhenFinished</strong> – a boolean</li>
<li><strong>logfiles</strong> – optional dictionary see <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a></li>
<li><strong>lazylogfiles</strong> – optional boolean see <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">step result from <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.results</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div>This method permits an optional <code class="docutils literal notranslate"><span class="pre">errorMessages</span></code> parameter, allowing errors detected early in the command process to be logged.
It will be removed, and its use is deprecated.</div></blockquote>
<p>Handle all of the mechanics of running the given command.
This sets up all required logfiles, and calls the utility hooks described below.</p>
<p>Subclasses should use that method if they want to launch multiple commands in a single step.
One could use that method, like for example</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@defer</span><span class="o">.</span><span class="n">inlineCallbacks</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="n">RemoteCommand</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupLogRunCommandAndProcessResults</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="n">results</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">:</span>
         <span class="n">cmd</span> <span class="o">=</span> <span class="n">RemoteCommand</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
         <span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupLogRunCommandAndProcessResults</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
</dd></dl>

<p>To refine the status output, override one or more of the following methods.
The <a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep" title="buildbot.process.buildstep.LoggingBuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoggingBuildStep</span></code></a> implementations are stubs, so there is no need to call the parent method.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.LoggingBuildStep.commandComplete">
<code class="descname">commandComplete</code><span class="sig-paren">(</span><em>command</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.commandComplete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>command</strong> – the just-completed remote command</td>
</tr>
</tbody>
</table>
<p>This is a general-purpose hook method for subclasses.
It will be called after the remote command has finished, but before any of the other hook functions are called.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.LoggingBuildStep.evaluateCommand">
<code class="descname">evaluateCommand</code><span class="sig-paren">(</span><em>command</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.evaluateCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>command</strong> – the just-completed remote command</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">step result from <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.results</span></code></a></td>
</tr>
</tbody>
</table>
<p>This hook should decide what result the step should have.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="commandmixin">
<h5>3.5.7.3. CommandMixin<a class="headerlink" href="#commandmixin" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.runCommand" title="buildbot.process.buildstep.BuildStep.runCommand"><code class="xref py py-meth docutils literal notranslate"><span class="pre">runCommand</span></code></a> method can run a <a class="reference internal" href="#buildbot.process.remotecommand.RemoteCommand" title="buildbot.process.remotecommand.RemoteCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommand</span></code></a> instance, but it’s no help in building that object or interpreting the results afterward.
This mixin class adds some useful methods for running commands.</p>
<p>This class can only be used in new-style steps.</p>
<dl class="class">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin">
<em class="property">class </em><code class="descclassname">buildbot.process.buildstep.</code><code class="descname">CommandMixin</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>Some remote commands are simple enough that they can boil down to a method call.
Most of these take an <code class="docutils literal notranslate"><span class="pre">abandonOnFailure</span></code> argument which, if true, will abandon the entire buildstep on command failure.
This is accomplished by raising <a class="reference internal" href="#buildbot.process.buildstep.BuildStepFailed" title="buildbot.process.buildstep.BuildStepFailed"><code class="xref py py-exc docutils literal notranslate"><span class="pre">BuildStepFailed</span></code></a>.</p>
<p>These methods all write to the <code class="docutils literal notranslate"><span class="pre">stdio</span></code> log (generally just for errors).
They do not close the log when finished.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.runRmdir">
<code class="descname">runRmdir</code><span class="sig-paren">(</span><em>dir</em>, <em>abandonOnFailure=True</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.runRmdir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dir</strong> – directory to remove</li>
<li><strong>abndonOnFailure</strong> – if true, abandon step on failure</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Boolean via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Remove the given directory, using the <code class="docutils literal notranslate"><span class="pre">rmdir</span></code> command.
Returns False on failure.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.runMkdir">
<code class="descname">runMkdir</code><span class="sig-paren">(</span><em>dir</em>, <em>abandonOnFailure=True</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.runMkdir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dir</strong> – directory to create</li>
<li><strong>abndonOnFailure</strong> – if true, abandon step on failure</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Boolean via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Create the given directory and any parent directories, using the <code class="docutils literal notranslate"><span class="pre">mkdir</span></code> command.
Returns False on failure.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.pathExists">
<code class="descname">pathExists</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.pathExists" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> – path to test</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Boolean via Deferred</td>
</tr>
</tbody>
</table>
<p>Determine if the given path exists on the worker (in any form - file, directory, or otherwise).
This uses the <code class="docutils literal notranslate"><span class="pre">stat</span></code> command.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.runGlob">
<code class="descname">runGlob</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.runGlob" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> – path to test</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of filenames</td>
</tr>
</tbody>
</table>
<p>Get the list of files matching the given path pattern on the worker.
This uses Python’s <code class="docutils literal notranslate"><span class="pre">glob</span></code> module.
If the <code class="docutils literal notranslate"><span class="pre">runGlob</span></code> method fails, it aborts the step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.getFileContentFromWorker">
<code class="descname">getFileContentFromWorker</code><span class="sig-paren">(</span><em>path</em>, <em>abandonOnFailure=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.CommandMixin.getFileContentFromWorker" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> – path of the file to download from worker</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">string via deferred (content of the file)</td>
</tr>
</tbody>
</table>
<p>Get the content of a file on the worker.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="shellmixin">
<h5>3.5.7.4. ShellMixin<a class="headerlink" href="#shellmixin" title="Permalink to this headline">¶</a></h5>
<p>Most Buildbot steps run shell commands on the worker, and Buildbot has an impressive array of configuration parameters to control that execution.
The <code class="docutils literal notranslate"><span class="pre">ShellMixin</span></code> mixin provides the tools to make running shell commands easy and flexible.</p>
<p>This class can only be used in new-style steps.</p>
<dl class="class">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin">
<em class="property">class </em><code class="descclassname">buildbot.process.buildstep.</code><code class="descname">ShellMixin</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This mixin manages the following step configuration parameters, the contents of which are documented in the manual.
Naturally, all of these are renderable.</p>
<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.command">
<code class="descname">command</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.command" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.workdir">
<code class="descname">workdir</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.workdir" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.env">
<code class="descname">env</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.env" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.want_stdout">
<code class="descname">want_stdout</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.want_stdout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.want_stderr">
<code class="descname">want_stderr</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.want_stderr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.usePTY">
<code class="descname">usePTY</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.usePTY" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.logfiles">
<code class="descname">logfiles</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.logfiles" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.lazylogfiles">
<code class="descname">lazylogfiles</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.lazylogfiles" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.timeout">
<code class="descname">timeout</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.timeout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.maxTime">
<code class="descname">maxTime</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.maxTime" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.logEnviron">
<code class="descname">logEnviron</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.logEnviron" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.interruptSignal">
<code class="descname">interruptSignal</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.interruptSignal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.sigtermTime">
<code class="descname">sigtermTime</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.sigtermTime" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.initialStdin">
<code class="descname">initialStdin</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.initialStdin" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.decodeRC">
<code class="descname">decodeRC</code><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.decodeRC" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.setupShellMixin">
<code class="descname">setupShellMixin</code><span class="sig-paren">(</span><em>constructorArgs</em>, <em>prohibitArgs=[]</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.setupShellMixin" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>constructorArgs</strong> (<em>dict</em>) – constructor keyword arguments</li>
<li><strong>prohibitArgs</strong> (<em>list</em>) – list of recognized arguments to reject</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">keyword arguments destined for <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>This method is intended to be called from the shell constructor, passed any keyword arguments not otherwise used by the step.
Any attributes set on the instance already (e.g., class-level attributes) are used as defaults.
Attributes named in <code class="docutils literal notranslate"><span class="pre">prohibitArgs</span></code> are rejected with a configuration error.</p>
<p>The return value should be passed to the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> constructor.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.makeRemoteShellCommand">
<code class="descname">makeRemoteShellCommand</code><span class="sig-paren">(</span><em>collectStdout=False</em>, <em>collectStderr=False</em>, <em>**overrides</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.makeRemoteShellCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>collectStdout</strong> – if true, the command’s stdout will be available in <code class="docutils literal notranslate"><span class="pre">cmd.stdout</span></code> on completion</li>
<li><strong>collectStderr</strong> – if true, the command’s stderr will be available in <code class="docutils literal notranslate"><span class="pre">cmd.stderr</span></code> on completion</li>
<li><strong>overrides</strong> – overrides arguments that might have been passed to <a class="reference internal" href="#buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.setupShellMixin" title="buildbot.process.buildstep.buildbot.process.buildstep.ShellMixin.setupShellMixin"><code class="xref py py-meth docutils literal notranslate"><span class="pre">setupShellMixin</span></code></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#buildbot.process.remotecommand.RemoteShellCommand" title="buildbot.process.remotecommand.RemoteShellCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteShellCommand</span></code></a> instance via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>This method constructs a <a class="reference internal" href="#buildbot.process.remotecommand.RemoteShellCommand" title="buildbot.process.remotecommand.RemoteShellCommand"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteShellCommand</span></code></a> instance based on the instance attributes and any supplied overrides.
It must be called while the step is running, as it examines the worker capabilities before creating the command.
It takes care of just about everything:</p>
<blockquote>
<div><ul class="simple">
<li>Creating log files and associating them with the command</li>
<li>Merging environment configuration</li>
<li>Selecting the appropriate workdir configuration</li>
</ul>
</div></blockquote>
<p>All that remains is to run the command with <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.runCommand" title="buildbot.process.buildstep.BuildStep.runCommand"><code class="xref py py-meth docutils literal notranslate"><span class="pre">runCommand</span></code></a>.</p>
</dd></dl>

<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">ShellMixin</span></code> class implements <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getResultSummary" title="buildbot.process.buildstep.BuildStep.getResultSummary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getResultSummary</span></code></a>, returning a summary of the command.
If no command was specified or run, it falls back to the default <code class="docutils literal notranslate"><span class="pre">getResultSummary</span></code> based on <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code>.
Subclasses can override this method to return a more appropriate status.</p>
</dd></dl>

</div>
<div class="section" id="exceptions">
<h5>3.5.7.5. Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h5>
<dl class="exception">
<dt id="buildbot.process.buildstep.BuildStepFailed">
<em class="property">exception </em><code class="descclassname">buildbot.process.buildstep.</code><code class="descname">BuildStepFailed</code><a class="headerlink" href="#buildbot.process.buildstep.BuildStepFailed" title="Permalink to this definition">¶</a></dt>
<dd><p>This exception indicates that the buildstep has failed.
It is useful as a way to skip all subsequent processing when a step goes wrong.
It is handled by <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><code class="xref py py-meth docutils literal notranslate"><span class="pre">BuildStep.failed</span></code></a>.</p>
</dd></dl>

</div>
</div>
<span id="document-developer/cls-basescheduler"></span><div class="section" id="module-buildbot.schedulers.base">
<span id="basescheduler"></span><h4>3.5.8. BaseScheduler<a class="headerlink" href="#module-buildbot.schedulers.base" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="buildbot.schedulers.base.BaseScheduler">
<em class="property">class </em><code class="descclassname">buildbot.schedulers.base.</code><code class="descname">BaseScheduler</code><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base class for all Buildbot schedulers.
See <a class="reference internal" href="#writing-schedulers"><span class="std std-ref">Writing Schedulers</span></a> for information on writing new schedulers.</p>
<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>name</em>, <em>builderNames</em>, <em>properties={}</em>, <em>codebases={'':{}}</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.__init__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> – (positional) the scheduler name</li>
<li><strong>builderName</strong> – (positional) a list of builders, by name, for which this scheduler can queue builds</li>
<li><strong>properties</strong> – a dictionary of properties to be added to queued builds</li>
<li><strong>codebases</strong> – the codebase configuration for this scheduler (see user documentation)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Initializes a new scheduler.</p>
</dd></dl>

<p>The scheduler configuration parameters, and a few others, are available as attributes:</p>
<dl class="attribute">
<dt id="buildbot.schedulers.base.BaseScheduler.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.name" title="Permalink to this definition">¶</a></dt>
<dd><p>This scheduler’s name.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.base.BaseScheduler.builderNames">
<code class="descname">builderNames</code><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.builderNames" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<p>Builders for which this scheduler can queue builds.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.base.BaseScheduler.codebases">
<code class="descname">codebases</code><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.codebases" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<p>The codebase configuration for this scheduler.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.base.BaseScheduler.properties">
<code class="descname">properties</code><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.properties" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">Properties instance</td>
</tr>
</tbody>
</table>
<p>Properties that this scheduler will attach to queued builds.
This attribute includes the <code class="docutils literal notranslate"><span class="pre">scheduler</span></code> property.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.base.BaseScheduler.schedulerid">
<code class="descname">schedulerid</code><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.schedulerid" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body">integer</td>
</tr>
</tbody>
</table>
<p>The ID of this scheduler in the <code class="docutils literal notranslate"><span class="pre">schedulers</span></code> table.</p>
</dd></dl>

<p>Subclasses can consume changes by implementing <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.gotChange" title="buildbot.schedulers.base.BaseScheduler.gotChange"><code class="xref py py-meth docutils literal notranslate"><span class="pre">gotChange</span></code></a> and calling <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.startConsumingChanges" title="buildbot.schedulers.base.BaseScheduler.startConsumingChanges"><code class="xref py py-meth docutils literal notranslate"><span class="pre">startConsumingChanges</span></code></a> from <code class="xref py py-meth docutils literal notranslate"><span class="pre">startActivity</span></code>.</p>
<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.startConsumingChanges">
<code class="descname">startConsumingChanges</code><span class="sig-paren">(</span><em>self</em>, <em>fileIsImportant=None</em>, <em>change_filter=None</em>, <em>onlyImportant=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.startConsumingChanges" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>fileIsImportant</strong> (<em>callable</em>) – a callable provided by the user to distinguish important and unimportant changes</li>
<li><strong>change_filter</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.changes.filter.ChangeFilter</span></code> instance) – a filter to determine which changes are even considered by this scheduler, or <code class="docutils literal notranslate"><span class="pre">None</span></code> to consider all changes</li>
<li><strong>onlyImportant</strong> (<em>boolean</em>) – If True, only important changes, as specified by fileIsImportant, will be added to the buildset.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Subclasses should call this method when becoming active in order to receive changes.
The parent class will take care of filtering the changes (using <code class="docutils literal notranslate"><span class="pre">change_filter</span></code>) and (if <code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> is not None) classifying them.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.gotChange">
<code class="descname">gotChange</code><span class="sig-paren">(</span><em>change</em>, <em>important</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.gotChange" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>change</strong> (<a class="reference internal" href="#buildbot.changes.changes.Change" title="buildbot.changes.changes.Change"><em>buildbot.changes.changes.Change</em></a>) – the new change</li>
<li><strong>important</strong> (<em>boolean</em>) – true if the change is important</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>This method is called when a change is received.
Schedulers which consume changes should implement this method.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">fileIsImportant</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">startConsumingChanges</span></code> was None, then all changes are considered important.
It is guaranteed that the <code class="docutils literal notranslate"><span class="pre">codebase</span></code> of the change is one of the scheduler’s codebase.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <a class="reference internal" href="#buildbot.changes.changes.Change" title="buildbot.changes.changes.Change"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.changes.changes.Change</span></code></a> instance will instead be a change resource in later versions.</p>
</div>
</dd></dl>

<p>The following methods are available for subclasses to queue new builds.
Each creates a new buildset with a build request for each builder.</p>
<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.addBuildsetForSourceStamps">
<code class="descname">addBuildsetForSourceStamps</code><span class="sig-paren">(</span><em>self</em>, <em>sourcestamps=[]</em>, <em>waited_for=False</em>, <em>reason=''</em>, <em>external_idstring=None</em>, <em>properties=None</em>, <em>builderNames=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.addBuildsetForSourceStamps" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sourcestamps</strong> (<em>list</em>) – a list of full sourcestamp dictionaries or sourcestamp IDs</li>
<li><strong>waited_for</strong> (<em>boolean</em>) – if true, this buildset is being waited for (and thus should continue during a clean shutdown)</li>
<li><strong>reason</strong> (<em>string</em>) – reason for the build set</li>
<li><strong>external_idstring</strong> (<em>string</em>) – external identifier for the buildset</li>
<li><strong>properties</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Properties</span></code> instance) – properties - in addition to those in the scheduler configuration - to include in the buildset</li>
<li><strong>builderNames</strong> (<em>list</em>) – a list of builders for the buildset, or None to use the scheduler’s configured <code class="docutils literal notranslate"><span class="pre">builderNames</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(buildset ID, buildrequest IDs) via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a buildset for the given source stamps.
Each source stamp must be specified as a complete source stamp dictionary (with keys <code class="docutils literal notranslate"><span class="pre">revision</span></code>, <code class="docutils literal notranslate"><span class="pre">branch</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, <code class="docutils literal notranslate"><span class="pre">repository</span></code>, and <code class="docutils literal notranslate"><span class="pre">codebase</span></code>), or an integer <code class="docutils literal notranslate"><span class="pre">sourcestampid</span></code>.</p>
<p>The return value is a tuple.
The first tuple element is the ID of the new buildset.
The second tuple element is a dictionary mapping builder name to buildrequest ID.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.addBuildsetForSourceStampsWithDefaults">
<code class="descname">addBuildsetForSourceStampsWithDefaults</code><span class="sig-paren">(</span><em>reason</em>, <em>sourcestamps</em>, <em>waited_for=False</em>, <em>properties=None</em>, <em>builderNames=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.addBuildsetForSourceStampsWithDefaults" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>reason</strong> (<em>string</em>) – reason for the build set</li>
<li><strong>sourcestamps</strong> (<em>list</em>) – partial list of source stamps to build</li>
<li><strong>waited_for</strong> (<em>boolean</em>) – if true, this buildset is being waited for (and thus should continue during a clean shutdown)</li>
<li><strong>properties</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Properties</span></code> instance) – properties - in addition to those in the scheduler configuration - to include in the buildset</li>
<li><strong>builderNames</strong> (<em>list</em>) – a list of builders for the buildset, or None to use the scheduler’s configured <code class="docutils literal notranslate"><span class="pre">builderNames</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(buildset ID, buildrequest IDs) via Deferred, as for <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.addBuildsetForSourceStamps" title="buildbot.schedulers.base.BaseScheduler.addBuildsetForSourceStamps"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addBuildsetForSourceStamps</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Create a buildset based on the supplied sourcestamps, with defaults applied from the scheduler’s configuration.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">sourcestamps</span></code> parameter is a list of source stamp dictionaries, giving the required parameters.
Any unspecified values, including sourcestamps from unspecified codebases, will be filled in from the scheduler’s configuration.
If <code class="docutils literal notranslate"><span class="pre">sourcestamps</span></code> is None, then only the defaults will be used.
If <code class="docutils literal notranslate"><span class="pre">sourcestamps</span></code> includes sourcestamps for codebases not configured on the scheduler, they will be included anyway, although this is probably a sign of an incorrect configuration.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.addBuildsetForChanges">
<code class="descname">addBuildsetForChanges</code><span class="sig-paren">(</span><em>waited_for=False</em>, <em>reason=''</em>, <em>external_idstring=None</em>, <em>changeids=[]</em>, <em>builderNames=None</em>, <em>properties=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.addBuildsetForChanges" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>waited_for</strong> (<em>boolean</em>) – if true, this buildset is being waited for (and thus should continue during a clean shutdown)</li>
<li><strong>reason</strong> (<em>string</em>) – reason for the build set</li>
<li><strong>external_idstring</strong> (<em>string</em>) – external identifier for the buildset</li>
<li><strong>changeids</strong> (<em>list</em>) – changes from which to construct the buildset</li>
<li><strong>builderNames</strong> (<em>list</em>) – a list of builders for the buildset, or None to use the scheduler’s configured <code class="docutils literal notranslate"><span class="pre">builderNames</span></code></li>
<li><strong>properties</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Properties</span></code> instance) – properties - in addition to those in the scheduler configuration - to include in the buildset</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(buildset ID, buildrequest IDs) via Deferred, as for <a class="reference internal" href="#buildbot.schedulers.base.BaseScheduler.addBuildsetForSourceStamps" title="buildbot.schedulers.base.BaseScheduler.addBuildsetForSourceStamps"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addBuildsetForSourceStamps</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Add a buildset for the given changes (<code class="docutils literal notranslate"><span class="pre">changeids</span></code>).
This will take sourcestamps from the latest of any changes with the same codebase, and will fill in sourcestamps for any codebases for which no changes are included.</p>
</dd></dl>

<p>The active state of the scheduler is tracked by the following attribute and methods.</p>
<dl class="attribute">
<dt id="buildbot.schedulers.base.BaseScheduler.active">
<code class="descname">active</code><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.active" title="Permalink to this definition">¶</a></dt>
<dd><p>True if this scheduler is active</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.activate">
<code class="descname">activate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.activate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Subclasses should override this method to initiate any processing that occurs only on active schedulers.
This is the method from which to call <code class="docutils literal notranslate"><span class="pre">startConsumingChanges</span></code>, or to set up any timers or message subscriptions.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.deactivate">
<code class="descname">deactivate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.deactivate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Subclasses should override this method to stop any ongoing processing, or wait for it to complete.
The method’s returned Deferred should not fire until the processing is complete.</p>
</dd></dl>

<p>The state-manipulation methods are provided by <a class="reference internal" href="#buildbot.util.state.StateMixin" title="buildbot.util.state.StateMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.state.StateMixin</span></code></a>.
Note that no locking of any sort is performed between these two functions.
They should <em>only</em> be called by an active scheduler.</p>
<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.getState">
<code class="descname">getState</code><span class="sig-paren">(</span><em>name</em><span class="optional">[</span>, <em>default</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.getState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – state key to fetch</li>
<li><strong>default</strong> – default value if the key is not present</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>This calls through to <a class="reference internal" href="#buildbot.db.state.StateConnectorComponent.getState" title="buildbot.db.state.StateConnectorComponent.getState"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.state.StateConnectorComponent.getState</span></code></a>, using the scheduler’s objectid.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.base.BaseScheduler.setState">
<code class="descname">setState</code><span class="sig-paren">(</span><em>name</em>, <em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.base.BaseScheduler.setState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> – state key</li>
<li><strong>value</strong> – value to set for the key</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>This calls through to <a class="reference internal" href="#buildbot.db.state.StateConnectorComponent.setState" title="buildbot.db.state.StateConnectorComponent.setState"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.state.StateConnectorComponent.setState</span></code></a>, using the scheduler’s objectid.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-forcesched"></span><div class="section" id="forcescheduler">
<span id="id1"></span><h4>3.5.9. ForceScheduler<a class="headerlink" href="#forcescheduler" title="Permalink to this headline">¶</a></h4>
<p>The force scheduler has a symbiotic relationship with the web application, so it deserves some further description.</p>
<div class="section" id="parameters">
<h5>3.5.9.1. Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h5>
<p>The force scheduler comes with a fleet of parameter classes.
This section contains information to help users or developers who are interested in adding new parameter types or hacking the existing types.</p>
<span class="target" id="module-buildbot.schedulers.forceshed"></span><dl class="class">
<dt id="buildbot.schedulers.forceshed.BaseParameter">
<em class="property">class </em><code class="descclassname">buildbot.schedulers.forceshed.</code><code class="descname">BaseParameter</code><span class="sig-paren">(</span><em>name</em>, <em>label</em>, <em>regex</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base implementation for most parameters, it will check validity, ensure the arg is present if the <a class="reference internal" href="#buildbot.schedulers.forceshed.BaseParameter.required" title="buildbot.schedulers.forceshed.BaseParameter.required"><code class="xref py py-attr docutils literal notranslate"><span class="pre">required</span></code></a> attribute is set, and implement the default value.
It will finally call <a class="reference internal" href="#buildbot.schedulers.forceshed.BaseParameter.updateFromKwargs" title="buildbot.schedulers.forceshed.BaseParameter.updateFromKwargs"><code class="xref py py-meth docutils literal notranslate"><span class="pre">updateFromKwargs</span></code></a> to process the string(s) from the HTTP POST.</p>
<p>The <a class="reference internal" href="#buildbot.schedulers.forceshed.BaseParameter" title="buildbot.schedulers.forceshed.BaseParameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseParameter</span></code></a> constructor converts all keyword arguments into instance attributes, so it is generally not necessary for subclasses to implement a constructor.</p>
<p>For custom parameters that set properties, one simple customization point is <cite>getFromKwargs</cite>:</p>
<blockquote>
<div><dl class="method">
<dt id="buildbot.schedulers.forceshed.BaseParameter.getFromKwargs">
<code class="descname">getFromKwargs</code><span class="sig-paren">(</span><em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.getFromKwargs" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>kwargs</strong> – a dictionary of the posted values</td>
</tr>
</tbody>
</table>
<p>Given the passed-in POST parameters, return the value of the property that should be set.</p>
</dd></dl>

</div></blockquote>
<p>For more control over parameter parsing, including modifying sourcestamps or changeids, override the <code class="docutils literal notranslate"><span class="pre">updateFromKwargs</span></code> function, which is the function that <code class="xref py py-class docutils literal notranslate"><span class="pre">ForceScheduler</span></code> invokes for processing:</p>
<blockquote>
<div><dl class="method">
<dt id="buildbot.schedulers.forceshed.BaseParameter.updateFromKwargs">
<code class="descname">updateFromKwargs</code><span class="sig-paren">(</span><em>master</em>, <em>properties</em>, <em>changes</em>, <em>sourcestamps</em>, <em>collector</em>, <em>kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.updateFromKwargs" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>master</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildMaster</span></code> instance</li>
<li><strong>properties</strong> – a dictionary of properties</li>
<li><strong>changes</strong> – a list of changeids that will be used to build the SourceStamp for the forced builds</li>
<li><strong>sourcestamps</strong> – the SourceStamp dictionary that will be passed to the build; some parameters modify sourcestamps rather than properties.</li>
<li><strong>collector</strong> – a <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.schedulers.forcesched.ValidationErrorCollector</span></code> object, which is used by nestedParameter to collect errors from its childs</li>
<li><strong>kwargs</strong> – a dictionary of the posted values</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method updates <code class="docutils literal notranslate"><span class="pre">properties</span></code>, <code class="docutils literal notranslate"><span class="pre">changes</span></code>,  and/or <code class="docutils literal notranslate"><span class="pre">sourcestamps</span></code> according to the request.
The default implementation is good for many simple uses, but can be overridden for more complex purposes.</p>
<p>When overriding this function, take all parameters by name (not by position), and include an <code class="docutils literal notranslate"><span class="pre">**unused</span></code> catch-all to guard against future changes.</p>
</dd></dl>

<p>The remaining attributes and methods should be overridden by subclasses, although <a class="reference internal" href="#buildbot.schedulers.forceshed.BaseParameter" title="buildbot.schedulers.forceshed.BaseParameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseParameter</span></code></a> provides appropriate defaults.</p>
<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the parameter.
This corresponds to the name of the property that your parameter will set.
This name is also used internally as identifier for http POST arguments</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.label">
<code class="descname">label</code><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.label" title="Permalink to this definition">¶</a></dt>
<dd><p>The label of the parameter, as displayed to the user.
This value can contain raw HTML.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.forceshed.BaseParameter.fullName">
<code class="descname">fullName</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.fullName" title="Permalink to this definition">¶</a></dt>
<dd><p>A fully-qualified name that uniquely identifies the parameter in the scheduler.
This name is used internally as the identifier for HTTP POST arguments.
It is a mix of <cite>name</cite> and the parent’s <cite>name</cite> (in the case of nested parameters).
This field is not modifiable.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.type">
<code class="descname">type</code><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.type" title="Permalink to this definition">¶</a></dt>
<dd><p>A string identifying the type that the parameter conforms to.
It is used by the angular application to find which angular directive to use for showing the form widget.
The available values are visible in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/www/base/src/app/common/directives/forcefields/forcefields.directive.coffee">www/base/src/app/common/directives/forcefields/forcefields.directive.coffee</a>.</p>
<p>Examples of how to create a custom parameter widgets are available in the buildbot source code in directories:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/www/codeparameter">www/codeparameter</a></li>
<li><a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/www/nestedexample">www/nestedexample</a></li>
</ul>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.default">
<code class="descname">default</code><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.default" title="Permalink to this definition">¶</a></dt>
<dd><p>The default value to use if there is no user input.
This is also used to fill in the form presented to the user.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.required">
<code class="descname">required</code><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.required" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, an error will be shown to user if there is no input in this field</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.multiple">
<code class="descname">multiple</code><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.multiple" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, this parameter represents a list of values (e.g. list of tests to run)</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.regex">
<code class="descname">regex</code><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.regex" title="Permalink to this definition">¶</a></dt>
<dd><p>A string that will be compiled as a regex and used to validate the string value of this parameter.
If None, then no validation will take place.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.forceshed.BaseParameter.parse_from_args">
<code class="descname">parse_from_args</code><span class="sig-paren">(</span><em>l</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.parse_from_args" title="Permalink to this definition">¶</a></dt>
<dd><p>return the list of object corresponding to the list or string passed default function will just call <a class="reference internal" href="#buildbot.schedulers.forceshed.BaseParameter.parse_from_arg" title="buildbot.schedulers.forceshed.BaseParameter.parse_from_arg"><code class="xref py py-func docutils literal notranslate"><span class="pre">parse_from_arg</span></code></a> with the first argument</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.forceshed.BaseParameter.parse_from_arg">
<code class="descname">parse_from_arg</code><span class="sig-paren">(</span><em>s</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.parse_from_arg" title="Permalink to this definition">¶</a></dt>
<dd><p>return the  object corresponding to the string passed default function will just return the unmodified string</p>
</dd></dl>

</div></blockquote>
</dd></dl>

</div>
<div class="section" id="nested-parameters">
<h5>3.5.9.2. Nested Parameters<a class="headerlink" href="#nested-parameters" title="Permalink to this headline">¶</a></h5>
<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">NestedParameter</span></code> class is a container for parameters.
The original motivating purpose for this feature is the multiple-codebase configuration, which needs to provide the user with a form to control the branch (et al) for each codebase independently.
Each branch parameter is a string field with name ‘branch’ and these must be disambiguated.</p>
<p>In Buildbot nine, this concept has been extended to allow grouping different parameters into UI containers.
Details of the available layouts is described in <a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">NestedParameter</span></a>.</p>
<p>Each of the child parameters mixes in the parent’s name to create the fully qualified <code class="docutils literal notranslate"><span class="pre">fullName</span></code>.
This allows, for example, each of the ‘branch’ fields to have a unique name in the POST request.
The <cite>NestedParameter</cite> handles adding this extra bit to the name to each of the children.
When the <cite>kwarg</cite> dictionary is posted back, this class also converts the flat POST dictionary into a richer structure that represents the nested structure.</p>
<p>As illustration, if the nested parameter has the name ‘foo’, and has children ‘bar1’ and ‘bar2’, then the POST will have entries like “foo.bar1” and “foo.bar2”.
The nested parameter will translate this into a dictionary in the ‘kwargs’ structure, resulting in something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;bar1&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bar2&#39;</span><span class="p">:</span> <span class="s1">&#39;...&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Arbitrary nesting is allowed and results in a deeper dictionary structure.</p>
<p>Nesting can also be used for presentation purposes.
If the name of the <code class="xref py py-class docutils literal notranslate"><span class="pre">NestedParameter</span></code> is empty, the nest is “anonymous” and does not mangle the child names.
However, in the HTML layout, the nest will be presented as a logical group.</p>
</div>
</div>
<span id="document-developer/cls-irenderable"></span><div class="section" id="irenderable">
<span id="index-0"></span><h4>3.5.10. IRenderable<a class="headerlink" href="#irenderable" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt>
<code class="descname">buildbot.interfaces.IRenderable::</code></dt>
<dd><p>Providers of this class can be “rendered”, based on available properties, when a build is started.</p>
<dl class="method">
<dt id="getRenderingFor">
<code class="descname">getRenderingFor</code><span class="sig-paren">(</span><em>iprops</em><span class="sig-paren">)</span><a class="headerlink" href="#getRenderingFor" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>iprops</strong> – the <code class="xref py py-class docutils literal notranslate"><span class="pre">IProperties</span></code> provider supplying the properties of the build.</td>
</tr>
</tbody>
</table>
<p>Returns the interpretation of the given properties, optionally in a Deferred.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-iproperties"></span><div class="section" id="iproperties">
<span id="index-0"></span><h4>3.5.11. IProperties<a class="headerlink" href="#iproperties" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt>
<code class="descname">buildbot.interfaces.IProperties::</code></dt>
<dd><p>Providers of this interface allow get and set access to a build’s properties.</p>
<dl class="method">
<dt id="getProperty">
<code class="descname">getProperty</code><span class="sig-paren">(</span><em>propname</em>, <em>default=None</em><span class="sig-paren">)</span><a class="headerlink" href="#getProperty" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a named property, returning the default value if the property is not found.</p>
</dd></dl>

<dl class="method">
<dt id="hasProperty">
<code class="descname">hasProperty</code><span class="sig-paren">(</span><em>propname</em><span class="sig-paren">)</span><a class="headerlink" href="#hasProperty" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine whether the named property exists.</p>
</dd></dl>

<dl class="method">
<dt id="setProperty">
<code class="descname">setProperty</code><span class="sig-paren">(</span><em>propname</em>, <em>value</em>, <em>source</em><span class="sig-paren">)</span><a class="headerlink" href="#setProperty" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a property’s value, also specifying the source for this value.</p>
</dd></dl>

<dl class="method">
<dt id="getProperties">
<code class="descname">getProperties</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#getProperties" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.properties.Properties</span></code> instance.
The interface of this class is not finalized; where possible, use the other <code class="docutils literal notranslate"><span class="pre">IProperties</span></code> methods.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-iconfigurator"></span><div class="section" id="iconfigurator">
<span id="index-0"></span><h4>3.5.12. <code class="docutils literal notranslate"><span class="pre">IConfigurator</span></code><a class="headerlink" href="#iconfigurator" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt>
<code class="descname">buildbot.interfaces.IConfigurator::</code></dt>
<dd><p>A configurator is an object which configures several components of Buildbot in a coherent manner.
This can be used to implement higher level configuration tools.</p>
<dl class="method">
<dt id="configure">
<code class="descname">configure</code><span class="sig-paren">(</span><em>config_dict</em><span class="sig-paren">)</span><a class="headerlink" href="#configure" title="Permalink to this definition">¶</a></dt>
<dd><p>Alter the buildbot <code class="docutils literal notranslate"><span class="pre">config_dict</span></code>, as defined in master.cfg</p>
<p>like the master.cfg, this is run out of the main reactor thread, so this can block, but this can’t
call most Buildbot facilities.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-resultspec"></span><div class="section" id="module-buildbot.data.resultspec">
<span id="resultspecs"></span><h4>3.5.13. ResultSpecs<a class="headerlink" href="#module-buildbot.data.resultspec" title="Permalink to this headline">¶</a></h4>
<p>Result specifications are used by the <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a> to describe the desired results of a <code class="xref py py-meth docutils literal notranslate"><span class="pre">get</span></code> call.
They can be used to filter, sort and paginate the contents of collections, and to limit the fields returned for each item.</p>
<p>Python calls to <code class="xref py py-meth docutils literal notranslate"><span class="pre">get</span></code> call can pass a <a class="reference internal" href="#buildbot.data.resultspec.ResultSpec" title="buildbot.data.resultspec.ResultSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultSpec</span></code></a> instance directly.
Requests to the HTTP REST API are converted into instances automatically.</p>
<p>Implementers of Data API endpoints can ignore result specifications entirely, except where efficiency suffers.
Any filters, sort keys, and so on still present after the endpoint returns its result are applied generically.
<a class="reference internal" href="#buildbot.data.resultspec.ResultSpec" title="buildbot.data.resultspec.ResultSpec"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultSpec</span></code></a> instances are mutable, so endpoints that do apply some of the specification can remove parts of the specification.</p>
<p>Result specifications are applied in the following order:</p>
<blockquote>
<div><ul class="simple">
<li>Field Selection (fields)</li>
<li>Filters</li>
<li>Order</li>
<li>Pagination (limit/offset)</li>
<li>Properties</li>
</ul>
</div></blockquote>
<p>Only fields &amp; properties are applied to non-collection results.
Endpoints processing a result specification should take care to replicate this behavior.</p>
<dl class="class">
<dt id="buildbot.data.resultspec.ResultSpec">
<em class="property">class </em><code class="descclassname">buildbot.data.resultspec.</code><code class="descname">ResultSpec</code><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec" title="Permalink to this definition">¶</a></dt>
<dd><p>A result specification has the following attributes, which should be treated as read-only:</p>
<dl class="attribute">
<dt id="buildbot.data.resultspec.ResultSpec.filters">
<code class="descname">filters</code><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.filters" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of <a class="reference internal" href="#buildbot.data.resultspec.Filter" title="buildbot.data.resultspec.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> instances to be applied.
The result is a logical AND of all filters.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.resultspec.ResultSpec.fields">
<code class="descname">fields</code><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.fields" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of field names that should be included, or <code class="docutils literal notranslate"><span class="pre">None</span></code> for no sorting.
if the field names all begin with <code class="docutils literal notranslate"><span class="pre">-</span></code>, then those fields will be omitted and all others included.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.resultspec.ResultSpec.order">
<code class="descname">order</code><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.order" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of field names to sort on.
if any field name begins with <code class="docutils literal notranslate"><span class="pre">-</span></code>, then the ordering on that field will be in reverse.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.resultspec.ResultSpec.limit">
<code class="descname">limit</code><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.limit" title="Permalink to this definition">¶</a></dt>
<dd><p>The maximum number of collection items to return.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.resultspec.ResultSpec.offset">
<code class="descname">offset</code><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.offset" title="Permalink to this definition">¶</a></dt>
<dd><p>The 0-based index of the first collection item to return.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.data.resultspec.ResultSpec.properties">
<code class="descname">properties</code><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.properties" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div>A list of <a class="reference internal" href="#buildbot.data.resultspec.Property" title="buildbot.data.resultspec.Property"><code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code></a> instances to be applied.
The result is a logical AND of all properties.</div></blockquote>
<p>All of the attributes can be supplied as constructor keyword arguments.</p>
<p>Endpoint implementations may call these methods to indicate that they have processed part of the result spec.
A subsequent call to <a class="reference internal" href="#buildbot.data.resultspec.ResultSpec.apply" title="buildbot.data.resultspec.ResultSpec.apply"><code class="xref py py-meth docutils literal notranslate"><span class="pre">apply</span></code></a> will then not waste time re-applying that part.</p>
<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.popProperties">
<code class="descname">popProperties</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.popProperties" title="Permalink to this definition">¶</a></dt>
<dd><p>If a property exists, return its values list and remove it from the result spec.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.popFilter">
<code class="descname">popFilter</code><span class="sig-paren">(</span><em>field</em>, <em>op</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.popFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>If a filter exists for the given field and operator, return its values list and remove it from the result spec.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.popBooleanFilter">
<code class="descname">popBooleanFilter</code><span class="sig-paren">(</span><em>field</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.popBooleanFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>If a filter exists for the field, remove it and return the expected value (True or False); otherwise return None.
This method correctly handles odd cases like <code class="docutils literal notranslate"><span class="pre">field__ne=false</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.popStringFilter">
<code class="descname">popStringFilter</code><span class="sig-paren">(</span><em>field</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.popStringFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>If one string filter exists for the field, remove it and return the expected value (as string); otherwise return None.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.popIntegerFilter">
<code class="descname">popIntegerFilter</code><span class="sig-paren">(</span><em>field</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.popIntegerFilter" title="Permalink to this definition">¶</a></dt>
<dd><p>If one integer filter exists for the field, remove it and return the expected value (as integer); otherwise return None.
raises ValueError if the field is not convertible to integer.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.removePagination">
<code class="descname">removePagination</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.removePagination" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove the pagination attributes (<a class="reference internal" href="#buildbot.data.resultspec.ResultSpec.limit" title="buildbot.data.resultspec.ResultSpec.limit"><code class="xref py py-attr docutils literal notranslate"><span class="pre">limit</span></code></a> and <a class="reference internal" href="#buildbot.data.resultspec.ResultSpec.offset" title="buildbot.data.resultspec.ResultSpec.offset"><code class="xref py py-attr docutils literal notranslate"><span class="pre">offset</span></code></a>) from the result spec.
And endpoint that calls this method should return a <code class="xref py py-class docutils literal notranslate"><span class="pre">ListResult</span></code> instance with its pagination attributes set appropriately.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.removeOrder">
<code class="descname">removeOrder</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.removeOrder" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove the order attribute.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.popField">
<code class="descname">popField</code><span class="sig-paren">(</span><em>field</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.popField" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a single field from the <a class="reference internal" href="#buildbot.data.resultspec.ResultSpec.fields" title="buildbot.data.resultspec.ResultSpec.fields"><code class="xref py py-attr docutils literal notranslate"><span class="pre">fields</span></code></a> attribute, returning True if it was present.
Endpoints can use this in conditionals to avoid fetching particularly expensive fields from the DB API.</p>
</dd></dl>

<p>The following method is used internally to apply any remaining parts of a result spec that are not handled by the endpoint.</p>
<dl class="method">
<dt id="buildbot.data.resultspec.ResultSpec.apply">
<code class="descname">apply</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.ResultSpec.apply" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the result specification to the data, returning a transformed copy of the data.
If the data is a collection, then the result will be a <code class="xref py py-class docutils literal notranslate"><span class="pre">ListResult</span></code> instance.</p>
</dd></dl>

</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.data.resultspec.Filter">
<em class="property">class </em><code class="descclassname">buildbot.data.resultspec.</code><code class="descname">Filter</code><span class="sig-paren">(</span><em>field</em>, <em>op</em>, <em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.Filter" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>field</strong> (<em>string</em>) – the field to filter on</li>
<li><strong>op</strong> (<em>string</em>) – the comparison operator (e.g., “eq” or “gt”)</li>
<li><strong>values</strong> (<em>list</em>) – the values on the right side of the operator</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>A filter represents a limitation of the items from a collection that should be returned.</p>
<p>Many operators, such as “gt”, only accept one value.
Others, such as “eq” or “ne”, can accept multiple values.
In either case, the values must be passed as a list.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.data.resultspec.Property">
<em class="property">class </em><code class="descclassname">buildbot.data.resultspec.</code><code class="descname">Property</code><span class="sig-paren">(</span><em>values</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.data.resultspec.Property" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>values</strong> (<em>list</em>) – the values on the right side of the operator (<code class="docutils literal notranslate"><span class="pre">eq</span></code>)</td>
</tr>
</tbody>
</table>
<p>A property represents an item of a foreign table.</p>
<p>In either case, the values must be passed as a list.</p>
</dd></dl>

</div>
<span id="document-developer/cls-protocols"></span><div class="section" id="protocols">
<h4>3.5.14. Protocols<a class="headerlink" href="#protocols" title="Permalink to this headline">¶</a></h4>
<p>To exchange information over the network between master and worker we need to use
protocol.</p>
<p><a class="reference internal" href="#module-buildbot.worker.protocols.base" title="buildbot.worker.protocols.base"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker.protocols.base</span></code></a> provide interfaces to implement
wrappers around protocol specific calls, so other classes which use them do not need
to know about protocol calls or handle protocol specific exceptions.</p>
<span class="target" id="module-buildbot.worker.protocols.base"></span><dl class="class">
<dt id="buildbot.worker.protocols.base.Listener">
<em class="property">class </em><code class="descclassname">buildbot.worker.protocols.base.</code><code class="descname">Listener</code><span class="sig-paren">(</span><em>master</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Listener" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>master</strong> – <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.master.BuildMaster</span></code> instance</td>
</tr>
</tbody>
</table>
<p>Responsible for spawning Connection instances and updating registrations.
Protocol-specific subclasses are instantiated with protocol-specific
parameters by the buildmaster during startup.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.worker.protocols.base.Connection">
<em class="property">class </em><code class="descclassname">buildbot.worker.protocols.base.</code><code class="descname">Connection</code><span class="sig-paren">(</span><em>master</em>, <em>worker</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents connection to single worker</p>
<dl class="attribute">
<dt id="buildbot.worker.protocols.base.Connection.proxies">
<code class="descname">proxies</code><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.proxies" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary containing mapping between <code class="docutils literal notranslate"><span class="pre">Impl</span></code> classes and <code class="docutils literal notranslate"><span class="pre">Proxy</span></code> class for this protocol
This may be overridden by subclass to declare its proxy implementations</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.createArgsProxies">
<code class="descname">createArgsProxies</code><span class="sig-paren">(</span><em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.createArgsProxies" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">shallow copy of args dictionary with proxies instead of impls</td>
</tr>
</tbody>
</table>
<p>Helper method that will use <a class="reference internal" href="#buildbot.worker.protocols.base.Connection.proxies" title="buildbot.worker.protocols.base.Connection.proxies"><code class="xref py py-attr docutils literal notranslate"><span class="pre">proxies</span></code></a>, and replace <code class="docutils literal notranslate"><span class="pre">Impl</span></code> objects by specific <code class="docutils literal notranslate"><span class="pre">Proxy</span></code> counterpart.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.notifyOnDisconnect">
<code class="descname">notifyOnDisconnect</code><span class="sig-paren">(</span><em>cb</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.notifyOnDisconnect" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>cb</strong> – callback</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.subscriptions.Subscription</span></code></td>
</tr>
</tbody>
</table>
<p>Register a callback to be called if worker gets disconnected</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.loseConnection">
<code class="descname">loseConnection</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.loseConnection" title="Permalink to this definition">¶</a></dt>
<dd><p>Close connection</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.remotePrint">
<code class="descname">remotePrint</code><span class="sig-paren">(</span><em>message</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.remotePrint" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>message</strong> (<em>string</em>) – message for worker</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Print message to worker log file</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.remoteGetWorkerInfo">
<code class="descname">remoteGetWorkerInfo</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.remoteGetWorkerInfo" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Get worker information, commands and version, put them in dictionary
then return back</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.remoteSetBuilderList">
<code class="descname">remoteSetBuilderList</code><span class="sig-paren">(</span><em>builders</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.remoteSetBuilderList" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>builders</strong> (<a class="reference internal" href="#buildbot.data.types.List" title="buildbot.data.types.List"><em>List</em></a>) – list with wanted builders</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred containing PB references XXX</td>
</tr>
</tbody>
</table>
<p>Take list with wanted builders and send them to worker, return list with
created builders</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.remoteStartCommand">
<code class="descname">remoteStartCommand</code><span class="sig-paren">(</span><em>remoteCommand</em>, <em>builderName</em>, <em>commandId</em>, <em>commandName</em>, <em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.remoteStartCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>remoteCommand</strong> – <a class="reference internal" href="#buildbot.worker.protocols.base.RemoteCommandImpl" title="buildbot.worker.protocols.base.RemoteCommandImpl"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteCommandImpl</span></code></a> instance</li>
<li><strong>builderName</strong> (<em>string</em>) – self explanatory</li>
<li><strong>commandId</strong> (<em>string</em>) – command number</li>
<li><strong>commandName</strong> (<em>string</em>) – command which will be executed on worker</li>
<li><strong>args</strong> (<a class="reference internal" href="#buildbot.data.types.List" title="buildbot.data.types.List"><em>List</em></a>) – arguments for that command</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Start command on worker</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.remoteShutdown">
<code class="descname">remoteShutdown</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.remoteShutdown" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Shutdown the worker, causing its process to halt permanently.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.remoteStartBuild">
<code class="descname">remoteStartBuild</code><span class="sig-paren">(</span><em>builderName</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.remoteStartBuild" title="Permalink to this definition">¶</a></dt>
<dd><p>:param builderName name of the builder for which the build is starting
:returns: Deferred</p>
<p>Just starts build</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.Connection.remoteInterruptCommand">
<code class="descname">remoteInterruptCommand</code><span class="sig-paren">(</span><em>builderName</em>, <em>commandId</em>, <em>why</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.Connection.remoteInterruptCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>builderName</strong> (<em>string</em>) – self explanatory</li>
<li><strong>commandId</strong> (<em>string</em>) – command number</li>
<li><strong>why</strong> (<em>string</em>) – reason to interrupt</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Interrupt the command executed on builderName with given commandId on worker, print reason “why” to
worker logs</p>
</dd></dl>

</dd></dl>

<p>Following classes are describing the worker -&gt; master part of the protocol.</p>
<p>In order to support old workers, we must make sure we do not change the current pb protocol.
This is why we implement a <code class="docutils literal notranslate"><span class="pre">Impl</span> <span class="pre">vs</span> <span class="pre">Proxy</span></code> methods.
All the objects that are referenced from the workers for remote calls have an <code class="docutils literal notranslate"><span class="pre">Impl</span></code> and a <code class="docutils literal notranslate"><span class="pre">Proxy</span></code> base classes in this module.</p>
<p><code class="docutils literal notranslate"><span class="pre">Impl</span></code> classes are subclassed by buildbot master, and implement the actual logic for the protocol api.
<code class="docutils literal notranslate"><span class="pre">Proxy</span></code> classes are implemented by the worker/master protocols, and implements the demux and de-serialization of protocol calls.</p>
<p>On worker sides, those proxy objects are replaced by a proxy object having a single method to call master side methods:</p>
<dl class="class">
<dt id="buildbot.worker.protocols.base.workerProxyObject">
<em class="property">class </em><code class="descclassname">buildbot.worker.protocols.base.</code><code class="descname">workerProxyObject</code><a class="headerlink" href="#buildbot.worker.protocols.base.workerProxyObject" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.worker.protocols.base.workerProxyObject.callRemote">
<code class="descname">callRemote</code><span class="sig-paren">(</span><em>message</em>, <em>*args</em>, <em>**kw</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.workerProxyObject.callRemote" title="Permalink to this definition">¶</a></dt>
<dd><p>calls the method <code class="docutils literal notranslate"><span class="pre">&quot;remote_&quot;</span> <span class="pre">+</span> <span class="pre">message</span></code> on master side</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.worker.protocols.base.RemoteCommandImpl">
<em class="property">class </em><code class="descclassname">buildbot.worker.protocols.base.</code><code class="descname">RemoteCommandImpl</code><a class="headerlink" href="#buildbot.worker.protocols.base.RemoteCommandImpl" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents a RemoteCommand status controller</p>
<dl class="method">
<dt id="buildbot.worker.protocols.base.RemoteCommandImpl.remote_update">
<code class="descname">remote_update</code><span class="sig-paren">(</span><em>updates</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.RemoteCommandImpl.remote_update" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>updates</strong> – dictionary of updates</td>
</tr>
</tbody>
</table>
<p>Called when the workers has updates to the current remote command</p>
<p>possible keys for updates are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">stdout</span></code>: Some logs where captured in remote command’s stdout. value: <code class="docutils literal notranslate"><span class="pre">&lt;data&gt;</span> <span class="pre">as</span> <span class="pre">string</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">stderr</span></code>: Some logs where captured in remote command’s stderr. value: <code class="docutils literal notranslate"><span class="pre">&lt;data&gt;</span> <span class="pre">as</span> <span class="pre">string</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">header</span></code>: remote command’s header text. value: <code class="docutils literal notranslate"><span class="pre">&lt;data&gt;</span> <span class="pre">as</span>&#160; <span class="pre">string</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">log</span></code>: one of the watched logs has received some text. value: <code class="docutils literal notranslate"><span class="pre">(&lt;logname&gt;</span> <span class="pre">as</span> <span class="pre">string,</span> <span class="pre">&lt;data&gt;</span> <span class="pre">as</span> <span class="pre">string)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">rc</span></code>: Remote command exited with a return code. value: <code class="docutils literal notranslate"><span class="pre">&lt;rc&gt;</span> <span class="pre">as</span> <span class="pre">integer</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">elapsed</span></code>: Remote command has taken &lt;elapsed&gt; time. value: <code class="docutils literal notranslate"><span class="pre">&lt;elapsed</span> <span class="pre">seconds&gt;</span> <span class="pre">as</span> <span class="pre">float</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">stat</span></code>: sent by the <code class="docutils literal notranslate"><span class="pre">stat</span></code> command with the result of the os.stat, converted to a tuple. value: <code class="docutils literal notranslate"><span class="pre">&lt;stat&gt;</span> <span class="pre">as</span> <span class="pre">tuple</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">files</span></code>: sent by the <code class="docutils literal notranslate"><span class="pre">glob</span></code> command with the result of the glob.glob. value: <code class="docutils literal notranslate"><span class="pre">&lt;files&gt;</span> <span class="pre">as</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">string</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">got_revision</span></code>: sent by the source commands with the revision checked out. value: <code class="docutils literal notranslate"><span class="pre">&lt;revision&gt;</span> <span class="pre">as</span> <span class="pre">string</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">repo_downloaded</span></code>: sent by the <code class="docutils literal notranslate"><span class="pre">repo</span></code> command with the list of patches downloaded by repo. value: <code class="docutils literal notranslate"><span class="pre">&lt;downloads&gt;</span> <span class="pre">as</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">string</span></code></li>
</ul>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.worker.protocols.base.FileWriterImpl">
<em class="property">class </em><code class="descclassname">buildbot.worker.protocols.base.</code><code class="descname">FileWriterImpl</code><a class="headerlink" href="#buildbot.worker.protocols.base.FileWriterImpl" title="Permalink to this definition">¶</a></dt>
<dd><p>Class used to implement data transfer between worker and master</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.worker.protocols.base.FileReaderImpl">
<em class="property">class </em><code class="descclassname">buildbot.worker.protocols.base.</code><code class="descname">FileReaderImpl</code><span class="sig-paren">(</span><em>object</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.FileReaderImpl" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.worker.protocols.base.FileReaderImpl.remote_read">
<code class="descname">remote_read</code><span class="sig-paren">(</span><em>maxLength</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.FileReaderImpl.remote_read" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>maxLength</strong> – maximum length of the data to send</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">data read</td>
</tr>
</tbody>
</table>
<p>called when worker needs more data</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.protocols.base.FileReaderImpl.remote_close">
<code class="descname">remote_close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.protocols.base.FileReaderImpl.remote_close" title="Permalink to this definition">¶</a></dt>
<dd><p>Called when master should close the file</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-workermanager"></span><div class="section" id="module-buildbot.worker.manager">
<span id="workermanager"></span><h4>3.5.15. WorkerManager<a class="headerlink" href="#module-buildbot.worker.manager" title="Permalink to this headline">¶</a></h4>
<div class="section" id="workerregistration">
<h5>3.5.15.1. WorkerRegistration<a class="headerlink" href="#workerregistration" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.worker.manager.WorkerRegistration">
<em class="property">class </em><code class="descclassname">buildbot.worker.manager.</code><code class="descname">WorkerRegistration</code><span class="sig-paren">(</span><em>master</em>, <em>worker</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.manager.WorkerRegistration" title="Permalink to this definition">¶</a></dt>
<dd><p>Represents single Worker registration</p>
<dl class="method">
<dt id="buildbot.worker.manager.WorkerRegistration.unregister">
<code class="descname">unregister</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.manager.WorkerRegistration.unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove registration for <cite>worker</cite></p>
</dd></dl>

<dl class="method">
<dt id="buildbot.worker.manager.WorkerRegistration.update">
<code class="descname">update</code><span class="sig-paren">(</span><em>worker_config</em>, <em>global_config</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.manager.WorkerRegistration.update" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>worker_config</strong> (<a class="reference internal" href="#buildbot.worker.Worker" title="buildbot.worker.Worker"><code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code></a>) – new Worker instance</li>
<li><strong>global_config</strong> (<a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MasterConfig</span></code></a>) – Buildbot config</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Update the registration in case the port or password has changed.</p>
<p>NOTE: You should invoke this method after calling
<cite>WorkerManager.register(worker)</cite></p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id1">
<h5>3.5.15.2. WorkerManager<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.worker.manager.WorkerManager">
<em class="property">class </em><code class="descclassname">buildbot.worker.manager.</code><code class="descname">WorkerManager</code><span class="sig-paren">(</span><em>master</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.manager.WorkerManager" title="Permalink to this definition">¶</a></dt>
<dd><p>Handle Worker registrations for multiple protocols</p>
<dl class="method">
<dt id="buildbot.worker.manager.WorkerManager.register">
<code class="descname">register</code><span class="sig-paren">(</span><em>worker</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.worker.manager.WorkerManager.register" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>worker</strong> (<a class="reference internal" href="#buildbot.worker.Worker" title="buildbot.worker.Worker"><code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code></a>) – new Worker instance</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><a class="reference internal" href="#buildbot.worker.manager.WorkerRegistration" title="buildbot.worker.manager.WorkerRegistration"><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerRegistration</span></code></a></td>
</tr>
</tbody>
</table>
<p>Creates <a class="reference internal" href="#buildbot.worker.manager.WorkerRegistration" title="buildbot.worker.manager.WorkerRegistration"><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerRegistration</span></code></a>
instance.</p>
<p>NOTE: You should invoke <cite>.update()</cite> on returned WorkerRegistration
instance</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-developer/cls-log"></span><div class="section" id="module-buildbot.process.log">
<span id="logs"></span><h4>3.5.16. Logs<a class="headerlink" href="#module-buildbot.process.log" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="buildbot.process.log.Log">
<em class="property">class </em><code class="descclassname">buildbot.process.log.</code><code class="descname">Log</code><a class="headerlink" href="#buildbot.process.log.Log" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles write-only access to log files from running build steps.
It does not provide an interface for reading logs - such access should occur directly through the Data API.</p>
<p>Instances of this class can only be created by the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addLog" title="buildbot.process.buildstep.BuildStep.addLog"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addLog</span></code></a> method of a build step.</p>
<dl class="attribute">
<dt id="buildbot.process.log.Log.name">
<code class="descname">name</code><a class="headerlink" href="#buildbot.process.log.Log.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the log.</p>
<p>Note that if you have a build step which outputs multiple logs, naming one of the logs <code class="docutils literal notranslate"><span class="pre">Summary</span></code> will cause  the Web UI to sort the summary log first in the list, and expand it so that the contents are immediately visible.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.log.Log.type">
<code class="descname">type</code><a class="headerlink" href="#buildbot.process.log.Log.type" title="Permalink to this definition">¶</a></dt>
<dd><p>The type of the log, represented as a single character.
See <a class="reference internal" href="#rtype-logchunk" title="logchunk"><code class="xref bb bb-rtype docutils literal notranslate"><span class="pre">logchunk</span></code></a> for details.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.log.Log.logid">
<code class="descname">logid</code><a class="headerlink" href="#buildbot.process.log.Log.logid" title="Permalink to this definition">¶</a></dt>
<dd><p>The ID of the logfile.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.log.Log.decoder">
<code class="descname">decoder</code><a class="headerlink" href="#buildbot.process.log.Log.decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable used to decode bytestrings.
See <a class="reference internal" href="#cfg-logEncoding" title="logEncoding"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logEncoding</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.log.Log.subscribe">
<code class="descname">subscribe</code><span class="sig-paren">(</span><em>receiver</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.log.Log.subscribe" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>receiver</strong> (<em>callable</em>) – the function to call</td>
</tr>
</tbody>
</table>
<p>Register <code class="docutils literal notranslate"><span class="pre">receiver</span></code> to be called with line-delimited chunks of log data.
The callable is invoked as <code class="docutils literal notranslate"><span class="pre">receiver(stream,</span> <span class="pre">chunk)</span></code>, where the stream is indicated by a single character, or None for logs without streams.
The chunk is a single string containing an arbitrary number of log lines, and terminated with a newline.
When the logfile is finished, <code class="docutils literal notranslate"><span class="pre">receiver</span></code> will be invoked with <code class="docutils literal notranslate"><span class="pre">None</span></code> for both arguments.</p>
<p>The callable cannot return a Deferred.
If it must perform some asynchronous operation, it will need to handle its own Deferreds, and be aware that multiple overlapping calls may occur.</p>
<p>Note that no “rewinding” takes place: only log content added after the call to <code class="docutils literal notranslate"><span class="pre">subscribe</span></code> will be supplied to <code class="docutils literal notranslate"><span class="pre">receiver</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.log.Log.finish">
<code class="descname">finish</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.log.Log.finish" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method indicates that the logfile is finished.
No further additions will be permitted.</p>
</dd></dl>

</dd></dl>

<p>In use, callers will receive a subclass with methods appropriate for the log type:</p>
<dl class="class">
<dt id="buildbot.process.log.TextLog">
<em class="property">class </em><code class="descclassname">buildbot.process.log.</code><code class="descname">TextLog</code><a class="headerlink" href="#buildbot.process.log.TextLog" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt>
<code class="descname">addContent(text):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>text</strong> – log content</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Add the given data to the log.
The data need not end on a newline boundary.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.process.log.HTMLLog">
<em class="property">class </em><code class="descclassname">buildbot.process.log.</code><code class="descname">HTMLLog</code><a class="headerlink" href="#buildbot.process.log.HTMLLog" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt>
<code class="descname">addContent(text):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>text</strong> – log content</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Same as <code class="xref py py-meth docutils literal notranslate"><span class="pre">TextLog.addContent</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.process.log.StreamLog">
<em class="property">class </em><code class="descclassname">buildbot.process.log.</code><code class="descname">StreamLog</code><a class="headerlink" href="#buildbot.process.log.StreamLog" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles logs containing three interleaved streams: stdout, stderr, and header.
The resulting log maintains data distinguishing these streams, so they can be filtered or displayed in different colors.
This class is used to represent the stdio log in most steps.</p>
<dl class="method">
<dt id="buildbot.process.log.StreamLog.addStdout">
<code class="descname">addStdout</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.log.StreamLog.addStdout" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>text</strong> – log content</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Add content to the stdout stream.
The data need not end on a newline boundary.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.log.StreamLog.addStderr">
<code class="descname">addStderr</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.log.StreamLog.addStderr" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>text</strong> – log content</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Add content to the stderr stream.
The data need not end on a newline boundary.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.log.StreamLog.addHeader">
<code class="descname">addHeader</code><span class="sig-paren">(</span><em>text</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.log.StreamLog.addHeader" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>text</strong> – log content</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Add content to the header stream.
The data need not end on a newline boundary.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-logobserver"></span><div class="section" id="module-buildbot.process.logobserver">
<span id="logobservers"></span><h4>3.5.17. LogObservers<a class="headerlink" href="#module-buildbot.process.logobserver" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="buildbot.process.logobserver.LogObserver">
<em class="property">class </em><code class="descclassname">buildbot.process.logobserver.</code><code class="descname">LogObserver</code><a class="headerlink" href="#buildbot.process.logobserver.LogObserver" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a base class for objects which receive logs from worker commands as they are produced.
It does not provide an interface for reading logs - such access should occur directly through the Data API.</p>
<p>See <a class="reference internal" href="#adding-logobservers"><span class="std std-ref">Adding LogObservers</span></a> for help creating and using a custom log observer.</p>
<p>The three methods that subclasses may override follow.
None of these methods may return a Deferred.
It is up to the callee to handle any asynchronous operations.
Subclasses may also override the constructor, with no need to call <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a>’s constructor.</p>
<dl class="method">
<dt>
<code class="descname">outReceived(data):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<em>unicode</em>) – received data</td>
</tr>
</tbody>
</table>
<p>This method is invoked when a “chunk” of data arrives in the log.
The chunk contains one or more newline-terminated unicode lines.
For stream logs (e.g., <code class="docutils literal notranslate"><span class="pre">stdio</span></code>), output to stderr generates a call to <code class="xref py py-meth docutils literal notranslate"><span class="pre">errReceived</span></code>, instead.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">errReceived(data):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<em>unicode</em>) – received data</td>
</tr>
</tbody>
</table>
<p>This method is similar to <code class="xref py py-meth docutils literal notranslate"><span class="pre">outReceived</span></code>, but is called for output to stderr.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">headerReceived(data):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<em>unicode</em>) – received data</td>
</tr>
</tbody>
</table>
<p>This method is similar to <code class="xref py py-meth docutils literal notranslate"><span class="pre">outReceived</span></code>, but is called for header output.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.logobserver.LogObserver.finishReceived">
<code class="descname">finishReceived</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.logobserver.LogObserver.finishReceived" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is invoked when the observed log is finished.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.process.logobserver.LogLineObserver">
<em class="property">class </em><code class="descclassname">buildbot.process.logobserver.</code><code class="descname">LogLineObserver</code><a class="headerlink" href="#buildbot.process.logobserver.LogLineObserver" title="Permalink to this definition">¶</a></dt>
<dd><p>This subclass of <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> calls its subclass methods once for each line, instead of once per chunk.</p>
<dl class="method">
<dt>
<code class="descname">outLineReceived(line):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>line</strong> (<em>unicode</em>) – received line, without newline</td>
</tr>
</tbody>
</table>
<p>Like <code class="xref py py-meth docutils literal notranslate"><span class="pre">outReceived</span></code>, this is called once for each line of output received.
The argument does not contain the trailing newline character.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">errLineReceived(line):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>line</strong> (<em>unicode</em>) – received line, without newline</td>
</tr>
</tbody>
</table>
<p>Similar to <code class="xref py py-meth docutils literal notranslate"><span class="pre">outLineReceived</span></code>, but for stderr.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">headerLineReceived(line):</code></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>line</strong> (<em>unicode</em>) – received line, without newline</td>
</tr>
</tbody>
</table>
<p>Similar to <code class="xref py py-meth docutils literal notranslate"><span class="pre">outLineReceived</span></code>, but for header output..</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.logobserver.LogLineObserver.finishReceived">
<code class="descname">finishReceived</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.logobserver.LogLineObserver.finishReceived" title="Permalink to this definition">¶</a></dt>
<dd><p>This method, inherited from <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a>, is invoked when the observed log is finished.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.process.logobserver.LineConsumerLogObserver">
<em class="property">class </em><code class="descclassname">buildbot.process.logobserver.</code><code class="descname">LineConsumerLogObserver</code><a class="headerlink" href="#buildbot.process.logobserver.LineConsumerLogObserver" title="Permalink to this definition">¶</a></dt>
<dd><p>This subclass of <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> takes a generator function and “sends” each line to that function.
This allows consumers to be written as stateful Python functions, e.g.,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">logConsumer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">stream</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="k">yield</span>
        <span class="k">if</span> <span class="n">stream</span> <span class="o">==</span> <span class="s1">&#39;o&#39;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addLogObserver</span><span class="p">(</span><span class="s1">&#39;stdio&#39;</span><span class="p">,</span> <span class="n">logobserver</span><span class="o">.</span><span class="n">LineConsumerLogObserver</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logConsumer</span><span class="p">))</span>
</pre></div>
</div>
<p>Each <code class="docutils literal notranslate"><span class="pre">yield</span></code> expression evaluates to a tuple of (stream, line), where the stream is one of ‘o’, ‘e’, or ‘h’ for stdout, stderr, and header, respectively.
As with any generator function, the <code class="docutils literal notranslate"><span class="pre">yield</span></code> expression will raise a <code class="docutils literal notranslate"><span class="pre">GeneratorExit</span></code> exception when the generator is complete.
To do something after the log is finished, just catch this exception (but then re-raise it or return)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">logConsumer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stream</span><span class="p">,</span> <span class="n">line</span> <span class="o">=</span> <span class="k">yield</span>
            <span class="k">if</span> <span class="n">stream</span> <span class="o">==</span> <span class="s1">&#39;o&#39;</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">return</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This use of generator functions is a simple Python idiom first described in <a class="reference external" href="https://www.python.org/dev/peps/pep-0342/">PEP 342</a>.
It is unrelated to the generators used in <code class="docutils literal notranslate"><span class="pre">inlineCallbacks</span></code>.
In fact, consumers of this type are incompatible with asynchronous programming, as each line must be processed immediately.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.process.logobserver.BufferLogObserver">
<em class="property">class </em><code class="descclassname">buildbot.process.logobserver.</code><code class="descname">BufferLogObserver</code><span class="sig-paren">(</span><em>wantStdout=True</em>, <em>wantStderr=False</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.logobserver.BufferLogObserver" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>wantStdout</strong> (<em>boolean</em>) – true if stdout should be buffered</li>
<li><strong>wantStderr</strong> (<em>boolean</em>) – true if stderr should be buffered</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This subclass of <a class="reference internal" href="#buildbot.process.logobserver.LogObserver" title="buildbot.process.logobserver.LogObserver"><code class="xref py py-class docutils literal notranslate"><span class="pre">LogObserver</span></code></a> buffers stdout and/or stderr for analysis after the step is complete.
This can cause excessive memory consumption if the output is large.</p>
<dl class="method">
<dt id="buildbot.process.logobserver.BufferLogObserver.getStdout">
<code class="descname">getStdout</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.logobserver.BufferLogObserver.getStdout" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">unicode string</td>
</tr>
</tbody>
</table>
<p>Return the accumulated stdout.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.logobserver.BufferLogObserver.getStderr">
<code class="descname">getStderr</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.process.logobserver.BufferLogObserver.getStderr" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">unicode string</td>
</tr>
</tbody>
</table>
<p>Return the accumulated stderr.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-auth"></span><div class="section" id="module-buildbot.www.auth">
<span id="authentication"></span><h4>3.5.18. Authentication<a class="headerlink" href="#module-buildbot.www.auth" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="buildbot.www.auth.AuthBase">
<em class="property">class </em><code class="descclassname">buildbot.www.auth.</code><code class="descname">AuthBase</code><a class="headerlink" href="#buildbot.www.auth.AuthBase" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is the base class for all authentication methods.
All authentications are not done at the same level, so several optional methods are available.
This class implements default implementation.
The login session is stored via twisted’s <code class="docutils literal notranslate"><span class="pre">request.getSession()</span></code>, and detailed used information is stored in <code class="docutils literal notranslate"><span class="pre">request.getSession().user_info</span></code>.
The session information is then sent to the UI via the <code class="docutils literal notranslate"><span class="pre">config</span></code> constant (in the <code class="docutils literal notranslate"><span class="pre">user</span></code> attribute of <code class="docutils literal notranslate"><span class="pre">config</span></code>)</p>
<dl class="attribute">
<dt id="buildbot.www.auth.AuthBase.userInfoProvider">
<code class="descname">userInfoProvider</code><a class="headerlink" href="#buildbot.www.auth.AuthBase.userInfoProvider" title="Permalink to this definition">¶</a></dt>
<dd><p>Authentication modules are responsible for providing user information as detailed as possible.
When there is a need to get additional information from another source, a userInfoProvider can optionally be specified.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.www.auth.AuthBase.reconfigAuth">
<code class="descname">reconfigAuth</code><span class="sig-paren">(</span><em>master</em>, <em>new_config</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.AuthBase.reconfigAuth" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>master</strong> – the reference to the master</li>
<li><strong>new_config</strong> – the reference to the new configuration</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Reconfigure the authentication module.
In the base class, this simply sets <code class="docutils literal notranslate"><span class="pre">self.master</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.www.auth.AuthBase.maybeAutoLogin">
<code class="descname">maybeAutoLogin</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.AuthBase.maybeAutoLogin" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>request</strong> – the request object</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method is called when <code class="docutils literal notranslate"><span class="pre">/config.js</span></code> is fetched.
If the authentication method supports automatic login, e.g., from a header provided by a frontend proxy, this method handles the login.</p>
<p>If it succeeds, the method sets <code class="docutils literal notranslate"><span class="pre">request.getSession().user_info</span></code>.
If the login fails unexpectedly, it raises <code class="docutils literal notranslate"><span class="pre">resource.Error</span></code>.
The default implementation simply returns without setting <code class="docutils literal notranslate"><span class="pre">user_info</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.www.auth.AuthBase.getLoginResource">
<code class="descname">getLoginResource</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.AuthBase.getLoginResource" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the resource representing <code class="docutils literal notranslate"><span class="pre">/auth/login</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.www.auth.AuthBase.getLogout">
<code class="descname">getLogout</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.AuthBase.getLogout" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the resource representing <code class="docutils literal notranslate"><span class="pre">/auth/logout</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.www.auth.AuthBase.updateUserInfo">
<code class="descname">updateUserInfo</code><span class="sig-paren">(</span><em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.AuthBase.updateUserInfo" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>request</strong> – the request object</td>
</tr>
</tbody>
</table>
<p>Separate entrypoint for getting user information.
This is a mean to call self.userInfoProvider if provided.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="buildbot.www.auth.UserInfoProviderBase">
<em class="property">class </em><code class="descclassname">buildbot.www.auth.</code><code class="descname">UserInfoProviderBase</code><a class="headerlink" href="#buildbot.www.auth.UserInfoProviderBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Class that can be used, to get more info for the user like groups, in a separate database.</p>
<dl class="method">
<dt id="buildbot.www.auth.UserInfoProviderBase.getUserInfo">
<code class="descname">getUserInfo</code><span class="sig-paren">(</span><em>username</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.UserInfoProviderBase.getUserInfo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>returns the user infos, from the username used for login (via deferred)</p>
<p>returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code> with following keys:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">email</span></code>: email address of the user</li>
<li><code class="docutils literal notranslate"><span class="pre">full_name</span></code>: Full name of the user, like “Homer Simpson”</li>
<li><code class="docutils literal notranslate"><span class="pre">groups</span></code>: groups the user belongs to, like [“duff fans”, “dads”]</li>
</ul>
</div></blockquote>
</dd></dl>

<span class="target" id="module-buildbot.www.oauth2"></span><dl class="class">
<dt id="buildbot.www.oauth2.OAuth2Auth">
<em class="property">class </em><code class="descclassname">buildbot.www.oauth2.</code><code class="descname">OAuth2Auth</code><a class="headerlink" href="#buildbot.www.oauth2.OAuth2Auth" title="Permalink to this definition">¶</a></dt>
<dd><p>OAuth2Auth implements oauth2 2 phases authentication.
With this method <code class="docutils literal notranslate"><span class="pre">/auth/login</span></code> is called twice.
Once without argument.
It should return the URL the browser has to redirect in order to perform oauth2 authentication, and authorization.
Then the oauth2 provider will redirect to <code class="docutils literal notranslate"><span class="pre">/auth/login?code=???</span></code>, and buildbot web server will verify the code using the oauth2 provider.</p>
<p>Typical login process is:</p>
<ul class="simple">
<li>UI calls the <code class="docutils literal notranslate"><span class="pre">/auth/login</span></code> api, and redirect the browser to the returned oauth2 provider url</li>
<li>oauth2 provider shows a web page with a form for the user to authenticate, and ask the user the permission for buildbot to access its account.</li>
<li>oauth2 provider redirects the browser to <code class="docutils literal notranslate"><span class="pre">/auth/login?code=???</span></code></li>
<li>OAuth2Auth module verifies the code, and get the user’s additional information</li>
<li>buildbot UI is reloaded, with the user authenticated.</li>
</ul>
<p>This implementation is using <a class="reference external" href="http://docs.python-requests.org/en/latest/">requests</a>
subclasses must override following class attributes:
* <code class="docutils literal notranslate"><span class="pre">name</span></code> Name of the oauth plugin
* <code class="docutils literal notranslate"><span class="pre">faIcon</span></code> font awesome class to use for login button logo
* <code class="docutils literal notranslate"><span class="pre">resourceEndpoint</span></code> URI of the resource where the authentication token is used
* <code class="docutils literal notranslate"><span class="pre">authUri</span></code> URI the browser is pointed to to let the user enter creds
* <code class="docutils literal notranslate"><span class="pre">tokenUri</span></code> URI to verify the browser code and get auth token
* <code class="docutils literal notranslate"><span class="pre">authUriAdditionalParams</span></code> Additional parameters for the authUri
* <code class="docutils literal notranslate"><span class="pre">tokenUriAdditionalParams</span></code> Additional parameters for the tokenUri</p>
<dl class="method">
<dt id="buildbot.www.oauth2.OAuth2Auth.getUserInfoFromOAuthClient">
<code class="descname">getUserInfoFromOAuthClient</code><span class="sig-paren">(</span><em>self</em>, <em>c</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.OAuth2Auth.getUserInfoFromOAuthClient" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called after a successful authentication to get additional information about the user from the oauth2 provider.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-avatar"></span><div class="section" id="avatars">
<h4>3.5.19. Avatars<a class="headerlink" href="#avatars" title="Permalink to this headline">¶</a></h4>
<p>Buildbot’s avatar support associate a small image with each user.</p>
<span class="target" id="module-buildbot.www.avatar"></span><dl class="class">
<dt id="buildbot.www.avatar.AvatarBase">
<em class="property">class </em><code class="descclassname">buildbot.www.avatar.</code><code class="descname">AvatarBase</code><a class="headerlink" href="#buildbot.www.avatar.AvatarBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Class that can be used, to get more the avatars for the users.
This can be used for the authenticated users, but also for the users referenced by changes.</p>
<dl class="method">
<dt id="buildbot.www.avatar.AvatarBase.getUserAvatar">
<code class="descname">getUserAvatar</code><span class="sig-paren">(</span><em>self</em>, <em>email</em>, <em>size</em>, <em>defaultAvatarUrl</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.avatar.AvatarBase.getUserAvatar" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>returns the user’s avatar, from the user’s email (via deferred).
If the data is directly available, this function returns a tuple <code class="docutils literal notranslate"><span class="pre">(mime_type,</span> <span class="pre">picture_raw_data)</span></code>.
If the data is available in another URL, this function can raise <code class="docutils literal notranslate"><span class="pre">resource.Redirect(avatar_url)</span></code>, and the web server will redirect to the avatar_url.</p>
</dd></dl>

</div>
<span id="document-developer/cls-www"></span><div class="section" id="web-server-classes">
<h4>3.5.20. Web Server Classes<a class="headerlink" href="#web-server-classes" title="Permalink to this headline">¶</a></h4>
<p>Most of the source in <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/buildbot/www">master/buildbot/www</a> is self-explanatory.
However, a few classes and methods deserve some special mention.</p>
<div class="section" id="module-buildbot.www.resource">
<span id="resources"></span><h5>3.5.20.1. Resources<a class="headerlink" href="#module-buildbot.www.resource" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.www.resource.Redirect">
<em class="property">class </em><code class="descclassname">buildbot.www.resource.</code><code class="descname">Redirect</code><span class="sig-paren">(</span><em>url</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.resource.Redirect" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a subclass of Twisted Web’s <code class="docutils literal notranslate"><span class="pre">Error</span></code>.
If this is raised within <a class="reference internal" href="#buildbot.www.resource.Resource.asyncRenderHelper" title="buildbot.www.resource.Resource.asyncRenderHelper"><code class="xref py py-meth docutils literal notranslate"><span class="pre">asyncRenderHelper</span></code></a>, the user will be redirected to the given URL.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.www.resource.Resource">
<em class="property">class </em><code class="descclassname">buildbot.www.resource.</code><code class="descname">Resource</code><a class="headerlink" href="#buildbot.www.resource.Resource" title="Permalink to this definition">¶</a></dt>
<dd><p>This class specializes the usual Twisted Web <code class="docutils literal notranslate"><span class="pre">Resource</span></code> class.</p>
<p>It adds support for resources getting notified when the master is reconfigured.</p>
<dl class="attribute">
<dt id="buildbot.www.resource.Resource.needsReconfig">
<code class="descname">needsReconfig</code><a class="headerlink" href="#buildbot.www.resource.Resource.needsReconfig" title="Permalink to this definition">¶</a></dt>
<dd><p>If True, <a class="reference internal" href="#buildbot.www.resource.Resource.reconfigResource" title="buildbot.www.resource.Resource.reconfigResource"><code class="xref py py-meth docutils literal notranslate"><span class="pre">reconfigResource</span></code></a> will be called on reconfig.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.www.resource.Resource.reconfigResource">
<code class="descname">reconfigResource</code><span class="sig-paren">(</span><em>new_config</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.resource.Resource.reconfigResource" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>new_config</strong> – new <a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">MasterConfig</span></code></a> instance</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred if desired</td>
</tr>
</tbody>
</table>
<p>Reconfigure this resource.</p>
</dd></dl>

<p>It’s surprisingly difficult to render a Twisted Web resource asynchronously.
This method makes it quite a bit easier:</p>
<dl class="method">
<dt id="buildbot.www.resource.Resource.asyncRenderHelper">
<code class="descname">asyncRenderHelper</code><span class="sig-paren">(</span><em>request</em>, <em>callable</em>, <em>writeError=None</em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.resource.Resource.asyncRenderHelper" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>request</strong> – the request instance</li>
<li><strong>callable</strong> – the render function</li>
<li><strong>writeError</strong> – optional callable for rendering errors</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method will call <code class="docutils literal notranslate"><span class="pre">callable</span></code>, which can return a Deferred, with the given <code class="docutils literal notranslate"><span class="pre">request</span></code>.
The value returned from this callable will be converted to an HTTP response.
Exceptions, including <code class="docutils literal notranslate"><span class="pre">Error</span></code> subclasses, are handled properly.
If the callable raises <a class="reference internal" href="#buildbot.www.resource.Redirect" title="buildbot.www.resource.Redirect"><code class="xref py py-class docutils literal notranslate"><span class="pre">Redirect</span></code></a>, the response will be a suitable HTTP 302 redirect.</p>
<p>Use this method as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">render_GET</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asyncRenderHelper</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">renderThing</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-relnotes/index"></span><div class="section" id="release-notes">
<h2>4. Release Notes<a class="headerlink" href="#release-notes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="buildbot-1-6-0-2018-11-16">
<h3>4.1. Buildbot <code class="docutils literal notranslate"><span class="pre">1.6.0</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-11-16</span></code> )<a class="headerlink" href="#buildbot-1-6-0-2018-11-16" title="Permalink to this headline">¶</a></h3>
<div class="section" id="bug-fixes">
<h4>4.1.1. Bug fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fixed missing buildrequest owners in the builder page (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4207">issue # 4207</a>,
<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3904">issue # 3904</a>)</li>
<li>Fixed display of the buildrequest number badge text in the builder page when
on hover.</li>
<li>Fix usage of master paths when doing Git operations on worker (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4268">issue # 4268</a>)</li>
</ul>
</div>
<div class="section" id="improved-documentation">
<h4>4.1.2. Improved Documentation<a class="headerlink" href="#improved-documentation" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Misc improvement in Git source build step documentation.</li>
<li>Improve documentation of AbstractLatentWorker.</li>
<li>Improve the documentation of the Buildbot concepts by removing unneeded
details to other pages.</li>
</ul>
</div>
<div class="section" id="features">
<h4>4.1.3. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added a page that lists all pending buildrequests (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4239">issue # 4239</a>)</li>
<li>Builder page now has a chart displaying the evolution of build times over time</li>
<li>Improved FileUpload efficiency (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3709">issue # 3709</a>)</li>
<li>Add method <code class="docutils literal notranslate"><span class="pre">getResponsibleUsersForBuild</span></code> in
<code class="xref py py-class docutils literal notranslate"><span class="pre">NotifierBase</span></code> so that users can override
recipients, for example to skip authors of changes.</li>
<li>Add define parameter to RpmBuild to specify additional –define parameters.</li>
<li>Added SSL proxy capability to base web application’s developer test setup
(<code class="docutils literal notranslate"><span class="pre">gulp</span> <span class="pre">dev</span> <span class="pre">proxy</span> <span class="pre">--host</span> <span class="pre">the-buildbot-host</span> <span class="pre">--secure</span></code>).</li>
</ul>
</div>
<div class="section" id="deprecations-and-removals">
<h4>4.1.4. Deprecations and Removals<a class="headerlink" href="#deprecations-and-removals" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The Material design Web UI has been removed as unmaintained. It may be
brought back if a maintainer steps up.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-1-5-0-2018-10-09">
<h3>4.2. Buildbot <code class="docutils literal notranslate"><span class="pre">1.5.0</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-10-09</span></code> )<a class="headerlink" href="#buildbot-1-5-0-2018-10-09" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>4.2.1. Bug fixes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix the umask parameter example to make it work with both Python 2.x and 3.x.</li>
<li>Fix build-change association for multi-codebase builds in the console view..</li>
<li>Fixed builders page doesn’t list workers in multi-master configuration
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4326">issue # 4326</a>)</li>
<li>Restricted groups added by <a class="reference internal" href="#buildbot.www.oauth2.GitHubAuth" title="buildbot.www.oauth2.GitHubAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubAuth</span></code></a>’s
<code class="docutils literal notranslate"><span class="pre">getTeamsMembership</span></code> option to only those teams to which the user belongs.
Previously, groups were added for all teams for all organizations to which
the user belongs.</li>
<li>Fix ‘Show old workers’ combo behavior.</li>
</ul>
</div>
<div class="section" id="id2">
<h4>4.2.2. Features<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>GitHub teams added to a user’s <code class="docutils literal notranslate"><span class="pre">groups</span></code> by
<a class="reference internal" href="#buildbot.www.oauth2.GitHubAuth" title="buildbot.www.oauth2.GitHubAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubAuth</span></code></a>’s <code class="docutils literal notranslate"><span class="pre">getTeamsMembership</span></code> option
are now added by slug as well as by name. This means a team named “Bot
Builders” in the organization “buildbot” will be added as both <code class="docutils literal notranslate"><span class="pre">buildbot/Bot</span>
<span class="pre">Builders</span></code> and <code class="docutils literal notranslate"><span class="pre">buildbot/bot-builders</span></code>.</li>
<li>Make <code class="docutils literal notranslate"><span class="pre">urlText</span></code> renderable for the
<code class="xref py py-class docutils literal notranslate"><span class="pre">FileUpload</span></code> build step.</li>
<li>Added <code class="docutils literal notranslate"><span class="pre">noticeOnChannel</span></code> option to <a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> to send notices
instead of messages to channels. This was an option in v0.8.x and removed in
v0.9.0, which defaulted to sending notices. The v0.8.x default of sending
messages is now restored.</li>
</ul>
</div>
<div class="section" id="reverts">
<h4>4.2.3. Reverts<a class="headerlink" href="#reverts" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Reverted: Fix git submodule support when using <cite>sshPrivateKey</cite> and <cite>sshHostKey</cite> because it broke other use cases (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4316">issue # 4316</a>)
In order to have this feature to work, you need to keep your master in 1.4.0, and make sure your worker <code class="docutils literal notranslate"><span class="pre">buildbot.tac</span></code> are installed in the same path as your master.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-1-4-0-2018-09-02">
<h3>4.3. Buildbot <code class="docutils literal notranslate"><span class="pre">1.4.0</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-09-02</span></code> )<a class="headerlink" href="#buildbot-1-4-0-2018-09-02" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id3">
<h4>4.3.1. Bug fixes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix <cite>Build.getUrl()</cite> to not ignore virtual builders.</li>
<li>Fix git submodule support when using <cite>sshPrivateKey</cite> and <cite>sshHostKey</cite>
settings by passing ssh data as absolute, not relative paths.</li>
<li>Fixed <a class="reference internal" href="#step-P4" title="P4"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">P4</span></code></a> for change in latest version of <cite>p4 login -p</cite>.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.reporters.irc.IrcStatusBot</span></code> no longer encodes messages
before passing them on to methods of its Twisted base class to avoid posting
the <code class="docutils literal notranslate"><span class="pre">repr()</span></code> of a bytes object when running on Python 3.</li>
</ul>
</div>
<div class="section" id="id4">
<h4>4.3.2. Features<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added new <a class="reference internal" href="#step-GitPush" title="GitPush"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitPush</span></code></a> step to perform git push operations.</li>
<li>Objects returned by <a class="reference internal" href="#renderer"><span class="std std-ref">Renderer</span></a> now are able to pass extra arguments to
the rendered function via <cite>withArgs</cite> method.</li>
</ul>
</div>
<div class="section" id="test-suite">
<h4>4.3.3. Test Suite<a class="headerlink" href="#test-suite" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Test suite has been improved for readability by adding a lot of <code class="docutils literal notranslate"><span class="pre">inlineCallbacks</span></code></li>
<li>Fixed tests which didn’t wait for <code class="docutils literal notranslate"><span class="pre">assertFailure</span></code>’s returned deferred.</li>
<li>The test suite now runs on Python 3.7 (mostly deprecation warnings from dependencies shut down)</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-1-3-0-2018-07-13">
<h3>4.4. Buildbot <code class="docutils literal notranslate"><span class="pre">1.3.0</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-07-13</span></code> )<a class="headerlink" href="#buildbot-1-3-0-2018-07-13" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id5">
<h4>4.4.1. Bug fixes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>buildbot-worker docker image no longer use pidfile. This allows to
auto-restart a docker worker upon crash.</li>
<li>GitLab v3 API is deprecated and has been removed from <a class="reference external" href="http://gitlab.com">http://gitlab.com</a>, so
we now use v4. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4143">issue # 4143</a>)</li>
</ul>
</div>
<div class="section" id="id6">
<h4>4.4.2. Features<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>-<a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> now supports <cite>sshHostKey</cite> parameter to specify ssh public
host key for fetch operations.</li>
<li>-<a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> now supports <cite>sshPrivateKey</cite> parameter to specify private ssh
key for fetch operations.</li>
<li>-<a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> now supports <cite>sshHostKey</cite> parameter to specify ssh
public host key for fetch operations. This feature is supported on git 2.3
and newer.</li>
<li>-<a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> now supports <cite>sshPrivateKey</cite> parameter to specify
private ssh key for fetch operations. This feature is supported on git 2.3
and newer.</li>
<li>Github hook token validation now uses <code class="docutils literal notranslate"><span class="pre">hmac.compare_digest()</span></code> for better security</li>
</ul>
</div>
<div class="section" id="id7">
<h4>4.4.3. Deprecations and Removals<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Removed support for GitLab v3 API ( GitLab &lt; 9 ).</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-1-2-0-2018-06-10">
<h3>4.5. Buildbot <code class="docutils literal notranslate"><span class="pre">1.2.0</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-06-10</span></code> )<a class="headerlink" href="#buildbot-1-2-0-2018-06-10" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id8">
<h4>4.5.1. Bug fixes<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Don’t schedule a build when a GitLab merge request is deleted or edited (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3635">issue # 3635</a>)</li>
<li>Add GitLab source step; using it, we now handle GitLab merge requests from
forks properly (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4107">issue # 4107</a>)</li>
<li>Fixed a bug in <a class="reference internal" href="#buildbot.reporters.mail.MailNotifier" title="buildbot.reporters.mail.MailNotifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code></a>’s
<code class="docutils literal notranslate"><span class="pre">createEmail</span></code> method when called with the default <em>builds</em> value which
resulted in mail not being sent.</li>
<li>Fixed a Github crash that happened on Pull Requests, triggered by Github
Web-hooks. The json sent by the API does not contain a commit message. In
github.py this causes a crash, resulting into response 500 sent back to
Github and building failure.</li>
<li>Speed up generation of api/v2/builders by an order of magnitude. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3396">issue # 3396</a>).</li>
</ul>
</div>
<div class="section" id="id9">
<h4>4.5.2. Improved Documentation<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added <code class="docutils literal notranslate"><span class="pre">examples/gitlab.cfg</span></code> to demonstrate integrating Buildbot with
GitLab.</li>
</ul>
</div>
<div class="section" id="id10">
<h4>4.5.3. Features<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">ForceScheduler Parameters</span></a> now support an <code class="docutils literal notranslate"><span class="pre">autopopulate</span></code> parameter.</li>
<li><a class="reference internal" href="#forcescheduler-parameters"><span class="std std-ref">ForceScheduler Parameters</span></a> <code class="docutils literal notranslate"><span class="pre">ChoiceParameter</span></code> now correctly supports
the <code class="docutils literal notranslate"><span class="pre">strict</span></code> parameter, by allowing free text entry if strict is False.</li>
<li>Allow the remote ref to be specified in the GitHub hook configuration (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3998">issue # 3998</a>)</li>
<li>Added callable to p4 source that allows client code to resolve the p4 user
and workspace into a more complete author. Default behaviour is a lambda that
simply returns the original supplied who. This callable happens after the
existing regex is performed.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-1-1-2-2018-05-15">
<h3>4.6. Buildbot <code class="docutils literal notranslate"><span class="pre">1.1.2</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-05-15</span></code> )<a class="headerlink" href="#buildbot-1-1-2-2018-05-15" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id11">
<h4>4.6.1. Bug fixes<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>fix several multimaster issues by reverting <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3911">issue # 3911</a>. re-opens
<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3783">issue # 3783</a>. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4067">issue # 4067</a>, <a class="reference external" href="https://github.com/buildbot/buildbot/issues/4062">issue # 4062</a>, <a class="reference external" href="https://github.com/buildbot/buildbot/issues/4059">issue # 4059</a>)</li>
<li>Fix <a class="reference internal" href="#step-MultipleFileUpload" title="MultipleFileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MultipleFileUpload</span></code></a> to correctly compute path name when worker
and master are on different OS (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4019">issue # 4019</a>)</li>
<li>LDAP bytes/unicode handling has been fixed to work with Python 3. This means
that LDAP authentication, REMOTE_USER authentication, and LDAP avatars now
work on Python 3. In addition, an of bounds access when trying to load the
value of an empty LDAP attribute has been fixed.</li>
<li>Removing <code class="docutils literal notranslate"><span class="pre">`no-select`</span></code> rules from places where they would prevent the user
from selecting interesting text. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3663">issue # 3663</a>)</li>
<li>fix <code class="docutils literal notranslate"><span class="pre">`Maximum</span> <span class="pre">recursion</span> <span class="pre">depth</span> <span class="pre">exceeded</span></code> when lots of worker are trying to
connect while master is starting or reconfiguring (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4042">issue # 4042</a>).</li>
</ul>
</div>
<div class="section" id="id12">
<h4>4.6.2. Improved Documentation<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Document a minimal secure config for the Buildbot web interface.
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4026">issue # 4026</a>)</li>
</ul>
</div>
<div class="section" id="id13">
<h4>4.6.3. Features<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The Dockerfile for the buildbot master image has been updated to use Alpine
Linux 3.7. In addition, the Python requests module has been added to this
image. This makes GitHub authentication work out of the box with this image.
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/4039">issue # 4039</a>)</li>
<li>New steps for Visual Studio 2017 (VS2017, VC141, and MsBuild141).</li>
<li>The smoke tests have been changed to use ES2017 async and await keywords.
This requires that the smoke tests run with Node 8 or higher. Use of async
and await is recommended by the Protractor team:
<a class="reference external" href="https://github.com/angular/protractor/blob/master/docs/async-await.md">https://github.com/angular/protractor/blob/master/docs/async-await.md</a></li>
<li>Allow <code class="docutils literal notranslate"><span class="pre">urlText</span></code> to be set on a url linked to a <code class="docutils literal notranslate"><span class="pre">DirectoryUpload</span></code> step
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3983">issue # 3983</a>)</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-1-1-1-2018-04-06">
<h3>4.7. Buildbot <code class="docutils literal notranslate"><span class="pre">1.1.1</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-04-06</span></code> )<a class="headerlink" href="#buildbot-1-1-1-2018-04-06" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id14">
<h4>4.7.1. Bug fixes<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix issue which marked all workers dis-configured in the database every 24h
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3981">issue # 3981</a> <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3956">issue # 3956</a> <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3970">issue # 3970</a>)</li>
<li>The <a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> no longer crashes when sending from/to email
addresses with “Real Name” parts (e.g., <code class="docutils literal notranslate"><span class="pre">John</span> <span class="pre">Doe</span> <span class="pre">&lt;john.doe&#64;domain.tld&gt;</span></code>).</li>
<li>Corrected pluralization of text on landing page of the web UI</li>
</ul>
</div>
<div class="section" id="id15">
<h4>4.7.2. Improved Documentation<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Corrected typo in description of libvirt</li>
<li>Update sample config to use preferred API</li>
</ul>
</div>
<div class="section" id="misc-improvements">
<h4>4.7.3. Misc Improvements<a class="headerlink" href="#misc-improvements" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Home page now contains links to recently active builders</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-1-1-0-2018-03-10">
<h3>4.8. Buildbot <code class="docutils literal notranslate"><span class="pre">1.1.0</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-03-10</span></code> )<a class="headerlink" href="#buildbot-1-1-0-2018-03-10" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id16">
<h4>4.8.1. Deprecations and Removals<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Removed <code class="docutils literal notranslate"><span class="pre">ramlfication</span></code> as a dependency to build the docs and run the tests.</li>
</ul>
</div>
<div class="section" id="id17">
<h4>4.8.2. Bug fixes<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fixed buildrequests API doesn’t provide properties data (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3929">issue # 3929</a>)</li>
<li>Fix missing owner on builder build table (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3311">issue # 3311</a>)</li>
<li>Include <cite>hipchat</cite> as reporter.</li>
<li>Fix encoding issues of commands with Windows workers (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3799">issue # 3799</a>).</li>
<li>Fixed Relax builder name length restriction (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3413">issue # 3413</a>).</li>
<li>Fix the configuration order so that services can actually use secrets (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3985">issue # 3985</a>)</li>
<li>Partially fix Builder page should show the worker information  (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3546">issue # 3546</a>).</li>
</ul>
</div>
<div class="section" id="id18">
<h4>4.8.3. Features<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added the <code class="docutils literal notranslate"><span class="pre">defaultProperties</span></code> parameter to <a class="reference internal" href="#cfg-builders" title="builders"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">builders</span></code></a>.</li>
<li>When a build step has a log called “summary” (case-insensitive), the Build
Summary page will sort that log first in the list of logs, and automatically
expand it.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-1-0-0-2018-02-11">
<h3>4.9. Buildbot <code class="docutils literal notranslate"><span class="pre">1.0.0</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-02-11</span></code> )<a class="headerlink" href="#buildbot-1-0-0-2018-02-11" title="Permalink to this headline">¶</a></h3>
<p>Despite the major version bump, Buildbot 1.0.0 does not have major difference with the 0.9 series.
1.0.0 is rather the mark of API stability.
Developers do not foresee a major API break in the next few years like we had for 0.8 to 0.9.</p>
<p>Starting with 1.0.0, Buildbot will follow <a class="reference external" href="https://semver.org/">semver</a> versioning methodology.</p>
<div class="section" id="id19">
<h4>4.9.1. Bug fixes<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Cloning <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> repository with submodules now works with Git &lt; 1.7.6
instead of failing due to the use of the unsupported <code class="docutils literal notranslate"><span class="pre">--force</span></code> option.</li>
<li><a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> hook now properly creates a change in case of new tag or
new branch. <a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> changes will have the <code class="docutils literal notranslate"><span class="pre">category</span></code> set to
<code class="docutils literal notranslate"><span class="pre">tag</span></code> when a tag was pushed to easily distinguish from a branch push.</li>
<li>Fixed issue with <code class="xref py py-meth docutils literal notranslate"><span class="pre">Master.expireMasters</span></code> not always honoring its
<code class="docutils literal notranslate"><span class="pre">forceHouseKeeping</span></code> parameter. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3783">issue # 3783</a>)</li>
<li>Fixed issue with steps not correctly ending in <code class="docutils literal notranslate"><span class="pre">CANCELLED</span></code> status when
interrupted.</li>
<li>Fix maximum recursion limit issue when transferring large files with
<code class="docutils literal notranslate"><span class="pre">LocalWorker</span></code> (issue:<cite>3014</cite>).</li>
<li>Added an argument to P4Source that allows users to provide a callable to
convert Perforce branch and revision to a valid revlink URL. Perforce
supplies a p4web server for resolving urls into change lists.</li>
<li>Fixed issue with <code class="docutils literal notranslate"><span class="pre">buildbot_pkg`</span></code> not hanging on yarn step on windows
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3890">issue # 3890</a>).</li>
<li>Fix issue with <a class="reference internal" href="#cfg-workers" title="workers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">workers</span></code></a> <code class="docutils literal notranslate"><span class="pre">notify_on_missing</span></code> not able to be
configurable as a single string instead of list of string (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3913">issue # 3913</a>).</li>
<li>Fixed Builder page should display worker name instead of id (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3901">issue # 3901</a>).</li>
</ul>
</div>
<div class="section" id="id20">
<h4>4.9.2. Features<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Add capability to override the default UI settings (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3908">issue # 3908</a>)</li>
<li>All <a class="reference internal" href="#reporters"><span class="std std-ref">Reporters</span></a> have been adapted to be able to use <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.
<a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> has been adapted to be able to use <a class="reference internal" href="#secret"><span class="std std-ref">Secret</span></a>.</li>
<li>Implement support for Bitbucket Cloud webhook plugin in
<code class="xref py py-class docutils literal notranslate"><span class="pre">BitbucketCloudEventHandler</span></code></li>
<li>The <code class="docutils literal notranslate"><span class="pre">owners</span></code> property now includes people associated with the changes of
the build (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3904">issue # 3904</a>).</li>
<li>The repo source step now syncs with the <code class="docutils literal notranslate"><span class="pre">--force-sync</span></code> flag which allows
the sync to proceed when a source repo in the manifest has changed.</li>
<li>Add support for compressing the repo source step cache tarball with <code class="docutils literal notranslate"><span class="pre">pigz</span></code>,
a parallel gzip compressor.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-15-post1-2018-01-07">
<h3>4.10. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.15.post1</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-01-07</span></code> )<a class="headerlink" href="#buildbot-0-9-15-post1-2018-01-07" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id21">
<h4>4.10.1. Bug fixes<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix worker reconnection fails (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3875">issue # 3875</a>, <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3876">issue # 3876</a>)</li>
<li>Fix umask set to 0 when using LocalWorker (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3878">issue # 3878</a>)</li>
<li>Fix Buildbot reconfig, when badge plugin is installed (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3879">issue # 3879</a>)</li>
<li>Fix (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3865">issue # 3865</a>) so that now
<a class="reference internal" href="#buildbot.changes.svnpoller.SVNPoller" title="buildbot.changes.svnpoller.SVNPoller"><code class="xref py py-class docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> works with paths that
contain valid UTF-8 characters which are not ASCII.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-15-2018-01-02">
<h3>4.11. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.15</span></code> ( <code class="docutils literal notranslate"><span class="pre">2018-01-02</span></code> )<a class="headerlink" href="#buildbot-0-9-15-2018-01-02" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id22">
<h4>4.11.1. Bug fixes<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix builder page not showing any build (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3820">issue # 3820</a>)</li>
<li>Fix double Workers button in the menu. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3818">issue # 3818</a>)</li>
<li>Fix bad icons in the worker action dialog.</li>
<li>Fix url arguments in Buildbot <a class="reference internal" href="#badges"><span class="std std-ref">Badges</span></a> for python3.</li>
<li>Upgrading to <cite>guanlecoja-ui</cite> version 1.8.0, fixing two issues. Fixed issue
where the console view would jump to the top of page when opening the build
summary dialog (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3657">issue # 3657</a>). Also improved sidebar behaviour by remembering
previous pinned vs. collapsed state.</li>
<li>Fixes issue with Buildbot <a class="reference internal" href="#worker-DockerLatentWorker" title="DockerLatentWorker"><code class="xref bb bb-worker docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code></a>, where Buildbot can kill running
workers by mistake based on the form the worker name (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3800">issue # 3800</a>).</li>
<li>Fixes issue with Buildbot <a class="reference internal" href="#worker-DockerLatentWorker" title="DockerLatentWorker"><code class="xref bb bb-worker docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code></a> not reaping zombies process within its container environment.</li>
<li>Update requirement text to use the modern “docker” module from the older
“docker-py” module name</li>
<li>When multiple <a class="reference internal" href="#cfg-reporter" title="reporter"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">reporter</span></code></a> or <a class="reference internal" href="#cfg-services" title="services"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">services</span></code></a> are configured with
the same name, an error is now displayed instead of silently discarding all
but the last one <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3813">issue # 3813</a>.</li>
<li>Fixed exception when using <a class="reference internal" href="#buildbot.www.auth.CustomAuth" title="buildbot.www.auth.CustomAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.www.auth.CustomAuth</span></code></a></li>
</ul>
</div>
<div class="section" id="id23">
<h4>4.11.2. Features<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>New Buildbot SVG icons for web UI. The web UI now uses a colored favicon
according to build results (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3785">issue # 3785</a>).</li>
<li><code class="docutils literal notranslate"><span class="pre">paused</span></code> and <code class="docutils literal notranslate"><span class="pre">graceful</span></code> <a class="reference internal" href="#worker-states"><span class="std std-ref">Workers States</span></a> are now stored in the
database.</li>
<li><a class="reference internal" href="#worker-states"><span class="std std-ref">Workers States</span></a> are now displayed in the web UI.</li>
<li>Quarantine timers is now using the <code class="docutils literal notranslate"><span class="pre">paused</span></code> worker state.</li>
<li>Quarantine timer is now enabled when a build finish on <code class="docutils literal notranslate"><span class="pre">EXCEPTION</span></code> state.</li>
<li>Standalone binaries for buildbot-worker package are now published for windows and linux (<code class="docutils literal notranslate"><span class="pre">amd64</span></code>).
This allows to run a buildbot-worker without having a python environment.</li>
<li>New <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span> <span class="pre">--maxretries</span></code> for <a class="reference internal" href="#latent-workers"><span class="std std-ref">Latent Workers</span></a>
to quit if the master is or becomes unreachable.</li>
<li>Badges can now display <cite>running</cite> as status.</li>
<li>The database schema now supports cascade deletes for all objects instead of
raising an error when deleting a record which has other records pointing to
it via foreign keys.</li>
<li>Buildbot can properly find its version if installed from a git archive tarball generated from a tag.</li>
<li>Enhanced the test suite to add worker/master protocol interoperability tests between python3 and python2.</li>
</ul>
</div>
<div class="section" id="id24">
<h4>4.11.3. Deprecations and Removals<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>buildbot.util.ascii2unicode() is removed. buildbot.util.bytes2unicode()
should be used instead.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-14-2017-12-08">
<h3>4.12. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.14</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-12-08</span></code> )<a class="headerlink" href="#buildbot-0-9-14-2017-12-08" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id25">
<h4>4.12.1. Bug fixes<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Compile step now properly takes the decodeRC parameter in account
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3774">issue # 3774</a>)</li>
<li>Fix duplicate build requests results in
<a class="reference internal" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent" title="buildbot.db.buildrequests.BuildRequestsConnectorComponent"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequestsConnectorComponent</span></code></a> when
querying the database (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3712">issue # 3712</a>).</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">GitPoller</span></code> now accepts git branch
names with UTF-8 characters (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3769">issue # 3769</a>).</li>
<li>Fixed inconsistent use of <cite>pointer</cite> style mouse cursor by removing it from
the <cite>.label</cite> css rule and instead creating a new <cite>.clickable</cite> css rule which
is used only in places which are clickable and would not otherwise
automatically get the <cite>pointer</cite> icon, for example it is not needed for
hyper-links. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3795">issue # 3795</a>).</li>
<li>Rebuilding with the same revision now takes new change properties into
account instead of re-using the original build change properties
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3701">issue # 3701</a>).</li>
<li>Worker authentication is now delayed via a DeferredLock until Buildbot
configuration is finished. This fixes UnauthorizedLogin errors during
buildbot restart (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3462">issue # 3462</a>).</li>
<li>Fixes python3 encoding issues with Windows Service (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3796">issue # 3796</a>)</li>
</ul>
</div>
<div class="section" id="id26">
<h4>4.12.2. Features<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>new :ref`badges` plugin which reimplement the buildbot eight png badge
system.</li>
<li>In progress worker control API. Worker can now be stopped and paused using the UI.
Note that there is no UI yet to look the status of those actions (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3429">issue # 3429</a>).</li>
<li>Make maximum number of builds fetched on the builders page configurable.</li>
<li>Include <cite>context</cite> in the log message for <cite>GitHubStatusPush</cite></li>
<li>On ‘Builders’ page reload builds when tags change.</li>
<li>Give reporters access to master single in renderables. This allows access to
build logs amongst other things</li>
<li>Added possibility to check www user credentials with a custom class.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-13-2017-11-07">
<h3>4.13. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.13</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-11-07</span></code> )<a class="headerlink" href="#buildbot-0-9-13-2017-11-07" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id27">
<h4>4.13.1. Deprecations and Removals<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h4>
<p>Following will help Buildbot to leverage new feature of twisted to implement important features like worker protocol encryption.</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> and <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> packages now requires Python 2.7 or
Python 3.4+ – Python 2.6 is no longer supported.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span></code> and <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> packages now required Twisted versions
&gt;= 16.1.0. Earlier versions of Twisted are not supported.</li>
</ul>
</div>
<div class="section" id="id28">
<h4>4.13.2. Bug fixes<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix Console View forced builds stacking at top (issue:<cite>3461</cite>)</li>
<li>Improve buildrequest distributor to ensure all builders are processed. With
previous version, builder list could be re-prioritized, while running the
distributor, meaning some builders would never be run in case of master high
load. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3661">issue # 3661</a>)</li>
<li>Improve <code class="docutils literal notranslate"><span class="pre">getOldestRequestTime</span></code> function of buildrequest distributor to do
sorting and paging in the database layer (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3661">issue # 3661</a>).</li>
<li>Arguments passed to GitLab push notifications now work with Python 3 (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3720">issue # 3720</a>).</li>
<li>Web hooks change sources which use twisted.web.http.Request have been fixed to use bytes, not
native strings. This ensures web hooks work on Python 3. Please report any issues on web hooks in python3, as it is hard for us to test end to end.</li>
<li>Fixed null value of steps and logs in reporter HttpStatusPush api. Fixes
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3180">issue # 3180</a>)</li>
<li>EC2LatentBuilder now correctly sets tags on spot instances (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3739">issue # 3739</a>).</li>
<li>Fixed operation of the Try scheduler for a code checked out from Subversion.</li>
<li>Fix buildbot worker startup when running as a windows service</li>
</ul>
</div>
<div class="section" id="id29">
<h4>4.13.3. Features<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Make parameters for
<code class="xref py py-class docutils literal notranslate"><span class="pre">WarningCountingShellCommand</span></code> renderable.
These are <cite>suppressionList</cite>, <cite>warningPattern</cite>, <cite>directoryEnterPattern</cite>,
<cite>directoryLeavePattern</cite> and <cite>maxWarnCount</cite>.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubEventHandler</span></code> now supports
authentication for GitHub instances that do not allow anonymous access</li>
<li>Added support for renderable builder locks. Previously only steps could have
renderable locks.</li>
<li>Added flag to Docker Latent Worker to always pull images</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-12-post1-2017-10-10">
<h3>4.14. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.12.post1</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-10-10</span></code> )<a class="headerlink" href="#buildbot-0-9-12-post1-2017-10-10" title="Permalink to this headline">¶</a></h3>
<p>This is a release which only exists for the <code class="docutils literal notranslate"><span class="pre">buildbot_grid_view</span></code> package.</p>
<div class="section" id="id30">
<h4>4.14.1. Bug fixes<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix Grid View plugin broken because of merge resolution mistake ( <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3603">issue # 3603</a> and <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3688">issue # 3688</a>.)</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-12-2017-10-05">
<h3>4.15. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.12</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-10-05</span></code> )<a class="headerlink" href="#buildbot-0-9-12-2017-10-05" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id31">
<h4>4.15.1. Bug fixes<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fixed many issues related to connecting masters and workers with different major version of Python (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3416">issue # 3416</a>).</li>
<li>Fixed KeyError in the log when two buildrequests of the same buildset are finished at the same time (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3472">issue # 3472</a>, <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3591">issue # 3591</a>)</li>
<li>Fix for SVN.purge fails when modified files contain non-ascii characters (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3576">issue # 3576</a>)</li>
<li>Fix the GitHub change hook on Python 3 (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3452">issue # 3452</a>).</li>
<li>Fix <code class="xref py py-class docutils literal notranslate"><span class="pre">reporters.gitlab</span></code> to use correct commit status codes (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3641">issue # 3641</a>).</li>
<li>Fixed deadlock issue, when locks are taken at least 3 times by the 3 Buildstep with same configuration (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3650">issue # 3650</a>)</li>
<li>Fix the Gerrit source step in the presence of multiple Gerrit repos (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3460">issue # 3460</a>).</li>
<li>Add empty pidfile option to master and worker start script when <cite>–nodaemon</cite> option is on. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3012">issue # 3012</a>).</li>
</ul>
</div>
<div class="section" id="id32">
<h4>4.15.2. Features<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Add possibility to specify a <a class="reference internal" href="#sched-PatchParameter" title="PatchParameter"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">PatchParameter</span></code></a> for any <a class="reference internal" href="#sched-CodebaseParameter" title="CodebaseParameter"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">CodebaseParameter</span></code></a> in a <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> (part of <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3110">issue # 3110</a>).</li>
<li>Latent Workers will no longer continually retry if they cannot substantiate (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3572">issue # 3572</a>)</li>
</ul>
</div>
<div class="section" id="id33">
<h4>4.15.3. Deprecations and Removals<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>buildbot.util.encodeString() has been removed. buildbot.util.unicode2bytes() should be used instead.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-11-2017-09-08">
<h3>4.16. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.11</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-09-08</span></code> )<a class="headerlink" href="#buildbot-0-9-11-2017-09-08" title="Permalink to this headline">¶</a></h3>
<div class="section" id="incompatible-changes">
<h4>4.16.1. Incompatible Changes<a class="headerlink" href="#incompatible-changes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Buildbot is not compatible with <code class="docutils literal notranslate"><span class="pre">python3-ldap</span></code> anymore. It now requires <code class="docutils literal notranslate"><span class="pre">ldap3</span></code> package for its ldap operations (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3530">issue # 3530</a>)</li>
</ul>
</div>
<div class="section" id="id34">
<h4>4.16.2. Bug fixes<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix issue with <code class="docutils literal notranslate"><span class="pre">logviewer</span></code> scrolling up indefinitely when loading logs
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3154">issue # 3154</a>).</li>
<li>Do not add the url if it already exists in the step. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3554">issue # 3554</a>)</li>
<li>Fix filtering for REST resource attributes when SQL is involved in the backend (eq, ne, and
contains operations, when there are several filters) (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3526">issue # 3526</a>).</li>
<li>The <code class="docutils literal notranslate"><span class="pre">git</span></code> source step now uses <cite>git checkout -B</cite> rather than <cite>git branch -M</cite> to create local branches (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3537">issue # 3537</a>)</li>
<li>Fixed <a class="reference internal" href="#gridview"><span class="std std-ref">Grid View</span></a> settings. It is now possible to configure “false” values.</li>
<li>Fix performance issue when remote command does not send any line boundary
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3517">issue # 3517</a>)</li>
<li>Fix regression in GithHub oauth2 v3 api, when using enterprise edition.</li>
<li>Fix the Perforce build step on Python 3 (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3493">issue # 3493</a>)</li>
<li>Make REST API’s filter __contains use OR connector rather than AND according
to what the documentation suggests.</li>
<li>Fixed secret plugins registration, so that they are correctly available in <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">buildbot.plugins.secrets</span></code>.
changes to all secrets plugin to be imported and used.</li>
<li>Fix secrets downloaded to worker with too wide permissions.</li>
<li>Fix issue with stop build during latent worker substantiating, the build result
was retried instead of cancelled.</li>
<li><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">'buildbot[bundle]'</span></code> now installs <code class="docutils literal notranslate"><span class="pre">grid_view</span></code> plugin.
This fixes issues with the tutorial where <code class="docutils literal notranslate"><span class="pre">grid_view</span></code> is enabled by default.</li>
</ul>
</div>
<div class="section" id="id35">
<h4>4.16.3. Improved Documentation<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fixed documentation regarding log obfuscation for passwords.</li>
<li>Improve documentation of REST API’s __contains filter.</li>
</ul>
</div>
<div class="section" id="id36">
<h4>4.16.4. Features<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added autopull for Docker images based on config. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3071">issue # 3071</a>)</li>
<li>Allow to expose logs to summary callback of <a class="reference internal" href="#GerritStatusPush" title="GerritStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a>.</li>
<li>Implement GitHub change hook CI skipping (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3443">issue # 3443</a>). Now buildbot will
ignore the event, if the <code class="docutils literal notranslate"><span class="pre">[ci</span> <span class="pre">skip]</span></code> keyword (configurable) in commit
message. For more info, please check out the <code class="docutils literal notranslate"><span class="pre">skip</span></code> parameter of
<a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> hook.</li>
<li><a class="reference internal" href="#buildbot.reporters.github.GitHubStatusPush" title="buildbot.reporters.github.GitHubStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubStatusPush</span></code></a> now support reporting
to ssh style URLs, ie <cite>git&#64;github.com:Owner/RepoName.git</cite></li>
<li>Added the possibility to filter builds according to results in <a class="reference internal" href="#gridview"><span class="std std-ref">Grid
View</span></a>.</li>
<li><a class="reference internal" href="#buildbot.worker.openstack.OpenStackLatentWorker" title="buildbot.worker.openstack.OpenStackLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code></a> now supports V3
authentication.</li>
<li>Buildbot now tries harder at finding line boundaries. It now supports several
cursor controlling ANSI sequences as well as use of lots of backspace to go
back several characters.</li>
<li>UI Improvements so that Buildbot build pages looks better on mobile.</li>
<li><a class="reference internal" href="#buildbot.worker.openstack.OpenStackLatentWorker" title="buildbot.worker.openstack.OpenStackLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code></a> now supports
region attribute.</li>
<li>The <a class="reference internal" href="#schedulers"><span class="std std-ref">Schedulers</span></a> <code class="docutils literal notranslate"><span class="pre">builderNames</span></code> parameter can now be a
<code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> object that will render to a list of builder names.</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">LdapUserInfo</span></code> now uses the
python3-ldap successor ldap3 (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3530">issue # 3530</a>).</li>
<li>Added support for static suppressions parameter for shell commands.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-10-2017-08-03">
<h3>4.17. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.10</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-08-03</span></code> )<a class="headerlink" href="#buildbot-0-9-10-2017-08-03" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id37">
<h4>4.17.1. Bug fixes<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix ‘reconfig master causes worker lost’ error (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3392">issue # 3392</a>).</li>
<li>Fix bug where object names could not be larger than 150 characters
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3449">issue # 3449</a>)</li>
<li>Fix bug where notifier names could not be overridden (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3450">issue # 3450</a>)</li>
<li>Fix exception when shutting down a master (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3478">issue # 3478</a>)</li>
<li>Fix Manhole support to work with Python 3 and Twisted 16.0.0+
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3160">issue # 3160</a>). <code class="xref py py-class docutils literal notranslate"><span class="pre">AuthorizedKeysManhole</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordManhole</span></code> now require a directory
containing SSH host keys to be specified.</li>
<li>Fix python 3 issue with displaying the properties when fetching builders
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3418">issue # 3418</a>).</li>
<li>Fix bug when <code class="xref py py-class docutils literal notranslate"><span class="pre">ShellArg</span></code> arguments
were rendered only once during an instance’s lifetime.</li>
<li>Fix waterfall tiny size of build status indicators (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3475">issue # 3475</a>)</li>
<li>Fix waterfall natural order of builder list</li>
<li>Fix builder page use ‘pointer’ cursor style for tags (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3473">issue # 3473</a>)</li>
<li>Fix builder page update tag filter when using the browser’s back button (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3474">issue # 3474</a>)</li>
</ul>
</div>
<div class="section" id="id38">
<h4>4.17.2. Features<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>added support for builder names in REST API. Note that those endpoints are
not (yet) available from the UI, as the events are not sent to the endpoints
with builder names.</li>
<li>Implemented new ability to set from by email domain. Implemented
<code class="xref py py-class docutils literal notranslate"><span class="pre">RolesFromDomain</span></code>. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3422">issue # 3422</a>)</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-9-post2-2017-07-06">
<h3>4.18. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.9.post2</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-07-06</span></code> )<a class="headerlink" href="#buildbot-0-9-9-post2-2017-07-06" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id39">
<h4>4.18.1. Bug fixes<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix <code class="docutils literal notranslate"><span class="pre">tried</span> <span class="pre">to</span> <span class="pre">complete</span> <span class="pre">100</span> <span class="pre">buildrequests,</span> <span class="pre">but</span> <span class="pre">only</span> <span class="pre">completed</span> <span class="pre">25</span></code> issue in
buildrequest collapser (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3406">issue # 3406</a>)</li>
<li>Fixed issue when several mail notifiers are used with same parameters, but
different modes (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3398">issue # 3398</a>).</li>
<li>Fixed release scripts for <code class="docutils literal notranslate"><span class="pre">postN</span></code> releases</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-9-post1-2017-07-01">
<h3>4.19. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.9.post1</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-07-01</span></code> )<a class="headerlink" href="#buildbot-0-9-9-post1-2017-07-01" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id40">
<h4>4.19.1. Bug fixes<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix regression with <a class="reference internal" href="#buildbot.www.oauth2.GitHubAuth" title="buildbot.www.oauth2.GitHubAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubAuth</span></code></a> when API v3 is used.</li>
<li>When using the <a class="reference internal" href="#buildbot.www.oauth2.GitHubAuth" title="buildbot.www.oauth2.GitHubAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubAuth</span></code></a> v4 API,
the generated GraphQL to get the user organizations uses a name alias for
each organization. These aliases must not contain dashes.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-9-2017-06-29">
<h3>4.20. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.9</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-06-29</span></code> )<a class="headerlink" href="#buildbot-0-9-9-2017-06-29" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id41">
<h4>4.20.1. Bug fixes<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fixed a regression inn <code class="docutils literal notranslate"><span class="pre">UserPasswordAuth</span></code> where a list would create an
error.</li>
<li>Fix non ascii payload handling in base web hook (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3321">issue # 3321</a>).</li>
<li>Fixed default buildrequest collapsing (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3151">issue # 3151</a>)</li>
<li>_wait_for_request() would fail to format a log statement due to an invalid
type being passed to log.msg (resulting in a broken build)</li>
<li>Fix Windows compatibility with frontend development tool <code class="docutils literal notranslate"><span class="pre">gulp</span> <span class="pre">dev</span> <span class="pre">proxy</span></code>
(<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3359">issue # 3359</a>)</li>
</ul>
</div>
<div class="section" id="id42">
<h4>4.20.2. Features<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>New <a class="reference internal" href="#gridview"><span class="std std-ref">Grid View</span></a> UI plugin.</li>
<li>The <a class="reference internal" href="#change-hooks"><span class="std std-ref">Change Hooks</span></a> system is now integrated in the <a class="reference internal" href="#plugins"><span class="std std-ref">Plugin Infrastructure in Buildbot</span></a>
system, making it easier to subclass hooks. There is still the need to re-
factor hook by hook to allow better customizability.</li>
<li>The <a class="reference internal" href="#buildbot.www.oauth2.GitHubAuth" title="buildbot.www.oauth2.GitHubAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubAuth</span></code></a> now allows fetching the user
team membership for all organizations the user belongs to. This requires
access to a V4 GitHub API(GraphQL).</li>
<li>GitLab merge request hook now create a change with repository to be the
source repository and branch the source branch. Additional properties are
created to point to destination branch and destination repository. This makes
<a class="reference internal" href="#reporter-GitLabStatusPush" title="GitLabStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GitLabStatusPush</span></code></a> push the correct status to GitLab, so that
pipeline report is visible in the merge request page.</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubEventHandler</span></code> now allows the
inclusion of white-listed properties for push events.</li>
<li>Allow sending a comment to a pull request for Bitbucket Server in
<code class="xref py py-class docutils literal notranslate"><span class="pre">BitbucketServerPRCommentPush</span></code></li>
<li>Implement support for Bitbucket Server webhook plugin in
<code class="xref py py-class docutils literal notranslate"><span class="pre">BitbucketServerEventHandler</span></code></li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-8-2017-06-14">
<h3>4.21. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.8</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-06-14</span></code> )<a class="headerlink" href="#buildbot-0-9-8-2017-06-14" title="Permalink to this headline">¶</a></h3>
<div class="section" id="core-bug-fixes">
<h4>4.21.1. Core Bug fixes<a class="headerlink" href="#core-bug-fixes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix incompatibility issue of <code class="docutils literal notranslate"><span class="pre">UserPasswordAuth</span></code> with python 3.</li>
<li>Fix issue with oauth sequence not working with Firefox (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3306">issue # 3306</a>)</li>
<li>Update old <code class="docutils literal notranslate"><span class="pre">addChange</span></code> method to accept the new chdict names if only the
new name is present. Fixes <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3191">issue # 3191</a>.</li>
<li>fix bytes vs string issue on python3 with authorization of rest endpoints.</li>
</ul>
</div>
<div class="section" id="core-features">
<h4>4.21.2. Core Features<a class="headerlink" href="#core-features" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">doStepIf</span></code> is now renderable.</li>
<li>Source step codebase is now renderable.</li>
<li>Step names are now renderable.</li>
<li>Added <code class="xref py py-func docutils literal notranslate"><span class="pre">giturlparse</span></code> utility function to help buildbot components
like reporters to parse git url from change sources.</li>
<li>Factorized the mail reporter to be able to write new message based reporters, for other backend than SMTP.</li>
<li>The class <code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code> now allows being
used with Python built in comparators. It will return a Renderable which
executes the comparison.</li>
</ul>
</div>
<div class="section" id="components-bug-fixes">
<h4>4.21.3. Components Bug fixes<a class="headerlink" href="#components-bug-fixes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>GitLab reporter now correctly sets the status to running instead of pending
when a build starts.</li>
<li>GitLab reporter now correctly works when there are multiple codebase, and
when the projects names contain url reserved characters.</li>
<li>GitLab reporter now correctly reports the status even if there are several
sourcestamps. Better parsing of change repository in GitLab reporter so that
it understands ssh urls and https url. GitLab reporter do not use the project
field anymore to know the repository to push to.</li>
</ul>
</div>
<div class="section" id="components-features">
<h4>4.21.4. Components Features<a class="headerlink" href="#components-features" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>GitLab hook now supports the merge_request event to automatically build from
a merge request. Note that the results will not properly displayed in
merge_request UI due to <a class="reference external" href="https://gitlab.com/gitlab-org/gitlab-ce/issues/33293">https://gitlab.com/gitlab-org/gitlab-ce/issues/33293</a></li>
<li>Added a <a class="reference external" href="https://pushjet.io/">https://pushjet.io/</a> reporter as
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.reporters.pushjet.PushjetNotifier</span></code></li>
<li>New build step <code class="xref py py-class docutils literal notranslate"><span class="pre">Assert</span></code> Tests a renderable
or constant if it evaluates to true. It will succeed or fail to step
according to the result.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-7-2017-05-09">
<h3>4.22. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.7</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-05-09</span></code> )<a class="headerlink" href="#buildbot-0-9-7-2017-05-09" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id43">
<h4>4.22.1. Core Bug fixes<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix <code class="xref py py-class docutils literal notranslate"><span class="pre">UserPasswordAuth</span></code> authentication on <code class="docutils literal notranslate"><span class="pre">py3</span></code> and recent
browsers. (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3162">issue # 3162</a>, <a class="reference external" href="https://github.com/buildbot/buildbot/issues/3163">issue # 3163</a>). The <code class="docutils literal notranslate"><span class="pre">py3</span></code> fix also requires
Twisted <a class="reference external" href="https://github.com/twisted/twisted/pull/773">https://github.com/twisted/twisted/pull/773</a>.</li>
<li><a class="reference internal" href="#consoleview"><span class="std std-ref">Console View</span></a> now display changes the same way as in Recent Changes
page.</li>
<li>Fix issue with <a class="reference internal" href="#consoleview"><span class="std std-ref">Console View</span></a> when no change source is configured but
still builds have <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property</li>
</ul>
</div>
<div class="section" id="id44">
<h4>4.22.2. Components Bug fixes<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Allow renderables in options and definitions of step <code class="docutils literal notranslate"><span class="pre">CMake</span></code>. Currently
only dicts and lists with renderables inside are allowed.</li>
<li><code class="docutils literal notranslate"><span class="pre">OAuth</span></code> Authentication are now working with <code class="xref py py-class docutils literal notranslate"><span class="pre">RolesFromEmails</span></code>.</li>
<li><a class="reference internal" href="#buildbot.worker.docker.DockerLatentWorker" title="buildbot.worker.docker.DockerLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code></a>: <code class="docutils literal notranslate"><span class="pre">_image_exists</span></code>
does not raise anymore if it encounters an image with <code class="docutils literal notranslate"><span class="pre">&lt;none&gt;</span></code> tag</li>
<li>Fix command line parameters for <code class="docutils literal notranslate"><span class="pre">Robocopy</span></code> step <code class="docutils literal notranslate"><span class="pre">verbose</span></code> option</li>
</ul>
</div>
<div class="section" id="id45">
<h4>4.22.3. Core Features<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Builds <code class="docutils literal notranslate"><span class="pre">state_string</span></code> is now automatically computed according to the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">BuildStep.getResultSummary</span></code>, <code class="xref py py-attr docutils literal notranslate"><span class="pre">BuildStep.description</span></code> and
<code class="docutils literal notranslate"><span class="pre">updateBuildSummaryPolicy</span></code> from <a class="reference internal" href="#buildstep-common-parameters"><span class="std std-ref">Common Parameters</span></a>. This
allows the dashboards and reporters to get a descent summary text of the
build without fetching the steps.</li>
<li>New <a class="reference internal" href="#cfg-configurators" title="configurators"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">configurators</span></code></a> section, which can be used to create higher level
configuration modules for Buildbot.</li>
<li>New <a class="reference internal" href="#configurator-JanitorConfigurator" title="JanitorConfigurator"><code class="xref bb bb-configurator docutils literal notranslate"><span class="pre">JanitorConfigurator</span></code></a> which can be used to create a
builder which save disk space by removing old logs from the database.</li>
</ul>
</div>
<div class="section" id="id46">
<h4>4.22.4. Components Features<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Added a <a class="reference external" href="https://pushover.net/">https://pushover.net/</a> reporter as <a class="reference internal" href="#buildbot.reporters.pushover.PushoverNotifier" title="buildbot.reporters.pushover.PushoverNotifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.reporters.pushover.PushoverNotifier</span></code></a></li>
<li><code class="docutils literal notranslate"><span class="pre">property</span></code> argument in SetPropery is now renderable.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-6-2017-04-19">
<h3>4.23. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.6</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-04-19</span></code> )<a class="headerlink" href="#buildbot-0-9-6-2017-04-19" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id47">
<h4>4.23.1. Core Bug fixes<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="#buildbot.www.authz.endpointmatchers.AnyControlEndpointMatcher" title="buildbot.www.authz.endpointmatchers.AnyControlEndpointMatcher"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.www.authz.endpointmatchers.AnyControlEndpointMatcher</span></code></a> now
actually doesn’t match <cite>GET</cite> requests. Before it would act like an
<cite>AnyEndpointMatcher</cite> since the <cite>GET</cite> had a different case.</li>
<li>Passing <code class="docutils literal notranslate"><span class="pre">unicode</span></code> <code class="docutils literal notranslate"><span class="pre">builderNames</span></code> to <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> no longer
causes an error.</li>
<li>Fix issue with :bb:sched::<cite>Nightly</cite> change classification raising foreign key
exceptions (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3021">issue # 3021</a>)</li>
<li>Fixes an exception found <code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot_net_usage_data._sendWithUrlib</span></code> when running through the tutorial using Python 3.</li>
<li><code class="docutils literal notranslate"><span class="pre">usePTY</span></code> configuration of the <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> now works as expected
with recent version of buildbot-worker.</li>
</ul>
</div>
<div class="section" id="id48">
<h4>4.23.2. Components Bug fixes<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">pollAtLaunch</span></code> of the <a class="reference internal" href="#chsrc-GitHubPullrequestPoller" title="GitHubPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHubPullrequestPoller</span></code></a> now works as
expected. Also the author email won’t be displayed as None</li>
<li><a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a> and <a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> now use the master’s environment including PATH variable to find
the ssh binary.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">SlaveDirectoryUploadCommand</span></code>
no longer throws exceptions because the file “is used by another process”
under Windows</li>
</ul>
</div>
<div class="section" id="ui-bug-fixes">
<h4>4.23.3. UI Bug fixes<a class="headerlink" href="#ui-bug-fixes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix waterfall scrolling and zooming in current browsers</li>
<li><code class="docutils literal notranslate"><span class="pre">console_view</span></code> now properly uses <code class="docutils literal notranslate"><span class="pre">revlink</span></code> metadata to link to changes.</li>
<li>Fixed Console View infinite loading spinner when no change have been recorded
yet (<a class="reference external" href="https://github.com/buildbot/buildbot/issues/3060">issue # 3060</a>).</li>
</ul>
</div>
<div class="section" id="id49">
<h4>4.23.4. Core Features<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>new <a class="reference internal" href="#virtual-builders"><span class="std std-ref">Virtual Builders</span></a> concept for better integration of frameworks
which store the build config along side the source code.</li>
</ul>
</div>
<div class="section" id="id50">
<h4>4.23.5. Components Features<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="#chsrc-BitBucket" title="BitBucket"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitBucket</span></code></a> now sets the <code class="docutils literal notranslate"><span class="pre">event</span></code>
property on each change to what the <code class="docutils literal notranslate"><span class="pre">X-Event-Key</span></code> header contains.</li>
<li><a class="reference internal" href="#chsrc-GitHubPullrequestPoller" title="GitHubPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHubPullrequestPoller</span></code></a> now adds additional information about the
pull request to properties. The property argument is removed and is populated
with the repository full name.</li>
<li><a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> now sets
the <code class="docutils literal notranslate"><span class="pre">event</span></code> property on each change to what the <code class="docutils literal notranslate"><span class="pre">X-GitHub-Event</span></code> header
contains.</li>
<li>Changed <a class="reference internal" href="#buildbot.www.oauth2.GitHubAuth" title="buildbot.www.oauth2.GitHubAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubAuth</span></code></a> now supports GitHub
Enterprise when setting new <code class="docutils literal notranslate"><span class="pre">serverURL</span></code> argument.</li>
<li><a class="reference internal" href="#chsrc-GitLab" title="GitLab"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitLab</span></code></a> now sets the <code class="docutils literal notranslate"><span class="pre">event</span></code> property
on each change to what the <code class="docutils literal notranslate"><span class="pre">X-GitLab-Event</span></code> header contains.</li>
<li><a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> now process
git tag push events</li>
<li><a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> now adds
more information about the pull request to the properties. This syncs
features with <a class="reference internal" href="#chsrc-GitHubPullrequestPoller" title="GitHubPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHubPullrequestPoller</span></code></a></li>
<li><a class="reference internal" href="#chsrc-GitLab" title="GitLab"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitLab</span></code></a> now process git tag push
events</li>
<li><a class="reference internal" href="#chsrc-GitLab" title="GitLab"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitLab</span></code></a> now supports authentication
with the secret token</li>
</ul>
</div>
<div class="section" id="ui-features">
<h4>4.23.6. UI Features<a class="headerlink" href="#ui-features" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Reworked <a class="reference internal" href="#consoleview"><span class="std std-ref">Console View</span></a> and <a class="reference internal" href="#waterfallview"><span class="std std-ref">Waterfall View</span></a> for better usability and better integration with virtual builders</li>
<li><a class="reference internal" href="#www-data-module"><span class="std std-ref">Javascript Data Module</span></a> collections now have a <code class="docutils literal notranslate"><span class="pre">$resolved</span></code> attribute which
allows dashboard to know when the data is loaded.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-5-2017-03-18">
<h3>4.24. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.5</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-03-18</span></code> )<a class="headerlink" href="#buildbot-0-9-5-2017-03-18" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id51">
<h4>4.24.1. Bug fixes<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix issue with compressing empty log</li>
<li>Fix issue with db being closed by wrong thread</li>
<li>Fix issue with buildbot_worker not closing file handles when using the
transfer steps</li>
<li>Fix issue with buildbot requesting too many permissions from GitHub’s OAuth</li>
<li>Fix <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPStep</span></code> to accept <code class="docutils literal notranslate"><span class="pre">json</span></code> as keyword
argument.</li>
<li>Updated <code class="xref py py-class docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code> to use
keystoneauth1 so it will support latest python-novaclient packages.</li>
<li>Include <code class="xref py py-class docutils literal notranslate"><span class="pre">RpmLint</span></code> step in steps
plugins.</li>
</ul>
</div>
<div class="section" id="id52">
<h4>4.24.2. Core Features<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Experimental support for Python 3.5 and 3.6.
Note that complete support depends on fixes to be released in Twisted 17.2.0.</li>
<li>New experimental <a class="reference internal" href="#secretmanagement"><span class="std std-ref">Secret Management</span></a> framework, which allows to securely declare secrets, reusable in your steps.</li>
<li>New <a class="reference internal" href="#buildbot-wsgi-dashboards"><span class="std std-ref">Writing Dashboards with Flask or Bottle</span></a> plugin, which allows to write custom
dashboard with traditional server side web frameworks.</li>
<li>Added <code class="xref py py-class docutils literal notranslate"><span class="pre">AnyControlEndpointMatcher</span></code> and
<code class="xref py py-class docutils literal notranslate"><span class="pre">EnableSchedulerEndpointMatcher</span></code> for better configurability of the
access control. If you have access control to your Buildbot, it is
recommended you add <code class="xref py py-class docutils literal notranslate"><span class="pre">AnyControlEndpointMatcher</span></code> at the end of your
access control configuration.</li>
<li>Schedulers can now be toggled on and off from the UI. Useful for temporarily
disabling periodic timers.</li>
</ul>
</div>
<div class="section" id="id53">
<h4>4.24.3. Components Features<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">FileUpload</span></code> now supports setting the url
title text that is visible in the web UI. <code class="xref py py-class docutils literal notranslate"><span class="pre">FileUpload</span></code> now supports custom <cite>description</cite> and
<cite>descriptionDone</cite> text.</li>
<li><a class="reference internal" href="#buildbot.worker.ec2.EC2LatentWorker" title="buildbot.worker.ec2.EC2LatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentWorker</span></code></a> now provides instance id as
the <cite>instance</cite> property enabling use of the AWS toolkit.</li>
<li>Add GitHub pull request Poller to list of available changesources.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">OAuth2LoginResource</span></code> now supports the <cite>token</cite> URL
parameter. If a user wants to authenticate through OAuth2 with a pre-
generated token (such as the <cite>access_token</cite> provided by GitHub) it can be
passed to <cite>/auth/login</cite> as the <cite>token</cite> URL parameter and the user will be
authenticated to buildbot with those credentials.</li>
<li>New reporter <a class="reference internal" href="#buildbot.reporters.github.GitHubCommentPush" title="buildbot.reporters.github.GitHubCommentPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubCommentPush</span></code></a> can
comment on GitHub PRs</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">GitPoller</span></code> now supports polling tags in a git
repository.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">MultipleFilUpload</span></code> now supports the
<cite>glob</cite> parameter. If <cite>glob</cite> is set to <cite>True</cite> all <cite>workersrcs</cite> parameters will
be run through <cite>glob</cite> and the result will be uploaded to <cite>masterdest</cite></li>
<li>Changed <code class="xref py py-class docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code> to
default to v2 of the Nova API. The novaclient package has had a deprecation
warning about v1.1 and would use v2 anyway.</li>
</ul>
</div>
<div class="section" id="id54">
<h4>4.24.4. Deprecations and Removals<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">master/contrib</span></code> and <code class="docutils literal notranslate"><span class="pre">worker/contrib</span></code> directories have been moved to
their own repository at <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/">https://github.com/buildbot/buildbot-contrib/</a></li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-4-2017-02-08">
<h3>4.25. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.4</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-02-08</span></code> )<a class="headerlink" href="#buildbot-0-9-4-2017-02-08" title="Permalink to this headline">¶</a></h3>
<div class="section" id="database-upgrade">
<h4>4.25.1. Database upgrade<a class="headerlink" href="#database-upgrade" title="Permalink to this headline">¶</a></h4>
<p>A database upgrade is necessary for this release (see <a class="reference internal" href="#cmdline-upgrade-master" title="upgrade-master"><code class="xref bb bb-cmdline docutils literal notranslate"><span class="pre">upgrade-master</span></code></a>).</p>
</div>
<div class="section" id="id55">
<h4>4.25.2. Bug fixes<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Like for <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">upgrade-master</span></code> will now erase an old pidfile if the process is not live anymore instead of just failing.</li>
<li>Change properties ‘value’ changed from String(1024) to Text. Requires upgrade master. (<a class="reference external" href="http://trac.buildbot.net/ticket/3197">bug #3197</a>)</li>
<li>When using REST API, it is now possible to filter and sort in descending order at the same time.</li>
<li>Fix issue with <a class="reference internal" href="#reporter-HttpStatusPush" title="HttpStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">HttpStatusPush</span></code></a> raising <code class="docutils literal notranslate"><span class="pre">datetime</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">JSON</span> <span class="pre">serializable</span></code> error.</li>
<li>Fix issue with log viewer not properly rendering color codes.</li>
<li>Fixed log viewer selection and copy-paste for Firefox (<a class="reference external" href="http://trac.buildbot.net/ticket/3662">bug #3662</a>).</li>
<li>Fix issue with <code class="docutils literal notranslate"><span class="pre">DelayedCalled</span></code> already called, and worker missing notification email never received.</li>
<li><a class="reference internal" href="#cfg-schedulers" title="schedulers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">schedulers</span></code></a> and <a class="reference internal" href="#cfg-change_source" title="change_source"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">change_source</span></code></a> are now properly taking configuration change in account with <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">reconfig</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">setuptools</span></code> is now explicitly marked as required. The dependency was previously implicit.</li>
<li><a class="reference internal" href="#cfg-buildbotNetUsageData" title="buildbotNetUsageData"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildbotNetUsageData</span></code></a> now uses <code class="docutils literal notranslate"><span class="pre">requests</span></code> if available and will default to HTTP if a bogus SSL implementation is found.
It will also correctly send information about the platform type.</li>
</ul>
</div>
<div class="section" id="id56">
<h4>4.25.3. Features<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Buildbot now uses <a class="reference external" href="https://en.wikipedia.org/wiki/JSON_Web_Token">JWT</a> to
store its web UI Sessions.
Sessions now persist upon buildbot restart.
Sessions are shared between masters.
Session expiration time is configurable with <code class="docutils literal notranslate"><span class="pre">c['www']['cookie_expiration_time']</span></code> see <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span></code></a>.</p>
</li>
<li><p class="first">Builders page has been optimized and can now be displayed with 4 http requests whatever is the builder count (previously, there was one http request per builder).</p>
</li>
<li><p class="first">Builder and Worker page build list now have the <code class="docutils literal notranslate"><span class="pre">numbuilds=</span></code> option which allows to show more builds.</p>
</li>
<li><p class="first">Masters page now shows more information about a master (workers, builds, activity timer)</p>
</li>
<li><p class="first">Workers page improvements:</p>
<blockquote>
<div><ul class="simple">
<li>Shows which master the worker is connected to.</li>
<li>Shows correctly the list of builders that this master is configured on (not the list of <code class="docutils literal notranslate"><span class="pre">buildermaster</span></code> which nobody cares about).</li>
<li>Shows list of builds per worker similar to the builders page.</li>
<li>New worker details page displays the list of builds built by this worker using database optimized query.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id57">
<h4>4.25.4. Deprecations and Removals<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Some deprecated broken <a class="reference internal" href="#contrib-scripts"><span class="std std-ref">Contrib Scripts</span></a> were removed.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">buildbot.www.hooks.googlecode</span></code> has been removed, since the Google Code service has been shut down.</li>
<li><code class="xref py py-data docutils literal notranslate"><span class="pre">buildbot.util.json</span></code> has been deprecated in favor of the standard library <code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code>.
<code class="docutils literal notranslate"><span class="pre">simplejson</span></code> will not be used anymore if found in the virtualenv.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-3-2017-01-11">
<h3>4.26. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.3</span></code> ( <code class="docutils literal notranslate"><span class="pre">2017-01-11</span></code> )<a class="headerlink" href="#buildbot-0-9-3-2017-01-11" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id58">
<h4>4.26.1. Bug fixes<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix <a class="reference internal" href="#reporter-BitbucketStatusPush" title="BitbucketStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">BitbucketStatusPush</span></code></a> <code class="docutils literal notranslate"><span class="pre">ep</span> <span class="pre">should</span> <span class="pre">start</span> <span class="pre">with</span> <span class="pre">/</span></code> assertion
error.</li>
<li>Fix duplicate worker use case, where a worker with the same name would make
the other worker also disconnect (<a class="reference external" href="http://trac.buildbot.net/ticket/3656">bug #3656</a>)</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">GitPoller</span></code>: <code class="docutils literal notranslate"><span class="pre">buildPushesWithNoCommits</span></code> now
rebuilds for a known branch that was updated to an existing commit.</li>
<li>Fix issue with log viewer not staying at bottom of the log when loading log
lines.</li>
<li>Fixed <cite>addBuildURLs</cite> in <code class="xref py py-class docutils literal notranslate"><span class="pre">Trigger</span></code> to use
results from triggered builds to include in the URL name exposed by API.</li>
<li>Fix <a class="reference internal" href="#mq-wamp"><span class="std std-ref">Wamp</span></a> <a class="reference internal" href="#cfg-mq" title="mq"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">mq</span></code></a> support by removing <code class="docutils literal notranslate"><span class="pre">debug</span></code>, <code class="docutils literal notranslate"><span class="pre">debug_amp</span></code>
and <code class="docutils literal notranslate"><span class="pre">debug_app</span></code> from the <a class="reference internal" href="#cfg-mq" title="mq"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">mq</span></code></a> config, which is not available in
latest version of <a class="reference external" href="http://autobahn.ws">Python Autobahn</a>. You can now use
<code class="docutils literal notranslate"><span class="pre">wamp_debug_level</span></code> option instead.</li>
<li>fix issue with factory.workdir AttributeError are not properly reported.</li>
</ul>
</div>
<div class="section" id="id59">
<h4>4.26.2. Features<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Optimize the memory consumption of the log compression process. Buildbot do
not load the whole log into memory anymore. This should improve a lot
buildbot memory footprint.</li>
<li>Changed the build page so that the preview of the logs are shown in live. It
is a preview means the last lines of log. How many lines is configurable per
user in the user settings page.</li>
<li>Log viewer line numbers are no longer selectable, so that it is easier to
copy paste.</li>
<li><a class="reference internal" href="#buildbot.plugins.worker.DockerLatentWorker" title="buildbot.plugins.worker.DockerLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code></a> accepts now
renderable Dockerfile</li>
<li><a class="reference internal" href="#renderer"><span class="std std-ref">Renderer</span></a> function can now return
<code class="xref py py-class docutils literal notranslate"><span class="pre">IRenderable</span></code> objects.</li>
<li>new <a class="reference internal" href="#step-SetProperties" title="SetProperties"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SetProperties</span></code></a> which allows to generate and transform
properties separately.</li>
<li>Handle new workers in <cite>windows_service.py</cite> script.</li>
<li>Sort the builders in the waterfall view by name instead of ID.</li>
</ul>
</div>
</div>
<div class="section" id="buildbot-0-9-2-2016-12-13">
<h3>4.27. Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.2</span></code> ( <code class="docutils literal notranslate"><span class="pre">2016-12-13</span></code> )<a class="headerlink" href="#buildbot-0-9-2-2016-12-13" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id60">
<h4>4.27.1. Bug fixes<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix <a class="reference internal" href="#buildbot.www.oauth2.GitHubAuth" title="buildbot.www.oauth2.GitHubAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubAuth</span></code></a> to retrieve all organizations
instead of only those publicly available.</li>
<li>Fixed <cite>ref</cite> to point to <cite>branch</cite> instead of commit <cite>sha</cite> in
<code class="xref py py-class docutils literal notranslate"><span class="pre">GitLabStatusPush</span></code></li>
<li><a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> <code class="xref py py-meth docutils literal notranslate"><span class="pre">maybeColorize</span></code> is able to highlight single words
and stop colorization at the end. The previous implementation only stopped
colorization but not boldface.</li>
<li>fix compatibility issue with mysql5 (do not set default value for TEXT
column).</li>
<li>Fixed <cite>addChange</cite> in <a class="reference internal" href="#buildbot.data.changes.Change" title="buildbot.data.changes.Change"><code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code></a> to use the
<cite>revlink</cite> configuration option to generate the revlink.</li>
<li>fix threading issue in
<a class="reference internal" href="#buildbot.plugins.worker.DockerLatentWorker" title="buildbot.plugins.worker.DockerLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code></a></li>
</ul>
</div>
<div class="section" id="id61">
<h4>4.27.2. Features<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Implement <a class="reference internal" href="#buildbot.www.oauth2.BitbucketAuth" title="buildbot.www.oauth2.BitbucketAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">BitbucketAuth</span></code></a>.</li>
<li>New <a class="reference internal" href="#chsrc-GerritEventLogPoller" title="GerritEventLogPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritEventLogPoller</span></code></a> poller to poll Gerrit changes via http
API.</li>
<li>New <a class="reference internal" href="#reporter-GerritVerifyStatusPush" title="GerritVerifyStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritVerifyStatusPush</span></code></a> can send multiple review status for
the same Gerrit change.</li>
<li><a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> appends the builder URL to a successful/failed build if
available</li>
<li><a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> now accepts <code class="docutils literal notranslate"><span class="pre">useSmtps</span></code> parameter for initiating
connection over an SSL/TLS encrypted connection (SMTPS)</li>
<li>New support for <code class="docutils literal notranslate"><span class="pre">Mesos</span></code> and <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> via
<a class="reference internal" href="#buildbot.plugins.worker.MarathonLatentWorker" title="buildbot.plugins.worker.MarathonLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">MarathonLatentWorker</span></code></a>. <code class="docutils literal notranslate"><span class="pre">Marathon</span></code> is a
production-grade container orchestration platform for Mesosphere’s Data-
center Operating System (DC/OS) and Apache <code class="docutils literal notranslate"><span class="pre">Mesos</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">password</span></code> in <a class="reference internal" href="#buildbot.plugins.worker.DockerLatentWorker" title="buildbot.plugins.worker.DockerLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code></a> and
<a class="reference internal" href="#buildbot.plugins.worker.HyperLatentWorker" title="buildbot.plugins.worker.HyperLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">HyperLatentWorker</span></code></a>, can be None. In that
case, they will be auto-generated from random number.</li>
<li><a class="reference internal" href="#reporter-BitbucketServerStatusPush" title="BitbucketServerStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">BitbucketServerStatusPush</span></code></a> now accepts <code class="docutils literal notranslate"><span class="pre">key</span></code>, <code class="docutils literal notranslate"><span class="pre">buildName</span></code>,
<code class="docutils literal notranslate"><span class="pre">endDescription</span></code>, <code class="docutils literal notranslate"><span class="pre">startDescription</span></code>, and <code class="docutils literal notranslate"><span class="pre">verbose</span></code> parameters to
control the JSON sent to Stash.</li>
<li>Buildbot can now be configured to deny read access to REST api resources
based on authorization rules.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="older-release-notes">
<h2>5. Older Release Notes<a class="headerlink" href="#older-release-notes" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-relnotes/0.9.1"></span><div class="section" id="release-notes-for-buildbot-0-9-1">
<h3>5.1. Release Notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.1</span></code><a class="headerlink" href="#release-notes-for-buildbot-0-9-1" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.1</span></code>.
This version was released on November 1, 2016.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.1.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.1.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Add support for hyper.sh via <code class="xref py py-class docutils literal notranslate"><span class="pre">HyperLatentWorker</span></code>
<a class="reference external" href="https://hyper.sh">Hyper</a> is a CaaS solution for hosting docker container in the cloud, billed to the second.
It forms a very cost efficient solution to run your CI in the cloud.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> step now supports <code class="docutils literal notranslate"><span class="pre">unimportantSchedulerNames</span></code></p>
</li>
<li><p class="first">add a UI button to allow to cancel the whole queue for a builder</p>
</li>
<li><p class="first">Buildbot log viewer now support 256 colors ANSI codes</p>
</li>
<li><p class="first">new <a class="reference internal" href="#step-GitHub" title="GitHub"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitHub</span></code></a> which correctly checkout the magic branch like <code class="docutils literal notranslate"><span class="pre">refs/pull/xx/merge</span></code>.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> now supports a <cite>schedulers</cite> constructor argument that
allows you to send mail only for builds triggered by the specified list of
schedulers.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> now supports a <cite>branches</cite> constructor argument that
allows you to send mail only for builds triggered by the specified list of
branches.</p>
</li>
<li><p class="first">Optimization of the data api filtering, sorting and paging, speeding up a lot the UI when the master has lots of builds.</p>
</li>
<li><p class="first"><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> now accepts a <code class="docutils literal notranslate"><span class="pre">notify</span></code> parameter to control who gets emailed by Gerrit.</p>
</li>
<li><p class="first">Add a <code class="docutils literal notranslate"><span class="pre">format_fn</span></code> parameter to the <code class="docutils literal notranslate"><span class="pre">HttpStatusPush</span></code> reporter to customize the information being pushed.</p>
</li>
<li><p class="first">Latent Workers can now start in parallel.</p>
<blockquote>
<div><ul class="simple">
<li>The build started by latent worker will be created while the latent worker is substantiated.</li>
<li>Latent Workers will now report startup issues in the UI.</li>
</ul>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>Workers will be temporarily put in quarantine in case of build preparation issues.</dt>
<dd><p class="first last">This avoids master and database overload in case of bad worker configuration.
The quarantine is implemented with an exponential back-off timer.</p>
</dd>
</dl>
</li>
<li><p class="first">Master Stop will now stop all builds, and wait for all workers to properly disconnect.
Previously, the worker connections was stopped, which incidentally made all their builds marked retried.
Now, builds started with a <code class="xref py py-class docutils literal notranslate"><span class="pre">Triggereable</span></code> scheduler will be cancelled, while other builds will be retried.
The master will make sure that all latent workers are stopped.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">MessageFormatter</span></code> class also allows inline-templates with the <code class="docutils literal notranslate"><span class="pre">template</span></code> parameter.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">MessageFormatter</span></code> class allows custom mail’s subjects with the <code class="docutils literal notranslate"><span class="pre">subject</span></code> and <code class="docutils literal notranslate"><span class="pre">subject_name</span></code> parameters.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">MessageFormatter</span></code> class allows extending the context given to the Templates via the <code class="docutils literal notranslate"><span class="pre">ctx</span></code> parameter.</p>
</li>
<li><p class="first">The new <code class="docutils literal notranslate"><span class="pre">MessageFormatterMissingWorker</span></code> class allows to customize the message sent when a worker is missing.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#worker-OpenStackLatentWorker" title="OpenStackLatentWorker"><code class="xref bb bb-worker docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code></a> worker now supports rendering the block device parameters.
The <code class="docutils literal notranslate"><span class="pre">volume_size</span></code> parameter will be automatically calculated if it is <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.1.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>fix the UI to allow to cancel a buildrequest (<a class="reference external" href="http://trac.buildbot.net/ticket/3582">bug #3582</a>)</li>
<li><a class="reference internal" href="#chsrc-GitHub" title="GitHub"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitHub</span></code></a> change hook now correctly use the refs/pull/xx/merge branch for testing PRs.</li>
<li>Fix the UI to better adapt to different screen width (<a class="reference external" href="http://trac.buildbot.net/ticket/3614">bug #3614</a>)</li>
<li>Don’t log <code class="xref py py-class docutils literal notranslate"><span class="pre">AlreadyClaimedError</span></code>.
They are normal in case of <a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> cancelling, and in a multimaster configuration.</li>
<li>Fix issues with worker disconnection.
When a worker disconnects, its current buildstep must be interrupted and the buildrequests should be retried.</li>
<li>Fix the worker missing email notification.</li>
<li>Fix issue with worker builder list not being updated in UI when buildmaster is reconfigured (<a class="reference external" href="http://trac.buildbot.net/ticket/3629">bug #3629</a>)</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.1.1.3. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id1">
<h5>5.1.1.4. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>New <code class="xref py py-class docutils literal notranslate"><span class="pre">SharedService</span></code> can be used by steps, reporters, etc to implement per master resource limit.</li>
<li>New <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPClientService</span></code> can be used by steps, reporters, etc to implement HTTP client.
This class will automatically choose between <a class="reference external" href="https://pypi.python.org/pypi/treq">treq</a> and <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a>, whichever is installed, in order to access HTTP servers.
This class comes with a fake implementation helping to write unit tests.</li>
<li>All HTTP reporters have been ported to <code class="xref py py-class docutils literal notranslate"><span class="pre">HTTPClientService</span></code></li>
</ul>
</div>
<div class="section" id="id2">
<h5>5.1.1.5. Fixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.1.1.6. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>By default, non-distinct commits received via
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.status.web.hooks.github.GitHubEventHandler</span></code> now get recorded
as a <code class="xref py py-class docutils literal notranslate"><span class="pre">Change</span></code>. In this way, a commit pushed to a branch that is not
being watched (e.g. a dev branch) will still get acted on when it is later
pushed to a branch that is being watched (e.g. master). In the past, such a
commit would get ignored and not built because it was non-distinct. To disable
this behavior and revert to the old behavior, install a <code class="xref py py-class docutils literal notranslate"><span class="pre">ChangeFilter</span></code>
that checks the <code class="docutils literal notranslate"><span class="pre">github_distinct</span></code> property:</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">filter_fn</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;github_distinct&#39;</span><span class="p">))</span>
</pre></div>
</div>
<ul class="simple">
<li>setup.py ‘scripts’ have been converted to console_scripts entry point.
This makes them more portable and compatible with wheel format.
Most consequences are for the windows users:<ul>
<li><code class="docutils literal notranslate"><span class="pre">buildbot.bat</span></code> does not exist anymore, and is replaced by <code class="docutils literal notranslate"><span class="pre">buildbot.exe</span></code>, which is generated by the console_script entrypoint.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot_service.py</span></code> is replaced by <code class="docutils literal notranslate"><span class="pre">buildbot_windows_service.exe</span></code>, which is generated by the console_script entrypoint
As this script has been written in 2006, has only inline documentation and no unit tests, it is not guaranteed to be working.
Please help improving the windows situation.</li>
</ul>
</li>
<li>The <code class="docutils literal notranslate"><span class="pre">user</span></code> and <code class="docutils literal notranslate"><span class="pre">password</span></code> parameters of the <code class="docutils literal notranslate"><span class="pre">HttpStatusPush</span></code> reporter have been deprecated in favor of the <code class="docutils literal notranslate"><span class="pre">auth</span></code> parameter.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">template_name</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">MessageFormatter</span></code> class has been deprecated in favor of <code class="docutils literal notranslate"><span class="pre">template_filename</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="worker">
<h4>5.1.2. Worker<a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id3">
<h5>5.1.2.1. Fixes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id4">
<h5>5.1.2.2. Changes for Developers<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id5">
<h5>5.1.2.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The worker now requires at least Twisted 10.2.0.</li>
<li>setup.py ‘scripts’ have been converted to console_scripts entry point.
This makes them more portable and compatible with wheel format.
Most consequences are for the windows users:<ul>
<li><code class="docutils literal notranslate"><span class="pre">buildbot_worker.bat</span></code> does not exist anymore, and is replaced by <code class="docutils literal notranslate"><span class="pre">buildbot_worker.exe</span></code>, which is generated by the console_script entrypoint.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot_service.py</span></code> is replaced by <code class="docutils literal notranslate"><span class="pre">buildbot_worker_windows_service.exe</span></code>, which is generated by the console_script entrypoint
As this script has been written in 2006, has only inline documentation and no unit tests, it is not guaranteed to be working.
Please help improving the windows situation.</li>
</ul>
</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractLatentWorker</span></code> is now in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker.latent</span></code> instead of <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker.base</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.1.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0..v0.9.1
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0"></span><div class="section" id="release-notes-for-buildbot-0-9-0">
<h3>5.2. Release Notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0</span></code><a class="headerlink" href="#release-notes-for-buildbot-0-9-0" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0</span></code>.
This version was released on October 6, 2016.</p>
<p>This is a concatenation of important changes done between 0.8.12 and 0.9.0.
This does not contain details of the bug fixes related to the nine beta and rc period.
This document was written during the very long period of nine development.
It might contain some incoherencies, <em>please</em> help us and report them on irc or trac.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.2.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<p>This version represents a refactoring of Buildbot into a consistent, well-defined application composed of loosely coupled components.
The components are linked by a common database backend and a messaging system.
This allows components to be distributed across multiple build masters.
It also allows the rendering of complex web status views to be performed in the browser, rather than on the buildmasters.</p>
<p>The branch looks forward to committing to long-term API compatibility, but does not reach that goal.
The Buildbot-0.9.x series of releases will give the new APIs time to “settle in” before we commit to them.
Commitment will wait for Buildbot-1.0.0 (as per <a class="reference external" href="http://semver.org">http://semver.org</a>).
Once Buildbot reaches version 1.0.0, upgrades will become much easier for users.</p>
<p>To encourage contributions from a wider field of developers, the web application is designed to look like a normal AngularJS application.
Developers familiar with AngularJS, but not with Python, should be able to start hacking on the web application quickly.
The web application is “pluggable”, so users who develop their own status displays can package those separately from Buildbot itself.</p>
<p>Other goals:</p>
<blockquote>
<div><ul class="simple">
<li>An approachable HTTP REST API, with real time event features used by the web application but available for any other purpose.</li>
<li>A high degree of coverage by reliable, easily-modified tests.</li>
<li>“Interlocking” tests to guarantee compatibility.
For example, the real and fake DB implementations must both pass the same suite of tests.
Then no unseen difference between the fake and real implementations can mask errors that will occur in production.</li>
</ul>
</div></blockquote>
<div class="section" id="requirements">
<h5>5.2.1.1. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> package requires Python 2.7 – Python 2.5 and 2.6 are no longer supported.
The <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package requires Python 2.6 or higher – Python 2.4 and 2.5 are no longer supported.</p>
<p>No additional software or systems, aside from some minor Python packages, are required.</p>
<p>But the devil is in the details:</p>
<blockquote>
<div><ul class="simple">
<li>If you want to do web <em>development</em>, or <em>build</em> the <code class="docutils literal notranslate"><span class="pre">buildbot-www</span></code> package, you’ll need Node.
It’s an Angular app, and that’s how such apps are developed.
We’ve taken pains to not make either a requirement for users - you can simply ‘pip install’ <code class="docutils literal notranslate"><span class="pre">buildbot-www</span></code> and be on your way.
This is the case even if you’re hacking on the Python side of Buildbot.</li>
<li>For a single master, nothing else is required.</li>
</ul>
</div></blockquote>
<div class="section" id="note-for-distro-package-maintainers-the-npm-dependency-hell">
<h6>Note for distro package maintainers: The npm dependency hell<a class="headerlink" href="#note-for-distro-package-maintainers-the-npm-dependency-hell" title="Permalink to this headline">¶</a></h6>
<p>In order to <em>build</em> the <code class="docutils literal notranslate"><span class="pre">buildbot-www</span></code> package, you’ll need Node.</p>
<p>Node has a very specific package manager named npm, which has the interesting property of allowing different version of package to co-exist in the same environment.
The node ecosystem also has the habit of creating packages for a few line of code.</p>
<p>Buildbot UI uses the node ecosystem to build its javascript UI.</p>
<p>The buildsystem that we use is called <a class="reference external" href="https://www.npmjs.com/package/guanlecoja">guanlecoja</a>, which is just an integration of various javascript build tools.</p>
<p>Through npm dependency hell, guanlecoja is depending on <em>625</em> npm packages/versions.
We do not advise you to try and package all those npm <em>build</em> dependencies.
They are <em>not</em> required in order to <em>run</em> buildbot.</p>
<p>We do release pre-built packages in the form of the <a class="reference external" href="http://pythonwheels.com/">wheel</a> format on pypi.
Those wheels contain the full python source code, and prebuilt javascript source code.</p>
<p>Depending on distro maintainers feedback, we <em>could</em> also release source tarballs with prebuilt javascript, but those would be pypi packages with different names, e.g. <code class="docutils literal notranslate"><span class="pre">buildbot_www_prebuilt.0.9.0.tar.gz</span></code>.</p>
<p>Another option would be to package a <a class="reference external" href="https://www.npmjs.com/package/guanlecoja">guanlecoja</a> that would embed all its dependencies inside one package.</p>
</div>
<div class="section" id="detailed-requirements">
<h6>Detailed requirements<a class="headerlink" href="#detailed-requirements" title="Permalink to this headline">¶</a></h6>
<p>see <a class="reference internal" href="#requirements"><span class="std std-ref">Requirements</span></a></p>
</div>
</div>
<div class="section" id="features">
<h5>5.2.1.2. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<p>Buildbot-0.9.0 introduces the <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a>, a consistent and scalable method for accessing and updating the state of the Buildbot system.
This API replaces the existing, ill-defined Status API, which has been removed.
Buildbot-0.9.0 introduces new <a class="reference internal" href="#www"><span class="std std-ref">WWW Server</span></a> Interface using websocket for realtime updates.
Buildbot code that interacted with the Status API (a substantial portion!) has been rewritten to use the Data API.
Individual features and improvements to the Data API are not described on this page.</p>
<ul>
<li><p class="first">Buildbot now supports plugins.
They allow Buildbot to be extended by using components distributed independently from the main code.
They also provide for a unified way to access all components.
When previously the following construction was used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.kind.other.bits</span> <span class="k">import</span> <span class="n">ComponentClass</span>

<span class="o">...</span> <span class="n">ComponentClass</span> <span class="o">...</span>
</pre></div>
</div>
<p>the following construction achieves the same result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">kind</span>

<span class="o">...</span> <span class="n">kind</span><span class="o">.</span><span class="n">ComponentClass</span> <span class="o">...</span>
</pre></div>
</div>
<p>Kinds of components that are available this way are described in <a class="reference internal" href="#document-manual/plugins"><span class="doc">Plugin Infrastructure in Buildbot</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While the components can be still directly imported as <code class="docutils literal notranslate"><span class="pre">buildbot.kind.other.bits</span></code>, this might not be the case after Buildbot v1.0 is released.</p>
</div>
</li>
<li><p class="first">Both the P4 source step and P4 change source support ticket-based authentication.</p>
</li>
<li><p class="first">OpenStack latent slaves now support block devices as a bootable volume.</p>
</li>
<li><p class="first">Add new <a class="reference internal" href="#step-Cppcheck" title="Cppcheck"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Cppcheck</span></code></a> step.</p>
</li>
<li><p class="first">Add a new <a class="reference internal" href="#document-manual/configuration/workers-docker"><span class="doc">Docker latent Workers</span></a>.</p>
</li>
<li><p class="first">Add a new configuration for creating custom services in out-of-tree CI systems or plugins. See <a class="reference internal" href="#buildbot.util.service.BuildbotService" title="buildbot.util.service.BuildbotService"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.service.BuildbotService</span></code></a></p>
</li>
<li><p class="first">Add <code class="docutils literal notranslate"><span class="pre">try_ssh</span></code> configuration file setting and <code class="docutils literal notranslate"><span class="pre">--ssh</span></code> command line option for the try tool to specify the command to use for connecting to the build master.</p>
</li>
<li><p class="first">GitHub change hook now supports application/json format.</p>
</li>
<li><p class="first">Add support for dynamically adding steps during a build. See <a class="reference internal" href="#dynamicbuildfactories"><span class="std std-ref">Dynamic Build Factories</span></a>.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> now supports detecting new branches</p>
</li>
<li><p class="first"><a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> supports an “origin” option to give a name to the remote repo.</p>
</li>
<li><p class="first">Mercurial hook was updated and modernized.
It is no longer necessary to fork.
One can now extend PYTHONPATH via the hook configuration.
Among others, it permits to use a buildbot virtualenv instead of installing buildbot in all the system.
Added documentation inside the hook.
Misc. clean-up and reorganization in order to make the code a bit more readable.</p>
</li>
<li><p class="first">UI templates can now be customizable.
You can provide html or jade overrides to the www plugins, to customize the UI</p>
</li>
<li><p class="first">The irc command <code class="docutils literal notranslate"><span class="pre">hello</span></code> now returns ‘Hello’ in a random language if invoked more than once.</p>
</li>
<li><p class="first"><a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> now accepts a <code class="docutils literal notranslate"><span class="pre">reason</span></code> parameter.</p>
</li>
<li><p class="first"><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> now accepts a <code class="docutils literal notranslate"><span class="pre">builders</span></code> parameter.</p>
</li>
<li><p class="first"><cite>StatusPush</cite> callback now receives build results (success/failure/etc) with the <code class="docutils literal notranslate"><span class="pre">buildFinished</span></code> event.</p>
</li>
<li><p class="first">There’s a new renderable type, <a class="reference internal" href="#transform"><span class="std std-ref">Transform</span></a>.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitPoller</span></code> now has a <code class="docutils literal notranslate"><span class="pre">buildPushesWithNoCommits</span></code> option to allow the rebuild of already known commits on new branches.</p>
</li>
<li><p class="first">Add GitLab authentication plugin for web UI.
See <a class="reference internal" href="#buildbot.www.oauth2.GitLabAuth" title="buildbot.www.oauth2.GitLabAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.www.oauth2.GitLabAuth</span></code></a>.</p>
</li>
<li><p class="first"><a class="reference internal" href="#step-CMake" title="CMake"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">CMake</span></code></a> build step is added.
It provides a convenience interface to <a class="reference external" href="https://cmake.org/cmake/help/latest/">CMake</a> build system.</p>
</li>
<li><p class="first">MySQL InnoDB tables are now supported.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpStatusPush</span></code> has been ported to reporter API.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">StashStatusPush</span></code> has been ported to reporter API.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">GithubStatusPush</span></code> has been ported to reporter API.</p>
</li>
<li><p class="first"><cite>summaryCB</cite> of <a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> now gets not only pre-processed information but the actual build as well.</p>
</li>
<li><p class="first">EC2LatentWorker supports VPCs, instance profiles, and advanced volume mounts.</p>
</li>
<li><p class="first">New steps for Visual Studio 2015 (VS2015, VC14, and MsBuild14).</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-P4" title="P4"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">P4</span></code></a> step now obfuscates the password in status logs.</p>
</li>
<li><p class="first">Added support for specifying the depth of a shallow clone in <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a>.</p>
</li>
<li><p class="first"><a class="reference internal" href="#worker-OpenStackLatentWorker" title="OpenStackLatentWorker"><code class="xref bb bb-worker docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code></a> now uses a single novaclient instance to not require re-authentication when starting or stopping instances.</p>
</li>
<li><p class="first">Buildbot UI introduces branch new Authentication, and Authorizations framework.</p>
<blockquote>
<div><p>Please look at their respective guide in <a class="reference internal" href="#www"><span class="std std-ref">WWW Server</span></a></p>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">stop</span></code> now waits for complete buildmaster stop by default.</p>
</li>
<li><p class="first">New <code class="docutils literal notranslate"><span class="pre">--no-wait</span></code> argument for <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">stop</span></code> which allows not to wait for complete master shutdown.</p>
</li>
<li><p class="first">New <code class="docutils literal notranslate"><span class="pre">LocalWorker</span></code> worker to run a worker in the master process, requires <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> package installed.</p>
</li>
<li><p class="first"><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> now includes build properties in the <code class="docutils literal notranslate"><span class="pre">startCB</span></code> and <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> functions. <code class="docutils literal notranslate"><span class="pre">startCB</span></code> now must return a dictionary.</p>
</li>
<li><p class="first">add tool to send usage data to buildbot.net <a class="reference internal" href="#cfg-buildbotNetUsageData" title="buildbotNetUsageData"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildbotNetUsageData</span></code></a></p>
</li>
<li><p class="first">new <a class="reference internal" href="#step-GitHub" title="GitHub"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">GitHub</span></code></a> which correctly checkout the magic branch like <code class="docutils literal notranslate"><span class="pre">refs/pull/xx/merge</span></code>.</p>
</li>
<li><p class="first">Enable parallel builds with Visual Studio and MSBuild.</p>
</li>
</ul>
</div>
<div class="section" id="reporters">
<h5>5.2.1.3. Reporters<a class="headerlink" href="#reporters" title="Permalink to this headline">¶</a></h5>
<p>Status plugins have been moved into the <code class="docutils literal notranslate"><span class="pre">reporters</span></code> namespace.
Their API has slightly to changed in order to adapt to the new data API.
See respective documentation for details.</p>
<ul class="simple">
<li><a class="reference internal" href="#buildbot.status.status_gerrit.GerritStatusPush" title="buildbot.status.status_gerrit.GerritStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> renamed to <code class="xref py py-class docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> renamed to <a class="reference internal" href="#buildbot.reporters.mail.MailNotifier" title="buildbot.reporters.mail.MailNotifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code></a></li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> argument <code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code> should now be a <code class="xref py py-class docutils literal notranslate"><span class="pre">MessageFormatter</span></code>, due to removal of data api, custom message formatters need to be rewritten.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> argument <code class="docutils literal notranslate"><span class="pre">previousBuildGetter</span></code> is not supported anymore</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">Gerrit</span></code> supports specifying an SSH identity file explicitly.</li>
<li>Added StashStatusPush status hook for Atlassian Stash</li>
<li><a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> no longer forces SSL 3.0 when <code class="docutils literal notranslate"><span class="pre">useTls</span></code> is true.</li>
<li><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> callbacks slightly changed signature, and include a master reference instead of a status reference.</li>
<li>new <a class="reference internal" href="#reporter-GitLabStatusPush" title="GitLabStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GitLabStatusPush</span></code></a> to report builds results to GitLab.</li>
<li>new <a class="reference internal" href="#reporter-HipchatStatusPush" title="HipchatStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">HipchatStatusPush</span></code></a> to report build results to Hipchat.</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.2.1.4. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Buildbot is now compatible with SQLAlchemy 0.8 and higher, using the newly-released SQLAlchemy-Migrate.</p>
</li>
<li><p class="first">The version check for SQLAlchemy-Migrate was fixed to accept more version string formats.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-HTTPStep" title="HTTPStep"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">HTTPStep</span></code></a> step’s request parameters are now renderable.</p>
</li>
<li><p class="first">With Git(), force the updating submodules to ensure local changes by the
build are overwritten. This both ensures more consistent builds and avoids
errors when updating submodules.</p>
</li>
<li><p class="first">Buildbot is now compatible with Gerrit v2.6 and higher.</p>
<p>To make this happen, the return result of <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> and <code class="docutils literal notranslate"><span class="pre">summaryCB</span></code>
callback has changed from</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">verified</span><span class="p">,</span> <span class="n">review</span><span class="p">)</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
 <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label-name&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
           <span class="o">...</span>
           <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The implications are:</p>
<ul class="simple">
<li>there are some differences in behaviour: only those labels that were
provided will be updated</li>
<li>Gerrit server must be able to provide a version, if it can’t the
<a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> will not work</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have an old style <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> and/or <code class="docutils literal notranslate"><span class="pre">summaryCB</span></code> implemented,
these will still work, however there could be more labels updated than
anticipated.</p>
</div>
<p>More detailed information is available in <a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a>
section.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a>’s <code class="docutils literal notranslate"><span class="pre">server_tz</span></code> parameter now works correctly.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">revlink</span></code> in changes produced by the Bitbucket hook now correctly includes the <code class="docutils literal notranslate"><span class="pre">changes/</span></code> portion of the URL.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a>’s git hook <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/git_buildbot.py">master/contrib/git_buildbot.py</a> now supports git tags</p>
<p>A pushed git tag generates a change event with the <code class="docutils literal notranslate"><span class="pre">branch</span></code> property equal to the tag name.
To schedule builds based on buildbot tags, one could use something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
   <span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span>
      <span class="n">change_filter</span><span class="o">=</span><span class="nb">filter</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span>
         <span class="n">branch_re</span><span class="o">=</span><span class="s1">&#39;v[0-9]+\.[0-9]+\.[0-9]+(?:-pre|rc[0-9]+|p[0-9]+)?&#39;</span><span class="p">)</span>
      <span class="n">treeStableTimer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tag_build&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</li>
<li><p class="first">Missing “name” and “email” properties received from Gerrit are now handled properly</p>
</li>
<li><p class="first">Fixed bug which made it impossible to specify the project when using the
BitBucket dialect.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-PyLint" title="PyLint"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">PyLint</span></code></a> step has been updated to understand newer output.</p>
</li>
<li><p class="first">Fixed SVN master-side source step: if a SVN operation fails, the repository end up in a situation when a manual intervention is required.
Now if SVN reports such a situation during initial check, the checkout will be clobbered.</p>
</li>
<li><p class="first">The build properties are now stored in the database in the <code class="docutils literal notranslate"><span class="pre">build_properties</span></code> table.</p>
</li>
<li><p class="first">The list of changes in the build page now displays all the changes since the last successful build.</p>
</li>
<li><p class="first">GitHub change hook now correctly responds to ping events.</p>
</li>
<li><p class="first">GitHub change hook now correctly use the refs/pull/xx/merge branch for testing PRs.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.steps.http</span></code> steps now correctly have <code class="docutils literal notranslate"><span class="pre">url</span></code> parameter renderable</p>
</li>
<li><p class="first">When no arguments are used <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">checkconfig</span></code> now uses <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> to locate the master config file.</p>
</li>
<li><p class="first"><cite>buildbot.util.flatten</cite> now correctly flattens arbitrarily nested lists.
<cite>buildbot.util.flattened_iterator</cite> provides an iterable over the collection which may be more efficient for extremely large lists.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-PyFlakes" title="PyFlakes"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">PyFlakes</span></code></a> and <a class="reference internal" href="#step-PyLint" title="PyLint"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">PyLint</span></code></a> steps no longer parse output in Buildbot log headers (<a class="reference external" href="http://trac.buildbot.net/ticket/3337">bug #3337</a>).</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a> is now less verbose by default, and has a <code class="docutils literal notranslate"><span class="pre">debug</span></code> option to enable the logs.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a> no longer relies on the perforce server time to poll for new changes.</p>
</li>
<li><p class="first">The commit message for a change from <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a> now matches what the user typed in.</p>
</li>
<li><p class="first">Fix incompatibility with MySQL-5.7 (<a class="reference external" href="http://trac.buildbot.net/ticket/3421">bug #3421</a>)</p>
</li>
<li><p class="first">Fix incompatibility with postgresql driver psycopg2 (<a class="reference external" href="http://trac.buildbot.net/ticket/3419">bug #3419</a>, further regressions will be caught by travis)</p>
</li>
<li><p class="first">Made <code class="xref py py-class docutils literal notranslate"><span class="pre">Interpolate</span></code> safe for deepcopy or serialization/deserialization</p>
</li>
<li><p class="first">sqlite access is serialized in order to improve stability (<a class="reference external" href="http://trac.buildbot.net/ticket/3565">bug #3565</a>)</p>
</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.2.1.5. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Seamless upgrading between buildbot 0.8.12 and buildbot 0.9.0 is not supported.
Users should start from a clean install but can reuse their config according to the <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> guide.</p>
</li>
<li><p class="first"><cite>BonsaiPoller</cite> is removed.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.ec2buildslave</span></code> is removed; use <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.ec2</span></code> instead.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.libvirtbuildslave</span></code> is removed; use <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.libvirt</span></code> instead.</p>
</li>
<li><p class="first"><cite>buildbot.util.flatten</cite> flattens lists and tuples by default (previously only lists).
Additionally, flattening something that isn’t the type to flatten has different behaviour.
Previously, it would return the original value.
Instead, it now returns an array with the original value as the sole element.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.tac</span></code> does not support <code class="docutils literal notranslate"><span class="pre">print</span></code> statements anymore. Such files should now use <code class="docutils literal notranslate"><span class="pre">print</span></code>
as a function instead (see <a class="reference external" href="https://docs.python.org/3.0/whatsnew/3.0.html#print-is-a-function">https://docs.python.org/3.0/whatsnew/3.0.html#print-is-a-function</a>
for more details). Note that this applies to both python2.x and python3.x runtimes.</p>
</li>
<li><p class="first">Deprecated <code class="docutils literal notranslate"><span class="pre">workdir</span></code> property has been removed, <code class="docutils literal notranslate"><span class="pre">builddir</span></code> property should be used instead.</p>
</li>
<li><p class="first">To support MySQL InnoDB, the size of six VARCHAR(256) columns <code class="docutils literal notranslate"><span class="pre">changes.(author,</span> <span class="pre">branch,</span> <span class="pre">category,</span> <span class="pre">name);</span> <span class="pre">object_state.name;</span> <span class="pre">user.identifier</span></code> was reduced to VARCHAR(255).</p>
</li>
<li><dl class="first docutils">
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">StatusPush</span></code> has been removed from buildbot.</dt>
<dd><p class="first last">Please use the much simpler <code class="xref py py-class docutils literal notranslate"><span class="pre">HttpStatusPush</span></code> instead.</p>
</dd>
</dl>
</li>
<li><p class="first">Worker changes described in below worker section will probably impact a buildbot developer who uses undocumented ‘<em>slave</em>’ API.
Undocumented APIs have been replaced without failover, so any custom code that uses it shall be updated with new undocumented API.</p>
</li>
<li><p class="first">Web server does not provide /png and /redirect anymore (<a class="reference external" href="http://trac.buildbot.net/ticket/3357">bug #3357</a>).
This functionality is used to implement build status images.
This should be easy to implement if you need it.
One could port the old image generation code, or implement a redirection to <a class="reference external" href="http://shields.io/">http://shields.io/</a>.</p>
</li>
<li><p class="first">Support of worker-side <code class="docutils literal notranslate"><span class="pre">usePTY</span></code> was removed from <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code>.
<code class="docutils literal notranslate"><span class="pre">usePTY</span></code> argument was removed from <code class="docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> and <code class="docutils literal notranslate"><span class="pre">Worker</span></code> classes.</p>
</li>
<li><p class="first">html is no longer permitted in ‘label’ attributes of forcescheduler parameters.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">public_html</span></code> directory is not created anymore in <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span></code> (it’s not used for some time already).
Documentation was updated with suggestions to use third party web server for serving static file.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">usePTY</span></code> default value has been changed from <code class="docutils literal notranslate"><span class="pre">slave-config</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> (use of <code class="docutils literal notranslate"><span class="pre">slave-config</span></code> will still work).</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">/json</span></code> web status was removed. <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a> should be used instead.</p>
</li>
</ul>
<div class="section" id="webstatus">
<h6>WebStatus<a class="headerlink" href="#webstatus" title="Permalink to this headline">¶</a></h6>
<p>The old, clunky WebStatus has been removed.
You will like the new interface!
RIP WebStatus, you were a good friend.</p>
<p>remove it and replace it with <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span> <span class="pre">configuration</span></code></a>.</p>
</div>
<div class="section" id="id1">
<h6>Requirements<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Support for python 2.6 was dropped from the master.</li>
<li>Buildbot’s tests now require at least Mock-0.8.0.</li>
<li>SQLAlchemy-Migrate-0.6.1 is no longer supported.</li>
<li>Builder names are now restricted to unicode strings or ASCII bytestrings.
Encoded bytestrings are not accepted.</li>
</ul>
</div>
<div class="section" id="steps">
<h6>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>New-style steps are now the norm, and support for old-style steps is deprecated.
Upgrade your steps to new-style now, as support for old-style steps will be dropped after Buildbot-0.9.0.
See <a class="reference internal" href="#new-style-build-steps"><span class="std std-ref">New-Style Build Steps</span></a> for details.<ul>
<li>Status strings for old-style steps could be supplied through a wide variety of conflicting means (<code class="docutils literal notranslate"><span class="pre">describe</span></code>, <code class="docutils literal notranslate"><span class="pre">description</span></code>, <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code>, <code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code>, <code class="docutils literal notranslate"><span class="pre">getText</span></code>, and <code class="docutils literal notranslate"><span class="pre">setText</span></code>, to name just a few).
While all attempts have been made to maintain compatibility, you may find that the status strings for old-style steps have changed in this version.
To fix steps that call <code class="docutils literal notranslate"><span class="pre">setText</span></code>, try setting the <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code> attribute directly, instead – or just rewrite the step in the new style.</li>
</ul>
</li>
<li>Old-style <em>source</em> steps (imported directly from <code class="docutils literal notranslate"><span class="pre">buildbot.steps.source</span></code>) are no longer supported on the master.</li>
<li>The monotone source step got an overhaul and can now better manage
its database (initialize and/or migrate it, if needed). In the
spirit of monotone, buildbot now always keeps the database around,
as it’s an append-only database.</li>
</ul>
</div>
<div class="section" id="changes-and-removals">
<h6>Changes and Removals<a class="headerlink" href="#changes-and-removals" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Buildslave names must now be 50-character <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>.
Note that this disallows some common characters in bulidslave names, including spaces, <code class="docutils literal notranslate"><span class="pre">/</span></code>, and <code class="docutils literal notranslate"><span class="pre">.</span></code>.</p>
</li>
<li><p class="first">Builders now have “tags” instead of a category.
Builders can have multiple tags, allowing more flexible builder displays.</p>
</li>
<li><p class="first"><a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> has the following changes:</p>
<ul class="simple">
<li>The default configuration no longer contains four <code class="docutils literal notranslate"><span class="pre">AnyPropertyParameter</span></code> instances.</li>
<li>Configuring <code class="docutils literal notranslate"><span class="pre">codebases</span></code> is now mandatory, and the deprecated <code class="docutils literal notranslate"><span class="pre">branch</span></code>,  <code class="docutils literal notranslate"><span class="pre">repository</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, <code class="docutils literal notranslate"><span class="pre">revision</span></code> are not supported anymore in <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a></li>
<li><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.schedulers.forcesched.BaseParameter.updateFromKwargs</span></code> now takes a <code class="docutils literal notranslate"><span class="pre">collector</span></code> parameter used to collect all validation errors</li>
</ul>
</li>
<li><p class="first"><a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a>, <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> and <a class="reference internal" href="#sched-NightlyTriggerable" title="NightlyTriggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">NightlyTriggerable</span></code></a> have the following changes:</p>
<ul class="simple">
<li>The <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a> and <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> schedulers can now consume changes and use <code class="docutils literal notranslate"><span class="pre">onlyIfChanged</span></code> and <code class="docutils literal notranslate"><span class="pre">createAbsoluteTimestamps</span></code>.</li>
<li>All “timed” schedulers now handle <code class="docutils literal notranslate"><span class="pre">codebases</span></code> the same way. Configuring <code class="docutils literal notranslate"><span class="pre">codebases</span></code> is strongly recommended.
Using the <code class="docutils literal notranslate"><span class="pre">branch</span></code> parameter is discouraged.</li>
</ul>
</li>
<li><p class="first">Logs are now stored as Unicode strings, and thus must be decoded properly from the bytestrings provided by shell commands.
By default this encoding is assumed to be UTF-8, but the <a class="reference internal" href="#cfg-logEncoding" title="logEncoding"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logEncoding</span></code></a> parameter can be used to select an alternative.
Steps and individual logfiles can also override the global default.</p>
</li>
<li><p class="first">The PB status service uses classes which have now been removed, and anyway is redundant to the REST API, so it has been removed.
It has taken the following with it:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">statuslog</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">statusgui</span></code> (the GTK client)</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">debugclient</span></code></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">PBListener</span></code> status listener is now deprecated and does nothing.
Accordingly, there is no external access to status objects via Perspective Broker, aside from some compatibility code for the try scheduler.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">debugPassword</span></code> configuration option is no longer needed and is thus deprecated.</p>
</li>
<li><p class="first">The undocumented and un-tested <code class="docutils literal notranslate"><span class="pre">TinderboxMailNotifier</span></code>, designed to send emails suitable for the abandoned and insecure Tinderbox tool, has been removed.</p>
</li>
<li><p class="first">Buildslave info is no longer available via <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> and the <code class="docutils literal notranslate"><span class="pre">SetSlaveInfo</span></code> buildstep has been removed.</p>
</li>
<li><p class="first">The undocumented <code class="docutils literal notranslate"><span class="pre">path</span></code> parameter of the <a class="reference internal" href="#step-MasterShellCommand" title="MasterShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MasterShellCommand</span></code></a> buildstep has been renamed <code class="docutils literal notranslate"><span class="pre">workdir</span></code> for better consistency with the other steps.</p>
</li>
<li><p class="first">The name and source of a Property have to be unicode or ascii string.</p>
</li>
<li><p class="first">Property values must be serializable in JSON.</p>
</li>
<li><p class="first"><a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> has the following changes:</p>
<ul class="simple">
<li>categories parameter is deprecated and removed. It should be replaced with tags=[cat]</li>
<li>noticeOnChannel parameter is deprecated and removed.</li>
</ul>
</li>
<li><p class="first">workdir behavior has been unified:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">workdir</span></code> attribute of steps is now a property in <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a>, and choose the workdir given following priority:</p>
<blockquote>
<div><ul class="simple">
<li>workdir of the step, if defined</li>
<li>workdir of the builder (itself defaults to ‘build’)</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>setDefaultWorkdir() has been deprecated, but is now behaving the same for all the steps: Setting self.workdir if not already set</li>
</ul>
</li>
</ul>
</li>
<li><p class="first"><a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> now has a <code class="docutils literal notranslate"><span class="pre">getSchedulersAndProperties</span></code> method that can ve overridden to support dynamic triggering.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">`master.cfg</span></code> is now parsed from a thread. Previously it was run in the main thread, and thus slowing down the master in case of big config, or network access done to generate the config.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a>’s svnurl parameter has been changed to repourl.</p>
</li>
<li><p class="first">Providing Latent AWS EC2 credentials by the <code class="file docutils literal notranslate"><span class="pre">.ec2/aws_id</span></code> file is deprecated:
Use the standard <code class="file docutils literal notranslate"><span class="pre">.aws/credentials</span></code> file, instead.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="changes-for-developers">
<h5>5.2.1.6. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Botmaster no longer service parent for workers. Service parent functionality has been transferred to WorkerManager.
It should be noted Botmaster no longer has a <code class="docutils literal notranslate"><span class="pre">slaves</span></code> field as it was moved to WorkerManager.</p>
</li>
<li><p class="first">The sourcestamp DB connector now returns a <code class="docutils literal notranslate"><span class="pre">patchid</span></code> field.</p>
</li>
<li><p class="first">Buildbot no longer polls the database for jobs.
The <code class="docutils literal notranslate"><span class="pre">db_poll_interval</span></code> configuration parameter and the <a class="reference internal" href="#cfg-db" title="db"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">db</span></code></a> key of the same name are deprecated and will be ignored.</p>
</li>
<li><p class="first">The interface for adding changes has changed.
The new method is <code class="docutils literal notranslate"><span class="pre">master.data.updates.addChange</span></code> (implemented by <code class="xref py py-meth docutils literal notranslate"><span class="pre">addChange</span></code>), although the old interface (<code class="docutils literal notranslate"><span class="pre">master.addChange</span></code>) will remain in place for a few versions.
The new method:</p>
<ul class="simple">
<li>returns a change ID, not a Change instance;</li>
<li>takes its <code class="docutils literal notranslate"><span class="pre">when_timestamp</span></code> argument as epoch time (UNIX time), not a datetime instance; and</li>
<li>does not accept the deprecated parameters <code class="docutils literal notranslate"><span class="pre">who</span></code>, <code class="docutils literal notranslate"><span class="pre">isdir</span></code>, <code class="docutils literal notranslate"><span class="pre">is_dir</span></code>, and <code class="docutils literal notranslate"><span class="pre">when</span></code>.</li>
<li>requires that all strings be unicode, not bytestrings.</li>
</ul>
<p>Please adjust any custom change sources accordingly.</p>
</li>
<li><p class="first">A new build status, CANCELLED, has been added.
It is used when a step or build is deliberately cancelled by a user.</p>
</li>
<li><p class="first">This upgrade will delete all rows from the <code class="docutils literal notranslate"><span class="pre">buildrequest_claims</span></code> table.
If you are using this table for analytical purposes outside of Buildbot, please back up its contents before the upgrade, and restore it afterward, translating object IDs to scheduler IDs if necessary.
This translation would be very slow and is not required for most users, so it is not done automatically.</p>
</li>
<li><p class="first">All of the schedulers DB API methods now accept a schedulerid, rather than an objectid.
If you have custom code using these methods, check your code and make the necessary adjustments.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStamp</span></code> method has become <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStamps</span></code>, and its signature has changed.
The <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStampSetDetails</span></code> method has become <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStampsWithDefaults</span></code>, and its signature has changed.
The <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStampDetails</span></code> method has been removed.
The <code class="docutils literal notranslate"><span class="pre">addBuildsetForLatest</span></code> method has been removed.
It is equivalent to <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStampDetails</span></code> with <code class="docutils literal notranslate"><span class="pre">sourcestamps=None</span></code>.
These methods are not yet documented, and their interface is not stable.
Consult the source code for details on the changes.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">preStartConsumingChanges</span></code> and <code class="docutils literal notranslate"><span class="pre">startTimedSchedulerService</span></code> hooks have been removed.</p>
</li>
<li><p class="first">The triggerable schedulers <code class="docutils literal notranslate"><span class="pre">trigger</span></code> method now requires a list of sourcestamps, rather than a dictionary.</p>
</li>
<li><p class="first">The <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code> class is no longer used.
It remains in the codebase to support loading data from pickles on upgrade, but should not be used in running code.</p>
</li>
<li><p class="first">The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> class no longer has full <code class="docutils literal notranslate"><span class="pre">source</span></code> or <code class="docutils literal notranslate"><span class="pre">sources</span></code> attributes.
Use the data API to get this information (which is associated with the buildset, not the build request) instead.</p>
</li>
<li><p class="first">The undocumented <code class="docutils literal notranslate"><span class="pre">BuilderControl</span></code> method <code class="docutils literal notranslate"><span class="pre">submitBuildRequest</span></code> has been removed.</p>
</li>
<li><p class="first">The debug client no longer supports requesting builds (the <code class="docutils literal notranslate"><span class="pre">requestBuild</span></code> method has been removed).
If you have been using this method in production, consider instead creating a new change source, using the <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a>, or using one of the try schedulers.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">buildbot.misc.SerializedInvocation</span></code> class has been removed; use <a class="reference internal" href="#buildbot.util.debounce.method" title="buildbot.util.debounce.method"><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.util.debounce.method</span></code></a> instead.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">progress</span></code> attributes of both <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep</span></code></a> and <a class="reference internal" href="#buildbot.process.build.Build" title="buildbot.process.build.Build"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.build.Build</span></code></a> have been removed.
Subclasses should only be accessing the progress-tracking mechanics via the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.setProgress" title="buildbot.process.buildstep.BuildStep.setProgress"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.setProgress</span></code></a> method.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#buildbot.config.BuilderConfig" title="buildbot.config.BuilderConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuilderConfig</span></code></a> <code class="docutils literal notranslate"><span class="pre">nextSlave</span></code> keyword argument takes a callable.
This callable now receives <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> instance in its signature as 3rd parameter.
<strong>For retro-compatibility, all callable taking only 2 parameters will still work</strong>.</p>
</li>
<li><p class="first">properties object is now directly present in build, and not in build_status.
This should not change much unless you try to access your properties via step.build.build_status.
Remember that with PropertiesMixin, you can access properties via getProperties on the steps, and on the builds objects.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="slaves-workers">
<h4>5.2.2. Slaves/Workers<a class="headerlink" href="#slaves-workers" title="Permalink to this headline">¶</a></h4>
<div class="section" id="transition-to-worker-terminology">
<h5>5.2.2.1. Transition to “worker” terminology<a class="headerlink" href="#transition-to-worker-terminology" title="Permalink to this headline">¶</a></h5>
<p>Since version 0.9.0 of Buildbot “slave”-based terminology is deprecated in favor of “worker”-based terminology.</p>
<p>For details about public API changes see <a class="reference internal" href="#transition-to-worker-terminology"><span class="std std-ref">Transition to “worker” terminology</span></a>, and <a class="reference internal" href="#b8"><span class="std std-ref">Release Notes for Buildbot 0.9.0b8</span></a> release notes.</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package has been renamed to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code>.</li>
<li>Buildbot now requires import to be sorted using <a class="reference external" href="https://isort.readthedocs.io/en/stable/">isort</a>.
Please run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">isort</span></code> before creating a PR or use any available editor plugin in order to reorder your imports.</li>
</ul>
</div>
<div class="section" id="id2">
<h5>5.2.2.2. Requirements<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> requires Python 2.6</li>
</ul>
</div>
<div class="section" id="id3">
<h5>5.2.2.3. Features<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The Buildbot worker now includes the number of CPUs in the information it supplies to the master on connection.
This value is autodetected, but can be overridden with the <code class="docutils literal notranslate"><span class="pre">--numcpus</span></code> argument to <code class="docutils literal notranslate"><span class="pre">buildslave</span> <span class="pre">create-worker</span></code>.</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> image attribute is now renderable (can take properties in account).</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> sets environment variables describing how to connect to the master.
Example dockerfiles can be found in <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/docker">master/contrib/docker</a>.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> now has a <code class="docutils literal notranslate"><span class="pre">hostconfig</span></code> parameter that can be used to setup host configuration when creating a new container.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> now has a <code class="docutils literal notranslate"><span class="pre">networking_config</span></code> parameter that can be used to setup container networks.</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> <code class="docutils literal notranslate"><span class="pre">volumes</span></code> attribute is now renderable.</li>
</ul>
</div>
<div class="section" id="id4">
<h5>5.2.2.4. Fixes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id5">
<h5>5.2.2.5. Changes for Developers<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>EC2 Latent Worker upgraded from <code class="docutils literal notranslate"><span class="pre">boto2</span></code> to <code class="docutils literal notranslate"><span class="pre">boto3</span></code>.</li>
</ul>
</div>
<div class="section" id="id6">
<h5>5.2.2.6. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>buildmaster and worker no longer supports old-style source steps.</li>
<li>On Windows, if a <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> step in which <code class="docutils literal notranslate"><span class="pre">command</span></code> was specified as a list is executed, and a
list element is a string consisting of a single pipe character, it no longer creates a pipeline.
Instead, the pipe character is passed verbatim as an argument to the program, like any other string.
This makes command handling consistent between Windows and Unix-like systems.
To have a pipeline, specify <code class="docutils literal notranslate"><span class="pre">command</span></code> as a string.</li>
<li>Support for python 2.6 was dropped from the master.</li>
<li><code class="docutils literal notranslate"><span class="pre">public_html</span></code> directory is not created anymore in <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span></code> (it’s not used for some time already).
Documentation was updated with suggestions to use third party web server for serving static file.</li>
<li><code class="docutils literal notranslate"><span class="pre">usePTY</span></code> default value has been changed from <code class="docutils literal notranslate"><span class="pre">slave-config</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> (use of <code class="docutils literal notranslate"><span class="pre">slave-config</span></code> will still work).</li>
<li><code class="docutils literal notranslate"><span class="pre">GithubStatusPush</span></code> reporter was renamed to <a class="reference internal" href="#reporter-GitHubStatusPush" title="GitHubStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GitHubStatusPush</span></code></a>.</li>
<li>Worker commands version bumped to 3.0.</li>
<li>Master/worker protocol has been changed:<ul>
<li><code class="docutils literal notranslate"><span class="pre">slave_commands</span></code> key in worker information was renamed to <code class="docutils literal notranslate"><span class="pre">worker_commands</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">getSlaveInfo</span></code> remote method was renamed to <code class="docutils literal notranslate"><span class="pre">getWorkerInfo</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">slave-config</span></code> value of <code class="docutils literal notranslate"><span class="pre">usePTY</span></code> is not supported anymore.</li>
<li><code class="docutils literal notranslate"><span class="pre">slavesrc</span></code> command argument was renamed to <code class="docutils literal notranslate"><span class="pre">workersrc</span></code> in <code class="docutils literal notranslate"><span class="pre">uploadFile</span></code> and <code class="docutils literal notranslate"><span class="pre">uploadDirectory</span></code> commands.</li>
<li><code class="docutils literal notranslate"><span class="pre">slavedest</span></code> command argument was renamed to <code class="docutils literal notranslate"><span class="pre">workerdest</span></code> in <code class="docutils literal notranslate"><span class="pre">downloadFile</span></code> command.</li>
<li>Previously deprecated <code class="docutils literal notranslate"><span class="pre">WorkerForBuilder.remote_shutdown()</span></code> remote command has been removed.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.2.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.8.12..v0.9.0
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0rc4"></span><div class="section" id="release-notes-for-buildbot-0-9-0rc4">
<h3>5.3. Release Notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0rc4</span></code><a class="headerlink" href="#release-notes-for-buildbot-0-9-0rc4" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0rc4</span></code>.
This version was released on September 28, 2016.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.3.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="fixes">
<h5>5.3.1.1. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fix the UI to better adapt to different screen width (<a class="reference external" href="http://trac.buildbot.net/ticket/3614">bug #3614</a>)</li>
<li>Add more REST api documentation (document <code class="docutils literal notranslate"><span class="pre">/raw</span></code> endpoints, and <code class="docutils literal notranslate"><span class="pre">POST</span></code> actions)</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.3.2. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0rc3..v0.9.0rc4
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0rc3"></span><div class="section" id="release-notes-for-buildbot-0-9-0rc3">
<h3>5.4. Release Notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0rc3</span></code><a class="headerlink" href="#release-notes-for-buildbot-0-9-0rc3" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0rc3</span></code>.
This version was released on September 14, 2016.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.4.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.4.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>add tool to send usage data to buildbot.net <a class="reference internal" href="#cfg-buildbotNetUsageData" title="buildbotNetUsageData"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildbotNetUsageData</span></code></a></li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.4.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Publish python module buildbot.buildslave in the dist files</li>
<li>Upgrade to guanlecoja 0.7 (for compatibility with node6)</li>
<li>Fix invocation of trial on windows, with twisted 16+</li>
<li>Fix rare issue which makes buildbot throw a exception when there is a sourcestamp with no change for a particular codebase.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.4.2. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0rc2..v0.9.0rc3
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0rc2"></span><div class="section" id="release-notes-for-buildbot-0-9-0rc2">
<h3>5.5. Release Notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0rc2</span></code><a class="headerlink" href="#release-notes-for-buildbot-0-9-0rc2" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0rc2</span></code>.
This version was released on August 23, 2016.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.5.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.5.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>add a UI button to allow to cancel the whole queue for a builder</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.5.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>fix the UI to allow to cancel a buildrequest (<a class="reference external" href="http://trac.buildbot.net/ticket/3582">bug #3582</a>)</li>
<li>Fix BitbucketPullrequestPoller change detection</li>
<li>Fix customization for template_type in email reporter</li>
<li>fix DockerLatent integration of volumes mounting</li>
<li>misc doc fixes</li>
<li>fix buildbot not booting when builder tags contains duplicates</li>
<li><code class="docutils literal notranslate"><span class="pre">forcesched</span></code>: fix owner parameter when no authentication is used</li>
<li>REST: fix problem with twisted 16 error reporting</li>
<li>CORS: format errors according to API type</li>
<li>Dockerfiles fix and upgrade Ubuntu to 16.04</li>
<li>Fixes #3430 Increased size of builder identifier from 20 to 50 (brings it in line to size of steps and workers in same module).</li>
<li>Fix missing VS2015 entry_points</li>
<li>removed the restriction on twisted &lt; 16.3.0 now that autobahn 0.16.0 fixed the issue</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.5.1.3. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id1">
<h5>5.5.1.4. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id2">
<h5>5.5.1.5. Fixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.5.1.6. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>remove repo from worker code (obsoleted by repo master source step)</li>
</ul>
</div>
</div>
<div class="section" id="worker">
<h4>5.5.2. Worker<a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id3">
<h5>5.5.2.1. Fixes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id4">
<h5>5.5.2.2. Changes for Developers<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id5">
<h5>5.5.2.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="details">
<h4>5.5.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0rc1..v0.9.0rc2
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0rc1"></span><div class="section" id="release-notes-for-buildbot-0-9-0rc1">
<h3>5.6. Release Notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0rc1</span></code><a class="headerlink" href="#release-notes-for-buildbot-0-9-0rc1" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot <code class="docutils literal notranslate"><span class="pre">0.9.0rc1</span></code>.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.6.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.6.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>new <a class="reference internal" href="#reporter-HipchatStatusPush" title="HipchatStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">HipchatStatusPush</span></code></a> to report build results to Hipchat.</li>
<li>new steps for Visual Studio 2015 (VS2015, VC14, and MsBuild14).</li>
<li>The <a class="reference internal" href="#step-P4" title="P4"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">P4</span></code></a> step now obfuscates the password in status logs.</li>
<li>Added support for specifying the depth of a shallow clone in <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a>.</li>
<li><a class="reference internal" href="#worker-OpenStackLatentWorker" title="OpenStackLatentWorker"><code class="xref bb bb-worker docutils literal notranslate"><span class="pre">OpenStackLatentWorker</span></code></a> now uses a single novaclient instance to not require re-authentication when starting or stopping instances.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">dist</span></code> parameter in <a class="reference internal" href="#step-RpmBuild" title="RpmBuild"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">RpmBuild</span></code></a> is now renderable.</li>
<li>new <a class="reference internal" href="#reporter-BitbucketStatusPush" title="BitbucketStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">BitbucketStatusPush</span></code></a> to report build results to a Bitbucket Cloud repository.</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.6.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> now includes build properties in the <code class="docutils literal notranslate"><span class="pre">startCB</span></code> and <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> functions. <code class="docutils literal notranslate"><span class="pre">startCB</span></code> now must return a dictionary.</li>
<li>Fix TypeError exception with <code class="xref py py-class docutils literal notranslate"><span class="pre">HgPoller</span></code> if <code class="docutils literal notranslate"><span class="pre">usetimestamps=False</span></code> is used (<a class="reference external" href="http://trac.buildbot.net/ticket/3562">bug #3562</a>)</li>
<li>Fix recovery upon master unclean kill or crash (<a class="reference external" href="http://trac.buildbot.net/ticket/3564">bug #3564</a>)</li>
<li>sqlite access is serialized in order to improve stability (<a class="reference external" href="http://trac.buildbot.net/ticket/3565">bug #3565</a>)</li>
<li>Docker latent worker has been fixed (<a class="reference external" href="http://trac.buildbot.net/ticket/3571">bug #3571</a>)</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.6.1.3. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id1">
<h5>5.6.1.4. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id2">
<h5>5.6.1.5. Fixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.6.1.6. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Support for python 2.6 was dropped from the master.</li>
<li><code class="docutils literal notranslate"><span class="pre">public_html</span></code> directory is not created anymore in <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span></code> (it’s not used for some time already).
Documentation was updated with suggestions to use third party web server for serving static file.</li>
<li><code class="docutils literal notranslate"><span class="pre">usePTY</span></code> default value has been changed from <code class="docutils literal notranslate"><span class="pre">slave-config</span></code> to <code class="docutils literal notranslate"><span class="pre">None</span></code> (use of <code class="docutils literal notranslate"><span class="pre">slave-config</span></code> will still work).</li>
<li><code class="docutils literal notranslate"><span class="pre">GithubStatusPush</span></code> reporter was renamed to <a class="reference internal" href="#reporter-GitHubStatusPush" title="GitHubStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GitHubStatusPush</span></code></a>.</li>
</ul>
</div>
</div>
<div class="section" id="worker">
<h4>5.6.2. Worker<a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id3">
<h5>5.6.2.1. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package has finished being renamed to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h4>5.6.3. Worker<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id5">
<h5>5.6.3.1. Fixes<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">runGlob()</span></code> uses the correct remote protocol for both <code class="xref py py-class docutils literal notranslate"><span class="pre">CommandMixin</span></code> and <code class="xref py py-class docutils literal notranslate"><span class="pre">ComposititeStepMixin</span></code>.</li>
<li>Rename <code class="docutils literal notranslate"><span class="pre">glob()</span></code> to <code class="docutils literal notranslate"><span class="pre">runGlob()</span></code> in <code class="xref py py-class docutils literal notranslate"><span class="pre">CommandMixin</span></code></li>
</ul>
</div>
<div class="section" id="id6">
<h5>5.6.3.2. Changes for Developers<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>EC2 Latent Worker upgraded from <code class="docutils literal notranslate"><span class="pre">boto2</span></code> to <code class="docutils literal notranslate"><span class="pre">boto3</span></code>.</li>
</ul>
</div>
<div class="section" id="id7">
<h5>5.6.3.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Worker commands version bumped to 3.0.</li>
<li>Master/worker protocol has been changed:<ul>
<li><code class="docutils literal notranslate"><span class="pre">slave_commands</span></code> key in worker information was renamed to <code class="docutils literal notranslate"><span class="pre">worker_commands</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">getSlaveInfo</span></code> remote method was renamed to <code class="docutils literal notranslate"><span class="pre">getWorkerInfo</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">slave-config</span></code> value of <code class="docutils literal notranslate"><span class="pre">usePTY</span></code> is not supported anymore.</li>
<li><code class="docutils literal notranslate"><span class="pre">slavesrc</span></code> command argument was renamed to <code class="docutils literal notranslate"><span class="pre">workersrc</span></code> in <code class="docutils literal notranslate"><span class="pre">uploadFile</span></code> and <code class="docutils literal notranslate"><span class="pre">uploadDirectory</span></code> commands.</li>
<li><code class="docutils literal notranslate"><span class="pre">slavedest</span></code> command argument was renamed to <code class="docutils literal notranslate"><span class="pre">workerdest</span></code> in <code class="docutils literal notranslate"><span class="pre">downloadFile</span></code> command.</li>
<li>Previously deprecated <code class="docutils literal notranslate"><span class="pre">WorkerForBuilder.remote_shutdown()</span></code> remote command has been removed.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.6.4. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b9..v0.9.0rc1
</pre></div>
</div>
<p>Note that Buildbot-0.8.11 was never released.</p>
</div>
</div>
<span id="document-relnotes/0.9.0b9"></span><div class="section" id="release-notes-for-buildbot-0-9-0b9">
<h3>5.7. Release Notes for Buildbot 0.9.0b9<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b9" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b9
This version was released on May 10, 2016.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.7.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.7.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>new <a class="reference internal" href="#reporter-GitLabStatusPush" title="GitLabStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GitLabStatusPush</span></code></a> to report builds results to GitLab.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">stop</span></code> now waits for complete buildmaster stop by default.</li>
<li>New <code class="docutils literal notranslate"><span class="pre">--no-wait</span></code> argument for <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">stop</span></code> which allows not to wait for complete master shutdown.</li>
<li>Builder page is now sorted by builder name</li>
<li>LogViewer page now supports ANSI color codes, and is displayed white on black.</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.7.1.2. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Speed improvements for integration tests by use of SynchronousTestCase, and in-memory sqlite.</li>
<li>Buildbot now requires import to be sorted using <a class="reference external" href="https://isort.readthedocs.io/en/stable/">isort</a>.
Please run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">isort</span></code> before creating a PR or use any available editor plugin in order to reorder your imports.</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.7.1.3. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>OpenStackLatentWorker uses the novaclient API correctly now.</li>
<li>The <a class="reference internal" href="#step-MsBuild4" title="MsBuild4"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MsBuild4</span></code></a> and <a class="reference internal" href="#step-MsBuild12" title="MsBuild12"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MsBuild12</span></code></a> steps work again (<a class="reference external" href="http://trac.buildbot.net/ticket/2878">bug #2878</a>).</li>
<li>Scheduler changes are now identified by serviceid instead of objectid (<a class="reference external" href="http://trac.buildbot.net/ticket/3532">bug #3532</a>)</li>
<li>Make groups optional in LdapUserInfo (<a class="reference external" href="http://trac.buildbot.net/ticket/3511">bug #3511</a>)</li>
<li>Buildbot nine do not write pickles anymore in the master directory</li>
<li>Fix build page to not display build urls, but rather directly the build-summary, which already contain the URL.</li>
<li>UI Automatically reconnect on disconnection from the websocket. (<a class="reference external" href="http://trac.buildbot.net/ticket/3462">bug #3462</a>)</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.7.1.4. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The buildmaster now requires at least Twisted-14.0.1.</li>
<li>The web ui has upgrade its web components dependencies to <a class="reference external" href="https://github.com/buildbot/guanlecoja-ui/tree/master#changelog">latest versions</a>.
This can impact web-ui plugin.</li>
<li>Web server does not provide /png and /redirect anymore (<a class="reference external" href="http://trac.buildbot.net/ticket/3357">bug #3357</a>).
This functionality is used to implement build status images.
This should be easy to implement if you need it.
One could port the old image generation code, or implement a redirection to <a class="reference external" href="http://shields.io/">http://shields.io/</a>.</li>
<li>Support of worker-side <code class="docutils literal notranslate"><span class="pre">usePTY</span></code> was removed from <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code>.
<code class="docutils literal notranslate"><span class="pre">usePTY</span></code> argument was removed from <code class="docutils literal notranslate"><span class="pre">WorkerForBuilder</span></code> and <code class="docutils literal notranslate"><span class="pre">Worker</span></code> classes.</li>
<li>html is no longer permitted in ‘label’ attributes of forcescheduler parameters.</li>
<li><code class="docutils literal notranslate"><span class="pre">LocalWorker</span></code> now requires <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> package, instead of <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code>.</li>
<li><a class="reference internal" href="#collapse-request-functions"><span class="std std-ref">Collapse Request Functions</span></a> now takes master as first argument.
The previous callable contained too few data in order to be really usable.
As collapseRequests has never been released outside of beta, backward compatibility with previous release has <strong>not</strong> been implemented.</li>
<li>This is the last version of buildbot nine which supports python 2.6 for the master.
Next version will drop python 2.6 support.</li>
</ul>
</div>
</div>
<div class="section" id="worker">
<h4>5.7.2. Worker<a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.7.2.1. Fixes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> script now outputs message to terminal.</li>
<li>Windows helper script now called <code class="docutils literal notranslate"><span class="pre">buildbot-worker.bat</span></code> (was <code class="docutils literal notranslate"><span class="pre">buildbot_worker.bat</span></code>, notice underscore), so that <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> command can be used in virtualenv both on Windows and POSIX systems.</li>
</ul>
</div>
<div class="section" id="id2">
<h5>5.7.2.2. Changes for Developers<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SLAVEPASS</span></code> environment variable is not removed in default-generated <code class="docutils literal notranslate"><span class="pre">buildbot.tac</span></code>.
Environment variables are cleared in places where they are used (e.g. in Docker Latent Worker contrib scripts).</li>
<li>Master-part handling has been removed from <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span></code> log watcher (<a class="reference external" href="http://trac.buildbot.net/ticket/3482">bug #3482</a>).</li>
<li><code class="docutils literal notranslate"><span class="pre">WorkerDetectedError</span></code> exception type has been removed.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.7.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b8..v0.9.0b9
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0b8"></span><div class="section" id="release-notes-for-buildbot-0-9-0b8">
<span id="b8"></span><h3>5.8. Release Notes for Buildbot 0.9.0b8<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b8" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b8
This version was released on April 11, 2016.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.8.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.8.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">GitPoller</span></code> now has a <code class="docutils literal notranslate"><span class="pre">buildPushesWithNoCommits</span></code> option to allow the rebuild of already known commits on new branches.</li>
<li>Add GitLab authentication plugin for web UI.
See <a class="reference internal" href="#buildbot.www.oauth2.GitLabAuth" title="buildbot.www.oauth2.GitLabAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.www.oauth2.GitLabAuth</span></code></a>.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> now has a <code class="docutils literal notranslate"><span class="pre">hostconfig</span></code> parameter that can be used to setup host configuration when creating a new container.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> now has a <code class="docutils literal notranslate"><span class="pre">networking_config</span></code> parameter that can be used to setup container networks.</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> <code class="docutils literal notranslate"><span class="pre">volumes</span></code> attribute is now renderable.</li>
<li><a class="reference internal" href="#step-CMake" title="CMake"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">CMake</span></code></a> build step is added.
It provides a convenience interface to <a class="reference external" href="https://cmake.org/cmake/help/latest/">CMake</a> build system.</li>
<li>MySQL InnoDB tables are now supported.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpStatusPush</span></code> has been ported to reporter API.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">StashStatusPush</span></code> has been ported to reporter API.</li>
<li><code class="docutils literal notranslate"><span class="pre">GithubStatusPush</span></code> has been ported to reporter API.</li>
<li><cite>summaryCB</cite> of <a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> now gets not only pre-processed information but the actual build as well.</li>
<li>EC2LatentWorker supports VPCs, instance profiles, and advanced volume mounts.</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.8.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fix loading <a class="reference internal" href="#buildbot.ldapuserinfo.LdapUserInfo" title="buildbot.ldapuserinfo.LdapUserInfo"><code class="xref py py-class docutils literal notranslate"><span class="pre">LdapUserInfo</span></code></a> plugin and its documentation (<a class="reference external" href="http://trac.buildbot.net/ticket/3371">bug #3371</a>).</li>
<li>Fix deprecation warnings seen with docker-py &gt;= 1.4 when passing arguments to <code class="docutils literal notranslate"><span class="pre">docker_client.start()</span></code>.</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubEventHandler</span></code> now uses the <code class="docutils literal notranslate"><span class="pre">['repository']['html_url']</span></code> key in the webhook payload to populate <code class="docutils literal notranslate"><span class="pre">repository</span></code>, as the previously used <code class="docutils literal notranslate"><span class="pre">['url']</span></code> and <code class="docutils literal notranslate"><span class="pre">['clone_url']</span></code> keys had a different format between push and pull requests and GitHub and GitHub Enterprise instances.</li>
<li>Fix race condition where log compression could lead to empty log results in reporter api</li>
<li>Error while applying db upgrade is now properly reported in the buildbot upgrade-master command line.</li>
<li>Made <code class="xref py py-class docutils literal notranslate"><span class="pre">Interpolate</span></code> safe for deepcopy or serialization/deserialization</li>
<li>Optimized UI REST requests for child builds and change page.</li>
<li>Fix <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> use of <cite>volume</cite> parameter, they now properly manage <cite>src:dest</cite> syntax.</li>
<li>Fix <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> to properly create properties so that docker parameters can be renderable.</li>
<li>Lock down autobahn version for python 2.6 (note that autobahn and twisted are no longer supporting 2.6, and thus do not receive security fixes anymore).</li>
<li>Fix docs and example to always use port 8020 for the web ui.</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.8.1.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Deprecated <code class="docutils literal notranslate"><span class="pre">workdir</span></code> property has been removed, <code class="docutils literal notranslate"><span class="pre">builddir</span></code> property should be used instead.</p>
</li>
<li><p class="first">To support MySQL InnoDB, the size of six VARCHAR(256) columns <code class="docutils literal notranslate"><span class="pre">changes.(author,</span> <span class="pre">branch,</span> <span class="pre">category,</span> <span class="pre">name);</span> <span class="pre">object_state.name;</span> <span class="pre">user.identifier</span></code> was reduced to VARCHAR(255).</p>
</li>
<li><dl class="first docutils">
<dt><code class="xref py py-class docutils literal notranslate"><span class="pre">StatusPush</span></code> has been removed from buildbot.</dt>
<dd><p class="first last">Please use the much simpler <code class="xref py py-class docutils literal notranslate"><span class="pre">HttpStatusPush</span></code> instead.</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.8.1.4. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<p>Worker changes described in below worker section will probably impact a buildbot developer who uses undocumented ‘<em>slave</em>’ API.
Undocumented APIs have been replaced without failover, so any custom code that uses it shall be updated with new undocumented API.</p>
</div>
</div>
<div class="section" id="worker">
<h4>5.8.2. Worker<a class="headerlink" href="#worker" title="Permalink to this headline">¶</a></h4>
<p>Package <cite>buildbot-slave</cite> is being renamed <cite>buildbot-worker</cite>.
As the work is not completely finished, neither <cite>buildbot-slave==0.9.0b8</cite> or <cite>buildbot-worker==0.9.0b8</cite> have been released.</p>
<p>You can safely use any version of <cite>buildbot-slave</cite> with <cite>buildbot==0.9.0b8</cite>, either <cite>buildbot-slave==0.8.12</cite> or <cite>buildbot-slave==0.9.0b7</cite>.</p>
</div>
<div class="section" id="transition-to-worker-terminology">
<h4>5.8.3. Transition to “worker” terminology<a class="headerlink" href="#transition-to-worker-terminology" title="Permalink to this headline">¶</a></h4>
<p>Since version 0.9.0 of Buildbot “slave”-based terminology is deprecated in favor of “worker”-based terminology.</p>
<p>For details about public API changes see <a class="reference internal" href="#transition-to-worker-terminology"><span class="std std-ref">Transition to “worker” terminology</span></a>.</p>
<p>API changes done without providing fallback:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.buildslave.manager</span></code></td>
<td><a class="reference internal" href="#module-buildbot.worker.manager" title="buildbot.worker.manager"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker.manager</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.manager.BuildslaveRegistration</span></code></td>
<td><a class="reference internal" href="#buildbot.worker.manager.WorkerRegistration" title="buildbot.worker.manager.WorkerRegistration"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.manager.WorkerRegistration</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.manager.BuildslaveRegistration.buildslave</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.manager.WorkerRegistration.worker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.manager.BuildslaveManager</span></code></td>
<td><a class="reference internal" href="#buildbot.worker.manager.WorkerManager" title="buildbot.worker.manager.WorkerManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.manager.WorkerManager</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.manager.BuildslaveManager.slaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.manager.WorkerManager.workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.buildslave.manager.BuildslaveManager.getBuildslaveByName</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.worker.manager.WorkerManager.getWorkerByName</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.docker.DockerLatentBuildSlave</span></code></td>
<td><a class="reference internal" href="#buildbot.worker.docker.DockerLatentWorker" title="buildbot.worker.docker.DockerLatentWorker"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.docker.DockerLatentWorker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.local.LocalBuildSlave</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.local.LocalWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.local.LocalBuildSlave.LocalBuildSlaveFactory</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.local.LocalWorker.LocalWorkerFactory</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.local.LocalBuildSlave.remote_slave</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.local.LocalWorker.remote_worker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.buildslave.base</span></code> module with all contents</td>
<td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.worker.base</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.updateSlave</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.updateWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.slavebuilders</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.workerforbuilders</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.updateSlaveStatus</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.updateWorkerStatus</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractLatentBuildSlave.updateSlave</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.worker.AbstractLatentWorker.updateWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.buildslave.BuildSlave.slave_status</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.worker.Worker.worker_status</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.config.MasterConfig.load_slaves</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">load_workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.master.BuildMaster.buildslaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.master.BuildMaster.workers</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.build.Build.slavebuilder</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workerforbuilder</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.build.Build.setSlaveEnvironment</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">setWorkerEnvironment</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.build.Build.slaveEnvironment</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workerEnvironment</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.build.Build.getSlaveCommandVersion</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">getWorkerCommandVersion</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.build.Build.setupSlaveBuilder</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">setupWorkerForBuilder</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.builder.Build.canStartWithSlavebuilder</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">canStartWithWorkerForBuilder</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.slavebuilder.AbstractSlaveBuilder.getSlaveCommandVersion</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.workerforbuilder.AbstractWorkerForBuilder.getWorkerCommandVersion</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.slavebuilder.AbstractSlaveBuilder.attached</span></code> method argument <code class="docutils literal notranslate"><span class="pre">slave</span></code> was renamed</td>
<td><code class="docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.slave_commands</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.worker_commands</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.slave_environ</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.worker_environ</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.slave_basedir</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.worker_basedir</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.slave_system</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.worker_system</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.buildslaveid</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.workerid</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.addSlaveBuilder</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.addWorkerForBuilder</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.removeSlaveBuilder</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.removeWorkerForBuilder</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.buildslave.AbstractBuildSlave.messageReceivedFromSlave</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.worker.AbstractWorker.messageReceivedFromWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.slavebuilder.LatentSlaveBuilder</span></code> constructor positional argument <code class="docutils literal notranslate"><span class="pre">slave</span></code> was renamed</td>
<td><code class="docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.buildrequestdistributor.BasicBuildChooser.nextSlave</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">nextWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.buildrequestdistributor.BasicBuildChooser.slavepool</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">workerpool</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.buildrequestdistributor.BasicBuildChooser.preferredSlaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">preferredWorkers</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.process.buildrequestdistributor.BasicBuildChooser.rejectedSlaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">rejectedSlaves</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.shell.ShellCommand.slaveEnvironment</span></code> (Note: this variable is renderable)</td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.steps.shell.ShellCommand.workerEnvironment</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.status.slave</span></code></td>
<td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.status.worker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.status.slave.SlaveStatus</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.status.worker.WorkerStatus</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IStatusReceiver.slaveConnected</span></code> with all implementations</td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IStatusReceiver.workerConnected</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IStatusReceiver.slaveDisconnected</span></code> with all implementations</td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IStatusReceiver.workerDisconnected</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.master.Status.slaveConnected</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.master.Status.workerConnected</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.master.Status.slaveDisconnected</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.master.Status.workerDisconnected</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.master.Status.slavePaused</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.master.Status.workerPaused</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.master.Status.slaveUnpaused</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.master.Status.workerUnpaused</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.status.master.Status.buildslaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.status.master.Status.workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.base.StatusReceiverBase.slavePaused</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.base.StatusReceiverBase.workerPaused</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.base.StatusReceiverBase.slaveUnpaused</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.base.StatusReceiverBase.workerUnpaused</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IStatus.getSlaveNames</span></code> with all implementations</td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IStatus.getWorkerNames</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IStatus.getSlave</span></code> with all implementations</td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IStatus.getWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IBuildStatus.getSlavename</span></code> with all implementations</td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IBuildStatus.getWorkername</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.build.BuildStatus.setSlavename</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.build.BuildStatus.setWorkername</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.status.build.BuildStatus.slavename</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.status.build.BuildStatus.workername</span></code> (also it was moved from class static attribute to instance attribute)</td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IBuilderStatus.getSlaves</span></code> with all implementations</td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.interfaces.IBuilderStatus.getWorkers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.status.builder.BuilderStatus.slavenames</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.status.builder.BuilderStatus.workernames</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.builder.BuilderStatus.setSlavenames</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.builder.BuilderStatus.setWorkernames</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.botmaster.BotMaster.slaveLost</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.botmaster.BotMaster.workerLost</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.botmaster.BotMaster.getBuildersForSlave</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.botmaster.BotMaster.getBuildersForWorker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.botmaster.BotMaster.maybeStartBuildsForSlave</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.botmaster.BotMaster.maybeStartBuildsForWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.RealSlaveLock</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.locks.RealWorkerLock</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.locks.RealSlaveLock.maxCountForSlave</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.locks.RealWorkerLock.maxCountForWorker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.protocols.base.Connection</span></code> constructor positional argument <code class="docutils literal notranslate"><span class="pre">buildslave</span></code> was renamed</td>
<td><code class="docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.protocols.base.Connection.buidslave</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.protocols.base.Connection.worker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.protocols.base.Connection.remoteGetSlaveInfo</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.protocols.base.Connection.remoteGetWorkerInfo</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.protocols.pb.Connection</span></code> constructor positional argument <code class="docutils literal notranslate"><span class="pre">buildslave</span></code> was renamed</td>
<td><code class="docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
</tbody>
</table>
<p>Other changes done without providing fallback:</p>
<ul>
<li><p class="first">Functions argument <code class="docutils literal notranslate"><span class="pre">buildslaveName</span></code> renamed to <code class="docutils literal notranslate"><span class="pre">workerName</span></code>.</p>
</li>
<li><p class="first">Loop variables, local variables, helper functions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">s</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">w</span></code> or <code class="docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">sl</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">w</span></code> or <code class="docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">bs</span></code> (“buildslave”)</td>
<td><code class="docutils literal notranslate"><span class="pre">w</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">sb</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">wfb</span></code> (“worker for builder”)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">bs1()</span></code>, <code class="docutils literal notranslate"><span class="pre">bs2()</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">w1()</span></code>, <code class="docutils literal notranslate"><span class="pre">w2()</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">bslave</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">BS1_NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">BS1_ID</span></code>, <code class="docutils literal notranslate"><span class="pre">BS1_INFO</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">W1_NAME</span></code>, <code class="docutils literal notranslate"><span class="pre">W1_ID</span></code>, <code class="docutils literal notranslate"><span class="pre">W1_INFO</span></code></td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">In <code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.config.BuilderConfig.getConfigDict</span></code> result <code class="docutils literal notranslate"><span class="pre">'slavenames'</span></code> key changed to <code class="docutils literal notranslate"><span class="pre">'workernames'</span></code>; <code class="docutils literal notranslate"><span class="pre">'slavebuilddir'</span></code> key changed to <code class="docutils literal notranslate"><span class="pre">'workerbuilddir'</span></code>; <code class="docutils literal notranslate"><span class="pre">'nextSlave'</span></code> key changed to <code class="docutils literal notranslate"><span class="pre">'nextWorker'</span></code>.</p>
</li>
<li><p class="first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.builder.BuilderControl.ping</span></code> now generates <code class="docutils literal notranslate"><span class="pre">[&quot;ping&quot;,</span> <span class="pre">&quot;no</span> <span class="pre">worker&quot;]</span></code> event, instead of <code class="docutils literal notranslate"><span class="pre">[&quot;ping&quot;,</span> <span class="pre">&quot;no</span> <span class="pre">slave&quot;]</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.plugins.util.WorkerChoiceParameter</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BuildslaveChoiceParameter</span></code>) label was changed from <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">slave</span></code> to <code class="docutils literal notranslate"><span class="pre">Worker</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.plugins.util.WorkerChoiceParameter</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BuildslaveChoiceParameter</span></code>) default name was changed from <code class="docutils literal notranslate"><span class="pre">slavename</span></code> to <code class="docutils literal notranslate"><span class="pre">workername</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.status.builder.SlaveStatus</span></code> fallback was removed.
<code class="docutils literal notranslate"><span class="pre">SlaveStatus</span></code> was moved to <code class="docutils literal notranslate"><span class="pre">buildbot.status.builder.slave</span></code> previously, and now it’s <code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.status.worker.WorkerStatus</span></code>.</p>
</li>
<li><p class="first"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.status.status_push.StatusPush</span></code> events generation changed (this module will be completely removed in 0.9.x):</p>
<ul class="simple">
<li>instead of <code class="docutils literal notranslate"><span class="pre">slaveConnected</span></code> with data <code class="docutils literal notranslate"><span class="pre">slave=...</span></code> now generated <code class="docutils literal notranslate"><span class="pre">workerConnected</span></code> event with data <code class="docutils literal notranslate"><span class="pre">worker=...</span></code>;</li>
<li>instead of <code class="docutils literal notranslate"><span class="pre">slaveDisconnected</span></code> with data <code class="docutils literal notranslate"><span class="pre">slavename=...</span></code> now generated <code class="docutils literal notranslate"><span class="pre">workerDisconnected</span></code> with data <code class="docutils literal notranslate"><span class="pre">workername=...</span></code>;</li>
<li>instead of <code class="docutils literal notranslate"><span class="pre">slavePaused</span></code> with data <code class="docutils literal notranslate"><span class="pre">slavename=...</span></code> now generated <code class="docutils literal notranslate"><span class="pre">workerPaused</span></code> event with data <code class="docutils literal notranslate"><span class="pre">workername=...</span></code>;</li>
<li>instead of <code class="docutils literal notranslate"><span class="pre">slaveUnpaused</span></code> with data <code class="docutils literal notranslate"><span class="pre">slavename=...</span></code> now generated <code class="docutils literal notranslate"><span class="pre">workerUnpaused</span></code> event with data <code class="docutils literal notranslate"><span class="pre">workername=...</span></code>;</li>
</ul>
</li>
<li><p class="first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.build.BuildStatus.asDict</span></code> returns worker name under <code class="docutils literal notranslate"><span class="pre">'worker'</span></code> key, instead of <code class="docutils literal notranslate"><span class="pre">'slave'</span></code> key.</p>
</li>
<li><p class="first"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.status.builder.BuilderStatus.asDict</span></code> returns worker names under <code class="docutils literal notranslate"><span class="pre">'workers'</span></code> key, instead of <code class="docutils literal notranslate"><span class="pre">'slaves'</span></code> key.</p>
</li>
<li><p class="first">Definitely privately used “slave”-named variables and attributes were renamed, including tests modules, classes and methods.</p>
</li>
</ul>
<div class="section" id="database">
<h5>5.8.3.1. Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h5>
<p>Database API changes done without providing fallback.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.getBuildslaves</span></code> (rewritten in nine) and <code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.getBuildslave</span></code> (introduced in nine) results uses instead of <code class="docutils literal notranslate"><span class="pre">'slaveinfo'</span></code> key</td>
<td><code class="docutils literal notranslate"><span class="pre">'workerinfo'</span></code> key</td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.db.model.Model.buildslaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.db.model.Model.workers</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.db.model.Model.configured_buildslaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.db.model.Model.configured_workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.db.model.Model.connected_buildslaves</span></code></td>
<td><code class="xref py py-attr docutils literal notranslate"><span class="pre">buildbot.db.model.Model.connected_workers</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.findBuildslaveId</span></code> (introduced in nine)</td>
<td><a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent.findWorkerId" title="buildbot.db.workers.WorkersConnectorComponent.findWorkerId"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.workers.WorkersConnectorComponent.findWorkerId</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.deconfigureAllBuidslavesForMaster</span></code> (introduced in nine, note typo <code class="docutils literal notranslate"><span class="pre">Buidslaves</span></code>)</td>
<td><a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent.deconfigureAllWorkersForMaster" title="buildbot.db.workers.WorkersConnectorComponent.deconfigureAllWorkersForMaster"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.workers.WorkersConnectorComponent.deconfigureAllWorkersForMaster</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.buildslaveConfigured</span></code> (introduced in nine)</td>
<td><a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent.workerConfigured" title="buildbot.db.workers.WorkersConnectorComponent.workerConfigured"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.workers.WorkersConnectorComponent.workerConfigured</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.buildslaveConfigured</span></code> method argument <code class="docutils literal notranslate"><span class="pre">buildslaveid</span></code> was renamed (introduced in nine)</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.getBuildslave</span></code></td>
<td><a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent.getWorker" title="buildbot.db.workers.WorkersConnectorComponent.getWorker"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.workers.WorkersConnectorComponent.getWorker</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.getBuildslaves</span></code> method argument <code class="docutils literal notranslate"><span class="pre">_buildslaveid</span></code> was renamed (introduced in nine)</td>
<td><code class="docutils literal notranslate"><span class="pre">_workerid</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.buildslaveConnected</span></code> (introduced in nine)</td>
<td><a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent.workerConnected" title="buildbot.db.workers.WorkersConnectorComponent.workerConnected"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.workers.WorkersConnectorComponent.workerConnected</span></code></a></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.buildslaveConnected</span></code> method argument <code class="docutils literal notranslate"><span class="pre">slaveinfo</span></code> was renamed (introduced in nine)</td>
<td><code class="docutils literal notranslate"><span class="pre">workerinfo</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.buildslaveConnected</span></code> method argument <code class="docutils literal notranslate"><span class="pre">buildslaveid</span></code> was renamed (introduced in nine)</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.buildslaveDisconnected</span></code> (introduced in nine)</td>
<td><a class="reference internal" href="#buildbot.db.workers.WorkersConnectorComponent.workerDisconnected" title="buildbot.db.workers.WorkersConnectorComponent.workerDisconnected"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.workers.WorkersConnectorComponent.workerDisconnected</span></code></a></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.buildslaves.BuildslavesConnectorComponent.buildslaveDisconnected</span></code> method argument <code class="docutils literal notranslate"><span class="pre">buildslaveid</span></code> was renamed (introduced in nine)</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#buildbot.db.builds.BuildsConnectorComponent.getBuilds" title="buildbot.db.builds.BuildsConnectorComponent.getBuilds"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.builds.BuildsConnectorComponent.getBuilds</span></code></a> method argument <code class="docutils literal notranslate"><span class="pre">buildslaveid</span></code> was renamed (introduced in nine)</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#buildbot.db.builds.BuildsConnectorComponent.addBuild" title="buildbot.db.builds.BuildsConnectorComponent.addBuild"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.builds.BuildsConnectorComponent.addBuild</span></code></a> method argument <code class="docutils literal notranslate"><span class="pre">buildslaveid</span></code> was renamed (introduced in nine)</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.reporters.message.MessageFormatter</span></code> template variable <code class="docutils literal notranslate"><span class="pre">slavename</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">workername</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="data-api">
<h5>5.8.3.2. Data API<a class="headerlink" href="#data-api" title="Permalink to this headline">¶</a></h5>
<p>Python API changes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.data.buildslaves</span></code></td>
<td><code class="xref py py-mod docutils literal notranslate"><span class="pre">workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.data.buildslaves.BuildslaveEndpoint</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkerEndpoint</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.data.buildslaves.BuildslavesEndpoint</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">WorkersEndpoint</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.data.buildslaves.Buildslave</span></code></td>
<td><code class="xref py py-class docutils literal notranslate"><span class="pre">Worker</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.data.buildslaves.Buildslave.buildslaveConfigured</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">workerConfigured</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.data.buildslaves.Buildslave.findBuildslaveId</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">findWorkerId</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.data.buildslaves.Buildslave.buildslaveConnected</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">workerConnected</span></code></td>
</tr>
<tr class="row-odd"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.data.buildslaves.Buildslave.buildslaveDisconnected</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">workerDisconnected</span></code></td>
</tr>
<tr class="row-even"><td><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.data.buildslaves.Buildslave.deconfigureAllBuidslavesForMaster</span></code></td>
<td><code class="xref py py-meth docutils literal notranslate"><span class="pre">deconfigureAllWorkersForMaster</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">buildslaveid</span></code> in function arguments and API specification</td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">slaveinfo</span></code> in function arguments and API specification</td>
<td><code class="docutils literal notranslate"><span class="pre">workerinfo</span></code></td>
</tr>
</tbody>
</table>
<p>Changed REST endpoints:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/buildslaves</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/buildslaves/n:buildslaveid</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/workers/n:workerid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/buildslaves/n:buildslaveid/builds</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/workers/n:workerid/builds</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/buildslaves/:buildslaveid/builds/:buildid</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/workers/:workerid/builds/:buildid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/masters/n:masterid/buildslaves</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/masters/n:masterid/workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/masters/n:masterid/buildslaves/n:buildslaveid</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/masters/n:masterid/workers/n:workerid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/masters/n:masterid/builders/n:builderid/buildslaves</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/masters/n:masterid/builders/n:builderid/workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/masters/n:masterid/builders/n:builderid/buildslaves/n:buildslaveid</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/masters/n:masterid/builders/n:builderid/workers/n:workerid</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">/builders/n:builderid/buildslaves</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/builders/n:builderid/workers</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">/builders/n:builderid/buildslaves/n:buildslaveid</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">/builders/n:builderid/workers/n:workerid</span></code></td>
</tr>
</tbody>
</table>
<p>Changed REST object keys:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old name</th>
<th class="head">New name</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">buildslaveid</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">workerid</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">slaveinfo</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">workerinfo</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">buildslave</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">worker</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">buildslaves</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">workers</span></code></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">data_module</span></code> version bumped from <code class="docutils literal notranslate"><span class="pre">1.2.0</span></code> to <code class="docutils literal notranslate"><span class="pre">2.0.0</span></code>.</p>
</div>
<div class="section" id="web-ui">
<h5>5.8.3.3. Web UI<a class="headerlink" href="#web-ui" title="Permalink to this headline">¶</a></h5>
<p>In base web UI (<code class="docutils literal notranslate"><span class="pre">www/base</span></code>) and Material Design web UI (<code class="docutils literal notranslate"><span class="pre">www/md_base</span></code>) all “slave”-named messages and identifiers were renamed to use “worker” names and new REST API endpoints.</p>
</div>
<div class="section" id="mq-layer">
<h5>5.8.3.4. MQ layer<a class="headerlink" href="#mq-layer" title="Permalink to this headline">¶</a></h5>
<p><code class="docutils literal notranslate"><span class="pre">buildslaveid</span></code> key in messages were replaced with <code class="docutils literal notranslate"><span class="pre">workerid</span></code>.</p>
</div>
</div>
<div class="section" id="details">
<h4>5.8.4. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b7..v0.9.0b8
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0b7"></span><div class="section" id="release-notes-for-buildbot-0-9-0b7">
<h3>5.9. Release Notes for Buildbot 0.9.0b7<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b7" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b7
This version was released on February 14, 2016.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.9.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.9.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="fixes">
<h5>5.9.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fix incompatibility with MySQL-5.7 (<a class="reference external" href="http://trac.buildbot.net/ticket/3421">bug #3421</a>)</li>
<li>Fix incompatibility with postgresql driver psycopg2 (<a class="reference external" href="http://trac.buildbot.net/ticket/3419">bug #3419</a>, further regressions will be caught by travis)</li>
<li>Fix regressions in forcescheduler UI (<a class="reference external" href="http://trac.buildbot.net/ticket/3416">bug #3416</a>, <a class="reference external" href="http://trac.buildbot.net/ticket/3418">bug #3418</a>, <a class="reference external" href="http://trac.buildbot.net/ticket/3422">bug #3422</a>)</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.9.1.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> Python dist now (finally) requires SQLAlchemy-0.8.0 or later and SQLAlchemy-Migrate-0.9.0 or later.
While the old pinned versions (0.7.10 and 0.7.2, respectively) still work, this compatibility is no longer tested and this configuration should be considered deprecated.</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.9.1.4. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="slave">
<h4>5.9.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.9.2.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id2">
<h5>5.9.2.2. Fixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id3">
<h5>5.9.2.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="details">
<h4>5.9.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b6..v0.9.0b7
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0b6"></span><div class="section" id="release-notes-for-buildbot-0-9-0b6">
<h3>5.10. Release Notes for Buildbot 0.9.0b6<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b6" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b6
This version was released on January 20, 2016.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.10.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.10.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Builders ui page has improved tag filtering capabilities</li>
<li>Home page enhanced with the list of recent builds sorted by builder</li>
<li><a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> reporter has been partially ported to work on data api.</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.10.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>better stability and reliability in the UI thanks to switch to buildbot data-module</li>
<li>fix irc</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.10.1.3. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>properties object is now directly present in build, and not in build_status.
This should not change much unless you try to access your properties via step.build.build_status.
Remember that with PropertiesMixin, you can access properties via getProperties on the steps, and on the builds objects.</li>
<li><a class="reference internal" href="#www-data-module"><span class="std std-ref">Javascript Data Module</span></a> is now integrated, which sets a definitive API for accessing buildbot data in angularJS UI.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.10.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.10.2.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentBuildSlave</span></code> image attribute is now renderable (can take properties in account).</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentBuildSlave</span></code> sets environment variables describing how to connect to the master.
Example dockerfiles can be found in <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/docker">master/contrib/docker</a>.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.10.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b5..v0.9.0b6
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0b5"></span><div class="section" id="release-notes-for-buildbot-0-9-0b5">
<h3>5.11. Release Notes for Buildbot 0.9.0b5<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b5" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b5.
This version was released on October 21, 2015.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.11.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<p>This version addresses <a class="reference external" href="http://trac.buildbot.net/wiki/SecurityAlert090b4">http://trac.buildbot.net/wiki/SecurityAlert090b4</a> by preventing dissemination of hook information via the web UI.</p>
<p>This also reverts the addition of the frontend data service in 0.9.0b4, as that contained many bugs.
It will be re-landed in a subsequent release.</p>
</div>
<div class="section" id="slave">
<h4>5.11.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<p>No changes.</p>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b4..0.9.0b5
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0b4"></span><div class="section" id="release-notes-for-buildbot-0-9-0b4">
<h3>5.12. Release Notes for Buildbot 0.9.0b4<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b4" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b4
This version was released on October 20, 2015.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.12.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<p>This version is very similar to 0.9.0b3, re-released due to issues with PyPI uploads.</p>
<div class="section" id="changes-for-developers">
<h5>5.12.1.1. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The data API’s <code class="docutils literal notranslate"><span class="pre">startConsuming</span></code> method has been removed.
Instead of calling this method with a data API path, call <code class="docutils literal notranslate"><span class="pre">self.master.mq.startConsuming</span></code> with an appropriate message routing pattern.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.12.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<p>No changes since 0.9.0b3.</p>
</div>
<div class="section" id="details">
<h4>5.12.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b3..v0.9.0b4
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0b3"></span><div class="section" id="release-notes-for-buildbot-0-9-0b3">
<h3>5.13. Release Notes for Buildbot 0.9.0b3<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b3" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b3.
This version was released on October 18, 2015.</p>
<p>See <a class="reference internal" href="#upgrading-to-nine"><span class="std std-ref">Upgrading to Nine</span></a> for a guide to upgrading from 0.8.x to 0.9.x</p>
<div class="section" id="master">
<h4>5.13.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.13.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The irc command <code class="docutils literal notranslate"><span class="pre">hello</span></code> now returns ‘Hello’ in a random language if invoked more than once.</li>
<li><a class="reference internal" href="#sched-Triggerable" title="Triggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Triggerable</span></code></a> now accepts a <code class="docutils literal notranslate"><span class="pre">reason</span></code> parameter.</li>
<li><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> now accepts a <code class="docutils literal notranslate"><span class="pre">builders</span></code> parameter.</li>
<li><cite>StatusPush</cite> callback now receives build results (success/failure/etc) with the <code class="docutils literal notranslate"><span class="pre">buildFinished</span></code> event.</li>
<li>There’s a new renderable type, <a class="reference internal" href="#transform"><span class="std std-ref">Transform</span></a>.</li>
<li>Buildbot now supports wamp as a mq backend.
This allows to run a multi-master configuration.
See <a class="reference internal" href="#mq-specification"><span class="std std-ref">MQ Specification</span></a>.</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.13.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <a class="reference internal" href="#step-PyFlakes" title="PyFlakes"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">PyFlakes</span></code></a> and <a class="reference internal" href="#step-PyLint" title="PyLint"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">PyLint</span></code></a> steps no longer parse output in Buildbot log headers (<a class="reference external" href="http://trac.buildbot.net/ticket/3337">bug #3337</a>).</li>
<li><a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GerritChangeSource</span></code></a> is now less verbose by default, and has a <code class="docutils literal notranslate"><span class="pre">debug</span></code> option to enable the logs.</li>
<li><a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a> no longer relies on the perforce server time to poll for new changes.</li>
<li>The commit message for a change from <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a> now matches what the user typed in.</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.13.1.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.status.results</span></code> module no longer exists and has been renamed to <a class="reference internal" href="#module-buildbot.process.results" title="buildbot.process.results"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.results</span></code></a>.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.13.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.13.2.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The Buildbot slave now includes the number of CPUs in the information it supplies to the master on connection.
This value is autodetected, but can be overridden with the <code class="docutils literal notranslate"><span class="pre">--numcpus</span></code> argument to <code class="docutils literal notranslate"><span class="pre">buildslave</span> <span class="pre">create-slave</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.13.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b2..v0.9.0b3
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0b2"></span><div class="section" id="release-notes-for-buildbot-0-9-0b2">
<h3>5.14. Release Notes for Buildbot 0.9.0b2<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b2" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b2.
Buildbot 0.9.0b2 was released on August, 2 2015.</p>
<div class="section" id="master">
<h4>5.14.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.14.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Mercurial hook was updated and modernized.
It is no longer necessary to fork.
One can now extend PYTHONPATH via the hook configuration.
Among others, it permits to use a buildbot virtualenv instead of installing buildbot in all the system.
Added documentation inside the hook.
Misc. clean-up and reorganization in order to make the code a bit more readable.</li>
<li>UI templates can now be customizable.
You can provide html or jade overrides to the www plugins, to customize the UI</li>
<li>UI side bar is now fixed by default for large screens.</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.14.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fix setup for missing www.hooks module</li>
<li>Fix setup to install only on recents version of pip (&gt;=1.4).
This prevents unexpected upgrade to nine from people who just use <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-U</span> <span class="pre">buildbot</span></code></li>
<li>Fix a crash in the git hook.</li>
<li>Add checks to enforce slavenames are identifiers.</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.14.1.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="changes-for-developers">
<h5>5.14.1.4. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <a class="reference internal" href="#buildbot.config.BuilderConfig" title="buildbot.config.BuilderConfig"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuilderConfig</span></code></a> <code class="docutils literal notranslate"><span class="pre">nextSlave</span></code> keyword argument takes a callable.
This callable now receives <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> instance in its signature as 3rd parameter.
<strong>For retro-compatibility, all callable taking only 2 parameters will still work</strong>.</li>
<li>Data api provides a way to query the build list per slave.</li>
<li>Data api provides a way to query some build properties in a build list.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.14.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> now requires Python 2.6</li>
</ul>
<div class="section" id="id1">
<h5>5.14.2.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Schedulers: the <code class="docutils literal notranslate"><span class="pre">codebases</span></code> parameter can now be specified in a simple list-of-strings form.</li>
</ul>
</div>
<div class="section" id="id2">
<h5>5.14.2.2. Fixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fix two race conditions in the integration tests</li>
</ul>
</div>
<div class="section" id="id3">
<h5>5.14.2.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Providing Latent AWS EC2 credentials by the <code class="file docutils literal notranslate"><span class="pre">.ec2/aws_id</span></code> file is deprecated:
Use the standard <code class="file docutils literal notranslate"><span class="pre">.aws/credentials</span></code> file, instead.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.14.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.9.0b1..v0.9.0b2
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.9.0b1"></span><div class="section" id="release-notes-for-buildbot-0-9-0b1">
<h3>5.15. Release Notes for Buildbot 0.9.0b1<a class="headerlink" href="#release-notes-for-buildbot-0-9-0b1" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.9.0b1.
Buildbot 0.9.0b1 was released on the 25th of June, 2015.</p>
<div class="section" id="master">
<h4>5.15.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<p>This version represents a refactoring of Buildbot into a consistent, well-defined application composed of loosely coupled components.
The components are linked by a common database backend and a messaging system.
This allows components to be distributed across multiple build masters.
It also allows the rendering of complex web status views to be performed in the browser, rather than on the buildmasters.</p>
<p>The branch looks forward to committing to long-term API compatibility, but does not reach that goal.
The Buildbot-0.9.x series of releases will give the new APIs time to “settle in” before we commit to them.
Commitment will wait for Buildbot-1.0.0 (as per <a class="reference external" href="http://semver.org">http://semver.org</a>).
Once Buildbot reaches version 1.0.0, upgrades will become much easier for users.</p>
<p>To encourage contributions from a wider field of developers, the web application is designed to look like a normal AngularJS application.
Developers familiar with AngularJS, but not with Python, should be able to start hacking on the web application quickly.
The web application is “pluggable”, so users who develop their own status displays can package those separately from Buildbot itself.</p>
<p>Other goals:</p>
<blockquote>
<div><ul class="simple">
<li>An approachable HTTP REST API, used by the web application but available for any other purpose.</li>
<li>A high degree of coverage by reliable, easily-modified tests.</li>
<li>“Interlocking” tests to guarantee compatibility.
For example, the real and fake DB implementations must both pass the same suite of tests.
Then no unseen difference between the fake and real implementations can mask errors that will occur in production.</li>
</ul>
</div></blockquote>
<div class="section" id="requirements">
<h5>5.15.1.1. Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h5>
<p>The <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> package requires Python 2.6 or higher – Python 2.5 is no longer supported.
The <code class="docutils literal notranslate"><span class="pre">buildbot-slave</span></code> package requires Python 2.5 or higher – Python 2.4 is no longer supported.</p>
<p>No additional software or systems, aside from some minor Python packages, are required.</p>
<p>But the devil is in the details:</p>
<blockquote>
<div><ul class="simple">
<li>If you want to do web <em>development</em>, or <em>build</em> the <code class="docutils literal notranslate"><span class="pre">buildbot-www</span></code> package, you’ll need Node.
It’s an Angular app, and that’s how such apps are developed.
We’ve taken pains to not make either a requirement for users - you can simply ‘pip install’ <code class="docutils literal notranslate"><span class="pre">buildbot-www</span></code> and be on your way.
This is the case even if you’re hacking on the Python side of Buildbot.</li>
<li>For a single master, nothing else is required.</li>
</ul>
</div></blockquote>
<div class="section" id="minor-python-packages">
<h6>Minor Python Packages<a class="headerlink" href="#minor-python-packages" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Buildbot requires at least Twisted-11.0.0.</li>
<li>Buildbot works python-dateutil &gt;= 1.5</li>
</ul>
</div>
</div>
<div class="section" id="known-limitations-of-0-9-0b1">
<h5>5.15.1.2. Known Limitations of 0.9.0b1<a class="headerlink" href="#known-limitations-of-0-9-0b1" title="Permalink to this headline">¶</a></h5>
<p>The following feature will be implemented for Buildbot 0.9.1 Milestone.</p>
<ul class="simple">
<li>Multimaster is not supported as of Buildbot 0.9.0. <a class="reference external" href="http://trac.buildbot.net/ticket/2644">http://trac.buildbot.net/ticket/2644</a></li>
<li>Not all status plugin are converted to the new reporter API.
Only email and Gerrit reporters are fully supported.
Irc support is limited, and not converted to reporter api
<a class="reference external" href="http://trac.buildbot.net/ticket/2648">http://trac.buildbot.net/ticket/2648</a></li>
</ul>
</div>
<div class="section" id="features">
<h5>5.15.1.3. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<p>Buildbot-0.9.0 introduces the <a class="reference internal" href="#data-api"><span class="std std-ref">Data API</span></a>, a consistent and scalable method for accessing and updating the state of the Buildbot system.
This API replaces the existing, ill-defined Status API, which has been removed.
Buildbot-0.9.0 introduces new <a class="reference internal" href="#www"><span class="std std-ref">WWW Server</span></a> Interface using websocket for realtime updates.
Buildbot code that interacted with the Status API (a substantial portion!) has been rewritten to use the Data API.
Individual features and improvements to the Data API are not described on this page.</p>
<ul>
<li><p class="first">Buildbot now supports plugins.
They allow Buildbot to be extended by using components distributed independently from the main code.
They also provide for a unified way to access all components.
When previously the following construction was used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.kind.other.bits</span> <span class="k">import</span> <span class="n">ComponentClass</span>

<span class="o">...</span> <span class="n">ComponentClass</span> <span class="o">...</span>
</pre></div>
</div>
<p>the following construction achieves the same result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">kind</span>

<span class="o">...</span> <span class="n">kind</span><span class="o">.</span><span class="n">ComponentClass</span> <span class="o">...</span>
</pre></div>
</div>
<p>Kinds of components that are available this way are described in <a class="reference internal" href="#document-manual/plugins"><span class="doc">Plugin Infrastructure in Buildbot</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While the components can be still directly imported as <code class="docutils literal notranslate"><span class="pre">buildbot.kind.other.bits</span></code>, this might not be the case after Buildbot v1.0 is released.</p>
</div>
</li>
<li><p class="first">Both the P4 source step and P4 change source support ticket-based authentication.</p>
</li>
<li><p class="first">OpenStack latent slaves now support block devices as a bootable volume.</p>
</li>
<li><p class="first">Add new <a class="reference internal" href="#step-Cppcheck" title="Cppcheck"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Cppcheck</span></code></a> step.</p>
</li>
<li><p class="first">Add a new <a class="reference internal" href="#document-manual/configuration/workers-docker"><span class="doc">Docker latent BuildSlave</span></a>.</p>
</li>
<li><p class="first">Add a new configuration for creating custom services in out-of-tree CI systems or plugins. See <a class="reference internal" href="#buildbot.util.service.BuildbotService" title="buildbot.util.service.BuildbotService"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.util.service.BuildbotService</span></code></a></p>
</li>
<li><p class="first">Add <code class="docutils literal notranslate"><span class="pre">try_ssh</span></code> configuration file setting and <code class="docutils literal notranslate"><span class="pre">--ssh</span></code> command line option for the try tool to specify the command to use for connecting to the build master.</p>
</li>
<li><p class="first">GitHub change hook now supports application/json format.</p>
</li>
<li><p class="first">Add support for dynamically adding steps during a build. See <a class="reference internal" href="#dynamicbuildfactories"><span class="std std-ref">Dynamic Build Factories</span></a>.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> now supports detecting new branches</p>
</li>
<li><p class="first"><a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> supports an “origin” option to give a name to the remote repo.</p>
</li>
</ul>
</div>
<div class="section" id="reporters">
<h5>5.15.1.4. Reporters<a class="headerlink" href="#reporters" title="Permalink to this headline">¶</a></h5>
<p>Status plugins have been moved into the <code class="docutils literal notranslate"><span class="pre">reporters</span></code> namespace.
Their API has slightly to changed in order to adapt to the new data API.
See respective documentation for details.</p>
<ul>
<li><p class="first"><a class="reference internal" href="#buildbot.status.status_gerrit.GerritStatusPush" title="buildbot.status.status_gerrit.GerritStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> renamed to <code class="xref py py-class docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> renamed to <a class="reference internal" href="#buildbot.reporters.mail.MailNotifier" title="buildbot.reporters.mail.MailNotifier"><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code></a></p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> argument <code class="docutils literal notranslate"><span class="pre">messageFormatter</span></code> should now be a <code class="xref py py-class docutils literal notranslate"><span class="pre">MessageFormatter</span></code>, due to removal of data api, custom message formatters need to be rewritten.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">MailNotifier</span></code> argument <code class="docutils literal notranslate"><span class="pre">previousBuildGetter</span></code> is not supported anymore</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">Gerrit</span></code> supports specifying an SSH identity file explicitly.</p>
</li>
<li><p class="first">Added StashStatusPush status hook for Atlassian Stash</p>
</li>
<li><p class="first"><a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> no longer forces SSL 3.0 when <code class="docutils literal notranslate"><span class="pre">useTls</span></code> is true.</p>
</li>
<li><p class="first"><a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> callbacks slightly changed signature, and include a master reference instead of a status reference.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">GitHubStatus</span></code> now accepts a <code class="docutils literal notranslate"><span class="pre">context</span></code> parameter to be passed to the GitHub Status API.</p>
</li>
<li><p class="first">Buildbot UI introduces branch new Authentication, and Authorizations framework.</p>
<blockquote>
<div><p>Please look at their respective guide in <a class="reference internal" href="#www"><span class="std std-ref">WWW Server</span></a></p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.15.1.5. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Buildbot is now compatible with SQLAlchemy 0.8 and higher, using the newly-released SQLAlchemy-Migrate.</p>
</li>
<li><p class="first">The version check for SQLAlchemy-Migrate was fixed to accept more version string formats.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-HTTPStep" title="HTTPStep"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">HTTPStep</span></code></a> step’s request parameters are now renderable.</p>
</li>
<li><p class="first">With Git(), force the updating submodules to ensure local changes by the
build are overwritten. This both ensures more consistent builds and avoids
errors when updating submodules.</p>
</li>
<li><p class="first">Buildbot is now compatible with Gerrit v2.6 and higher.</p>
<p>To make this happen, the return result of <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> and <code class="docutils literal notranslate"><span class="pre">summaryCB</span></code>
callback has changed from</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">verified</span><span class="p">,</span> <span class="n">review</span><span class="p">)</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
 <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label-name&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
           <span class="o">...</span>
           <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The implications are:</p>
<ul class="simple">
<li>there are some differences in behaviour: only those labels that were
provided will be updated</li>
<li>Gerrit server must be able to provide a version, if it can’t the
<a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> will not work</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have an old style <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> and/or <code class="docutils literal notranslate"><span class="pre">summaryCB</span></code> implemented,
these will still work, however there could be more labels updated than
anticipated.</p>
</div>
<p>More detailed information is available in <a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a>
section.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a>’s <code class="docutils literal notranslate"><span class="pre">server_tz</span></code> parameter now works correctly.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">revlink</span></code> in changes produced by the Bitbucket hook now correctly includes the <code class="docutils literal notranslate"><span class="pre">changes/</span></code> portion of the URL.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">PBChangeSource</span></code></a>’s git hook <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/git_buildbot.py">master/contrib/git_buildbot.py</a> now supports git tags</p>
<p>A pushed git tag generates a change event with the <code class="docutils literal notranslate"><span class="pre">branch</span></code> property equal to the tag name.
To schedule builds based on buildbot tags, one could use something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
   <span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tags&#39;</span><span class="p">,</span>
      <span class="n">change_filter</span><span class="o">=</span><span class="nb">filter</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span>
         <span class="n">branch_re</span><span class="o">=</span><span class="s1">&#39;v[0-9]+\.[0-9]+\.[0-9]+(?:-pre|rc[0-9]+|p[0-9]+)?&#39;</span><span class="p">)</span>
      <span class="n">treeStableTimer</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
      <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tag_build&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</li>
<li><p class="first">Missing “name” and “email” properties received from Gerrit are now handled properly</p>
</li>
<li><p class="first">Fixed bug which made it impossible to specify the project when using the
BitBucket dialect.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-PyLint" title="PyLint"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">PyLint</span></code></a> step has been updated to understand newer output.</p>
</li>
<li><p class="first">Fixed SVN master-side source step: if a SVN operation fails, the repository end up in a situation when a manual intervention is required.
Now if SVN reports such a situation during initial check, the checkout will be clobbered.</p>
</li>
<li><p class="first">The build properties are now stored in the database in the <code class="docutils literal notranslate"><span class="pre">build_properties</span></code> table.</p>
</li>
<li><p class="first">The list of changes in the build page now displays all the changes since the last successful build.</p>
</li>
<li><p class="first">GitHub change hook now correctly responds to ping events.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot.steps.http</span></code> steps now correctly have <code class="docutils literal notranslate"><span class="pre">url</span></code> parameter renderable</p>
</li>
<li><p class="first">When no arguments are used <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">checkconfig</span></code> now uses <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code> to locate the master config file.</p>
</li>
<li><p class="first"><cite>buildbot.util.flatten</cite> now correctly flattens arbitrarily nested lists.
<cite>buildbot.util.flattened_iterator</cite> provides an iterable over the collection which may be more efficient for extremely large lists.</p>
</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.15.1.6. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><cite>BonsaiPoller</cite> is removed.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot.ec2buildslave</span></code> is removed; use <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.ec2</span></code> instead.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot.libvirtbuildslave</span></code> is removed; use <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.libvirt</span></code> instead.</li>
</ul>
<ul class="simple">
<li><cite>buildbot.util.flatten</cite> flattens lists and tuples by default (previously only lists).
Additionally, flattening something that isn’t the type to flatten has different behaviour.
Previously, it would return the original value.
Instead, it now returns an array with the original value as the sole element.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot.tac</span></code> does not support <code class="docutils literal notranslate"><span class="pre">print</span></code> statements anymore. Such files should now use <code class="docutils literal notranslate"><span class="pre">print</span></code>
as a function instead (see <a class="reference external" href="https://docs.python.org/3.0/whatsnew/3.0.html#print-is-a-function">https://docs.python.org/3.0/whatsnew/3.0.html#print-is-a-function</a>
for more details). Note that this applies to both python2.x and python3.x runtimes.</li>
</ul>
<div class="section" id="webstatus">
<h6>WebStatus<a class="headerlink" href="#webstatus" title="Permalink to this headline">¶</a></h6>
<p>The old, clunky WebStatus has been removed.
You will like the new interface!
RIP WebStatus, you were a good friend.</p>
<p>remove it and replace it with <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span> <span class="pre">configuration</span></code></a>.</p>
</div>
<div class="section" id="id1">
<h6>Requirements<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>Buildbot’s tests now require at least Mock-0.8.0.</li>
<li>SQLAlchemy-Migrate-0.6.1 is no longer supported.</li>
<li>Builder names are now restricted to unicode strings or ASCII bytestrings.
Encoded bytestrings are not accepted.</li>
</ul>
</div>
<div class="section" id="steps">
<h6>Steps<a class="headerlink" href="#steps" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>New-style steps are now the norm, and support for old-style steps is deprecated.
Such support will be removed in the next release.<ul>
<li>Status strings for old-style steps could be supplied through a wide variety of conflicting means (<code class="docutils literal notranslate"><span class="pre">describe</span></code>, <code class="docutils literal notranslate"><span class="pre">description</span></code>, <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code>, <code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code>, <code class="docutils literal notranslate"><span class="pre">getText</span></code>, and <code class="docutils literal notranslate"><span class="pre">setText</span></code>, to name just a few).
While all attempts have been made to maintain compatibility, you may find that the status strings for old-style steps have changed in this version.
To fix steps that call <code class="docutils literal notranslate"><span class="pre">setText</span></code>, try setting the <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code> attribute directly, instead – or just rewrite the step in the new style.</li>
</ul>
</li>
<li>Old-style <em>source</em> steps (imported directly from <code class="docutils literal notranslate"><span class="pre">buildbot.steps.source</span></code>) are no longer supported on the master.</li>
<li>The monotone source step got an overhaul and can now better manage
its database (initialize and/or migrate it, if needed). In the
spirit of monotone, buildbot now always keeps the database around,
as it’s an append-only database.</li>
</ul>
</div>
<div class="section" id="changes-and-removals">
<h6>Changes and Removals<a class="headerlink" href="#changes-and-removals" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Buildslave names must now be 50-character <a class="reference internal" href="#type-identifier"><span class="std std-ref">identifier</span></a>.
Note that this disallows some common characters in bulidslave names, including spaces, <code class="docutils literal notranslate"><span class="pre">/</span></code>, and <code class="docutils literal notranslate"><span class="pre">.</span></code>.</p>
</li>
<li><p class="first">Builders now have “tags” instead of a category.
Builders can have multiple tags, allowing more flexible builder displays.</p>
</li>
<li><p class="first"><a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> has the following changes:</p>
<ul class="simple">
<li>The default configuration no longer contains four <code class="docutils literal notranslate"><span class="pre">AnyPropertyParameter</span></code> instances.</li>
<li>Configuring <code class="docutils literal notranslate"><span class="pre">codebases</span></code> is now mandatory, and the deprecated <code class="docutils literal notranslate"><span class="pre">branch</span></code>,  <code class="docutils literal notranslate"><span class="pre">repository</span></code>, <code class="docutils literal notranslate"><span class="pre">project</span></code>, <code class="docutils literal notranslate"><span class="pre">revision</span></code> are not supported anymore in <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a></li>
<li><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.schedulers.forcesched.BaseParameter.updateFromKwargs</span></code> now takes a <code class="docutils literal notranslate"><span class="pre">collector</span></code> parameter used to collect all validation errors</li>
</ul>
</li>
<li><p class="first"><a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a>, <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> and <a class="reference internal" href="#sched-NightlyTriggerable" title="NightlyTriggerable"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">NightlyTriggerable</span></code></a> have the following changes:</p>
<ul class="simple">
<li>The <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a> and <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> schedulers can now consume changes and use <code class="docutils literal notranslate"><span class="pre">onlyIfChanged</span></code> and <code class="docutils literal notranslate"><span class="pre">createAbsoluteTimestamps</span></code>.</li>
<li>All “timed” schedulers now handle <code class="docutils literal notranslate"><span class="pre">codebases</span></code> the same way. Configuring <code class="docutils literal notranslate"><span class="pre">codebases</span></code> is strongly recommended.
Using the <code class="docutils literal notranslate"><span class="pre">branch</span></code> parameter is discouraged.</li>
</ul>
</li>
<li><p class="first">Logs are now stored as Unicode strings, and thus must be decoded properly from the bytestrings provided by shell commands.
By default this encoding is assumed to be UTF-8, but the <a class="reference internal" href="#cfg-logEncoding" title="logEncoding"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">logEncoding</span></code></a> parameter can be used to select an alternative.
Steps and individual logfiles can also override the global default.</p>
</li>
<li><p class="first">The PB status service uses classes which have now been removed, and anyway is redundant to the REST API, so it has been removed.
It has taken the following with it:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">statuslog</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">statusgui</span></code> (the GTK client)</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">debugclient</span></code></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">PBListener</span></code> status listener is now deprecated and does nothing.
Accordingly, there is no external access to status objects via Perspective Broker, aside from some compatibility code for the try scheduler.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">debugPassword</span></code> configuration option is no longer needed and is thus deprecated.</p>
</li>
<li><p class="first">The undocumented and un-tested <code class="docutils literal notranslate"><span class="pre">TinderboxMailNotifier</span></code>, designed to send emails suitable for the abandoned and insecure Tinderbox tool, has been removed.</p>
</li>
<li><p class="first">Buildslave info is no longer available via <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> and the <code class="docutils literal notranslate"><span class="pre">SetSlaveInfo</span></code> buildstep has been removed.</p>
</li>
<li><p class="first">The undocumented <code class="docutils literal notranslate"><span class="pre">path</span></code> parameter of the <a class="reference internal" href="#step-MasterShellCommand" title="MasterShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MasterShellCommand</span></code></a> buildstep has been renamed <code class="docutils literal notranslate"><span class="pre">workdir</span></code> for better consistency with the other steps.</p>
</li>
<li><p class="first">The name and source of a Property have to be unicode or ascii string.</p>
</li>
<li><p class="first">Property values must be serializable in JSON.</p>
</li>
<li><p class="first"><a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> has the following changes:</p>
<ul class="simple">
<li>categories parameter is deprecated and removed. It should be replaced with tags=[cat]</li>
<li>noticeOnChannel parameter is deprecated and removed.</li>
</ul>
</li>
<li><p class="first">workdir behavior has been unified:</p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">workdir</span></code> attribute of steps is now a property in <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a>, and choose the workdir given following priority:</p>
<blockquote>
<div><ul class="simple">
<li>workdir of the step, if defined</li>
<li>workdir of the builder (itself defaults to ‘build’)</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>setDefaultWorkdir() has been deprecated, but is now behaving the same for all the steps: Setting self.workdir if not already set</li>
</ul>
</li>
</ul>
</li>
<li><p class="first"><a class="reference internal" href="#step-Trigger" title="Trigger"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Trigger</span></code></a> now has a <code class="docutils literal notranslate"><span class="pre">getSchedulersAndProperties</span></code> method that can ve overridden to support dynamic triggering.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">`master.cfg</span></code> is now parsed from a thread. Previously it was run in the main thread, and thus slowing down the master in case of big config, or network access done to generate the config.</p>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a>’s svnurl parameter has been changed to repourl.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="changes-for-developers">
<h5>5.15.1.7. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Botmaster no longer service parent for buildslaves. Service parent functionality has been transferred to BuildslaveManager.
It should be noted Botmaster no longer has a <code class="docutils literal notranslate"><span class="pre">slaves</span></code> field as it was moved to BuildslaveManager.</p>
</li>
<li><p class="first">The sourcestamp DB connector now returns a <code class="docutils literal notranslate"><span class="pre">patchid</span></code> field.</p>
</li>
<li><p class="first">Buildbot no longer polls the database for jobs.
The <code class="docutils literal notranslate"><span class="pre">db_poll_interval</span></code> configuration parameter and the <a class="reference internal" href="#cfg-db" title="db"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">db</span></code></a> key of the same name are deprecated and will be ignored.</p>
</li>
<li><p class="first">The interface for adding changes has changed.
The new method is <code class="docutils literal notranslate"><span class="pre">master.data.updates.addChange</span></code> (implemented by <code class="xref py py-meth docutils literal notranslate"><span class="pre">addChange</span></code>), although the old interface (<code class="docutils literal notranslate"><span class="pre">master.addChange</span></code>) will remain in place for a few versions.
The new method:</p>
<ul class="simple">
<li>returns a change ID, not a Change instance;</li>
<li>takes its <code class="docutils literal notranslate"><span class="pre">when_timestamp</span></code> argument as epoch time (UNIX time), not a datetime instance; and</li>
<li>does not accept the deprecated parameters <code class="docutils literal notranslate"><span class="pre">who</span></code>, <code class="docutils literal notranslate"><span class="pre">isdir</span></code>, <code class="docutils literal notranslate"><span class="pre">is_dir</span></code>, and <code class="docutils literal notranslate"><span class="pre">when</span></code>.</li>
<li>requires that all strings be unicode, not bytestrings.</li>
</ul>
<p>Please adjust any custom change sources accordingly.</p>
</li>
<li><p class="first">A new build status, CANCELLED, has been added.
It is used when a step or build is deliberately cancelled by a user.</p>
</li>
<li><p class="first">This upgrade will delete all rows from the <code class="docutils literal notranslate"><span class="pre">buildrequest_claims</span></code> table.
If you are using this table for analytical purposes outside of Buildbot, please back up its contents before the upgrade, and restore it afterward, translating object IDs to scheduler IDs if necessary.
This translation would be very slow and is not required for most users, so it is not done automatically.</p>
</li>
<li><p class="first">All of the schedulers DB API methods now accept a schedulerid, rather than an objectid.
If you have custom code using these methods, check your code and make the necessary adjustments.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStamp</span></code> method has become <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStamps</span></code>, and its signature has changed.
The <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStampSetDetails</span></code> method has become <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStampsWithDefaults</span></code>, and its signature has changed.
The <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStampDetails</span></code> method has been removed.
The <code class="docutils literal notranslate"><span class="pre">addBuildsetForLatest</span></code> method has been removed.
It is equivalent to <code class="docutils literal notranslate"><span class="pre">addBuildsetForSourceStampDetails</span></code> with <code class="docutils literal notranslate"><span class="pre">sourcestamps=None</span></code>.
These methods are not yet documented, and their interface is not stable.
Consult the source code for details on the changes.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">preStartConsumingChanges</span></code> and <code class="docutils literal notranslate"><span class="pre">startTimedSchedulerService</span></code> hooks have been removed.</p>
</li>
<li><p class="first">The triggerable schedulers’ <code class="docutils literal notranslate"><span class="pre">trigger</span></code> method now requires a list of sourcestamps, rather than a dictionary.</p>
</li>
<li><p class="first">The <code class="xref py py-class docutils literal notranslate"><span class="pre">SourceStamp</span></code> class is no longer used.
It remains in the codebase to support loading data from pickles on upgrade, but should not be used in running code.</p>
</li>
<li><p class="first">The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildRequest</span></code> class no longer has full <code class="docutils literal notranslate"><span class="pre">source</span></code> or <code class="docutils literal notranslate"><span class="pre">sources</span></code> attributes.
Use the data API to get this information (which is associated with the buildset, not the build request) instead.</p>
</li>
<li><p class="first">The undocumented <code class="docutils literal notranslate"><span class="pre">BuilderControl</span></code> method <code class="docutils literal notranslate"><span class="pre">submitBuildRequest</span></code> has been removed.</p>
</li>
<li><p class="first">The debug client no longer supports requesting builds (the <code class="docutils literal notranslate"><span class="pre">requestBuild</span></code> method has been removed).
If you have been using this method in production, consider instead creating a new change source, using the <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a>, or using one of the try schedulers.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">buildbot.misc.SerializedInvocation</span></code> class has been removed; use <a class="reference internal" href="#buildbot.util.debounce.method" title="buildbot.util.debounce.method"><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.util.debounce.method</span></code></a> instead.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">progress</span></code> attributes of both <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep</span></code></a> and <a class="reference internal" href="#buildbot.process.build.Build" title="buildbot.process.build.Build"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.build.Build</span></code></a> have been removed.
Subclasses should only be accessing the progress-tracking mechanics via the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.setProgress" title="buildbot.process.buildstep.BuildStep.setProgress"><code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep.setProgress</span></code></a> method.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.15.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id2">
<h5>5.15.2.1. Features<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id3">
<h5>5.15.2.2. Fixes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id4">
<h5>5.15.2.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>buildmaster and buildslave no longer supports old-style source steps.</li>
<li>On Windows, if a <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> step in which <code class="docutils literal notranslate"><span class="pre">command</span></code> was specified as a list is executed, and a
list element is a string consisting of a single pipe character, it no longer creates a pipeline.
Instead, the pipe character is passed verbatim as an argument to the program, like any other string.
This makes command handling consistent between Windows and Unix-like systems.
To have a pipeline, specify <code class="docutils literal notranslate"><span class="pre">command</span></code> as a string.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.15.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the
git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.8.10..v0.9.0b1
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.8.12"></span><div class="section" id="release-notes-for-buildbot-0-8-11">
<h3>5.16. Release Notes for Buildbot 0.8.11<a class="headerlink" href="#release-notes-for-buildbot-0-8-11" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.8.11.
This version was released on the 20th of April, 2015.</p>
<div class="section" id="master">
<h4>5.16.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<p>Requirements:</p>
<ul class="simple">
<li>Buildbot works python-dateutil &gt;= 1.5</li>
</ul>
<div class="section" id="features">
<h5>5.16.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">GitHub change hook now supports application/json format.</p>
</li>
<li><p class="first">Buildbot is now compatible with Gerrit v2.6 and higher.</p>
<p>To make this happen, the return result of <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> and <code class="docutils literal notranslate"><span class="pre">summaryCB</span></code> callback has changed from</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">verified</span><span class="p">,</span> <span class="n">review</span><span class="p">)</span>
</pre></div>
</div>
<p>to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
 <span class="s1">&#39;labels&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;label-name&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
           <span class="o">...</span>
           <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The implications are:</p>
<ul class="simple">
<li>there are some differences in behaviour: only those labels that were provided will be updated</li>
<li>Gerrit server must be able to provide a version, if it can’t the <code class="docutils literal notranslate"><span class="pre">GerritStatusPush</span></code> will not work</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have an old style <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> and/or <code class="docutils literal notranslate"><span class="pre">summaryCB</span></code> implemented, these will still work, however there could be more labels updated than anticipated.</p>
</div>
<p>More detailed information is available in <code class="docutils literal notranslate"><span class="pre">GerritStatusPush</span></code> section.</p>
</li>
<li><p class="first">Buildbot now supports plugins.
They allow Buildbot to be extended by using components distributed independently from the main code.
They also provide for a unified way to access all components.
When previously the following construction was used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.kind.other.bits</span> <span class="k">import</span> <span class="n">ComponentClass</span>

<span class="o">...</span> <span class="n">ComponentClass</span> <span class="o">...</span>
</pre></div>
</div>
<p>the following construction achieves the same result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">kind</span>

<span class="o">...</span> <span class="n">kind</span><span class="o">.</span><span class="n">ComponentClass</span> <span class="o">...</span>
</pre></div>
</div>
<p>Kinds of components that are available this way are described in <a class="reference internal" href="#document-manual/plugins"><span class="doc">Plugin Infrastructure in Buildbot</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While the components can be still directly imported as <code class="docutils literal notranslate"><span class="pre">buildbot.kind.other.bits</span></code>, this might not be the case after Buildbot v1.0 is released.</p>
</div>
</li>
<li><p class="first"><a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> now supports detecting new branches</p>
</li>
<li><p class="first"><a class="reference internal" href="#step-MasterShellCommand" title="MasterShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MasterShellCommand</span></code></a> now renders the <code class="docutils literal notranslate"><span class="pre">path</span></code> argument.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShellMixin</span></code>: the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> can now be overridden in the call to <code class="docutils literal notranslate"><span class="pre">makeRemoteShellCommand</span></code>.</p>
</li>
<li><p class="first">GitHub status target now allows to specify a different base URL for the API (usefule for GitHub enterprise installations).
This feature requires <cite>txgithub</cite> of version 0.2.0 or better.</p>
</li>
<li><p class="first">GitHub change hook now supports payload validation using shared secret, see the GitHub hook documentation for details.</p>
</li>
<li><p class="first">Added StashStatusPush status hook for Atlassian Stash</p>
</li>
<li><p class="first">Builders can now have multiple “tags” associated with them. Tags can be used in various status classes as filters (eg, on the waterfall page).</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">MailNotifier</span></code> no longer forces SSL 3.0 when <code class="docutils literal notranslate"><span class="pre">useTls</span></code> is true.</p>
</li>
<li><p class="first">GitHub change hook now supports function as codebase argument.</p>
</li>
<li><p class="first">GitHub change hook now supports pull_request events.</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trigger</span></code>: the <code class="docutils literal notranslate"><span class="pre">getSchedulersAndProperties</span></code> customization method has been backported from Nine.
This provides a way to dynamically specify which schedulers (and the properties for that scheduler) to trigger at runtime.</p>
</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.16.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>GitHub change hook now correctly responds to ping events.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot.steps.http</span></code> steps now correctly have <code class="docutils literal notranslate"><span class="pre">url</span></code> parameter renderable</li>
<li><a class="reference internal" href="#step-MasterShellCommand" title="MasterShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MasterShellCommand</span></code></a> now correctly logs the working directory where it was run.</li>
<li>With Git(), force the updating submodules to ensure local changes by the build are overwritten.
This both ensures more consistent builds and avoids errors when updating submodules.</li>
<li>With Git(), make sure ‘git submodule sync’ is called before ‘git submodule update’ to update
stale remote urls (<a class="reference external" href="http://trac.buildbot.net/ticket/2155">bug #2155</a>).</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.16.1.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The builder parameter “category” is deprecated and is replaced by a parameter called “tags”.</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.16.1.4. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">Trigger</span></code>: <code class="docutils literal notranslate"><span class="pre">createTriggerProperties</span></code> now takes one argument (the properties to generate).</li>
<li><code class="xref py py-class docutils literal notranslate"><span class="pre">Trigger</span></code>: <code class="docutils literal notranslate"><span class="pre">getSchedulers</span></code> method is no longer used and was removed.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.16.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.16.2.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id2">
<h5>5.16.2.2. Fixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id3">
<h5>5.16.2.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="details">
<h4>5.16.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.8.10..532cf49
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.8.10"></span><div class="section" id="release-notes-for-buildbot-0-8-10">
<h3>5.17. Release Notes for Buildbot 0.8.10<a class="headerlink" href="#release-notes-for-buildbot-0-8-10" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.8.10.
Buildbot 0.8.10 was released on the 2nd of December, 2014.</p>
<div class="section" id="master">
<h4>5.17.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.17.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Both the P4 source step and P4 change source support ticket-based authentication.</li>
<li>Clickable ‘categories’ links added in ‘Waterfall’ page (web UI).</li>
</ul>
</div>
<div class="section" id="fixes">
<h5>5.17.1.2. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Buildbot is now compatible with SQLAlchemy 0.8 and higher, using the newly-released SQLAlchemy-Migrate.</li>
<li>The <a class="reference internal" href="#step-HTTPStep" title="HTTPStep"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">HTTPStep</span></code></a> step’s request parameters are now renderable.</li>
<li>Fixed content spoofing vulnerabilities (<a class="reference external" href="http://trac.buildbot.net/ticket/2589">bug #2589</a>).</li>
<li>Fixed cross-site scripting in status_json (<a class="reference external" href="http://trac.buildbot.net/ticket/2943">bug #2943</a>).</li>
<li><a class="reference internal" href="#buildbot.status.status_gerrit.GerritStatusPush" title="buildbot.status.status_gerrit.GerritStatusPush"><code class="xref py py-class docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> supports specifying an SSH identity file explicitly.</li>
<li>Fixed bug which made it impossible to specify the project when using the BitBucket dialect.</li>
<li>Fixed SVN master-side source step: if a SVN operation fails, the repository end up in a situation when a manual intervention is required.
Now if SVN reports such a situation during initial check, the checkout will be clobbered.</li>
<li>Fixed master-side source steps to respect the specified timeout when removing files.</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.17.1.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="changes-for-developers">
<h5>5.17.1.4. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="slave">
<h4>5.17.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.17.2.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id2">
<h5>5.17.2.2. Fixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id3">
<h5>5.17.2.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="details">
<h4>5.17.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.8.9..eight
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.8.9"></span><div class="section" id="release-notes-for-buildbot-0-8-9">
<h3>5.18. Release Notes for Buildbot 0.8.9<a class="headerlink" href="#release-notes-for-buildbot-0-8-9" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot 0.8.9. Buildbot 0.8.9 was
released on 14 June, 2014.</p>
<div class="section" id="master">
<h4>5.18.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.18.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul>
<li><dl class="first docutils">
<dt>The following optional parameters have been added to <code class="xref py py-class docutils literal notranslate"><span class="pre">EC2LatentBuildSlave</span></code></dt>
<dd><ul class="first last simple">
<li>Boolean parameter <code class="docutils literal notranslate"><span class="pre">spot_instance</span></code>, default False, creates a spot instance.</li>
<li>Float parameter <code class="docutils literal notranslate"><span class="pre">max_spot_price</span></code> defines the maximum bid for a spot instance.</li>
<li>List parameter <code class="docutils literal notranslate"><span class="pre">volumes</span></code>, takes a list of (volume_id, mount_point) tuples.</li>
<li>String parameter <code class="docutils literal notranslate"><span class="pre">placement</span></code> is appended to the <code class="docutils literal notranslate"><span class="pre">region</span></code> parameter, e.g. <code class="docutils literal notranslate"><span class="pre">region='us-west-2',</span> <span class="pre">placement='b'</span></code>
will result in the spot request being placed in us-west-2b.</li>
<li>Float parameter <code class="docutils literal notranslate"><span class="pre">price_multiplier</span></code> specifies the percentage bid above the 24-hour average spot price.</li>
<li>Dict parameter <code class="docutils literal notranslate"><span class="pre">tags</span></code> specifies AWS tags as key/value pairs to be applied to new instances.</li>
</ul>
</dd>
</dl>
<p>With <code class="docutils literal notranslate"><span class="pre">spot_instance=True</span></code>, an <code class="docutils literal notranslate"><span class="pre">EC2LatentBuildSlave</span></code> will attempt to create a spot instance with the provided spot
price, placement, and so on.</p>
</li>
<li><p class="first">The web hooks now include support for Bitbucket, GitLab and Gitorious.</p>
</li>
<li><p class="first">The GitHub webhook has been updated to work with v3 of the GitHub webhook API.</p>
</li>
<li><p class="first">The GitHub webhook can now optionally ignore non-distinct commits (<a class="reference external" href="http://trac.buildbot.net/ticket/1861">bug #1861</a>).</p>
</li>
<li><p class="first">The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a> and <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> now split filenames on newlines, rather than whitespace, so files containing whitespace are handled correctly.</p>
</li>
<li><p class="first">Add ‘pollAtLaunch’ flag for polling change sources. This allows a poller to poll immediately on launch and get changes that occurred while it was down.</p>
</li>
<li><p class="first">Added the <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">BitbucketPullrequestPoller</span></code></a> changesource.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> can now be configured to poll all available branches (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1010">pull request 1010</a>).</p>
</li>
<li><p class="first">The <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">P4Source</span></code></a> changesource now supports Perforce servers in a different timezone than the buildbot master (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/728">pull request 728</a>).</p>
</li>
<li><p class="first">Each Scheduler type can now take a ‘reason’ argument to customize the reason it uses for triggered builds.</p>
</li>
<li><p class="first">A new argument <code class="docutils literal notranslate"><span class="pre">createAbsoluteSourceStamps</span></code> has been added to <a class="reference internal" href="#sched-SingleBranchScheduler" title="SingleBranchScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">SingleBranchScheduler</span></code></a> for use with multiple codebases.</p>
</li>
<li><p class="first">A new argument <code class="docutils literal notranslate"><span class="pre">createAbsoluteSourceStamps</span></code> has been added to <a class="reference internal" href="#sched-Nightly" title="Nightly"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Nightly</span></code></a> for use with multiple codebases.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#sched-Periodic" title="Periodic"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">Periodic</span></code></a> scheduler now supports codebases.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> now takes a <code class="docutils literal notranslate"><span class="pre">buttonName</span></code> argument to specify the name of the button on the force-build form.</p>
</li>
<li><p class="first">Master side source checkout steps now support patches (<a class="reference external" href="http://trac.buildbot.net/ticket/2098">bug #2098</a>). The <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> and <a class="reference internal" href="#step-Mercurial" title="Mercurial"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Mercurial</span></code></a> steps use their inbuilt commands to apply patches (<a class="reference external" href="http://trac.buildbot.net/ticket/2563">bug #2563</a>).</p>
</li>
<li><p class="first">Master side source checkout steps now support retry option (<a class="reference external" href="http://trac.buildbot.net/ticket/2465">bug #2465</a>).</p>
</li>
<li><p class="first">Master-side source checkout steps now respond to the “stop build” button (<a class="reference external" href="http://trac.buildbot.net/ticket/2356">bug #2356</a>).</p>
</li>
<li><p class="first"><a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> source checkout step now supports reference repositories.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> step now uses the <cite>git clean</cite> option <cite>-f</cite> twice, to also remove untracked directories managed by another git repository.
See <a class="reference external" href="http://trac.buildbot.net/ticket/2560">bug #2560</a>.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">branch</span></code> and <code class="docutils literal notranslate"><span class="pre">codebase</span></code> arguments to the <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> step are now renderable.</p>
</li>
<li><p class="first">Gerrit integration with <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> Source step on master side (<a class="reference external" href="http://trac.buildbot.net/ticket/2485">bug #2485</a>).</p>
</li>
<li><p class="first"><a class="reference internal" href="#step-P4" title="P4"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">P4</span></code></a> source step now supports more advanced options.</p>
</li>
<li><p class="first">The master-side <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> step now supports authentication for mode=export, fixing <a class="reference external" href="http://trac.buildbot.net/ticket/2463">bug #2463</a>.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> step will now canonicalize URL’s before matching them for better accuracy.</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> step now obfuscates the password in status logs, fixing <a class="reference external" href="http://trac.buildbot.net/ticket/2468">bug #2468</a>.</p>
</li>
<li><p class="first"><a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> source step and ShellCommand now support password obfuscation. (<a class="reference external" href="http://trac.buildbot.net/ticket/2468">bug #2468</a> and <a class="reference external" href="http://trac.buildbot.net/ticket/1748">bug #1748</a>).</p>
</li>
<li><p class="first"><a class="reference internal" href="#step-CVS" title="CVS"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">CVS</span></code></a> source step now checks for “sticky dates” from a previous checkout before updating an existing source directory.</p>
</li>
<li><p class="first">:<a class="reference internal" href="#step-Repo" title="Repo"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Repo</span></code></a> now supports a <code class="docutils literal notranslate"><span class="pre">depth</span></code> flag when initializing the repo. This controls the amount of git history to download.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">manifestBranch</span></code> of the bb:step:<cite>Repo</cite> step is now renderable</p>
</li>
<li><p class="first">New source step <a class="reference internal" href="#step-Monotone" title="Monotone"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Monotone</span></code></a> added on master side.</p>
</li>
<li><p class="first">New source step <a class="reference internal" href="#step-Darcs" title="Darcs"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Darcs</span></code></a> added on master side.</p>
</li>
<li><p class="first">A new <a class="reference internal" href="#step-Robocopy" title="Robocopy"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Robocopy</span></code></a> step is available for Windows builders (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/728">pull request 728</a>).</p>
</li>
<li><p class="first">The attributes <code class="docutils literal notranslate"><span class="pre">description</span></code>, <code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code> and <code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code> have been moved from <code class="xref py py-class docutils literal notranslate"><span class="pre">ShellCommand</span></code> to its superclass <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> so that any class that inherits from <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> can provide a suitable description of itself.</p>
</li>
<li><p class="first">A new <code class="xref py py-class docutils literal notranslate"><span class="pre">FlattenList</span></code> Renderable has been added which can flatten nested lists.</p>
</li>
<li><p class="first">Added new build steps for <a class="reference internal" href="#step-VC12" title="VC12"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">VC12</span></code></a>, <a class="reference internal" href="#step-VS2013" title="VS2013"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">VS2013</span></code></a> and <a class="reference internal" href="#step-MsBuild12" title="MsBuild12"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MsBuild12</span></code></a>.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">mode</span></code> parameter of the VS steps is now renderable (<a class="reference external" href="http://trac.buildbot.net/ticket/2592">bug #2592</a>).</p>
</li>
<li><p class="first">The <a class="reference internal" href="#step-HTTPStep" title="HTTPStep"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">HTTPStep</span></code></a> step can make arbitrary HTTP requests from the master, allowing communication with external APIs.
This new feature requires the optional <code class="docutils literal notranslate"><span class="pre">txrequests</span></code> and <code class="docutils literal notranslate"><span class="pre">requests</span></code> Python packages.</p>
</li>
<li><p class="first">A new <a class="reference internal" href="#step-MultipleFileUpload" title="MultipleFileUpload"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">MultipleFileUpload</span></code></a> step was added to allow uploading several files (or directories) in a single step.</p>
</li>
<li><p class="first">Information about the buildslaves (admin, host, etc) is now persisted in the database and available even if
the slave is not connected.</p>
</li>
<li><p class="first">Buildslave info can now be retrieved via <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a> and a new <code class="docutils literal notranslate"><span class="pre">SetSlaveInfo</span></code> buildstep.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">GNUAutotools</span></code> factory now has a reconf option to run autoreconf before <code class="docutils literal notranslate"><span class="pre">./configure</span></code>.</p>
</li>
<li><p class="first">Builder configurations can now include a <code class="docutils literal notranslate"><span class="pre">description</span></code>, which will appear in the web UI to help humans figure out what the builder does.</p>
</li>
<li><p class="first">The WebStatus builder page can now filter pending/current/finished builds by property parameters of the form <code class="docutils literal notranslate"><span class="pre">?property.&lt;name&gt;=&lt;value&gt;</span></code>.</p>
</li>
<li><p class="first">The WebStatus <code class="docutils literal notranslate"><span class="pre">StatusResourceBuilder</span></code> page can now take the <code class="docutils literal notranslate"><span class="pre">maxsearch</span></code> argument</p>
</li>
<li><p class="first">The WebStatus has a new authz “view” action that allows you to require users to logged in to view the WebStatus.</p>
</li>
<li><p class="first">The WebStatus now shows revisions (+ codebase) where it used to simply say “multiple rev”.</p>
</li>
<li><p class="first">The Console view now supports codebases.</p>
</li>
<li><dl class="first docutils">
<dt>The web UI for Builders has been updated:</dt>
<dd><ul class="first last simple">
<li>shows the build ‘reason’ and ‘interested users’</li>
<li>shows sourcestamp information for builders that use multiple codebases (instead of the generic
“multiple rev” placeholder that was shown before).</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">The waterfall and atom/rss feeds can be filtered with the <code class="docutils literal notranslate"><span class="pre">project</span></code> url parameter.</p>
</li>
<li><p class="first">The WebStatus <code class="docutils literal notranslate"><span class="pre">Authorization</span></code> support now includes a <code class="docutils literal notranslate"><span class="pre">view</span></code> action which can be used to restrict read-only access to the Buildbot instance.</p>
</li>
<li><p class="first">The web status now has options to cancel some or all pending builds.</p>
</li>
<li><p class="first">The WebStatus now interprets ANSI color codes in stdio output.</p>
</li>
<li><p class="first">It is now possible to select categories to show in the waterfall help</p>
</li>
<li><p class="first">The web status now automatically scrolls output logs (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1078">pull request 1078</a>).</p>
</li>
<li><p class="first">The web UI now supports a PNG Status Resource that can be accessed publicly from for example README.md files or wikis or whatever other resource.
This view produces an image in PNG format with information about the last build for the given builder name or whatever other build number if is passed as an argument to the view.</p>
</li>
<li><p class="first">Revision links for commits on SouceForge (Allura) are now automatically generated.</p>
</li>
<li><p class="first">The ‘Rebuild’ button on the web pages for builds features a dropdown to choose whether to
rebuild from exact revisions or from the same sourcestamps (ie, update branch references)</p>
</li>
<li><p class="first">Build status can be sent to GitHub.
Depends on txgithub package.
See <a class="reference internal" href="#reporter-GitHubStatusPush" title="GitHubStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GitHubStatusPush</span></code></a> and <a class="reference external" href="https://github.com/blog/1227-commit-status-api">GitHub Commit Status</a>.</p>
</li>
<li><p class="first">The IRC bot of <a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> will, unless useRevisions is set, shorten
long lists of revisions printed when a build starts; it will only show two,
and the number of additional revisions included in the build.</p>
</li>
<li><p class="first">A new argument <code class="docutils literal notranslate"><span class="pre">summaryCB</span></code> has been added to <code class="docutils literal notranslate"><span class="pre">GerritStatusPush</span></code>, to allow sending one review per buildset. Sending a single “summary” review per buildset is now the default if neither <code class="docutils literal notranslate"><span class="pre">summaryCB</span></code> nor <code class="docutils literal notranslate"><span class="pre">reviewCB</span></code> are specified.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">comments</span></code> field of changes is no longer limited to 1024 characters on MySQL and Postgres.  See <a class="reference external" href="http://trac.buildbot.net/ticket/2367">bug #2367</a> and <a class="reference external" href="https://github.com/buildbot/buildbot/pull/736">pull request 736</a>.</p>
</li>
<li><p class="first">HTML log files are no longer stored in status pickles (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1077">pull request 1077</a>)</p>
</li>
<li><p class="first">Builds are now retried after a slave is lost (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1049">pull request 1049</a>).</p>
</li>
<li><p class="first">The buildbot status client can now access a build properties via the <code class="docutils literal notranslate"><span class="pre">getProperties</span></code> call.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">restart</span></code>, and <code class="docutils literal notranslate"><span class="pre">reconfig</span></code> commands will now wait for longer than 10 seconds as long as the master continues producing log lines indicating that the configuration is progressing.</p>
</li>
<li><p class="first">Added new config option <code class="docutils literal notranslate"><span class="pre">protocols</span></code> which allows to configure multiple protocols on single master.</p>
</li>
<li><p class="first">RemoteShellCommands can be killed by SIGTERM with the sigtermTime parameter before resorting to SIGKILL (<a class="reference external" href="http://trac.buildbot.net/ticket/751">bug #751</a>).
If the slave’s version is less than 0.8.9, the slave will kill the process with SIGKILL regardless of whether sigtermTime
is supplied.</p>
</li>
<li><p class="first">Introduce an alternative way to deploy Buildbot and try the pyflakes tutorial
using <a class="reference internal" href="#first-run-docker-label"><span class="std std-ref">Docker</span></a>.</p>
</li>
<li><p class="first">Added zsh and bash tab-completions support for ‘buildbot’ command.</p>
</li>
<li><p class="first">An example of a declarative configuration is included in <code class="docutils literal notranslate"><span class="pre">master/contrib/SimpleConfig.py</span></code>, with copious comments.</p>
</li>
<li><p class="first">Systemd unit files for Buildbot are available in the <a class="reference external" href="https://github.com/buildbot/buildbot-contrib/tree/master/master/contrib/">master/contrib/</a> directory.</p>
</li>
<li><p class="first">We’ve added some extra checking to make sure that you have a valid locale before starting buildbot (#2608).</p>
</li>
</ul>
</div>
<div class="section" id="forward-compatibility">
<h5>5.18.1.2. Forward Compatibility<a class="headerlink" href="#forward-compatibility" title="Permalink to this headline">¶</a></h5>
<p>In preparation for a more asynchronous implementation of build steps in Buildbot 0.9.0, this version introduces support for new-style steps.
Existing old-style steps will continue to function correctly in Buildbot 0.8.x releases and in Buildbot 0.9.0, but support will be dropped soon afterward.
See <a class="reference internal" href="#new-style-build-steps"><span class="std std-ref">New-Style Build Steps</span></a>, below, for guidance on rewriting existing steps in this new style.
To eliminate ambiguity, the documentation for this version only reflects support for new-style steps.
Refer to the documentation for previous versions for information on old-style steps.</p>
</div>
<div class="section" id="fixes">
<h5>5.18.1.3. Fixes<a class="headerlink" href="#fixes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fixes an issue where <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">GitPoller</span></code></a> sets the change branch to <code class="docutils literal notranslate"><span class="pre">refs/heads/master</span></code> - which isn’t compatible with <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1069">pull request 1069</a>).</li>
<li>Fixed an issue where the <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> and <a class="reference internal" href="#step-CVS" title="CVS"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">CVS</span></code></a> source steps silently changed the <code class="docutils literal notranslate"><span class="pre">workdir</span></code> to <code class="docutils literal notranslate"><span class="pre">'build'</span></code> when the ‘copy’ method is used.</li>
<li>The <a class="reference internal" href="#step-CVS" title="CVS"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">CVS</span></code></a> source step now respects the timeout parameter.</li>
<li>The <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> step now uses the <cite>git submodule update</cite> option <cite>–init</cite> when updating the submodules of an existing repository,
so that it will receive any newly added submodules.</li>
<li>The web status no longer relies on the current working directory, which is not set correctly by some initscripts, to find the <code class="docutils literal notranslate"><span class="pre">templates/</span></code> directory (<a class="reference external" href="http://trac.buildbot.net/ticket/2586">bug #2586</a>).</li>
<li>The Perforce source step uses the correct path separator when the master is on Windows and the build slave is on a POSIX OS (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1114">pull request 1114</a>).</li>
<li>The source steps now correctly interpolate properties in <code class="docutils literal notranslate"><span class="pre">env</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">GerritStatusPush</span></code> now supports setting scores with Gerrit 2.6 and newer</li>
<li>The change hook no longer fails when passing unicode to <code class="docutils literal notranslate"><span class="pre">change_hook_auth</span></code> (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/996">pull request 996</a>).</li>
<li>The source steps now correctly interpolate properties in <code class="docutils literal notranslate"><span class="pre">env</span></code>.</li>
<li>Whitespace is properly handled for StringParameter, so that appropriate validation errors are raised for <code class="docutils literal notranslate"><span class="pre">required</span></code> parameters (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1084">pull request 1084</a>).</li>
<li>Fix a rare case where a buildtep might fail from a GeneratorExit exception (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1063">pull request 1063</a>).</li>
<li>Fixed an issue where UTF-8 data in logs caused RSS feed exceptions (<a class="reference external" href="http://trac.buildbot.net/ticket/951">bug #951</a>).</li>
<li>Fix an issue with unescaped author names causing invalid RSS feeds (<a class="reference external" href="http://trac.buildbot.net/ticket/2596">bug #2596</a>).</li>
<li>Fixed an issue with pubDate format in feeds.</li>
<li>Fixed an issue where the step text value could cause a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> in the build detail page (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1061">pull request 1061</a>).</li>
<li>Fix failures where <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clean</span></code> fails but could be clobbered (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1058">pull request 1058</a>).</li>
<li>Build step now correctly fails when the git clone step fails (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1057">pull request 1057</a>).</li>
<li>Fixed a race condition in slave shutdown (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1019">pull request 1019</a>).</li>
<li>Now correctly unsubscribes StatusPush from status updates when reconfiguring (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/997">pull request 997</a>).</li>
<li>Fixes parsing git commit messages that are blank.</li>
<li><a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> no longer fails when work dir exists but isn’t a checkout (<a class="reference external" href="http://trac.buildbot.net/ticket/2531">bug #2531</a>).</li>
<li>The <cite>haltOnFailure</cite> and <cite>flunkOnFailure</cite> attributes of <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> are now renderable. (<a class="reference external" href="http://trac.buildbot.net/ticket/2486">bug #2486</a>).</li>
<li>The <cite>rotateLength</cite> and <cite>maxRotatedFile</cite> arguments are no longer treated as strings in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>. This fixes log rotation. The upgrade_master command will notify users if they have this problem.</li>
<li>Buildbot no longer specifies a revision when pulling from a mercurial (<a class="reference external" href="http://trac.buildbot.net/ticket/438">bug #438</a>).</li>
<li>The WebStatus no longer incorrectly refers to fields that might not be visible.</li>
<li>The GerritChangeSource now sets a default author, fixing an exception that occurred when Gerrit didn’t report an owner name/email.</li>
<li>Respects the <code class="docutils literal notranslate"><span class="pre">RETRY</span></code> status when an interrupt occurs.</li>
<li>Fixes an off-by-one error when the tryclient is finding the current git branch.</li>
<li>Improve the Mercurial source stamp extraction in the try client.</li>
<li>Fixes some edge cases in timezone handling for python &lt; <code class="docutils literal notranslate"><span class="pre">2.7.4</span></code> (<a class="reference external" href="http://trac.buildbot.net/ticket/2522">bug #2522</a>).</li>
<li>The <code class="docutils literal notranslate"><span class="pre">EC2LatentBuildSlave</span></code> will now only consider available AMI’s.</li>
<li>Fixes a case where the first build runs on an old slave instead of a new one after reconfig (<a class="reference external" href="http://trac.buildbot.net/ticket/2507">bug #2507</a>).</li>
<li>The e-mail address validation for the MailNotifier status receiver has been improved.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">--db</span></code> parameter of <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">create-master</span></code> is now validated.</li>
<li>No longer ignores default choice for ForceScheduler list parameters</li>
<li>Now correctly handles <code class="docutils literal notranslate"><span class="pre">BuilderConfig(...,</span> <span class="pre">mergeRequests=False)</span></code> (<a class="reference external" href="http://trac.buildbot.net/ticket/2555">bug #2555</a>).</li>
<li>Now excludes changes from sourcestamps when they aren’t in the DB (<a class="reference external" href="http://trac.buildbot.net/ticket/2554">bug #2554</a>).</li>
<li>Fixes a compatibility issue with HPCloud in the OpenStack latent slave.</li>
<li>Allow <code class="docutils literal notranslate"><span class="pre">_</span></code> as a valid character in JSONP callback names.</li>
<li>Fix build start time retrieval in the WebStatus grid view.</li>
<li>Increase the length of the DB fields <code class="docutils literal notranslate"><span class="pre">changes.comments</span></code> and <code class="docutils literal notranslate"><span class="pre">buildset_properties.property_value</span></code>.</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.18.1.4. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The slave-side source steps are deprecated in this version of Buildbot, and master-side support will be removed in a future version.
Please convert any use of slave-side steps (imported directly from <code class="docutils literal notranslate"><span class="pre">buildbot.steps.source</span></code>, rather than from a specific module like <code class="docutils literal notranslate"><span class="pre">buildbot.steps.source.svn</span></code>) to use master-side steps.</li>
<li>Both old-style and new-style steps are supported in this version of Buildbot.
Upgrade your steps to new-style now, as support for old-style steps will be dropped after Buildbot-0.9.0.
See <a class="reference internal" href="#new-style-build-steps"><span class="std std-ref">New-Style Build Steps</span></a> for details.<ul>
<li>The <code class="docutils literal notranslate"><span class="pre">LoggingBuildStep</span></code> class has been deprecated, and support will be removed along with support for old-style steps after the Buildbot-0.9.0 release.
Instead, subclass <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> and mix in <code class="xref py py-class docutils literal notranslate"><span class="pre">ShellMixin</span></code> to get similar behavior.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">slavePortnum</span></code> option deprecated, please use <code class="docutils literal notranslate"><span class="pre">c['protocols']['pb']['port']</span></code> to set up PB port</li>
<li>The <code class="docutils literal notranslate"><span class="pre">buildbot.process.mtrlogobserver</span></code> module have been renamed to <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.steps.mtrlogobserver</span></code>.</li>
<li>The buildmaster now requires at least Twisted-11.0.0.</li>
<li>The buildmaster now requires at least sqlalchemy-migrate 0.6.1.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">hgbuildbot</span></code> Mercurial hook has been moved to <code class="docutils literal notranslate"><span class="pre">contrib/</span></code>, and does not work with recent versions of Mercurial and Twisted.
The runtimes for these two tools are incompatible, yet <code class="docutils literal notranslate"><span class="pre">hgbuildbot</span></code> attempts to run both in the same Python interpreter.
Mayhem ensues.</li>
<li>The try scheduler’s <code class="docutils literal notranslate"><span class="pre">--connect=ssh</span></code> method no longer supports waiting for results (<code class="docutils literal notranslate"><span class="pre">--wait</span></code>).</li>
<li>The former <code class="docutils literal notranslate"><span class="pre">buildbot.process.buildstep.RemoteCommand</span></code> class and its subclasses are now in <code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.remotecommand</span></code>, although imports from the previous path will continue to work.
Similarly, the former <code class="docutils literal notranslate"><span class="pre">buildbot.process.buildstep.LogObserver</span></code> class and its subclasses are now in <a class="reference internal" href="#module-buildbot.process.logobserver" title="buildbot.process.logobserver"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.process.logobserver</span></code></a>, although imports from the previous path will continue to work.</li>
<li>The undocumented BuildStep method <code class="docutils literal notranslate"><span class="pre">checkDisconnect</span></code> is deprecated and now does nothing as the handling of disconnects is now handled in the <code class="docutils literal notranslate"><span class="pre">failed</span></code> method.
Any custom steps adding this method as a callback or errback should no longer do so.</li>
<li>The build step <code class="docutils literal notranslate"><span class="pre">MsBuild</span></code> is now called <code class="docutils literal notranslate"><span class="pre">MsBuild4</span></code> as multiple versions are now supported. An alias is provided so existing setups will continue to work, but this will be removed in a future release.</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.18.1.5. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">CompositeStepMixin</span></code> now provides a <code class="docutils literal notranslate"><span class="pre">runGlob</span></code> method to check for files on the slave that match a given shell-style pattern.</li>
<li>The <code class="xref py py-class docutils literal notranslate"><span class="pre">BuilderStatus</span></code> now allows you to pass a <code class="docutils literal notranslate"><span class="pre">filter_fn</span></code> argument to <code class="docutils literal notranslate"><span class="pre">generateBuilds</span></code>.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.18.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.18.2.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Added zsh and bash tab-completions support for ‘buildslave’ command.</li>
<li>RemoteShellCommands accept the new sigtermTime parameter from master. This allows processes to be killed by SIGTERM
before resorting to SIGKILL (<a class="reference external" href="http://trac.buildbot.net/ticket/751">bug #751</a>)</li>
<li>Commands will now throw a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> if mandatory args are not present.</li>
<li>Added a new remote command <code class="xref py py-class docutils literal notranslate"><span class="pre">GlobPath</span></code> that can be used to call Python’s <code class="docutils literal notranslate"><span class="pre">glob.glob</span></code> on the slave.</li>
</ul>
</div>
<div class="section" id="id2">
<h5>5.18.2.2. Fixes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Fixed an issue when buildstep stop() was raising an exception incorrectly if timeout for
buildstep wasn’t set or was None (see <a class="reference external" href="https://github.com/buildbot/buildbot/pull/753">pull request 753</a>) thus keeping watched logfiles open
(this prevented their removal on Windows in subsequent builds).</li>
<li>Fixed a bug in P4 source step where the <code class="docutils literal notranslate"><span class="pre">timeout</span></code> parameter was ignored.</li>
<li>Fixed a bug in P4 source step where using a custom view-spec could result in failed syncs
due to incorrectly generated command-lines.</li>
<li>The logwatcher will use <code class="docutils literal notranslate"><span class="pre">/usr/xpg4/bin/tail</span></code> on Solaris, it if is available (<a class="reference external" href="https://github.com/buildbot/buildbot/pull/1065">pull request 1065</a>).</li>
</ul>
</div>
<div class="section" id="id3">
<h5>5.18.2.3. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="details">
<h4>5.18.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the
git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.8.8..v0.8.9
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.8.8"></span><div class="section" id="release-notes-for-buildbot-v0-8-8">
<h3>5.19. Release Notes for Buildbot v0.8.8<a class="headerlink" href="#release-notes-for-buildbot-v0-8-8" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot v0.8.8
Buildbot v0.8.8 was released on August 22, 2013</p>
<div class="section" id="master">
<h4>5.19.1. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.19.1.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">MasterShellCommand</span></code> step now correctly handles environment variables passed as list.</li>
<li>The master now poll the database for pending tasks when running buildbot in multi-master mode.</li>
<li>The algorithm to match build requests to slaves has been rewritten <a class="reference external" href="https://github.com/buildbot/buildbot/pull/615">pull request 615</a>.
The new algorithm automatically takes locks into account, and will not schedule a build only to have it wait on a lock.
The algorithm also introduces a <code class="docutils literal notranslate"><span class="pre">canStartBuild</span></code> builder configuration option which can be used to prevent a build request being assigned to a slave.</li>
<li><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">stop</span></code> and <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">restart</span></code> now accept <code class="docutils literal notranslate"><span class="pre">--clean</span></code> to stop or restart the master cleanly (allowing all running builds to complete first).</li>
<li>The <a class="reference internal" href="#reporter-IRC" title="IRC"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">IRC</span></code></a> bot now supports clean shutdown and immediate shutdown by using the command ‘shutdown’.
To allow the command to function, you must provide <cite>allowShutdown=True</cite>.</li>
<li><a class="reference internal" href="#step-CopyDirectory" title="CopyDirectory"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">CopyDirectory</span></code></a> has been added.</li>
<li><code class="docutils literal notranslate"><span class="pre">BuildslaveChoiceParameter</span></code> has been added to provide a way to explicitly choose a buildslave
for a given build.</li>
<li>default.css now wraps preformatted text by default.</li>
<li>Slaves can now be paused through the web status.</li>
<li>The latent buildslave support is less buggy, thanks <a class="reference external" href="https://github.com/buildbot/buildbot/pull/646">pull request 646</a>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">treeStableTimer</span></code> for <code class="docutils literal notranslate"><span class="pre">AnyBranchScheduler</span></code> now maintains separate timers for separate branches, codebases, projects, and repositories.</li>
<li><a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> has a new option <cite>preferLastChangedRev=True</cite> to use the last changed revision for <code class="docutils literal notranslate"><span class="pre">got_revision</span></code></li>
<li>The build request DB connector method <a class="reference internal" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests" title="buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests"><code class="xref py py-meth docutils literal notranslate"><span class="pre">getBuildRequests</span></code></a> can now filter by branch and repository.</li>
<li>A new <a class="reference internal" href="#step-SetProperty" title="SetProperty"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SetProperty</span></code></a> step has been added in <code class="docutils literal notranslate"><span class="pre">buildbot.steps.master</span></code> which can set a property directly without accessing the slave.</li>
<li>The new <a class="reference internal" href="#step-LogRenderable" title="LogRenderable"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">LogRenderable</span></code></a> step logs Python objects, which can contain renderables, to the logfile.
This is helpful for debugging property values during a build.</li>
<li>‘buildbot try’ now has an additional option <cite>–property</cite> option to set properties.
Unlike the existing option <cite>–properties</cite> option, this new option supports setting
only a single property and therefore allows commas to be included in the property
name and value.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Git</span></code> step has a new <code class="docutils literal notranslate"><span class="pre">config</span></code> option, which accepts a dict of git configuration options to
pass to the low-level git commands.  See <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> for details.</li>
<li>In <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> ShellCommand now validates its arguments during config and will identify any invalid arguments before a build is started.</li>
<li>The list of force schedulers in the web UI is now sorted by name.</li>
<li>OpenStack-based Latent Buildslave support was added.
See <a class="reference external" href="https://github.com/buildbot/buildbot/pull/666">pull request 666</a>.</li>
<li>Master-side support for P4 is available, and provides a great deal more flexibility than the old slave-side step.
See <a class="reference external" href="https://github.com/buildbot/buildbot/pull/596">pull request 596</a>.</li>
<li>Master-side support for Repo is available.
The step parameters changed to camelCase.
<code class="docutils literal notranslate"><span class="pre">repo_downloads</span></code>, and <code class="docutils literal notranslate"><span class="pre">manifest_override_url</span></code> properties are no longer hardcoded, but instead consult as default values via renderables.
Renderable are used in favor of callables for <code class="docutils literal notranslate"><span class="pre">syncAllBranches</span></code> and <code class="docutils literal notranslate"><span class="pre">updateTarball</span></code>.</li>
<li>Builder configurations can now include a <code class="docutils literal notranslate"><span class="pre">description</span></code>, which will appear in the web UI to help humans figure out what the builder does.</li>
<li>GNUAutoconf and other pre-defined factories now work correctly (<a class="reference external" href="http://trac.buildbot.net/ticket/2402">bug #2402</a>)</li>
<li>The pubDate in RSS feeds is now rendered correctly (<a class="reference external" href="http://trac.buildbot.net/ticket/2530">bug #2530</a>)</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.19.1.2. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">split_file</span></code> function for <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> may now return a dictionary instead of a tuple.
This allows it to add extra information about a change (such as <code class="docutils literal notranslate"><span class="pre">project</span></code> or <code class="docutils literal notranslate"><span class="pre">repository</span></code>).</li>
<li>The <code class="docutils literal notranslate"><span class="pre">workdir</span></code> build property has been renamed to <code class="docutils literal notranslate"><span class="pre">builddir</span></code>.
This change accurately reflects its content; the term “workdir” means something different.
<code class="docutils literal notranslate"><span class="pre">workdir</span></code> is currently still supported for backwards compatibility, but will be removed eventually.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Blocker</span></code> step has been removed.</li>
<li>Several polling ChangeSources are now documented to take a <code class="docutils literal notranslate"><span class="pre">pollInterval</span></code> argument, instead of <code class="docutils literal notranslate"><span class="pre">pollinterval</span></code>.
The old name is still supported.</li>
<li>StatusReceivers’ checkConfig method should no longer take an <cite>errors</cite> parameter.
It should indicate errors by calling <a class="reference internal" href="#buildbot.config.error" title="buildbot.config.error"><code class="xref py py-func docutils literal notranslate"><span class="pre">error</span></code></a>.</li>
<li>Build steps now require that their name be a string.
Previously, they would accept anything, but not behave appropriately.</li>
<li>The web status no longer displays a potentially misleading message, indicating whether the build
can be rebuilt exactly.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">SetProperty</span></code> step in <code class="docutils literal notranslate"><span class="pre">buildbot.steps.shell</span></code> has been renamed to <a class="reference internal" href="#step-SetPropertyFromCommand" title="SetPropertyFromCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SetPropertyFromCommand</span></code></a>.</li>
<li>The EC2 and libvirt latent slaves have been moved to <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.ec2</span></code> and <code class="docutils literal notranslate"><span class="pre">buildbot.buildslave.libirt</span></code> respectively.</li>
<li>Pre v0.8.7 versions of buildbot supported passing keyword arguments to <code class="docutils literal notranslate"><span class="pre">buildbot.process.BuildFactory.addStep</span></code>, but this was dropped.
Support was added again, while still being deprecated, to ease transition.</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.19.1.3. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Added an optional build start callback to <code class="docutils literal notranslate"><span class="pre">buildbot.status.status_gerrit.GerritStatusPush</span></code>
This release includes the fix for <a class="reference external" href="http://trac.buildbot.net/ticket/2536">bug #2536</a>.</li>
<li>An optional <code class="docutils literal notranslate"><span class="pre">startCB</span></code> callback to <a class="reference internal" href="#reporter-GerritStatusPush" title="GerritStatusPush"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">GerritStatusPush</span></code></a> can be used
to send a message back to the committer.
See the linked documentation for details.</li>
<li>bb:sched:<cite>ChoiceStringParameter</cite> has a new method <code class="docutils literal notranslate"><span class="pre">getChoices</span></code> that can be used to generate
content dynamically for Force scheduler forms.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.19.2. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.19.2.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The fix for Twisted bug #5079 is now applied on the slave side, too.
This fixes a perspective broker memory leak in older versions of Twisted.
This fix was added on the master in Buildbot-0.8.4 (see <a class="reference external" href="http://trac.buildbot.net/ticket/1958">bug #1958</a>).</li>
<li>The <code class="docutils literal notranslate"><span class="pre">--nodaemon</span></code> option to <code class="docutils literal notranslate"><span class="pre">buildslave</span> <span class="pre">start</span></code> now correctly prevents the slave from forking before running.</li>
</ul>
</div>
<div class="section" id="id2">
<h5>5.19.2.2. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="details">
<h4>5.19.3. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the
git log itself:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>git log v0.8.7..v0.8.8
</pre></div>
</div>
</div>
</div>
<span id="document-relnotes/0.8.7"></span><div class="section" id="release-notes-for-buildbot-v0-8-7">
<h3>5.20. Release Notes for Buildbot v0.8.7<a class="headerlink" href="#release-notes-for-buildbot-v0-8-7" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot v0.8.7.
Buildbot v0.8.7 was released on September 22, 2012.
Buildbot 0.8.7p1 was released on November 21, 2012.</p>
<div class="section" id="p1">
<h4>5.20.1. 0.8.7p1<a class="headerlink" href="#p1" title="Permalink to this headline">¶</a></h4>
<p>In addition to what’s listed below, the 0.8.7p1 release adds the following.</p>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">SetPropertiesFromEnv</span></code> step now correctly gets environment variables from the slave, rather than those set on the master.
Also, it logs the changes made to properties.</li>
<li>The master-side <code class="docutils literal notranslate"><span class="pre">Git</span></code> source step now doesn’t try to clone a branch called <code class="docutils literal notranslate"><span class="pre">HEAD</span></code>.
This is what <code class="docutils literal notranslate"><span class="pre">git</span></code> does by default, and specifying it explicitly doesn’t work as expected.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Git</span></code> step properly deals with the case when there is a file called <code class="docutils literal notranslate"><span class="pre">FETCH_HEAD</span></code>
in the checkout.</li>
<li>Buildbot no longer forks when told not to daemonize.</li>
<li>Buildbot’s startup is now more robust. See <a class="reference external" href="http://trac.buildbot.net/ticket/1992">bug #1992</a>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Trigger</span></code> step uses the provided list of source stamps exactly, if given, instead of adding them to the sourcestamps of the current build.
In 0.8.7, they were combined with the source stamps for the current build.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Trigger</span></code> step again completely ignores the source stamp of the current build, if <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is set.
In 0.8.7, this was mistakenly changed to only ignore the specified revision of the source stamp.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Triggerable</span></code> scheduler is again properly passing changes through to the scheduled builds.
See <a class="reference external" href="http://trac.buildbot.net/ticket/2376">bug #2376</a>.</li>
<li>Web change hooks log errors, allowing debugging.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">base</span></code> change hook now properly decodes the provided date.</li>
<li><code class="docutils literal notranslate"><span class="pre">CVSMailDir</span></code> has been fixed.</li>
<li>Importing <code class="docutils literal notranslate"><span class="pre">buildbot.test</span></code> no longer causes python to exit, if <code class="docutils literal notranslate"><span class="pre">mock</span></code> isn’t installed.
The fixes <code class="docutils literal notranslate"><span class="pre">pydoc</span> <span class="pre">-k</span></code> when buildbot is installed.</li>
<li><code class="docutils literal notranslate"><span class="pre">Mercurial</span></code> properly updates to the correct branch, when using <code class="docutils literal notranslate"><span class="pre">inrepo</span></code> branches.</li>
<li>Buildbot now doesn’t fail on invalid UTF-8 in a number of places.</li>
<li>Many documentation updates and fixes.</li>
</ul>
</div>
<div class="section" id="master">
<h4>5.20.2. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<div class="section" id="features">
<h5>5.20.2.1. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>Buildbot now supports building projects composed of multiple codebases.  New
schedulers can aggregate changes to multiple codebases into source stamp sets
(with one source stamp for each codebase).  Source steps then check out each
codebase as required, and the remainder of the build process proceeds
normally.  See the <a class="reference internal" href="#multiple-codebase-builds"><span class="std std-ref">Multiple-Codebase Builds</span></a> for details.<ul>
<li>The format of the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property has changed for multi-codebase builds.
It is now a dictionary keyed by codebase.</li>
</ul>
</li>
<li><code class="docutils literal notranslate"><span class="pre">Source</span></code> and <code class="docutils literal notranslate"><span class="pre">ShellCommand</span></code> steps now have an optional <code class="docutils literal notranslate"><span class="pre">descriptionSuffix</span></code>, a suffix to the
<code class="docutils literal notranslate"><span class="pre">description</span></code>/<code class="docutils literal notranslate"><span class="pre">descriptionDone</span></code> values. For example this can help distinguish between
multiple <code class="docutils literal notranslate"><span class="pre">Compile</span></code> steps that are applied to different codebases.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">Git</span></code> step has a new <code class="docutils literal notranslate"><span class="pre">getDescription</span></code> option, which will run <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">describe</span></code> after checkout
normally.  See <a class="reference internal" href="#step-Git" title="Git"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Git</span></code></a> for details.</li>
<li>A new interpolation placeholder <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>, with more regular syntax, is available.</li>
<li>A new ternary substitution operator <code class="docutils literal notranslate"><span class="pre">:?</span></code> and <code class="docutils literal notranslate"><span class="pre">:#?</span></code> is available with the <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code> class.</li>
<li><code class="docutils literal notranslate"><span class="pre">IRenderable.getRenderingFor</span></code> can now return a deferred.</li>
<li>The Mercurial hook now supports multiple masters.  See <a class="reference external" href="https://github.com/buildbot/buildbot/pull/436">pull request 436</a>.</li>
<li>There’s a new poller for Mercurial: <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">HgPoller</span></code></a>.</li>
<li>The new <code class="docutils literal notranslate"><span class="pre">HTPasswdAprAuth</span></code> uses libaprutil (through ctypes) to validate
the password against the hash from the .htpasswd file. This adds support for
all hash types htpasswd can generate.</li>
<li><code class="docutils literal notranslate"><span class="pre">GitPoller</span></code> has been rewritten.
It now supports multiple branches and can share a directory between multiple pollers.
It is also more resilient to changes in configuration, or in the underlying repository.</li>
<li>Added a new property <code class="docutils literal notranslate"><span class="pre">httpLoginUrl</span></code> to <code class="docutils literal notranslate"><span class="pre">buildbot.status.web.authz.Authz</span></code>
to render a nice Login link in WebStatus for unauthenticated users if
<code class="docutils literal notranslate"><span class="pre">useHttpHeader</span></code> and <code class="docutils literal notranslate"><span class="pre">httpLoginUrl</span></code> are set.</li>
<li><code class="docutils literal notranslate"><span class="pre">ForceScheduler</span></code> has been updated:<ul>
<li>support for multiple <a class="reference internal" href="#change-attr-codebase"><span class="std std-ref">codebases</span></a> via the <code class="docutils literal notranslate"><span class="pre">codebases</span></code> parameter</li>
<li><code class="docutils literal notranslate"><span class="pre">NestedParameter</span></code> to provide a logical grouping of parameters.</li>
<li><code class="docutils literal notranslate"><span class="pre">CodebaseParameter</span></code> to set the branch/revision/repository/project for a codebase</li>
<li>new HTML/CSS customization points. Each parameter is contained in a <code class="docutils literal notranslate"><span class="pre">row</span></code> with multiple
‘class’ attributes associated with them (eg, ‘force-string’ and ‘force-nested’) as well as a unique
id to use with Javascript. Explicit line-breaks have been removed from the HTML generator and
are now controlled using CSS.</li>
</ul>
</li>
<li>The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> now supports multiple projects and codebases.
See <a class="reference external" href="https://github.com/buildbot/buildbot/pull/443">pull request 443</a>.</li>
<li>The <a class="reference internal" href="#reporter-MailNotifier" title="MailNotifier"><code class="xref bb bb-reporter docutils literal notranslate"><span class="pre">MailNotifier</span></code></a> now takes a callable to calculate the “previous” build for purposes of determining status changes.
See <a class="reference external" href="https://github.com/buildbot/buildbot/pull/489">pull request 489</a>.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">copy_properties</span></code> parameter, given a list of properties to copy into the new build request, has been deprecated in favor of explicit use of <code class="docutils literal notranslate"><span class="pre">set_properties</span></code>.</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.20.2.2. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Buildbot master now requires at least Python-2.5 and Twisted-9.0.0.</p>
</li>
<li><p class="first">Passing a <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code></a> subclass (rather than instance) to <code class="xref py py-meth docutils literal notranslate"><span class="pre">addStep</span></code> is no longer supported.
The <code class="docutils literal notranslate"><span class="pre">addStep</span></code> method now takes exactly one argument.</p>
</li>
<li><p class="first">Buildbot master requires <code class="docutils literal notranslate"><span class="pre">python-dateutil</span></code> version 1.5 to support the
Nightly scheduler.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">ForceScheduler</span></code> has been updated to support multiple <a class="reference internal" href="#change-attr-codebase"><span class="std std-ref">codebases</span></a>.
The branch/revision/repository/project are deprecated; if you have customized these
values, simply provide them as <code class="docutils literal notranslate"><span class="pre">codebases=[CodebaseParameter(name='',</span> <span class="pre">...)]</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li>The POST URL names for <code class="docutils literal notranslate"><span class="pre">AnyPropertyParameter</span></code> fields have changed. For example,
‘property1name’ is now ‘property1_name’, and ‘property1value’ is now ‘property1_value’.
Please update any bookmarked or saved URL’s that used these fields.</li>
<li><code class="docutils literal notranslate"><span class="pre">forcesched.BaseParameter</span></code> API has changed quite a bit and is no longer backwards
compatible. Updating guidelines:<ul>
<li><code class="docutils literal notranslate"><span class="pre">get_from_post</span></code> is renamed to <code class="docutils literal notranslate"><span class="pre">getFromKwargs</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">update_from_post</span></code> is renamed to <code class="docutils literal notranslate"><span class="pre">updateFromKwargs</span></code>. This function’s parameters
are now called via named parameters to allow subclasses to ignore values it doesn’t use.
Subclasses should add <code class="docutils literal notranslate"><span class="pre">**unused</span></code> for future compatibility. A new parameter
<code class="docutils literal notranslate"><span class="pre">sourcestampset</span></code> is provided to allow subclasses to modify the sourcestamp set, and
will probably require you to add the <code class="docutils literal notranslate"><span class="pre">**unused</span></code> field.</li>
</ul>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The parameters to the callable version of <code class="docutils literal notranslate"><span class="pre">build.workdir</span></code> have changed.
Instead of a single sourcestamp, a list of sourcestamps is passed. Each
sourcestamp in the list has a different <a class="reference internal" href="#change-attr-codebase"><span class="std std-ref">codebase</span></a></p>
</li>
<li><p class="first">The undocumented renderable <code class="docutils literal notranslate"><span class="pre">_ComputeRepositoryURL</span></code> is no longer imported to
<a class="reference internal" href="#module-buildbot.steps.source" title="buildbot.steps.source"><code class="xref py py-mod docutils literal notranslate"><span class="pre">buildbot.steps.source</span></code></a>. It is still available at
<code class="docutils literal notranslate"><span class="pre">buildbot.steps.source.oldsource</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">IProperties.render</span></code> now returns a deferred, so any code rendering properties
by hand will need to take this into account.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">baseURL</span></code> has been removed in <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> to use just <code class="docutils literal notranslate"><span class="pre">repourl</span></code> - see
<a class="reference external" href="http://trac.buildbot.net/ticket/2066">bug #2066</a>. Branch info should be provided with <code class="docutils literal notranslate"><span class="pre">Interpolate</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="k">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">baseURL</span><span class="o">=</span><span class="s2">&quot;svn://svn.example.org/svn/&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>can be replaced with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="k">import</span> <span class="n">Interpolate</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="k">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;svn://svn.example.org/svn/%(src::branch)s&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="k">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">baseURL</span><span class="o">=</span><span class="s2">&quot;svn://svn.example.org/svn/</span><span class="si">%%</span><span class="s2">BRANCH</span><span class="si">%%</span><span class="s2">/project&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>can be replaced with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="k">import</span> <span class="n">Interpolate</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="k">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;svn://svn.example.org/svn/%(src::branch)s/project&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="k">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">baseURL</span><span class="o">=</span><span class="s2">&quot;svn://svn.example.org/svn/&quot;</span><span class="p">,</span> <span class="n">defaultBranch</span><span class="o">=</span><span class="s2">&quot;branches/test&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>can be replaced with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="k">import</span> <span class="n">Interpolate</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="k">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s2">&quot;svn://svn.example.org/svn/%(src::branch:-branches/test)s&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">P4Sync</span></code> step, deprecated since 0.8.5, has been removed.  The <code class="docutils literal notranslate"><span class="pre">P4</span></code> step remains.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">fetch_spec</span></code> argument to <code class="docutils literal notranslate"><span class="pre">GitPoller</span></code> is no longer supported.
<code class="docutils literal notranslate"><span class="pre">GitPoller</span></code> now only downloads branches that it is polling, so specifies a refspec itself.</p>
</li>
<li><p class="first">The format of the changes produced by <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal notranslate"><span class="pre">SVNPoller</span></code></a> has changed: directory pathnames end with a forward slash.
This allows the <code class="docutils literal notranslate"><span class="pre">split_file</span></code> function to distinguish between files and directories.
Customized split functions may need to be adjusted accordingly.</p>
</li>
<li><p class="first"><a class="reference internal" href="#withproperties"><span class="std std-ref">FlattenList</span></a> has been deprecated in favor of <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.
<cite>Interpolate</cite> doesn’t handle functions as keyword arguments.
The following code using <code class="docutils literal notranslate"><span class="pre">WithProperties</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="k">import</span> <span class="n">WithProperties</span>
<span class="k">def</span> <span class="nf">determine_foo</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="s1">&#39;qux&#39;</span>
<span class="n">WithProperties</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(foo)s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">determine_foo</span><span class="p">)</span>
</pre></div>
</div>
<p>can be replaced with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="k">import</span> <span class="n">implementer</span>
<span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="k">import</span> <span class="n">IRenderable</span>
<span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="k">import</span> <span class="n">Interpolate</span>
<span class="nd">@implementer</span><span class="p">(</span><span class="n">IRenderable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">determineFoo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getRenderingFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;qux&#39;</span>
<span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(kw:foo)s&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">determineFoo</span><span class="p">())</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.20.2.3. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">BuildStep.start</span></code> can now optionally return a deferred and any errback will
be handled gracefully. If you use <code class="docutils literal notranslate"><span class="pre">inlineCallbacks</span></code>, this means that unexpected
exceptions and failures raised will be captured and logged and the build shut
down normally.</li>
<li>The helper methods <code class="docutils literal notranslate"><span class="pre">getState</span></code> and <code class="docutils literal notranslate"><span class="pre">setState</span></code> from <code class="docutils literal notranslate"><span class="pre">BaseScheduler</span></code> have
been factored into <code class="docutils literal notranslate"><span class="pre">buildbot.util.state.StateMixin</span></code> for use elsewhere.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.20.3. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.20.3.1. Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
</div>
<div class="section" id="id2">
<h5>5.20.3.2. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The <code class="docutils literal notranslate"><span class="pre">P4Sync</span></code> step, deprecated since 0.8.5, has been removed.  The <code class="docutils literal notranslate"><span class="pre">P4</span></code> step remains.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h4>5.20.4. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the
Git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log v0.8.6..v0.8.7
</pre></div>
</div>
</div>
<div class="section" id="older-versions">
<h4>5.20.5. Older Versions<a class="headerlink" href="#older-versions" title="Permalink to this headline">¶</a></h4>
<p>Release notes for older versions of Buildbot are available in the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/docs/relnotes/">master/docs/relnotes/</a> directory of the source tree.
Starting with version 0.8.6, they are also available under the appropriate version at <a class="reference external" href="http://buildbot.net/buildbot/docs">http://buildbot.net/buildbot/docs</a>.</p>
</div>
</div>
<span id="document-relnotes/0.8.6"></span><div class="section" id="release-notes-for-buildbot-v0-8-6p1">
<h3>5.21. Release Notes for Buildbot v0.8.6p1<a class="headerlink" href="#release-notes-for-buildbot-v0-8-6p1" title="Permalink to this headline">¶</a></h3>
<p>The following are the release notes for Buildbot v0.8.6p1.
Buildbot v0.8.6 was released on March 11, 2012.
Buildbot v0.8.6p1 was released on March 25, 2012.</p>
<div class="section" id="p1">
<h4>5.21.1. 0.8.6p1<a class="headerlink" href="#p1" title="Permalink to this headline">¶</a></h4>
<p>In addition to what’s listed below, the 0.8.6p1 release adds the following.</p>
<ul class="simple">
<li>Builders are no longer displayed in the order they were configured.  This was
never intended behavior, and will become impossible in the distributed
architecture planned for Buildbot-0.9.x.  As of 0.8.6p1, builders are sorted
naturally: lexically, but with numeric segments sorted numerically.</li>
<li>Slave properties in the configuration are now handled correctly.</li>
<li>The web interface buttons to cancel individual builds now appear when
configured.</li>
<li>The ForceScheduler’s properties are correctly updated on reconfig -
<a class="reference external" href="http://trac.buildbot.net/ticket/2248">bug #2248</a>.</li>
<li>If a slave is lost while waiting for locks, it is properly cleaned up -
<a class="reference external" href="http://trac.buildbot.net/ticket/2247">bug #2247</a>.</li>
<li>Crashes when adding new steps to a factory in a reconfig are fixed -
<a class="reference external" href="http://trac.buildbot.net/ticket/2252">bug #2252</a>.</li>
<li>MailNotifier AttributeErrors are fixed - <a class="reference external" href="http://trac.buildbot.net/ticket/2254">bug #2254</a>.</li>
<li>Cleanup from failed builds is improved - <a class="reference external" href="http://trac.buildbot.net/ticket/2253">bug #2253</a>.</li>
</ul>
</div>
<div class="section" id="master">
<h4>5.21.2. Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>If you are using the GitHub hook, carefully consider the security
implications of allowing un-authenticated change requests, which can
potentially build arbitrary code.  See <a class="reference external" href="http://trac.buildbot.net/ticket/2186">bug #2186</a>.</li>
</ul>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h5>5.21.2.1. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">Forced builds now require that a <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><code class="xref bb bb-sched docutils literal notranslate"><span class="pre">ForceScheduler</span></code></a> be defined in the
Buildbot configuration.  For compatible behavior, this should look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.schedulers.forcesched</span> <span class="k">import</span> <span class="n">ForceScheduler</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ForceScheduler</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;force&quot;</span><span class="p">,</span>
                        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="o">...</span> <span class="p">]))</span>
</pre></div>
</div>
<p>Where all of the builder names in the configuration are listed.  See the
documentation for the <em>much</em> more flexible configuration options now
available.</p>
</li>
<li><p class="first">This is the last release of Buildbot that will be compatible with Python 2.4.
The next version will minimally require Python-2.5.  See <a class="reference external" href="http://trac.buildbot.net/ticket/2157">bug #2157</a>.</p>
</li>
<li><p class="first">This is the last release of Buildbot that will be compatible with
Twisted-8.x.y.  The next version will minimally require Twisted-9.0.0.  See
<a class="reference external" href="http://trac.buildbot.net/ticket/2182">bug #2182</a>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">start</span></code> no longer invokes make if a <code class="docutils literal notranslate"><span class="pre">Makefile.buildbot</span></code> exists.
If you are using this functionality, consider invoking make directly.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code> option <code class="docutils literal notranslate"><span class="pre">--username</span></code> has been removed as
promised in <a class="reference external" href="http://trac.buildbot.net/ticket/1711">bug #1711</a>.</p>
</li>
<li><p class="first">StatusReceivers’ checkConfig method should now take an additional <cite>errors</cite>
parameter and call its <a class="reference internal" href="#buildbot.config.ConfigErrors.addError" title="buildbot.config.ConfigErrors.addError"><code class="xref py py-meth docutils literal notranslate"><span class="pre">addError</span></code></a>
method to indicate errors.</p>
</li>
<li><p class="first">The Gerrit status callback now gets an additional parameter (the master
status).  If you use this callback, you will need to adjust its
implementation.</p>
</li>
<li><p class="first">SQLAlchemy-Migrate version 0.6.0 is no longer supported.  See
<a class="reference internal" href="#buildmaster-requirements"><span class="std std-ref">Buildmaster Requirements</span></a>.</p>
</li>
<li><p class="first">Older versions of SQLite which could limp along for previous versions of
Buildbot are no longer supported.  The minimum version is 3.4.0, and 3.7.0 or
higher is recommended.</p>
</li>
<li><p class="first">The master-side Git step now checks out ‘HEAD’ by default, rather than
master, which translates to the default branch on the upstream repository.  See
<a class="reference external" href="https://github.com/buildbot/buildbot/pull/301">pull request 301</a>.</p>
</li>
<li><p class="first">The format of the repository strings created by <code class="docutils literal notranslate"><span class="pre">hgbuildbot</span></code> has changed to
contain the entire repository URL, based on the <code class="docutils literal notranslate"><span class="pre">web.baseurl</span></code> value in
<code class="docutils literal notranslate"><span class="pre">hgrc</span></code>.  To continue the old (incorrect) behavior, set
<code class="docutils literal notranslate"><span class="pre">hgbuildbot.baseurl</span></code> to an empty string as suggested in the Buildbot
manual.</p>
</li>
<li><p class="first">Master Side <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> Step has been corrected to properly use
<code class="docutils literal notranslate"><span class="pre">--revision</span></code> when <code class="docutils literal notranslate"><span class="pre">alwaysUseLatest</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code> when in the
<code class="docutils literal notranslate"><span class="pre">full</span></code> mode. See <a class="reference external" href="http://trac.buildbot.net/ticket/2194">bug #2194</a></p>
</li>
<li><p class="first">Master Side <a class="reference internal" href="#step-SVN" title="SVN"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">SVN</span></code></a> Step parameter svnurl has been renamed repourl, to
be consistent with other master-side source steps.</p>
</li>
<li><p class="first">Master Side <a class="reference internal" href="#step-Mercurial" title="Mercurial"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">Mercurial</span></code></a> step parameter <code class="docutils literal notranslate"><span class="pre">baseURL</span></code> has been merged
with <code class="docutils literal notranslate"><span class="pre">repourl</span></code> parameter. The behavior of the step is already controlled by
<code class="docutils literal notranslate"><span class="pre">branchType</span></code> parameter, so just use a single argument to specify the repository.</p>
</li>
<li><p class="first">Passing a <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.process.buildstep.BuildStep</span></code></a> subclass (rather than
instance) to <code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.process.factory.BuildFactory.addStep</span></code> has long been
deprecated, and will be removed in version 0.8.7.</p>
</li>
<li><p class="first">The <cite>hgbuildbot</cite> tool now defaults to the ‘inrepo’ branch type.  Users who do
not explicitly set a branch type would previously have seen empty branch strings,
and will now see a branch string based on the branch in the repository (e.g.,
<cite>default</cite>).</p>
</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h5>5.21.2.2. Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>The interface for runtime access to the master’s configuration has changed
considerably.  See <a class="reference internal" href="#document-developer/config"><span class="doc">Configuration</span></a> for more details.</li>
<li>The DB connector methods <code class="docutils literal notranslate"><span class="pre">completeBuildset</span></code>, <code class="docutils literal notranslate"><span class="pre">completeBuildRequest</span></code>, and
<code class="docutils literal notranslate"><span class="pre">claimBuildRequest</span></code> now take an optional <code class="docutils literal notranslate"><span class="pre">complete_at</span></code> parameter to
specify the completion time explicitly.</li>
<li>Buildbot now sports sourcestamp sets, which collect multiple sourcestamps
used to generate a single build, thanks to Harry Borkhuis.  See
<a class="reference external" href="https://github.com/buildbot/buildbot/pull/287">pull request 287</a>.</li>
<li>Schedulers no longer have a <code class="docutils literal notranslate"><span class="pre">schedulerid</span></code>, but rather an <code class="docutils literal notranslate"><span class="pre">objectid</span></code>.  In
a related change, the <code class="docutils literal notranslate"><span class="pre">schedulers</span></code> table has been removed, along with the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">buildbot.db.schedulers.SchedulersConnectorComponent.getSchedulerId</span></code>
method.</li>
<li>The Dependent scheduler tracks its upstream buildsets using
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.db.schedulers.StateConnectorComponent</span></code>, so the
<code class="docutils literal notranslate"><span class="pre">scheduler_upstream_buildsets</span></code> table has been removed, along with
corresponding (undocumented)
<code class="xref py py-class docutils literal notranslate"><span class="pre">buildbot.db.buildsets.BuildsetsConnector</span></code> methods.</li>
<li>Errors during configuration (in particular in <code class="xref py py-class docutils literal notranslate"><span class="pre">BuildStep</span></code> constructors),
should be reported by calling <a class="reference internal" href="#buildbot.config.error" title="buildbot.config.error"><code class="xref py py-func docutils literal notranslate"><span class="pre">buildbot.config.error</span></code></a>.</li>
</ul>
</div>
<div class="section" id="features">
<h5>5.21.2.3. Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h5>
<ul>
<li><p class="first">The IRC status bot now display build status in colors by default.
It is controllable and may be disabled with useColors=False in constructor.</p>
</li>
<li><p class="first">Buildbot can now take advantage of authentication done by a front-end web
server - see <a class="reference external" href="https://github.com/buildbot/buildbot/pull/266">pull request 266</a>.</p>
</li>
<li><p class="first">Buildbot supports a simple cookie-based login system, so users no longer need
to enter a username and password for every request.  See the earlier commits
in <a class="reference external" href="https://github.com/buildbot/buildbot/pull/278">pull request 278</a>.</p>
</li>
<li><p class="first">The master-side SVN step now has an <cite>export</cite> method which is similar to
<cite>copy</cite>, but the build directory does not contain Subversion metadata. (<a class="reference external" href="http://trac.buildbot.net/ticket/2078">bug #2078</a>)</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">Property</span></code> instances will now render any properties in the
default value if necessary.  This makes possible constructs like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">command</span><span class="o">=</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;default-command&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">Buildbot has a new web hook to handle push notifications from Google Code -
see <a class="reference external" href="https://github.com/buildbot/buildbot/pull/278">pull request 278</a>.</p>
</li>
<li><p class="first">Revision links are now generated by a flexible runtime conversion configured
by <a class="reference internal" href="#cfg-revlink" title="revlink"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">revlink</span></code></a> - see <a class="reference external" href="https://github.com/buildbot/buildbot/pull/280">pull request 280</a>.</p>
</li>
<li><p class="first">Shell command steps will now “flatten” nested lists in the <code class="docutils literal notranslate"><span class="pre">command</span></code>
argument.  This allows substitution of multiple command-line arguments using
properties.  See <a class="reference external" href="http://trac.buildbot.net/ticket/2150">bug #2150</a>.</p>
</li>
<li><p class="first">Steps now take an optional <code class="docutils literal notranslate"><span class="pre">hideStepIf</span></code> parameter to suppress the step
from the waterfall and build details in the web. (<a class="reference external" href="http://trac.buildbot.net/ticket/1743">bug #1743</a>)</p>
</li>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">Trigger</span></code> steps with <code class="docutils literal notranslate"><span class="pre">waitForFinish=True</span></code> now receive a URL to
all the triggered builds. This URL is displayed in the waterfall and build
details. See <a class="reference external" href="http://trac.buildbot.net/ticket/2170">bug #2170</a>.</p>
</li>
<li><p class="first">The <code class="docutils literal notranslate"><span class="pre">master/contrib/fakemaster.py</span></code> script allows you to run arbitrary commands on a slave by emulating a master.
See the file itself for documentation.</p>
</li>
<li><p class="first">MailNotifier allows multiple notification modes in the same instance.  See
<a class="reference external" href="http://trac.buildbot.net/ticket/2205">bug #2205</a>.</p>
</li>
<li><p class="first">SVNPoller now allows passing extra arguments via argument <code class="docutils literal notranslate"><span class="pre">extra_args</span></code>.
See <a class="reference external" href="http://trac.buildbot.net/ticket/1766">bug #1766</a></p>
</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h4>5.21.3. Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h4>
<div class="section" id="id1">
<h5>5.21.3.1. Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>BitKeeper support is in the “Last-Rites” state, and will be removed in the
next version unless a maintainer steps forward.</li>
</ul>
</div>
<div class="section" id="id2">
<h5>5.21.3.2. Features<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h5>
</div>
</div>
<div class="section" id="details">
<h4>5.21.4. Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h4>
<p>For a more detailed description of the changes made in this version, see the
Git log itself:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git log buildbot-0.8.5..buildbot-0.8.6
</pre></div>
</div>
</div>
<div class="section" id="older-versions">
<h4>5.21.5. Older Versions<a class="headerlink" href="#older-versions" title="Permalink to this headline">¶</a></h4>
<p>Release notes for older versions of Buildbot are available in the <a class="reference external" href="https://github.com/buildbot/buildbot/tree/master/master/docs/relnotes/">master/docs/relnotes/</a> directory of the source tree, or in the archived documentation for those versions at <a class="reference external" href="http://buildbot.net/buildbot/docs">http://buildbot.net/buildbot/docs</a>.</p>
</div>
</div>
</div>
<p>Note that Buildbot-0.8.11 was never released.</p>
</div>
<span id="document-indices"></span><div class="section" id="indices-and-tables">
<h2>6. Indices and Tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="bb-cfg.html" title="Buildmaster Configuration Index"><em>Buildmaster Configuration Index</em></a></li>
<li><a class="reference internal" href="bb-sched.html" title="Scheduler Index"><em>Scheduler Index</em></a></li>
<li><a class="reference internal" href="bb-chsrc.html" title="Change Source Index"><em>Change Source Index</em></a></li>
<li><a class="reference internal" href="bb-step.html" title="Build Step Index"><em>Build Step Index</em></a></li>
<li><a class="reference internal" href="bb-reporter.html" title="Reporter Target Index"><em>Reporter Target Index</em></a></li>
<li><a class="reference internal" href="bb-cmdline.html" title="Command Line Index"><em>Command Line Index</em></a></li>
<li><a class="reference internal" href="bb-msg.html" title="MQ Routing Key Index"><em>MQ Routing Key Index</em></a></li>
<li><a class="reference internal" href="bb-event.html" title="Data API Event Index"><em>Data API Event Index</em></a></li>
<li><a class="reference internal" href="bb-rtype.html" title="REST/Data API Resource Type Index"><em>REST/Data API Resource Type Index</em></a></li>
<li><a class="reference internal" href="bb-rpath.html" title="REST/Data API Path Index"><em>REST/Data API Path Index</em></a></li>
<li><a class="reference internal" href="bb-raction.html" title="REST/Data API Actions Index"><em>REST/Data API Actions Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>
</div>
<div class="section" id="copyright">
<h2>Copyright<a class="headerlink" href="#copyright" title="Permalink to this headline">¶</a></h2>
<p>This documentation is part of Buildbot.</p>
<p>Buildbot is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, version 2.</p>
<p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
See the GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</p>
<p>Copyright Buildbot Team Members</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#document-index">
              <img class="logo" src="_static/full_logo.png" alt="Logo"/>
            </a></p><h3>Table Of Contents</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-tutorial/index">1. Buildbot Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-manual/index">2. Buildbot Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-developer/index">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-relnotes/index">4. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="#older-release-notes">5. Older Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-indices">6. Indices and Tables</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>