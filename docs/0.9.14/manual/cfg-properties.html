
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>2.5.8. Properties &#8212; Buildbot 0.9.14 documentation</title>
    <link rel="stylesheet" href="../_static/qtile.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.14',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/buildbot.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2.5.9. Build Steps" href="cfg-buildsteps.html" />
    <link rel="prev" title="2.5.7. Build Factories" href="cfg-buildfactories.html" /> 
  <!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cfg-buildsteps.html" title="2.5.9. Build Steps"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cfg-buildfactories.html" title="2.5.7. Build Factories"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Buildbot 0.9.14 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >2. Buildbot Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="configuration.html" accesskey="U">2.5. Configuration</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="properties">
<span id="index-0"></span><span id="id1"></span><h1>2.5.8. Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h1>
<p>Build properties are a generalized way to provide configuration information to build steps; see <a class="reference internal" href="concepts.html#build-properties"><span class="std std-ref">Build Properties</span></a> for the conceptual overview of properties.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#common-build-properties" id="id10">Common Build Properties</a></li>
<li><a class="reference internal" href="#source-stamp-attributes" id="id11">Source Stamp Attributes</a></li>
<li><a class="reference internal" href="#using-properties-in-steps" id="id12">Using Properties in Steps</a></li>
</ul>
</div>
<p>Some build properties come from external sources and are set before the build begins; others are set during the build, and available for later steps.
The sources for properties are:</p>
<dl class="docutils">
<dt><a class="reference internal" href="cfg-global.html#cfg-properties" title="properties"><code class="xref bb bb-cfg docutils literal"><span class="pre">global</span> <span class="pre">configuration</span></code></a></dt>
<dd>These properties apply to all builds.</dd>
<dt><a class="reference internal" href="cfg-schedulers.html#configuring-schedulers"><span class="std std-ref">schedulers</span></a></dt>
<dd>A scheduler can specify properties that become available to all builds it starts.</dd>
<dt><a class="reference internal" href="cfg-changesources.html#change-sources"><span class="std std-ref">changes</span></a></dt>
<dd>A change can have properties attached to it, supplying extra information gathered by the change source.
This is most commonly used with the <a class="reference internal" href="cmdline.html#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal"><span class="pre">sendchange</span></code></a> command.</dd>
<dt>forced builds</dt>
<dd>The “Force Build” form allows users to specify properties</dd>
<dt><a class="reference internal" href="cfg-workers.html#cfg-workers" title="workers"><code class="xref bb bb-cfg docutils literal"><span class="pre">workers</span></code></a></dt>
<dd>A worker can pass properties on to the builds it performs.</dd>
<dt><a class="reference internal" href="#common-build-properties"><span class="std std-ref">builds</span></a></dt>
<dd>A build automatically sets a number of properties on itself.</dd>
<dt><a class="reference internal" href="cfg-builders.html#cfg-builders" title="builders"><code class="xref bb bb-cfg docutils literal"><span class="pre">builders</span></code></a></dt>
<dd>A builder can set properties on all the builds it runs.</dd>
<dt><a class="reference internal" href="cfg-buildsteps.html#build-steps"><span class="std std-ref">steps</span></a></dt>
<dd>The steps of a build can set properties that are available to subsequent steps.
In particular, source steps set the <cite>got_revision</cite> property.</dd>
</dl>
<p>If the same property is supplied in multiple places, the final appearance takes precedence.
For example, a property set in a builder configuration will override one supplied by a scheduler.</p>
<p>Properties are stored internally in JSON format, so they are limited to basic types of data: numbers, strings, lists, and dictionaries.</p>
<div class="section" id="common-build-properties">
<span id="index-1"></span><span id="id2"></span><h2><a class="toc-backref" href="#id10">2.5.8.1. Common Build Properties</a><a class="headerlink" href="#common-build-properties" title="Permalink to this headline">¶</a></h2>
<p>The following build properties are set when the build is started, and are available to all steps.</p>
<dl class="docutils" id="index-2">
<dt><code class="docutils literal"><span class="pre">got_revision</span></code></dt>
<dd><p class="first">This property is set when a <code class="xref py py-class docutils literal"><span class="pre">Source</span></code> step checks out the source tree, and provides the revision that was actually obtained from the VC system.
In general this should be the same as <code class="docutils literal"><span class="pre">revision</span></code>, except for non-absolute sourcestamps, where <code class="docutils literal"><span class="pre">got_revision</span></code> indicates what revision was current when the checkout was performed.
This can be used to rebuild the same source code later.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For some VC systems (Darcs in particular), the revision is a large string containing newlines, and is not suitable for interpolation into a filename.</p>
</div>
<p class="last">For multi-codebase builds (where codebase is not the default <cite>‘’</cite>), this property is a dictionary, keyed by codebase.</p>
</dd>
</dl>
<dl class="docutils" id="index-3">
<dt><code class="docutils literal"><span class="pre">buildername</span></code></dt>
<dd>This is a string that indicates which <code class="xref py py-class docutils literal"><span class="pre">Builder</span></code> the build was a part of.
The combination of buildername and buildnumber uniquely identify a build.</dd>
</dl>
<dl class="docutils" id="index-4">
<dt><code class="docutils literal"><span class="pre">buildnumber</span></code></dt>
<dd>Each build gets a number, scoped to the <code class="xref py py-class docutils literal"><span class="pre">Builder</span></code> (so the first build performed on any given <code class="xref py py-class docutils literal"><span class="pre">Builder</span></code> will have a build number of 0).
This integer property contains the build’s number.</dd>
</dl>
<dl class="docutils" id="index-5">
<dt><code class="docutils literal"><span class="pre">workername</span></code></dt>
<dd>This is a string which identifies which worker the build is running on.</dd>
</dl>
<dl class="docutils" id="index-6">
<dt><code class="docutils literal"><span class="pre">scheduler</span></code></dt>
<dd>If the build was started from a scheduler, then this property will contain the name of that scheduler.</dd>
<dt><code class="docutils literal"><span class="pre">builddir</span></code></dt>
<dd>The absolute path of the base working directory on the worker, of the current builder.</dd>
</dl>
<p id="index-7">For single codebase builds, where the codebase is <cite>‘’</cite>, the following <a class="reference internal" href="#source-stamp-attributes"><span class="std std-ref">Source Stamp Attributes</span></a> are also available as properties: <code class="docutils literal"><span class="pre">branch</span></code>, <code class="docutils literal"><span class="pre">revision</span></code>, <code class="docutils literal"><span class="pre">repository</span></code>, and <code class="docutils literal"><span class="pre">project</span></code> .</p>
</div>
<div class="section" id="source-stamp-attributes">
<span id="id3"></span><h2><a class="toc-backref" href="#id11">2.5.8.2. Source Stamp Attributes</a><a class="headerlink" href="#source-stamp-attributes" title="Permalink to this headline">¶</a></h2>
<p id="index-8"><code class="docutils literal"><span class="pre">branch</span></code>
<code class="docutils literal"><span class="pre">revision</span></code>
<code class="docutils literal"><span class="pre">repository</span></code>
<code class="docutils literal"><span class="pre">project</span></code>
<code class="docutils literal"><span class="pre">codebase</span></code></p>
<blockquote>
<div>For details of these attributes see <a class="reference internal" href="concepts.html"><span class="doc">Concepts</span></a>.</div></blockquote>
<p><code class="docutils literal"><span class="pre">changes</span></code></p>
<blockquote>
<div>This attribute is a list of dictionaries representing the changes that make up this sourcestamp.</div></blockquote>
</div>
<div class="section" id="using-properties-in-steps">
<h2><a class="toc-backref" href="#id12">2.5.8.3. Using Properties in Steps</a><a class="headerlink" href="#using-properties-in-steps" title="Permalink to this headline">¶</a></h2>
<p>For the most part, properties are used to alter the behavior of build steps during a build.
This is done by using <span class="target" id="index-9"></span>renderables (objects implementing the <code class="xref py py-class docutils literal"><span class="pre">IRenderable</span></code> interface) as step parameters.
When the step is started, each such object is rendered using the current values of the build properties, and the resultant rendering is substituted as the actual value of the step parameter.</p>
<p>Buildbot offers several renderable object types covering common cases.
It’s also possible to <a class="reference internal" href="#custom-renderables"><span class="std std-ref">create custom renderables</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Properties are defined while a build is in progress; their values are not available when the configuration file is parsed.
This can sometimes confuse newcomers to Buildbot!
In particular, the following is a common error:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">Property</span><span class="p">(</span><span class="s1">&#39;release_train&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">This does not work because the value of the property is not available when the <code class="docutils literal"><span class="pre">if</span></code> statement is executed.
However, Python will not detect this as an error - you will just never see the step added to the factory.</p>
</div>
<p>You can use renderables in most step parameters.
Please file bugs for any parameters which do not accept renderables.</p>
<div class="section" id="property">
<span id="index-10"></span><span id="id4"></span><h3>Property<a class="headerlink" href="#property" title="Permalink to this headline">¶</a></h3>
<p>The simplest renderable is <code class="xref py py-class docutils literal"><span class="pre">Property</span></code>, which renders to the value of the property named by its argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;buildername:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;buildername&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>You can specify a default value by passing a <code class="docutils literal"><span class="pre">default</span></code> keyword argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;warnings:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>The default value is used when the property doesn’t exist, or when the value is something Python regards as <code class="docutils literal"><span class="pre">False</span></code>.
The <code class="docutils literal"><span class="pre">defaultWhenFalse</span></code> argument can be set to <code class="docutils literal"><span class="pre">False</span></code> to force buildbot to use the default argument only if the parameter is not set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="s1">&#39;warnings:&#39;</span><span class="p">,</span>
                             <span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
                                           <span class="n">defaultWhenFalse</span><span class="o">=</span><span class="kc">False</span><span class="p">)]))</span>
</pre></div>
</div>
<p>The default value can be a renderable itself, e.g.,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">command</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;default-command&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="interpolate">
<span id="index-11"></span><span id="id5"></span><h3>Interpolate<a class="headerlink" href="#interpolate" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-class docutils literal"><span class="pre">Property</span></code> can only be used to replace an entire argument: in the example above, it replaces an argument to <code class="docutils literal"><span class="pre">echo</span></code>.
Often, properties need to be interpolated into strings, instead.
The tool for that job is <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.</p>
<p>The more common pattern is to use Python dictionary-style string interpolation by using the <code class="docutils literal"><span class="pre">%(prop:&lt;propname&gt;)s</span></code> syntax.
In this form, the property name goes in the parentheses, as above.
A common mistake is to omit the trailing “s”, leading to a rather obscure error from Python (“ValueError: unsupported format character”).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;REVISION=%(prop:got_revision)s&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dist&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This example will result in a <code class="docutils literal"><span class="pre">make</span></code> command with an argument like <code class="docutils literal"><span class="pre">REVISION=12098</span></code>.</p>
<p id="interpolate-dictstyle">The syntax of dictionary-style interpolation is a selector, followed by a colon, followed by a selector specific key, optionally followed by a colon and a string indicating how to interpret the value produced by the key.</p>
<p>The following selectors are supported.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">prop</span></code></dt>
<dd>The key is the name of a property.</dd>
<dt><code class="docutils literal"><span class="pre">src</span></code></dt>
<dd>The key is a codebase and source stamp attribute, separated by a colon.
Note, it is <code class="docutils literal"><span class="pre">%(src:&lt;codebase&gt;:&lt;ssattr&gt;)s</span></code> syntax, which differs from other selectors.</dd>
<dt><code class="docutils literal"><span class="pre">kw</span></code></dt>
<dd>The key refers to a keyword argument passed to <code class="docutils literal"><span class="pre">Interpolate</span></code>.
Those keyword arguments may be ordinary values or renderables.</dd>
<dt><code class="docutils literal"><span class="pre">secrets</span></code></dt>
<dd>The key refers to a secret provided by a provider declared in <a class="reference internal" href="cfg-global.html#cfg-secretsProviders" title="secretsProviders"><code class="xref bb bb-cfg docutils literal"><span class="pre">secretsProviders</span></code></a> .</dd>
</dl>
<p>The following ways of interpreting the value are available.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">-replacement</span></code></dt>
<dd>If the key exists, substitute its value; otherwise, substitute <code class="docutils literal"><span class="pre">replacement</span></code>.
<code class="docutils literal"><span class="pre">replacement</span></code> may be empty (<code class="docutils literal"><span class="pre">%(prop:propname:-)s</span></code>).
This is the default.</dd>
<dt><code class="docutils literal"><span class="pre">~replacement</span></code></dt>
<dd>Like <code class="docutils literal"><span class="pre">-replacement</span></code>, but only substitutes the value of the key if it is something Python regards as <code class="docutils literal"><span class="pre">True</span></code>.
Python considers <code class="docutils literal"><span class="pre">None</span></code>, 0, empty lists, and the empty string to be false, so such values will be replaced by <code class="docutils literal"><span class="pre">replacement</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">+replacement</span></code></dt>
<dd>If the key exists, substitute <code class="docutils literal"><span class="pre">replacement</span></code>; otherwise, substitute an empty string.</dd>
</dl>
<p><code class="docutils literal"><span class="pre">?|sub_if_exists|sub_if_missing</span></code></p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">#?|sub_if_true|sub_if_false</span></code></dt>
<dd>Ternary substitution, depending on either the key being present (with <code class="docutils literal"><span class="pre">?</span></code>, similar to <code class="docutils literal"><span class="pre">+</span></code>) or being <code class="docutils literal"><span class="pre">True</span></code> (with <code class="docutils literal"><span class="pre">#?</span></code>, like <code class="docutils literal"><span class="pre">~</span></code>).
Notice that there is a pipe immediately following the question mark <em>and</em> between the two substitution alternatives.
The character that follows the question mark is used as the delimiter between the two alternatives.
In the above examples, it is a pipe, but any character other than <code class="docutils literal"><span class="pre">(</span></code> can be used.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Although these are similar to shell substitutions, no other substitutions are currently supported.</p>
</div>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;save-build-artifacts-script.sh&#39;</span><span class="p">,</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-r %(prop:repository)s&#39;</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-b %(src::branch)s&#39;</span><span class="p">),</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;-d %(kw:data)s&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="s2">&quot;some extra needed data&quot;</span><span class="p">)</span>
    <span class="p">]))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We use <code class="docutils literal"><span class="pre">%(src::branch)s</span></code> in most of examples, because <code class="docutils literal"><span class="pre">codebase</span></code> is empty by default.</p>
</div>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span>
        <span class="s1">&#39;make&#39;</span><span class="p">,</span>
        <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;REVISION=%(prop:got_revision:-%(src::revision:-unknown)s)s&#39;</span><span class="p">),</span>
        <span class="s1">&#39;dist&#39;</span>
    <span class="p">]))</span>
</pre></div>
</div>
<p>In addition, <code class="docutils literal"><span class="pre">Interpolate</span></code> supports using positional string interpolation.
Here, <code class="docutils literal"><span class="pre">%s</span></code> is used as a placeholder, and the substitutions (which may be renderables), are given as subsequent arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">TODO</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Like Python, you can use either positional interpolation <em>or</em> dictionary-style interpolation, not both.
Thus you cannot use a string like <code class="docutils literal"><span class="pre">Interpolate(&quot;foo-%(src::revision)s-%s&quot;,</span> <span class="pre">&quot;branch&quot;)</span></code>.</p>
</div>
</div>
<div class="section" id="renderer">
<span id="index-12"></span><span id="id6"></span><h3>Renderer<a class="headerlink" href="#renderer" title="Permalink to this headline">¶</a></h3>
<p>While Interpolate can handle many simple cases, and even some common conditionals, more complex cases are best handled with Python code.
The <code class="docutils literal"><span class="pre">renderer</span></code> decorator creates a renderable object whose rendering is obtained by calling the decorated function when the step it’s passed to begins.
The function receives an <code class="xref py py-class docutils literal"><span class="pre">IProperties</span></code> object, which it can use to examine the values of any and all properties.
For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>

<span class="nd">@util</span><span class="o">.</span><span class="n">renderer</span>
<span class="k">def</span> <span class="nf">makeCommand</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">]</span>
    <span class="n">cpus</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s1">&#39;CPUs&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cpus</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpus</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>
    <span class="n">command</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;%(prop:MAKETARGET)s&#39;</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">command</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="n">makeCommand</span><span class="p">))</span>
</pre></div>
</div>
<p>You can think of <code class="docutils literal"><span class="pre">renderer</span></code> as saying “call this function when the step starts”.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Since 0.9.3, renderer can itself return <code class="xref py py-class docutils literal"><span class="pre">IRenderable</span></code> objects or containers containing <code class="xref py py-class docutils literal"><span class="pre">IRenderable</span></code>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Config errors with Renderables may not always be caught via checkconfig</p>
</div>
</div>
<div class="section" id="transform">
<span id="index-13"></span><span id="id7"></span><h3>Transform<a class="headerlink" href="#transform" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">Transform</span></code> is an alternative to <code class="docutils literal"><span class="pre">renderer</span></code>.
While <code class="docutils literal"><span class="pre">renderer</span></code> is useful for creating new renderables, <code class="docutils literal"><span class="pre">Transform</span></code> is easier to use when you want to transform or combine the renderings of preexisting ones.</p>
<p><code class="docutils literal"><span class="pre">Transform</span></code> takes a function and any number of positional and keyword arguments.
The function must either be a callable object or a renderable producing one.
When rendered, a <code class="docutils literal"><span class="pre">Transform</span></code> first replaces all of its arguments that are renderables with their renderings, then calls the function, passing it the positional and keyword arguments, and returns the result as its own rendering.</p>
<p>For example, suppose <code class="docutils literal"><span class="pre">my_path</span></code> is a path on the worker, and you want to get it relative to the build directory.
You can do it like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="n">my_path_rel</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">,</span> <span class="n">my_path</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;builddir&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This works whether <code class="docutils literal"><span class="pre">my_path</span></code> is an ordinary string or a renderable.
<code class="docutils literal"><span class="pre">my_path_rel</span></code> will be a renderable in either case, however.</p>
</div>
<div class="section" id="flattenlist">
<span id="withproperties"></span><span id="index-14"></span><h3>FlattenList<a class="headerlink" href="#flattenlist" title="Permalink to this headline">¶</a></h3>
<p>If nested list should be flatten for some renderables, FlattenList could be used.
For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span> <span class="s1">&#39;make&#39;</span> <span class="p">],</span>
    <span class="n">descriptionDone</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">FlattenList</span><span class="p">([</span> <span class="s1">&#39;make &#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;done&#39;</span> <span class="p">]])</span>
<span class="p">))</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">descriptionDone</span></code> would be set to <code class="docutils literal"><span class="pre">[</span> <span class="pre">'make',</span> <span class="pre">'done'</span> <span class="pre">]</span></code> when the <code class="docutils literal"><span class="pre">ShellCommand</span></code> executes.
This is useful when a list-returning property is used in renderables.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ShellCommand automatically flattens nested lists in its <code class="docutils literal"><span class="pre">command</span></code> argument, so there is no need to use <code class="docutils literal"><span class="pre">FlattenList</span></code> for it.</p>
</div>
</div>
<div class="section" id="id8">
<h3>WithProperties<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This class is deprecated.
It is an older version of <a class="reference internal" href="#interpolate"><span class="std std-ref">Interpolate</span></a>.
It exists for compatibility with older configs.</p>
</div>
<p>The simplest use of this class is with positional string interpolation.
Here, <code class="docutils literal"><span class="pre">%s</span></code> is used as a placeholder, and property names are given as subsequent arguments:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;tar&quot;</span><span class="p">,</span> <span class="s2">&quot;czf&quot;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">WithProperties</span><span class="p">(</span><span class="s2">&quot;build-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">.tar.gz&quot;</span><span class="p">,</span> <span class="s2">&quot;branch&quot;</span><span class="p">,</span> <span class="s2">&quot;revision&quot;</span><span class="p">),</span>
            <span class="s2">&quot;source&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>If this <code class="xref py py-class docutils literal"><span class="pre">BuildStep</span></code> were used in a tree obtained from Git, it would create a tarball with a name like <code class="file docutils literal"><span class="pre">build-master-a7d3a333db708e786edb34b6af646edd8d4d3ad9.tar.gz</span></code>.</p>
<p id="index-15">The more common pattern is to use Python dictionary-style string interpolation by using the <code class="docutils literal"><span class="pre">%(propname)s</span></code> syntax.
In this form, the property name goes in the parentheses, as above.
A common mistake is to omit the trailing “s”, leading to a rather obscure error from Python (“ValueError: unsupported format character”).</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">steps</span><span class="p">,</span> <span class="n">util</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span>
            <span class="n">util</span><span class="o">.</span><span class="n">WithProperties</span><span class="p">(</span><span class="s1">&#39;REVISION=</span><span class="si">%(got_revision)s</span><span class="s1">&#39;</span><span class="p">),</span>
            <span class="s1">&#39;dist&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This example will result in a <code class="docutils literal"><span class="pre">make</span></code> command with an argument like <code class="docutils literal"><span class="pre">REVISION=12098</span></code>.</p>
<p id="withproperties-dictstyle">The dictionary-style interpolation supports a number of more advanced syntaxes in the parentheses.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">propname:-replacement</span></code></dt>
<dd>If <code class="docutils literal"><span class="pre">propname</span></code> exists, substitute its value; otherwise, substitute <code class="docutils literal"><span class="pre">replacement</span></code>.
<code class="docutils literal"><span class="pre">replacement</span></code> may be empty (<code class="docutils literal"><span class="pre">%(propname:-)s</span></code>)</dd>
<dt><code class="docutils literal"><span class="pre">propname:~replacement</span></code></dt>
<dd>Like <code class="docutils literal"><span class="pre">propname:-replacement</span></code>, but only substitutes the value of property <code class="docutils literal"><span class="pre">propname</span></code> if it is something Python regards as <code class="docutils literal"><span class="pre">True</span></code>.
Python considers <code class="docutils literal"><span class="pre">None</span></code>, 0, empty lists, and the empty string to be false, so such values will be replaced by <code class="docutils literal"><span class="pre">replacement</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">propname:+replacement</span></code></dt>
<dd>If <code class="docutils literal"><span class="pre">propname</span></code> exists, substitute <code class="docutils literal"><span class="pre">replacement</span></code>; otherwise, substitute an empty string.</dd>
</dl>
<p>Although these are similar to shell substitutions, no other substitutions are currently supported, and <code class="docutils literal"><span class="pre">replacement</span></code> in the above cannot contain more substitutions.</p>
<p>Note: like Python, you can use either positional interpolation <em>or</em> dictionary-style interpolation, not both.
Thus you cannot use a string like <code class="docutils literal"><span class="pre">WithProperties(&quot;foo-%(revision)s-%s&quot;,</span> <span class="pre">&quot;branch&quot;)</span></code>.</p>
</div>
<div class="section" id="custom-renderables">
<span id="id9"></span><h3>Custom Renderables<a class="headerlink" href="#custom-renderables" title="Permalink to this headline">¶</a></h3>
<p>If the options described above are not sufficient, more complex substitutions can be achieved by writing custom renderables.</p>
<p>The <code class="xref py py-class docutils literal"><span class="pre">IRenderable</span></code> interface is simple - objects must provide a <cite>getRenderingFor</cite> method.
The method should take one argument - an <code class="xref py py-class docutils literal"><span class="pre">IProperties</span></code> provider - and should return the rendered value or a deferred firing with one.
Pass instances of the class anywhere other renderables are accepted.
For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="k">import</span> <span class="n">IRenderable</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="k">import</span> <span class="n">implementer</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IRenderable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">DetermineFoo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getRenderingFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39;qux&#39;</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span> <span class="n">DetermineFoo</span><span class="p">()])</span>
</pre></div>
</div>
<p>or, more practically,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="k">import</span> <span class="n">IRenderable</span>
<span class="kn">from</span> <span class="nn">zope.interface</span> <span class="k">import</span> <span class="n">implementer</span>
<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="nd">@implementer</span><span class="p">(</span><span class="n">IRenderable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Now</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getRenderingFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;TIME=%(kw:now)s&#39;</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="n">Now</span><span class="p">())])</span>
</pre></div>
</div>
<p>This is equivalent to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">util</span>

<span class="nd">@util</span><span class="o">.</span><span class="n">renderer</span>
<span class="k">def</span> <span class="nf">now</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;TIME=%(kw:now)s&#39;</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="n">now</span><span class="p">)])</span>
</pre></div>
</div>
<p>Note that a custom renderable must be instantiated (and its constructor can take whatever arguments you’d like), whereas a function decorated with <code class="xref py py-func docutils literal"><span class="pre">renderer</span></code> can be used directly.</p>
</div>
<div class="section" id="url-for-build">
<span id="urlforbuild"></span><h3>URL for build<a class="headerlink" href="#url-for-build" title="Permalink to this headline">¶</a></h3>
<p>Its common to need to use the URL for the build in a step.
For this you can use a special custom renderer as following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;make&#39;</span><span class="p">,</span> <span class="n">util</span><span class="o">.</span><span class="n">Interpolate</span><span class="p">(</span><span class="s1">&#39;BUILDURL=%(kw:url)s&#39;</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">URLForBuild</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/header-text-transparent.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Table Of Contents</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="configuration.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cfg-intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-changesources.html">2.5.3. Change Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-schedulers.html">2.5.4. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-workers.html">2.5.5. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-builders.html">2.5.6. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-buildfactories.html">2.5.7. Build Factories</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.5.8. Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-buildsteps.html">2.5.9. Build Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-interlocks.html">2.5.10. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-reporters.html">2.5.11. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-www.html">2.5.12. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-wwwhooks.html">2.5.13. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-services.html">2.5.14. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-dbconfig.html">2.5.15. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-configurators.html">2.5.16. Configurators</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="worker-transition.html">2.6. Transition to “worker” terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="customization.html">2.7. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="new-style-steps.html">2.8. New-Style Build Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmdline.html">2.9. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="resources.html">2.10. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">2.11. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">2.12. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="deploy.html">2.13. Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../relnotes/index.html">4. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../relnotes/index.html#older-release-notes">5. Older Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../indices.html">6. Indices and Tables</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cfg-buildfactories.html"
                        title="previous chapter">2.5.7. Build Factories</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cfg-buildsteps.html"
                        title="next chapter">2.5.9. Build Steps</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/manual/cfg-properties.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>