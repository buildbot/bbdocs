

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Buildbot 0.8.7 documentation</title>
    
    <link rel="stylesheet" href="_static/agogo.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.8.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/buildbot.ico"/>
    <link rel="top" title="None" href="#" /> 
  <!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="#">
            <img class="logo" src="_static/header-text-transparent.png" alt="Logo"/>
          </a></p>
        <div class="headertitle"><a
          href="#">Buildbot 0.8.7 documentation</a></div>
        <div class="rel">
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <p>This is the BuildBot documentation for Buildbot version 0.8.7.</p>
<p>If you are evaluating Buildbot and would like to get started quickly, start
with the <a class="reference internal" href="#document-tutorial/index"><em>Tutorial</em></a>.  Regular users of Buildbot should
consult the <a class="reference internal" href="#document-manual/index"><em>Manual</em></a>, and those wishing to modify Buildbot
directly will want to be familiar with the <a class="reference internal" href="#document-developer/index"><em>Developer's Documentation</em></a>.</p>
<div class="section" id="table-of-contents">
<h1>Table Of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<span id="document-tutorial/index"></span><div class="section" id="buildbot-tutorial">
<h2>Buildbot Tutorial<a class="headerlink" href="#buildbot-tutorial" title="Permalink to this headline">¶</a></h2>
<p>Contents:</p>
<div class="toctree-wrapper compound">
<span id="document-tutorial/firstrun"></span><div class="section" id="first-run">
<span id="first-run-label"></span><h3>First Run<a class="headerlink" href="#first-run" title="Permalink to this headline">¶</a></h3>
<div class="section" id="goal">
<h4>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h4>
<p>This tutorial will take you from zero to running your first buildbot master
and slave as quickly as possible, without changing the default configuration.</p>
<p>This tutorial is all about instant gratification and the five minute
experience: in five minutes we want to convince you that this project Works,
and that you should seriously consider spending some more time learning
the system.  In this tutorial no configuration or code changes are done.</p>
<p>This tutorial assumes that you are running on Unix, but might be adaptable
easily to Windows.</p>
<p><em>For the quickest way through, you should be able to cut and paste each shell
block from this tutorial directly into a terminal.</em></p>
</div>
<div class="section" id="getting-the-code">
<h4>Getting the code<a class="headerlink" href="#getting-the-code" title="Permalink to this headline">¶</a></h4>
<p>There are many ways to get the code on your machine.
For this tutorial, we will use easy_install to install and run buildbot.
While this isn't the preferred method to install buildbot, it is the simplest
one to use for the purposes of this tutorial because it should work on all
systems.  (The preferred method would be to install buildbot from packages
of your distribution.)</p>
<dl class="docutils">
<dt>To make this work, you will need the following installed:</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="http://www.python.org/">python</a> and the development packages for it</li>
<li><a class="reference external" href="http://pypi.python.org/pypi/virtualenv/">virtualenv</a></li>
<li><a class="reference external" href="http://git-scm.com/">git</a></li>
</ul>
</dd>
</dl>
<p>Preferably, use your package installer to install these.</p>
<p>You will also need a working Internet connection, as virtualenv and
easy_install will need to download other projects from the Internet.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Buildbot does not require root access.  Run the commands in this tutorial
as a normal, unpriviledged user.</p>
</div>
<p>Let's dive in by typing at the terminal:</p>
<div class="highlight-python"><pre>cd
mkdir -p tmp/buildbot
cd tmp/buildbot
virtualenv --no-site-packages sandbox
source sandbox/bin/activate
easy_install buildbot</pre>
</div>
</div>
<div class="section" id="creating-a-master">
<h4>Creating a master<a class="headerlink" href="#creating-a-master" title="Permalink to this headline">¶</a></h4>
<p>At the terminal, type:</p>
<div class="highlight-python"><pre>buildbot create-master master
mv master/master.cfg.sample master/master.cfg</pre>
</div>
<p>Now start it:</p>
<div class="highlight-python"><pre>buildbot start master
tail -f master/twistd.log</pre>
</div>
<p>You will now see all of the log information from the master in this terminal.
You should see lines like this:</p>
<div class="highlight-python"><pre>2011-12-04 10:04:40-0600 [-] Starting factory &lt;buildbot.status.web.baseweb.RotateLogSite instance at 0x2e36638&gt;
2011-12-04 10:04:40-0600 [-] Setting up http.log rotating 10 files of 10000000 bytes each
2011-12-04 10:04:40-0600 [-] WebStatus using (/home/dustin/tmp/buildbot/master/public_html)
2011-12-04 10:04:40-0600 [-] removing 0 old schedulers, updating 0, and adding 1
2011-12-04 10:04:40-0600 [-] adding 1 new changesources, removing 0
2011-12-04 10:04:40-0600 [-] gitpoller: using workdir '/home/dustin/tmp/buildbot/master/gitpoller-workdir'
2011-12-04 10:04:40-0600 [-] gitpoller: initializing working dir from git://github.com/buildbot/pyflakes.git
2011-12-04 10:04:40-0600 [-] configuration update complete
2011-12-04 10:04:41-0600 [-] gitpoller: checking out master
2011-12-04 10:04:41-0600 [-] gitpoller: finished initializing working dir from git://github.com/buildbot/pyflakes.git at rev 1a4af6ec1dbb724b884ea14f439b272f30439e4d</pre>
</div>
</div>
<div class="section" id="creating-a-slave">
<h4>Creating a slave<a class="headerlink" href="#creating-a-slave" title="Permalink to this headline">¶</a></h4>
<p>Open a new terminal, and first enter the same sandbox you created before:</p>
<div class="highlight-python"><pre>cd
cd tmp/buildbot
source sandbox/bin/activate</pre>
</div>
<p>Install buildslave command:</p>
<div class="highlight-python"><pre>easy_install buildbot-slave</pre>
</div>
<p>Now, create the slave:</p>
<div class="highlight-python"><pre>buildslave create-slave slave localhost:9989 example-slave pass</pre>
</div>
<p>The user:host pair, username, and password should be the same as the ones in
master.cfg; verify this is the case by looking at the section for <cite>c['slaves']</cite>
and <cite>c['slavePortnum']</cite>:</p>
<div class="highlight-python"><pre>cat master/master.cfg</pre>
</div>
<p>Now, start the slave:</p>
<div class="highlight-python"><pre>buildslave start slave</pre>
</div>
<p>Check the slave's log:</p>
<div class="highlight-python"><pre>tail -f slave/twistd.log</pre>
</div>
<p>You should see lines like the following at the end of the worker log:</p>
<div class="highlight-python"><pre>2009-07-29 20:59:18+0200 [Broker,client] message from master: attached
2009-07-29 20:59:18+0200 [Broker,client] SlaveBuilder.remote_print(buildbot-full): message from master: attached
2009-07-29 20:59:18+0200 [Broker,client] sending application-level keepalives every 600 seconds</pre>
</div>
<p>Meanwhile, in the other terminal, in the master log, if you tail the log you should see lines like this:</p>
<div class="highlight-python"><pre>2011-03-13 18:46:58-0700 [Broker,1,127.0.0.1] slave 'example-slave' attaching from IPv4Address(TCP, '127.0.0.1', 41306)
2011-03-13 18:46:58-0700 [Broker,1,127.0.0.1] Got slaveinfo from 'example-slave'
2011-03-13 18:46:58-0700 [Broker,1,127.0.0.1] bot attached
2011-03-13 18:46:58-0700 [Broker,1,127.0.0.1] Buildslave example-slave attached to runtests</pre>
</div>
<p>You should now be able to go to <a class="reference external" href="http://localhost:8010">http://localhost:8010</a>, where you will see
a web page similar to:</p>
<img alt="index page" src="_images/index.png" />
<p>Click on the
<a class="reference external" href="http://localhost:8010/waterfall">Waterfall Display link</a>
and you get this:</p>
<img alt="empty waterfall." src="_images/waterfall-empty.png" />
<p>That's the end of the first tutorial.  A bit underwhelming, you say? Well, that
was the point! We just wanted to get you to dip your toes in the water.  It's
easy to take your first steps, but this is about as far as we can go without
touching the configuration.</p>
<p>You've got a taste now, but you're probably curious for more.  Let's step it
up a little in the second tutorial by changing the configuration and doing
an actual build. Continue on to <a class="reference internal" href="#quick-tour-label"><em>A Quick Tour</em></a></p>
</div>
</div>
<span id="document-tutorial/tour"></span><div class="section" id="a-quick-tour">
<span id="quick-tour-label"></span><h3>A Quick Tour<a class="headerlink" href="#a-quick-tour" title="Permalink to this headline">¶</a></h3>
<div class="section" id="goal">
<h4>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h4>
<p>This tutorial will expand on the <a class="reference internal" href="#first-run-label"><em>First Run</em></a> tutorial by taking a
quick tour around some of the features of buildbot that are hinted at in the
comments in the sample configuration.  We will simply change parts of the
default configuration and explain the activated features.</p>
<p>As a part of this tutorial, we will make buildbot do a few actual builds.</p>
<dl class="docutils">
<dt>This section will teach you how to:</dt>
<dd><ul class="first last simple">
<li>make simple configuration changes and activate them</li>
<li>deal with configuration errors</li>
<li>force builds</li>
<li>enable and control the IRC bot</li>
<li>enable ssh debugging</li>
<li>add a 'try' scheduler</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="setting-project-name-and-url">
<h4>Setting Project Name and URL<a class="headerlink" href="#setting-project-name-and-url" title="Permalink to this headline">¶</a></h4>
<p>Let's start simple by looking at where you would customize the buildbot's project name and URL.</p>
<p>We continue where we left off in the <a class="reference internal" href="#first-run-label"><em>First Run</em></a> tutorial.</p>
<p>Open a new terminal, and first enter the same sandbox you created before (where $EDITOR is your editor of choice like vim, gedit, or emacs):</p>
<div class="highlight-python"><pre>cd
cd tmp/buildbot
source sandbox/bin/activate
$EDITOR master/master.cfg</pre>
</div>
<p>Now, look for the section marked <em>PROJECT IDENTITY</em> which reads:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">####### PROJECT IDENTITY</span>

<span class="c"># the &#39;title&#39; string will appear at the top of this buildbot</span>
<span class="c"># installation&#39;s html.WebStatus home page (linked to the</span>
<span class="c"># &#39;titleURL&#39;) and is embedded in the title of the waterfall HTML page.</span>

<span class="n">c</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Pyflakes&quot;</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;titleURL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;http://divmod.org/trac/wiki/DivmodPyflakes&quot;</span>
</pre></div>
</div>
<p>If you want, you can change either of these links to anything you want to see what happens when you change them.</p>
<p>After making a change go into the terminal and type:</p>
<div class="highlight-python"><pre>buildbot reconfig master</pre>
</div>
<p>You will see a handful of lines of output from the master log, much like this:</p>
<div class="highlight-python"><pre>2011-12-04 10:11:09-0600 [-] loading configuration from /home/dustin/tmp/buildbot/master/master.cfg
2011-12-04 10:11:09-0600 [-] configuration update started
2011-12-04 10:11:09-0600 [-] builder runtests is unchanged
2011-12-04 10:11:09-0600 [-] removing IStatusReceiver &lt;WebStatus on port tcp:8010 at 0x2aee368&gt;
2011-12-04 10:11:09-0600 [-] (TCP Port 8010 Closed)
2011-12-04 10:11:09-0600 [-] Stopping factory &lt;buildbot.status.web.baseweb.RotateLogSite instance at 0x2e36638&gt;
2011-12-04 10:11:09-0600 [-] adding IStatusReceiver &lt;WebStatus on port tcp:8010 at 0x2c2d950&gt;
2011-12-04 10:11:09-0600 [-] RotateLogSite starting on 8010
2011-12-04 10:11:09-0600 [-] Starting factory &lt;buildbot.status.web.baseweb.RotateLogSite instance at 0x2e36e18&gt;
2011-12-04 10:11:09-0600 [-] Setting up http.log rotating 10 files of 10000000 bytes each
2011-12-04 10:11:09-0600 [-] WebStatus using (/home/dustin/tmp/buildbot/master/public_html)
2011-12-04 10:11:09-0600 [-] removing 0 old schedulers, updating 0, and adding 0
2011-12-04 10:11:09-0600 [-] adding 1 new changesources, removing 1
2011-12-04 10:11:09-0600 [-] gitpoller: using workdir '/home/dustin/tmp/buildbot/master/gitpoller-workdir'
2011-12-04 10:11:09-0600 [-] GitPoller repository already exists
2011-12-04 10:11:09-0600 [-] configuration update complete

Reconfiguration appears to have completed successfully.</pre>
</div>
<p>The important lines are the ones telling you that it is loading the new
configuration at the top, and the one at the bottom saying that the update
is complete.</p>
<p>Now, if you go back to
<a class="reference external" href="http://localhost:8010/waterfall">the waterfall page</a>,
you will see that the project's name is whatever you may have changed it to and when you click on the
the URL of the project name at the bottom of the page it should take you to the link you put in the configuration.</p>
</div>
<div class="section" id="configuration-errors">
<h4>Configuration Errors<a class="headerlink" href="#configuration-errors" title="Permalink to this headline">¶</a></h4>
<p>It is very common to make a mistake when configuring buildbot, so you might
as well see now what happens in that case and what you can do to fix
the error.</p>
<p>Open up the config again and introduce a syntax error by removing the first
single quote in the two lines you changed, so they read:</p>
<div class="highlight-python"><pre>c[title'] = "Pyflakes"
c['titleURL'] = "http://divmod.org/trac/wiki/DivmodPyflakes"</pre>
</div>
<p>This creates a Python SyntaxError.  Now go ahead and reconfig the buildmaster:</p>
<div class="highlight-python"><pre>buildbot reconfig master</pre>
</div>
<p>This time, the output looks like:</p>
<div class="highlight-python"><pre>2011-12-04 10:12:28-0600 [-] loading configuration from /home/dustin/tmp/buildbot/master/master.cfg
2011-12-04 10:12:28-0600 [-] configuration update started
2011-12-04 10:12:28-0600 [-] error while parsing config file
2011-12-04 10:12:28-0600 [-] Unhandled Error
        Traceback (most recent call last):
        File "/home/dustin/tmp/buildbot/sandbox/lib/python2.7/site-packages/buildbot-0.8.5-py2.7.egg/buildbot/master.py", line 197, in loadTheConfigFile
            d = self.loadConfig(f)
        File "/home/dustin/tmp/buildbot/sandbox/lib/python2.7/site-packages/buildbot-0.8.5-py2.7.egg/buildbot/master.py", line 579, in loadConfig
            d.addCallback(do_load)
        File "/home/dustin/tmp/buildbot/sandbox/lib/python2.7/site-packages/Twisted-11.1.0-py2.7-linux-x86_64.egg/twisted/internet/defer.py", line 298, in addCallback
            callbackKeywords=kw)
        File "/home/dustin/tmp/buildbot/sandbox/lib/python2.7/site-packages/Twisted-11.1.0-py2.7-linux-x86_64.egg/twisted/internet/defer.py", line 287, in addCallbacks
            self._runCallbacks()
        --- &lt;exception caught here&gt; ---
        File "/home/dustin/tmp/buildbot/sandbox/lib/python2.7/site-packages/Twisted-11.1.0-py2.7-linux-x86_64.egg/twisted/internet/defer.py", line 545, in _runCallbacks
            current.result = callback(current.result, *args, **kw)
        File "/home/dustin/tmp/buildbot/sandbox/lib/python2.7/site-packages/buildbot-0.8.5-py2.7.egg/buildbot/master.py", line 226, in do_load
            exec f in localDict
        exceptions.SyntaxError: EOL while scanning string literal (master.cfg, line 17)

Never saw reconfiguration finish.</pre>
</div>
<p>This time, it's clear that there was a mistake. in the configuration.
Luckily, the buildbot master will ignore the wrong configuration and keep
running with the previous configuration.</p>
<p>The message is clear enough, so open the configuration again, fix the error,
and reconfig the master.</p>
</div>
<div class="section" id="your-first-build">
<h4>Your First Build<a class="headerlink" href="#your-first-build" title="Permalink to this headline">¶</a></h4>
<p>By now you're probably thinking: &quot;All this time spent and still not done a
single build ? What was the name of this project again ?&quot;</p>
<p>On the <a class="reference external" href="http://localhost:8010/waterfall">waterfall</a>. page, click on the
runtests link.  You'll see a builder page, and in the upper-right corner is a
box where you can login.  The default username and password are both
&quot;pyflakes&quot;.  Once you've logged in, you will see some new options that allow
you to force a build:</p>
<img alt="force a build." src="_images/force-build.png" />
<p>Click <em>Force Build</em> - there's no need to fill in any of the fields in this
case.  Next, click on <a class="reference external" href="http://localhost:8010/waterfall?show=runtests">view in waterfall</a>.</p>
<p>You will now see:</p>
<img alt="an successful test run happened." src="_images/runtests-success.png" />
</div>
<div class="section" id="enabling-the-irc-bot">
<h4>Enabling the IRC Bot<a class="headerlink" href="#enabling-the-irc-bot" title="Permalink to this headline">¶</a></h4>
<p>Buildbot includes an IRC bot that you can tell to join a channel and control
to report on the status of buildbot.</p>
<p>First, start an IRC client of your choice, connect to irc.freenode.org and
join an empty channel.  In this example we will use #buildbot-test, so go
join that channel. (<em>Note: please do not join the main buildbot channel!</em>)</p>
<p>Edit the config and look for the <em>STATUS TARGETS</em> section.  Enter these lines
below the WebStatus line in master.cfg:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">WebStatus</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8010</span><span class="p">,</span> <span class="n">authz</span><span class="o">=</span><span class="n">authz_cfg</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">buildbot.status</span> <span class="kn">import</span> <span class="n">words</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">IRC</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&quot;irc.freenode.org&quot;</span><span class="p">,</span> <span class="n">nick</span><span class="o">=</span><span class="s">&quot;bbtest&quot;</span><span class="p">,</span>
                             <span class="n">channels</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;#buildbot-test&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Reconfigure the build master then do:</p>
<div class="highlight-python"><pre>cat master/twistd.log | grep IRC</pre>
</div>
<p>The log output should contain a line like this:</p>
<div class="highlight-python"><pre>2009-08-01 15:35:20+0200 [-] adding IStatusReceiver &lt;buildbot.status.words.IRC instance at 0x300d290&gt;</pre>
</div>
<p>You should see the bot now joining in your IRC client.
In your IRC channel, type:</p>
<div class="highlight-python"><pre>bbtest: commands</pre>
</div>
<p>to get a list of the commands the bot supports.</p>
<p>Let's tell the bot to notify certain events, to learn which EVENTS we can notify on:</p>
<div class="highlight-python"><pre>bbtest: help notify</pre>
</div>
<p>Now let's set some event notifications:</p>
<div class="highlight-python"><pre>bbtest: notify on started
bbtest: notify on finished
bbtest: notify on failure</pre>
</div>
<p>The bot should have responded to each of the commands:</p>
<div class="highlight-python"><pre>&lt;@lsblakk&gt; bbtest: notify on started
&lt;bbtest&gt; The following events are being notified: ['started']
&lt;@lsblakk&gt; bbtest: notify on finished
&lt;bbtest&gt; The following events are being notified: ['started', 'finished']
&lt;@lsblakk&gt; bbtest: notify on failure
&lt;bbtest&gt; The following events are being notified: ['started', 'failure', 'finished']</pre>
</div>
<p>Now, go back to the web interface and force another build.</p>
<p>Notice how the bot tells you about the start and finish of this build:</p>
<div class="highlight-python"><pre>&lt; bbtest&gt; build #1 of runtests started, including []
&lt; bbtest&gt; build #1 of runtests is complete: Success [build successful]  Build details are at http://localhost:8010/builders/runtests/builds/1</pre>
</div>
<p>You can also use the bot to force a build:</p>
<div class="highlight-python"><pre>bbtest: force build runtests test build</pre>
</div>
<p>But to allow this, you'll need to have <tt class="docutils literal"><span class="pre">allowForce</span></tt> in the IRC
configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">IRC</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&quot;irc.freenode.org&quot;</span><span class="p">,</span> <span class="n">nick</span><span class="o">=</span><span class="s">&quot;bbtest&quot;</span><span class="p">,</span>
                             <span class="n">allowForce</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                             <span class="n">channels</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;#buildbot-test&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This time, the bot is giving you more output, as it's specifically responding
to your direct request to force a build, and explicitly tells you when the
build finishes:</p>
<div class="highlight-python"><pre>&lt;@lsblakk&gt; bbtest: force build runtests test build
&lt; bbtest&gt; build #2 of runtests started, including []
&lt; bbtest&gt; build forced [ETA 0 seconds]
&lt; bbtest&gt; I'll give a shout when the build finishes
&lt; bbtest&gt; build #2 of runtests is complete: Success [build successful]  Build details are at http://localhost:8010/builders/runtests/builds/2</pre>
</div>
<p>You can also see the new builds in the web interface.</p>
<img alt="a successful test run from IRC happened." src="_images/irc-testrun.png" />
</div>
<div class="section" id="setting-authorized-web-users">
<h4>Setting Authorized Web Users<a class="headerlink" href="#setting-authorized-web-users" title="Permalink to this headline">¶</a></h4>
<p>Further down, look for the WebStatus configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kn">from</span> <span class="nn">buildbot.status</span> <span class="kn">import</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">buildbot.status.web</span> <span class="kn">import</span> <span class="n">authz</span><span class="p">,</span> <span class="n">auth</span>

<span class="n">authz_cfg</span><span class="o">=</span><span class="n">authz</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
    <span class="c"># change any of these to True to enable; see the manual for more</span>
    <span class="c"># options</span>
    <span class="n">auth</span><span class="o">=</span><span class="n">auth</span><span class="o">.</span><span class="n">BasicAuth</span><span class="p">([(</span><span class="s">&quot;pyflakes&quot;</span><span class="p">,</span><span class="s">&quot;pyflakes&quot;</span><span class="p">)]),</span>
    <span class="n">gracefulShutdown</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">forceBuild</span> <span class="o">=</span> <span class="s">&#39;auth&#39;</span><span class="p">,</span> <span class="c"># use this to test your slave once it is set up</span>
    <span class="n">forceAllBuilds</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">pingBuilder</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">stopBuild</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">stopAllBuilds</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
    <span class="n">cancelPendingBuild</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">WebStatus</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8010</span><span class="p">,</span> <span class="n">authz</span><span class="o">=</span><span class="n">authz_cfg</span><span class="p">))</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">auth.BasicAuth()</span></tt> define authorized users and their passwords.  You can
change these or add new ones.  See <a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">WebStatus</span></tt></a> for more about the
WebStatus configuration.</p>
</div>
<div class="section" id="debugging-with-manhole">
<h4>Debugging with Manhole<a class="headerlink" href="#debugging-with-manhole" title="Permalink to this headline">¶</a></h4>
<p>You can do some debugging by using manhole, an interactive Python shell.  It
exposes full access to the buildmaster's account (including the ability to
modify and delete files), so it should not be enabled with a weak or easily
guessable password.</p>
<p>To use this you will need to install an additional package or two to your virtualenv:</p>
<div class="highlight-python"><pre>cd
cd tmp/buildbot
source sandbox/bin/activate
easy_install pycrypto
easy_install pyasn1</pre>
</div>
<p>In your master.cfg find:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span> <span class="o">=</span> <span class="n">BuildmasterConfig</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Insert the following to enable debugging mode with manhole:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c">####### DEBUGGING</span>
<span class="kn">from</span> <span class="nn">buildbot</span> <span class="kn">import</span> <span class="n">manhole</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manhole</span><span class="o">.</span><span class="n">PasswordManhole</span><span class="p">(</span><span class="s">&quot;tcp:1234:interface=127.0.0.1&quot;</span><span class="p">,</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="s">&quot;passwd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>After restarting the master, you can ssh into the master and get an interactive python shell:</p>
<div class="highlight-python"><pre>ssh -p1234 admin@127.0.0.1
# enter passwd at prompt</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The pyasn1-0.1.1 release has a bug which results in an exception similar to
this on startup:</p>
<div class="highlight-python"><pre>exceptions.TypeError: argument 2 must be long, not int</pre>
</div>
<p>If you see this, the temporary solution is to install the previous version
of pyasn1:</p>
<div class="last highlight-python"><pre>pip install pyasn1-0.0.13b</pre>
</div>
</div>
<p>If you wanted to check which slaves are connected and what builders those slaves are assigned to you could do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">master</span><span class="o">.</span><span class="n">botmaster</span><span class="o">.</span><span class="n">slaves</span>
<span class="go">{&#39;example-slave&#39;: &lt;BuildSlave &#39;example-slave&#39;, current builders: runtests&gt;}</span>
</pre></div>
</div>
<p>Objects can be explored in more depth using <cite>dir(x)</cite> or the helper function
<cite>show(x)</cite>.</p>
</div>
<div class="section" id="adding-a-try-scheduler">
<h4>Adding a 'try' scheduler<a class="headerlink" href="#adding-a-try-scheduler" title="Permalink to this headline">¶</a></h4>
<p>Buildbot includes a way for developers to submit patches for testing without
committing them to the source code control system.  (This is really handy for
projects that support several operating systems or architectures.)</p>
<p>To set this up, add the following lines to master.cfg:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.scheduler</span> <span class="kn">import</span> <span class="n">Try_Userpass</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Try_Userpass</span><span class="p">(</span>
                                    <span class="n">name</span><span class="o">=</span><span class="s">&#39;try&#39;</span><span class="p">,</span>
                                    <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;runtests&#39;</span><span class="p">],</span>
                                    <span class="n">port</span><span class="o">=</span><span class="mi">5555</span><span class="p">,</span>
                                    <span class="n">userpass</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;sampleuser&#39;</span><span class="p">,</span><span class="s">&#39;samplepass&#39;</span><span class="p">)]))</span>
</pre></div>
</div>
<p>Then you can submit changes using the <a class="reference internal" href="#cmdline-try" title="try"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">try</span></tt></a> command.</p>
<p>Let's try this out by making a one-line change to pyflakes, say,
to make it trace the tree by default:</p>
<div class="highlight-python"><pre>git clone git://github.com/buildbot/pyflakes.git pyflakes-git
cd pyflakes-git/pyflakes
$EDITOR checker.py
# change "traceTree = False" on line 185 to "traceTree = True"</pre>
</div>
<p>Then run buildbot's try command as follows:</p>
<div class="highlight-python"><pre>source ~/tmp/buildbot/sandbox/bin/activate
buildbot try --connect=pb --master=127.0.0.1:5555 --username=sampleuser --passwd=samplepass --vc=git</pre>
</div>
<p>This will do &quot;git diff&quot; for you and send the resulting patch to
the server for build and test against the latest sources from git.</p>
<p>Now go back to the <a class="reference external" href="http://localhost:8010/waterfall">waterfall</a>
page, click on the runtests link, and scroll down.  You should see that
another build has been started with your change (and stdout for the tests
should be chock-full of parse trees as a result).  The &quot;Reason&quot; for the
job will be listed as &quot;'try' job&quot;, and the blamelist will be empty.</p>
<p>To make yourself show up as the author of the change, use the --who=emailaddr
option on 'buildbot try' to pass your email address.</p>
<p>To make a description of the change show up, use the
--properties=comment=&quot;this is a comment&quot; option on 'buildbot try'.</p>
<p>To use ssh instead of a private username/password database, see
<a class="reference internal" href="#sched-Try_Jobdir" title="Try_Jobdir"><tt class="xref bb bb-sched docutils literal"><span class="pre">Try_Jobdir</span></tt></a>.</p>
</div>
</div>
</div>
</div>
<span id="document-manual/index"></span><p>This is the BuildBot manual for Buildbot version 0.8.7.</p>
<div class="section" id="buildbot-manual">
<h2>Buildbot Manual<a class="headerlink" href="#buildbot-manual" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<span id="document-manual/introduction"></span><div class="section" id="introduction">
<span id="id1"></span><h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h3>
<p>BuildBot is a system to automate the compile/test cycle required by most
software projects to validate code changes. By automatically rebuilding and
testing the tree each time something has changed, build problems are
pinpointed quickly, before other developers are inconvenienced by the
failure. The guilty developer can be identified and harassed without human
intervention. By running the builds on a variety of platforms, developers
who do not have the facilities to test their changes everywhere before
checkin will at least know shortly afterwards whether they have broken the
build or not. Warning counts, lint checks, image size, compile time, and
other build parameters can be tracked over time, are more visible, and
are therefore easier to improve.</p>
<p>The overall goal is to reduce tree breakage and provide a platform to
run tests or code-quality checks that are too annoying or pedantic for
any human to waste their time with. Developers get immediate (and
potentially public) feedback about their changes, encouraging them to
be more careful about testing before checkin.</p>
<p>Features:</p>
<ul class="simple">
<li>run builds on a variety of slave platforms</li>
<li>arbitrary build process: handles projects using C, Python, whatever</li>
<li>minimal host requirements: python and Twisted</li>
<li>slaves can be behind a firewall if they can still do checkout</li>
<li>status delivery through web page, email, IRC, other protocols</li>
<li>track builds in progress, provide estimated completion time</li>
<li>flexible configuration by subclassing generic build process classes</li>
<li>debug tools to force a new build, submit fake <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s,
query slave status</li>
<li>released under the <a class="reference external" href="http://opensource.org/licenses/gpl-2.0.php">GPL</a></li>
</ul>
<div class="section" id="history-and-philosophy">
<span id="id2"></span><h4>History and Philosophy<a class="headerlink" href="#history-and-philosophy" title="Permalink to this headline">¶</a></h4>
<p>The Buildbot was inspired by a similar project built for a development
team writing a cross-platform embedded system. The various components
of the project were supposed to compile and run on several flavors of
unix (linux, solaris, BSD), but individual developers had their own
preferences and tended to stick to a single platform. From time to
time, incompatibilities would sneak in (some unix platforms want to
use <tt class="file docutils literal"><span class="pre">string.h</span></tt>, some prefer <tt class="file docutils literal"><span class="pre">strings.h</span></tt>), and then the tree
would compile for some developers but not others. The buildbot was
written to automate the human process of walking into the office,
updating a tree, compiling (and discovering the breakage), finding the
developer at fault, and complaining to them about the problem they had
introduced. With multiple platforms it was difficult for developers to
do the right thing (compile their potential change on all platforms);
the buildbot offered a way to help.</p>
<p>Another problem was when programmers would change the behavior of a
library without warning its users, or change internal aspects that
other code was (unfortunately) depending upon. Adding unit tests to
the codebase helps here: if an application's unit tests pass despite
changes in the libraries it uses, you can have more confidence that
the library changes haven't broken anything. Many developers
complained that the unit tests were inconvenient or took too long to
run: having the buildbot run them reduces the developer's workload to
a minimum.</p>
<p>In general, having more visibility into the project is always good,
and automation makes it easier for developers to do the right thing.
When everyone can see the status of the project, developers are
encouraged to keep the tree in good working order. Unit tests that
aren't run on a regular basis tend to suffer from bitrot just like
code does: exercising them on a regular basis helps to keep them
functioning and useful.</p>
<p>The current version of the Buildbot is additionally targeted at
distributed free-software projects, where resources and platforms are
only available when provided by interested volunteers. The buildslaves
are designed to require an absolute minimum of configuration, reducing
the effort a potential volunteer needs to expend to be able to
contribute a new test environment to the project. The goal is for
anyone who wishes that a given project would run on their favorite
platform should be able to offer that project a buildslave, running on
that platform, where they can verify that their portability code
works, and keeps working.</p>
</div>
<div class="section" id="system-architecture">
<span id="id3"></span><h4>System Architecture<a class="headerlink" href="#system-architecture" title="Permalink to this headline">¶</a></h4>
<p>The Buildbot consists of a single <em>buildmaster</em> and one or more
<em>buildslaves</em>, connected in a star topology. The buildmaster
makes all decisions about what, when, and how to build. It sends
commands to be run on the build slaves, which simply execute the
commands and return the results. (certain steps involve more local
decision making, where the overhead of sending a lot of commands back
and forth would be inappropriate, but in general the buildmaster is
responsible for everything).</p>
<p>The buildmaster is usually fed <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s by some sort of version control
system (<a class="reference internal" href="#change-sources"><em>Change Sources</em></a>), which may cause builds to be run. As the
builds are performed, various status messages are produced, which are then sent
to any registered <a class="reference internal" href="#status-targets"><em>Status Targets</em></a>.</p>
<img alt="Overview Diagram" src="_images/overview.svg" /><p>The buildmaster is configured and maintained by the <em>buildmaster
admin</em>, who is generally the project team member responsible for
build process issues. Each buildslave is maintained by a <em>buildslave
admin</em>, who do not need to be quite as involved. Generally slaves are
run by anyone who has an interest in seeing the project work well on
their favorite platform.</p>
<div class="section" id="buildslave-connections">
<span id="id4"></span><h5>BuildSlave Connections<a class="headerlink" href="#buildslave-connections" title="Permalink to this headline">¶</a></h5>
<p>The buildslaves are typically run on a variety of separate machines,
at least one per platform of interest. These machines connect to the
buildmaster over a TCP connection to a publically-visible port. As a
result, the buildslaves can live behind a NAT box or similar
firewalls, as long as they can get to buildmaster. The TCP connections
are initiated by the buildslave and accepted by the buildmaster, but
commands and results travel both ways within this connection. The
buildmaster is always in charge, so all commands travel exclusively
from the buildmaster to the buildslave.</p>
<p>To perform builds, the buildslaves must typically obtain source code
from a CVS/SVN/etc repository. Therefore they must also be able to
reach the repository. The buildmaster provides instructions for
performing builds, but does not provide the source code itself.</p>
<img alt="BuildSlave Connections" src="_images/slaves.svg" /></div>
<div class="section" id="buildmaster-architecture">
<span id="id5"></span><h5>Buildmaster Architecture<a class="headerlink" href="#buildmaster-architecture" title="Permalink to this headline">¶</a></h5>
<p>The buildmaster consists of several pieces:</p>
<img alt="Buildmaster Architecture" src="_images/master.svg" /><dl class="docutils">
<dt>Change Sources</dt>
<dd>Which create a Change object each time something is
modified in the VC repository. Most <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>s listen for messages
from a hook script of some sort. Some sources actively poll the
repository on a regular basis. All <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s are fed to the
<tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt>s.</dd>
<dt>Schedulers</dt>
<dd>Which decide when builds should be performed. They collect
<tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s into <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>s, which are then queued for delivery to
<tt class="xref py py-class docutils literal"><span class="pre">Builders</span></tt> until a buildslave is available.</dd>
<dt>Builders</dt>
<dd>Which control exactly <em>how</em> each build is performed
(with a series of <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s, configured in a <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt>). Each
<tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> is run on a single buildslave.</dd>
<dt>Status plugins</dt>
<dd>Which deliver information about the build results
through protocols like HTTP, mail, and IRC.</dd>
</dl>
<p>Each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> is configured with a list of <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>s that it will use
for its builds. These buildslaves are expected to behave identically:
the only reason to use multiple <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>s for a single <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> is to
provide a measure of load-balancing.</p>
<p>Within a single <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>, each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> creates its own <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt>
instance. These <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt>s operate independently from each other.
Each gets its own base directory to work in. It is quite common to
have many <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s sharing the same buildslave. For example, there
might be two buildslaves: one for i386, and a second for PowerPC.
There may then be a pair of <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s that do a full compile/test run,
one for each architecture, and a lone <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> that creates snapshot
source tarballs if the full builders complete successfully. The full
builders would each run on a single buildslave, whereas the tarball
creation step might run on either buildslave (since the platform
doesn't matter when creating source tarballs). In this case, the
mapping would look like:</p>
<div class="highlight-none"><div class="highlight"><pre>Builder(full-i386)  -&gt;  BuildSlaves(slave-i386)
Builder(full-ppc)   -&gt;  BuildSlaves(slave-ppc)
Builder(source-tarball) -&gt; BuildSlaves(slave-i386, slave-ppc)
</pre></div>
</div>
<p>and each <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt> would have two <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilders</span></tt> inside it, one for a
full builder, and a second for the source-tarball builder.</p>
<p>Once a <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt> is available, the <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> pulls one or more
<tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>s off its incoming queue. (It may pull more than one if it
determines that it can merge the requests together; for example, there
may be multiple requests to build the current <em>HEAD</em> revision). These
requests are merged into a single <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> instance, which includes the
<tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt> that describes what exact version of the source code
should be used for the build. The <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> is then randomly assigned to a
free <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt> and the build begins.</p>
<p>The behaviour when <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>s are merged can be customized,
<a class="reference internal" href="#merging-build-requests"><em>Merging Build Requests</em></a>.</p>
</div>
<div class="section" id="status-delivery-architecture">
<span id="id6"></span><h5>Status Delivery Architecture<a class="headerlink" href="#status-delivery-architecture" title="Permalink to this headline">¶</a></h5>
<p>The buildmaster maintains a central <tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt> object, to which various
status plugins are connected. Through this <tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt> object, a full
hierarchy of build status objects can be obtained.</p>
<img alt="Status Delivery" src="_images/status.svg" /><p>The configuration file controls which status plugins are active. Each
status plugin gets a reference to the top-level <tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt> object. From
there they can request information on each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt>, and
<tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>. This query-on-demand interface is used by the <tt class="docutils literal"><span class="pre">html.Waterfall</span></tt>
plugin to create the main status page each time a web browser hits the
main URL.</p>
<p>The status plugins can also subscribe to hear about new <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s as they
occur: this is used by the <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> to create new email messages
for each recently-completed <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>.</p>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt> object records the status of old builds on disk in the
buildmaster's base directory. This allows it to return information
about historical builds.</p>
<p>There are also status objects that correspond to <tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt>s and
<tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>s. These allow status plugins to report information about
upcoming builds, and the online/offline status of each buildslave.</p>
</div>
</div>
<div class="section" id="control-flow">
<span id="id7"></span><h4>Control Flow<a class="headerlink" href="#control-flow" title="Permalink to this headline">¶</a></h4>
<p>A day in the life of the buildbot:</p>
<ul class="simple">
<li>A developer commits some source code changes to the repository. A hook
script or commit trigger of some sort sends information about this
change to the buildmaster through one of its configured Change
Sources. This notification might arrive via email, or over a network
connection (either initiated by the buildmaster as it <em>subscribes</em>
to changes, or by the commit trigger as it pushes <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s towards the
buildmaster). The <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt> contains information about who made the
change, what files were modified, which revision contains the change,
and any checkin comments.</li>
<li>The buildmaster distributes this change to all of its configured
<tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt>s. Any <tt class="docutils literal"><span class="pre">important</span></tt> changes cause the <tt class="docutils literal"><span class="pre">tree-stable-timer</span></tt>
to be started, and the <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt> is added to a list of those that will go
into a new <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>. When the timer expires, a <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> is started on each
of a set of configured Builders, all compiling/testing the same source
code. Unless configured otherwise, all <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s run in parallel on the
various buildslaves.</li>
<li>The <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> consists of a series of <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt>s. Each <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt> causes some number
of commands to be invoked on the remote buildslave associated with
that <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>. The first step is almost always to perform a checkout of
the appropriate revision from the same VC system that produced the
<tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>. The rest generally perform a compile and run unit tests. As
each <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt> runs, the buildslave reports back command output and return
status to the buildmaster.</li>
<li>As the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> runs, status messages like &quot;Build Started&quot;, &quot;Step
Started&quot;, &quot;Build Finished&quot;, etc, are published to a collection of
Status Targets. One of these targets is usually the HTML <tt class="docutils literal"><span class="pre">Waterfall</span></tt>
display, which shows a chronological list of events, and summarizes
the results of the most recent build at the top of each column.
Developers can periodically check this page to see how their changes
have fared. If they see red, they know that they've made a mistake and
need to fix it. If they see green, they know that they've done their
duty and don't need to worry about their change breaking anything.</li>
<li>If a <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> status target is active, the completion of a build
will cause email to be sent to any developers whose <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s were
incorporated into this <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>. The <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> can be configured to
only send mail upon failing builds, or for builds which have just
transitioned from passing to failing. Other status targets can provide
similar real-time notification via different communication channels,
like IRC.</li>
</ul>
</div>
</div>
<span id="document-manual/installation"></span><div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<div class="section" id="buildbot-components">
<span id="id1"></span><h4>Buildbot Components<a class="headerlink" href="#buildbot-components" title="Permalink to this headline">¶</a></h4>
<p>Buildbot is shipped in two components: the <em>buildmaster</em> (called <tt class="docutils literal"><span class="pre">buildbot</span></tt>
for legacy reasons) and the <em>buildslave</em>.  The buildslave component has far fewer
requirements, and is more broadly compatible than the buildmaster.  You will
need to carefully pick the environment in which to run your buildmaster, but
the buildslave should be able to run just about anywhere.</p>
<p>It is possible to install the buildmaster and buildslave on the same system,
although for anything but the smallest installation this arrangement will not
be very efficient.</p>
</div>
<div class="section" id="requirements">
<span id="id2"></span><h4>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h4>
<div class="section" id="common-requirements">
<span id="id3"></span><h5>Common Requirements<a class="headerlink" href="#common-requirements" title="Permalink to this headline">¶</a></h5>
<p>At a bare minimum, you'll need the following for both the buildmaster and a
buildslave:</p>
<p>Python: <a class="reference external" href="http://www.python.org">http://www.python.org</a></p>
<blockquote>
<div>Buildbot requires python-2.5 or later on the master, although Python-2.7 is
recommended.  The slave run on Python-2.4.</div></blockquote>
<p>Twisted: <a class="reference external" href="http://twistedmatrix.com">http://twistedmatrix.com</a></p>
<blockquote>
<div><p>Buildbot requires Twisted-9.0.0 or later on the master, and Twisted-8.1.0 on
the slave. As always, the most recent version is recommended.</p>
<p>In some cases, Twisted is delivered as a collection of subpackages. You'll
need at least &quot;Twisted&quot; (the core package), and you'll also want
<a class="reference external" href="http://twistedmatrix.com/trac/wiki/TwistedMail">TwistedMail</a>, <a class="reference external" href="http://twistedmatrix.com/trac/wiki/TwistedWeb">TwistedWeb</a>, and <a class="reference external" href="http://twistedmatrix.com/trac/wiki/TwistedWords">TwistedWords</a> (for sending email,
serving a web status page, and delivering build status via IRC,
respectively). You might also want <a class="reference external" href="http://twistedmatrix.com/trac/wiki/TwistedConch">TwistedConch</a> (for the encrypted Manhole
debug port). Note that Twisted requires ZopeInterface to be installed as
well.</p>
</div></blockquote>
<p>Of course, your project's build process will impose additional
requirements on the buildslaves. These hosts must have all the tools
necessary to compile and test your project's source code.</p>
<div class="section" id="windows-support">
<h6>Windows Support<a class="headerlink" href="#windows-support" title="Permalink to this headline">¶</a></h6>
<p>Buildbot - both master and slave - runs well natively on Windows. The slave runs
well on Cygwin, but because of problems with SQLite on Cygwin, the master does
not.</p>
<p>Buildbot's windows testing is limited to the most recent Twisted and Python
versions. For best results, use the most recent available versions of these
libraries on Windows.</p>
<p>Pywin32: <a class="reference external" href="http://sourceforge.net/projects/pywin32/">http://sourceforge.net/projects/pywin32/</a></p>
<blockquote>
<div>Twisted requires PyWin32 in order to spawn processes on Windows.</div></blockquote>
</div>
</div>
<div class="section" id="buildmaster-requirements">
<span id="id4"></span><h5>Buildmaster Requirements<a class="headerlink" href="#buildmaster-requirements" title="Permalink to this headline">¶</a></h5>
<p>sqlite3: <a class="reference external" href="http://www.sqlite.org">http://www.sqlite.org</a></p>
<blockquote>
<div>Buildbot requires SQLite to store its state.  Version 3.7.0 or higher is
recommended, although Buildbot will run against earlier versions -- at the
risk of &quot;Database is locked&quot; errors.  The minimum version is 3.4.0, below
which parallel database queries and schema introspection fail.</div></blockquote>
<p>pysqlite: <a class="reference external" href="http://pypi.python.org/pypi/pysqlite">http://pypi.python.org/pypi/pysqlite</a></p>
<blockquote>
<div>The SQLite Python package is required for python-2.5 and earlier (it is already
included in python-2.5 and later, but the version in python-2.5 has nasty bugs)</div></blockquote>
<p>simplejson: <a class="reference external" href="http://pypi.python.org/pypi/simplejson">http://pypi.python.org/pypi/simplejson</a></p>
<blockquote>
<div>The simplejson package is required for python-2.5 and earlier (it is already
included as json in python-2.6 and later)</div></blockquote>
<p>Jinja2: <a class="reference external" href="http://jinja.pocoo.org/">http://jinja.pocoo.org/</a></p>
<blockquote>
<div><p>Buildbot requires Jinja version 2.1 or higher.</p>
<p>Jinja2 is a general purpose templating language and is used by Buildbot
to generate the HTML output.</p>
</div></blockquote>
<p>SQLAlchemy: <a class="reference external" href="http://www.sqlalchemy.org/">http://www.sqlalchemy.org/</a></p>
<blockquote>
<div>Buildbot requires SQLAlchemy 0.6.0 or higher. SQLAlchemy allows Buildbot to
build database schemas and queries for a wide variety of database systems.</div></blockquote>
<p>SQLAlchemy-Migrate: <a class="reference external" href="http://code.google.com/p/sqlalchemy-migrate/">http://code.google.com/p/sqlalchemy-migrate/</a></p>
<blockquote>
<div>Buildbot requires one of the following SQLAlchemy-Migrate versions:
0.6.1, 0.7.0, and 0.7.1.  Sadly, Migrate's inter-version compatibility is not
good, so other versions - newer or older - are unlikely to work correctly.
Buildbot uses SQLAlchemy-Migrate to manage schema upgrades from version to
version.</div></blockquote>
<p>Python-Dateutil: <a class="reference external" href="http://labix.org/python-dateutil">http://labix.org/python-dateutil</a></p>
<blockquote>
<div>The Nightly scheduler requires Python-Dateutil version 1.5 (the last version
to support Python-2.x).  This is a small, pure-python library.  Buildbot will
function properly without it if the Nightlys scheduler is not used.</div></blockquote>
</div>
</div>
<div class="section" id="installing-the-code">
<span id="id5"></span><h4>Installing the code<a class="headerlink" href="#installing-the-code" title="Permalink to this headline">¶</a></h4>
<div class="section" id="the-distribution-package">
<h5>The Distribution Package<a class="headerlink" href="#the-distribution-package" title="Permalink to this headline">¶</a></h5>
<p>Buildbot comes in two parts: <tt class="docutils literal"><span class="pre">buildbot</span></tt> (the master) and
<tt class="docutils literal"><span class="pre">buildbot-slave</span></tt> (the slave).  The two can be installed individually or
together.</p>
</div>
<div class="section" id="installation-from-pypi">
<h5>Installation From PyPI<a class="headerlink" href="#installation-from-pypi" title="Permalink to this headline">¶</a></h5>
<p>The easiest way to install Buildbot is using 'pip'. For the master:</p>
<div class="highlight-bash"><div class="highlight"><pre>pip install buildbot
</pre></div>
</div>
<p>and for the slave:</p>
<div class="highlight-bash"><div class="highlight"><pre>pip install buildbot-slave
</pre></div>
</div>
</div>
<div class="section" id="installation-from-tarballs">
<h5>Installation From Tarballs<a class="headerlink" href="#installation-from-tarballs" title="Permalink to this headline">¶</a></h5>
<p>Buildbot and Buildslave are installed using the standard python
<a class="reference external" href="http://docs.python.org/library/distutils.html">distutils</a> process. For either
component, after unpacking the tarball, the process is:</p>
<div class="highlight-bash"><div class="highlight"><pre>python setup.py build
python setup.py install
</pre></div>
</div>
<p>where the install step may need to be done as root. This will put the bulk of
the code in somewhere like <tt class="file docutils literal"><span class="pre">/usr/lib/pythonx.y/site-packages/buildbot</span></tt>. It
will also install the <strong class="command">buildbot</strong> command-line tool in
<tt class="file docutils literal"><span class="pre">/usr/bin/buildbot</span></tt>.</p>
<p>If the environment variable <tt class="docutils literal"><span class="pre">$NO_INSTALL_REQS</span></tt> is set to <tt class="docutils literal"><span class="pre">1</span></tt>, then
<tt class="file docutils literal"><span class="pre">setup.py</span></tt> will not try to install Buildbot's requirements.  This is
usually only useful when building a Buildbot package.</p>
<p>To test this, shift to a different directory (like <tt class="file docutils literal"><span class="pre">/tmp</span></tt>), and run:</p>
<div class="highlight-bash"><div class="highlight"><pre>buildbot --version
<span class="c"># or</span>
buildslave --version
</pre></div>
</div>
<p>If it shows you the versions of Buildbot and Twisted, the install went
ok. If it says &quot;no such command&quot; or it gets an <tt class="docutils literal"><span class="pre">ImportError</span></tt>
when it tries to load the libaries, then something went wrong.
<tt class="docutils literal"><span class="pre">pydoc</span> <span class="pre">buildbot</span></tt> is another useful diagnostic tool.</p>
<p>Windows users will find these files in other places. You will need to
make sure that python can find the libraries, and will probably find
it convenient to have <strong class="command">buildbot</strong> on your <span class="target" id="index-0"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt>.</p>
</div>
<div class="section" id="installation-in-a-virtualenv">
<span id="id6"></span><h5>Installation in a Virtualenv<a class="headerlink" href="#installation-in-a-virtualenv" title="Permalink to this headline">¶</a></h5>
<p>If you cannot or do not wish to install the buildbot into a site-wide
location like <tt class="file docutils literal"><span class="pre">/usr</span></tt> or <tt class="file docutils literal"><span class="pre">/usr/local</span></tt>, you can also install
it into the account's home directory or any other location using a tool like
<a class="reference external" href="http://pypi.python.org/pypi/virtualenv">virtualenv</a>.</p>
</div>
</div>
<div class="section" id="running-buildbot-s-tests-optional">
<span id="running-buildbots-tests-optional"></span><h4>Running Buildbot's Tests (optional)<a class="headerlink" href="#running-buildbot-s-tests-optional" title="Permalink to this headline">¶</a></h4>
<p>If you wish, you can run the buildbot unit test suite.  First, ensure you have
the <a class="reference external" href="http://pypi.python.org/pypi/mock">mock</a> Python module installed from
PyPi.  This module is not required for ordinary Buildbot operation - only to
run the tests.  Note that this is not the same as the Fedora <tt class="docutils literal"><span class="pre">mock</span></tt>
package!  You can check with</p>
<div class="highlight-bash"><div class="highlight"><pre>python -mmock
</pre></div>
</div>
<p>Then, run the tests:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">PYTHONPATH</span><span class="o">=</span>. trial buildbot.test
<span class="c"># or</span>
<span class="nv">PYTHONPATH</span><span class="o">=</span>. trial buildslave.test
</pre></div>
</div>
<p>Nothing should fail, although a few might be skipped.</p>
<p>If any of the tests fail for reasons other than a missing <tt class="docutils literal"><span class="pre">mock</span></tt>, you
should stop and investigate the cause before continuing the installation
process, as it will probably be easier to track down the bug early. In most
cases, the problem is incorrectly installed Python modules or a badly
configured <tt class="docutils literal"><span class="pre">PYTHONPATH</span></tt>. This may be a good time to contact the Buildbot
developers for help.</p>
</div>
<div class="section" id="creating-a-buildmaster">
<span id="id7"></span><h4>Creating a buildmaster<a class="headerlink" href="#creating-a-buildmaster" title="Permalink to this headline">¶</a></h4>
<p>As you learned earlier (<a class="reference internal" href="#system-architecture"><em>System Architecture</em></a>), the buildmaster
runs on a central host (usually one that is publicly visible, so
everybody can check on the status of the project), and controls all
aspects of the buildbot system</p>
<p>You will probably wish to create a separate user account for the buildmaster,
perhaps named <tt class="docutils literal"><span class="pre">buildmaster</span></tt>. Do not run the buildmaster as <tt class="docutils literal"><span class="pre">root</span></tt>!</p>
<p>You need to choose a directory for the buildmaster, called the
<tt class="docutils literal"><span class="pre">basedir</span></tt>. This directory will be owned by the buildmaster. It will
contain configuration, the database, and status information - including
logfiles.  On a large buildmaster this directory will see a lot of activity, so
it should be on a disk with adequate space and speed.</p>
<p>Once you've picked a directory, use the <tt class="docutils literal"><span class="pre">buildbot</span>
<span class="pre">create-master</span></tt> command to create the directory and populate it with
startup files:</p>
<div class="highlight-bash"><div class="highlight"><pre>buildbot create-master -r basedir
</pre></div>
</div>
<p>You will need to create a <a class="reference internal" href="#configuration"><em>configuration file</em></a>
before starting the buildmaster. Most of the rest of this manual is
dedicated to explaining how to do this. A sample configuration file is
placed in the working directory, named <tt class="file docutils literal"><span class="pre">master.cfg.sample</span></tt>, which
can be copied to <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> and edited to suit your purposes.</p>
<p>(Internal details: This command creates a file named
<tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt> that contains all the state necessary to create
the buildmaster. Twisted has a tool called <tt class="docutils literal"><span class="pre">twistd</span></tt> which can use
this .tac file to create and launch a buildmaster instance. twistd
takes care of logging and daemonization (running the program in the
background). <tt class="file docutils literal"><span class="pre">/usr/bin/buildbot</span></tt> is a front end which runs <cite>twistd</cite>
for you.)</p>
<div class="section" id="using-a-database-server">
<h5>Using A Database Server<a class="headerlink" href="#using-a-database-server" title="Permalink to this headline">¶</a></h5>
<p>If you want to use a database server (e.g., MySQL or Postgres) as the database
backend for your Buildbot, add the <tt class="docutils literal"><span class="pre">--db</span></tt> option to the <tt class="docutils literal"><span class="pre">create-master</span></tt>
invocation to specify the <a class="reference internal" href="#database-specification"><em>connection string</em></a> for
the database, and make sure that the same URL appears in the <tt class="docutils literal"><span class="pre">db_url</span></tt> of the
<a class="reference internal" href="#cfg-db" title="db"><tt class="xref bb bb-cfg docutils literal"><span class="pre">db</span></tt></a> parameter in your configuration file.</p>
<div class="section" id="additional-requirements">
<h6>Additional Requirements<a class="headerlink" href="#additional-requirements" title="Permalink to this headline">¶</a></h6>
<p>Depending on the selected database, further Python packages will be required.
Consult the SQLAlchemy dialect list for a full description.  The most common
choice for MySQL is</p>
<p>MySQL-python: <a class="reference external" href="http://mysql-python.sourceforge.net/">http://mysql-python.sourceforge.net/</a></p>
<blockquote>
<div>To communicate with MySQL, SQLAlchemy requires MySQL-python.  Any reasonably
recent version of MySQL-python should suffice.</div></blockquote>
<p>The most common choice for Postgres is</p>
<p>Psycopg: <a class="reference external" href="http://initd.org/psycopg/">http://initd.org/psycopg/</a></p>
<blockquote>
<div>SQLAlchemy uses Psycopg to communicate with Postgres.  Any reasonably
recent version should suffice.</div></blockquote>
</div>
</div>
<div class="section" id="buildmaster-options">
<h5>Buildmaster Options<a class="headerlink" href="#buildmaster-options" title="Permalink to this headline">¶</a></h5>
<p>This section lists options to the <tt class="docutils literal"><span class="pre">create-master</span></tt> command.
You can also type <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">create-master</span> <span class="pre">--help</span></tt> for an up-to-the-moment summary.</p>
<p><tt class="docutils literal"><span class="pre">--force</span></tt></p>
<blockquote>
<div>With this option, &#64;command{create-master} will re-use an existing master
directory.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">--no-logrotate</span></tt></p>
<blockquote>
<div>This disables internal buildslave log management mechanism. With this option
buildslave does not override the default logfile name and its behaviour giving
a possibility to control those with command-line options of twistd daemon.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">--relocatable</span></tt></p>
<blockquote>
<div>This creates a &quot;relocatable&quot; buildbot.tac, which uses relative paths instead
of absolute paths, so that the buildmaster directory can be moved about.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">--config</span></tt></p>
<blockquote>
<div>The name of the configuration file to use.  This configuration file need not
reside in the buildmaster directory.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">--log-size</span></tt></p>
<blockquote>
<div>This is the size in bytes when to rotate the Twisted log files.  The default is
10MiB.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">--log-count</span></tt></p>
<blockquote>
<div>This is the number of log rotations to keep around. You can either
specify a number or &#64;code{None} to keep all &#64;file{twistd.log} files
around.  The default is 10.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">--db</span></tt></p>
<blockquote>
<div>The database that the Buildmaster should use.  Note that the same value must be
added to the configuration file.</div></blockquote>
</div>
</div>
<div class="section" id="upgrading-an-existing-buildmaster">
<span id="id8"></span><h4>Upgrading an Existing Buildmaster<a class="headerlink" href="#upgrading-an-existing-buildmaster" title="Permalink to this headline">¶</a></h4>
<p>If you have just installed a new version of the Buildbot code, and you
have buildmasters that were created using an older version, you'll
need to upgrade these buildmasters before you can use them. The
upgrade process adds and modifies files in the buildmaster's base
directory to make it compatible with the new code.</p>
<div class="highlight-bash"><div class="highlight"><pre>buildbot upgrade-master basedir
</pre></div>
</div>
<p>This command will also scan your <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> file for
incompatibilities (by loading it and printing any errors or deprecation
warnings that occur). Each buildbot release tries to be compatible
with configurations that worked cleanly (i.e. without deprecation
warnings) on the previous release: any functions or classes that are
to be removed will first be deprecated in a release, to give you a
chance to start using the replacement.</p>
<p>The <tt class="docutils literal"><span class="pre">upgrade-master</span></tt> command is idempotent. It is safe to run it
multiple times. After each upgrade of the buildbot code, you should
use <tt class="docutils literal"><span class="pre">upgrade-master</span></tt> on all your buildmasters.</p>
<p>In general, Buildbot slaves and masters can be upgraded independently, although
some new features will not be available, depending on the master and slave
versions.</p>
<p>Beyond this general information, read all of the sections below that apply to
versions through which you are upgrading.</p>
<div class="section" id="version-specific-notes">
<span id="buildmaster-version-specific-notes"></span><h5>Version-specific Notes<a class="headerlink" href="#version-specific-notes" title="Permalink to this headline">¶</a></h5>
<div class="section" id="upgrading-a-buildmaster-to-buildbot-0-7-6">
<h6>Upgrading a Buildmaster to Buildbot-0.7.6<a class="headerlink" href="#upgrading-a-buildmaster-to-buildbot-0-7-6" title="Permalink to this headline">¶</a></h6>
<p>The 0.7.6 release introduced the <tt class="file docutils literal"><span class="pre">public_html/</span></tt> directory, which
contains <tt class="file docutils literal"><span class="pre">index.html</span></tt> and other files served by the
<tt class="docutils literal"><span class="pre">WebStatus</span></tt> and <tt class="docutils literal"><span class="pre">Waterfall</span></tt> status displays. The
<tt class="docutils literal"><span class="pre">upgrade-master</span></tt> command will create these files if they do not
already exist. It will not modify existing copies, but it will write a
new copy in e.g. <tt class="file docutils literal"><span class="pre">index.html.new</span></tt> if the new version differs from
the version that already exists.</p>
</div>
<div class="section" id="upgrading-a-buildmaster-to-buildbot-0-8-0">
<h6>Upgrading a Buildmaster to Buildbot-0.8.0<a class="headerlink" href="#upgrading-a-buildmaster-to-buildbot-0-8-0" title="Permalink to this headline">¶</a></h6>
<p>Buildbot-0.8.0 introduces a database backend, which is SQLite by default.  The
<tt class="docutils literal"><span class="pre">upgrade-master</span></tt> command will automatically create and populate this
database with the changes the buildmaster has seen.  Note that, as of this
release, build history is <em>not</em> contained in the database, and is thus not
migrated.</p>
<p>The upgrade process renames the Changes pickle (<tt class="docutils literal"><span class="pre">$basedir/changes.pck</span></tt>) to
<tt class="docutils literal"><span class="pre">changes.pck.old</span></tt> once the upgrade is complete.  To reverse the upgrade,
simply downgrade Buildbot and move this file back to its original name.  You
may also wish to delete the state database (<tt class="docutils literal"><span class="pre">state.sqlite</span></tt>).</p>
</div>
<div class="section" id="upgrading-into-a-non-sqlite-database">
<h6>Upgrading into a non-SQLite database<a class="headerlink" href="#upgrading-into-a-non-sqlite-database" title="Permalink to this headline">¶</a></h6>
<p>If you are not using sqlite, you will need to add an entry into your
<tt class="file docutils literal"><span class="pre">master.cfg</span></tt> to reflect the database version you are using. The upgrade
process does <em>not</em> edit your <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> for you. So something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># for using mysql:</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;mysql://bbuser:&lt;password&gt;@localhost/buildbot&#39;</span>
</pre></div>
</div>
<p>Once the parameter has been added, invoke <tt class="docutils literal"><span class="pre">upgrade-master</span></tt>.
This will extract the DB url from your configuration file.</p>
<div class="highlight-bash"><div class="highlight"><pre>buildbot upgrade-master
</pre></div>
</div>
<p>See <a class="reference internal" href="#database-specification"><em>Database Specification</em></a> for more options to specify a database.</p>
<div class="section" id="change-encoding-issues">
<h7>Change Encoding Issues<a class="headerlink" href="#change-encoding-issues" title="Permalink to this headline">¶</a></h7>
<p>The upgrade process assumes that strings in your Changes pickle are encoded in
UTF-8 (or plain ASCII).  If this is not the case, and if there are non-UTF-8
characters in the pickle, the upgrade will fail with a suitable error message.
If this occurs, you have two options.  If the change history is not important
to your purpose, you can simply delete <tt class="file docutils literal"><span class="pre">changes.pck</span></tt>.</p>
<p>If you would like to keep the change history, then you will need to figure out
which encoding is in use, and use
<tt class="file docutils literal"><span class="pre">contrib/fix_changes_pickle_encoding.py</span></tt> (<a class="reference internal" href="#contrib-scripts"><em>Contrib Scripts</em></a>)
to rewrite the changes pickle into Unicode before upgrading the master.  A
typical invocation (with Mac-Roman encoding) might look like:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python <span class="nv">$buildbot</span>/contrib/fix_changes_pickle_encoding.py changes.pck macroman
decoding bytestrings in changes.pck using macroman
converted 11392 strings
backing up changes.pck to changes.pck.old
</pre></div>
</div>
<p>If your Changes pickle uses multiple encodings, you're on your own, but the
script in contrib may provide a good starting point for the fix.</p>
</div>
</div>
<div class="section" id="upgrading-a-buildmaster-to-later-versions">
<span id="upgrading-a-buildmaster-to-later-version"></span><h6>Upgrading a Buildmaster to Later Versions<a class="headerlink" href="#upgrading-a-buildmaster-to-later-versions" title="Permalink to this headline">¶</a></h6>
<p>Up to Buildbot version 0.8.7, no further steps beyond those described
above are required.</p>
</div>
</div>
</div>
<div class="section" id="creating-a-buildslave">
<span id="id9"></span><h4>Creating a buildslave<a class="headerlink" href="#creating-a-buildslave" title="Permalink to this headline">¶</a></h4>
<p>Typically, you will be adding a buildslave to an existing buildmaster,
to provide additional architecture coverage. The buildbot
administrator will give you several pieces of information necessary to
connect to the buildmaster. You should also be somewhat familiar with
the project being tested, so you can troubleshoot build problems
locally.</p>
<p>The buildbot exists to make sure that the project's stated <tt class="docutils literal"><span class="pre">how</span> <span class="pre">to</span>
<span class="pre">build</span> <span class="pre">it</span></tt> process actually works. To this end, the buildslave should
run in an environment just like that of your regular developers.
Typically the project build process is documented somewhere
(<tt class="file docutils literal"><span class="pre">README</span></tt>, <tt class="file docutils literal"><span class="pre">INSTALL</span></tt>, etc), in a document that should
mention all library dependencies and contain a basic set of build
instructions. This document will be useful as you configure the host
and account in which the buildslave runs.</p>
<p>Here's a good checklist for setting up a buildslave:</p>
<ol class="arabic simple">
<li>Set up the account</li>
</ol>
<blockquote>
<div>It is recommended (although not mandatory) to set up a separate user
account for the buildslave. This account is frequently named
<tt class="docutils literal"><span class="pre">buildbot</span></tt> or <tt class="docutils literal"><span class="pre">buildslave</span></tt>. This serves to isolate your
personal working environment from that of the slave's, and helps to
minimize the security threat posed by letting possibly-unknown
contributors run arbitrary code on your system. The account should
have a minimum of fancy init scripts.</div></blockquote>
<ol class="arabic simple" start="2">
<li>Install the buildbot code</li>
</ol>
<blockquote>
<div>Follow the instructions given earlier (<a class="reference internal" href="#installing-the-code"><em>Installing the code</em></a>).
If you use a separate buildslave account, and you didn't install the
buildbot code to a shared location, then you will need to install it
with <tt class="docutils literal"><span class="pre">--home=~</span></tt> for each account that needs it.</div></blockquote>
<ol class="arabic simple" start="3">
<li>Set up the host</li>
</ol>
<blockquote>
<div><p>Make sure the host can actually reach the buildmaster. Usually the
buildmaster is running a status webserver on the same machine, so
simply point your web browser at it and see if you can get there.
Install whatever additional packages or libraries the project's
INSTALL document advises. (or not: if your buildslave is supposed to
make sure that building without optional libraries still works, then
don't install those libraries).</p>
<p>Again, these libraries don't necessarily have to be installed to a
site-wide shared location, but they must be available to your build
process. Accomplishing this is usually very specific to the build
process, so installing them to <tt class="file docutils literal"><span class="pre">/usr</span></tt> or <tt class="file docutils literal"><span class="pre">/usr/local</span></tt> is
usually the best approach.</p>
</div></blockquote>
<ol class="arabic simple" start="4">
<li>Test the build process</li>
</ol>
<blockquote>
<div>Follow the instructions in the <tt class="file docutils literal"><span class="pre">INSTALL</span></tt> document, in the buildslave's
account. Perform a full CVS (or whatever) checkout, configure, make,
run tests, etc. Confirm that the build works without manual fussing.
If it doesn't work when you do it by hand, it will be unlikely to work
when the buildbot attempts to do it in an automated fashion.</div></blockquote>
<ol class="arabic simple" start="5">
<li>Choose a base directory</li>
</ol>
<blockquote>
<div>This should be somewhere in the buildslave's account, typically named
after the project which is being tested. The buildslave will not touch
any file outside of this directory. Something like <tt class="file docutils literal"><span class="pre">~/Buildbot</span></tt>
or <tt class="file docutils literal"><span class="pre">~/Buildslaves/fooproject</span></tt> is appropriate.</div></blockquote>
<ol class="arabic simple" start="6">
<li>Get the buildmaster host/port, botname, and password</li>
</ol>
<blockquote>
<div><p>When the buildbot admin configures the buildmaster to accept and use
your buildslave, they will provide you with the following pieces of
information:</p>
<ul class="simple">
<li>your buildslave's name</li>
<li>the password assigned to your buildslave</li>
<li>the hostname and port number of the buildmaster, i.e. buildbot.example.org:8007</li>
</ul>
</div></blockquote>
<ol class="arabic simple" start="7">
<li>Create the buildslave</li>
</ol>
<blockquote>
<div><p>Now run the 'buildslave' command as follows:</p>
<blockquote>
<div><tt class="samp docutils literal"><span class="pre">buildslave</span> <span class="pre">create-slave</span> <em><span class="pre">BASEDIR</span></em> <em><span class="pre">MASTERHOST</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em> <em><span class="pre">SLAVENAME</span></em> <em><span class="pre">PASSWORD</span></em></tt></div></blockquote>
<p>This will create the base directory and a collection of files inside,
including the <tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt> file that contains all the
information you passed to the <strong class="command">buildbot</strong> command.</p>
</div></blockquote>
<ol class="arabic simple" start="8">
<li>Fill in the hostinfo files</li>
</ol>
<blockquote>
<div><p>When it first connects, the buildslave will send a few files up to the
buildmaster which describe the host that it is running on. These files
are presented on the web status display so that developers have more
information to reproduce any test failures that are witnessed by the
buildbot. There are sample files in the <tt class="file docutils literal"><span class="pre">info</span></tt> subdirectory of
the buildbot's base directory. You should edit these to correctly
describe you and your host.</p>
<p><tt class="file docutils literal"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/admin</span></tt> should contain your name and email address.
This is the <tt class="docutils literal"><span class="pre">buildslave</span> <span class="pre">admin</span> <span class="pre">address</span></tt>, and will be visible from the
build status page (so you may wish to munge it a bit if
address-harvesting spambots are a concern).</p>
<p><tt class="file docutils literal"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/host</span></tt> should be filled with a brief description of
the host: OS, version, memory size, CPU speed, versions of relevant
libraries installed, and finally the version of the buildbot code
which is running the buildslave.</p>
<p>The optional <tt class="file docutils literal"><em><span class="pre">BASEDIR</span></em><span class="pre">/info/access_uri</span></tt> can specify a URI which will
connect a user to the machine.  Many systems accept <tt class="docutils literal"><span class="pre">ssh://hostname</span></tt> URIs
for this purpose.</p>
<p>If you run many buildslaves, you may want to create a single
<tt class="file docutils literal"><span class="pre">~buildslave/info</span></tt> file and share it among all the buildslaves
with symlinks.</p>
</div></blockquote>
<div class="section" id="buildslave-options">
<span id="id10"></span><h5>Buildslave Options<a class="headerlink" href="#buildslave-options" title="Permalink to this headline">¶</a></h5>
<p>There are a handful of options you might want to use when creating the
buildslave with the <tt class="samp docutils literal"><span class="pre">buildslave</span> <span class="pre">create-slave</span> <span class="pre">&lt;options&gt;</span> <span class="pre">DIR</span> <span class="pre">&lt;params&gt;</span></tt>
command. You can type <tt class="docutils literal"><span class="pre">buildslave</span> <span class="pre">create-slave</span> <span class="pre">--help</span></tt> for a summary.
To use these, just include them on the <tt class="docutils literal"><span class="pre">buildslave</span> <span class="pre">create-slave</span></tt>
command line, like this</p>
<div class="highlight-bash"><div class="highlight"><pre>buildslave create-slave --umask<span class="o">=</span>022 ~/buildslave buildmaster.example.org:42012 <span class="o">{</span>myslavename<span class="o">}</span> <span class="o">{</span>mypasswd<span class="o">}</span>
</pre></div>
</div>
<dl class="option">
<dt id="cmdoption-buildslave-create-slave--no-logrotate">
<tt class="descname">--no-logrotate</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-buildslave-create-slave--no-logrotate" title="Permalink to this definition">¶</a></dt>
<dd><p>This disables internal buildslave log management mechanism. With this option
buildslave does not override the default logfile name and its behaviour giving
a possibility to control those with command-line options of twistd
daemon.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildslave-create-slave--usepty">
<tt class="descname">--usepty</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-buildslave-create-slave--usepty" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a boolean flag that tells the buildslave whether to launch child
processes in a PTY or with regular pipes (the default) when the master does not
specify.  This option is deprecated, as this particular parameter is better
specified on the master.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildslave-create-slave--umask">
<tt class="descname">--umask</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-buildslave-create-slave--umask" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a string (generally an octal representation of an integer)
which will cause the buildslave process' <tt class="docutils literal"><span class="pre">umask</span></tt> value to be set
shortly after initialization. The <tt class="docutils literal"><span class="pre">twistd</span></tt> daemonization utility
forces the umask to 077 at startup (which means that all files created
by the buildslave or its child processes will be unreadable by any
user other than the buildslave account). If you want build products to
be readable by other accounts, you can add <tt class="docutils literal"><span class="pre">--umask=022</span></tt> to tell
the buildslave to fix the umask after twistd clobbers it. If you want
build products to be <em>writable</em> by other accounts too, use
<tt class="docutils literal"><span class="pre">--umask=000</span></tt>, but this is likely to be a security problem.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildslave-create-slave--keepalive">
<tt class="descname">--keepalive</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-buildslave-create-slave--keepalive" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a number that indicates how frequently <tt class="docutils literal"><span class="pre">keepalive</span></tt> messages
should be sent from the buildslave to the buildmaster, expressed in
seconds. The default (600) causes a message to be sent to the
buildmaster at least once every 10 minutes. To set this to a lower
value, use e.g. <tt class="docutils literal"><span class="pre">--keepalive=120</span></tt>.</p>
<p>If the buildslave is behind a NAT box or stateful firewall, these
messages may help to keep the connection alive: some NAT boxes tend to
forget about a connection if it has not been used in a while. When
this happens, the buildmaster will think that the buildslave has
disappeared, and builds will time out. Meanwhile the buildslave will
not realize than anything is wrong.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildslave-create-slave--maxdelay">
<tt class="descname">--maxdelay</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-buildslave-create-slave--maxdelay" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a number that indicates the maximum amount of time the
buildslave will wait between connection attempts, expressed in
seconds. The default (300) causes the buildslave to wait at most 5
minutes before trying to connect to the buildmaster again.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildslave-create-slave--log-size">
<tt class="descname">--log-size</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-buildslave-create-slave--log-size" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the size in bytes when to rotate the Twisted log files.</p>
</dd></dl>

<dl class="option">
<dt id="cmdoption-buildslave-create-slave--log-count">
<tt class="descname">--log-count</tt><tt class="descclassname"></tt><a class="headerlink" href="#cmdoption-buildslave-create-slave--log-count" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the number of log rotations to keep around. You can either
specify a number or <tt class="docutils literal"><span class="pre">None</span></tt> to keep all <tt class="file docutils literal"><span class="pre">twistd.log</span></tt> files
around. The default is 10.</p>
</dd></dl>

</div>
<div class="section" id="other-buildslave-configuration">
<span id="id11"></span><h5>Other Buildslave Configuration<a class="headerlink" href="#other-buildslave-configuration" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">unicode_encoding</span></tt></dt>
<dd><p class="first">This represents the encoding that buildbot should use when converting unicode
commandline arguments into byte strings in order to pass to the operating
system when spawning new processes.</p>
<p>The default value is what python's <tt class="xref py py-func docutils literal"><span class="pre">sys.getfilesystemencoding</span></tt> returns, which
on Windows is 'mbcs', on Mac OSX is 'utf-8', and on Unix depends on your locale
settings.</p>
<p class="last">If you need a different encoding, this can be changed in your build slave's
<tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt> file by adding a <tt class="docutils literal"><span class="pre">unicode_encoding</span></tt>
argument  to the BuildSlave constructor.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">allow_shutdown</span></tt></dt>
<dd><p class="first">allow_shutdown can be passed to the BuildSlave constructor in buildbot.tac.  If
set, it allows the buildslave to initiate a graceful shutdown, meaning that it
will ask the master to shut down the slave when the current build, if any, is
complete.</p>
<p>Setting allow_shutdown to <tt class="docutils literal"><span class="pre">file</span></tt> will cause the buildslave to watch
<tt class="file docutils literal"><span class="pre">shutdown.stamp</span></tt> in basedir for updates to its mtime.  When the mtime changes,
the slave will request a graceful shutdown from the master.  The file does not
need to exist prior to starting the slave.</p>
<p>Setting allow_shutdown to <tt class="docutils literal"><span class="pre">signal</span></tt> will set up a SIGHUP handler to start a
graceful shutdown.  When the signal is received, the slave will request a
graceful shutdown from the master.</p>
<p>The default value is <tt class="docutils literal"><span class="pre">None</span></tt>, in which case this feature will be disabled.</p>
<p class="last">Both master and slave must be at least version 0.8.3 for this feature to work.</p>
</dd>
</dl>
<div class="highlight-python"><div class="highlight"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">BuildSlave</span><span class="p">(</span><span class="n">buildmaster_host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">slavename</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">basedir</span><span class="p">,</span>
               <span class="n">keepalive</span><span class="p">,</span> <span class="n">usepty</span><span class="p">,</span> <span class="n">umask</span><span class="o">=</span><span class="n">umask</span><span class="p">,</span> <span class="n">maxdelay</span><span class="o">=</span><span class="n">maxdelay</span><span class="p">,</span>
               <span class="n">unicode_encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">allow_shutdown</span><span class="o">=</span><span class="s">&#39;signal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="upgrading-an-existing-buildslave">
<span id="id12"></span><h4>Upgrading an Existing Buildslave<a class="headerlink" href="#upgrading-an-existing-buildslave" title="Permalink to this headline">¶</a></h4>
<p>If you have just installed a new version of Buildbot-slave, you may need to
take some steps to upgrade it.  If you are upgrading to version 0.8.2 or later,
you can run</p>
<div class="highlight-bash"><div class="highlight"><pre>buildslave upgrade-slave /path/to/buildslave/dir
</pre></div>
</div>
<div class="section" id="buildslave-version-specific-notes">
<span id="id13"></span><h5>Version-specific Notes<a class="headerlink" href="#buildslave-version-specific-notes" title="Permalink to this headline">¶</a></h5>
<div class="section" id="upgrading-a-buildslave-to-buildbot-slave-0-8-1">
<h6>Upgrading a Buildslave to Buildbot-slave-0.8.1<a class="headerlink" href="#upgrading-a-buildslave-to-buildbot-slave-0-8-1" title="Permalink to this headline">¶</a></h6>
<p>Before Buildbot version 0.8.1, the Buildbot master and slave were part of the
same distribution.  As of version 0.8.1, the buildslave is a separate
distribution.</p>
<p>As of this release, you will need to install <tt class="docutils literal"><span class="pre">buildbot-slave</span></tt> to run a slave.</p>
<p>Any automatic startup scripts that had run <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">start</span></tt> for previous versions
should be changed to run <tt class="docutils literal"><span class="pre">buildslave</span> <span class="pre">start</span></tt> instead.</p>
<p>If you are running a version later than 0.8.1, then you can skip the remainder
of this section: the <tt class="docutils literal"><span class="pre">`upgrade-slave</span></tt> command will take care of this.  If
you are upgrading directly to 0.8.1, read on.</p>
<p>The existing <tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt> for any buildslaves running older versions
will need to be edited or replaced.  If the loss of cached buildslave state
(e.g., for Source steps in copy mode) is not problematic, the easiest solution
is to simply delete the slave directory and re-run <tt class="docutils literal"><span class="pre">buildslave</span>
<span class="pre">create-slave</span></tt>.</p>
<p>If deleting the slave directory is problematic, the change to
<tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt> is simple.  On line 3, replace</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.slave.bot</span> <span class="kn">import</span> <span class="n">BuildSlave</span>
</pre></div>
</div>
<p>with</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildslave.bot</span> <span class="kn">import</span> <span class="n">BuildSlave</span>
</pre></div>
</div>
<p>After this change, the buildslave should start as usual.</p>
</div>
</div>
</div>
<div class="section" id="launching-the-daemons">
<span id="id14"></span><h4>Launching the daemons<a class="headerlink" href="#launching-the-daemons" title="Permalink to this headline">¶</a></h4>
<p>Both the buildmaster and the buildslave run as daemon programs. To
launch them, pass the working directory to the <strong class="command">buildbot</strong>
and <strong class="command">buildslave</strong> commands, as appropriate:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># start a master</span>
buildbot start <span class="o">[</span> BASEDIR <span class="o">]</span>
<span class="c"># start a slave</span>
buildslave start <span class="o">[</span> SLAVE_BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>The <em>BASEDIR</em> is option and can be omitted if the current directory
contains the buildbot configuration (the <tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt> file).</p>
<div class="highlight-bash"><div class="highlight"><pre>buildbot start
</pre></div>
</div>
<p>This command will start the daemon and then return, so normally it
will not produce any output. To verify that the programs are indeed
running, look for a pair of files named <tt class="file docutils literal"><span class="pre">twistd.log</span></tt> and
<tt class="file docutils literal"><span class="pre">twistd.pid</span></tt> that should be created in the working directory.
<tt class="file docutils literal"><span class="pre">twistd.pid</span></tt> contains the process ID of the newly-spawned daemon.</p>
<p>When the buildslave connects to the buildmaster, new directories will
start appearing in its base directory. The buildmaster tells the slave
to create a directory for each Builder which will be using that slave.
All build operations are performed within these directories: CVS
checkouts, compiles, and tests.</p>
<p>Once you get everything running, you will want to arrange for the
buildbot daemons to be started at boot time. One way is to use
<strong class="command">cron</strong>, by putting them in a <tt class="docutils literal"><span class="pre">&#64;reboot</span></tt> crontab entry <a class="footnote-reference" href="#f1" id="id15">[1]</a></p>
<div class="highlight-none"><div class="highlight"><pre>@reboot buildbot start [ BASEDIR ]
</pre></div>
</div>
<p>When you run <strong class="command">crontab</strong> to set this up, remember to do it as
the buildmaster or buildslave account! If you add this to your crontab
when running as your regular account (or worse yet, root), then the
daemon will run as the wrong user, quite possibly as one with more
authority than you intended to provide.</p>
<p>It is important to remember that the environment provided to cron jobs
and init scripts can be quite different that your normal runtime.
There may be fewer environment variables specified, and the <span class="target" id="index-1"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt> may
be shorter than usual. It is a good idea to test out this method of
launching the buildslave by using a cron job with a time in the near
future, with the same command, and then check <tt class="file docutils literal"><span class="pre">twistd.log</span></tt> to
make sure the slave actually started correctly. Common problems here
are for <tt class="file docutils literal"><span class="pre">/usr/local</span></tt> or <tt class="file docutils literal"><span class="pre">~/bin</span></tt> to not be on your
<span class="target" id="index-2"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt>, or for <span class="target" id="index-3"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> to not be set correctly.
Sometimes <span class="target" id="index-4"></span><tt class="xref std std-envvar docutils literal"><span class="pre">HOME</span></tt> is messed up too.</p>
<p>Some distributions may include conveniences to make starting buildbot
at boot time easy.  For instance, with the default buildbot package in
Debian-based distributions, you may only need to modify
<tt class="file docutils literal"><span class="pre">/etc/default/buildbot</span></tt> (see also <tt class="file docutils literal"><span class="pre">/etc/init.d/buildbot</span></tt>, which
reads the configuration in <tt class="file docutils literal"><span class="pre">/etc/default/buildbot</span></tt>).</p>
<p>Buildbot also comes with its own init scripts that provide support for
controlling multi-slave and multi-master setups (mostly because they are based
on the init script from the Debian package).  With a little modification these
scripts can be used both on Debian and RHEL-based distributions and may thus
prove helpful to package maintainers who are working on buildbot (or those that
haven't yet split buildbot into master and slave packages).</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="c"># install as /etc/default/buildslave</span>
<span class="c">#         or /etc/sysconfig/buildslave</span>
master/contrib/init-scripts/buildslave.default

<span class="c"># install as /etc/default/buildmaster</span>
<span class="c">#         or /etc/sysconfig/buildmaster</span>
master/contrib/init-scripts/buildmaster.default

<span class="c"># install as /etc/init.d/buildslave</span>
slave/contrib/init-scripts/buildslave.init.sh

<span class="c"># install as /etc/init.d/buildmaster</span>
slave/contrib/init-scripts/buildmaster.init.sh

<span class="c"># ... and tell sysvinit about them</span>
chkconfig buildmaster reset
<span class="c"># ... or</span>
update-rc.d buildmaster defaults
</pre></div>
</div>
</div>
<div class="section" id="logfiles">
<span id="id16"></span><h4>Logfiles<a class="headerlink" href="#logfiles" title="Permalink to this headline">¶</a></h4>
<p>While a buildbot daemon runs, it emits text to a logfile, named
<tt class="file docutils literal"><span class="pre">twistd.log</span></tt>. A command like <tt class="docutils literal"><span class="pre">tail</span> <span class="pre">-f</span> <span class="pre">twistd.log</span></tt> is useful
to watch the command output as it runs.</p>
<p>The buildmaster will announce any errors with its configuration file
in the logfile, so it is a good idea to look at the log at startup
time to check for any problems. Most buildmaster activities will cause
lines to be added to the log.</p>
</div>
<div class="section" id="shutdown">
<span id="id17"></span><h4>Shutdown<a class="headerlink" href="#shutdown" title="Permalink to this headline">¶</a></h4>
<p>To stop a buildmaster or buildslave manually, use:</p>
<div class="highlight-bash"><div class="highlight"><pre>buildbot stop <span class="o">[</span> BASEDIR <span class="o">]</span>
<span class="c"># or</span>
buildslave stop <span class="o">[</span> SLAVE_BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>This simply looks for the <tt class="file docutils literal"><span class="pre">twistd.pid</span></tt> file and kills whatever
process is identified within.</p>
<p>At system shutdown, all processes are sent a <tt class="docutils literal"><span class="pre">SIGKILL</span></tt>. The
buildmaster and buildslave will respond to this by shutting down
normally.</p>
<p>The buildmaster will respond to a <tt class="docutils literal"><span class="pre">SIGHUP</span></tt> by re-reading its
config file. Of course, this only works on Unix-like systems with
signal support, and won't work on Windows. The following shortcut is
available:</p>
<div class="highlight-bash"><div class="highlight"><pre>buildbot reconfig <span class="o">[</span> BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>When you update the Buildbot code to a new release, you will need to
restart the buildmaster and/or buildslave before it can take advantage
of the new code. You can do a <tt class="samp docutils literal"><span class="pre">buildbot</span> <span class="pre">stop</span> <em><span class="pre">BASEDIR</span></em></tt> and
<tt class="samp docutils literal"><span class="pre">buildbot</span> <span class="pre">start</span> <em><span class="pre">BASEDIR</span></em></tt> in quick succession, or you can
use the <tt class="docutils literal"><span class="pre">restart</span></tt> shortcut, which does both steps for you:</p>
<div class="highlight-bash"><div class="highlight"><pre>buildbot restart <span class="o">[</span> BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>Buildslaves can similarly be restarted with:</p>
<div class="highlight-bash"><div class="highlight"><pre>buildslave restart <span class="o">[</span> BASEDIR <span class="o">]</span>
</pre></div>
</div>
<p>There are certain configuration changes that are not handled cleanly
by <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">reconfig</span></tt>. If this occurs, <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">restart</span></tt>
is a more robust tool to fully switch over to the new configuration.</p>
<p><tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">restart</span></tt> may also be used to start a stopped Buildbot
instance. This behaviour is useful when writing scripts that stop, start
and restart Buildbot.</p>
<p>A buildslave may also be gracefully shutdown from the
<a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">WebStatus</span></tt></a> status plugin. This is useful to shutdown a
buildslave without interrupting any current builds. The buildmaster
will wait until the buildslave is finished all its current builds, and
will then tell the buildslave to shutdown.</p>
</div>
<div class="section" id="maintenance">
<span id="id18"></span><h4>Maintenance<a class="headerlink" href="#maintenance" title="Permalink to this headline">¶</a></h4>
<p>The buildmaster can be configured to send out email notifications when a
slave has been offline for a while.  Be sure to configure the buildmaster
with a contact email address for each slave so these notifications are sent
to someone who can bring it back online.</p>
<p>If you find you can no longer provide a buildslave to the project, please
let the project admins know, so they can put out a call for a
replacement.</p>
<p>The Buildbot records status and logs output continually, each time a
build is performed. The status tends to be small, but the build logs
can become quite large. Each build and log are recorded in a separate
file, arranged hierarchically under the buildmaster's base directory.
To prevent these files from growing without bound, you should
periodically delete old build logs. A simple cron job to delete
anything older than, say, two weeks should do the job. The only trick
is to leave the <tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt> and other support files alone, for
which <strong class="command">find</strong>'s <tt class="docutils literal"><span class="pre">-mindepth</span></tt> argument helps skip everything in the
top directory. You can use something like the following:</p>
<div class="highlight-none"><div class="highlight"><pre>@weekly cd BASEDIR &amp;&amp; find . -mindepth 2 i-path &#39;./public_html/*&#39; \
    -prune -o -type f -mtime +14 -exec rm {} \;
@weekly cd BASEDIR &amp;&amp; find twistd.log* -mtime +14 -exec rm {} \;
</pre></div>
</div>
<p>Alternatively, you can configure a maximum number of old logs to be kept
using the <tt class="docutils literal"><span class="pre">--log-count</span></tt> command line option when running <tt class="docutils literal"><span class="pre">buildslave</span>
<span class="pre">create-slave</span></tt> or <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">create-master</span></tt>.</p>
</div>
<div class="section" id="troubleshooting">
<span id="id19"></span><h4>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h4>
<p>Here are a few hints on diagnosing common problems.</p>
<div class="section" id="starting-the-buildslave">
<span id="id20"></span><h5>Starting the buildslave<a class="headerlink" href="#starting-the-buildslave" title="Permalink to this headline">¶</a></h5>
<p>Cron jobs are typically run with a minimal shell (<tt class="file docutils literal"><span class="pre">/bin/sh</span></tt>, not
<tt class="file docutils literal"><span class="pre">/bin/bash</span></tt>), and tilde expansion is not always performed in such
commands. You may want to use explicit paths, because the <span class="target" id="index-5"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt>
is usually quite short and doesn't include anything set by your
shell's startup scripts (<tt class="file docutils literal"><span class="pre">.profile</span></tt>, <tt class="file docutils literal"><span class="pre">.bashrc</span></tt>, etc). If
you've installed buildbot (or other python libraries) to an unusual
location, you may need to add a <span class="target" id="index-6"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> specification (note
that python will do tilde-expansion on <span class="target" id="index-7"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> elements by
itself). Sometimes it is safer to fully-specify everything:</p>
<div class="highlight-none"><div class="highlight"><pre>@reboot PYTHONPATH=~/lib/python /usr/local/bin/buildbot \
    start /usr/home/buildbot/basedir
</pre></div>
</div>
<p>Take the time to get the <tt class="docutils literal"><span class="pre">&#64;reboot</span></tt> job set up. Otherwise, things will work
fine for a while, but the first power outage or system reboot you have will
stop the buildslave with nothing but the cries of sorrowful developers to
remind you that it has gone away.</p>
</div>
<div class="section" id="connecting-to-the-buildmaster">
<span id="id21"></span><h5>Connecting to the buildmaster<a class="headerlink" href="#connecting-to-the-buildmaster" title="Permalink to this headline">¶</a></h5>
<p>If the buildslave cannot connect to the buildmaster, the reason should
be described in the <tt class="file docutils literal"><span class="pre">twistd.log</span></tt> logfile. Some common problems
are an incorrect master hostname or port number, or a mistyped bot
name or password. If the buildslave loses the connection to the
master, it is supposed to attempt to reconnect with an
exponentially-increasing backoff. Each attempt (and the time of the
next attempt) will be logged. If you get impatient, just manually stop
and re-start the buildslave.</p>
<p>When the buildmaster is restarted, all slaves will be disconnected, and will
attempt to reconnect as usual. The reconnect time will depend upon how long the
buildmaster is offline (i.e. how far up the exponential backoff curve the
slaves have travelled). Again, <tt class="samp docutils literal"><span class="pre">buildslave</span> <span class="pre">restart</span> <em><span class="pre">BASEDIR</span></em></tt> will
speed up the process.</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id15">[1]</a></td><td>This <tt class="docutils literal"><span class="pre">&#64;reboot</span></tt> syntax is understood by Vixie cron, which is the flavor
usually provided with Linux systems. Other unices may have a cron that
doesn't understand <tt class="docutils literal"><span class="pre">&#64;reboot</span></tt>:</td></tr>
</tbody>
</table>
</div>
<div class="section" id="contrib-scripts">
<span id="id22"></span><h5>Contrib Scripts<a class="headerlink" href="#contrib-scripts" title="Permalink to this headline">¶</a></h5>
<p>While some features of Buildbot are included in the distribution, others are
only available in <tt class="file docutils literal"><span class="pre">contrib/</span></tt> in the source directory.  The latest versions
of such scripts are available at
<a class="reference external" href="http://github.com/buildbot/buildbot/tree/master/master/contrib">http://github.com/buildbot/buildbot/tree/master/master/contrib</a>.</p>
</div>
</div>
</div>
<span id="document-manual/concepts"></span><div class="section" id="concepts">
<h3>Concepts<a class="headerlink" href="#concepts" title="Permalink to this headline">¶</a></h3>
<p>This chapter defines some of the basic concepts that the Buildbot
uses. You'll need to understand how the Buildbot sees the world to
configure it properly.</p>
<div class="section" id="source-stamps">
<span id="id1"></span><h4>Source Stamps<a class="headerlink" href="#source-stamps" title="Permalink to this headline">¶</a></h4>
<p>Source code comes from <em>respositories</em>, provided by version control systems.
Repositories are generally identified by URLs, e.g., <tt class="docutils literal"><span class="pre">git://github.com/buildbot/buildbot.git</span></tt>.</p>
<p>In these days of distribtued version control systems, the same <em>codebase</em> may appear in mutiple repositories.
For example, <tt class="docutils literal"><span class="pre">https://github.com/mozilla/mozilla-central</span></tt> and <tt class="docutils literal"><span class="pre">http://hg.mozilla.org/mozilla-release</span></tt> both contain the Firefox codebase, although not exactly the same code.</p>
<p>Many <em>projects</em> are built from multiple codebases.
For example, a company may build several applications based on the same core library.
The &quot;app&quot; codebase and the &quot;core&quot; codebase are in separate repositories, but are compiled together and constitute a single project.
Changes to either codebase should cause a rebuild of the application.</p>
<p>Most version control systems define some sort of <em>revision</em> that can be used (sometimes in combination with a <em>branch</em>) to uniquely specify a particular version of the source code.</p>
<p>To build a project, Buildbot needs to know exactly which version of each codebase it should build.
It uses a <em>source stamp</em> to do so for each codebase; the collection of sourcestamps required for a project is called a <em>source stamp set</em>.</p>
</div>
<div class="section" id="version-control-systems">
<span id="id2"></span><h4>Version Control Systems<a class="headerlink" href="#version-control-systems" title="Permalink to this headline">¶</a></h4>
<p>Buildbot supports a significant number of version control systems, so it treats them abstractly.</p>
<p>For purposes of deciding when to perform builds, Buildbot's change sources monitor repositories, and represent any updates to those repositories as <em>changes</em>.
These change sources fall broadly into two categories: pollers which periodically check the repository for updates; and hooks, where the repository is configured to notify Buildbot whenever an update occurs.</p>
<p>This concept does not map perfectly to every version control system.
For example, for CVS Buildbot must guess that version updates made to multiple files within a short time represent a single change; for DVCS's like Git, Buildbot records a change when a commit is pushed to the monitored repository, not when it is initially committed.
We assume that the <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s arrive at the master in the same order in which they are committed to the repository.</p>
<p>When it comes time to actually perform a build, a scheduler prepares a source stamp set, as described above, based on its configuration.
When the build begins, one or more source steps use the information in the source stamp set to actually check out the source code, using the normal VCS commands.</p>
<div class="section" id="tree-stability">
<h5>Tree Stability<a class="headerlink" href="#tree-stability" title="Permalink to this headline">¶</a></h5>
<p>Changes tend to arrive at a buildmaster in bursts.
In many cases, these bursts of changes are meant to be taken together.
For example, a developer may have pushed multiple commits to a DVCS that comprise the same new feature or bugfix.
To avoid trying to build every change, Buildbot supports the notion of <em>tree stability</em>, by waiting for a burst of changes to finish before starting to schedule builds.
This is implemented as a timer, with builds not scheduled until no changes have occurred for the duration of the timer.</p>
</div>
<div class="section" id="how-different-vc-systems-specify-sources">
<span id="id3"></span><h5>How Different VC Systems Specify Sources<a class="headerlink" href="#how-different-vc-systems-specify-sources" title="Permalink to this headline">¶</a></h5>
<p>For CVS, the static specifications are <em>repository</em> and
<em>module</em>. In addition to those, each build uses a timestamp (or
omits the timestamp to mean <em>the latest</em>) and <em>branch tag</em>
(which defaults to <tt class="docutils literal"><span class="pre">HEAD</span></tt>). These parameters collectively specify a set
of sources from which a build may be performed.</p>
<p><a class="reference external" href="http://subversion.tigris.org">Subversion</a>,  combines the
repository, module, and branch into a single <em>Subversion URL</em>
parameter. Within that scope, source checkouts can be specified by a
numeric <em>revision number</em> (a repository-wide
monotonically-increasing marker, such that each transaction that
changes the repository is indexed by a different revision number), or
a revision timestamp. When branches are used, the repository and
module form a static <tt class="docutils literal"><span class="pre">baseURL</span></tt>, while each build has a
<em>revision number</em> and a <em>branch</em> (which defaults to a
statically-specified <tt class="docutils literal"><span class="pre">defaultBranch</span></tt>). The <tt class="docutils literal"><span class="pre">baseURL</span></tt> and
<tt class="docutils literal"><span class="pre">branch</span></tt> are simply concatenated together to derive the
<tt class="docutils literal"><span class="pre">svnurl</span></tt> to use for the checkout.</p>
<p><a class="reference external" href="http://www.perforce.com/">Perforce</a> is similar. The server
is specified through a <tt class="docutils literal"><span class="pre">P4PORT</span></tt> parameter. Module and branch
are specified in a single depot path, and revisions are
depot-wide. When branches are used, the <tt class="docutils literal"><span class="pre">p4base</span></tt> and
<tt class="docutils literal"><span class="pre">defaultBranch</span></tt> are concatenated together to produce the depot
path.</p>
<p><a class="reference external" href="http://bazaar-vcs.org">Bzr</a> (which is a descendant of
Arch/Bazaar, and is frequently referred to as &quot;Bazaar&quot;) has the same
sort of repository-vs-workspace model as Arch, but the repository data
can either be stored inside the working directory or kept elsewhere
(either on the same machine or on an entirely different machine). For
the purposes of Buildbot (which never commits changes), the repository
is specified with a URL and a revision number.</p>
<p>The most common way to obtain read-only access to a bzr tree is via
HTTP, simply by making the repository visible through a web server
like Apache. Bzr can also use FTP and SFTP servers, if the buildslave
process has sufficient privileges to access them. Higher performance
can be obtained by running a special Bazaar-specific server. None of
these matter to the buildbot: the repository URL just has to match the
kind of server being used. The <tt class="docutils literal"><span class="pre">repoURL</span></tt> argument provides the
location of the repository.</p>
<p>Branches are expressed as subdirectories of the main central
repository, which means that if branches are being used, the BZR step
is given a <tt class="docutils literal"><span class="pre">baseURL</span></tt> and <tt class="docutils literal"><span class="pre">defaultBranch</span></tt> instead of getting
the <tt class="docutils literal"><span class="pre">repoURL</span></tt> argument.</p>
<p><a class="reference external" href="http://darcs.net/">Darcs</a> doesn't really have the
notion of a single master repository. Nor does it really have
branches. In Darcs, each working directory is also a repository, and
there are operations to push and pull patches from one of these
<tt class="docutils literal"><span class="pre">repositories</span></tt> to another. For the Buildbot's purposes, all you
need to do is specify the URL of a repository that you want to build
from. The build slave will then pull the latest patches from that
repository and build them. Multiple branches are implemented by using
multiple repositories (possibly living on the same server).</p>
<p>Builders which use Darcs therefore have a static <tt class="docutils literal"><span class="pre">repourl</span></tt> which
specifies the location of the repository. If branches are being used,
the source Step is instead configured with a <tt class="docutils literal"><span class="pre">baseURL</span></tt> and a
<tt class="docutils literal"><span class="pre">defaultBranch</span></tt>, and the two strings are simply concatenated
together to obtain the repository's URL. Each build then has a
specific branch which replaces <tt class="docutils literal"><span class="pre">defaultBranch</span></tt>, or just uses the
default one. Instead of a revision number, each build can have a
<tt class="docutils literal"><span class="pre">context</span></tt>, which is a string that records all the patches that are
present in a given tree (this is the output of <tt class="docutils literal"><span class="pre">darcs</span> <span class="pre">changes</span>
<span class="pre">--context</span></tt>, and is considerably less concise than, e.g. Subversion's
revision number, but the patch-reordering flexibility of Darcs makes
it impossible to provide a shorter useful specification).</p>
<p><a class="reference external" href="http://selenic.com/mercurial">Mercurial</a> is like Darcs, in that
each branch is stored in a separate repository. The <tt class="docutils literal"><span class="pre">repourl</span></tt>,
<tt class="docutils literal"><span class="pre">baseURL</span></tt>, and <tt class="docutils literal"><span class="pre">defaultBranch</span></tt> arguments are all handled the
same way as with Darcs. The <em>revision</em>, however, is the hash
identifier returned by <tt class="docutils literal"><span class="pre">hg</span> <span class="pre">identify</span></tt>.</p>
<p><a class="reference external" href="http://git.or.cz/">Git</a> also follows a decentralized model, and
each repository can have several branches and tags. The source Step is
configured with a static <tt class="docutils literal"><span class="pre">repourl</span></tt> which specifies the location
of the repository. In addition, an optional <tt class="docutils literal"><span class="pre">branch</span></tt> parameter
can be specified to check out code from a specific branch instead of
the default <em>master</em> branch. The <em>revision</em> is specified as a SHA1
hash as returned by e.g. <tt class="docutils literal"><span class="pre">git</span> <span class="pre">rev-parse</span></tt>. No attempt is made
to ensure that the specified revision is actually a subset of the
specified branch.</p>
<p><a class="reference external" href="http://www.monotone.ca/">Monotone</a> is another that follows a
decentralized model where each repository can have several branches and
tags. The source Step is configured with static <tt class="docutils literal"><span class="pre">repourl</span></tt> and
<tt class="docutils literal"><span class="pre">branch</span></tt> parameters, which specifies the location of the
repository and the branch to use.  The <em>revision</em> is specified as a
SHA1 hash as returned by e.g. <tt class="docutils literal"><span class="pre">mtn</span> <span class="pre">automate</span> <span class="pre">select</span> <span class="pre">w:</span></tt>. No
attempt is made to ensure that the specified revision is actually a
subset of the specified branch.</p>
</div>
</div>
<div class="section" id="changes">
<span id="attributes-of-changes"></span><h4>Changes<a class="headerlink" href="#changes" title="Permalink to this headline">¶</a></h4>
<div class="section" id="who">
<span id="attr-who"></span><h5>Who<a class="headerlink" href="#who" title="Permalink to this headline">¶</a></h5>
<p>Each <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt> has a <tt class="xref py py-attr docutils literal"><span class="pre">who</span></tt> attribute, which specifies which developer is
responsible for the change. This is a string which comes from a namespace
controlled by the VC repository. Frequently this means it is a username on the
host which runs the repository, but not all VC systems require this.  Each
<tt class="xref py py-class docutils literal"><span class="pre">StatusNotifier</span></tt> will map the <tt class="xref py py-attr docutils literal"><span class="pre">who</span></tt> attribute into something appropriate for
their particular means of communication: an email address, an IRC handle, etc.</p>
<p>This <tt class="docutils literal"><span class="pre">who</span></tt> attribute is also parsed and stored into Buildbot's database (see
<a class="reference internal" href="#user-objects"><em>User Objects</em></a>). Currently, only <tt class="docutils literal"><span class="pre">who</span></tt> attributes in Changes from
<tt class="docutils literal"><span class="pre">git</span></tt> repositories are translated into user objects, but in the future all
incoming Changes will have their <tt class="docutils literal"><span class="pre">who</span></tt> parsed and stored.</p>
</div>
<div class="section" id="files">
<span id="attr-files"></span><h5>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h5>
<p>It also has a list of <tt class="xref py py-attr docutils literal"><span class="pre">files</span></tt>, which are just the tree-relative
filenames of any files that were added, deleted, or modified for this
<tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>. These filenames are used by the <tt class="xref py py-func docutils literal"><span class="pre">fileIsImportant</span></tt>
function (in the <tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt>) to decide whether it is worth triggering a
new build or not, e.g. the function could use the following function
to only run a build if a C file were checked in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">has_C_files</span><span class="p">(</span><span class="n">change</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">change</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.c&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>Certain <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s can also use the list of changed files
to run a more targeted series of tests, e.g. the
<tt class="docutils literal"><span class="pre">python_twisted.Trial</span></tt> step can run just the unit tests that
provide coverage for the modified .py files instead of running the
full test suite.</p>
</div>
<div class="section" id="comments">
<span id="attr-comments"></span><h5>Comments<a class="headerlink" href="#comments" title="Permalink to this headline">¶</a></h5>
<p>The Change also has a <tt class="xref py py-attr docutils literal"><span class="pre">comments</span></tt> attribute, which is a string containing any checkin comments.</p>
</div>
<div class="section" id="project">
<span id="attr-project"></span><h5>Project<a class="headerlink" href="#project" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="xref py py-attr docutils literal"><span class="pre">project</span></tt> attribute of a change or source stamp describes the project to which it corresponds, as a short human-readable string.
This is useful in cases where multiple independent projects are built on the same buildmaster.
In such cases, it can be used to control which builds are scheduled for a given commit, and to limit status displays to only one project.</p>
</div>
<div class="section" id="repository">
<span id="attr-repository"></span><h5>Repository<a class="headerlink" href="#repository" title="Permalink to this headline">¶</a></h5>
<p>This attibute specifies the repository in which this change occurred.
In the case of DVCS's, this information may be required to check out the committed source code.
However, using the repository from a change has security risks: if Buildbot is configured to blidly trust this information, then it may easily be tricked into building arbitrary source code, potentially compromising the buildslaves and the integrity of subsequent builds.</p>
</div>
<div class="section" id="codebase">
<span id="attr-codebase"></span><h5>Codebase<a class="headerlink" href="#codebase" title="Permalink to this headline">¶</a></h5>
<p>This attribute specifies the codebase to which this change was made.
As described <a class="reference internal" href="#source-stamps"><em>above</em></a>, multiple repositories may contain the same codebase.
A change's codebase is usually determined by the bb:cfg:<cite>codebaseGenerator</cite> configuration.
By default the codebase is ''; this value is used automatically for single-codebase configurations.</p>
</div>
<div class="section" id="revision">
<span id="attr-revision"></span><h5>Revision<a class="headerlink" href="#revision" title="Permalink to this headline">¶</a></h5>
<p>Each Change can have a <tt class="xref py py-attr docutils literal"><span class="pre">revision</span></tt> attribute, which describes how
to get a tree with a specific state: a tree which includes this Change
(and all that came before it) but none that come after it. If this
information is unavailable, the <tt class="xref py py-attr docutils literal"><span class="pre">revision</span></tt> attribute will be
<tt class="docutils literal"><span class="pre">None</span></tt>. These revisions are provided by the <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>.</p>
<p>Revisions are always strings.</p>
<dl class="docutils">
<dt><cite>CVS</cite></dt>
<dd><tt class="xref py py-attr docutils literal"><span class="pre">revision</span></tt> is the seconds since the epoch as an integer.</dd>
<dt><cite>SVN</cite></dt>
<dd><tt class="xref py py-attr docutils literal"><span class="pre">revision</span></tt> is the revision number</dd>
<dt><cite>Darcs</cite></dt>
<dd><tt class="xref py py-attr docutils literal"><span class="pre">revision</span></tt> is a large string, the output of <strong class="command">darcs changes --context</strong></dd>
<dt><cite>Mercurial</cite></dt>
<dd><tt class="xref py py-attr docutils literal"><span class="pre">revision</span></tt> is a short string (a hash ID), the output of <strong class="command">hg identify</strong></dd>
<dt><cite>P4</cite></dt>
<dd><tt class="xref py py-attr docutils literal"><span class="pre">revision</span></tt> is the transaction number</dd>
<dt><cite>Git</cite></dt>
<dd><tt class="xref py py-attr docutils literal"><span class="pre">revision</span></tt> is a short string (a SHA1 hash), the output of e.g.
<strong class="command">git rev-parse</strong></dd>
</dl>
</div>
<div class="section" id="branches">
<h5>Branches<a class="headerlink" href="#branches" title="Permalink to this headline">¶</a></h5>
<p>The Change might also have a <tt class="xref py py-attr docutils literal"><span class="pre">branch</span></tt> attribute. This indicates
that all of the Change's files are in the same named branch. The
Schedulers get to decide whether the branch should be built or not.</p>
<p>For VC systems like CVS,  Git and Monotone the <tt class="xref py py-attr docutils literal"><span class="pre">branch</span></tt>
name is unrelated to the filename. (that is, the branch name and the
filename inhabit unrelated namespaces). For SVN, branches are
expressed as subdirectories of the repository, so the file's
<tt class="docutils literal"><span class="pre">svnurl</span></tt> is a combination of some base URL, the branch name, and the
filename within the branch. (In a sense, the branch name and the
filename inhabit the same namespace). Darcs branches are
subdirectories of a base URL just like SVN. Mercurial branches are the
same as Darcs.</p>
<dl class="docutils">
<dt><cite>CVS</cite></dt>
<dd>branch='warner-newfeature', files=['src/foo.c']</dd>
<dt><cite>SVN</cite></dt>
<dd>branch='branches/warner-newfeature', files=['src/foo.c']</dd>
<dt><cite>Darcs</cite></dt>
<dd>branch='warner-newfeature', files=['src/foo.c']</dd>
<dt><cite>Mercurial</cite></dt>
<dd>branch='warner-newfeature', files=['src/foo.c']</dd>
<dt><cite>Git</cite></dt>
<dd>branch='warner-newfeature', files=['src/foo.c']</dd>
<dt><cite>Monotone</cite></dt>
<dd>branch='warner-newfeature', files=['src/foo.c']</dd>
</dl>
</div>
<div class="section" id="change-properties">
<h5>Change Properties<a class="headerlink" href="#change-properties" title="Permalink to this headline">¶</a></h5>
<p>A Change may have one or more properties attached to it, usually specified
through the Force Build form or <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">sendchange</span></tt></a>. Properties are discussed
in detail in the <a class="reference internal" href="#build-properties"><em>Build Properties</em></a> section.</p>
</div>
</div>
<div class="section" id="scheduling-builds">
<span id="id4"></span><h4>Scheduling Builds<a class="headerlink" href="#scheduling-builds" title="Permalink to this headline">¶</a></h4>
<p>Each Buildmaster has a set of <tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt> objects, each of which
gets a copy of every incoming <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>. The Schedulers are responsible
for deciding when <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s should be run. Some Buildbot installations
might have a single <tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt>, while others may have several, each for
a different purpose.</p>
<p>For example, a <em>quick</em> scheduler might exist to give immediate
feedback to developers, hoping to catch obvious problems in the code
that can be detected quickly. These typically do not run the full test
suite, nor do they run on a wide variety of platforms. They also
usually do a VC update rather than performing a brand-new checkout
each time.</p>
<p>A separate <em>full</em> scheduler might run more comprehensive tests, to
catch more subtle problems. configured to run after the quick scheduler, to give
developers time to commit fixes to bugs caught by the quick scheduler before
running the comprehensive tests.  This scheduler would also feed multiple
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s.</p>
<p>Many schedulers can be configured to wait a while after seeing a source-code
change - this is the <em>tree stable timer</em>.  The timer allows multiple commits to
be &quot;batched&quot; together.  This is particularly useful in distributed version
control systems, where a developer may push a long sequence of changes all at
once.  To save resources, it's often desirable only to test the most recent
change.</p>
<p>Schedulers can also filter out the changes they are interested in, based on a
number of criteria.  For example, a scheduler that only builds documentation
might skip any changes that do not affect the documentation.  Schedulers can
also filter on the branch to which a commit was made.</p>
<p>There is some support for configuring dependencies between builds - for
example, you may want to build packages only for revisions which pass all of
the unit tests.  This support is under active development in Buildbot, and is
referred to as &quot;build coordination&quot;.</p>
<p>Periodic builds (those which are run every N seconds rather than after
new Changes arrive) are triggered by a special <tt class="xref py py-class docutils literal"><span class="pre">Periodic</span></tt>
Scheduler subclass.</p>
<p>Each Scheduler creates and submits <tt class="xref py py-class docutils literal"><span class="pre">BuildSet</span></tt> objects to the
<tt class="xref py py-class docutils literal"><span class="pre">BuildMaster</span></tt>, which is then responsible for making sure the
individual <tt class="xref py py-class docutils literal"><span class="pre">BuildRequests</span></tt> are delivered to the target
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s.</p>
<p><tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt> instances are activated by placing them in the
<tt class="docutils literal"><span class="pre">c['schedulers']</span></tt> list in the buildmaster config file. Each
<tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt> has a unique name.</p>
</div>
<div class="section" id="buildsets">
<span id="buildset"></span><h4>BuildSets<a class="headerlink" href="#buildsets" title="Permalink to this headline">¶</a></h4>
<p>A <tt class="xref py py-class docutils literal"><span class="pre">BuildSet</span></tt> is the name given to a set of <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s that all
compile/test the same version of the tree on multiple <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s. In
general, all these component <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s will perform the same sequence of
<tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt>s, using the same source code, but on different platforms or
against a different set of libraries.</p>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">BuildSet</span></tt> is tracked as a single unit, which fails if any of
the component <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s have failed, and therefore can succeed only if
<em>all</em> of the component <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s have succeeded. There are two kinds
of status notification messages that can be emitted for a <tt class="xref py py-class docutils literal"><span class="pre">BuildSet</span></tt>:
the <tt class="docutils literal"><span class="pre">firstFailure</span></tt> type (which fires as soon as we know the
<tt class="xref py py-class docutils literal"><span class="pre">BuildSet</span></tt> will fail), and the <tt class="docutils literal"><span class="pre">Finished</span></tt> type (which fires once
the <tt class="xref py py-class docutils literal"><span class="pre">BuildSet</span></tt> has completely finished, regardless of whether the
overall set passed or failed).</p>
<p>A <tt class="xref py py-class docutils literal"><span class="pre">BuildSet</span></tt> is created with set of one or more <em>source stamp</em> tuples of
<tt class="docutils literal"><span class="pre">(branch,</span> <span class="pre">revision,</span> <span class="pre">changes,</span> <span class="pre">patch)</span></tt>, some of which may be <tt class="docutils literal"><span class="pre">None</span></tt>, and a
list of <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s on which it is to be run. They are then given to the
BuildMaster, which is responsible for creating a separate
<tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> for each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>.</p>
<p>There are a couple of different likely values for the
<tt class="docutils literal"><span class="pre">SourceStamp</span></tt>:</p>
<dl class="docutils">
<dt><tt class="samp docutils literal"><span class="pre">(revision=None,</span> <span class="pre">changes=</span><em><span class="pre">CHANGES</span></em><span class="pre">,</span> <span class="pre">patch=None)</span></tt></dt>
<dd>This is a <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt> used when a series of <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s have
triggered a build. The VC step will attempt to check out a tree that
contains <em>CHANGES</em> (and any changes that occurred before <em>CHANGES</em>, but
not any that occurred after them.)</dd>
<dt><tt class="samp docutils literal"><span class="pre">(revision=None,</span> <span class="pre">changes=None,</span> <span class="pre">patch=None)</span></tt></dt>
<dd>This builds the most recent code on the default branch. This is the
sort of <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt> that would be used on a <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> that was
triggered by a user request, or a <tt class="xref py py-class docutils literal"><span class="pre">Periodic</span></tt> scheduler. It is also
possible to configure the VC Source Step to always check out the
latest sources rather than paying attention to the <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s in the
<tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt>, which will result in same behavior as this.</dd>
<dt><tt class="samp docutils literal"><span class="pre">(branch=</span><em><span class="pre">BRANCH</span></em><span class="pre">,</span> <span class="pre">revision=None,</span> <span class="pre">changes=None,</span> <span class="pre">patch=None)</span></tt></dt>
<dd>This builds the most recent code on the given <em>BRANCH</em>. Again, this is
generally triggered by a user request or <tt class="xref py py-class docutils literal"><span class="pre">Periodic</span></tt> build.</dd>
<dt><tt class="samp docutils literal"><span class="pre">(revision=</span><em><span class="pre">REV</span></em><span class="pre">,</span> <span class="pre">changes=None,</span> <span class="pre">patch=(</span><em><span class="pre">LEVEL</span></em><span class="pre">,</span> <em><span class="pre">DIFF</span></em><span class="pre">,</span> <em><span class="pre">SUBDIR_ROOT</span></em><span class="pre">))</span></tt></dt>
<dd>This checks out the tree at the given revision <em>REV</em>, then applies a
patch (using <tt class="docutils literal"><span class="pre">patch</span> <span class="pre">-pLEVEL</span> <span class="pre">&lt;DIFF</span></tt>) from inside the relative
directory <em>SUBDIR_ROOT</em>. Item <em>SUBDIR_ROOT</em> is optional and defaults to the
builder working directory. The <a class="reference internal" href="#cmdline-try" title="try"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">try</span></tt></a> command creates this kind of
<tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt>. If <tt class="docutils literal"><span class="pre">patch</span></tt> is <tt class="docutils literal"><span class="pre">None</span></tt>, the patching step is
bypassed.</dd>
</dl>
<p>The buildmaster is responsible for turning the <tt class="xref py py-class docutils literal"><span class="pre">BuildSet</span></tt> into a
set of <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> objects and queueing them on the
appropriate <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s.</p>
</div>
<div class="section" id="buildrequests">
<span id="buildrequest"></span><h4>BuildRequests<a class="headerlink" href="#buildrequests" title="Permalink to this headline">¶</a></h4>
<p>A <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> is a request to build a specific set of source
code (specified by one ore more source stamps) on a single <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>.
Each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> runs the <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> as soon as it can (i.e.
when an associated buildslave becomes free). <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>s are
prioritized from oldest to newest, so when a buildslave becomes free, the
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> with the oldest <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> is run.</p>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> contains one <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt> specification per codebase.
The actual process of running the build (the series of <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt>s that will
be executed) is implemented by the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> object. In this future
this might be changed, to have the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> define <em>what</em>
gets built, and a separate <tt class="xref py py-class docutils literal"><span class="pre">BuildProcess</span></tt> (provided by the
Builder) to define <em>how</em> it gets built.</p>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> may be mergeable with other compatible
<tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>s. Builds that are triggered by incoming <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s
will generally be mergeable. Builds that are triggered by user requests are generally not,
unless they are multiple requests to build the <em>latest sources</em> of the same branch.
A merge of buildrequests is performed per codebase, thus on changes having the same codebase.</p>
</div>
<div class="section" id="builders">
<span id="builder"></span><h4>Builders<a class="headerlink" href="#builders" title="Permalink to this headline">¶</a></h4>
<p>The Buildmaster runs a collection of <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s, each of which handles a single
type of build (e.g. full versus quick), on one or more build slaves.   <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s
serve as a kind of queue for a particular type of build.  Each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> gets a
separate column in the waterfall display. In general, each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> runs
independently (although various kinds of interlocks can cause one <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> to
have an effect on another).</p>
<p>Each builder is a long-lived object which controls a sequence of <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s.
Each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> is created when the config file is first parsed, and lives forever
(or rather until it is removed from the config file). It mediates the
connections to the buildslaves that do all the work, and is responsible for
creating the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> objects - <a class="reference internal" href="#concepts-build"><em>Builds</em></a>.</p>
<p>Each builder gets a unique name, and the path name of a directory where it gets
to do all its work (there is a buildmaster-side directory for keeping status
information, as well as a buildslave-side directory where the actual
checkout/compile/test commands are executed).</p>
</div>
<div class="section" id="build-factories">
<span id="concepts-build-factories"></span><h4>Build Factories<a class="headerlink" href="#build-factories" title="Permalink to this headline">¶</a></h4>
<p>A builder also has a <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt>, which is responsible for creating new <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>
instances: because the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> instance is what actually performs each build,
choosing the <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt> is the way to specify what happens each time a build
is done (<a class="reference internal" href="#concepts-build"><em>Builds</em></a>).</p>
</div>
<div class="section" id="build-slaves">
<span id="concepts-build-slaves"></span><h4>Build Slaves<a class="headerlink" href="#build-slaves" title="Permalink to this headline">¶</a></h4>
<p>Each builder is associated with one of more <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>s.  A builder which is
used to perform Mac OS X builds (as opposed to Linux or Solaris builds) should
naturally be associated with a Mac buildslave.</p>
<p>If multiple buildslaves are available for any given builder, you will
have some measure of redundancy: in case one slave goes offline, the
others can still keep the <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> working. In addition, multiple
buildslaves will allow multiple simultaneous builds for the same
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>, which might be useful if you have a lot of forced or <tt class="docutils literal"><span class="pre">try</span></tt>
builds taking place.</p>
<p>If you use this feature, it is important to make sure that the
buildslaves are all, in fact, capable of running the given build. The
slave hosts should be configured similarly, otherwise you will spend a
lot of time trying (unsuccessfully) to reproduce a failure that only
occurs on some of the buildslaves and not the others. Different
platforms, operating systems, versions of major programs or libraries,
all these things mean you should use separate Builders.</p>
</div>
<div class="section" id="builds">
<span id="concepts-build"></span><h4>Builds<a class="headerlink" href="#builds" title="Permalink to this headline">¶</a></h4>
<p>A build is a single compile or test run of a particular version of the source
code, and is comprised of a series of steps.  It is ultimately up to you what
constitutes a build, but for compiled software it is generally the checkout,
configure, make, and make check sequence.  For interpreted projects like Python
modules, a build is generally a checkout followed by an invocation of the
bundled test suite.</p>
<p>A <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt> describes the steps a build will perform.  The builder which
starts a build uses its configured build factory to determine the build's
steps.</p>
</div>
<div class="section" id="users">
<span id="concepts-users"></span><h4>Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h4>
<p>Buildbot has a somewhat limited awareness of <em>users</em>. It assumes
the world consists of a set of developers, each of whom can be
described by a couple of simple attributes. These developers make
changes to the source code, causing builds which may succeed or fail.</p>
<p>Users also may have different levels of authorization when issuing Buildbot
commands, such as forcing a build from the web interface or from an IRC channel
(see <a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">WebStatus</span></tt></a> and <a class="reference internal" href="#status-IRC" title="IRC"><tt class="xref bb bb-status docutils literal"><span class="pre">IRC</span></tt></a>).</p>
<p>Each developer is primarily known through the source control system. Each
<tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt> object that arrives is tagged with a <tt class="xref py py-attr docutils literal"><span class="pre">who</span></tt> field that
typically gives the account name (on the repository machine) of the user
responsible for that change. This string is displayed on the HTML status
pages and in each <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>'s <em>blamelist</em>.</p>
<p>To do more with the User than just refer to them, this username needs to be
mapped into an address of some sort. The responsibility for this mapping is
left up to the status module which needs the address.  In the future, the
responsbility for managing users will be transferred to User Objects.</p>
<p>The <tt class="docutils literal"><span class="pre">who</span></tt> fields in <tt class="docutils literal"><span class="pre">git</span></tt> Changes are used to create <a class="reference internal" href="#user-objects"><em>User Objects</em></a>,
which allows for more control and flexibility in how Buildbot manages users.</p>
<div class="section" id="user-objects">
<span id="id5"></span><h5>User Objects<a class="headerlink" href="#user-objects" title="Permalink to this headline">¶</a></h5>
<p>User Objects allow Buildbot to better manage users throughout its various
interactions with users (see <a class="reference internal" href="#change-sources"><em>Change Sources</em></a> and <a class="reference internal" href="#status-targets"><em>Status Targets</em></a>).
The User Objects are stored in the Buildbot database and correlate the various
attributes that a user might have: irc, git, etc.</p>
<div class="section" id="id6">
<h6>Changes<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h6>
<p>Incoming Changes all have a <tt class="docutils literal"><span class="pre">who</span></tt> attribute attached to them that specifies
which developer is responsible for that Change. When a Change is first
rendered, the <tt class="docutils literal"><span class="pre">who</span></tt> attribute is parsed and added to the database if it
doesn't exist or checked against an existing user. The <tt class="docutils literal"><span class="pre">who</span></tt> attribute is
formatted in different ways depending on the version control system that the
Change came from.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">git</span></tt></dt>
<dd><tt class="docutils literal"><span class="pre">who</span></tt> attributes take the form <tt class="docutils literal"><span class="pre">Full</span> <span class="pre">Name</span> <span class="pre">&lt;Email&gt;</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">svn</span></tt></dt>
<dd><tt class="docutils literal"><span class="pre">who</span></tt> attributes are of the form <tt class="docutils literal"><span class="pre">Username</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">hg</span></tt></dt>
<dd><tt class="docutils literal"><span class="pre">who</span></tt> attributes are free-form strings, but usually adhere to similar
conventions as <tt class="docutils literal"><span class="pre">git</span></tt> attributes (<tt class="docutils literal"><span class="pre">Full</span> <span class="pre">Name</span> <span class="pre">&lt;Email&gt;</span></tt>).</dd>
<dt><tt class="docutils literal"><span class="pre">cvs</span></tt></dt>
<dd><tt class="docutils literal"><span class="pre">who</span></tt> attributes are of the form <tt class="docutils literal"><span class="pre">Username</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">darcs</span></tt></dt>
<dd><tt class="docutils literal"><span class="pre">who</span></tt> attributes contain an <tt class="docutils literal"><span class="pre">Email</span></tt> and may also include a <tt class="docutils literal"><span class="pre">Full</span> <span class="pre">Name</span></tt>
like <tt class="docutils literal"><span class="pre">git</span></tt> attributes.</dd>
<dt><tt class="docutils literal"><span class="pre">bzr</span></tt></dt>
<dd><tt class="docutils literal"><span class="pre">who</span></tt> attributes are free-form strings like <tt class="docutils literal"><span class="pre">hg</span></tt>, and can include a
<tt class="docutils literal"><span class="pre">Username</span></tt>, <tt class="docutils literal"><span class="pre">Email</span></tt>, and/or <tt class="docutils literal"><span class="pre">Full</span> <span class="pre">Name</span></tt>.</dd>
</dl>
</div>
<div class="section" id="tools">
<h6>Tools<a class="headerlink" href="#tools" title="Permalink to this headline">¶</a></h6>
<p>For managing users manually, use the <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">user</span></tt> command, which allows
you to add, remove, update, and show various attributes of users in the Buildbot
database (see <a class="reference internal" href="#command-line-tool"><em>Command-line Tool</em></a>).</p>
<p>To show all of the users in the database in a more pretty manner, use the users page in
the <a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">WebStatus</span></tt></a>.</p>
</div>
<div class="section" id="uses">
<h6>Uses<a class="headerlink" href="#uses" title="Permalink to this headline">¶</a></h6>
<p>Correlating the various bits and pieces that Buildbot views as users also means
that one attribute of a user can be translated into another. This provides a
more complete view of users throughout Buildbot.</p>
<p>One such use is being able to find email addresses based on a set of Builds
to notify users through the <tt class="docutils literal"><span class="pre">MailNotifier</span></tt>. This process is explained
more clearly in :ref:<tt class="docutils literal"><span class="pre">Email-Addresses</span></tt>.</p>
<p>Another way to utilize <cite>User Objects</cite> is through <cite>UsersAuth</cite> for web authentication
(see <a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">WebStatus</span></tt></a>). To use <cite>UsersAuth</cite>, you need to
set a <cite>bb_username</cite> and <cite>bb_password</cite> via the <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">user</span></tt> command line tool
to check against. The password will be encrypted before storing in the database
along with other user attributes.</p>
</div>
</div>
<div class="section" id="doing-things-with-users">
<span id="id7"></span><h5>Doing Things With Users<a class="headerlink" href="#doing-things-with-users" title="Permalink to this headline">¶</a></h5>
<p>Each change has a single user who is responsible for it. Most builds have a set
of changes: the build generally represents the first time these changes have
been built and tested by the Buildbot. The build has a <em>blamelist</em> that is
the union of the users responsible for all the build's changes. If the build
was created by a <a class="reference internal" href="#try-schedulers"><em>Try Schedulers</em></a> this list will include the submitter of the try
job, if known.</p>
<p>The build provides a list of users who are interested in the build -- the
<em>interested users</em>. Usually this is equal to the blamelist, but may also be
expanded, e.g., to include the current build sherrif or a module's maintainer.</p>
<p>If desired, the buildbot can notify the interested users until the problem is
resolved.</p>
</div>
<div class="section" id="email-addresses">
<span id="id8"></span><h5>Email Addresses<a class="headerlink" href="#email-addresses" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#status-MailNotifier" title="MailNotifier"><tt class="xref bb bb-status docutils literal"><span class="pre">MailNotifier</span></tt></a> is a status target which can send email
about the results of each build. It accepts a static list of email
addresses to which each message should be delivered, but it can also
be configured to send mail to the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>'s Interested Users. To do
this, it needs a way to convert User names into email addresses.</p>
<p>For many VC systems, the User Name is actually an account name on the
system which hosts the repository. As such, turning the name into an
email address is a simple matter of appending
<tt class="docutils literal"><span class="pre">&#64;repositoryhost.com</span></tt>. Some projects use other kinds of mappings
(for example the preferred email address may be at <tt class="docutils literal"><span class="pre">project.org</span></tt>
despite the repository host being named <tt class="docutils literal"><span class="pre">cvs.project.org</span></tt>), and some
VC systems have full separation between the concept of a user and that
of an account on the repository host (like Perforce). Some systems
(like Git) put a full contact email address in every change.</p>
<p>To convert these names to addresses, the <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> uses an <tt class="xref py py-class docutils literal"><span class="pre">EmailLookup</span></tt>
object. This provides a <tt class="xref py py-meth docutils literal"><span class="pre">getAddress</span></tt> method which accepts a name and
(eventually) returns an address. The default <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt>
module provides an <tt class="xref py py-class docutils literal"><span class="pre">EmailLookup</span></tt> which simply appends a static string,
configurable when the notifier is created. To create more complex behaviors
(perhaps using an LDAP lookup, or using <tt class="docutils literal"><span class="pre">finger</span></tt> on a central host to
determine a preferred address for the developer), provide a different object
as the <tt class="docutils literal"><span class="pre">lookup</span></tt> argument.</p>
<p>If an EmailLookup object isn't given to the MailNotifier, the MailNotifier
will try to find emails through <a class="reference internal" href="#user-objects"><em>User Objects</em></a>. This will work the
same as if an EmailLookup object was used if every user in the Build's
Interested Users list has an email in the database for them. If a user
whose change led to a Build doesn't have an email attribute, that user
will not receive an email. If <tt class="docutils literal"><span class="pre">extraRecipients</span></tt> is given, those users
are still sent mail when the EmailLookup object is not specified.</p>
<p>In the future, when the Problem mechanism has been set up, the Buildbot
will need to send mail to arbitrary Users. It will do this by locating a
<tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt>-like object among all the buildmaster's status targets, and
asking it to send messages to various Users. This means the User-to-address
mapping only has to be set up once, in your <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt>, and every email
message the buildbot emits will take advantage of it.</p>
</div>
<div class="section" id="irc-nicknames">
<span id="id9"></span><h5>IRC Nicknames<a class="headerlink" href="#irc-nicknames" title="Permalink to this headline">¶</a></h5>
<p>Like <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt>, the <a class="reference internal" href="#buildbot.status.words.IRC" title="buildbot.status.words.IRC"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.status.words.IRC</span></tt></a> class
provides a status target which can announce the results of each build. It
also provides an interactive interface by responding to online queries
posted in the channel or sent as private messages.</p>
<p>In the future, the buildbot can be configured map User names to IRC
nicknames, to watch for the recent presence of these nicknames, and to
deliver build status messages to the interested parties. Like
<tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> does for email addresses, the <tt class="xref py py-class docutils literal"><span class="pre">IRC</span></tt> object
will have an <tt class="xref py py-class docutils literal"><span class="pre">IRCLookup</span></tt> which is responsible for nicknames. The
mapping can be set up statically, or it can be updated by online users
themselves (by claiming a username with some kind of <tt class="docutils literal"><span class="pre">buildbot:</span> <span class="pre">i</span> <span class="pre">am</span>
<span class="pre">user</span> <span class="pre">warner</span></tt> commands).</p>
<p>Once the mapping is established, the rest of the buildbot can ask the
<tt class="xref py py-class docutils literal"><span class="pre">IRC</span></tt> object to send messages to various users. It can report on
the likelihood that the user saw the given message (based upon how long the
user has been inactive on the channel), which might prompt the Problem
Hassler logic to send them an email message instead.</p>
<p>These operations and authentication of commands issued by particular
nicknames will be implemented in <a class="reference internal" href="#user-objects"><em>User Objects</em></a>.</p>
</div>
<div class="section" id="live-status-clients">
<span id="id10"></span><h5>Live Status Clients<a class="headerlink" href="#live-status-clients" title="Permalink to this headline">¶</a></h5>
<p>The Buildbot also offers a desktop status client interface which can display
real-time build status in a GUI panel on the developer's desktop.</p>
</div>
</div>
<div class="section" id="build-properties">
<span id="index-0"></span><span id="id11"></span><h4>Build Properties<a class="headerlink" href="#build-properties" title="Permalink to this headline">¶</a></h4>
<p>Each build has a set of <em>Build Properties</em>, which can be used by its
build steps to modify their actions.  These properties, in the form of
key-value pairs, provide a general framework for dynamically altering
the behavior of a build based on its circumstances.</p>
<p>Properties form a simple kind of variable in a build.  Some properties are set
when the build starts, and properties can be changed as a build progresses --
properties set or changed in one step may be accessed in subsequent steps.
Property values can be numbers, strings, lists, or dictionaries - basically,
anything that can be represented in JSON.</p>
<p>Properties are very flexible, and can be used to implement all manner
of functionality.  Here are some examples:</p>
<p>Most Source steps record the revision that they checked out in
the <tt class="docutils literal"><span class="pre">got_revision</span></tt> property.  A later step could use this
property to specify the name of a fully-built tarball, dropped in an
easily-acessible directory for later testing.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In builds with more than one codebase, the <tt class="docutils literal"><span class="pre">got_revision</span></tt> property is a dictionary, keyed by codebase.</p>
</div>
<p>Some projects want to perform nightly builds as well as bulding in response to
committed changes.  Such a project would run two schedulers, both pointing to
the same set of builders, but could provide an <tt class="docutils literal"><span class="pre">is_nightly</span></tt> property so
that steps can distinguish the nightly builds, perhaps to run more
resource-intensive tests.</p>
<p>Some projects have different build processes on different systems.
Rather than create a build factory for each slave, the steps can use
buildslave properties to identify the unique aspects of each slave
and adapt the build process dynamically.</p>
</div>
<div class="section" id="multiple-codebase-builds">
<span id="id12"></span><h4>Multiple-Codebase Builds<a class="headerlink" href="#multiple-codebase-builds" title="Permalink to this headline">¶</a></h4>
<p>What if an end-product is composed of code from several codebases?
Changes may arrive from different repositories within the tree-stable-timer period.
Buildbot will not only use the source-trees that contain changes but also needs the remaining source-trees to build the complete product.</p>
<p>For this reason a <a class="reference internal" href="#scheduling-builds"><em>Scheduler</em></a> can be configured to base a build on a set of several source-trees that can (partly) be overidden by the information from incoming <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s.</p>
<p>As descibed <a class="reference internal" href="#source-stamps"><em>above</em></a>, the source for each codebase is identified by a source stamp, containing its repository, branch and revision.
A full build set will specify a source stamp set describing the source to use for each codebase.</p>
<p>Configuring all of this takes a coordinated approach.  A complete multiple repository configuration consists of:</p>
<blockquote>
<div><ul>
<li><p class="first">a <em>codebase generator</em></p>
<blockquote>
<div><p>Every relevant change arriving from a VC must contain a codebase.
This is done by a <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><tt class="xref bb bb-cfg docutils literal"><span class="pre">codebaseGenerator</span></tt></a> that is defined in the configuration.
Most generators examine the repository of a change to determine its codebase, using project-specific rules.</p>
</div></blockquote>
</li>
<li><p class="first">some <em>schedulers</em></p>
<blockquote>
<div><p>Each <a class="reference internal" href="#cfg-schedulers" title="schedulers"><tt class="xref bb bb-cfg docutils literal"><span class="pre">scheduler</span></tt></a> has to be configured with a set of all required <tt class="docutils literal"><span class="pre">codebases</span></tt> to build a product.
These codebases indicate the set of required source-trees.
In order for the scheduler to be able to produce a complete set for each build, the configuration can give a default repository, branch, and revision for each codebase.
When a scheduler must generate a source stamp for a codebase that has received no changes, it applies these default values.</p>
</div></blockquote>
</li>
<li><p class="first">multiple <em>source steps</em> - one for each codebase</p>
<blockquote>
<div><p>A <a class="reference internal" href="#builder"><em>Builders</em></a>'s build factory must include a <a class="reference internal" href="#source-checkout"><em>source step</em></a> for each codebase.
Each of the source steps has a <tt class="docutils literal"><span class="pre">codebase</span></tt> attribute which is used to select an appropriate source stamp from the source stamp set for a build.
This information comes from the arrived changes or from the scheduler's configured default values.</p>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Defining a <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><tt class="xref bb bb-cfg docutils literal"><span class="pre">codebaseGenerator</span></tt></a> that returns non-empty (not <tt class="docutils literal"><span class="pre">''</span></tt>) codebases will change the behavior of all the schedulers.</p>
</div>
</div>
</div>
<span id="document-manual/configuration"></span><div class="section" id="configuration">
<span id="id1"></span><h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The following sections describe the configuration of the various Buildbot
components.  The information available here is sufficient to create basic
build and test configurations, and does not assume great familiarity with
Python.</p>
<p>In more advanced Buildbot configurations, Buildbot acts as a framework for a
continuous-integration application.  The next section, <a class="reference internal" href="#document-manual/customization"><em>Customization</em></a>,
describes this approach, with frequent references into the
<a class="reference internal" href="#buildbot-development"><em>development documentation</em></a>.</p>
<div class="toctree-wrapper compound">
<span id="document-manual/cfg-intro"></span><div class="section" id="configuring-buildbot">
<h4>Configuring Buildbot<a class="headerlink" href="#configuring-buildbot" title="Permalink to this headline">¶</a></h4>
<p>The buildbot's behavior is defined by the <em>config file</em>, which
normally lives in the <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> file in the buildmaster's base
directory (but this can be changed with an option to the
<strong class="command">buildbot create-master</strong> command). This file completely specifies
which <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s are to be run, which slaves they should use, how
<tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s should be tracked, and where the status information is to be
sent. The buildmaster's <tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt> file names the base
directory; everything else comes from the config file.</p>
<p>A sample config file was installed for you when you created the
buildmaster, but you will need to edit it before your buildbot will do
anything useful.</p>
<p>This chapter gives an overview of the format of this file and the
various sections in it. You will need to read the later chapters to
understand how to fill in each section properly.</p>
<div class="section" id="config-file-format">
<span id="id1"></span><h5>Config File Format<a class="headerlink" href="#config-file-format" title="Permalink to this headline">¶</a></h5>
<p>The config file is, fundamentally, just a piece of Python code which
defines a dictionary named <tt class="docutils literal"><span class="pre">BuildmasterConfig</span></tt>, with a number of
keys that are treated specially. You don't need to know Python to do
basic configuration, though, you can just copy the syntax of the
sample file. If you <em>are</em> comfortable writing Python code,
however, you can use all the power of a full programming language to
achieve more complicated configurations.</p>
<p>The <tt class="docutils literal"><span class="pre">BuildmasterConfig</span></tt> name is the only one which matters: all
other names defined during the execution of the file are discarded.
When parsing the config file, the Buildmaster generally compares the
old configuration with the new one and performs the minimum set of
actions necessary to bring the buildbot up to date: <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s which are
not changed are left untouched, and <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s which are modified get to
keep their old event history.</p>
<p>The beginning of the <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> file
typically starts with something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">BuildmasterConfig</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
<p>Therefore a config key like <a class="reference internal" href="#cfg-change_source" title="change_source"><tt class="xref bb bb-cfg docutils literal"><span class="pre">change_source</span></tt></a> will usually appear in
<tt class="file docutils literal"><span class="pre">master.cfg</span></tt> as <tt class="docutils literal"><span class="pre">c['change_source']</span></tt>.</p>
<p>See <a class="reference internal" href="bb-cfg.html" title="Buildmaster Configuration Index"><em>Buildmaster Configuration Index</em></a> for a full list of <tt class="docutils literal"><span class="pre">BuildMasterConfig</span></tt> keys.</p>
<div class="section" id="basic-python-syntax">
<h6>Basic Python Syntax<a class="headerlink" href="#basic-python-syntax" title="Permalink to this headline">¶</a></h6>
<p>The master configuration file is interpreted as Python, allowing the full
flexibility of the language.  For the configurations described in this section,
a detailed knowledge of Python is not required, but the basic syntax is easily
described.</p>
<p>Python comments start with a hash character <tt class="docutils literal"><span class="pre">#</span></tt>, tuples are defined with
<tt class="docutils literal"><span class="pre">(parenthesis,</span> <span class="pre">pairs)</span></tt>, and lists (arrays) are defined with <tt class="docutils literal"><span class="pre">[square,</span>
<span class="pre">brackets]</span></tt>. Tuples and lists are mostly interchangeable. Dictionaries (data
structures which map <em>keys</em> to <em>values</em>) are defined with curly braces:
<tt class="docutils literal"><span class="pre">{'key1':</span> <span class="pre">value1,</span> <span class="pre">'key2':</span> <span class="pre">value2}</span></tt>. Function calls (and object
instantiation) can use named parameters, like <tt class="docutils literal"><span class="pre">w</span> <span class="pre">=</span>
<span class="pre">html.Waterfall(http_port=8010)</span></tt>.</p>
<p>The config file starts with a series of <tt class="docutils literal"><span class="pre">import</span></tt> statements, which make
various kinds of <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt>s and <tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt> targets available for
later use. The main <tt class="docutils literal"><span class="pre">BuildmasterConfig</span></tt> dictionary is created, then it is
populated with a variety of keys, described section-by-section in subsequent
chapters.</p>
</div>
</div>
<div class="section" id="predefined-config-file-symbols">
<span id="id2"></span><h5>Predefined Config File Symbols<a class="headerlink" href="#predefined-config-file-symbols" title="Permalink to this headline">¶</a></h5>
<p>The following symbols are automatically available for use in the configuration
file.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">basedir</span></tt></dt>
<dd><p class="first">the base directory for the buildmaster. This string has not been
expanded, so it may start with a tilde. It needs to be expanded before
use. The config file is located in</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basedir</span><span class="p">,</span> <span class="s">&#39;master.cfg&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">__file__</span></tt></dt>
<dd>the absolute path of the config file. The config file's directory is located in
<tt class="docutils literal"><span class="pre">os.path.dirname(__file__)</span></tt>.</dd>
</dl>
</div>
<div class="section" id="testing-the-config-file">
<span id="id3"></span><h5>Testing the Config File<a class="headerlink" href="#testing-the-config-file" title="Permalink to this headline">¶</a></h5>
<p>To verify that the config file is well-formed and contains no deprecated or
invalid elements, use the <tt class="docutils literal"><span class="pre">checkconfig</span></tt> command, passing it either a master
directory or a config file.</p>
<div class="highlight-bash"><div class="highlight"><pre>% buildbot checkconfig master.cfg
Config file is good!
<span class="c"># or</span>
% buildbot checkconfig /tmp/masterdir
Config file is good!
</pre></div>
</div>
<p>If the config file has deprecated features (perhaps because you've
upgraded the buildmaster and need to update the config file to match),
they will be announced by checkconfig. In this case, the config file
will work, but you should really remove the deprecated items and use
the recommended replacements instead:</p>
<div class="highlight-none"><div class="highlight"><pre>% buildbot checkconfig master.cfg
/usr/lib/python2.4/site-packages/buildbot/master.py:559: DeprecationWarning: c[&#39;sources&#39;] is
deprecated as of 0.7.6 and will be removed by 0.8.0 . Please use c[&#39;change_source&#39;] instead.
Config file is good!
</pre></div>
</div>
<p>If you have errors in your configuration file, checkconfig will let you know:</p>
<div class="highlight-none"><div class="highlight"><pre>% buildbot checkconfig master.cfg
Configuration Errors:
c[&#39;slaves&#39;] must be a list of BuildSlave instances
no slaves are configured
builder &#39;smoketest&#39; uses unknown slaves &#39;linux-002&#39;
</pre></div>
</div>
<p>If the config file is simply broken, that will be caught too:</p>
<div class="highlight-none"><div class="highlight"><pre>% buildbot checkconfig master.cfg
error while parsing config file:
Traceback (most recent call last):
File &quot;/home/buildbot/master/bin/buildbot&quot;, line 4, in &lt;module&gt;
    runner.run()
File &quot;/home/buildbot/master/buildbot/scripts/runner.py&quot;, line 1358, in run
    if not doCheckConfig(so):
File &quot;/home/buildbot/master/buildbot/scripts/runner.py&quot;, line 1079, in doCheckConfig
    return cl.load(quiet=quiet)
File &quot;/home/buildbot/master/buildbot/scripts/checkconfig.py&quot;, line 29, in load
    self.basedir, self.configFileName)
--- &lt;exception caught here&gt; ---
File &quot;/home/buildbot/master/buildbot/config.py&quot;, line 147, in loadConfig
    exec f in localDict
exceptions.SyntaxError: invalid syntax (master.cfg, line 52)
Configuration Errors:
error while parsing config file: invalid syntax (master.cfg, line 52) (traceback in logfile)
</pre></div>
</div>
</div>
<div class="section" id="loading-the-config-file">
<h5>Loading the Config File<a class="headerlink" href="#loading-the-config-file" title="Permalink to this headline">¶</a></h5>
<p>The config file is only read at specific points in time. It is first
read when the buildmaster is launched.</p>
<div class="section" id="reloading-the-config-file-reconfig">
<h6>Reloading the Config File (reconfig)<a class="headerlink" href="#reloading-the-config-file-reconfig" title="Permalink to this headline">¶</a></h6>
<p>If you are on the system hosting the buildmaster, you can send a <tt class="docutils literal"><span class="pre">SIGHUP</span></tt>
signal to it: the <strong class="command">buildbot</strong> tool has a shortcut for this:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot reconfig BASEDIR
</pre></div>
</div>
<p>This command will show you all of the lines from <tt class="file docutils literal"><span class="pre">twistd.log</span></tt>
that relate to the reconfiguration. If there are any problems during
the config-file reload, they will be displayed in these lines.</p>
<p>When reloading the config file, the buildmaster will endeavor to
change as little as possible about the running system. For example,
although old status targets may be shut down and new ones started up,
any status targets that were not changed since the last time the
config file was read will be left running and untouched. Likewise any
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s which have not been changed will be left running. If a
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> is modified (say, the build process is changed) while a <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>
is currently running, that <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> will keep running with the old
process until it completes. Any previously queued <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s (or <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>s
which get queued after the reconfig) will use the new process.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Buildbot's reconfiguration system is fragile for a few difficult-to-fix
reasons:</p>
<blockquote>
<div><ul class="simple">
<li>Any modules imported by the configuration file are not automatically reloaded.
Python modules such as <a class="reference external" href="http://pypi.python.org/pypi/lazy-reload">http://pypi.python.org/pypi/lazy-reload</a> may help
here, but reloading modules is fraught with subtlties and difficult-to-decipher
failure cases.</li>
<li>During the reconfiguration, active internal objects are divorced from the service
hierarchy, leading to tracebacks in the web interface and other components. These
are ordinarily transient, but with HTTP connection caching (either by the browser or
an intervening proxy) they can last for a long time.</li>
<li>If the new configuration file is invalid, it is possible for Buildbot's
internal state to be corrupted, leading to undefined results.  When this
occurs, it is best to restart the master.</li>
<li>For more advanced configurations, it is impossible for Buildbot to tell if the
configuration for a <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> or <tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt> has chanaged, and thus the <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> or
<tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt> will always be reloaded.  This occurs most commonly when a callable
is passed as a configuration parameter.</li>
</ul>
</div></blockquote>
<p class="last">The bbproto project (at <a class="reference external" href="https://github.com/dabrahams/bbproto">https://github.com/dabrahams/bbproto</a>) may help to
construct large (multi-file) configurations which can be effectively reloaded
and reconfigured.</p>
</div>
</div>
<div class="section" id="reconfig-by-debug-client">
<h6>Reconfig by Debug Client<a class="headerlink" href="#reconfig-by-debug-client" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#cmdline-debugclient" title="debugclient"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">debug</span> <span class="pre">tool</span></tt></a> (<tt class="samp docutils literal"><span class="pre">buildbot</span> <span class="pre">debugclient</span>
<span class="pre">--master</span> <em><span class="pre">HOST</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em></tt>) has a <em class="guilabel">Reload .cfg</em> button which will also
trigger a reload.</p>
</div>
</div>
</div>
<span id="document-manual/cfg-global"></span><div class="section" id="global-configuration">
<h4>Global Configuration<a class="headerlink" href="#global-configuration" title="Permalink to this headline">¶</a></h4>
<p>The keys in this section affect the operations of the buildmaster globally.</p>
<span class="target" id="cfg-db"></span><span class="target" id="cfg-db_url"></span><div class="section" id="database-specification">
<span id="cfg-db_poll_interval"></span><span id="id1"></span><h5>Database Specification<a class="headerlink" href="#database-specification" title="Permalink to this headline">¶</a></h5>
<p>Buildbot requires a connection to a database to maintain certain state information, such as tracking pending build requests.
In the default configuration Buildbot uses a file-based SQLite database, stored in the <tt class="file docutils literal"><span class="pre">state.sqlite</span></tt> file of the master's base directory.
Override this configuration with the <a class="reference internal" href="#cfg-db_url" title="db_url"><tt class="xref bb bb-cfg docutils literal"><span class="pre">db_url</span></tt></a> parameter.</p>
<p>Buildbot accepts a database configuration in a dictionary named <tt class="docutils literal"><span class="pre">db</span></tt>.
All keys are optional:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;db_url&#39;</span> <span class="p">:</span> <span class="s">&#39;sqlite:///state.sqlite&#39;</span><span class="p">,</span>
    <span class="s">&#39;db_poll_interval&#39;</span> <span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">db_url</span></tt> key indicates the database engine to use.
The format of this parameter is completely documented at <a class="reference external" href="http://www.sqlalchemy.org/docs/dialects/">http://www.sqlalchemy.org/docs/dialects/</a>, but is generally of the form:</p>
<div class="highlight-python"><pre>driver://[username:password@]host:port/database[?args]</pre>
</div>
<p>The optional <tt class="docutils literal"><span class="pre">db_poll_interval</span></tt> specifies the interval, in seconds, between checks for pending tasks in the database.
This parameter is generally only usful in multi-master mode. See <a class="reference internal" href="#multi-master-mode"><em>Multi-master mode</em></a>.</p>
<p>These parameters can be specified directly in the configuration dictionary, as <tt class="docutils literal"><span class="pre">c['db_url']</span></tt> and <tt class="docutils literal"><span class="pre">c['db_poll_interval']</span></tt>, although this method is deprecated.</p>
<p>The following sections give additional information for particular database backends:</p>
<div class="section" id="sqlite">
<span id="index-0"></span><h6>SQLite<a class="headerlink" href="#sqlite" title="Permalink to this headline">¶</a></h6>
<p>For sqlite databases, since there is no host and port, relative paths are specified with <tt class="docutils literal"><span class="pre">sqlite:///</span></tt> and absolute paths with <tt class="docutils literal"><span class="pre">sqlite:////</span></tt>.
Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;sqlite:///state.sqlite&quot;</span>
</pre></div>
</div>
<p>SQLite requires no special configuration.</p>
<p>If Buildbot produces &quot;database is locked&quot; exceptions, try adding <tt class="docutils literal"><span class="pre">serialize_access=1</span></tt> to the DB URL as a workaround:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;sqlite:///state.sqlite?serialize_access=1&quot;</span>
</pre></div>
</div>
<p>and please file a bug at <a class="reference external" href="http://trac.buildbot.net">http://trac.buildbot.net</a>.</p>
</div>
<div class="section" id="mysql">
<span id="index-1"></span><h6>MySQL<a class="headerlink" href="#mysql" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;mysql://user:pass@somehost.com/database_name?max_idle=300&quot;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">max_idle</span></tt> argument for MySQL connections is unique to Buildbot, and should be set to something less than the <tt class="docutils literal"><span class="pre">wait_timeout</span></tt> configured for your server.
This controls the SQLAlchemy <tt class="docutils literal"><span class="pre">pool_recycle</span></tt> parameter, which defaults to no timeout.
Setting this parameter ensures that connections are closed and re-opened after the configured amount of idle time.
If you see errors such as <tt class="docutils literal"><span class="pre">_mysql_exceptions.OperationalError:</span> <span class="pre">(2006,</span> <span class="pre">'MySQL</span> <span class="pre">server</span> <span class="pre">has</span> <span class="pre">gone</span> <span class="pre">away')</span></tt>, this means your <tt class="docutils literal"><span class="pre">max_idle</span></tt> setting is probably too high.
<tt class="docutils literal"><span class="pre">show</span> <span class="pre">global</span> <span class="pre">variables</span> <span class="pre">like</span> <span class="pre">'wait_timeout';</span></tt> will show what the currently configured <tt class="docutils literal"><span class="pre">wait_timeout</span></tt> is on your MySQL server.</p>
<p>Buildbot requires <tt class="docutils literal"><span class="pre">use_unique=True</span></tt> and <tt class="docutils literal"><span class="pre">charset=utf8</span></tt>, and will add them automatically, so they do not need to be specified in <tt class="docutils literal"><span class="pre">db_url</span></tt>.</p>
<p>MySQL defaults to the MyISAM storage engine, but this can be overridden with the <tt class="docutils literal"><span class="pre">storage_engine</span></tt> URL argument.</p>
<p>Note that, because of InnoDB's extremely short key length limitations, it cannot be used to run Buildbot.
See <a class="reference external" href="http://bugs.mysql.com/bug.php?id=4541">http://bugs.mysql.com/bug.php?id=4541</a> for more information.</p>
<p>Buildbot uses temporary tables internally to manage large transactions.</p>
<p>MySQL has trouble doing replication with temporary tables, so if you are using a replicated MySQL installation, you may need to handle this situation carefully.
The MySQL documentation (<a class="reference external" href="http://dev.mysql.com/doc/refman/5.5/en/replication-features-temptables.html">http://dev.mysql.com/doc/refman/5.5/en/replication-features-temptables.html</a>) recommends using <tt class="docutils literal"><span class="pre">--replicate-wild-ignore-table</span></tt> to ignore temporary
tables that should not be replicated.
All Buildbot temporary tables begin with <tt class="docutils literal"><span class="pre">bbtmp_</span></tt>, so an option such as <tt class="docutils literal"><span class="pre">--replicate-wild-ignore-table=bbtmp_.*</span></tt> may help.</p>
</div>
<div class="section" id="postgres">
<span id="index-2"></span><h6>Postgres<a class="headerlink" href="#postgres" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;db_url&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;postgresql://username@hostname/dbname&quot;</span>
</pre></div>
</div>
<p>PosgreSQL requires no special configuration.</p>
</div>
</div>
<div class="section" id="multi-master-mode">
<span id="cfg-multiMaster"></span><span id="id2"></span><h5>Multi-master mode<a class="headerlink" href="#multi-master-mode" title="Permalink to this headline">¶</a></h5>
<p>Normally buildbot operates using a single master process that uses the configured database to save state.</p>
<p>It is possible to configure buildbot to have multiple master processes that share state in the same database.
This has been well tested using a MySQL database.
There are several benefits of Multi-master mode:</p>
<blockquote>
<div><ul class="simple">
<li>You can have large numbers of build slaves handling the same queue of build requests.
A single master can only handle so many slaves (the number is based on a number of factors including type of builds, number of builds, and master and slave IO and CPU capacity--there is no fixed formula).
By adding another master which shares the queue of build requests, you can attach more slaves to this additional master, and increase your build throughput.</li>
<li>You can shut one master down to do maintenance, and other masters will continue to do builds.</li>
</ul>
</div></blockquote>
<p>State that is shared in the database includes:</p>
<blockquote>
<div><ul class="simple">
<li>List of changes</li>
<li>Scheduler names and internal state</li>
<li>Build requests, including the builder name</li>
</ul>
</div></blockquote>
<p>Because of this shared state, you are strongly encouraged to:</p>
<blockquote>
<div><ul class="simple">
<li>Ensure that each named scheduler runs on only one master.
If the same scheduler runs on multiple masters, it will trigger duplicate builds and may produce other undesirable behaviors.</li>
<li>Ensure builder names are unique for a given build factory implementation.
You can have the same builder name configured on many masters, but if the build factories differ, you will get different results depending on which master claims the build.</li>
</ul>
</div></blockquote>
<p>One suggested configuration is to have one buildbot master configured with just the scheduler and change sources; and then other masters configured with just the builders.</p>
<p>To enable multi-master mode in this configuration, you will need to set the <a class="reference internal" href="#cfg-multiMaster" title="multiMaster"><tt class="xref bb bb-cfg docutils literal"><span class="pre">multiMaster</span></tt></a> option so that buildbot doesn't warn about missing schedulers or builders.
You will also need to set <a class="reference internal" href="#cfg-db_poll_interval" title="db_poll_interval"><tt class="xref bb bb-cfg docutils literal"><span class="pre">db_poll_interval</span></tt></a> to specify the interval (in seconds) at which masters should poll the database for tasks.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Enable multiMaster mode; disables warnings about unknown builders and</span>
<span class="c"># schedulers</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;multiMaster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="c"># Check for new build requests every 60 seconds</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;db_url&#39;</span> <span class="p">:</span> <span class="s">&#39;mysql://...&#39;</span><span class="p">,</span>
    <span class="s">&#39;db_poll_interval&#39;</span> <span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<span class="target" id="cfg-buildbotURL"></span><span class="target" id="cfg-titleURL"></span></div>
<div class="section" id="site-definitions">
<span id="cfg-title"></span><h5>Site Definitions<a class="headerlink" href="#site-definitions" title="Permalink to this headline">¶</a></h5>
<p>Three basic settings describe the buildmaster in status reports:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Buildbot&quot;</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;titleURL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;http://buildbot.sourceforge.net/&quot;</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;buildbotURL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;http://localhost:8010/&quot;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#cfg-title" title="title"><tt class="xref bb bb-cfg docutils literal"><span class="pre">title</span></tt></a> is a short string that will appear at the top of this buildbot installation's <tt class="xref py py-class docutils literal"><span class="pre">html.WebStatus</span></tt> home page (linked to the <a class="reference internal" href="#cfg-titleURL" title="titleURL"><tt class="xref bb bb-cfg docutils literal"><span class="pre">titleURL</span></tt></a>), and is embedded in the title of the waterfall HTML page.</p>
<p><a class="reference internal" href="#cfg-titleURL" title="titleURL"><tt class="xref bb bb-cfg docutils literal"><span class="pre">titleURL</span></tt></a> is a URL string that must end with a slash (<tt class="docutils literal"><span class="pre">/</span></tt>).
HTML status displays will show <tt class="docutils literal"><span class="pre">title</span></tt> as a link to <a class="reference internal" href="#cfg-titleURL" title="titleURL"><tt class="xref bb bb-cfg docutils literal"><span class="pre">titleURL</span></tt></a>.
This URL is often used to provide a link from buildbot HTML pages to your project's home page.</p>
<p>The <a class="reference internal" href="#cfg-buildbotURL" title="buildbotURL"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildbotURL</span></tt></a> string should point to the location where the buildbot's internal web server is visible.
This URL must end with a slash (<tt class="docutils literal"><span class="pre">/</span></tt>).
This typically uses the port number set for the web status (<a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">WebStatus</span></tt></a>): the buildbot needs your help to figure out a suitable externally-visible host URL.</p>
<p>When status notices are sent to users (either by email or over IRC), <a class="reference internal" href="#cfg-buildbotURL" title="buildbotURL"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildbotURL</span></tt></a> will be used to create a URL to the specific build or problem that they are being notified about.
It will also be made available to queriers (over IRC) who want to find out where to get more information about this buildbot.</p>
<span class="target" id="cfg-logCompressionLimit"></span><span class="target" id="cfg-logCompressionMethod"></span><span class="target" id="cfg-logMaxSize"></span></div>
<div class="section" id="log-handling">
<span id="cfg-logMaxTailSize"></span><h5>Log Handling<a class="headerlink" href="#log-handling" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;logCompressionLimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16384</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;logCompressionMethod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;gz&#39;</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;logMaxSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span> <span class="c"># 1M</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;logMaxTailSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32768</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#cfg-logCompressionLimit" title="logCompressionLimit"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logCompressionLimit</span></tt></a> enables compression of build logs on disk for logs that are bigger than the given size, or disables that completely if set to <tt class="docutils literal"><span class="pre">False</span></tt>.
The default value is 4096, which should be a reasonable default on most file systems.
This setting has no impact on status plugins, and merely affects the required disk space on the master for build logs.</p>
<p>The <a class="reference internal" href="#cfg-logCompressionMethod" title="logCompressionMethod"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logCompressionMethod</span></tt></a> controls what type of compression is used for build logs.
The default is 'bz2', and the other valid option is 'gz'.  'bz2' offers better compression at the expense of more CPU time.</p>
<p>The <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logMaxSize</span></tt></a> parameter sets an upper limit (in bytes) to how large logs from an individual build step can be.
The default value is None, meaning no upper limit to the log size.
Any output exceeding <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logMaxSize</span></tt></a> will be truncated, and a message to this effect will be added to the log's HEADER channel.</p>
<p>If <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logMaxSize</span></tt></a> is set, and the output from a step exceeds the maximum, the <a class="reference internal" href="#cfg-logMaxTailSize" title="logMaxTailSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logMaxTailSize</span></tt></a> parameter controls how much of the end of the build log will be kept.
The effect of setting this parameter is that the log will contain the first <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logMaxSize</span></tt></a> bytes and the last <a class="reference internal" href="#cfg-logMaxTailSize" title="logMaxTailSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logMaxTailSize</span></tt></a> bytes of output.
Don't set this value too high, as the the tail of the log is kept in memory.</p>
</div>
<div class="section" id="data-lifetime">
<h5>Data Lifetime<a class="headerlink" href="#data-lifetime" title="Permalink to this headline">¶</a></h5>
<span class="target" id="cfg-changeHorizon"></span><span class="target" id="cfg-buildHorizon"></span><span class="target" id="cfg-eventHorizon"></span><div class="section" id="horizons">
<span id="cfg-logHorizon"></span><h6>Horizons<a class="headerlink" href="#horizons" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;changeHorizon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;buildHorizon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;eventHorizon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;logHorizon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;buildCacheSize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
</pre></div>
</div>
<p>Buildbot stores historical information on disk in the form of &quot;Pickle&quot; files and compressed logfiles.
In a large installation, these can quickly consume disk space, yet in many cases developers never consult this historical information.</p>
<p>The <a class="reference internal" href="#cfg-changeHorizon" title="changeHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">changeHorizon</span></tt></a> key determines how many changes the master will keep a record of. One place these changes are displayed is on the waterfall page.
This parameter defaults to 0, which means keep all changes indefinitely.</p>
<p>The <a class="reference internal" href="#cfg-buildHorizon" title="buildHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildHorizon</span></tt></a> specifies the minimum number of builds for each builder which should be kept on disk.
The <a class="reference internal" href="#cfg-eventHorizon" title="eventHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">eventHorizon</span></tt></a> specifies the minumum number of events to keep--events mostly describe connections and disconnections of slaves, and are seldom helpful to developers.
The <a class="reference internal" href="#cfg-logHorizon" title="logHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logHorizon</span></tt></a> gives the minimum number of builds for which logs should be maintained; this parameter must be less than or equal to <a class="reference internal" href="#cfg-buildHorizon" title="buildHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildHorizon</span></tt></a>.
Builds older than <a class="reference internal" href="#cfg-logHorizon" title="logHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logHorizon</span></tt></a> but not older than <a class="reference internal" href="#cfg-buildHorizon" title="buildHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildHorizon</span></tt></a> will maintain their overall status and the status of each step, but the logfiles will be deleted.</p>
<span class="target" id="cfg-caches"></span><span class="target" id="cfg-changeCacheSize"></span></div>
<div class="section" id="caches">
<span id="cfg-buildCacheSize"></span><h6>Caches<a class="headerlink" href="#caches" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;caches&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Changes&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>     <span class="c"># formerly c[&#39;changeCacheSize&#39;]</span>
    <span class="s">&#39;Builds&#39;</span> <span class="p">:</span> <span class="mi">500</span><span class="p">,</span>      <span class="c"># formerly c[&#39;buildCacheSize&#39;]</span>
    <span class="s">&#39;chdicts&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s">&#39;BuildRequests&#39;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s">&#39;SourceStamps&#39;</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s">&#39;ssdicts&#39;</span> <span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s">&#39;objectids&#39;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s">&#39;usdicts&#39;</span> <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#cfg-caches" title="caches"><tt class="xref bb bb-cfg docutils literal"><span class="pre">caches</span></tt></a> configuration key contains the configuration for Buildbot's in-memory caches.
These caches keep frequently-used objects in memory to avoid unnecessary trips to the database or to pickle files.
Caches are divided by object type, and each has a configurable maximum size.</p>
<p>The default size for each cache is 1, except where noted below.
A value of 1 allows Buildbot to make a number of optimizations without consuming much memory.
Larger, busier installations will likely want to increase these values.</p>
<p>The available caches are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Changes</span></tt></dt>
<dd><p class="first">the number of change objects to cache in memory.
This should be larger than the number of changes that typically arrive in the span of a few minutes, otherwise your schedulers will be reloading changes from the database every time they run.
For distributed version control systems, like git or hg, several thousand changes may arrive at once, so setting this parameter to something like 10000 isn't unreasonable.</p>
<p class="last">This parameter is the same as the deprecated global parameter <a class="reference internal" href="#cfg-changeCacheSize" title="changeCacheSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">changeCacheSize</span></tt></a>.  Its default value is 10.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">Builds</span></tt></dt>
<dd><p class="first">The <a class="reference internal" href="#cfg-buildCacheSize" title="buildCacheSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildCacheSize</span></tt></a> parameter gives the number of builds for each builder which are cached in memory.
This number should be larger than the number of builds required for commonly-used status displays (the waterfall or grid views), so that those displays do not miss the cache on a refresh.</p>
<p class="last">This parameter is the same as the deprecated global parameter <a class="reference internal" href="#cfg-buildCacheSize" title="buildCacheSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildCacheSize</span></tt></a>.  Its default value is 15.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">chdicts</span></tt></dt>
<dd>The number of rows from the <tt class="docutils literal"><span class="pre">changes</span></tt> table to cache in memory.
This value should be similar to the value for <tt class="docutils literal"><span class="pre">Changes</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">BuildRequests</span></tt></dt>
<dd>The number of BuildRequest objects kept in memory.
This number should be higher than the typical number of outstanding build requests.
If the master ordinarily finds jobs for BuildRequests immediately, you may set a lower value.</dd>
<dt><tt class="docutils literal"><span class="pre">SourceStamps</span></tt></dt>
<dd>the number of SourceStamp objects kept in memory.
This number should generally be similar to the number <tt class="docutils literal"><span class="pre">BuildRequesets</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">ssdicts</span></tt></dt>
<dd>The number of rows from the <tt class="docutils literal"><span class="pre">sourcestamps</span></tt> table to cache in memory.
This value should be similar to the value for <tt class="docutils literal"><span class="pre">SourceStamps</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">objectids</span></tt></dt>
<dd>The number of object IDs - a means to correlate an object in the Buildbot configuration with an identity in the database--to cache.
In this version, object IDs are not looked up often during runtime, so a relatively low value such as 10 is fine.</dd>
<dt><tt class="docutils literal"><span class="pre">usdicts</span></tt></dt>
<dd><p class="first">The number of rows from the <tt class="docutils literal"><span class="pre">users</span></tt> table to cache in memory.
Note that for a given user there will be a row for each attribute that user has.</p>
<p class="last">c['buildCacheSize'] = 15</p>
</dd>
</dl>
<span class="target" id="cfg-mergeRequests"></span></div>
</div>
<div class="section" id="merging-build-requests">
<span id="index-3"></span><h5>Merging Build Requests<a class="headerlink" href="#merging-build-requests" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;mergeRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<p>This is a global default value for builders' <a class="reference internal" href="#cfg-mergeRequests" title="mergeRequests"><tt class="xref bb bb-cfg docutils literal"><span class="pre">mergeRequests</span></tt></a> parameter, and controls the merging of build requests.</p>
<p>This parameter can be overridden on a per-builder basis.
See <a class="reference internal" href="#merging-build-requests"><em>Merging Build Requests</em></a> for the allowed values for this parameter.</p>
<span class="target" id="index-4"></span></div>
<div class="section" id="prioritizing-builders">
<span id="cfg-prioritizeBuilders"></span><span id="id3"></span><h5>Prioritizing Builders<a class="headerlink" href="#prioritizing-builders" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><pre>def prioritizeBuilders(buildmaster, builders):
    # ...
c['prioritizeBuilders'] = prioritizeBuilders</pre>
</div>
<p>By default, buildbot will attempt to start builds on builders in order, beginning with the builder with the oldest pending request.
Customize this behavior with the <a class="reference internal" href="#cfg-prioritizeBuilders" title="prioritizeBuilders"><tt class="xref bb bb-cfg docutils literal"><span class="pre">prioritizeBuilders</span></tt></a> configuration key, which takes a callable.
See <a class="reference internal" href="#builder-priority-functions"><em>Builder Priority Functions</em></a> for details on this callable.</p>
<p>This parameter controls the order that the build master can start builds, and is useful in situations where there is resource contention between builders, e.g., for a test database.
It does not affect the order in which a builder processes the build requests in its queue.
For that purpose, see <a class="reference internal" href="#prioritizing-builds"><em>Prioritizing Builds</em></a>.</p>
</div>
<div class="section" id="setting-the-pb-port-for-slaves">
<span id="cfg-slavePortnum"></span><span id="id4"></span><h5>Setting the PB Port for Slaves<a class="headerlink" href="#setting-the-pb-port-for-slaves" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;slavePortnum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>
</pre></div>
</div>
<p>The buildmaster will listen on a TCP port of your choosing for connections from buildslaves.
It can also use this port for connections from remote Change Sources, status clients, and debug tools.
This port should be visible to the outside world, and you'll need to tell your buildslave admins about your choice.</p>
<p>It does not matter which port you pick, as long it is externally visible; however, you should probably use something larger than 1024, since most operating systems don't allow non-root processes to bind to low-numbered ports.
If your buildmaster is behind a firewall or a NAT box of some sort, you may have to configure your firewall to permit inbound connections to this port.</p>
<p><a class="reference internal" href="#cfg-slavePortnum" title="slavePortnum"><tt class="xref bb bb-cfg docutils literal"><span class="pre">slavePortnum</span></tt></a> is a <em>strports</em> specification string, defined in the <tt class="docutils literal"><span class="pre">twisted.application.strports</span></tt> module (try <tt class="docutils literal"><span class="pre">pydoc</span> <span class="pre">twisted.application.strports</span></tt> to get documentation on the format).</p>
<p>This means that you can have the buildmaster listen on a localhost-only port by doing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;slavePortnum&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;tcp:10000:interface=127.0.0.1&quot;</span>
</pre></div>
</div>
<p>This might be useful if you only run buildslaves on the same machine, and they are all configured to contact the buildmaster at <tt class="docutils literal"><span class="pre">localhost:10000</span></tt>.</p>
<span class="target" id="index-5"></span></div>
<div class="section" id="defining-global-properties">
<span id="cfg-properties"></span><h5>Defining Global Properties<a class="headerlink" href="#defining-global-properties" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#cfg-properties" title="properties"><tt class="xref bb bb-cfg docutils literal"><span class="pre">properties</span></tt></a> configuration key defines a dictionary of properties that will be available to all builds started by the buildmaster:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;properties&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;Widget-version&#39;</span> <span class="p">:</span> <span class="s">&#39;1.2&#39;</span><span class="p">,</span>
    <span class="s">&#39;release-stage&#39;</span> <span class="p">:</span> <span class="s">&#39;alpha&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="debug-options">
<span id="cfg-debugPassword"></span><span id="id5"></span><h5>Debug Options<a class="headerlink" href="#debug-options" title="Permalink to this headline">¶</a></h5>
<p>If you set <a class="reference internal" href="#cfg-debugPassword" title="debugPassword"><tt class="xref bb bb-cfg docutils literal"><span class="pre">debugPassword</span></tt></a>, then you can connect to the buildmaster with the diagnostic tool launched by <tt class="samp docutils literal"><span class="pre">buildbot</span> <span class="pre">debugclient</span> <em><span class="pre">MASTER</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em></tt>.
From this tool, you can reload the config file, manually force builds, and inject changes, which may be useful for testing your buildmaster without actually commiting changes to your repository (or before you have the Change Sources configured.)</p>
<p>The debug tool uses the same port number as the slaves, <a class="reference internal" href="#cfg-slavePortnum" title="slavePortnum"><tt class="xref bb bb-cfg docutils literal"><span class="pre">slavePortnum</span></tt></a>, and you may configure its authentication credentials as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;debugPassword&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;debugpassword&quot;</span>
</pre></div>
</div>
<span class="target" id="index-6"></span></div>
<div class="section" id="manhole">
<span id="cfg-manhole"></span><h5>Manhole<a class="headerlink" href="#manhole" title="Permalink to this headline">¶</a></h5>
<p>If you set <a class="reference internal" href="#cfg-manhole" title="manhole"><tt class="xref bb bb-cfg docutils literal"><span class="pre">manhole</span></tt></a> to an instance of one of the classes in <tt class="docutils literal"><span class="pre">buildbot.manhole</span></tt>, you can telnet or ssh into the buildmaster and get an interactive Python shell, which may be useful for debugging buildbot internals.
It is probably only useful for buildbot developers.
It exposes full access to the buildmaster's account (including the ability to modify and delete files), so it should not be enabled with a weak or easily guessable password.</p>
<p>There are three separate <tt class="xref py py-class docutils literal"><span class="pre">Manhole</span></tt> classes.
Two of them use SSH, one uses unencrypted telnet.
Two of them use a username+password combination to grant access, one of them uses an SSH-style <tt class="file docutils literal"><span class="pre">authorized_keys</span></tt> file which contains a list of ssh public keys.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Using any Manhole requires that <tt class="docutils literal"><span class="pre">pycrypto</span></tt> and <tt class="docutils literal"><span class="pre">pyasn1</span></tt> be installed.
These are not part of the normal Buildbot dependencies.</p>
</div>
<dl class="docutils">
<dt><cite>manhole.AuthorizedKeysManhole</cite></dt>
<dd>You construct this with the name of a file that contains one SSH public key per line, just like <tt class="file docutils literal"><span class="pre">~/.ssh/authorized_keys</span></tt>.
If you provide a non-absolute filename, it will be interpreted relative to the buildmaster's base directory.</dd>
<dt><cite>manhole.PasswordManhole</cite></dt>
<dd>This one accepts SSH connections but asks for a username and password when authenticating.
It accepts only one such pair.</dd>
<dt><cite>manhole.TelnetManhole</cite></dt>
<dd>This accepts regular unencrypted telnet connections, and asks for a username/password pair before providing access.
Because this username/password is transmitted in the clear, and because Manhole access to the buildmaster is equivalent to granting full shell privileges to both the buildmaster and all the buildslaves (and to all accounts which then run code produced by the buildslaves), it is  highly recommended that you use one of the SSH manholes instead.</dd>
</dl>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># some examples:</span>
<span class="kn">from</span> <span class="nn">buildbot</span> <span class="kn">import</span> <span class="n">manhole</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manhole</span><span class="o">.</span><span class="n">AuthorizedKeysManhole</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;authorized_keys&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manhole</span><span class="o">.</span><span class="n">PasswordManhole</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;alice&quot;</span><span class="p">,</span> <span class="s">&quot;mysecretpassword&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manhole</span><span class="o">.</span><span class="n">TelnetManhole</span><span class="p">(</span><span class="mi">1234</span><span class="p">,</span> <span class="s">&quot;bob&quot;</span><span class="p">,</span> <span class="s">&quot;snoop_my_password_please&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">Manhole</span></tt> instance can be configured to listen on a specific port.
You may wish to have this listening port bind to the loopback interface (sometimes known as <cite>lo0</cite>, <cite>localhost</cite>, or 127.0.0.1) to restrict access to clients which are running on the same host.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.manhole</span> <span class="kn">import</span> <span class="n">PasswordManhole</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;manhole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PasswordManhole</span><span class="p">(</span><span class="s">&quot;tcp:9999:interface=127.0.0.1&quot;</span><span class="p">,</span><span class="s">&quot;admin&quot;</span><span class="p">,</span><span class="s">&quot;passwd&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>To have the <tt class="xref py py-class docutils literal"><span class="pre">Manhole</span></tt> listen on all interfaces, use <tt class="docutils literal"><span class="pre">&quot;tcp:9999&quot;</span></tt> or simply 9999.
This port specification uses <tt class="docutils literal"><span class="pre">twisted.application.strports</span></tt>, so you can make it listen on SSL or even UNIX-domain sockets if you want.</p>
<p>Note that using any <tt class="xref py py-class docutils literal"><span class="pre">Manhole</span></tt> requires that the <a class="reference external" href="http://twistedmatrix.com/trac/wiki/TwistedConch">TwistedConch</a> package be installed.</p>
<p>The buildmaster's SSH server will use a different host key than the normal sshd running on a typical unix host.
This will cause the ssh client to complain about a <cite>host key mismatch</cite>, because it does not realize there are two separate servers running on the same host.
To avoid this, use a clause like the following in your <tt class="file docutils literal"><span class="pre">.ssh/config</span></tt> file:</p>
<div class="highlight-none"><div class="highlight"><pre>Host remotehost-buildbot
HostName remotehost
HostKeyAlias remotehost-buildbot
Port 9999
# use &#39;user&#39; if you use PasswordManhole and your name is not &#39;admin&#39;.
# if you use AuthorizedKeysManhole, this probably doesn&#39;t matter.
User admin
</pre></div>
</div>
<div class="section" id="using-manhole">
<h6>Using Manhole<a class="headerlink" href="#using-manhole" title="Permalink to this headline">¶</a></h6>
<p>After you have connected to a manhole instance, you will find yourself at a Python prompt.
You have access to two objects: <tt class="docutils literal"><span class="pre">master</span></tt> (the BuildMaster) and <tt class="docutils literal"><span class="pre">status</span></tt> (the master's Status object).
Most interesting objects on the master can be reached from these two objects.</p>
<p>To aid in navigation, the <tt class="docutils literal"><span class="pre">show</span></tt> method is defined.
It displays the non-method attributes of an object.</p>
<p>A manhole session might look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">show</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
<span class="go">data attributes of &lt;buildbot.master.BuildMaster instance at 0x7f7a4ab7df38&gt;</span>
<span class="go">                       basedir : &#39;/home/dustin/code/buildbot/t/buildbot/&#39;...</span>
<span class="go">                     botmaster : &lt;type &#39;instance&#39;&gt;</span>
<span class="go">                buildCacheSize : None</span>
<span class="go">                  buildHorizon : None</span>
<span class="go">                   buildbotURL : http://localhost:8010/</span>
<span class="go">               changeCacheSize : None</span>
<span class="go">                    change_svc : &lt;type &#39;instance&#39;&gt;</span>
<span class="go">                configFileName : master.cfg</span>
<span class="go">                            db : &lt;class &#39;buildbot.db.connector.DBConnector&#39;&gt;</span>
<span class="go">              db_poll_interval : None</span>
<span class="go">                        db_url : sqlite:///state.sqlite</span>
<span class="go">                              ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">show</span><span class="p">(</span><span class="n">master</span><span class="o">.</span><span class="n">botmaster</span><span class="o">.</span><span class="n">builders</span><span class="p">[</span><span class="s">&#39;win32&#39;</span><span class="p">])</span>
<span class="go">data attributes of &lt;Builder &#39;&#39;builder&#39;&#39; at 48963528&gt;</span>
<span class="go">                              ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">win32</span> <span class="o">=</span> <span class="n">_</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">win32</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="s">&#39;w32&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="metrics-options">
<span id="cfg-metrics"></span><h5>Metrics Options<a class="headerlink" href="#metrics-options" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;metrics&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">log_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">periodic_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#cfg-metrics" title="metrics"><tt class="xref bb bb-cfg docutils literal"><span class="pre">metrics</span></tt></a> can be a dictionary that configures various aspects of the metrics subsystem.
If <a class="reference internal" href="#cfg-metrics" title="metrics"><tt class="xref bb bb-cfg docutils literal"><span class="pre">metrics</span></tt></a> is <tt class="docutils literal"><span class="pre">None</span></tt>, then metrics collection, logging and reporting will be disabled.</p>
<p><tt class="docutils literal"><span class="pre">log_interval</span></tt> determines how often metrics should be logged to twistd.log.
It defaults to 60s.
If set to 0 or <tt class="docutils literal"><span class="pre">None</span></tt>, then logging of metrics will be disabled.
This value can be changed via a reconfig.</p>
<p><tt class="docutils literal"><span class="pre">periodic_interval</span></tt> determines how often various non-event based metrics are collected, such as memory usage, uncollectable garbage, reactor delay.
This defaults to 10s.
If set to 0 or <tt class="docutils literal"><span class="pre">None</span></tt>, then periodic collection of this data is disabled.
This value can also be changed via a reconfig.</p>
<p>Read more about metrics in the <a class="reference internal" href="#metrics"><em>Metrics</em></a> section in the developer documentation.</p>
</div>
<div class="section" id="users-options">
<span id="cfg-user_managers"></span><span id="id6"></span><h5>Users Options<a class="headerlink" href="#users-options" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.users</span> <span class="kn">import</span> <span class="n">manual</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;user_managers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;user_managers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">manual</span><span class="o">.</span><span class="n">CommandlineUserManager</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s">&quot;user&quot;</span><span class="p">,</span>
                                                   <span class="n">passwd</span><span class="o">=</span><span class="s">&quot;userpw&quot;</span><span class="p">,</span>
                                                   <span class="n">port</span><span class="o">=</span><span class="mi">9990</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="#cfg-user_managers" title="user_managers"><tt class="xref bb bb-cfg docutils literal"><span class="pre">user_managers</span></tt></a> contains a list of ways to manually manage User Objects within Buildbot (see <a class="reference internal" href="#user-objects"><em>User Objects</em></a>).
Currently implemented is a commandline tool <cite>buildbot user</cite>, described at length in <a class="reference internal" href="#cmdline-user" title="user"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">user</span></tt></a>.
In the future, a web client will also be able to manage User Objects and their attributes.</p>
<p>As shown above, to enable the <cite>buildbot user</cite> tool, you must initialize a <cite>CommandlineUserManager</cite> instance in your <cite>master.cfg</cite>.
<cite>CommandlineUserManager</cite> instances require the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">username</span></tt></dt>
<dd>This is the <cite>username</cite> that will be registered on the PB connection and need to be used when calling <cite>buildbot user</cite>.</dd>
<dt><tt class="docutils literal"><span class="pre">passwd</span></tt></dt>
<dd>This is the <cite>passwd</cite> that will be registered on the PB connection and need to be used when calling <cite>buildbot user</cite>.</dd>
<dt><tt class="docutils literal"><span class="pre">port</span></tt></dt>
<dd>The PB connection <cite>port</cite> must be different than <cite>c['slavePortnum']</cite> and be specified when calling <cite>buildbot user</cite></dd>
</dl>
</div>
<div class="section" id="input-validation">
<span id="cfg-validation"></span><span id="id7"></span><h5>Input Validation<a class="headerlink" href="#input-validation" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">re</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;validation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;branch&#39;</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^[\w.+/~-]*$&#39;</span><span class="p">),</span>
    <span class="s">&#39;revision&#39;</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^[ \w\.\-\/]*$&#39;</span><span class="p">),</span>
    <span class="s">&#39;property_name&#39;</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^[\w\.\-\/\~:]*$&#39;</span><span class="p">),</span>
    <span class="s">&#39;property_value&#39;</span> <span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^[\w\.\-\/\~:]*$&#39;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This option configures the validation applied to user inputs of various types.
This validation is important since these values are often included in command-line arguments executed on slaves.
Allowing arbitrary input from untrusted users may raise security concerns.</p>
<p>The keys describe the type of input validated; the values are compiled regular expressions against which the input will be matched.
The defaults for each type of input are those given in the example, above.</p>
</div>
<div class="section" id="revision-links">
<span id="cfg-revlink"></span><h5>Revision Links<a class="headerlink" href="#revision-links" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#cfg-revlink" title="revlink"><tt class="xref bb bb-cfg docutils literal"><span class="pre">revlink</span></tt></a> parameter is used to create links from revision IDs in the web status to a web-view of your source control system.
The parameter's value must be a callable.</p>
<p>By default, Buildbot is configured to generate revlinks for a number of open source hosting platforms.</p>
<p>The callable takes the revision id and repository argument, and should return an URL to the revision.
Note that the revision id may not always be in the form you expect, so code defensively.
In particular, a revision of &quot;??&quot; may be supplied when no other information is available.</p>
<p>Note that <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt>s that are not created from version-control changes (e.g., those created by a Nightly or Periodic scheduler) may have an empty repository string, if the respository is not known to the scheduler.</p>
<div class="section" id="revision-link-helpers">
<h6>Revision Link Helpers<a class="headerlink" href="#revision-link-helpers" title="Permalink to this headline">¶</a></h6>
<p>Buildbot provides two helpers for generating revision links.
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.revlinks.RevlinkMatcher</span></tt> takes a list of regular expressions, and replacement text.
The regular expressions should all have the same number of capture groups.
The replacement text should have sed-style references to that capture groups (i.e. '1' for the first capture group), and a single '%s' reference, for the revision ID.
The repository given is tried against each regular expression in turn.
The results are the substituted into the replacement text, along with the revision ID to obtain the revision link.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot</span> <span class="kn">import</span> <span class="n">revlinks</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;revlink&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">revlinks</span><span class="o">.</span><span class="n">RevlinkMatch</span><span class="p">([</span><span class="s">r&#39;git://notmuchmail.org/git/\(.*\)&#39;</span><span class="p">],</span>
                                      <span class="s">r&#39;http://git.notmuchmail.org/git/\1/commit/</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="xref py py-class docutils literal"><span class="pre">buildbot.revlinks.RevlinkMultiplexer</span></tt> takes a list of revision link callables, and tries each in turn, returning the first successful match.</p>
</div>
</div>
<div class="section" id="codebase-generator">
<span id="cfg-codebaseGenerator"></span><h5>Codebase Generator<a class="headerlink" href="#codebase-generator" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="n">all_repositories</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">r&#39;https://hg/hg/mailsuite/mailclient&#39;</span><span class="p">:</span> <span class="s">&#39;mailexe&#39;</span><span class="p">,</span>
    <span class="s">r&#39;https://hg/hg/mailsuite/mapilib&#39;</span><span class="p">:</span> <span class="s">&#39;mapilib&#39;</span><span class="p">,</span>
    <span class="s">r&#39;https://hg/hg/mailsuite/imaplib&#39;</span><span class="p">:</span> <span class="s">&#39;imaplib&#39;</span><span class="p">,</span>
    <span class="s">r&#39;https://github.com/mailinc/mailsuite/mailclient&#39;</span><span class="p">:</span> <span class="s">&#39;mailexe&#39;</span><span class="p">,</span>
    <span class="s">r&#39;https://github.com/mailinc/mailsuite/mapilib&#39;</span><span class="p">:</span> <span class="s">&#39;mapilib&#39;</span><span class="p">,</span>
    <span class="s">r&#39;https://github.com/mailinc/mailsuite/imaplib&#39;</span><span class="p">:</span> <span class="s">&#39;imaplib&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">codebaseGenerator</span><span class="p">(</span><span class="n">chdict</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">all_repositories</span><span class="p">[</span><span class="n">chdict</span><span class="p">[</span><span class="s">&#39;repository&#39;</span><span class="p">]]</span>

<span class="n">c</span><span class="p">[</span><span class="s">&#39;codebaseGenerator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">codebaseGenerator</span>
</pre></div>
</div>
<p>For any incoming change, the <a class="reference internal" href="#attr-codebase"><em>codebase</em></a> is set to ''.
This codebase value is sufficient if all changes come from the same repository (or clones).
If changes come from different repositories, extra processing will be needed to determine the codebase for the incoming change.
This codebase will then be a logical name for the combination of repository and or branch etc.</p>
<p>The <cite>codebaseGenerator</cite> accepts a change dictionary as produced by the <tt class="xref py py-class docutils literal"><span class="pre">buildbot.db.changes.ChangesConnectorComponent</span></tt>, with a changeid equal to <cite>None</cite>.</p>
</div>
</div>
<span id="document-manual/cfg-changesources"></span><div class="section" id="change-sources">
<span id="id1"></span><h4>Change Sources<a class="headerlink" href="#change-sources" title="Permalink to this headline">¶</a></h4>
<p>A Version Control System mantains a source tree, and tells the
buildmaster when it changes. The first step of each <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> is typically
to acquire a copy of some version of this tree.</p>
<p>This chapter describes how the Buildbot learns about what <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s have
occurred. For more information on VC systems and <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s, see
<a class="reference internal" href="#version-control-systems"><em>Version Control Systems</em></a>.</p>
<p><tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s can be provided by a variety of <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt> types, although any given
project will typically have only a single <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt> active. This section
provides a description of all available <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt> types and explains how to
set up each of them.</p>
<p>In general, each Buildmaster watches a single source tree.  It is possible to
work around this, but true support for multi-tree builds remains elusive.</p>
<div class="section" id="choosing-a-change-source">
<span id="id2"></span><h5>Choosing a Change Source<a class="headerlink" href="#choosing-a-change-source" title="Permalink to this headline">¶</a></h5>
<p>There are a variety of <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt> classes available, some of which are
meant to be used in conjunction with other tools to deliver <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>
events from the VC repository to the buildmaster.</p>
<p>As a quick guide, here is a list of VC systems and the <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>s
that might be useful with them.  Note that some of these modules are in
Buildbot's &quot;contrib&quot; directory, meaning that they have been offered by other
users in hopes they may be useful, and might require some additional work to
make them functional.</p>
<dl class="docutils">
<dt>CVS</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">CVSMaildirSource</span></tt></a> (watching mail sent by <tt class="docutils literal"><span class="pre">contrib/buildbot_cvs_mail.py</span></tt> script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from <tt class="docutils literal"><span class="pre">buildbot</span>
<span class="pre">sendchange</span></tt> run in a loginfo script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from a long-running
<tt class="file docutils literal"><span class="pre">contrib/viewcvspoll.py</span></tt> polling process which examines the ViewCVS
database directly</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></tt></a> in WebStatus</li>
</ul>
</dd>
<dt>SVN</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from
<tt class="file docutils literal"><span class="pre">contrib/svn_buildbot.py</span></tt> run in a postcommit script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from a long-running
<tt class="file docutils literal"><span class="pre">contrib/svn_watcher.py</span></tt> or <tt class="file docutils literal"><span class="pre">contrib/svnpoller.py</span></tt> polling
process</li>
<li><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNCommitEmailMaildirSource</span></tt></a> (watching for email sent by
<tt class="file docutils literal"><span class="pre">commit-email.pl</span></tt>)</li>
<li><a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> (polling the SVN repository)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></tt></a> in WebStatus</li>
<li><a class="reference internal" href="#chsrc-GoogleCodeAtomPoller" title="GoogleCodeAtomPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GoogleCodeAtomPoller</span></tt></a> (polling the
commit feed for a GoogleCode Git repository)</li>
</ul>
</dd>
<dt>Darcs</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from
<tt class="file docutils literal"><span class="pre">contrib/darcs_buildbot.py</span></tt> in a commit script)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></tt></a> in WebStatus</li>
</ul>
</dd>
<dt>Mercurial</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from
<tt class="file docutils literal"><span class="pre">contrib/hg_buildbot.py</span></tt> run in an 'changegroup' hook)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></tt></a> in WebStatus</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from
<tt class="file docutils literal"><span class="pre">buildbot/changes/hgbuildbot.py</span></tt> run as an in-process 'changegroup'
hook)</li>
<li><a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a> (polling a remote Mercurial repository)</li>
<li><a class="reference internal" href="#chsrc-GoogleCodeAtomPoller" title="GoogleCodeAtomPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GoogleCodeAtomPoller</span></tt></a> (polling the
commit feed for a GoogleCode Git repository)</li>
</ul>
</dd>
<dt>Bzr (the newer Bazaar)</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from
<tt class="file docutils literal"><span class="pre">contrib/bzr_buildbot.py</span></tt> run in a post-change-branch-tip or commit hook)</li>
<li><a class="reference internal" href="#chsrc-BzrPoller" title="BzrPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">BzrPoller</span></tt></a> (polling the Bzr repository)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></tt></a> in WebStatus</li>
</ul>
</dd>
<dt>Git</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from
<tt class="file docutils literal"><span class="pre">contrib/git_buildbot.py</span></tt> run in the post-receive hook)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from
<tt class="file docutils literal"><span class="pre">contrib/github_buildbot.py</span></tt>, which listens for notifications
from GitHub)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></tt></a> in WebStatus</li>
<li>github change hook (specifically designed for GitHub notifications,
but requiring a publicly-accessible WebStatus)</li>
<li><a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></tt></a> (polling a remote git repository)</li>
<li><a class="reference internal" href="#chsrc-GoogleCodeAtomPoller" title="GoogleCodeAtomPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GoogleCodeAtomPoller</span></tt></a> (polling the
commit feed for a GoogleCode Git repository)</li>
</ul>
</dd>
<dt>Repo/Git</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></tt></a> connects to Gerrit
via SSH to get a live stream of changes</li>
</ul>
</dd>
<dt>Monotone</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> (listening for connections from
<tt class="file docutils literal"><span class="pre">monotone-buildbot.lua</span></tt>, which is available with monotone)</li>
</ul>
</dd>
</dl>
<p>All VC systems can be driven by a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> and the <tt class="docutils literal"><span class="pre">buildbot</span>
<span class="pre">sendchange</span></tt> tool run from some form of commit script.  If you write an email
parsing function, they can also all be driven by a suitable <a class="reference internal" href="#mail-parsing-changesources"><em>mail-parsing
source</em></a>. Additionally, handlers for web-based
notification (i.e. from GitHub) can be used with WebStatus' change_hook module.
The interface is simple, so adding your own handlers (and sharing!) should be a
breeze.</p>
<p>See <a class="reference internal" href="bb-chsrc.html" title="Change Source Index"><em>Change Source Index</em></a> for a full list of change sources.</p>
<span class="target" id="index-0"></span></div>
<div class="section" id="configuring-change-sources">
<span id="cfg-change_source"></span><h5>Configuring Change Sources<a class="headerlink" href="#configuring-change-sources" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#cfg-change_source" title="change_source"><tt class="xref bb bb-cfg docutils literal"><span class="pre">change_source</span></tt></a> configuration key holds all active
change sources for the confguration.</p>
<p>Most configurations have a single <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>, watching only a single
tree, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PBChangeSource</span><span class="p">()</span>
</pre></div>
</div>
<p>For more advanced configurations, the parameter can be a list of change sources:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">source1</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">source2</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span> <span class="n">source1</span><span class="p">,</span> <span class="n">source1</span> <span class="p">]</span>
</pre></div>
</div>
<div class="section" id="repository-and-project">
<h6>Repository and Project<a class="headerlink" href="#repository-and-project" title="Permalink to this headline">¶</a></h6>
<p><tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>s will, in general, automatically provide the proper <tt class="xref py py-attr docutils literal"><span class="pre">repository</span></tt>
attribute for any changes they produce.  For systems which operate on URL-like
specifiers, this is a repository URL. Other <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>s adapt the concept as
necessary.</p>
<p>Many <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>s allow you to specify a project, as well.  This attribute is
useful when building from several distinct codebases in the same buildmaster:
the project string can serve to differentiate the different codebases.
<tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt>s can filter on project, so you can configure different builders to
run for each project.</p>
</div>
</div>
<div class="section" id="mail-parsing-changesources">
<span id="id3"></span><h5>Mail-parsing ChangeSources<a class="headerlink" href="#mail-parsing-changesources" title="Permalink to this headline">¶</a></h5>
<p>Many projects publish information about changes to their source tree
by sending an email message out to a mailing list, frequently named
<tt class="samp docutils literal"><em><span class="pre">PROJECT</span></em><span class="pre">-commits</span></tt> or <tt class="samp docutils literal"><em><span class="pre">PROJECT</span></em><span class="pre">-changes</span></tt>. Each message usually contains a
description of the change (who made the change, which files were
affected) and sometimes a copy of the diff. Humans can subscribe to
this list to stay informed about what's happening to the source tree.</p>
<p>The Buildbot can also be subscribed to a <cite>-commits</cite> mailing list, and
can trigger builds in response to Changes that it hears about. The
buildmaster admin needs to arrange for these email messages to arrive
in a place where the buildmaster can find them, and configure the
buildmaster to parse the messages correctly. Once that is in place,
the email parser will create Change objects and deliver them to the
Schedulers (see <a class="reference internal" href="#schedulers"><em>Schedulers</em></a>) just like any other ChangeSource.</p>
<p>There are two components to setting up an email-based ChangeSource.
The first is to route the email messages to the buildmaster, which is
done by dropping them into a <cite>maildir</cite>. The second is to actually
parse the messages, which is highly dependent upon the tool that was
used to create them. Each VC system has a collection of favorite
change-emailing tools, and each has a slightly different format, so
each has a different parsing function. There is a separate
ChangeSource variant for each parsing function.</p>
<p>Once you've chosen a maildir location and a parsing function, create
the change source and put it in <tt class="docutils literal"><span class="pre">change_source</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.mail</span> <span class="kn">import</span> <span class="n">CVSMaildirSource</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CVSMaildirSource</span><span class="p">(</span><span class="s">&quot;~/maildir-buildbot&quot;</span><span class="p">,</span>
                                        <span class="n">prefix</span><span class="o">=</span><span class="s">&quot;/trunk/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="subscribing-the-buildmaster">
<span id="id4"></span><h6>Subscribing the Buildmaster<a class="headerlink" href="#subscribing-the-buildmaster" title="Permalink to this headline">¶</a></h6>
<p>The recommended way to install the buildbot is to create a dedicated
account for the buildmaster. If you do this, the account will probably
have a distinct email address (perhaps
<cite>buildmaster&#64;example.org</cite>). Then just arrange for this
account's email to be delivered to a suitable maildir (described in
the next section).</p>
<p>If the buildbot does not have its own account, <cite>extension addresses</cite>
can be used to distinguish between email intended for the buildmaster
and email intended for the rest of the account. In most modern MTAs,
the e.g. <cite>foo&#64;example.org</cite> account has control over every email
address at example.org which begins with &quot;foo&quot;, such that email
addressed to <cite>account-foo&#64;example.org</cite> can be delivered to a
different destination than <cite>account-bar&#64;example.org</cite>. qmail
does this by using separate <tt class="file docutils literal"><span class="pre">.qmail</span></tt> files for the two destinations
(<tt class="file docutils literal"><span class="pre">.qmail-foo</span></tt> and <tt class="file docutils literal"><span class="pre">.qmail-bar</span></tt>, with <tt class="file docutils literal"><span class="pre">.qmail</span></tt>
controlling the base address and <tt class="file docutils literal"><span class="pre">.qmail-default</span></tt> controlling all
other extensions). Other MTAs have similar mechanisms.</p>
<p>Thus you can assign an extension address like
<cite>foo-buildmaster&#64;example.org</cite> to the buildmaster, and retain
<cite>foo&#64;example.org</cite> for your own use.</p>
</div>
<div class="section" id="using-maildirs">
<span id="id5"></span><h6>Using Maildirs<a class="headerlink" href="#using-maildirs" title="Permalink to this headline">¶</a></h6>
<p>A <cite>maildir</cite> is a simple directory structure originally developed for
qmail that allows safe atomic update without locking. Create a base
directory with three subdirectories: <tt class="file docutils literal"><span class="pre">new</span></tt>, <tt class="file docutils literal"><span class="pre">tmp</span></tt>, and <tt class="file docutils literal"><span class="pre">cur</span></tt>.
When messages arrive, they are put into a uniquely-named file (using
pids, timestamps, and random numbers) in <tt class="file docutils literal"><span class="pre">tmp</span></tt>. When the file is
complete, it is atomically renamed into <tt class="file docutils literal"><span class="pre">new</span></tt>. Eventually the
buildmaster notices the file in <tt class="file docutils literal"><span class="pre">new</span></tt>, reads and parses the
contents, then moves it into <tt class="file docutils literal"><span class="pre">cur</span></tt>. A cronjob can be used to delete
files in <tt class="file docutils literal"><span class="pre">cur</span></tt> at leisure.</p>
<p>Maildirs are frequently created with the <strong class="command">maildirmake</strong> tool,
but a simple <strong class="command">mkdir -p ~/MAILDIR/{cur,new,tmp}</strong> is pretty much
equivalent.</p>
<p>Many modern MTAs can deliver directly to maildirs. The usual <tt class="file docutils literal"><span class="pre">.forward</span></tt>
or <tt class="file docutils literal"><span class="pre">.procmailrc</span></tt> syntax is to name the base directory with a trailing
slash, so something like <tt class="docutils literal"><span class="pre">~/MAILDIR/</span></tt>. qmail and postfix are
maildir-capable MTAs, and procmail is a maildir-capable MDA (Mail
Delivery Agent).</p>
<p>Here is an example procmail config, located in <tt class="file docutils literal"><span class="pre">~/.procmailrc</span></tt>:</p>
<div class="highlight-python"><pre># .procmailrc
# routes incoming mail to appropriate mailboxes
PATH=/usr/bin:/usr/local/bin
MAILDIR=$HOME/Mail
LOGFILE=.procmail_log
SHELL=/bin/sh

:0
*
new</pre>
</div>
<p>If procmail is not setup on a system wide basis, then the following one-line
<tt class="file docutils literal"><span class="pre">.forward</span></tt> file will invoke it.</p>
<div class="highlight-python"><pre>!/usr/bin/procmail</pre>
</div>
<p>For MTAs which cannot put files into maildirs directly, the
<cite>safecat</cite> tool can be executed from a <tt class="file docutils literal"><span class="pre">.forward</span></tt> file to accomplish
the same thing.</p>
<p>The Buildmaster uses the linux DNotify facility to receive immediate
notification when the maildir's <tt class="file docutils literal"><span class="pre">new</span></tt> directory has changed. When
this facility is not available, it polls the directory for new
messages, every 10 seconds by default.</p>
</div>
<div class="section" id="parsing-email-change-messages">
<span id="id6"></span><h6>Parsing Email Change Messages<a class="headerlink" href="#parsing-email-change-messages" title="Permalink to this headline">¶</a></h6>
<p>The second component to setting up an email-based <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt> is to
parse the actual notices. This is highly dependent upon the VC system
and commit script in use.</p>
<p>A couple of common tools used to create these change emails, along with the
buildbot tools to parse them, are:</p>
<dl class="docutils">
<dt>CVS</dt>
<dd><dl class="first last docutils">
<dt>Buildbot CVS MailNotifier</dt>
<dd><a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">CVSMaildirSource</span></tt></a></dd>
</dl>
</dd>
<dt>SVN</dt>
<dd><dl class="first last docutils">
<dt>svnmailer</dt>
<dd><a class="reference external" href="http://opensource.perlig.de/en/svnmailer/">http://opensource.perlig.de/en/svnmailer/</a></dd>
<dt><tt class="file docutils literal"><span class="pre">commit-email.pl</span></tt></dt>
<dd><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNCommitEmailMaildirSource</span></tt></a></dd>
</dl>
</dd>
<dt>Bzr</dt>
<dd><dl class="first last docutils">
<dt>Launchpad</dt>
<dd><a class="reference internal" href="#chsrc-BzrLaunchpadEmailMaildirSource" title="BzrLaunchpadEmailMaildirSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">BzrLaunchpadEmailMaildirSource</span></tt></a></dd>
</dl>
</dd>
<dt>Mercurial</dt>
<dd><dl class="first last docutils">
<dt>NotifyExtension</dt>
<dd><a class="reference external" href="http://www.selenic.com/mercurial/wiki/index.cgi/NotifyExtension">http://www.selenic.com/mercurial/wiki/index.cgi/NotifyExtension</a></dd>
</dl>
</dd>
<dt>Git</dt>
<dd><dl class="first last docutils">
<dt>post-receive-email</dt>
<dd><a class="reference external" href="http://git.kernel.org/?p=git/git.git;a=blob;f=contrib/hooks/post-receive-email;hb=HEAD">http://git.kernel.org/?p=git/git.git;a=blob;f=contrib/hooks/post-receive-email;hb=HEAD</a></dd>
</dl>
</dd>
</dl>
<p>The following sections describe the parsers available for each of
these tools.</p>
<p>Most of these parsers accept a <tt class="docutils literal"><span class="pre">prefix=</span></tt> argument, which is used
to limit the set of files that the buildmaster pays attention to. This
is most useful for systems like CVS and SVN which put multiple
projects in a single repository (or use repository names to indicate
branches). Each filename that appears in the email is tested against
the prefix: if the filename does not start with the prefix, the file
is ignored. If the filename <em>does</em> start with the prefix, that
prefix is stripped from the filename before any further processing is
done. Thus the prefix usually ends with a slash.</p>
</div>
<div class="section" id="cvsmaildirsource">
<span id="chsrc-CVSMaildirSource"></span><span id="id7"></span><h6>CVSMaildirSource<a class="headerlink" href="#cvsmaildirsource" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.changes.mail.CVSMaildirSource">
<em class="property">class </em><tt class="descclassname">buildbot.changes.mail.</tt><tt class="descname">CVSMaildirSource</tt><a class="headerlink" href="#buildbot.changes.mail.CVSMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This parser works with the <tt class="file docutils literal"><span class="pre">buildbot_cvs_maildir.py</span></tt> script in the
contrib directory.</p>
<p>The script sends an email containing all the files submitted in
one directory. It is invoked by using the <tt class="file docutils literal"><span class="pre">CVSROOT/loginfo</span></tt> facility.</p>
<p>The Buildbot's <a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">CVSMaildirSource</span></tt></a> knows how to parse these messages
and turn them into Change objects. It takes the directory name of the maildir
root.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.mail</span> <span class="kn">import</span> <span class="n">CVSMaildirSource</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CVSMaildirSource</span><span class="p">(</span><span class="s">&quot;/home/buildbot/Mail&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="configuration-of-cvs-and-buildbot-cvs-mail-py">
<h7>Configuration of CVS and buildbot_cvs_mail.py<a class="headerlink" href="#configuration-of-cvs-and-buildbot-cvs-mail-py" title="Permalink to this headline">¶</a></h7>
<p>CVS must be configured to invoke the buildbot_cvs_mail.py script when files
are checked in. This is done via the CVS loginfo configuration file.</p>
<p>To update this, first do:</p>
<div class="highlight-python"><pre>cvs checkout CVSROOT</pre>
</div>
<p>cd to the CVSROOT directory and edit the file loginfo, adding a line like:</p>
<div class="highlight-python"><pre>SomeModule /cvsroot/CVSROOT/buildbot_cvs_mail.py --cvsroot :ext:example.com:/cvsroot -e buildbot -P SomeModule %@{sVv@}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For cvs version 1.12.x, the <tt class="docutils literal"><span class="pre">--path</span> <span class="pre">%p</span></tt> option is required.
Version 1.11.x and 1.12.x report the directory path differently.</p>
</div>
<p>The above example you put the buildbot_cvs_mail.py script under /cvsroot/CVSROOT.
It can be anywhere. Run the script with --help to see all the options.
At the very least, the
options <tt class="docutils literal"><span class="pre">-e</span></tt> (email) and <tt class="docutils literal"><span class="pre">-P</span></tt> (project) should be specified. The line must end with <tt class="docutils literal"><span class="pre">%{sVv}</span></tt>
This is expanded to the files that were modified.</p>
<p>Additional entries can be added to support more modules.</p>
<p>See <strong class="command">buildbot_cvs_mail.py --help`</strong> for more information on the available options.</p>
</div>
</div>
<div class="section" id="svncommitemailmaildirsource">
<span id="chsrc-SVNCommitEmailMaildirSource"></span><span id="id8"></span><h6>SVNCommitEmailMaildirSource<a class="headerlink" href="#svncommitemailmaildirsource" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.changes.mail.SVNCommitEmailMaildirSource">
<em class="property">class </em><tt class="descclassname">buildbot.changes.mail.</tt><tt class="descname">SVNCommitEmailMaildirSource</tt><a class="headerlink" href="#buildbot.changes.mail.SVNCommitEmailMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNCommitEmailMaildirSource</span></tt></a> parses message sent out by the
<tt class="file docutils literal"><span class="pre">commit-email.pl</span></tt> script, which is included in the Subversion
distribution.</p>
<p>It does not currently handle branches: all of the Change objects that
it creates will be associated with the default (i.e. trunk) branch.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.mail</span> <span class="kn">import</span> <span class="n">SVNCommitEmailMaildirSource</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNCommitEmailMaildirSource</span><span class="p">(</span><span class="s">&quot;~/maildir-buildbot&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="bzrlaunchpademailmaildirsource">
<span id="chsrc-BzrLaunchpadEmailMaildirSource"></span><span id="id9"></span><h6>BzrLaunchpadEmailMaildirSource<a class="headerlink" href="#bzrlaunchpademailmaildirsource" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.changes.mail.BzrLaunchpadEmailMaildirSource">
<em class="property">class </em><tt class="descclassname">buildbot.changes.mail.</tt><tt class="descname">BzrLaunchpadEmailMaildirSource</tt><a class="headerlink" href="#buildbot.changes.mail.BzrLaunchpadEmailMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-BzrLaunchpadEmailMaildirSource" title="BzrLaunchpadEmailMaildirSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">BzrLaunchpadEmailMaildirSource</span></tt></a> parses the mails that are sent to
addresses that subscribe to branch revision notifications for a bzr branch
hosted on Launchpad.</p>
<p>The branch name defaults to <tt class="samp docutils literal"><span class="pre">lp:</span><em><span class="pre">Launchpad</span> <span class="pre">path</span></em></tt>. For example
<tt class="docutils literal"><span class="pre">lp:~maria-captains/maria/5.1</span></tt>.</p>
<p>If only a single branch is used, the default branch name can be changed by
setting <tt class="docutils literal"><span class="pre">defaultBranch</span></tt>.</p>
<p>For multiple branches, pass a dictionary as the value of the <tt class="docutils literal"><span class="pre">branchMap</span></tt>
option to map specific repository paths to specific branch names (see example
below). The leading <tt class="docutils literal"><span class="pre">lp:</span></tt> prefix of the path is optional.</p>
<p>The <tt class="docutils literal"><span class="pre">prefix</span></tt> option is not supported (it is silently ignored). Use the
<tt class="docutils literal"><span class="pre">branchMap</span></tt> and <tt class="docutils literal"><span class="pre">defaultBranch</span></tt> instead to assign changes to
branches (and just do not subscribe the buildbot to branches that are not of
interest).</p>
<p>The revision number is obtained from the email text. The bzr revision id is
not available in the mails sent by Launchpad. However, it is possible to set
the bzr <cite>append_revisions_only</cite> option for public shared repositories to
avoid new pushes of merges changing the meaning of old revision numbers.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.mail</span> <span class="kn">import</span> <span class="n">BzrLaunchpadEmailMaildirSource</span>
<span class="n">bm</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;lp:~maria-captains/maria/5.1&#39;</span> <span class="p">:</span> <span class="s">&#39;5.1&#39;</span><span class="p">,</span> <span class="s">&#39;lp:~maria-captains/maria/6.0&#39;</span> <span class="p">:</span> <span class="s">&#39;6.0&#39;</span> <span class="p">}</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BzrLaunchpadEmailMaildirSource</span><span class="p">(</span><span class="s">&quot;~/maildir-buildbot&quot;</span><span class="p">,</span> <span class="n">branchMap</span> <span class="o">=</span> <span class="n">bm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pbchangesource">
<span id="chsrc-PBChangeSource"></span><span id="id10"></span><h5>PBChangeSource<a class="headerlink" href="#pbchangesource" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.pb.PBChangeSource">
<em class="property">class </em><tt class="descclassname">buildbot.changes.pb.</tt><tt class="descname">PBChangeSource</tt><a class="headerlink" href="#buildbot.changes.pb.PBChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> actually listens on a TCP port for
clients to connect and push change notices <em>into</em> the
Buildmaster. This is used by the built-in <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">sendchange</span></tt>
notification tool, as well as several version-control hook
scripts. This change is also useful for
creating new kinds of change sources that work on a <cite>push</cite> model
instead of some kind of subscription scheme, for example a script
which is run out of an email <tt class="file docutils literal"><span class="pre">.forward</span></tt> file. This ChangeSource
always runs on the same TCP port as the slaves.  It shares the same
protocol, and in fact shares the same space of &quot;usernames&quot;, so you
cannot configure a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> with the same name as a slave.</p>
<p>If you have a publicly accessible slave port, and are using
<a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a>, <em>you must establish a secure username and password
for the change source</em>.  If your sendchange credentials are known (e.g., the
defaults), then your buildmaster is susceptible to injection of arbitrary
changes, which (depending on the build factories) could lead to arbitrary code
execution on buildslaves.</p>
<p>The <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> is created with the following arguments.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">port</span></tt></dt>
<dd>which port to listen on. If <tt class="docutils literal"><span class="pre">None</span></tt> (which is the default), it
shares the port used for buildslave connections.</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd>The user account that the client program must use to connect. Defaults to
<tt class="docutils literal"><span class="pre">change</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">passwd</span></tt></dt>
<dd>The password for the connection - defaults to <tt class="docutils literal"><span class="pre">changepw</span></tt>.  Do not use
this default on a publicly exposed port!</dd>
<dt><tt class="docutils literal"><span class="pre">prefix</span></tt></dt>
<dd><p class="first">The prefix to be found and stripped from filenames delivered over the
connection, defaulting to <tt class="docutils literal"><span class="pre">None</span></tt>. Any filenames which do not start with
this prefix will be removed. If all the filenames in a given Change are
removed, the that whole Change will be dropped. This string should probably
end with a directory separator.</p>
<p class="last">This is useful for changes coming from version control systems that
represent branches as parent directories within the repository (like SVN
and Perforce). Use a prefix of <tt class="docutils literal"><span class="pre">trunk/</span></tt> or
<tt class="docutils literal"><span class="pre">project/branches/foobranch/</span></tt> to only follow one branch and to get
correct tree-relative filenames. Without a prefix, the
<a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> will probably deliver Changes with filenames
like <tt class="file docutils literal"><span class="pre">trunk/foo.c</span></tt> instead of just <tt class="file docutils literal"><span class="pre">foo.c</span></tt>. Of course this also
depends upon the tool sending the Changes in (like <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">buildbot</span>
<span class="pre">sendchange</span></tt></a>) and what filenames it is delivering: that tool
may be filtering and stripping prefixes at the sending end.</p>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes</span> <span class="kn">import</span> <span class="n">pb</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">PBChangeSource</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">&#39;laura&#39;</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s">&#39;fpga&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The following hooks are useful for sending changes to a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a>:</p>
<div class="section" id="mercurial-hook">
<span id="id11"></span><h6>Mercurial Hook<a class="headerlink" href="#mercurial-hook" title="Permalink to this headline">¶</a></h6>
<p>Since Mercurial is written in python, the hook script can invoke
Buildbot's <tt class="xref py py-meth docutils literal"><span class="pre">sendchange</span></tt> function directly, rather than having to
spawn an external process. This function delivers the same sort of
changes as <strong class="command">buildbot sendchange</strong> and the various hook scripts in
<tt class="file docutils literal"><span class="pre">contrib/</span></tt>, so you'll need to add a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> to your
buildmaster to receive these changes.</p>
<p>To set this up, first choose a Mercurial repository that represents
your central <cite>official</cite> source tree. This will be the same
repository that your buildslaves will eventually pull from. Install
Buildbot on the machine that hosts this repository, using the same
version of python as Mercurial is using (so that the Mercurial hook
can import code from buildbot). Then add the following to the
<tt class="file docutils literal"><span class="pre">.hg/hgrc</span></tt> file in that repository, replacing the buildmaster
hostname/portnumber as appropriate for your buildbot:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[hooks]</span>
<span class="na">changegroup.buildbot</span> <span class="o">=</span> <span class="s">python:buildbot.changes.hgbuildbot.hook</span>

<span class="k">[hgbuildbot]</span>
<span class="na">master</span> <span class="o">=</span> <span class="s">buildmaster.example.org:9987</span>
<span class="c"># .. other hgbuildbot parameters ..</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">master</span></tt> configuration key allows to have more than one buildmaster
specification. The buildmasters have to be separated by a whitspace
or comma (see also 'hg help config'):</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="na">master</span> <span class="o">=</span><span class="s"></span>
<span class="s">    buildmaster.example.org:9987</span>
<span class="s">    buildmaster2.example.org:9989</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Mercurial lets you define multiple <tt class="docutils literal"><span class="pre">changegroup</span></tt> hooks by
giving them distinct names, like <tt class="docutils literal"><span class="pre">changegroup.foo</span></tt> and
<tt class="docutils literal"><span class="pre">changegroup.bar</span></tt>, which is why we use <tt class="docutils literal"><span class="pre">changegroup.buildbot</span></tt>
in this example. There is nothing magical about the <cite>buildbot</cite>
suffix in the hook name. The <tt class="docutils literal"><span class="pre">[hgbuildbot]</span></tt> section <em>is</em> special,
however, as it is the only section that the buildbot hook pays
attention to.)</p>
</div>
<p>Also note that this runs as a <tt class="docutils literal"><span class="pre">changegroup</span></tt> hook, rather than as
an <tt class="docutils literal"><span class="pre">incoming</span></tt> hook. The <tt class="docutils literal"><span class="pre">changegroup</span></tt> hook is run with
multiple revisions at a time (say, if multiple revisions are being
pushed to this repository in a single <strong class="command">hg push</strong> command),
whereas the <tt class="docutils literal"><span class="pre">incoming</span></tt> hook is run with just one revision at a
time. The <tt class="docutils literal"><span class="pre">hgbuildbot.hook</span></tt> function will only work with the
<tt class="docutils literal"><span class="pre">changegroup</span></tt> hook.</p>
<p>Changes' attribute <tt class="docutils literal"><span class="pre">properties</span></tt> has an entry <tt class="docutils literal"><span class="pre">is_merge</span></tt> which is set to
true when the change was caused by a merge.</p>
<div class="section" id="authentication">
<h7>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h7>
<p>If the buildmaster <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a> is configured to require
sendchange credentials then you can set these with the <tt class="docutils literal"><span class="pre">auth</span></tt>
parameter. When this parameter is not set it defaults to
<tt class="docutils literal"><span class="pre">change:changepw</span></tt>, which are the defaults for the <tt class="docutils literal"><span class="pre">user</span></tt> and
<tt class="docutils literal"><span class="pre">password</span></tt> values of a <tt class="docutils literal"><span class="pre">PBChangeSource</span></tt> which doesn't require
authentication.</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[hgbuildbot]</span>
<span class="na">auth</span> <span class="o">=</span> <span class="s">clientname:supersecret</span>
<span class="c"># ...</span>
</pre></div>
</div>
<p>You can set this parameter in either the global <tt class="file docutils literal"><span class="pre">/etc/mercurial/hgrc</span></tt>,
your personal <tt class="file docutils literal"><span class="pre">~/.hgrc</span></tt> file or the repository local <tt class="file docutils literal"><span class="pre">.hg/hgrc</span></tt>
file. But since this value is stored in plain text, you must make sure that
it can only be read by those users that need to know the authentication
credentials.</p>
</div>
<div class="section" id="branch-type">
<h7>Branch Type<a class="headerlink" href="#branch-type" title="Permalink to this headline">¶</a></h7>
<p>The <tt class="docutils literal"><span class="pre">[hgbuildbot]</span></tt> section has two other parameters that you
might specify, both of which control the name of the branch that is
attached to the changes coming from this hook.</p>
<p>One common branch naming policy for Mercurial repositories is to use
Mercurial's built-in branches (the kind created with <strong class="command">hg
branch</strong> and listed with <strong class="command">hg branches</strong>). This feature
associates persistent names with particular  lines of descent within a
single repository. (note that the buildbot <tt class="docutils literal"><span class="pre">source.Mercurial</span></tt>
checkout step does not yet support this kind of branch). To have the
commit hook deliver this sort of branch name with the Change object,
use <tt class="docutils literal"><span class="pre">branchtype</span> <span class="pre">=</span> <span class="pre">inrepo</span></tt>, this is the default behavior:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[hgbuildbot]</span>
<span class="na">branchtype</span> <span class="o">=</span> <span class="s">inrepo</span>
<span class="c"># ...</span>
</pre></div>
</div>
<p>Another approach is for each branch to go into a separate repository,
and all the branches for a single project share a common parent
directory. For example, you might have <tt class="file docutils literal"><span class="pre">/var/repos/</span><em><span class="pre">PROJECT</span></em><span class="pre">/trunk/</span></tt> and
<tt class="file docutils literal"><span class="pre">/var/repos/</span><em><span class="pre">PROJECT</span></em><span class="pre">/release</span></tt>. To use this style, use the
<tt class="docutils literal"><span class="pre">branchtype</span> <span class="pre">=</span> <span class="pre">dirname</span></tt> setting, which simply uses the last component
of the repository's enclosing directory as the branch name:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[hgbuildbot]</span>
<span class="na">branchtype</span> <span class="o">=</span> <span class="s">dirname</span>
<span class="c"># ...</span>
</pre></div>
</div>
<p>Finally, if you want to simply specify the branchname directly, for
all changes, use <tt class="docutils literal"><span class="pre">branch</span> <span class="pre">=</span> <span class="pre">BRANCHNAME</span></tt>. This overrides
<tt class="docutils literal"><span class="pre">branchtype</span></tt>:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[hgbuildbot]</span>
<span class="na">branch</span> <span class="o">=</span> <span class="s">trunk</span>
<span class="c"># ...</span>
</pre></div>
</div>
<p>If you use <tt class="docutils literal"><span class="pre">branch=</span></tt> like this, you'll need to put a separate
<tt class="file docutils literal"><span class="pre">.hgrc</span></tt> in each repository. If you use <tt class="docutils literal"><span class="pre">branchtype=</span></tt>, you may be
able to use the same <tt class="file docutils literal"><span class="pre">.hgrc</span></tt> for all your repositories, stored in
<tt class="file docutils literal"><span class="pre">~/.hgrc</span></tt> or <tt class="file docutils literal"><span class="pre">/etc/mercurial/hgrc</span></tt>.</p>
</div>
<div class="section" id="compatibility">
<h7>Compatibility<a class="headerlink" href="#compatibility" title="Permalink to this headline">¶</a></h7>
<p>As twisted needs to hook some signals, and some web servers
strictly forbid that, the parameter <tt class="docutils literal"><span class="pre">fork</span></tt> in the
<tt class="docutils literal"><span class="pre">[hgbuildbot]</span></tt> section will instruct mercurial to fork before
sending the change request. Then as the created process will be of short
life, it is considered as safe to disable the signal restriction in
the Apache setting like that <tt class="docutils literal"><span class="pre">WSGIRestrictSignal</span> <span class="pre">Off</span></tt>. Refer to the
documentation of your web server for other way to do the same.</p>
</div>
<div class="section" id="resulting-changes">
<h7>Resulting Changes<a class="headerlink" href="#resulting-changes" title="Permalink to this headline">¶</a></h7>
<p>The <tt class="docutils literal"><span class="pre">category</span></tt> parameter sets the category for any changes generated from
the hook.  Likewise, the <tt class="docutils literal"><span class="pre">project</span></tt> parameter sets the project.</p>
<p>Changes' <tt class="docutils literal"><span class="pre">repository</span></tt> attributes are formed from the Mercurial repo path by
stripping <tt class="docutils literal"><span class="pre">strip</span></tt> slashes on the left, then prepending the <tt class="docutils literal"><span class="pre">baseurl</span></tt>.  For
example, assume the following parameters:</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[hgbuildbot]</span>
<span class="na">baseurl</span> <span class="o">=</span> <span class="s">http://hg.myorg.com/repos/</span>
<span class="na">strip</span> <span class="o">=</span> <span class="s">3</span>
<span class="c"># ...</span>
</pre></div>
</div>
<p>Then a repopath of <tt class="docutils literal"><span class="pre">/var/repos/myproject/release</span></tt> would have its left 3
slashes stripped, leaving <tt class="docutils literal"><span class="pre">myproject/release</span></tt>, after which the base URL would
be prepended, to create <tt class="docutils literal"><span class="pre">http://hg.myorg.com/repos/myproject/release</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">hgbuildbot</span></tt> <tt class="docutils literal"><span class="pre">baseurl</span></tt> value defaults to the value of the same
parameter in the <tt class="docutils literal"><span class="pre">web</span></tt> section of the configuration.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>older versions of Buildbot created repository strings that did not
contain an entire URL.  To continue this pattern, set the <tt class="docutils literal"><span class="pre">hgbuildbot</span></tt>
<tt class="docutils literal"><span class="pre">baseurl</span></tt> parameter to an empty string:</p>
<div class="last highlight-ini"><div class="highlight"><pre><span class="k">[hgbuildbot]</span>
<span class="na">baseurl</span> <span class="o">=</span> <span class="s">http://hg.myorg.com/repos/</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="bzr-hook">
<span id="id12"></span><h6>Bzr Hook<a class="headerlink" href="#bzr-hook" title="Permalink to this headline">¶</a></h6>
<p>Bzr is also written in Python, and the Bzr hook depends on Twisted to send the
changes.</p>
<p>To install, put <tt class="file docutils literal"><span class="pre">contrib/bzr_buildbot.py</span></tt> in one of your plugins
locations a bzr plugins directory (e.g.,
<tt class="file docutils literal"><span class="pre">~/.bazaar/plugins</span></tt>). Then, in one of your bazaar conf files (e.g.,
<tt class="file docutils literal"><span class="pre">~/.bazaar/locations.conf</span></tt>), set the location you want to connect with buildbot
with these keys:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">buildbot_on</span></tt>
one of 'commit', 'push, or 'change'. Turns the plugin on to report changes via
commit, changes via push, or any changes to the trunk. 'change' is
recommended.</li>
<li><tt class="docutils literal"><span class="pre">buildbot_server</span></tt>
(required to send to a buildbot master) the URL of the buildbot master to
which you will connect (as of this writing, the same server and port to which
slaves connect).</li>
<li><tt class="docutils literal"><span class="pre">buildbot_port</span></tt>
(optional, defaults to 9989) the port of the buildbot master to which you will
connect (as of this writing, the same server and port to which slaves connect)</li>
<li><tt class="docutils literal"><span class="pre">buildbot_pqm</span></tt>
(optional, defaults to not pqm) Normally, the user that commits the revision
is the user that is responsible for the change. When run in a pqm (Patch Queue
Manager, see <a class="reference external" href="https://launchpad.net/pqm">https://launchpad.net/pqm</a>) environment, the user that commits is
the Patch Queue Manager, and the user that committed the <em>parent</em> revision is
responsible for the change. To turn on the pqm mode, set this value to any of
(case-insensitive) &quot;Yes&quot;, &quot;Y&quot;, &quot;True&quot;, or &quot;T&quot;.</li>
<li><tt class="docutils literal"><span class="pre">buildbot_dry_run</span></tt>
(optional, defaults to not a dry run) Normally, the post-commit hook will
attempt to communicate with the configured buildbot server and port. If this
parameter is included and any of (case-insensitive) &quot;Yes&quot;, &quot;Y&quot;, &quot;True&quot;, or
&quot;T&quot;, then the hook will simply print what it would have sent, but not attempt
to contact the buildbot master.</li>
<li><tt class="docutils literal"><span class="pre">buildbot_send_branch_name</span></tt>
(optional, defaults to not sending the branch name) If your buildbot's bzr
source build step uses a repourl, do <em>not</em> turn this on. If your buildbot's
bzr build step uses a baseURL, then you may set this value to any of
(case-insensitive) &quot;Yes&quot;, &quot;Y&quot;, &quot;True&quot;, or &quot;T&quot; to have the buildbot master
append the branch name to the baseURL.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The bzr smart server (as of version 2.2.2) doesn't know how
to resolve <tt class="docutils literal"><span class="pre">bzr://</span></tt> urls into absolute paths so any paths in
<tt class="docutils literal"><span class="pre">locations.conf</span></tt> won't match, hence no change notifications
will be sent to Buildbot. Setting configuration parameters globally
or in-branch might still work. When buildbot no longer has a
hardcoded password, it will be a configuration option here as well.</p>
</div>
<p>Here's a simple example that you might have in your
<tt class="file docutils literal"><span class="pre">~/.bazaar/locations.conf</span></tt>.</p>
<div class="highlight-ini"><div class="highlight"><pre><span class="k">[chroot-*:///var/local/myrepo/mybranch]</span>
<span class="na">buildbot_on</span> <span class="o">=</span> <span class="s">change</span>
<span class="na">buildbot_server</span> <span class="o">=</span> <span class="s">localhost</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="p4source">
<span id="chsrc-P4Source"></span><span id="id13"></span><h5>P4Source<a class="headerlink" href="#p4source" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">P4Source</span></tt></a> periodically polls a <a class="reference external" href="http://www.perforce.com/">Perforce</a>
depot for changes. It accepts the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">p4base</span></tt></dt>
<dd>The base depot path to watch, without the trailing '/...'.</dd>
<dt><tt class="docutils literal"><span class="pre">p4port</span></tt></dt>
<dd>The Perforce server to connect to (as <tt class="samp docutils literal"><em><span class="pre">host</span></em><span class="pre">:</span><em><span class="pre">port</span></em></tt>).</dd>
<dt><tt class="docutils literal"><span class="pre">p4user</span></tt></dt>
<dd>The Perforce user.</dd>
<dt><tt class="docutils literal"><span class="pre">p4passwd</span></tt></dt>
<dd>The Perforce password.</dd>
<dt><tt class="docutils literal"><span class="pre">p4bin</span></tt></dt>
<dd>An optional string parameter. Specify the location of the perforce command
line binary (p4).  You only need to do this if the perforce binary is not
in the path of the buildbot user.  Defaults to <cite>p4</cite>.</dd>
<dt><tt class="docutils literal"><span class="pre">split_file</span></tt></dt>
<dd>A function that maps a pathname, without the leading <tt class="docutils literal"><span class="pre">p4base</span></tt>, to a
(branch, filename) tuple. The default just returns <tt class="docutils literal"><span class="pre">(None,</span> <span class="pre">branchfile)</span></tt>,
which effectively disables branch support. You should supply a function
which understands your repository structure.</dd>
<dt><tt class="docutils literal"><span class="pre">pollinterval</span></tt></dt>
<dd>How often to poll, in seconds. Defaults to 600 (10 minutes).</dd>
<dt><tt class="docutils literal"><span class="pre">histmax</span></tt></dt>
<dd>The maximum number of changes to inspect at a time. If more than this
number occur since the last poll, older changes will be silently
ignored.</dd>
<dt><tt class="docutils literal"><span class="pre">encoding</span></tt></dt>
<dd>The character encoding of <tt class="docutils literal"><span class="pre">p4</span></tt>'s output.  This defaults to &quot;utf8&quot;, but
if your commit messages are in another encoding, specify that here.</dd>
</dl>
<div class="section" id="example">
<h6>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h6>
<p>This configuration uses the <span class="target" id="index-1"></span><tt class="xref std std-envvar docutils literal"><span class="pre">P4PORT</span></tt>, <span class="target" id="index-2"></span><tt class="xref std std-envvar docutils literal"><span class="pre">P4USER</span></tt>, and <span class="target" id="index-3"></span><tt class="xref std std-envvar docutils literal"><span class="pre">P4PASSWD</span></tt>
specified in the buildmaster's environment. It watches a project in which the
branch name is simply the next path component, and the file is all path
components after.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes</span> <span class="kn">import</span> <span class="n">p4poller</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">p4poller</span><span class="o">.</span><span class="n">P4Source</span><span class="p">(</span><span class="n">p4base</span><span class="o">=</span><span class="s">&#39;//depot/project/&#39;</span><span class="p">,</span>
                      <span class="n">split_file</span><span class="o">=</span><span class="k">lambda</span> <span class="n">branchfile</span><span class="p">:</span> <span class="n">branchfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                     <span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bonsaipoller">
<span id="chsrc-BonsaiPoller"></span><span id="id14"></span><h5>BonsaiPoller<a class="headerlink" href="#bonsaipoller" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#chsrc-BonsaiPoller" title="BonsaiPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">BonsaiPoller</span></tt></a> periodically polls a Bonsai server. This is a
CGI script accessed through a web server that provides information
about a CVS tree, for example the Mozilla bonsai server at
<a class="reference external" href="http://bonsai.mozilla.org">http://bonsai.mozilla.org</a>. Bonsai servers are usable by both
humans and machines. In this case, the buildbot's change source forms
a query which asks about any files in the specified branch which have
changed since the last query.</p>
<p><a class="reference internal" href="#chsrc-BonsaiPoller" title="BonsaiPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">BonsaiPoller</span></tt></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">bonsaiURL</span></tt></dt>
<dd>The base URL of the Bonsai server, e.g., <tt class="docutils literal"><span class="pre">http://bonsai.mozilla.org</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">module</span></tt></dt>
<dd>The module to look for changes in. Commonly this is <tt class="docutils literal"><span class="pre">all</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>The branch to look for changes in.  This will appear in the
<tt class="docutils literal"><span class="pre">branch</span></tt> field of the resulting change objects.</dd>
<dt><tt class="docutils literal"><span class="pre">tree</span></tt></dt>
<dd>The tree to look for changes in.  Commonly this is <tt class="docutils literal"><span class="pre">all</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">cvsroot</span></tt></dt>
<dd>The CVS root of the repository.  Usually this is <tt class="docutils literal"><span class="pre">/cvsroot</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">pollInterval</span></tt></dt>
<dd>The time (in seconds) between queries for changes.</dd>
<dt><tt class="docutils literal"><span class="pre">project</span></tt></dt>
<dd>The project name to attach to all change objects produced by this
change source.</dd>
</dl>
</div>
<div class="section" id="svnpoller">
<span id="chsrc-SVNPoller"></span><span id="id15"></span><h5>SVNPoller<a class="headerlink" href="#svnpoller" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.svnpoller.SVNPoller">
<em class="property">class </em><tt class="descclassname">buildbot.changes.svnpoller.</tt><tt class="descname">SVNPoller</tt><a class="headerlink" href="#buildbot.changes.svnpoller.SVNPoller" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> is a ChangeSource which periodically polls a
<a class="reference external" href="http://subversion.tigris.org/">Subversion</a> repository for new revisions, by
running the <tt class="docutils literal"><span class="pre">svn</span> <span class="pre">log</span></tt> command in a subshell. It can watch a single branch or
multiple branches.</p>
<p><a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">svnurl</span></tt></dt>
<dd><p class="first">The base URL path to watch, like
<tt class="docutils literal"><span class="pre">svn://svn.twistedmatrix.com/svn/Twisted/trunk</span></tt>, or
<tt class="docutils literal"><span class="pre">http://divmod.org/svn/Divmo/</span></tt>, or even
<tt class="docutils literal"><span class="pre">file:///home/svn/Repository/ProjectA/branches/1.5/</span></tt>. This must
include the access scheme, the location of the repository (both the
hostname for remote ones, and any additional directory names necessary
to get to the repository), and the sub-path within the repository's
virtual filesystem for the project and branch of interest.</p>
<p class="last">The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> will only pay attention to files inside the
subdirectory specified by the complete svnurl.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">split_file</span></tt></dt>
<dd><p class="first">A function to convert pathnames into <tt class="docutils literal"><span class="pre">(branch,</span> <span class="pre">relative_pathname)</span></tt>
tuples. Use this to explain your repository's branch-naming policy to
<a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a>. This function must accept a single string (the
pathname relative to the repository) and return a two-entry tuple.
Directory pathnames always end with a right slash to distinguish them from
files, like <tt class="docutils literal"><span class="pre">trunk/src/</span></tt>, or <tt class="docutils literal"><span class="pre">src/</span></tt>. There are a few utility functions
in <tt class="xref py py-mod docutils literal"><span class="pre">buildbot.changes.svnpoller</span></tt> that can be used as a <tt class="xref py py-meth docutils literal"><span class="pre">split_file</span></tt>
function; see below for details.</p>
<p>For directories, the relative pathname returned by <tt class="xref py py-meth docutils literal"><span class="pre">split_file</span></tt> should
end with a right slash but an empty string is also accepted for the root,
like <tt class="docutils literal"><span class="pre">(&quot;branches/1.5.x&quot;,</span> <span class="pre">&quot;&quot;)</span></tt> being converted from <tt class="docutils literal"><span class="pre">&quot;branches/1.5.x/&quot;</span></tt>.</p>
<p>The default value always returns <tt class="docutils literal"><span class="pre">(None,</span> <span class="pre">path)</span></tt>, which indicates that
all files are on the trunk.</p>
<p class="last">Subclasses of <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> can override the <tt class="xref py py-meth docutils literal"><span class="pre">split_file</span></tt>
method instead of using the <tt class="docutils literal"><span class="pre">split_file=</span></tt> argument.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">project</span></tt></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a>.  This
will then be set in any changes generated by the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a>, and
can be used in a <a class="reference internal" href="#change-filters"><em>Change Filter</em></a> for triggering
particular builders.</dd>
<dt><tt class="docutils literal"><span class="pre">svnuser</span></tt></dt>
<dd>An optional string parameter. If set, the <em class="xref std std-option">--user</em> argument will
be added to all <strong class="command">svn</strong> commands. Use this if you have to
authenticate to the svn server before you can do <strong class="command">svn info</strong> or
<strong class="command">svn log</strong> commands.</dd>
<dt><tt class="docutils literal"><span class="pre">svnpasswd</span></tt></dt>
<dd>Like <tt class="docutils literal"><span class="pre">svnuser</span></tt>, this will cause a <em class="xref std std-option">--password</em> argument to
be passed to all <strong class="command">svn</strong> commands.</dd>
<dt><tt class="docutils literal"><span class="pre">pollinterval</span></tt></dt>
<dd>How often to poll, in seconds. Defaults to 600 (checking once every 10
minutes). Lower this if you want the buildbot to notice changes
faster, raise it if you want to reduce the network and CPU load on
your svn server. Please be considerate of public SVN repositories by
using a large interval when polling them.</dd>
<dt><tt class="docutils literal"><span class="pre">histmax</span></tt></dt>
<dd>The maximum number of changes to inspect at a time. Every <tt class="docutils literal"><span class="pre">pollinterval</span></tt>
seconds, the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> asks for the last <tt class="docutils literal"><span class="pre">histmax</span></tt> changes and
looks through them for any revisions it does not already know about. If
more than <tt class="docutils literal"><span class="pre">histmax</span></tt> revisions have been committed since the last poll,
older changes will be silently ignored. Larger values of <tt class="docutils literal"><span class="pre">histmax</span></tt> will
cause more time and memory to be consumed on each poll attempt.
<tt class="docutils literal"><span class="pre">histmax</span></tt> defaults to 100.</dd>
<dt><tt class="docutils literal"><span class="pre">svnbin</span></tt></dt>
<dd>This controls the <strong class="command">svn</strong> executable to use. If subversion is
installed in a weird place on your system (outside of the
buildmaster's <span class="target" id="index-4"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt>), use this to tell <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> where
to find it. The default value of <cite>svn</cite> will almost always be
sufficient.</dd>
<dt><tt class="docutils literal"><span class="pre">revlinktmpl</span></tt></dt>
<dd>This parameter is deprecated in favour of specifying a global revlink option.
This parameter allows a link to be provided for each revision (for example,
to websvn or viewvc).  These links appear anywhere changes are shown, such
as on build or change pages.  The proper form for this parameter is an URL
with the portion that will substitute for a revision number replaced by
''%s''.  For example, <tt class="docutils literal"><span class="pre">'http://myserver/websvn/revision.php?rev=%s'</span></tt>
could be used to cause revision links to be created to a websvn repository
viewer.</dd>
<dt><tt class="docutils literal"><span class="pre">cachepath</span></tt></dt>
<dd>If specified, this is a pathname of a cache file that <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a>
will use to store its state between restarts of the master.</dd>
<dt><tt class="docutils literal"><span class="pre">extra_args</span></tt></dt>
<dd>If specified, the extra arguments will be added to the svn command args.</dd>
</dl>
<p>Several split file functions are available for common SVN repository layouts.
For a poller that is only monitoring trunk, the default split file function
is available explicitly as <tt class="docutils literal"><span class="pre">split_file_alwaystrunk</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">SVNPoller</span>
<span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">split_file_alwaystrunk</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;svn://svn.twistedmatrix.com/svn/Twisted/trunk&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">split_file_alwaystrunk</span><span class="p">)</span>
</pre></div>
</div>
<p>For repositories with the <tt class="docutils literal"><span class="pre">/trunk</span></tt> and
<tt class="docutils literal"><span class="pre">/branches/{BRANCH}</span></tt> layout, <tt class="docutils literal"><span class="pre">split_file_branches</span></tt> will do the
job:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">SVNPoller</span>
<span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">split_file_branches</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/amanda&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">split_file_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>When using this splitter the poller will set the <tt class="docutils literal"><span class="pre">project</span></tt> attribute of any
changes to the <tt class="docutils literal"><span class="pre">project</span></tt> attribute of the poller.</p>
<p>For repositories with the <tt class="docutils literal"><span class="pre">{PROJECT}/trunk</span></tt> and
<tt class="docutils literal"><span class="pre">{PROJECT}/branches/{BRANCH}</span></tt> layout, <tt class="docutils literal"><span class="pre">split_file_projects_branches</span></tt> will do
the job:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">SVNPoller</span>
<span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">split_file_projects_branches</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">split_file_projects_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>When using this splitter the poller will set the <tt class="docutils literal"><span class="pre">project</span></tt> attribute of any
changes to the project determined by the splitter.</p>
<p>The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> is highly adaptable to various Subversion layouts.
See <a class="reference internal" href="#customizing-svnpoller"><em>Customizing SVNPoller</em></a> for details and some common scenarios.</p>
</div>
<div class="section" id="bzr-poller">
<span id="chsrc-BzrPoller"></span><span id="id16"></span><h5>Bzr Poller<a class="headerlink" href="#bzr-poller" title="Permalink to this headline">¶</a></h5>
<p>If you cannot insert a Bzr hook in the server, you can use the Bzr Poller. To
use, put <tt class="file docutils literal"><span class="pre">contrib/bzr_buildbot.py</span></tt> somewhere that your buildbot
configuration can import it. Even putting it in the same directory as the <tt class="file docutils literal"><span class="pre">master.cfg</span></tt>
should work. Install the poller in the buildbot configuration as with any
other change source. Minimally, provide a URL that you want to poll (<tt class="docutils literal"><span class="pre">bzr://</span></tt>,
<tt class="docutils literal"><span class="pre">bzr+ssh://</span></tt>, or <tt class="docutils literal"><span class="pre">lp:</span></tt>), making sure the buildbot user has necessary
privileges.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># bzr_buildbot.py in the same directory as master.cfg</span>
<span class="kn">from</span> <span class="nn">bzr_buildbot</span> <span class="kn">import</span> <span class="n">BzrPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BzrPoller</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s">&#39;bzr://hostname/my_project&#39;</span><span class="p">,</span>
    <span class="n">poll_interval</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">BzrPoller</span></tt> parameters are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">url</span></tt></dt>
<dd>The URL to poll.</dd>
<dt><tt class="docutils literal"><span class="pre">poll_interval</span></tt></dt>
<dd>The number of seconds to wait between polls.  Defaults to 10 minutes.</dd>
<dt><tt class="docutils literal"><span class="pre">branch_name</span></tt></dt>
<dd>Any value to be used as the branch name. Defaults to None, or specify a
string, or specify the constants from <tt class="file docutils literal"><span class="pre">bzr_buildbot.py</span></tt>
<tt class="docutils literal"><span class="pre">SHORT</span></tt> or <tt class="docutils literal"><span class="pre">FULL</span></tt> to
get the short branch name or full branch address.</dd>
<dt><tt class="docutils literal"><span class="pre">blame_merge_author</span></tt></dt>
<dd>normally, the user that commits the revision is the user that is responsible
for the change. When run in a pqm (Patch Queue Manager, see
<a class="reference external" href="https://launchpad.net/pqm">https://launchpad.net/pqm</a>) environment, the user that commits is the Patch
Queue Manager, and the user that committed the merged, <em>parent</em> revision is
responsible for the change. set this value to <tt class="docutils literal"><span class="pre">True</span></tt> if this is pointed against
a PQM-managed branch.</dd>
</dl>
</div>
<div class="section" id="gitpoller">
<span id="chsrc-GitPoller"></span><span id="id17"></span><h5>GitPoller<a class="headerlink" href="#gitpoller" title="Permalink to this headline">¶</a></h5>
<p>If you cannot take advantage of post-receive hooks as provided by
<tt class="file docutils literal"><span class="pre">contrib/git_buildbot.py</span></tt> for example, then you can use the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></tt></a>.</p>
<p>The <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></tt></a> periodically fetches from a remote git repository and processes any changes.
It requires its own working directory for operation.
The default should be adequate, but it can be overridden via the <tt class="docutils literal"><span class="pre">workdir</span></tt> property.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There can only be a single <cite>GitPoller</cite> pointed at any given repository.</p>
</div>
<p>The <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></tt></a> requires git-1.7 and later.  It accepts the following
arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>the git-url that describes the remote repository, e.g.
<tt class="docutils literal"><span class="pre">git&#64;example.com:foobaz/myrepo.git</span></tt>
(see the <strong class="command">git fetch</strong> help for more info on git-url formats)</dd>
<dt><tt class="docutils literal"><span class="pre">branches</span></tt></dt>
<dd>a list of the branches to fetch, will default to <tt class="docutils literal"><span class="pre">['master']</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>accepts a single branch name to fetch.
Exists for backwards compatability with old configurations.</dd>
<dt><tt class="docutils literal"><span class="pre">pollinterval</span></tt></dt>
<dd>interval in seconds between polls, default is 10 minutes</dd>
<dt><tt class="docutils literal"><span class="pre">gitbin</span></tt></dt>
<dd>path to the git binary, defaults to just <tt class="docutils literal"><span class="pre">'git'</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">category</span></tt></dt>
<dd>Set the category to be used for the changes produced by the
<a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></tt></a>. This will then be set in any changes generated
by the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></tt></a>, and can be used in a Change Filter for
triggering particular builders.</dd>
<dt><tt class="docutils literal"><span class="pre">project</span></tt></dt>
<dd>Set the name of the project to be used for the
<a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></tt></a>. This will then be set in any changes generated
by the <tt class="docutils literal"><span class="pre">GitPoller</span></tt>, and can be used in a Change Filter for
triggering particular builders.</dd>
<dt><tt class="docutils literal"><span class="pre">usetimestamps</span></tt></dt>
<dd>parse each revision's commit timestamp (default is <tt class="docutils literal"><span class="pre">True</span></tt>),
or ignore it in favor of the current time (so recently processed
commits appear together in the waterfall page)</dd>
<dt><tt class="docutils literal"><span class="pre">encoding</span></tt></dt>
<dd>Set encoding will be used to parse author's name and commit
message. Default encoding is <tt class="docutils literal"><span class="pre">'utf-8'</span></tt>. This will not be
applied to file names since git will translate non-ascii file
names to unreadable escape sequences.</dd>
<dt><tt class="docutils literal"><span class="pre">workdir</span></tt></dt>
<dd>the directory where the poller should keep its local repository.
The default is <tt class="samp docutils literal"><span class="pre">gitpoller_work</span></tt>.
If this is a relative path, it will be interpreted relative to the master's basedir.
Multiple git pollers can share the same directory.</dd>
</dl>
<p>An configuration for the git poller might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.gitpoller</span> <span class="kn">import</span> <span class="n">GitPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GitPoller</span><span class="p">(</span><span class="s">&#39;git@example.com:foobaz/myrepo.git&#39;</span><span class="p">,</span>
                               <span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;master&#39;</span><span class="p">,</span> <span class="s">&#39;great_new_feature&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="hgpoller">
<span id="chsrc-HgPoller"></span><span id="id18"></span><h5>HgPoller<a class="headerlink" href="#hgpoller" title="Permalink to this headline">¶</a></h5>
<p>If you cannot take advantage of post-receive hooks as provided by
<tt class="file docutils literal"><span class="pre">buildbot/changes/hgbuildbot.py</span></tt> for example, then you can use the
<a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a>.</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a> periodically pulls a named branch from a remote
Mercurial repository and processes any changes. It requires its own working
directory for operation, which must be specified via the <tt class="docutils literal"><span class="pre">workdir</span></tt> property.</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a> requires a working <tt class="docutils literal"><span class="pre">hg</span></tt> executable, and at least a
read-only access to the repository it polls (possibly through ssh keys or by
tweaking the <tt class="docutils literal"><span class="pre">hgrc</span></tt> of the system user buildbot runs as).</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a> will not transmit any change if there are several heads
on the watched named branch. This is similar (although not identical) to the
Mercurial executable behaviour. This exceptional condition is usually the result
of a developer mistake, and usually does not last for long. It is reported in
logs. If fixed by a later merge, the buildmaster administrator does not have
anything to do: that merge will be transmitted, together with the intermediate
ones.</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>the url that describes the remote repository, e.g.
<tt class="docutils literal"><span class="pre">http://hg.example.com/projects/myrepo</span></tt>.
Any url suitable for <tt class="docutils literal"><span class="pre">hg</span> <span class="pre">pull</span></tt> can be specified.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>the desired branch to pull, will default to <tt class="docutils literal"><span class="pre">'default'</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">workdir</span></tt></dt>
<dd><p class="first">the directory where the poller should keep its local repository. It
is mandatory for now, although later releases may provide a meaningful
default.</p>
<p>It also serves to identify the poller in the buildmaster internal
database. Changing it may result in re-processing all changes so far.</p>
<p>Several <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a> instances may share the same <tt class="docutils literal"><span class="pre">workdir</span></tt> for
mutualisation of the common history between two different branches, thus
easing on local and remote system resources and bandwith.</p>
<p class="last">If relative, the <tt class="docutils literal"><span class="pre">workdir</span></tt> will be interpreted from the master directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">pollinterval</span></tt></dt>
<dd>interval in seconds between polls, default is 10 minutes</dd>
<dt><tt class="docutils literal"><span class="pre">hgbin</span></tt></dt>
<dd>path to the Mercurial binary, defaults to just <tt class="docutils literal"><span class="pre">'hg'</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">category</span></tt></dt>
<dd>Set the category to be used for the changes produced by the
<a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a>. This will then be set in any changes generated
by the <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a>, and can be used in a Change Filter for
triggering particular builders.</dd>
<dt><tt class="docutils literal"><span class="pre">project</span></tt></dt>
<dd>Set the name of the project to be used for the
<a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a>. This will then be set in any changes generated
by the <tt class="docutils literal"><span class="pre">HgPoller</span></tt>, and can be used in a Change Filter for
triggering particular builders.</dd>
<dt><tt class="docutils literal"><span class="pre">usetimestamps</span></tt></dt>
<dd>parse each revision's commit timestamp (default is <tt class="docutils literal"><span class="pre">True</span></tt>),
or ignore it in favor of the current time (so recently processed
commits appear together in the waterfall page)</dd>
<dt><tt class="docutils literal"><span class="pre">encoding</span></tt></dt>
<dd>Set encoding will be used to parse author's name and commit
message. Default encoding is <tt class="docutils literal"><span class="pre">'utf-8'</span></tt>.</dd>
</dl>
<p>A configuration for the Mercurial poller might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.hgpoller</span> <span class="kn">import</span> <span class="n">HgPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">HgPoller</span><span class="p">(</span><span class="s">&#39;http://hg.example.org/projects/myrepo&#39;</span><span class="p">,</span>
                               <span class="n">branch</span><span class="o">=</span><span class="s">&#39;great_new_feature&#39;</span><span class="p">,</span>
                               <span class="n">workdir</span><span class="o">=</span><span class="s">&#39;hg-myrepo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="gerritchangesource">
<span id="chsrc-GerritChangeSource"></span><span id="id19"></span><h5>GerritChangeSource<a class="headerlink" href="#gerritchangesource" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.gerritchangesource.GerritChangeSource">
<em class="property">class </em><tt class="descclassname">buildbot.changes.gerritchangesource.</tt><tt class="descname">GerritChangeSource</tt><a class="headerlink" href="#buildbot.changes.gerritchangesource.GerritChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></tt></a> class connects to a Gerrit server by its SSH
interface and uses its event source mechanism,
<a class="reference external" href="http://gerrit.googlecode.com/svn/documentation/2.1.6/cmd-stream-events.html">gerrit stream-events</a>.</p>
<p>This class adds a change to the buildbot system for each of the following events:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">patchset-created</span></tt></dt>
<dd>A change is proposed for review. Automatic checks like
<tt class="file docutils literal"><span class="pre">checkpatch.pl</span></tt> can be automatically triggered. Beware of
what kind of automatic task you trigger. At this point, no trusted
human has reviewed the code, and a patch could be specially
crafted by an attacker to compromise your buildslaves.</dd>
<dt><tt class="docutils literal"><span class="pre">ref-updated</span></tt></dt>
<dd>A change has been merged into the repository. Typically, this kind
of event can lead to a complete rebuild of the project, and upload
binaries to an incremental build results server.</dd>
</dl>
<p>This class will populate the property list of the triggered build with the info
received from Gerrit server in JSON format.</p>
<p id="index-5">In case of <tt class="docutils literal"><span class="pre">patchset-created</span></tt> event, these properties will be:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">event.change.branch</span></tt></dt>
<dd>Branch of the Change</dd>
<dt><tt class="docutils literal"><span class="pre">event.change.id</span></tt></dt>
<dd>Change's ID in the Gerrit system (the ChangeId: in commit comments)</dd>
<dt><tt class="docutils literal"><span class="pre">event.change.number</span></tt></dt>
<dd>Change's number in Gerrit system</dd>
<dt><tt class="docutils literal"><span class="pre">event.change.owner.email</span></tt></dt>
<dd>Change's owner email (owner is first uploader)</dd>
<dt><tt class="docutils literal"><span class="pre">event.change.owner.name</span></tt></dt>
<dd>Change's owner name</dd>
<dt><tt class="docutils literal"><span class="pre">event.change.project</span></tt></dt>
<dd>Project of the Change</dd>
<dt><tt class="docutils literal"><span class="pre">event.change.subject</span></tt></dt>
<dd>Change's subject</dd>
<dt><tt class="docutils literal"><span class="pre">event.change.url</span></tt></dt>
<dd>URL of the Change in the Gerrit's web interface</dd>
<dt><tt class="docutils literal"><span class="pre">event.patchSet.number</span></tt></dt>
<dd>Patchset's version number</dd>
<dt><tt class="docutils literal"><span class="pre">event.patchSet.ref</span></tt></dt>
<dd>Patchset's Gerrit &quot;virtual branch&quot;</dd>
<dt><tt class="docutils literal"><span class="pre">event.patchSet.revision</span></tt></dt>
<dd>Patchset's Git commit ID</dd>
<dt><tt class="docutils literal"><span class="pre">event.patchSet.uploader.email</span></tt></dt>
<dd>Patchset uploader's email (owner is first uploader)</dd>
<dt><tt class="docutils literal"><span class="pre">event.patchSet.uploader.name</span></tt></dt>
<dd>Patchset uploader's name (owner is first uploader)</dd>
<dt><tt class="docutils literal"><span class="pre">event.type</span></tt></dt>
<dd>Event type (<tt class="docutils literal"><span class="pre">patchset-created</span></tt>)</dd>
<dt><tt class="docutils literal"><span class="pre">event.uploader.email</span></tt></dt>
<dd>Patchset uploader's email</dd>
<dt><tt class="docutils literal"><span class="pre">event.uploader.name</span></tt></dt>
<dd>Patchset uploader's name</dd>
</dl>
<p>In case of <tt class="docutils literal"><span class="pre">ref-updated</span></tt> event, these properties will be:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">event.refUpdate.newRev</span></tt></dt>
<dd>New Git commit ID (after merger)</dd>
<dt><tt class="docutils literal"><span class="pre">event.refUpdate.oldRev</span></tt></dt>
<dd>Previous Git commit ID (before merger)</dd>
<dt><tt class="docutils literal"><span class="pre">event.refUpdate.project</span></tt></dt>
<dd>Project that was updated</dd>
<dt><tt class="docutils literal"><span class="pre">event.refUpdate.refName</span></tt></dt>
<dd>Branch that was updated</dd>
<dt><tt class="docutils literal"><span class="pre">event.submitter.email</span></tt></dt>
<dd>Submitter's email (merger responsible)</dd>
<dt><tt class="docutils literal"><span class="pre">event.submitter.name</span></tt></dt>
<dd>Submitter's name (merger responsible)</dd>
<dt><tt class="docutils literal"><span class="pre">event.type</span></tt></dt>
<dd>Event type (<tt class="docutils literal"><span class="pre">ref-updated</span></tt>)</dd>
<dt><tt class="docutils literal"><span class="pre">event.submitter.email</span></tt></dt>
<dd>Submitter's email (merger responsible)</dd>
<dt><tt class="docutils literal"><span class="pre">event.submitter.name</span></tt></dt>
<dd>Submitter's name (merger responsible)</dd>
</dl>
<p>A configuration for this source might look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.gerritchangesource</span> <span class="kn">import</span> <span class="n">GerritChangeSource</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GerritChangeSource</span><span class="p">(</span><span class="n">gerrit_server</span><span class="p">,</span> <span class="n">gerrit_user</span><span class="p">)</span>
</pre></div>
</div>
<p>see <tt class="file docutils literal"><span class="pre">master/docs/examples/repo_gerrit.cfg</span></tt> in the Buildbot distribution
for a full example setup of <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></tt></a>.</p>
</div>
<div class="section" id="change-hooks-http-notifications">
<span id="chsrc-Change Hooks"></span><span id="id20"></span><h5>Change Hooks (HTTP Notifications)<a class="headerlink" href="#change-hooks-http-notifications" title="Permalink to this headline">¶</a></h5>
<p>Buildbot already provides a web frontend, and that frontend can easily be used
to receive HTTP push notifications of commits from services like GitHub or
GoogleCode. See <a class="reference internal" href="#change-hooks"><em>Change Hooks</em></a> for more information.</p>
</div>
<div class="section" id="googlecodeatompoller">
<span id="chsrc-GoogleCodeAtomPoller"></span><span id="id21"></span><h5>GoogleCodeAtomPoller<a class="headerlink" href="#googlecodeatompoller" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference internal" href="#chsrc-GoogleCodeAtomPoller" title="GoogleCodeAtomPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GoogleCodeAtomPoller</span></tt></a> periodically polls a Google Code Project's
commit feed for changes. Works on SVN, Git, and Mercurial repositories. Branches
are not understood (yet). It accepts the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">feedurl</span></tt></dt>
<dd>The commit Atom feed URL of the GoogleCode repository (MANDATORY)</dd>
<dt><tt class="docutils literal"><span class="pre">pollinterval</span></tt></dt>
<dd>Polling frequency for the feed (in seconds). Default is 1 hour (OPTIONAL)</dd>
</dl>
<p>As an example, to poll the Ostinato project's commit feed every 3 hours, the
configuration would look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">googlecode_atom</span> <span class="kn">import</span> <span class="n">GoogleCodeAtomPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GoogleCodeAtomPoller</span><span class="p">(</span>
    <span class="n">feedurl</span><span class="o">=</span><span class="s">&quot;http://code.google.com/feeds/p/ostinato/hgchanges/basic&quot;</span><span class="p">,</span>
    <span class="n">pollinterval</span><span class="o">=</span><span class="mi">10800</span><span class="p">)</span>
</pre></div>
</div>
<p>(note that you will need to download <tt class="docutils literal"><span class="pre">googlecode_atom.py</span></tt> from the Buildbot
source and install it somewhere on your PYTHONPATH first)</p>
</div>
</div>
<span id="document-manual/cfg-schedulers"></span><div class="section" id="schedulers">
<span id="id1"></span><h4>Schedulers<a class="headerlink" href="#schedulers" title="Permalink to this headline">¶</a></h4>
<p>Schedulers are responsible for initiating builds on builders.</p>
<p>Some schedulers listen for changes from ChangeSources and generate build sets
in response to these changes.  Others generate build sets without changes,
based on other events in the buildmaster.</p>
<div class="section" id="configuring-schedulers">
<span id="id2"></span><h5>Configuring Schedulers<a class="headerlink" href="#configuring-schedulers" title="Permalink to this headline">¶</a></h5>
<p id="cfg-schedulers">The <a class="reference internal" href="#cfg-schedulers" title="schedulers"><tt class="xref bb bb-cfg docutils literal"><span class="pre">schedulers</span></tt></a> configuration parameter gives a list of Scheduler
instances, each of which causes builds to be started on a particular set of
Builders. The two basic Scheduler classes you are likely to start with are
<tt class="xref py py-class docutils literal"><span class="pre">SingleBranchScheduler</span></tt> and <tt class="xref py py-class docutils literal"><span class="pre">Periodic</span></tt>, but you can write a
customized subclass to implement more complicated build scheduling.</p>
<p>Scheduler arguments should always be specified by name (as keyword arguments),
to allow for future expansion:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sched</span> <span class="o">=</span> <span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;quick&quot;</span><span class="p">,</span> <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;lin&#39;</span><span class="p">,</span> <span class="s">&#39;win&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>There are several common arguments for schedulers, although not all are
available with all schedulers.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd>Each Scheduler must have a unique name. This is used in status
displays, and is also available in the build property <tt class="docutils literal"><span class="pre">scheduler</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">builderNames</span></tt></dt>
<dd>This is the set of builders which this scheduler should trigger, specified
as a list of names (strings).</dd>
</dl>
<dl class="docutils" id="index-0">
<dt><tt class="docutils literal"><span class="pre">properties</span></tt></dt>
<dd><p class="first">This is a dictionary specifying properties that will be transmitted to all
builds started by this scheduler.  The <tt class="docutils literal"><span class="pre">owner</span></tt> property may be of
particular interest, as its contents (as a list) will be added to the list of
&quot;interested users&quot; (<a class="reference internal" href="#doing-things-with-users"><em>Doing Things With Users</em></a>) for each triggered build.
For example</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">sched</span> <span class="o">=</span> <span class="n">Scheduler</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;owner&#39;</span> <span class="p">:</span> <span class="p">[</span> <span class="s">&#39;zorro@company.com&#39;</span><span class="p">,</span> <span class="s">&#39;silver@company.com&#39;</span> <span class="p">]</span> <span class="p">})</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">fileIsImportant</span></tt></dt>
<dd>A callable which takes one argument, a Change instance, and
returns <tt class="docutils literal"><span class="pre">True</span></tt> if the change is worth building, and <tt class="docutils literal"><span class="pre">False</span></tt> if
it is not.  Unimportant Changes are accumulated until the build is
triggered by an important change.  The default value of None means
that all Changes are important.</dd>
<dt><tt class="docutils literal"><span class="pre">change_filter</span></tt></dt>
<dd>The change filter that will determine which changes are recognized
by this scheduler; <a class="reference internal" href="#change-filters"><em>Change Filters</em></a>.  Note that this is
different from <tt class="docutils literal"><span class="pre">fileIsImportant</span></tt>: if the change filter filters
out a Change, then it is completely ignored by the scheduler.  If
a Change is allowed by the change filter, but is deemed
unimportant, then it will not cause builds to start, but will be
remembered and shown in status displays.</dd>
<dt><tt class="docutils literal"><span class="pre">codebases</span></tt></dt>
<dd><p class="first">When the scheduler processes data from more than 1 repository at the
same time then a corresponding codebase definition should be passed for each
repository. A codebase definition is a dictionary with one or more of the
following keys: repository, branch, revision. The codebase definitions have
also to be passed as dictionary.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">codebases</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;codebase1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;repository&#39;</span><span class="p">:</span><span class="s">&#39;....&#39;</span><span class="p">,</span>
                           <span class="s">&#39;branch&#39;</span><span class="p">:</span><span class="s">&#39;default&#39;</span><span class="p">,</span>
                           <span class="s">&#39;revision&#39;</span><span class="p">:</span> <span class="bp">None</span><span class="p">},</span>
             <span class="s">&#39;codebase2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;repository&#39;</span><span class="p">:</span><span class="s">&#39;....&#39;</span><span class="p">}</span> <span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><tt class="docutils literal"><span class="pre">codebases</span></tt> behaves also like a change_filter on codebase.
The scheduler will only process changes  when their codebases are found
in <tt class="docutils literal"><span class="pre">codebases</span></tt>. By default <tt class="docutils literal"><span class="pre">codebases</span></tt> is set to <tt class="docutils literal"><span class="pre">{'':{}}</span></tt> which
means that only changes with codebase '' (default value for codebase)
will be accepted by the scheduler.</p>
</div>
<p class="last">Buildsteps can have a reference to one of the codebases. The step will only
get information (revision, branch etc.)  that is related to that codebase.
When a scheduler is triggered by new changes, these changes (having a
codebase) will be incorporated by the new build. The buildsteps referencing
to the codebases that have changes get information about those changes.
The buildstep that references to a codebase that does not have changes in
the build get the information from the codebases definition as configured in
the scheduler.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">onlyImportant</span></tt></dt>
<dd>A boolean that, when <tt class="docutils literal"><span class="pre">True</span></tt>, only adds important changes to the
buildset as specified in the <tt class="docutils literal"><span class="pre">fileIsImportant</span></tt> callable. This
means that unimportant changes are ignored the same way a
<tt class="docutils literal"><span class="pre">change_filter</span></tt> filters changes. This defaults to
<tt class="docutils literal"><span class="pre">False</span></tt> and only applies when <tt class="docutils literal"><span class="pre">fileIsImportant</span></tt> is
given.</dd>
</dl>
<p>The remaining subsections represent a catalog of the available Scheduler types.
All these Schedulers are defined in modules under <tt class="xref py py-mod docutils literal"><span class="pre">buildbot.schedulers</span></tt>,
and the docstrings there are the best source of documentation on the arguments
taken by each one.</p>
</div>
<div class="section" id="change-filters">
<span id="id3"></span><h5>Change Filters<a class="headerlink" href="#change-filters" title="Permalink to this headline">¶</a></h5>
<p>Several schedulers perform filtering on an incoming set of changes.  The filter
can most generically be specified as a <tt class="xref py py-class docutils literal"><span class="pre">ChangeFilter</span></tt>.  Set up a
<tt class="xref py py-class docutils literal"><span class="pre">ChangeFilter</span></tt> like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.filter</span> <span class="kn">import</span> <span class="n">ChangeFilter</span>
<span class="n">my_filter</span> <span class="o">=</span> <span class="n">ChangeFilter</span><span class="p">(</span>
    <span class="n">project_re</span><span class="o">=</span><span class="s">&quot;^baseproduct/.*&quot;</span><span class="p">,</span>
    <span class="n">branch</span><span class="o">=</span><span class="s">&quot;devel&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>and then add it to a scheduler with the <tt class="docutils literal"><span class="pre">change_filter</span></tt> parameter:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">sch</span> <span class="o">=</span> <span class="n">SomeSchedulerClass</span><span class="p">(</span><span class="o">...</span><span class="p">,</span>
    <span class="n">change_filter</span><span class="o">=</span><span class="n">my_filter</span><span class="p">)</span>
</pre></div>
</div>
<p>There are five attributes of changes on which you can filter:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">project</span></tt></dt>
<dd>the project string, as defined by the ChangeSource.</dd>
<dt><tt class="docutils literal"><span class="pre">repository</span></tt></dt>
<dd>the repository in which this change occurred.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>the branch on which this change occurred.  Note that 'trunk' or 'master' is often
denoted by <tt class="docutils literal"><span class="pre">None</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">category</span></tt></dt>
<dd>the category, again as defined by the ChangeSource.</dd>
<dt><tt class="docutils literal"><span class="pre">codebase</span></tt></dt>
<dd>the change's codebase.</dd>
</dl>
<p>For each attribute, the filter can look for a single, specific value:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_filter</span> <span class="o">=</span> <span class="n">ChangeFilter</span><span class="p">(</span><span class="n">project</span> <span class="o">=</span> <span class="s">&#39;myproject&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>or accept any of a set of values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_filter</span> <span class="o">=</span> <span class="n">ChangeFilter</span><span class="p">(</span><span class="n">project</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;myproject&#39;</span><span class="p">,</span> <span class="s">&#39;jimsproject&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>or apply a regular expression, using the attribute name with a &quot;<tt class="docutils literal"><span class="pre">_re</span></tt>&quot;
suffix:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_filter</span> <span class="o">=</span> <span class="n">ChangeFilter</span><span class="p">(</span><span class="n">category_re</span> <span class="o">=</span> <span class="s">&#39;.*deve.*&#39;</span><span class="p">)</span>
<span class="c"># or, to use regular expression flags:</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="n">my_filter</span> <span class="o">=</span> <span class="n">ChangeFilter</span><span class="p">(</span><span class="n">category_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;.*deve.*&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">))</span>
</pre></div>
</div>
<p>For anything more complicated, define a Python function to recognize the strings
you want:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">my_branch_fn</span><span class="p">(</span><span class="n">branch</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">branches_to_build</span> <span class="ow">and</span> <span class="n">branch</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">branches_to_ignore</span>
<span class="n">my_filter</span> <span class="o">=</span> <span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch_fn</span> <span class="o">=</span> <span class="n">my_branch_fn</span><span class="p">)</span>
</pre></div>
</div>
<p>The special argument <tt class="docutils literal"><span class="pre">filter_fn</span></tt> can be used to specify a function that is
given the entire Change object, and returns a boolean.</p>
<p>The entire set of allowed arguments, then, is</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="36%" />
<col width="36%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>project</td>
<td>project_re</td>
<td>project_fn</td>
</tr>
<tr class="row-even"><td>repository</td>
<td>repository_re</td>
<td>repository_fn</td>
</tr>
<tr class="row-odd"><td>branch</td>
<td>branch_re</td>
<td>branch_fn</td>
</tr>
<tr class="row-even"><td>category</td>
<td>category_re</td>
<td>category_fn</td>
</tr>
<tr class="row-odd"><td>codebase</td>
<td>codebase_re</td>
<td>codebase_fn</td>
</tr>
<tr class="row-even"><td colspan="3">filter_fn</td>
</tr>
</tbody>
</table>
<p>A Change passes the filter only if <em>all</em> arguments are satisfied.  If no
filter object is given to a scheduler, then all changes will be built (subject
to any other restrictions the scheduler enforces).</p>
<span class="target" id="sched-SingleBranchScheduler"></span></div>
<div class="section" id="singlebranchscheduler">
<span id="scheduler-singlebranchscheduler"></span><span id="sched-Scheduler"></span><h5>SingleBranchScheduler<a class="headerlink" href="#singlebranchscheduler" title="Permalink to this headline">¶</a></h5>
<p>This is the original and still most popular scheduler class. It follows
exactly one branch, and starts a configurable tree-stable-timer after
each change on that branch. When the timer expires, it starts a build
on some set of Builders. The Scheduler accepts a <tt class="xref py py-meth docutils literal"><span class="pre">fileIsImportant</span></tt>
function which can be used to ignore some Changes if they do not
affect any <em>important</em> files.</p>
<p>The arguments to this scheduler are:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">builderNames</span></tt></p>
<p><tt class="docutils literal"><span class="pre">properties</span></tt></p>
<p><tt class="docutils literal"><span class="pre">fileIsImportant</span></tt></p>
<p><tt class="docutils literal"><span class="pre">change_filter</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">onlyImportant</span></tt></dt>
<dd>See <a class="reference internal" href="#configuring-schedulers"><em>Configuring Schedulers</em></a>.</dd>
<dt><tt class="docutils literal"><span class="pre">treeStableTimer</span></tt></dt>
<dd><p class="first">The scheduler will wait for this many seconds before starting the
build. If new changes are made during this interval, the timer will be
restarted, so really the build will be started after a change and then
after this many seconds of inactivity.</p>
<p class="last">If <tt class="docutils literal"><span class="pre">treeStableTimer</span></tt> is <tt class="docutils literal"><span class="pre">None</span></tt>, then a separate build is started
immediately for each Change.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">fileIsImportant</span></tt></dt>
<dd>A callable which takes one argument, a Change instance, and returns
<tt class="docutils literal"><span class="pre">True</span></tt> if the change is worth building, and <tt class="docutils literal"><span class="pre">False</span></tt> if
it is not.  Unimportant Changes are accumulated until the build is
triggered by an important change.  The default value of None means
that all Changes are important.</dd>
<dt><tt class="docutils literal"><span class="pre">categories</span></tt> (deprecated; use change_filter)</dt>
<dd>A list of categories of changes that this scheduler will respond to.  If this
is specified, then any non-matching changes are ignored.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt> (deprecated; use change_filter)</dt>
<dd><p class="first">The scheduler will pay attention to this branch, ignoring Changes
that occur on other branches. Setting <tt class="docutils literal"><span class="pre">branch</span></tt> equal to the
special value of <tt class="docutils literal"><span class="pre">None</span></tt> means it should only pay attention to
the default branch.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal"><span class="pre">None</span></tt> is a keyword, not a string, so write <tt class="docutils literal"><span class="pre">None</span></tt>
and not <tt class="docutils literal"><span class="pre">&quot;None&quot;</span></tt>.</p>
</div>
</dd>
</dl>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers.basic</span>  <span class="kn">import</span> <span class="n">SingleBranchScheduler</span>
<span class="kn">from</span> <span class="nn">buildbot.changes</span> <span class="kn">import</span> <span class="nb">filter</span>
<span class="n">quick</span> <span class="o">=</span> <span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;quick&quot;</span><span class="p">,</span>
                    <span class="n">change_filter</span><span class="o">=</span><span class="nb">filter</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="s">&#39;master&#39;</span><span class="p">),</span>
                    <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
                    <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;quick-linux&quot;</span><span class="p">,</span> <span class="s">&quot;quick-netbsd&quot;</span><span class="p">])</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;full&quot;</span><span class="p">,</span>
                    <span class="n">change_filter</span><span class="o">=</span><span class="nb">filter</span><span class="o">.</span><span class="n">ChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="s">&#39;master&#39;</span><span class="p">),</span>
                    <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                    <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;full-linux&quot;</span><span class="p">,</span> <span class="s">&quot;full-netbsd&quot;</span><span class="p">,</span> <span class="s">&quot;full-OSX&quot;</span><span class="p">])</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">quick</span><span class="p">,</span> <span class="n">full</span><span class="p">]</span>
</pre></div>
</div>
<p>In this example, the two <em>quick</em> builders are triggered 60 seconds
after the tree has been changed. The <em>full</em> builds do not run quite
so quickly (they wait 5 minutes), so hopefully if the quick builds
fail due to a missing file or really simple typo, the developer can
discover and fix the problem before the full builds are started. Both
Schedulers only pay attention to the default branch: any changes
on other branches are ignored by these schedulers. Each scheduler
triggers a different set of Builders, referenced by name.</p>
<p>The old names for this scheduler, <tt class="docutils literal"><span class="pre">buildbot.scheduler.Scheduler</span></tt> and
<tt class="docutils literal"><span class="pre">buildbot.schedulers.basic.Scheduler</span></tt>, are deprecated in favor of the more
accurate name <tt class="docutils literal"><span class="pre">buildbot.schedulers.basic.SingleBranchScheduler</span></tt>.</p>
</div>
<div class="section" id="anybranchscheduler">
<span id="sched-AnyBranchScheduler"></span><span id="id4"></span><h5>AnyBranchScheduler<a class="headerlink" href="#anybranchscheduler" title="Permalink to this headline">¶</a></h5>
<p>This scheduler uses a tree-stable-timer like the default one, but
uses a separate timer for each branch.</p>
<p>The arguments to this scheduler are:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">builderNames</span></tt></p>
<p><tt class="docutils literal"><span class="pre">properties</span></tt></p>
<p><tt class="docutils literal"><span class="pre">fileIsImportant</span></tt></p>
<p><tt class="docutils literal"><span class="pre">change_filter</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">onlyImportant</span></tt></dt>
<dd>See <a class="reference internal" href="#configuring-schedulers"><em>Configuring Schedulers</em></a>.</dd>
<dt><tt class="docutils literal"><span class="pre">treeStableTimer</span></tt></dt>
<dd>The scheduler will wait for this many seconds before starting the build. If
new changes are made <em>on the same branch</em> during this interval, the timer
will be restarted.</dd>
<dt><tt class="docutils literal"><span class="pre">branches</span></tt> (deprecated; use change_filter)</dt>
<dd>Changes on branches not specified on this list will be ignored.</dd>
<dt><tt class="docutils literal"><span class="pre">categories</span></tt> (deprecated; use change_filter)</dt>
<dd>A list of categories of changes that this scheduler will respond to.  If this
is specified, then any non-matching changes are ignored.</dd>
</dl>
</div>
<div class="section" id="dependent-scheduler">
<span id="sched-Dependent"></span><span id="id5"></span><h5>Dependent Scheduler<a class="headerlink" href="#dependent-scheduler" title="Permalink to this headline">¶</a></h5>
<p>It is common to wind up with one kind of build which should only be
performed if the same source code was successfully handled by some
other kind of build first. An example might be a packaging step: you
might only want to produce .deb or RPM packages from a tree that was
known to compile successfully and pass all unit tests. You could put
the packaging step in the same Build as the compile and testing steps,
but there might be other reasons to not do this (in particular you
might have several Builders worth of compiles/tests, but only wish to
do the packaging once). Another example is if you want to skip the
<em>full</em> builds after a failing <em>quick</em> build of the same source
code. Or, if one Build creates a product (like a compiled library)
that is used by some other Builder, you'd want to make sure the
consuming Build is run <em>after</em> the producing one.</p>
<p>You can use <em>Dependencies</em> to express this relationship
to the Buildbot. There is a special kind of scheduler named
<tt class="xref py py-class docutils literal"><span class="pre">scheduler.Dependent</span></tt> that will watch an <em>upstream</em> scheduler
for builds to complete successfully (on all of its Builders). Each time
that happens, the same source code (i.e. the same <tt class="docutils literal"><span class="pre">SourceStamp</span></tt>)
will be used to start a new set of builds, on a different set of
Builders. This <em>downstream</em> scheduler doesn't pay attention to
Changes at all. It only pays attention to the upstream scheduler.</p>
<p>If the build fails on any of the Builders in the upstream set,
the downstream builds will not fire.  Note that, for SourceStamps
generated by a ChangeSource, the <tt class="docutils literal"><span class="pre">revision</span></tt> is <tt class="docutils literal"><span class="pre">None</span></tt>, meaning HEAD.
If any changes are committed between the time the upstream scheduler
begins its build and the time the dependent scheduler begins its
build, then those changes will be included in the downstream build.
See the <a class="reference internal" href="#triggerable-scheduler"><em>Triggerable Scheduler</em></a> for a more flexible dependency
mechanism that can avoid this problem.</p>
<p>The keyword arguments to this scheduler are:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">builderNames</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">properties</span></tt></dt>
<dd>See <a class="reference internal" href="#configuring-schedulers"><em>Configuring Schedulers</em></a>.</dd>
<dt><tt class="docutils literal"><span class="pre">upstream</span></tt></dt>
<dd>The upstream scheduler to watch.  Note that this is an <em>instance</em>,
not the name of the scheduler.</dd>
</dl>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers</span> <span class="kn">import</span> <span class="n">basic</span>
<span class="n">tests</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;just-tests&quot;</span><span class="p">,</span>
                        <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;full-linux&quot;</span><span class="p">,</span> <span class="s">&quot;full-netbsd&quot;</span><span class="p">,</span> <span class="s">&quot;full-OSX&quot;</span><span class="p">])</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">Dependent</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;build-package&quot;</span><span class="p">,</span>
                        <span class="n">upstream</span><span class="o">=</span><span class="n">tests</span><span class="p">,</span> <span class="c"># &lt;- no quotes!</span>
                        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make-tarball&quot;</span><span class="p">,</span> <span class="s">&quot;make-deb&quot;</span><span class="p">,</span> <span class="s">&quot;make-rpm&quot;</span><span class="p">])</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">tests</span><span class="p">,</span> <span class="n">package</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="periodic-scheduler">
<span id="sched-Periodic"></span><span id="id6"></span><h5>Periodic Scheduler<a class="headerlink" href="#periodic-scheduler" title="Permalink to this headline">¶</a></h5>
<p>This simple scheduler just triggers a build every <em>N</em> seconds.</p>
<p>The arguments to this scheduler are:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">builderNames</span></tt></p>
<p><tt class="docutils literal"><span class="pre">properties</span></tt></p>
<p><tt class="docutils literal"><span class="pre">onlyImportant</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">periodicBuildTimer</span></tt></dt>
<dd>The time, in seconds, after which to start a build.</dd>
</dl>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers</span> <span class="kn">import</span> <span class="n">timed</span>
<span class="n">nightly</span> <span class="o">=</span> <span class="n">timed</span><span class="o">.</span><span class="n">Periodic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;daily&quot;</span><span class="p">,</span>
                <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;full-solaris&quot;</span><span class="p">],</span>
                <span class="n">periodicBuildTimer</span><span class="o">=</span><span class="mi">24</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nightly</span><span class="p">]</span>
</pre></div>
</div>
<p>The scheduler in this example just runs the full solaris build once
per day. Note that this scheduler only lets you control the time
between builds, not the absolute time-of-day of each Build, so this
could easily wind up an <em>evening</em> or <em>every afternoon</em> scheduler
depending upon when it was first activated.</p>
</div>
<div class="section" id="nightly-scheduler">
<span id="sched-Nightly"></span><span id="id7"></span><h5>Nightly Scheduler<a class="headerlink" href="#nightly-scheduler" title="Permalink to this headline">¶</a></h5>
<p>This is highly configurable periodic build scheduler, which triggers
a build at particular times of day, week, month, or year. The
configuration syntax is very similar to the well-known <tt class="docutils literal"><span class="pre">crontab</span></tt>
format, in which you provide values for minute, hour, day, and month
(some of which can be wildcards), and a build is triggered whenever
the current time matches the given constraints. This can run a build
every night, every morning, every weekend, alternate Thursdays,
on your boss's birthday, etc.</p>
<p>Pass some subset of <tt class="docutils literal"><span class="pre">minute</span></tt>, <tt class="docutils literal"><span class="pre">hour</span></tt>, <tt class="docutils literal"><span class="pre">dayOfMonth</span></tt>,
<tt class="docutils literal"><span class="pre">month</span></tt>, and <tt class="docutils literal"><span class="pre">dayOfWeek</span></tt>; each may be a single number or
a list of valid values. The builds will be triggered whenever the
current time matches these values. Wildcards are represented by a
'*' string. All fields default to a wildcard except 'minute', so
with no fields this defaults to a build every hour, on the hour.
The full list of parameters is:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">builderNames</span></tt></p>
<p><tt class="docutils literal"><span class="pre">properties</span></tt></p>
<p><tt class="docutils literal"><span class="pre">fileIsImportant</span></tt></p>
<p><tt class="docutils literal"><span class="pre">change_filter</span></tt></p>
<p><tt class="docutils literal"><span class="pre">onlyImportant</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">codebases</span></tt></dt>
<dd>See <a class="reference internal" href="#configuring-schedulers"><em>Configuring Schedulers</em></a>.  Note that <tt class="docutils literal"><span class="pre">fileIsImportant</span></tt> and
<tt class="docutils literal"><span class="pre">change_filter</span></tt> are only relevant if <tt class="docutils literal"><span class="pre">onlyIfChanged</span></tt> is
<tt class="docutils literal"><span class="pre">True</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">onlyIfChanged</span></tt></dt>
<dd>If this is true, then builds will not be scheduled at the designated time
<em>unless</em> the specified branch has seen an important change since
the previous build.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>(required) The branch to build when the time comes.  Remember that
a value of <tt class="docutils literal"><span class="pre">None</span></tt> here means the default branch, and will not
match other branches!</dd>
<dt><tt class="docutils literal"><span class="pre">minute</span></tt></dt>
<dd>The minute of the hour on which to start the build.  This defaults
to 0, meaning an hourly build.</dd>
<dt><tt class="docutils literal"><span class="pre">hour</span></tt></dt>
<dd>The hour of the day on which to start the build, in 24-hour notation.
This defaults to *, meaning every hour.</dd>
<dt><tt class="docutils literal"><span class="pre">dayOfMonth</span></tt></dt>
<dd>The day of the month to start a build.  This defaults to <tt class="docutils literal"><span class="pre">*</span></tt>, meaning
every day.</dd>
<dt><tt class="docutils literal"><span class="pre">month</span></tt></dt>
<dd>The month in which to start the build, with January = 1.  This defaults
to *, meaning every month.</dd>
<dt><tt class="docutils literal"><span class="pre">dayOfWeek</span></tt></dt>
<dd>The day of the week to start a build, with Monday = 0.  This defaults
to *, meaning every day of the week.</dd>
</dl>
<p>For example, the following master.cfg clause will cause a build to be
started every night at 3:00am:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers</span> <span class="kn">import</span> <span class="n">timed</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">timed</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;nightly&#39;</span><span class="p">,</span>
        <span class="n">branch</span><span class="o">=</span><span class="s">&#39;master&#39;</span><span class="p">,</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;builder1&#39;</span><span class="p">,</span> <span class="s">&#39;builder2&#39;</span><span class="p">],</span>
        <span class="n">hour</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<p>This scheduler will perform a build each Monday morning at 6:23am and
again at 8:23am, but only if someone has committed code in the interim:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">timed</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;BeforeWork&#39;</span><span class="p">,</span>
         <span class="n">branch</span><span class="o">=</span><span class="sb">`default`</span><span class="p">,</span>
         <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;builder1&#39;</span><span class="p">],</span>
         <span class="n">dayOfWeek</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
         <span class="n">hour</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>
         <span class="n">minute</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span>
         <span class="n">onlyIfChanged</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<p>The following runs a build every two hours, using Python's <tt class="xref py py-func docutils literal"><span class="pre">range</span></tt>
function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="o">.</span><span class="n">schedulers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">timed</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;every2hours&#39;</span><span class="p">,</span>
        <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c"># default branch</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;builder1&#39;</span><span class="p">],</span>
        <span class="n">hour</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
<p>Finally, this example will run only on December 24th:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">timed</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;SleighPreflightCheck&#39;</span><span class="p">,</span>
        <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="c"># default branch</span>
        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;flying_circuits&#39;</span><span class="p">,</span> <span class="s">&#39;radar&#39;</span><span class="p">],</span>
        <span class="n">month</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">dayOfMonth</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
        <span class="n">hour</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
<span class="target" id="sched-Try_Jobdir"></span></div>
<div class="section" id="try-schedulers">
<span id="sched-Try_Userpass"></span><span id="id8"></span><h5>Try Schedulers<a class="headerlink" href="#try-schedulers" title="Permalink to this headline">¶</a></h5>
<p>This scheduler allows developers to use the <strong class="command">buildbot try</strong>
command to trigger builds of code they have not yet committed. See
<a class="reference internal" href="#cmdline-try" title="try"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">try</span></tt></a> for complete details.</p>
<p>Two implementations are available: <a class="reference internal" href="#sched-Try_Jobdir" title="Try_Jobdir"><tt class="xref bb bb-sched docutils literal"><span class="pre">Try_Jobdir</span></tt></a> and
<a class="reference internal" href="#sched-Try_Userpass" title="Try_Userpass"><tt class="xref bb bb-sched docutils literal"><span class="pre">Try_Userpass</span></tt></a>.  The former monitors a job directory, specified
by the <tt class="docutils literal"><span class="pre">jobdir</span></tt> parameter, while the latter listens for PB
connections on a specific <tt class="docutils literal"><span class="pre">port</span></tt>, and authenticates against
<tt class="docutils literal"><span class="pre">userport</span></tt>.</p>
<p>The buildmaster must have a scheduler instance in the config file's
<a class="reference internal" href="#cfg-schedulers" title="schedulers"><tt class="xref bb bb-cfg docutils literal"><span class="pre">schedulers</span></tt></a> list to receive try requests. This lets the
administrator control who may initiate these <cite>trial</cite> builds, which branches
are eligible for trial builds, and which Builders should be used for them.</p>
<p>The scheduler has various means to accept build requests.
All of them enforce more security than the usual buildmaster ports do.
Any source code being built can be used to compromise the buildslave
accounts, but in general that code must be checked out from the VC
repository first, so only people with commit privileges can get
control of the buildslaves. The usual force-build control channels can
waste buildslave time but do not allow arbitrary commands to be
executed by people who don't have those commit privileges. However,
the source code patch that is provided with the trial build does not
have to go through the VC system first, so it is important to make
sure these builds cannot be abused by a non-committer to acquire as
much control over the buildslaves as a committer has. Ideally, only
developers who have commit access to the VC repository would be able
to start trial builds, but unfortunately the buildmaster does not, in
general, have access to VC system's user list.</p>
<p>As a result, the try scheduler requires a bit more configuration. There are
currently two ways to set this up:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">jobdir</span></tt> (ssh)</dt>
<dd><p class="first">This approach creates a command queue directory, called the
<tt class="file docutils literal"><span class="pre">jobdir</span></tt>, in the buildmaster's working directory. The buildmaster
admin sets the ownership and permissions of this directory to only
grant write access to the desired set of developers, all of whom must
have accounts on the machine. The <strong class="command">buildbot try</strong> command creates
a special file containing the source stamp information and drops it in
the jobdir, just like a standard maildir. When the buildmaster notices
the new file, it unpacks the information inside and starts the builds.</p>
<p>The config file entries used by 'buildbot try' either specify a local
queuedir (for which write and mv are used) or a remote one (using scp
and ssh).</p>
<p>The advantage of this scheme is that it is quite secure, the
disadvantage is that it requires fiddling outside the buildmaster
config (to set the permissions on the jobdir correctly). If the
buildmaster machine happens to also house the VC repository, then it
can be fairly easy to keep the VC userlist in sync with the
trial-build userlist. If they are on different machines, this will be
much more of a hassle. It may also involve granting developer accounts
on a machine that would not otherwise require them.</p>
<p class="last">To implement this, the buildslave invokes <tt class="samp docutils literal"><span class="pre">ssh</span> <span class="pre">-l</span> <em><span class="pre">username</span></em> <em><span class="pre">host</span></em>
<span class="pre">buildbot</span> <span class="pre">tryserver</span> <em><span class="pre">ARGS</span></em></tt>, passing the patch contents over stdin. The
arguments must include the inlet directory and the revision
information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user+password</span></tt> (PB)</dt>
<dd><p class="first">In this approach, each developer gets a username/password pair, which
are all listed in the buildmaster's configuration file. When the
developer runs <strong class="command">buildbot try</strong>, their machine connects to the
buildmaster via PB and authenticates themselves using that username
and password, then sends a PB command to start the trial build.</p>
<p class="last">The advantage of this scheme is that the entire configuration is
performed inside the buildmaster's config file. The disadvantages are
that it is less secure (while the <cite>cred</cite> authentication system does
not expose the password in plaintext over the wire, it does not offer
most of the other security properties that SSH does). In addition, the
buildmaster admin is responsible for maintaining the username/password
list, adding and deleting entries as developers come and go.</p>
</dd>
</dl>
<p>For example, to set up the <cite>jobdir</cite> style of trial build, using a
command queue directory of <tt class="file docutils literal"><em><span class="pre">MASTERDIR</span></em><span class="pre">/jobdir</span></tt> (and assuming that
all your project developers were members of the <tt class="docutils literal"><span class="pre">developers</span></tt> unix
group), you would first set up that directory:</p>
<div class="highlight-bash"><div class="highlight"><pre>mkdir -p MASTERDIR/jobdir MASTERDIR/jobdir/new MASTERDIR/jobdir/cur MASTERDIR/jobdir/tmp
chgrp developers MASTERDIR/jobdir MASTERDIR/jobdir/*
chmod g+rwx,o-rwx MASTERDIR/jobdir MASTERDIR/jobdir/*
</pre></div>
</div>
<p>and then use the following scheduler in the buildmaster's config file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers.trysched</span> <span class="kn">import</span> <span class="n">Try_Jobdir</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Try_Jobdir</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;try1&quot;</span><span class="p">,</span>
               <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;full-linux&quot;</span><span class="p">,</span> <span class="s">&quot;full-netbsd&quot;</span><span class="p">,</span> <span class="s">&quot;full-OSX&quot;</span><span class="p">],</span>
               <span class="n">jobdir</span><span class="o">=</span><span class="s">&quot;jobdir&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that you must create the jobdir before telling the buildmaster to
use this configuration, otherwise you will get an error. Also remember
that the buildmaster must be able to read and write to the jobdir as
well. Be sure to watch the <tt class="file docutils literal"><span class="pre">twistd.log</span></tt> file (<a class="reference internal" href="#logfiles"><em>Logfiles</em></a>)
as you start using the jobdir, to make sure the buildmaster is happy
with it.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Patches in the jobdir are encoded using netstrings, which place an
arbitrary upper limit on patch size of 99999 bytes.  If your submitted try
jobs are rejected with <cite>BadJobfile</cite>, try increasing this limit with a
snippet like this in your <cite>master.cfg</cite>:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.protocols.basic</span> <span class="kn">import</span> <span class="n">NetstringReceiver</span>
<span class="n">NetstringReceiver</span><span class="o">.</span><span class="n">MAX_LENGTH</span> <span class="o">=</span> <span class="mi">1000000</span>
</pre></div>
</div>
</div>
<p>To use the username/password form of authentication, create a
<tt class="xref py py-class docutils literal"><span class="pre">Try_Userpass</span></tt> instance instead. It takes the same
<tt class="docutils literal"><span class="pre">builderNames</span></tt> argument as the <tt class="xref py py-class docutils literal"><span class="pre">Try_Jobdir</span></tt> form, but
accepts an addtional <tt class="docutils literal"><span class="pre">port</span></tt> argument (to specify the TCP port to
listen on) and a <tt class="docutils literal"><span class="pre">userpass</span></tt> list of username/password pairs to
accept. Remember to use good passwords for this: the security of the
buildslave accounts depends upon it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers.trysched</span> <span class="kn">import</span> <span class="n">Try_Userpass</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">Try_Userpass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;try2&quot;</span><span class="p">,</span>
                 <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;full-linux&quot;</span><span class="p">,</span> <span class="s">&quot;full-netbsd&quot;</span><span class="p">,</span> <span class="s">&quot;full-OSX&quot;</span><span class="p">],</span>
                 <span class="n">port</span><span class="o">=</span><span class="mi">8031</span><span class="p">,</span>
                 <span class="n">userpass</span><span class="o">=</span><span class="p">[(</span><span class="s">&quot;alice&quot;</span><span class="p">,</span><span class="s">&quot;pw1&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;bob&quot;</span><span class="p">,</span> <span class="s">&quot;pw2&quot;</span><span class="p">)]</span> <span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
</pre></div>
</div>
<p>Like most places in the buildbot, the <tt class="docutils literal"><span class="pre">port</span></tt> argument takes a
<cite>strports</cite> specification. See <tt class="xref py py-mod docutils literal"><span class="pre">twisted.application.strports</span></tt> for
details.</p>
<span class="target" id="sched-Triggerable"></span></div>
<div class="section" id="triggerable-scheduler">
<span id="index-1"></span><span id="id9"></span><h5>Triggerable Scheduler<a class="headerlink" href="#triggerable-scheduler" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">Triggerable</span></tt> scheduler waits to be triggered by a Trigger
step (see <a class="reference internal" href="#triggering-schedulers"><em>Triggering Schedulers</em></a>) in another build. That step
can optionally wait for the scheduler's builds to complete. This
provides two advantages over Dependent schedulers. First, the same
scheduler can be triggered from multiple builds. Second, the ability
to wait for a Triggerable's builds to complete provides a form of
&quot;subroutine call&quot;, where one or more builds can &quot;call&quot; a scheduler
to perform some work for them, perhaps on other buildslaves.
The Triggerable-Scheduler supports multiple codebases. The scheduler filters out
all codebases from Trigger steps that are not configured in the scheduler.</p>
<p>The parameters are just the basics:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">builderNames</span></tt></p>
<p><tt class="docutils literal"><span class="pre">properties</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">codebases</span></tt></dt>
<dd>See <a class="reference internal" href="#configuring-schedulers"><em>Configuring Schedulers</em></a>.</dd>
</dl>
<p>This class is only useful in conjunction with the <tt class="xref py py-class docutils literal"><span class="pre">Trigger</span></tt> step.
Here is a fully-worked example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers</span> <span class="kn">import</span> <span class="n">basic</span><span class="p">,</span> <span class="n">timed</span><span class="p">,</span> <span class="n">triggerable</span>
<span class="kn">from</span> <span class="nn">buildbot.process</span> <span class="kn">import</span> <span class="n">factory</span>
<span class="kn">from</span> <span class="nn">buildbot.steps</span> <span class="kn">import</span> <span class="n">trigger</span>

<span class="n">checkin</span> <span class="o">=</span> <span class="n">basic</span><span class="o">.</span><span class="n">SingleBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;checkin&quot;</span><span class="p">,</span>
            <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">5</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
            <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;checkin&quot;</span><span class="p">])</span>
<span class="n">nightly</span> <span class="o">=</span> <span class="n">timed</span><span class="o">.</span><span class="n">Nightly</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;nightly&#39;</span><span class="p">,</span>
            <span class="n">branch</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;nightly&#39;</span><span class="p">],</span>
            <span class="n">hour</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">mktarball</span> <span class="o">=</span> <span class="n">triggerable</span><span class="o">.</span><span class="n">Triggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;mktarball&quot;</span><span class="p">,</span>
                <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;mktarball&quot;</span><span class="p">])</span>
<span class="n">build</span> <span class="o">=</span> <span class="n">triggerable</span><span class="o">.</span><span class="n">Triggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;build-all-platforms&quot;</span><span class="p">,</span>
                <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;build-all-platforms&quot;</span><span class="p">])</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">triggerable</span><span class="o">.</span><span class="n">Triggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;distributed-test&quot;</span><span class="p">,</span>
                <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;distributed-test&quot;</span><span class="p">])</span>
<span class="n">package</span> <span class="o">=</span> <span class="n">triggerable</span><span class="o">.</span><span class="n">Triggerable</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;package-all-platforms&quot;</span><span class="p">,</span>
                <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;package-all-platforms&quot;</span><span class="p">])</span>

<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">mktarball</span><span class="p">,</span> <span class="n">checkin</span><span class="p">,</span> <span class="n">nightly</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">package</span><span class="p">]</span>

<span class="c"># on checkin, make a tarball, build it, and test it</span>
<span class="n">checkin_factory</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">checkin_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">trigger</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;mktarball&#39;</span><span class="p">],</span>
                                       <span class="n">waitForFinish</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="n">checkin_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">trigger</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;build-all-platforms&#39;</span><span class="p">],</span>
                                   <span class="n">waitForFinish</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="n">checkin_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">trigger</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;distributed-test&#39;</span><span class="p">],</span>
                                  <span class="n">waitForFinish</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>

<span class="c"># and every night, make a tarball, build it, and package it</span>
<span class="n">nightly_factory</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">nightly_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">trigger</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;mktarball&#39;</span><span class="p">],</span>
                                       <span class="n">waitForFinish</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="n">nightly_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">trigger</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;build-all-platforms&#39;</span><span class="p">],</span>
                                   <span class="n">waitForFinish</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="n">nightly_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">trigger</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">schedulerNames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;package-all-platforms&#39;</span><span class="p">],</span>
                                     <span class="n">waitForFinish</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="nightlytriggerable-scheduler">
<span id="sched-NightlyTriggerable"></span><h5>NightlyTriggerable Scheduler<a class="headerlink" href="#nightlytriggerable-scheduler" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.schedulers.timed.NightlyTriggerable">
<em class="property">class </em><tt class="descclassname">buildbot.schedulers.timed.</tt><tt class="descname">NightlyTriggerable</tt><a class="headerlink" href="#buildbot.schedulers.timed.NightlyTriggerable" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <tt class="xref py py-class docutils literal"><span class="pre">NightlyTriggerable</span></tt> scheduler is a mix of the <tt class="xref py py-class docutils literal"><span class="pre">Nightly</span></tt> and <tt class="xref py py-class docutils literal"><span class="pre">Triggerable</span></tt> schedulers.
This scheduler triggers builds at a particular time of day, week, or year, exactly as the <tt class="xref py py-class docutils literal"><span class="pre">Nightly</span></tt> scheduler.
However, the source stamp set that is used that provided by the last <tt class="xref py py-class docutils literal"><span class="pre">Trigger</span></tt> step that targeted this scheduler.</p>
<p>The parameters are just the basics:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">builderNames</span></tt></p>
<p><tt class="docutils literal"><span class="pre">properties</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">codebases</span></tt></dt>
<dd>See <a class="reference internal" href="#configuring-schedulers"><em>Configuring Schedulers</em></a>.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">minute</span></tt></p>
<p><tt class="docutils literal"><span class="pre">hour</span></tt></p>
<p><tt class="docutils literal"><span class="pre">dayOfMonth</span></tt></p>
<p><tt class="docutils literal"><span class="pre">month</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">dayOfWeek</span></tt></dt>
<dd>See <a class="reference internal" href="#sched-Nightly" title="Nightly"><tt class="xref bb bb-sched docutils literal"><span class="pre">Nightly</span></tt></a>.</dd>
</dl>
<p>This class is only useful in conjunction with the <tt class="xref py py-class docutils literal"><span class="pre">Trigger</span></tt> step.
Note that <tt class="docutils literal"><span class="pre">waitForFinish</span></tt> is ignored by <tt class="xref py py-class docutils literal"><span class="pre">Trigger</span></tt> steps targeting this scheduler.</p>
<p>Here is a fully-worked example:</p>
<div class="highlight-python"><pre>from buildbot.schedulers import basic, timed
from buildbot.process import factory
from buildbot.steps import shell, trigger

checkin = basic.SingleBranchScheduler(name="checkin",
            branch=None,
            treeStableTimer=5*60,
            builderNames=["checkin"])
nightly = timed.NightlyTriggerable(name='nightly',
            builderNames=['nightly'],
            hour=3,
            minute=0)

c['schedulers'] = [checkin, nightly]

# on checkin, run tests
checkin_factory = factory.BuildFactory()
checkin_factory.addStep(shell.Test())
checkin_factory.addStep(trigger.Trigger(schedulerNames=['nightly'])

# and every night, package the latest succesful build
nightly_factory = factory.BuildFactory()
nightly_factory.addStep(shell.ShellCommand(command=['make', 'package']))</pre>
</div>
<span class="target" id="sched-ForceScheduler"></span></div>
<div class="section" id="forcescheduler-scheduler">
<span id="index-2"></span><h5>ForceScheduler Scheduler<a class="headerlink" href="#forcescheduler-scheduler" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">ForceScheduler</span></tt> scheduler is the way you can configure a
force build form in the web UI.</p>
<p>In the <tt class="docutils literal"><span class="pre">builder/&lt;builder-name&gt;</span></tt> web page, you will see one form for each
ForceScheduler scheduler that was configured for this builder.</p>
<p>This allows you to customize exactly how the build form looks, which builders
have a force build form (it might not make sense to force build every builder),
and who is allowed to force builds on which builders.</p>
<p>The scheduler takes the following parameters:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt></p>
<p><tt class="docutils literal"><span class="pre">builderNames</span></tt></p>
<blockquote>
<div>See <a class="reference internal" href="#configuring-schedulers"><em>Configuring Schedulers</em></a>.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">reason</span></tt></p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><em>parameter</em></a> specifying the reason for
the build.  The default value is a string parameter with value &quot;force build&quot;.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">username</span></tt></p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><em>parameter</em></a> specifying the project for
the build.  The default value is a username parameter,</div></blockquote>
<p><tt class="docutils literal"><span class="pre">codebases</span></tt></p>
<blockquote>
<div>A list of strings or <a class="reference internal" href="#forcescheduler-parameters"><em>CodebaseParameter</em></a> specifying
the codebases that should be presented. The default is a single codebase with no name.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">properties</span></tt></p>
<blockquote>
<div>A list of <a class="reference internal" href="#forcescheduler-parameters"><em>parameters</em></a>, one for each
property.  These can be arbitrary parameters, where the parameter's name is
taken as the property name, or <tt class="docutils literal"><span class="pre">AnyPropertyParameter</span></tt>, which allows the
web user to specify the property name.</div></blockquote>
<p>An example may be better than long explanation.  What you need in your config
file is something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers.forcesched</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">sch</span> <span class="o">=</span> <span class="n">ForceScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;force&quot;</span><span class="p">,</span>
             <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;my-builder&quot;</span><span class="p">],</span>

             <span class="c"># will generate a combo box</span>
             <span class="n">branch</span><span class="o">=</span><span class="n">ChoiceStringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;branch&quot;</span><span class="p">,</span>
                                    <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;main&quot;</span><span class="p">,</span><span class="s">&quot;devel&quot;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">),</span>

             <span class="c"># will generate a text input</span>
             <span class="n">reason</span><span class="o">=</span><span class="n">StringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;reason&quot;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;reason:&lt;br&gt;&quot;</span><span class="p">,</span>
                                    <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>

             <span class="c"># will generate nothing in the form, but revision, repository,</span>
             <span class="c"># and project are needed by buildbot scheduling system so we</span>
             <span class="c"># need to pass a value (&quot;&quot;)</span>
             <span class="n">revision</span><span class="o">=</span><span class="n">FixedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;revision&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
             <span class="n">repository</span><span class="o">=</span><span class="n">FixedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;repository&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>
             <span class="n">project</span><span class="o">=</span><span class="n">FixedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;project&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">),</span>

             <span class="c"># in case you dont require authentication this will display</span>
             <span class="c"># input for user to type his name</span>
             <span class="n">username</span><span class="o">=</span><span class="n">UserNameParameter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;your name:&lt;br&gt;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">),</span>

             <span class="c"># A completely customized property list.  The name of the</span>
             <span class="c"># property is the name of the parameter</span>
             <span class="n">properties</span><span class="o">=</span><span class="p">[</span>

                <span class="n">BooleanParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;force_build_clean&quot;</span><span class="p">,</span>
                            <span class="n">label</span><span class="o">=</span><span class="s">&quot;force a make clean&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>

                <span class="n">StringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;pull_url&quot;</span><span class="p">,</span>
                    <span class="n">label</span><span class="o">=</span><span class="s">&quot;optionally give a public git pull url:&lt;br&gt;&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
             <span class="p">]</span>
             <span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sch</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="authorization">
<h6>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h6>
<p>The force scheduler uses the web status's <a class="reference internal" href="#authorization"><em>authorization</em></a>
framework to determine which user has the right to force which build.  Here is
an example of code on how you can define which user has which right:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">user_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;project1-builder&quot;</span><span class="p">):</span> <span class="p">[</span><span class="s">&quot;project1-maintainer&quot;</span><span class="p">,</span> <span class="s">&quot;john&quot;</span><span class="p">]</span> <span class="p">,</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;project2-builder&quot;</span><span class="p">):</span> <span class="p">[</span><span class="s">&quot;project2-maintainer&quot;</span><span class="p">,</span> <span class="s">&quot;jack&quot;</span><span class="p">],</span>
    <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&quot;.*&quot;</span><span class="p">):</span> <span class="p">[</span><span class="s">&quot;root&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="k">def</span> <span class="nf">force_auth</span><span class="p">(</span><span class="n">user</span><span class="p">,</span>  <span class="n">status</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">user_mapping</span>
    <span class="k">for</span> <span class="n">r</span><span class="p">,</span><span class="n">users</span> <span class="ow">in</span> <span class="n">user_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="c"># use authz_cfg in your WebStatus setup</span>
<span class="n">authz_cfg</span><span class="o">=</span><span class="n">authz</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
    <span class="n">auth</span><span class="o">=</span><span class="n">my_auth</span><span class="p">,</span>
    <span class="n">forceBuild</span> <span class="o">=</span> <span class="n">force_auth</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="forcesched-parameters">
<span id="forcescheduler-parameters"></span><h6>ForceSched Parameters<a class="headerlink" href="#forcesched-parameters" title="Permalink to this headline">¶</a></h6>
<p>Most of the arguments to <tt class="docutils literal"><span class="pre">ForceScheduler</span></tt> are &quot;parameters&quot;.  Several classes
of parameters are available, each describing a different kind of input from a
force-build form.</p>
<p>All parameter types have a few common arguments:</p>
<p><tt class="docutils literal"><span class="pre">name</span></tt> (required)</p>
<blockquote>
<div>The name of the parameter. For properties, this will correspond to the name
of the property that your parameter will set.  The name is also used
internally as the identifier for in the HTML form.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">label</span></tt> (optional; default is same as name)</p>
<blockquote>
<div>The label of the parameter. This is what is displayed to the user.  HTML is
permitted here.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">default</span></tt> (optional; default: &quot;&quot;)</p>
<blockquote>
<div>The default value for the parameter, that is used if there is no user
input.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">required</span></tt> (optional; default: False)</p>
<blockquote>
<div>If this is true, then an error will be shown to user if
there is no input in this field</div></blockquote>
<p>The parameter types are:</p>
<div class="section" id="fixedparameter">
<h7>FixedParameter<a class="headerlink" href="#fixedparameter" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span class="n">FixedParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;branch&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;trunk&quot;</span><span class="p">),</span>
</pre></div>
</div>
<p>This parameter type will not be shown on the web form, and always generate a
property with its default value.</p>
</div>
<div class="section" id="stringparameter">
<h7>StringParameter<a class="headerlink" href="#stringparameter" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span class="n">StringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;pull_url&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s">&quot;optionally give a public git pull url:&lt;br&gt;&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type will show a single-line text-entry box, and allow the user
to enter an arbitrary string.  It adds the following arguments:</p>
<p><tt class="docutils literal"><span class="pre">regex</span></tt> (optional)</p>
<blockquote>
<div>a string that will be compiled as a regex, and used to validate the input
of this parameter</div></blockquote>
<p><tt class="docutils literal"><span class="pre">size</span></tt> (optional; default: 10)</p>
<blockquote>
<div>The width of the input field (in characters)</div></blockquote>
</div>
<div class="section" id="textparameter">
<h7>TextParameter<a class="headerlink" href="#textparameter" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span class="n">StringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;comments&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s">&quot;comments to be displayed to the user of the built binary&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="s">&quot;This is a development build&quot;</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type is similar to StringParameter, except that it is
represented in the HTML form as a textarea, allowing multi-line input.  It adds
the StringParameter arguments, this type allows:</p>
<p><tt class="docutils literal"><span class="pre">cols</span></tt> (optional; default: 80)</p>
<blockquote>
<div>The number of columns the textarea will have</div></blockquote>
<p><tt class="docutils literal"><span class="pre">rows</span></tt> (optional; default: 20)</p>
<blockquote>
<div>The number of rows the textarea will have</div></blockquote>
<p>This class could be subclassed in order to have more customization e.g.</p>
<blockquote>
<div><ul class="simple">
<li>developer could send a list of git branches to pull from</li>
<li>developer could send a list of gerrit changes to cherry-pick,</li>
<li>developer could send a shell script to amend the build.</li>
</ul>
</div></blockquote>
<p>beware of security issues anyway.</p>
</div>
<div class="section" id="intparameter">
<h7>IntParameter<a class="headerlink" href="#intparameter" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span class="n">IntParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;debug_level&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s">&quot;debug level (1-10)&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type accepts an integer value using a text-entry box.</p>
</div>
<div class="section" id="booleanparameter">
<h7>BooleanParameter<a class="headerlink" href="#booleanparameter" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span class="n">BooleanParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;force_build_clean&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s">&quot;force a make clean&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>This type represents a boolean value. It will be presented as a checkbox.</p>
</div>
<div class="section" id="usernameparameter">
<h7>UserNameParameter<a class="headerlink" href="#usernameparameter" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span class="n">UserNameParameter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&quot;your name:&lt;br&gt;&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type accepts a username.  If authentication is active, it will
use the authenticated user instead of displaying a text-entry box.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">size</span></tt> (optional; default: 10)</dt>
<dd>The width of the input field (in characters)</dd>
<dt><tt class="docutils literal"><span class="pre">need_email</span></tt> (optional; default True)</dt>
<dd>If true, require a full email address rather than arbitrary text.</dd>
</dl>
</div>
<div class="section" id="choicestringparameter">
<h7>ChoiceStringParameter<a class="headerlink" href="#choicestringparameter" title="Permalink to this headline">¶</a></h7>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ChoiceStringParameter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;branch&quot;</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;main&quot;</span><span class="p">,</span><span class="s">&quot;devel&quot;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;main&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This parameter type lets the user choose between several choices (e.g the list
of branches you are supporting, or the test campaign to run).  If <tt class="docutils literal"><span class="pre">multiple</span></tt>
is false, then its result is a string - one of the choices.  If <tt class="docutils literal"><span class="pre">multiple</span></tt> is
true, then the result is a list of strings from the choices.  Its arguments, in
addition to the common options, are:</p>
<p><tt class="docutils literal"><span class="pre">choices</span></tt></p>
<blockquote>
<div>The list of available choices.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">strict</span></tt> (optional; default: True)</p>
<blockquote>
<div>If true, verify that the user's input is from the list.  Note that this
only affects the validation of the form request; even if this argument is
False, there is no HTML form component available to enter an arbitrary
value.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">multiple</span></tt></p>
<blockquote>
<div>If true, then the user may select multiple choices.</div></blockquote>
<p>Example:</p>
<div class="highlight-python"><pre>ChoiceStringParameter(name="forced_tests",
    label = "smoke test campaign to run",
    default = default_tests,
    multiple = True,
    strict = True,
    choices = [ "test_builder1",
                "test_builder2",
                "test_builder3" ])
])

# .. and later base the schedulers to trigger off this property:

# triggers the tests depending on the property forced_test
builder1.factory.addStep(Trigger(name="Trigger tests",
                                schedulerNames=Property("forced_tests")))</pre>
</div>
</div>
<div class="section" id="codebaseparameter">
<h7>CodebaseParameter<a class="headerlink" href="#codebaseparameter" title="Permalink to this headline">¶</a></h7>
<p>This is a parameter group to specify a sourcestamp for a given codebase.</p>
<p><tt class="docutils literal"><span class="pre">codebase</span></tt></p>
<blockquote>
<div>The name of the codebase.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">branch</span></tt> (optional; default: StringParameter)</p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><em>parameter</em></a> specifying the branch to
build.  The default value is a string parameter.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">revision</span></tt> (optional; default: StringParameter)</p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><em>parameter</em></a> specifying the revision to
build.  The default value is a string parameter.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">repository</span></tt> (optional; default: StringParameter)</p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><em>parameter</em></a> specifying the repository
for the build.  The default value is a string parameter.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">project</span></tt> (optional; default: StringParameter)</p>
<blockquote>
<div>A <a class="reference internal" href="#forcescheduler-parameters"><em>parameter</em></a> specifying the project for
the build.  The default value is a string parameter.</div></blockquote>
</div>
<div class="section" id="inheritbuildparameter">
<h7>InheritBuildParameter<a class="headerlink" href="#inheritbuildparameter" title="Permalink to this headline">¶</a></h7>
<p>This is a special parameter for inheriting force build properties from another
build.  The user is presented with a list of compatible builds from which to
choose, and all forced-build parameters from the selected build are copied into
the new build.  The new parameter is:</p>
<p><tt class="docutils literal"><span class="pre">compatible_builds</span></tt></p>
<blockquote>
<div>A function to find compatible builds in the build history.  This function is
given the master <tt class="xref py py-class docutils literal"><span class="pre">Status</span></tt> instance as
first argument, and the current builder name as second argument, or None
when forcing all builds.</div></blockquote>
<p>Example:</p>
<div class="highlight-python"><pre>def get_compatible_builds(status, builder):
    if builder == None: # this is the case for force_build_all
        return ["cannot generate build list here"]
    # find all successful builds in builder1 and builder2
    for builder in ["builder1","builder2"]:
        builder_status = status.getBuilder(builder)
        for num in xrange(1,40): # 40 last builds
            b = builder_status.getBuild(-num)
            if not b:
                continue
            if b.getResults() == FAILURE:
                continue
            builds.append(builder+"/"+str(b.getNumber()))
    return builds

    # ...

        properties=[
            InheritBuildParameter(
                name="inherit",
                label="promote a build for merge",
                compatible_builds=get_compatible_builds,
                required = True),
                ])</pre>
</div>
</div>
<div class="section" id="anypropertyparameter">
<h7>AnyPropertyParameter<a class="headerlink" href="#anypropertyparameter" title="Permalink to this headline">¶</a></h7>
<p>This parameter type can only be used in <tt class="docutils literal"><span class="pre">properties</span></tt>, and allows the user to
specify both the property name and value in the HTML form.</p>
<p>This Parameter is here to reimplement old Buildbot behavior, and should be
avoided. Stricter parameter name and type should be preferred.</p>
</div>
</div>
</div>
</div>
<span id="document-manual/cfg-buildslaves"></span><span class="target" id="buildslaves"></span><div class="section" id="cfg-slaves">
<span id="id1"></span><h4>Buildslaves<a class="headerlink" href="#cfg-slaves" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="#cfg-slaves" title="slaves"><tt class="xref bb bb-cfg docutils literal"><span class="pre">slaves</span></tt></a> configuration key specifies a list of known buildslaves.
In the common case, each buildslave is defined by an instance of the
<tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt> class.  It represents a standard, manually started machine
that will try to connect to the buildbot master as a slave.  Buildbot also
supports &quot;on-demand&quot;, or latent, buildslaves, which allow buildbot to
dynamically start and stop buildslave instances.</p>
<p>A <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt> instance is created with a <tt class="docutils literal"><span class="pre">slavename</span></tt> and a
<tt class="docutils literal"><span class="pre">slavepassword</span></tt>. These are the same two values that need to be provided to
the buildslave administrator when they create the buildslave.</p>
<p>The slavename must be unique, of course. The password exists to
prevent evildoers from interfering with the buildbot by inserting
their own (broken) buildslaves into the system and thus displacing the
real ones.</p>
<p>Buildslaves with an unrecognized slavename or a non-matching password will be
rejected when they attempt to connect, and a message describing the problem
will be written to the log file (see <a class="reference internal" href="#logfiles"><em>Logfiles</em></a>).</p>
<p>A configuration for two slaves would look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.buildslave</span> <span class="kn">import</span> <span class="n">BuildSlave</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuildSlave</span><span class="p">(</span><span class="s">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s">&#39;solarispasswd&#39;</span><span class="p">),</span>
    <span class="n">BuildSlave</span><span class="p">(</span><span class="s">&#39;bot-bsd&#39;</span><span class="p">,</span> <span class="s">&#39;bsdpasswd&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="buildslave-options">
<h5>BuildSlave Options<a class="headerlink" href="#buildslave-options" title="Permalink to this headline">¶</a></h5>
<p id="index-0"><tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt> objects can also be created with an optional
<tt class="docutils literal"><span class="pre">properties</span></tt> argument, a dictionary specifying properties that
will be available to any builds performed on this slave.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuildSlave</span><span class="p">(</span><span class="s">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s">&#39;solarispasswd&#39;</span><span class="p">,</span>
                <span class="n">properties</span><span class="o">=</span><span class="p">{</span> <span class="s">&#39;os&#39;</span><span class="p">:</span><span class="s">&#39;solaris&#39;</span> <span class="p">}),</span>
<span class="p">]</span>
</pre></div>
</div>
<p id="index-1">The <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt> constructor can also take an optional
<tt class="docutils literal"><span class="pre">max_builds</span></tt> parameter to limit the number of builds that it
will execute simultaneously:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuildSlave</span><span class="p">(</span><span class="s">&quot;bot-linux&quot;</span><span class="p">,</span> <span class="s">&quot;linuxpassword&quot;</span><span class="p">,</span> <span class="n">max_builds</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="master-slave-tcp-keepalive">
<h6>Master-Slave TCP Keepalive<a class="headerlink" href="#master-slave-tcp-keepalive" title="Permalink to this headline">¶</a></h6>
<p>By default, the buildmaster sends a simple, non-blocking message to each slave
every hour.  These keepalives ensure that traffic is flowing over the
underlying TCP connection, allowing the system's network stack to detect any
problems before a build is started.</p>
<p>The interval can be modified by specifying the interval in seconds using the
<tt class="docutils literal"><span class="pre">keepalive_interval</span></tt> parameter of BuildSlave:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuildSlave</span><span class="p">(</span><span class="s">&#39;bot-linux&#39;</span><span class="p">,</span> <span class="s">&#39;linuxpasswd&#39;</span><span class="p">,</span>
                <span class="n">keepalive_interval</span><span class="o">=</span><span class="mi">3600</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The interval can be set to <tt class="docutils literal"><span class="pre">None</span></tt> to disable this functionality
altogether.</p>
</div>
<div class="section" id="when-buildslaves-go-missing">
<span id="id2"></span><h6>When Buildslaves Go Missing<a class="headerlink" href="#when-buildslaves-go-missing" title="Permalink to this headline">¶</a></h6>
<p>Sometimes, the buildslaves go away. One very common reason for this is
when the buildslave process is started once (manually) and left
running, but then later the machine reboots and the process is not
automatically restarted.</p>
<p>If you'd like to have the administrator of the buildslave (or other
people) be notified by email when the buildslave has been missing for
too long, just add the <tt class="docutils literal"><span class="pre">notify_on_missing=</span></tt> argument to the
<tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt> definition.  This value can be a single email
address, or a list of addresses:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuildSlave</span><span class="p">(</span><span class="s">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s">&#39;solarispasswd&#39;</span><span class="p">,</span>
                <span class="n">notify_on_missing</span><span class="o">=</span><span class="s">&quot;bob@example.com&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>By default, this will send email when the buildslave has been
disconnected for more than one hour. Only one email per
connection-loss event will be sent. To change the timeout, use
<tt class="docutils literal"><span class="pre">missing_timeout=</span></tt> and give it a number of seconds (the default
is 3600).</p>
<p>You can have the buildmaster send email to multiple recipients: just
provide a list of addresses instead of a single one:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuildSlave</span><span class="p">(</span><span class="s">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s">&#39;solarispasswd&#39;</span><span class="p">,</span>
                <span class="n">notify_on_missing</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;bob@example.com&quot;</span><span class="p">,</span>
                                    <span class="s">&quot;alice@example.org&quot;</span><span class="p">],</span>
                <span class="n">missing_timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="c"># notify after 5 minutes</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The email sent this way will use a <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> (see
<a class="reference internal" href="#status-MailNotifier" title="MailNotifier"><tt class="xref bb bb-status docutils literal"><span class="pre">MailNotifier</span></tt></a>) status target, if one is configured. This provides a
way for you to control the <em>from</em> address of the email, as well as the
relayhost (aka <em>smarthost</em>) to use as an SMTP server. If no
<tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> is configured on this buildmaster, the buildslave-missing
emails will be sent using a default configuration.</p>
<p>Note that if you want to have a <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> for buildslave-missing
emails but not for regular build emails, just create one with
<tt class="docutils literal"><span class="pre">builders=[]</span></tt>, as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status</span> <span class="kn">import</span> <span class="n">mail</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">mail</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s">&quot;buildbot@localhost&quot;</span><span class="p">,</span> <span class="n">builders</span><span class="o">=</span><span class="p">[],</span>
                      <span class="n">relayhost</span><span class="o">=</span><span class="s">&quot;smtp.example.org&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">buildbot.buildslave</span> <span class="kn">import</span> <span class="n">BuildSlave</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">BuildSlave</span><span class="p">(</span><span class="s">&#39;bot-solaris&#39;</span><span class="p">,</span> <span class="s">&#39;solarispasswd&#39;</span><span class="p">,</span>
                    <span class="n">notify_on_missing</span><span class="o">=</span><span class="s">&quot;bob@example.com&quot;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="latent-buildslaves">
<span id="index-2"></span><span id="id3"></span><h5>Latent Buildslaves<a class="headerlink" href="#latent-buildslaves" title="Permalink to this headline">¶</a></h5>
<p>The standard buildbot model has slaves started manually.  The previous section
described how to configure the master for this approach.</p>
<p>Another approach is to let the buildbot master start slaves when builds are
ready, on-demand.  Thanks to services such as Amazon Web Services' Elastic
Compute Cloud (&quot;AWS EC2&quot;), this is relatively easy to set up, and can be
very useful for some situations.</p>
<p>The buildslaves that are started on-demand are called &quot;latent&quot; buildslaves.
As of this writing, buildbot ships with an abstract base class for building
latent buildslaves, and a concrete implementation for AWS EC2 and for libvirt.</p>
<div class="section" id="common-options">
<h6>Common Options<a class="headerlink" href="#common-options" title="Permalink to this headline">¶</a></h6>
<p>The following options are available for all latent buildslaves.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">build_wait_timeout</span></tt></dt>
<dd>This option allows you to specify how long a latent slave should wait after
a build for another build before it shuts down. It defaults to 10 minutes.
If this is set to 0 then the slave will be shut down immediately. If it is
less than 0 it will never automatically shutdown.</dd>
</dl>
</div>
<div class="section" id="amazon-web-services-elastic-compute-cloud-aws-ec2">
<span id="index-3"></span><h6>Amazon Web Services Elastic Compute Cloud (&quot;AWS EC2&quot;)<a class="headerlink" href="#amazon-web-services-elastic-compute-cloud-aws-ec2" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="http://aws.amazon.com/ec2/">EC2</a> is a web service that allows you to
start virtual machines in an Amazon data center. Please see their website for
details, incuding costs. Using the AWS EC2 latent buildslaves involves getting
an EC2 account with AWS and setting up payment; customizing one or more EC2
machine images (&quot;AMIs&quot;) on your desired operating system(s) and publishing
them (privately if needed); and configuring the buildbot master to know how to
start your customized images for &quot;substantiating&quot; your latent slaves.</p>
<div class="section" id="get-an-aws-ec2-account">
<h7>Get an AWS EC2 Account<a class="headerlink" href="#get-an-aws-ec2-account" title="Permalink to this headline">¶</a></h7>
<p>To start off, to use the AWS EC2 latent buildslave, you need to get an AWS
developer account and sign up for EC2. Although Amazon often changes this
process, these instructions should help you get started:</p>
<blockquote>
<div><ol class="arabic simple">
<li>Go to <a class="reference external" href="http://aws.amazon.com/">http://aws.amazon.com/</a> and click to &quot;Sign Up Now&quot; for an AWS account.</li>
<li>Once you are logged into your account, you need to sign up for EC2.
Instructions for how to do this have changed over time because Amazon changes
their website, so the best advice is to hunt for it. After signing up for EC2,
it may say it wants you to upload an x.509 cert. You will need this to create
images (see below) but it is not technically necessary for the buildbot master
configuration.</li>
<li>You must enter a valid credit card before you will be able to use EC2. Do that
under 'Payment Method'.</li>
<li>Make sure you're signed up for EC2 by going to 'Your Account'-&gt;'Account
Activity' and verifying EC2 is listed.</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="create-an-ami">
<h7>Create an AMI<a class="headerlink" href="#create-an-ami" title="Permalink to this headline">¶</a></h7>
<p>Now you need to create an AMI and configure the master.  You may need to
run through this cycle a few times to get it working, but these instructions
should get you started.</p>
<p>Creating an AMI is out of the scope of this document.  The
<a class="reference external" href="http://docs.amazonwebservices.com/AWSEC2/latest/GettingStartedGuide/">EC2 Getting Started Guide</a>
is a good resource for this task.  Here are a few additional hints.</p>
<blockquote>
<div><ul class="simple">
<li>When an instance of the image starts, it needs to automatically start a
buildbot slave that connects to your master (to create a buildbot slave,
<a class="reference internal" href="#creating-a-buildslave"><em>Creating a buildslave</em></a>; to make a daemon,
<a class="reference internal" href="#launching-the-daemons"><em>Launching the daemons</em></a>).</li>
<li>You may want to make an instance of the buildbot slave, configure it as a
standard buildslave in the master (i.e., not as a latent slave), and test and
debug it that way before you turn it into an AMI and convert to a latent
slave in the master.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configure-the-master-with-an-ec2latentbuildslave">
<h7>Configure the Master with an EC2LatentBuildSlave<a class="headerlink" href="#configure-the-master-with-an-ec2latentbuildslave" title="Permalink to this headline">¶</a></h7>
<p>Now let's assume you have an AMI that should work with the
EC2LatentBuildSlave.  It's now time to set up your buildbot master
configuration.</p>
<p>You will need some information from your AWS account: the <cite>Access Key Id</cite> and
the <cite>Secret Access Key</cite>.  If you've built the AMI yourself, you probably
already are familiar with these values.  If you have not, and someone has
given you access to an AMI, these hints may help you find the necessary
values:</p>
<blockquote>
<div><ul class="simple">
<li>While logged into your AWS account, find the &quot;Access Identifiers&quot; link (either
on the left, or via &quot;Your Account&quot; -&gt; &quot;Access Identifiers&quot;.</li>
<li>On the page, you'll see alphanumeric values for &quot;Your Access Key Id:&quot; and
&quot;Your Secret Access Key:&quot;. Make a note of these. Later on, we'll call the
first one your <tt class="docutils literal"><span class="pre">identifier</span></tt> and the second one your <tt class="docutils literal"><span class="pre">secret_identifier</span></tt>.</li>
</ul>
</div></blockquote>
<p>When creating an EC2LatentBuildSlave in the buildbot master configuration,
the first three arguments are required.  The name and password are the first
two arguments, and work the same as with normal buildslaves.  The next
argument specifies the type of the EC2 virtual machine (available options as
of this writing include <tt class="docutils literal"><span class="pre">m1.small</span></tt>, <tt class="docutils literal"><span class="pre">m1.large</span></tt>, <tt class="docutils literal"><span class="pre">m1.xlarge</span></tt>, <tt class="docutils literal"><span class="pre">c1.medium</span></tt>,
and <tt class="docutils literal"><span class="pre">c1.xlarge</span></tt>; see the EC2 documentation for descriptions of these
machines).</p>
<p>Here is the simplest example of configuring an EC2 latent buildslave. It
specifies all necessary remaining values explicitly in the instantiation.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.ec2buildslave</span> <span class="kn">import</span> <span class="n">EC2LatentBuildSlave</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">EC2LatentBuildSlave</span><span class="p">(</span><span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s">&#39;m1.large&#39;</span><span class="p">,</span>
                                   <span class="n">ami</span><span class="o">=</span><span class="s">&#39;ami-12345&#39;</span><span class="p">,</span>
                                   <span class="n">identifier</span><span class="o">=</span><span class="s">&#39;publickey&#39;</span><span class="p">,</span>
                                   <span class="n">secret_identifier</span><span class="o">=</span><span class="s">&#39;privatekey&#39;</span>
                                   <span class="p">)]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">ami</span></tt> argument specifies the AMI that the master should start.  The
<tt class="docutils literal"><span class="pre">identifier</span></tt> argument specifies the AWS <cite>Access Key Id</cite>, and the
<tt class="docutils literal"><span class="pre">secret_identifier</span></tt> specifies the AWS <cite>Secret Access Key.</cite> Both the AMI and
the account information can be specified in alternate ways.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Whoever has your <tt class="docutils literal"><span class="pre">identifier</span></tt> and <tt class="docutils literal"><span class="pre">secret_identifier</span></tt> values can request
AWS work charged to your account, so these values need to be carefully
protected. Another way to specify these access keys is to put them in a
separate file. You can then make the access privileges stricter for this
separate file, and potentially let more people read your main configuration
file.</p>
</div>
<p>By default, you can make an <tt class="file docutils literal"><span class="pre">.ec2</span></tt> directory in the home folder of the user
running the buildbot master. In that directory, create a file called <tt class="file docutils literal"><span class="pre">aws_id</span></tt>.
The first line of that file should be your access key id; the second line
should be your secret access key id. Then you can instantiate the build slave
as follows.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.ec2buildslave</span> <span class="kn">import</span> <span class="n">EC2LatentBuildSlave</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">EC2LatentBuildSlave</span><span class="p">(</span><span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s">&#39;m1.large&#39;</span><span class="p">,</span>
                                   <span class="n">ami</span><span class="o">=</span><span class="s">&#39;ami-12345&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>If you want to put the key information in another file, use the
<tt class="docutils literal"><span class="pre">aws_id_file_path</span></tt> initialization argument.</p>
<p>Previous examples used a particular AMI.  If the Buildbot master will be
deployed in a process-controlled environment, it may be convenient to
specify the AMI more flexibly.  Rather than specifying an individual AMI,
specify one or two AMI filters.</p>
<p>In all cases, the AMI that sorts last by its location (the S3 bucket and
manifest name) will be preferred.</p>
<p>One available filter is to specify the acceptable AMI owners, by AWS account
number (the 12 digit number, usually rendered in AWS with hyphens like
&quot;1234-5678-9012&quot;, should be entered as in integer).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.ec2buildslave</span> <span class="kn">import</span> <span class="n">EC2LatentBuildSlave</span>
<span class="n">bot1</span> <span class="o">=</span> <span class="n">EC2LatentBuildSlave</span><span class="p">(</span><span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s">&#39;m1.large&#39;</span><span class="p">,</span>
                           <span class="n">valid_ami_owners</span><span class="o">=</span><span class="p">[</span><span class="mi">11111111111</span><span class="p">,</span>
                                             <span class="mi">22222222222</span><span class="p">],</span>
                           <span class="n">identifier</span><span class="o">=</span><span class="s">&#39;publickey&#39;</span><span class="p">,</span>
                           <span class="n">secret_identifier</span><span class="o">=</span><span class="s">&#39;privatekey&#39;</span>
                           <span class="p">)</span>
</pre></div>
</div>
<p>The other available filter is to provide a regular expression string that
will be matched against each AMI's location (the S3 bucket and manifest name).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.ec2buildslave</span> <span class="kn">import</span> <span class="n">EC2LatentBuildSlave</span>
<span class="n">bot1</span> <span class="o">=</span> <span class="n">EC2LatentBuildSlave</span><span class="p">(</span>
    <span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s">&#39;m1.large&#39;</span><span class="p">,</span>
    <span class="n">valid_ami_location_regex</span><span class="o">=</span><span class="s">r&#39;buildbot\-.*/image.manifest.xml&#39;</span><span class="p">,</span>
    <span class="n">identifier</span><span class="o">=</span><span class="s">&#39;publickey&#39;</span><span class="p">,</span> <span class="n">secret_identifier</span><span class="o">=</span><span class="s">&#39;privatekey&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The regular expression can specify a group, which will be preferred for the
sorting.  Only the first group is used; subsequent groups are ignored.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.ec2buildslave</span> <span class="kn">import</span> <span class="n">EC2LatentBuildSlave</span>
<span class="n">bot1</span> <span class="o">=</span> <span class="n">EC2LatentBuildSlave</span><span class="p">(</span>
    <span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s">&#39;m1.large&#39;</span><span class="p">,</span>
    <span class="n">valid_ami_location_regex</span><span class="o">=</span><span class="s">r&#39;buildbot\-.*\-(.*)/image.manifest.xml&#39;</span><span class="p">,</span>
    <span class="n">identifier</span><span class="o">=</span><span class="s">&#39;publickey&#39;</span><span class="p">,</span> <span class="n">secret_identifier</span><span class="o">=</span><span class="s">&#39;privatekey&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the group can be cast to an integer, it will be.  This allows 10 to sort
after 1, for instance.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.ec2buildslave</span> <span class="kn">import</span> <span class="n">EC2LatentBuildSlave</span>
<span class="n">bot1</span> <span class="o">=</span> <span class="n">EC2LatentBuildSlave</span><span class="p">(</span>
    <span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s">&#39;m1.large&#39;</span><span class="p">,</span>
    <span class="n">valid_ami_location_regex</span><span class="o">=</span><span class="s">r&#39;buildbot\-.*\-(\d+)/image.manifest.xml&#39;</span><span class="p">,</span>
    <span class="n">identifier</span><span class="o">=</span><span class="s">&#39;publickey&#39;</span><span class="p">,</span> <span class="n">secret_identifier</span><span class="o">=</span><span class="s">&#39;privatekey&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In addition to using the password as a handshake between the master and the
slave, you may want to use a firewall to assert that only machines from a
specific IP can connect as slaves.  This is possible with AWS EC2 by using
the Elastic IP feature.  To configure, generate a Elastic IP in AWS, and then
specify it in your configuration using the <tt class="docutils literal"><span class="pre">elastic_ip</span></tt> argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.ec2buildslave</span> <span class="kn">import</span> <span class="n">EC2LatentBuildSlave</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">EC2LatentBuildSlave</span><span class="p">(</span><span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;sekrit&#39;</span><span class="p">,</span> <span class="s">&#39;m1.large&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;ami-12345&#39;</span><span class="p">,</span>
                                   <span class="n">identifier</span><span class="o">=</span><span class="s">&#39;publickey&#39;</span><span class="p">,</span>
                                   <span class="n">secret_identifier</span><span class="o">=</span><span class="s">&#39;privatekey&#39;</span><span class="p">,</span>
                                   <span class="n">elastic_ip</span><span class="o">=</span><span class="s">&#39;208.77.188.166&#39;</span>
                                   <span class="p">)]</span>
</pre></div>
</div>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">EC2LatentBuildSlave</span></tt> supports all other configuration from the standard
<tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>.  The <tt class="docutils literal"><span class="pre">missing_timeout</span></tt> and <tt class="docutils literal"><span class="pre">notify_on_missing</span></tt> specify how long
to wait for an EC2 instance to attach before considering the attempt to have
failed, and email addresses to alert, respectively.  <tt class="docutils literal"><span class="pre">missing_timeout</span></tt>
defaults to 20 minutes.</p>
<p><tt class="docutils literal"><span class="pre">keypair_name</span></tt> and <tt class="docutils literal"><span class="pre">security_name</span></tt> allow you to specify different names for
these AWS EC2 values.  They both default to <tt class="docutils literal"><span class="pre">latent_buildbot_slave</span></tt>.</p>
</div>
</div>
<div class="section" id="libvirt">
<span id="index-4"></span><h6>Libvirt<a class="headerlink" href="#libvirt" title="Permalink to this headline">¶</a></h6>
<p><a class="reference external" href="http://www.libvirt.org/">libvirt</a> is a virtualization API for interacting
with the virtualization capabilities of recent versions of Linux and other OSes.
It is LGPL and comes with a stable C API, and python bindings.</p>
<p>This means we know have an API which when tied to buildbot allows us to have slaves
that run under Xen, QEMU, KVM, LXC, OpenVZ, User Mode Linux, VirtualBox and VMWare.</p>
<p>The libvirt code in Buildbot was developed against libvirt 0.7.5 on Ubuntu Lucid. It
is used with KVM to test python code on Karmic VM's, but obviously isn't limited to that.
Each build is run on a new VM, images are temporary and thrown away after each build.</p>
<div class="section" id="setting-up-libvirt">
<h7>Setting up libvirt<a class="headerlink" href="#setting-up-libvirt" title="Permalink to this headline">¶</a></h7>
<p>We won't show you how to set up libvirt as it is quite different on each platform,
but there are a few things you should keep in mind.</p>
<blockquote>
<div><ul class="simple">
<li>If you are running on Ubuntu, your master should run Lucid. Libvirt and apparmor are
buggy on Karmic.</li>
<li>If you are using the system libvirt, your buildbot master user will need to be in the
libvirtd group.</li>
<li>If you are using KVM, your buildbot master user will need to be in the KVM group.</li>
<li>You need to think carefully about your virtual network <em>first</em>. Will NAT be enough?
What IP will my VM's need to connect to for connecting to the master?</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configuring-your-base-image">
<h7>Configuring your base image<a class="headerlink" href="#configuring-your-base-image" title="Permalink to this headline">¶</a></h7>
<p>You need to create a base image for your builds that has everything needed to build
your software. You need to configure the base image with a buildbot slave that is configured
to connect to the master on boot.</p>
<p>Because this image may need updating a lot, we strongly suggest scripting its creation.</p>
<p>If you want to have multiple slaves using the same base image it can be annoying to duplicate
the image just to change the buildbot credentials. One option is to use libvirt's DHCP
server to allocate an identity to the slave: DHCP sets a hostname, and the slave takes its
identity from that.</p>
<p>Doing all this is really beyond the scope of the manual, but there is a <tt class="file docutils literal"><span class="pre">vmbuilder</span></tt> script
and a <tt class="file docutils literal"><span class="pre">network.xml</span></tt> file to create such a DHCP server in
<tt class="file docutils literal"><span class="pre">contrib/</span></tt> (<a class="reference internal" href="#contrib-scripts"><em>Contrib Scripts</em></a>)
that should get you started:</p>
<div class="highlight-bash"><div class="highlight"><pre>sudo apt-get install ubuntu-vm-builder
sudo contrib/libvirt/vmbuilder
</pre></div>
</div>
<p>Should create an <tt class="file docutils literal"><span class="pre">ubuntu/</span></tt> folder with a suitable image in it.</p>
<div class="highlight-none"><div class="highlight"><pre>virsh net-define contrib/libvirt/network.xml
virsh net-start buildbot-network
</pre></div>
</div>
<p>Should set up a KVM compatible libvirt network for your buildbot VM's to run on.</p>
</div>
<div class="section" id="configuring-your-master">
<h7>Configuring your Master<a class="headerlink" href="#configuring-your-master" title="Permalink to this headline">¶</a></h7>
<p>If you want to add a simple on demand VM to your setup, you only need the following. We
set the username to <tt class="docutils literal"><span class="pre">minion1</span></tt>, the password to <tt class="docutils literal"><span class="pre">sekrit</span></tt>. The base image is called <tt class="docutils literal"><span class="pre">base_image</span></tt>
and a copy of it will be made for the duration of the VM's life. That copy will be thrown
away every time a build is complete.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.libvirtbuildslave</span> <span class="kn">import</span> <span class="n">LibVirtBuildSlave</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;slaves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">LibVirtBuildSlave</span><span class="p">(</span><span class="s">&#39;minion1&#39;</span><span class="p">,</span> <span class="s">&#39;sekrit&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;/home/buildbot/images/minion1&#39;</span><span class="p">,</span> <span class="s">&#39;/home/buildbot/images/base_image&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>You can use virt-manager to define <tt class="docutils literal"><span class="pre">minion1</span></tt> with the correct hardware. If you don't, buildbot
won't be able to find a VM to start.</p>
<p><tt class="xref py py-class docutils literal"><span class="pre">LibVirtBuildSlave</span></tt> accepts the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd>Both a buildbot username and the name of the virtual machine</dd>
<dt><tt class="docutils literal"><span class="pre">password</span></tt></dt>
<dd>A password for the buildbot to login to the master with</dd>
<dt><tt class="docutils literal"><span class="pre">hd_image</span></tt></dt>
<dd>The path to a libvirt disk image, normally in qcow2 format when using KVM.</dd>
<dt><tt class="docutils literal"><span class="pre">base_image</span></tt></dt>
<dd>If given a base image, buildbot will clone it every time it starts a VM.
This means you always have a clean environment to do your build in.</dd>
<dt><tt class="docutils literal"><span class="pre">xml</span></tt></dt>
<dd>If a VM isn't predefined in virt-manager, then you can instead provide XML
like that used with <tt class="docutils literal"><span class="pre">virsh</span> <span class="pre">define</span></tt>. The VM will be created
automatically when needed, and destroyed when not needed any longer.</dd>
</dl>
</div>
</div>
<div class="section" id="dangers-with-latent-buildslaves">
<h6>Dangers with Latent Buildslaves<a class="headerlink" href="#dangers-with-latent-buildslaves" title="Permalink to this headline">¶</a></h6>
<p>Any latent build slave that interacts with a for-fee service, such as the
EC2LatentBuildSlave, brings significant risks. As already identified, the
configuration will need access to account information that, if obtained by a
criminal, can be used to charge services to your account. Also, bugs in the
buildbot software may lead to unnecessary charges. In particular, if the
master neglects to shut down an instance for some reason, a virtual machine
may be running unnecessarily, charging against your account. Manual and/or
automatic (e.g. nagios with a plugin using a library like boto)
double-checking may be appropriate.</p>
<p>A comparatively trivial note is that currently if two instances try to attach
to the same latent buildslave, it is likely that the system will become
confused.  This should not occur, unless, for instance, you configure a normal
build slave to connect with the authentication of a latent buildbot.  If this
situation does occurs, stop all attached instances and restart the master.</p>
</div>
</div>
</div>
<span id="document-manual/cfg-builders"></span><div class="section" id="builder-configuration">
<span id="cfg-builders"></span><span id="id1"></span><h4>Builder Configuration<a class="headerlink" href="#builder-configuration" title="Permalink to this headline">¶</a></h4>
<p>The <a class="reference internal" href="#cfg-builders" title="builders"><tt class="xref bb bb-cfg docutils literal"><span class="pre">builders</span></tt></a> configuration key is a list of objects giving
configuration for the Builders.  For more information on the function of
Builders in Buildbot, see <a class="reference internal" href="#builder"><em>the Concepts chapter</em></a>.  The class
definition for the builder configuration is in <tt class="file docutils literal"><span class="pre">buildbot.config</span></tt>.  In the
configuration file, its use looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.config</span> <span class="kn">import</span> <span class="n">BuilderConfig</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;quick&#39;</span><span class="p">,</span> <span class="n">slavenames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;bot2&#39;</span><span class="p">],</span> <span class="n">factory</span><span class="o">=</span><span class="n">f_quick</span><span class="p">),</span>
    <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;thorough&#39;</span><span class="p">,</span> <span class="n">slavename</span><span class="o">=</span><span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">f_thorough</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">BuilderConfig</span></tt> takes the following keyword arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd>This specifies the Builder's name, which is used in status reports.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">slavename</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">slavenames</span></tt></dt>
<dd>These arguments specify the buildslave or buildslaves that will be used by
this Builder.  All slaves names must appear in the <a class="reference internal" href="#cfg-slaves" title="slaves"><tt class="xref bb bb-cfg docutils literal"><span class="pre">slaves</span></tt></a>
configuration parameter. Each buildslave can accomodate multiple
builders.  The <tt class="docutils literal"><span class="pre">slavenames</span></tt> parameter can be a list of names,
while <tt class="docutils literal"><span class="pre">slavename</span></tt> can specify only one slave.</dd>
<dt><tt class="docutils literal"><span class="pre">factory</span></tt></dt>
<dd>This is a <tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.factory.BuildFactory</span></tt> instance which
controls how the build is performed by defining the steps in the build.
Full details appear in their own section, <a class="reference internal" href="#build-factories"><em>Build Factories</em></a>.</dd>
</dl>
<p>Other optional keys may be set on each <tt class="docutils literal"><span class="pre">BuilderConfig</span></tt>:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">builddir</span></tt></dt>
<dd>Specifies the name of a subdirectory of the master's basedir in which
everything related to this builder will be stored.  This holds build status
information. If not set, this parameter defaults to the builder name, with
some characters escaped. Each builder must have a unique build directory.</dd>
<dt><tt class="docutils literal"><span class="pre">slavebuilddir</span></tt></dt>
<dd>Specifies the name of a subdirectory (under the slave's configured base
directory) in which everything related to this builder will be placed on
the buildslave.  This is where checkouts, compiles, and tests are run. If
not set, defaults to <tt class="docutils literal"><span class="pre">builddir</span></tt>. If a slave is connected to multiple
builders that share the same <tt class="docutils literal"><span class="pre">slavebuilddir</span></tt>, make sure the slave is set
to run one build at a time or ensure this is fine to run multiple builds
from the same directory simultaneously.</dd>
<dt><tt class="docutils literal"><span class="pre">category</span></tt></dt>
<dd>If provided, this is a string that identifies a category for the
builder to be a part of. Status clients can limit themselves to a
subset of the available categories. A common use for this is to add
new builders to your setup (for a new module, or for a new buildslave)
that do not work correctly yet and allow you to integrate them with
the active builders. You can put these new builders in a test
category, make your main status clients ignore them, and have only
private status clients pick them up. As soon as they work, you can
move them over to the active category.</dd>
<dt><tt class="docutils literal"><span class="pre">nextSlave</span></tt></dt>
<dd>If provided, this is a function that controls which slave will be assigned
future jobs. The function is passed two arguments, the <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>
object which is assigning a new job, and a list of <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>
objects. The function should return one of the <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>
objects, or <tt class="docutils literal"><span class="pre">None</span></tt> if none of the available slaves should be
used.</dd>
<dt><tt class="docutils literal"><span class="pre">nextBuild</span></tt></dt>
<dd>If provided, this is a function that controls which build request will be
handled next. The function is passed two arguments, the <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>
object which is assigning a new job, and a list of <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>
objects of pending builds. The function should return one of the
<tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> objects, or <tt class="docutils literal"><span class="pre">None</span></tt> if none of the pending
builds should be started. This function can optionally return a
Deferred which should fire with the same results.</dd>
<dt><tt class="docutils literal"><span class="pre">locks</span></tt></dt>
<dd>This argument specifies a list of locks that apply to this builder; see
<a class="reference internal" href="#interlocks"><em>Interlocks</em></a>.</dd>
<dt><tt class="docutils literal"><span class="pre">env</span></tt></dt>
<dd><p class="first">A Builder may be given a dictionary of environment variables in this parameter.
The variables are used in <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a> steps in builds created by this
builder. The environment variables will override anything in the buildslave's
environment. Variables passed directly to a <tt class="xref py py-class docutils literal"><span class="pre">ShellCommand</span></tt> will override
variables of the same name passed to the Builder.</p>
<p>For example, if you have a pool of identical slaves it is often easier to manage
variables like <span class="target" id="index-0"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt> from Buildbot rather than manually editing it inside of
the slaves' environment.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;bash&#39;</span><span class="p">,</span> <span class="s">&#39;./configure&#39;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Compile</span><span class="p">())</span>

<span class="n">c</span><span class="p">[</span><span class="s">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
  <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;test&#39;</span><span class="p">,</span> <span class="n">factory</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
        <span class="n">slavenames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;slave1&#39;</span><span class="p">,</span> <span class="s">&#39;slave2&#39;</span><span class="p">,</span> <span class="s">&#39;slave3&#39;</span><span class="p">,</span> <span class="s">&#39;slave4&#39;</span><span class="p">],</span>
        <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;PATH&#39;</span><span class="p">:</span> <span class="s">&#39;/opt/local/bin:/opt/app/bin:/usr/local/bin:/usr/bin&#39;</span><span class="p">}),</span>
<span class="p">]</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-1">
<dt><tt class="docutils literal"><span class="pre">mergeRequests</span></tt></dt>
<dd>Specifies how build requests for this builder should be merged. See
<a class="reference internal" href="#merging-build-requests"><em>Merging Build Requests</em></a>, below.</dd>
</dl>
<dl class="docutils" id="index-2">
<dt><tt class="docutils literal"><span class="pre">properties</span></tt></dt>
<dd>A builder may be given a dictionary of <a class="reference internal" href="#build-properties"><em>Build Properties</em></a>
specific for this builder in this parameter. Those values can be used
later on like other properties. <a class="reference internal" href="#interpolate"><em>Interpolate</em></a>.</dd>
</dl>
<div class="section" id="merging-build-requests">
<span id="index-3"></span><span id="id2"></span><h5>Merging Build Requests<a class="headerlink" href="#merging-build-requests" title="Permalink to this headline">¶</a></h5>
<p>When more than one build request is available for a builder, Buildbot can
&quot;merge&quot; the requests into a single build.  This is desirable when build
requests arrive more quickly than the available slaves can satisfy them, but
has the drawback that separate results for each build are not available.</p>
<p>Requests are only candidated for a merge if both requests have exactly the same
<a class="reference internal" href="#attr-codebase"><em>codebases</em></a>.</p>
<p>This behavior can be controlled globally, using the <a class="reference internal" href="#cfg-mergeRequests" title="mergeRequests"><tt class="xref bb bb-cfg docutils literal"><span class="pre">mergeRequests</span></tt></a>
parameter, and on a per-<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> basis, using the <tt class="docutils literal"><span class="pre">mergeRequests</span></tt> argument
to the <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> configuration.  If <tt class="docutils literal"><span class="pre">mergeRequests</span></tt> is given, it completely
overrides the global configuration.</p>
<p>For either configuration parameter, a value of <tt class="docutils literal"><span class="pre">True</span></tt> (the default) causes
buildbot to merge BuildRequests that have &quot;compatible&quot; source stamps.  Source
stamps are compatible if:</p>
<ul class="simple">
<li>their codebase, branch, project, and repository attributes match exactly;</li>
<li>neither source stamp has a patch (e.g., from a try scheduler); and</li>
<li>either both source stamps are associated with changes, or neither ar
associated with changes but they have matching revisions.</li>
</ul>
<p>This algorithm is implemented by the <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt> method <tt class="xref py py-func docutils literal"><span class="pre">canBeMergedWith</span></tt>.</p>
<p>A configuration value of <tt class="docutils literal"><span class="pre">False</span></tt> indicates that requests should never be
merged.</p>
<p>The configuration value can also be a callable, specifying a custom merging
function.  See <a class="reference internal" href="#merge-request-functions"><em>Merge Request Functions</em></a> for details.</p>
</div>
<div class="section" id="prioritizing-builds">
<span id="index-4"></span><span id="id3"></span><h5>Prioritizing Builds<a class="headerlink" href="#prioritizing-builds" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">BuilderConfig</span></tt> parameter <tt class="docutils literal"><span class="pre">nextBuild</span></tt> can be use to prioritize
build requests within a builder. Note that this is orthogonal to
<a class="reference internal" href="#prioritizing-builders"><em>Prioritizing Builders</em></a>, which controls the order in which builders are
called on to start their builds.  The details of writing such a function are in
<a class="reference internal" href="#build-priority-functions"><em>Build Priority Functions</em></a>.</p>
<p>Such a function can be provided to the BuilderConfig as follows:</p>
<div class="highlight-python"><pre>def pickNextBuild(builder, requests):
    # ...
c['builders'] = [
    BuilderConfig(name='test', factory=f,
        nextBuild=pickNextBuild,
        slavenames=['slave1', 'slave2', 'slave3', 'slave4']),
]</pre>
</div>
</div>
</div>
<span id="document-manual/cfg-buildfactories"></span><div class="section" id="build-factories">
<span id="id1"></span><h4>Build Factories<a class="headerlink" href="#build-factories" title="Permalink to this headline">¶</a></h4>
<p>Each Builder is equipped with a <tt class="docutils literal"><span class="pre">build</span> <span class="pre">factory</span></tt>, which is defines the steps
used to perform that particular type of build.  This factory is created in the
configuration file, and attached to a Builder through the <tt class="docutils literal"><span class="pre">factory</span></tt> element
of its dictionary.</p>
<p>The steps used by these builds are defined in the next section, <a class="reference internal" href="#build-steps"><em>Build Steps</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Build factories are used with builders, and are not added directly to the
buildmaster configuration dictionary.</p>
</div>
<span class="target" id="buildfactory"></span><div class="section" id="defining-a-build-factory">
<span id="index-0"></span><h5>Defining a Build Factory<a class="headerlink" href="#defining-a-build-factory" title="Permalink to this headline">¶</a></h5>
<p>A <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt> defines the steps that every build will follow.  Think of it as
a glorified script.  For example, a build factory which consists of a CVS checkout
followed by a <tt class="docutils literal"><span class="pre">make</span> <span class="pre">build</span></tt> would be configured as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps</span> <span class="kn">import</span> <span class="n">svn</span><span class="p">,</span> <span class="n">shell</span>
<span class="kn">from</span> <span class="nn">buildbot.process</span> <span class="kn">import</span> <span class="n">factory</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">svn</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;http://..&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;incremental&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;build&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>This factory would then be attached to one builder (or several, if desired):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;builders&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">BuilderConfig</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;quick&#39;</span><span class="p">,</span> <span class="n">slavenames</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;bot1&#39;</span><span class="p">,</span> <span class="s">&#39;bot2&#39;</span><span class="p">],</span> <span class="n">factory</span><span class="o">=</span><span class="n">f</span><span class="p">))</span>
</pre></div>
</div>
<p>It is also possible to pass a list of steps into the
<tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt> when it is created. Using <tt class="xref py py-meth docutils literal"><span class="pre">addStep</span></tt> is
usually simpler, but there are cases where is is more convenient to
create the list of steps ahead of time, perhaps using some Python
tricks to generate the steps.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps</span> <span class="kn">import</span> <span class="n">source</span><span class="p">,</span> <span class="n">shell</span>
<span class="kn">from</span> <span class="nn">buildbot.process</span> <span class="kn">import</span> <span class="n">factory</span>

<span class="n">all_steps</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">source</span><span class="o">.</span><span class="n">CVS</span><span class="p">(</span><span class="n">cvsroot</span><span class="o">=</span><span class="n">CVSROOT</span><span class="p">,</span> <span class="n">cvsmodule</span><span class="o">=</span><span class="s">&quot;project&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;update&quot;</span><span class="p">),</span>
    <span class="n">shell</span><span class="o">.</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;build&quot;</span><span class="p">]),</span>
<span class="p">]</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">(</span><span class="n">all_steps</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can also add a sequence of steps all at once:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">addSteps</span><span class="p">(</span><span class="n">all_steps</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="attributes">
<h6>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h6>
<p>The following attributes can be set on a build factory after it is created, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">useProgress</span> <span class="o">=</span> <span class="bp">False</span>
</pre></div>
</div>
<dl class="docutils">
<dt><tt class="xref py py-attr docutils literal"><span class="pre">useProgress</span></tt></dt>
<dd>(defaults to <tt class="docutils literal"><span class="pre">True</span></tt>): if <tt class="docutils literal"><span class="pre">True</span></tt>, the buildmaster keeps track of how long
each step takes, so it can provide estimates of how long future builds
will take. If builds are not expected to take a consistent amount of
time (such as incremental builds in which a random set of files are
recompiled or tested each time), this should be set to <tt class="docutils literal"><span class="pre">False</span></tt> to
inhibit progress-tracking.</dd>
<dt><tt class="xref py py-attr docutils literal"><span class="pre">workdir</span></tt></dt>
<dd><p class="first">(defaults to 'build'): workdir given to every build step created by
this factory as default. The workdir can be overridden in a build step
definition.</p>
<p class="last">If this attribute is set to a string, that string will be used for
constructing the workdir (buildslave base + builder builddir + workdir).
The attribute can also be a Python callable, for more complex cases, as
described in <a class="reference internal" href="#factory-workdir-functions"><em>Factory Workdir Functions</em></a>.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="predefined-build-factories">
<h5>Predefined Build Factories<a class="headerlink" href="#predefined-build-factories" title="Permalink to this headline">¶</a></h5>
<p>Buildbot includes a few predefined build factories that perform common build
sequences.  In practice, these are rarely used, as every site has slightly
different requirements, but the source for these factories may provide examples
for implementation of those requirements.</p>
<span class="target" id="gnuautoconf"></span><div class="section" id="index-1">
<span id="id2"></span><h6>GNUAutoconf<a class="headerlink" href="#index-1" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.GNUAutoconf">
<em class="property">class </em><tt class="descclassname">buildbot.process.factory.</tt><tt class="descname">GNUAutoconf</tt><a class="headerlink" href="#buildbot.process.factory.GNUAutoconf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://www.gnu.org/software/autoconf/">GNU Autoconf</a> is a
software portability tool, intended to make it possible to write
programs in C (and other languages) which will run on a variety of
UNIX-like systems. Most GNU software is built using autoconf. It is
frequently used in combination with GNU automake. These tools both
encourage a build process which usually looks like this:</p>
<div class="highlight-bash"><div class="highlight"><pre>% <span class="nv">CONFIG_ENV</span><span class="o">=</span>foo ./configure --with-flags
% make all
% make check
<span class="c"># make install</span>
</pre></div>
</div>
<p>(except of course the Buildbot always skips the <tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></tt>
part).</p>
<p>The Buildbot's <a class="reference internal" href="#buildbot.process.factory.GNUAutoconf" title="buildbot.process.factory.GNUAutoconf"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.factory.GNUAutoconf</span></tt></a> factory is
designed to build projects which use GNU autoconf and/or automake. The
configuration environment variables, the configure flags, and command
lines used for the compile and test are all configurable, in general
the default values will be suitable.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">GNUAutoconf</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">svnurl</span><span class="o">=</span><span class="n">URL</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;copy&quot;</span><span class="p">),</span>
                        <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;--disable-nls&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Required Arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd>This argument must be a step specification tuple that provides a
BuildStep to generate the source tree.</dd>
</dl>
<p>Optional Arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">configure</span></tt></dt>
<dd>The command used to configure the tree. Defaults to
<strong class="command">./configure</strong>. Accepts either a string or a list of shell argv
elements.</dd>
<dt><tt class="docutils literal"><span class="pre">configureEnv</span></tt></dt>
<dd>The environment used for the initial configuration step. This accepts
a dictionary which will be merged into the buildslave's normal
environment. This is commonly used to provide things like
<tt class="docutils literal"><span class="pre">CFLAGS=&quot;-O2</span> <span class="pre">-g&quot;</span></tt> (to turn off debug symbols during the compile).
Defaults to an empty dictionary.</dd>
<dt><tt class="docutils literal"><span class="pre">configureFlags</span></tt></dt>
<dd>A list of flags to be appended to the argument list of the configure
command. This is commonly used to enable or disable specific features
of the autoconf-controlled package, like <tt class="docutils literal"><span class="pre">[&quot;--without-x&quot;]</span></tt> to
disable windowing support. Defaults to an empty list.</dd>
<dt><tt class="docutils literal"><span class="pre">compile</span></tt></dt>
<dd>this is a shell command or list of argv values which is used to
actually compile the tree. It defaults to <tt class="docutils literal"><span class="pre">make</span> <span class="pre">all</span></tt>. If set to
<tt class="docutils literal"><span class="pre">None</span></tt>, the compile step is skipped.</dd>
<dt><tt class="docutils literal"><span class="pre">test</span></tt></dt>
<dd>this is a shell command or list of argv values which is used to run
the tree's self-tests. It defaults to &#64;code{make check}. If set to
None, the test step is skipped.</dd>
</dl>
<span class="target" id="basicbuildfactory"></span></div>
<div class="section" id="index-2">
<span id="id3"></span><h6>BasicBuildFactory<a class="headerlink" href="#index-2" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.BasicBuildFactory">
<em class="property">class </em><tt class="descclassname">buildbot.process.factory.</tt><tt class="descname">BasicBuildFactory</tt><a class="headerlink" href="#buildbot.process.factory.BasicBuildFactory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is a subclass of <tt class="xref py py-class docutils literal"><span class="pre">GNUAutoconf</span></tt> which assumes the source is in CVS,
and uses <tt class="docutils literal"><span class="pre">mode='clobber'</span></tt>  to always build from a clean working copy.</p>
<span class="target" id="basicsvn"></span></div>
<div class="section" id="index-3">
<span id="id4"></span><h6>BasicSVN<a class="headerlink" href="#index-3" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.BasicSVN">
<em class="property">class </em><tt class="descclassname">buildbot.process.factory.</tt><tt class="descname">BasicSVN</tt><a class="headerlink" href="#buildbot.process.factory.BasicSVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This class is similar to <tt class="xref py py-class docutils literal"><span class="pre">BasicBuildFactory</span></tt>, but uses SVN instead of CVS.</p>
<span class="target" id="quickbuildfactory"></span></div>
<div class="section" id="index-4">
<span id="id5"></span><h6>QuickBuildFactory<a class="headerlink" href="#index-4" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.QuickBuildFactory">
<em class="property">class </em><tt class="descclassname">buildbot.process.factory.</tt><tt class="descname">QuickBuildFactory</tt><a class="headerlink" href="#buildbot.process.factory.QuickBuildFactory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <tt class="xref py py-class docutils literal"><span class="pre">QuickBuildFactory</span></tt> class is a subclass of <tt class="xref py py-class docutils literal"><span class="pre">GNUAutoconf</span></tt> which
assumes the source is in CVS, and uses <tt class="docutils literal"><span class="pre">mode='update'</span></tt> to get incremental
updates.</p>
<p>The difference between a <cite>full build</cite> and a <cite>quick build</cite> is that
quick builds are generally done incrementally, starting with the tree
where the previous build was performed. That simply means that the
source-checkout step should be given a <tt class="docutils literal"><span class="pre">mode='update'</span></tt> flag, to
do the source update in-place.</p>
<p>In addition to that, this class sets the <tt class="xref py py-attr docutils literal"><span class="pre">useProgress</span></tt> flag to <tt class="docutils literal"><span class="pre">False</span></tt>.
Incremental builds will (or at least the ought to) compile as few files as
necessary, so they will take an unpredictable amount of time to run. Therefore
it would be misleading to claim to predict how long the build will take.</p>
<p>This class is probably not of use to new projects.</p>
<span class="target" id="factory-cpan"></span></div>
<div class="section" id="cpan">
<span id="index-5"></span><h6>CPAN<a class="headerlink" href="#cpan" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.CPAN">
<em class="property">class </em><tt class="descclassname">buildbot.process.factory.</tt><tt class="descname">CPAN</tt><a class="headerlink" href="#buildbot.process.factory.CPAN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Most Perl modules available from the <a class="reference external" href="http://www.cpan.org/">CPAN</a>
archive use the <tt class="docutils literal"><span class="pre">MakeMaker</span></tt> module to provide configuration,
build, and test services. The standard build routine for these modules
looks like:</p>
<div class="highlight-bash"><div class="highlight"><pre>% perl Makefile.PL
% make
% make <span class="nb">test</span>
<span class="c"># make install</span>
</pre></div>
</div>
<p>(except again Buildbot skips the install step)</p>
<p>Buildbot provides a <tt class="xref py py-class docutils literal"><span class="pre">CPAN</span></tt> factory to compile and test these
projects.</p>
<p>Arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd>(required): A step specification tuple, like that used by <tt class="xref py py-class docutils literal"><span class="pre">GNUAutoconf</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">perl</span></tt></dt>
<dd>A string which specifies the <strong class="command">perl</strong> executable to use. Defaults
to just <strong class="command">perl</strong>.</dd>
</dl>
<span class="target" id="distutils"></span></div>
<div class="section" id="index-6">
<span id="id7"></span><h6>Distutils<a class="headerlink" href="#index-6" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.Distutils">
<em class="property">class </em><tt class="descclassname">buildbot.process.factory.</tt><tt class="descname">Distutils</tt><a class="headerlink" href="#buildbot.process.factory.Distutils" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Most Python modules use the <tt class="docutils literal"><span class="pre">distutils</span></tt> package to provide
configuration and build services. The standard build process looks
like:</p>
<div class="highlight-bash"><div class="highlight"><pre>% python ./setup.py build
% python ./setup.py install
</pre></div>
</div>
<p>Unfortunately, although Python provides a standard unit-test framework
named <tt class="docutils literal"><span class="pre">unittest</span></tt>, to the best of my knowledge <tt class="docutils literal"><span class="pre">distutils</span></tt>
does not provide a standardized target to run such unit tests. (Please
let me know if I'm wrong, and I will update this factory.)</p>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">Distutils</span></tt> factory provides support for running the build
part of this process. It accepts the same <tt class="docutils literal"><span class="pre">source=</span></tt> parameter as
the other build factories.</p>
<p>Arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd>(required): A step specification tuple, like that used by <tt class="xref py py-class docutils literal"><span class="pre">GNUAutoconf</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">python</span></tt></dt>
<dd>A string which specifies the <strong class="command">python</strong> executable to use. Defaults
to just <strong class="command">python</strong>.</dd>
<dt><tt class="docutils literal"><span class="pre">test</span></tt></dt>
<dd>Provides a shell command which runs unit tests. This accepts either a
string or a list. The default value is <tt class="docutils literal"><span class="pre">None</span></tt>, which disables the test
step (since there is no common default command to run unit tests in
distutils modules).</dd>
</dl>
<span class="target" id="trial"></span></div>
<div class="section" id="index-7">
<span id="id8"></span><h6>Trial<a class="headerlink" href="#index-7" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.process.factory.Trial">
<em class="property">class </em><tt class="descclassname">buildbot.process.factory.</tt><tt class="descname">Trial</tt><a class="headerlink" href="#buildbot.process.factory.Trial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Twisted provides a unit test tool named <strong class="command">trial</strong> which provides a
few improvements over Python's built-in <tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt> module. Many
python projects which use Twisted for their networking or application
services also use trial for their unit tests. These modules are
usually built and tested with something like the following:</p>
<div class="highlight-bash"><div class="highlight"><pre>% python ./setup.py build
% <span class="nv">PYTHONPATH</span><span class="o">=</span>build/lib.linux-i686-2.3 trial -v PROJECTNAME.test
% python ./setup.py install
</pre></div>
</div>
<p>Unfortunately, the <tt class="file docutils literal"><span class="pre">build/lib</span></tt> directory into which the
built/copied <tt class="docutils literal"><span class="pre">.py</span></tt> files are placed is actually architecture-dependent,
and I do not yet know of a simple way to calculate its value. For many
projects it is sufficient to import their libraries <cite>in place</cite> from
the tree's base directory (<tt class="docutils literal"><span class="pre">PYTHONPATH=.</span></tt>).</p>
<p>In addition, the <tt class="samp docutils literal"><em><span class="pre">PROJECTNAME</span></em></tt> value where the test files are
located is project-dependent: it is usually just the project's
top-level library directory, as common practice suggests the unit test
files are put in the <tt class="xref py py-mod docutils literal"><span class="pre">test</span></tt> sub-module. This value cannot be
guessed, the <tt class="xref py py-class docutils literal"><span class="pre">Trial</span></tt> class must be told where to find the test
files.</p>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">Trial</span></tt> class provides support for building and testing
projects which use distutils and trial. If the test module name is
specified, trial will be invoked. The library path used for testing
can also be set.</p>
<p>One advantage of trial is that the Buildbot happens to know how to
parse trial output, letting it identify which tests passed and which
ones failed. The Buildbot can then provide fine-grained reports about
how many tests have failed, when individual tests fail when they had
been passing previously, etc.</p>
<p>Another feature of trial is that you can give it a series of source
<tt class="docutils literal"><span class="pre">.py</span></tt> files, and it will search them for special <tt class="docutils literal"><span class="pre">test-case-name</span></tt>
tags that indicate which test cases provide coverage for that file.
Trial can then run just the appropriate tests. This is useful for
quick builds, where you want to only run the test cases that cover the
changed functionality.</p>
<p>Arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">testpath</span></tt></dt>
<dd>Provides a directory to add to <span class="target" id="index-8"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> when running the unit
tests, if tests are being run. Defaults to <tt class="docutils literal"><span class="pre">.</span></tt> to include the
project files in-place. The generated build library is frequently
architecture-dependent, but may simply be <tt class="file docutils literal"><span class="pre">build/lib</span></tt> for
pure-python modules.</dd>
<dt><tt class="docutils literal"><span class="pre">python</span></tt></dt>
<dd>which python executable to use. This list will form the start of
the <cite>argv</cite> array that will launch trial. If you use this,
you should set <tt class="docutils literal"><span class="pre">trial</span></tt> to an explicit path (like
<tt class="file docutils literal"><span class="pre">/usr/bin/trial</span></tt> or <tt class="file docutils literal"><span class="pre">./bin/trial</span></tt>). The parameter defaults
to <tt class="docutils literal"><span class="pre">None</span></tt>, which
leaves it out entirely (running <tt class="docutils literal"><span class="pre">trial</span> <span class="pre">args</span></tt> instead of
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">./bin/trial</span> <span class="pre">args</span></tt>). Likely values are <tt class="docutils literal"><span class="pre">['python']</span></tt>,
<tt class="docutils literal"><span class="pre">['python2.2']</span></tt>, or <tt class="docutils literal"><span class="pre">['python',</span> <span class="pre">'-Wall']</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">trial</span></tt></dt>
<dd>provides the name of the <strong class="command">trial</strong> command. It is occasionally
useful to use an alternate executable, such as <strong class="command">trial2.2</strong> which
might run the tests under an older version of Python. Defaults to
<strong class="command">trial</strong>.</dd>
<dt><tt class="docutils literal"><span class="pre">trialMode</span></tt></dt>
<dd>a list of arguments to pass to trial, specifically to set the reporting mode.
This defaults to <tt class="docutils literal"><span class="pre">['--reporter=bwverbose']</span></tt>, which only works for
Twisted-2.1.0 and later.</dd>
<dt><tt class="docutils literal"><span class="pre">trialArgs</span></tt></dt>
<dd>a list of arguments to pass to trial, available to turn on any extra flags you
like. Defaults to <tt class="docutils literal"><span class="pre">[]</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">tests</span></tt></dt>
<dd>Provides a module name or names which contain the unit tests for this
project. Accepts a string, typically <tt class="samp docutils literal"><em><span class="pre">PROJECTNAME</span></em><span class="pre">.test</span></tt>, or a
list of strings. Defaults to <tt class="docutils literal"><span class="pre">None</span></tt>, indicating that no tests should be
run. You must either set this or <tt class="docutils literal"><span class="pre">testChanges</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">testChanges</span></tt></dt>
<dd>if <tt class="docutils literal"><span class="pre">True</span></tt>, ignore the <tt class="docutils literal"><span class="pre">tests</span></tt> parameter and instead ask the Build for all
the files that make up the Changes going into this build. Pass these filenames
to trial and ask it to look for test-case-name tags, running just the tests
necessary to cover the changes.</dd>
<dt><tt class="docutils literal"><span class="pre">recurse</span></tt></dt>
<dd>If <tt class="docutils literal"><span class="pre">True</span></tt>, tells Trial (with the <tt class="docutils literal"><span class="pre">--recurse</span></tt> argument) to look in all
subdirectories for additional test cases.</dd>
<dt><tt class="docutils literal"><span class="pre">reactor</span></tt></dt>
<dd>which reactor to use, like 'gtk' or 'java'. If not provided, the Twisted's
usual platform-dependent default is used.</dd>
<dt><tt class="docutils literal"><span class="pre">randomly</span></tt></dt>
<dd>If <tt class="docutils literal"><span class="pre">True</span></tt>, tells Trial (with the <tt class="docutils literal"><span class="pre">--random=0</span></tt> argument) to
run the test cases in random order, which sometimes catches subtle
inter-test dependency bugs. Defaults to <tt class="docutils literal"><span class="pre">False</span></tt>.</dd>
</dl>
<p>The step can also take any of the <tt class="xref py py-class docutils literal"><span class="pre">ShellCommand</span></tt> arguments, e.g.,
<tt class="xref py py-attr docutils literal"><span class="pre">haltOnFailure</span></tt>.</p>
<p>Unless one of <tt class="docutils literal"><span class="pre">tests</span></tt> or <tt class="docutils literal"><span class="pre">testChanges</span></tt> are set, the step will
generate an exception.</p>
</div>
</div>
</div>
<span id="document-manual/cfg-properties"></span><div class="section" id="properties">
<span id="index-0"></span><span id="id1"></span><h4>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h4>
<p>Build properties are a generalized way to provide configuration information to
build steps; see <a class="reference internal" href="#build-properties"><em>Build Properties</em></a> for the conceptual overview of
properties.</p>
<p>Some build properties come from external sources and are set before the build
begins; others are set during the build, and available for later steps.  The
sources for properties are:</p>
<ul class="simple">
<li><a class="reference internal" href="#cfg-properties" title="properties"><tt class="xref bb bb-cfg docutils literal"><span class="pre">global</span> <span class="pre">configuration</span></tt></a> -- These properties apply to all
builds.</li>
<li><a class="reference internal" href="#configuring-schedulers"><em>schedulers</em></a> -- A scheduler can specify
properties that become available to all builds it starts.</li>
<li><a class="reference internal" href="#change-sources"><em>changes</em></a> -- A change can have properties attached to
it, supplying extra information gathered by the change source.  This is most
commonly used with the <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">sendchange</span></tt></a> command.</li>
<li><a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">forced</span> <span class="pre">builds</span></tt></a> -- The &quot;Force Build&quot; form allows users
to specify properties</li>
<li><a class="reference internal" href="#cfg-slaves" title="slaves"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildslaves</span></tt></a> -- A buildslave can pass properties on to
the builds it performs.</li>
<li><a class="reference internal" href="#common-build-properties"><em>builds</em></a> -- A build automatically sets a
number of properties on itself.</li>
<li><a class="reference internal" href="#cfg-builders" title="builders"><tt class="xref bb bb-cfg docutils literal"><span class="pre">builders</span></tt></a> -- A builder can set properties on all the
builds it runs.</li>
<li><a class="reference internal" href="#build-steps"><em>steps</em></a> -- The steps of a build can set properties that are available to subsequent steps.
In particular, source steps set the <cite>got_revision</cite> property.</li>
</ul>
<p>If the same property is supplied in multiple places, the final appearance takes
precedence.  For example, a property set in a builder configuration will
override one supplied by a scheduler.</p>
<p>Properties are stored internally in JSON format, so they are limited to basic
types of data: numbers, strings, lists, and dictionaries.</p>
<div class="section" id="common-build-properties">
<span id="index-1"></span><span id="id2"></span><h5>Common Build Properties<a class="headerlink" href="#common-build-properties" title="Permalink to this headline">¶</a></h5>
<p>The following build properties are set when the build is started, and
are available to all steps.</p>
<dl class="docutils" id="index-2">
<dt><tt class="docutils literal"><span class="pre">got_revision</span></tt></dt>
<dd><p class="first">This property is set when a <tt class="xref py py-class docutils literal"><span class="pre">Source</span></tt> step checks out the source tree, and provides the revision that was actually obtained from the VC system.
In general this should be the same as <tt class="docutils literal"><span class="pre">revision</span></tt>, except for non-absolute sourcestamps, where <tt class="docutils literal"><span class="pre">got_revision</span></tt> indicates what revision was current when the checkout was performed.
This can be used to rebuild the same source code later.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For some VC systems (Darcs in particular), the revision is a
large string containing newlines, and is not suitable for interpolation
into a filename.</p>
</div>
<p class="last">For multi-codebase builds (where codebase is not the default <cite>''</cite>), this property is a dictionary, keyed by codebase.</p>
</dd>
</dl>
<dl class="docutils" id="index-3">
<dt><tt class="docutils literal"><span class="pre">buildername</span></tt></dt>
<dd>This is a string that indicates which <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> the build was a part of.
The combination of buildername and buildnumber uniquely identify a
build.</dd>
</dl>
<dl class="docutils" id="index-4">
<dt><tt class="docutils literal"><span class="pre">buildnumber</span></tt></dt>
<dd>Each build gets a number, scoped to the <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> (so the first build
performed on any given <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> will have a build number of 0). This
integer property contains the build's number.</dd>
</dl>
<dl class="docutils" id="index-5">
<dt><tt class="docutils literal"><span class="pre">slavename</span></tt></dt>
<dd>This is a string which identifies which buildslave the build is
running on.</dd>
</dl>
<dl class="docutils" id="index-6">
<dt><tt class="docutils literal"><span class="pre">scheduler</span></tt></dt>
<dd>If the build was started from a scheduler, then this property will
contain the name of that scheduler.</dd>
<dt><tt class="docutils literal"><span class="pre">workdir</span></tt></dt>
<dd>The absolute path of the base working directory on the slave, of the current
builder.</dd>
</dl>
<p id="index-7">For single codebase builds, where the codebase is <cite>''</cite>, the following <a class="reference internal" href="#source-stamp-attributes"><em>Source Stamp Attributes</em></a> are also available as properties: <tt class="docutils literal"><span class="pre">branch</span></tt>, <tt class="docutils literal"><span class="pre">revision</span></tt>, <tt class="docutils literal"><span class="pre">repository</span></tt>, and <tt class="docutils literal"><span class="pre">project</span></tt> .</p>
</div>
<div class="section" id="source-stamp-attributes">
<span id="id3"></span><h5>Source Stamp Attributes<a class="headerlink" href="#source-stamp-attributes" title="Permalink to this headline">¶</a></h5>
<p id="index-8"><tt class="docutils literal"><span class="pre">branch</span></tt>
<tt class="docutils literal"><span class="pre">revision</span></tt>
<tt class="docutils literal"><span class="pre">repository</span></tt>
<tt class="docutils literal"><span class="pre">project</span></tt>
<tt class="docutils literal"><span class="pre">codebase</span></tt></p>
<blockquote>
<div>For details of these attributes see <a class="reference internal" href="#document-manual/concepts"><em>Concepts</em></a>.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">changes</span></tt></p>
<blockquote>
<div>This attribute is a list of dictionaries reperesnting the changes that make up this sourcestamp.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">has_patch</span></tt>
<tt class="docutils literal"><span class="pre">patch_level</span></tt>
<tt class="docutils literal"><span class="pre">patch_body</span></tt>
<tt class="docutils literal"><span class="pre">patch_subdir</span></tt>
<tt class="docutils literal"><span class="pre">patch_author</span></tt>
<tt class="docutils literal"><span class="pre">patch_comment</span></tt></p>
<blockquote>
<div>These attributes are set if the source stamp was created by a <a class="reference internal" href="#try-schedulers"><em>try scheduler</em></a>.</div></blockquote>
</div>
<div class="section" id="using-properties-in-steps">
<h5>Using Properties in Steps<a class="headerlink" href="#using-properties-in-steps" title="Permalink to this headline">¶</a></h5>
<p>For the most part, properties are used to alter the behavior of build steps
during a build.  This is done by annotating the step definition in
<tt class="docutils literal"><span class="pre">master.cfg</span></tt> with placeholders.  When the step is executed, these
placeholders will be replaced using the current values of the build properties.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Properties are defined while a build is in progress; their values are
not available when the configuration file is parsed.  This can sometimes
confuse newcomers to Buildbot!  In particular, the following is a common error:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">Property</span><span class="p">(</span><span class="s">&#39;release_train&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;alpha&#39;</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">This does not work because the value of the property is not available when
the <tt class="docutils literal"><span class="pre">if</span></tt> statement is executed.  However, Python will not detect this as
an error - you will just never see the step added to the factory.</p>
</div>
<p>You can use build properties in most step paramaters.  Please file bugs for any
parameters which do not accept properties.</p>
<div class="section" id="property">
<span id="index-9"></span><span id="id4"></span><h6>Property<a class="headerlink" href="#property" title="Permalink to this headline">¶</a></h6>
<p>The simplest form of annotation is to wrap the property name with
<tt class="xref py py-class docutils literal"><span class="pre">Property</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">Property</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span> <span class="s">&#39;echo&#39;</span><span class="p">,</span> <span class="s">&#39;buildername:&#39;</span><span class="p">,</span> <span class="n">Property</span><span class="p">(</span><span class="s">&#39;buildername&#39;</span><span class="p">)</span> <span class="p">]))</span>
</pre></div>
</div>
<p>You can specify a default value by passing a <tt class="docutils literal"><span class="pre">default</span></tt> keyword argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span> <span class="s">&#39;echo&#39;</span><span class="p">,</span> <span class="s">&#39;warnings:&#39;</span><span class="p">,</span>
                                 <span class="n">Property</span><span class="p">(</span><span class="s">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">)</span> <span class="p">]))</span>
</pre></div>
</div>
<p>The default value is used when the property doesn't exist, or when the value is
something Python regards as <tt class="docutils literal"><span class="pre">False</span></tt>. The <tt class="docutils literal"><span class="pre">defaultWhenFalse</span></tt> argument can be
set to <tt class="docutils literal"><span class="pre">False</span></tt> to force buildbot to use the default argument only if the
parameter is not set:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span> <span class="s">&#39;echo&#39;</span><span class="p">,</span> <span class="s">&#39;warnings:&#39;</span><span class="p">,</span>
                 <span class="n">Property</span><span class="p">(</span><span class="s">&#39;warnings&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&#39;none&#39;</span><span class="p">,</span> <span class="n">defaultWhenFalse</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="p">]))</span>
</pre></div>
</div>
<p>The default value can reference other properties, e.g.,</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">command</span><span class="o">=</span><span class="n">Property</span><span class="p">(</span><span class="s">&#39;command&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Property</span><span class="p">(</span><span class="s">&#39;default-command&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="interpolate">
<span id="index-10"></span><span id="id5"></span><h6>Interpolate<a class="headerlink" href="#interpolate" title="Permalink to this headline">¶</a></h6>
<p><tt class="xref py py-class docutils literal"><span class="pre">Property</span></tt> can only be used to replace an entire argument: in the
example above, it replaces an argument to <tt class="docutils literal"><span class="pre">echo</span></tt>.  Often, properties need to
be interpolated into strings, instead.  The tool for that job is
<a class="reference internal" href="#interpolate"><em>Interpolate</em></a>.</p>
<p>The more common pattern is to use python dictionary-style string interpolation by using the <tt class="docutils literal"><span class="pre">%(prop:&lt;propname&gt;)s</span></tt> syntax.
In this form, the property name goes in the parentheses, as above.
A common mistake is to omit the trailing &quot;s&quot;, leading to a rather obscure error from Python (&quot;ValueError: unsupported format character&quot;).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">Interpolate</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span> <span class="s">&#39;make&#39;</span><span class="p">,</span> <span class="n">Interpolate</span><span class="p">(</span><span class="s">&#39;REVISION=%(prop:got_revision)s&#39;</span><span class="p">),</span>
                                 <span class="s">&#39;dist&#39;</span> <span class="p">]))</span>
</pre></div>
</div>
<p>This example will result in a <tt class="docutils literal"><span class="pre">make</span></tt> command with an argument like
<tt class="docutils literal"><span class="pre">REVISION=12098</span></tt>.</p>
<p id="interpolate-dictstyle">The syntax of dictionary-style interpolation is a selector, followed by a colon, followed by a selector specific key, optionally followed by a colon and a string indicating how to interpret the value produced by the key.</p>
<p>The following selectors are supported.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">prop</span></tt></dt>
<dd>The key is the name of a property.</dd>
<dt><tt class="docutils literal"><span class="pre">src</span></tt></dt>
<dd>The key is a codebase and source stamp attribute, seperated by a colon.</dd>
<dt><tt class="docutils literal"><span class="pre">kw</span></tt></dt>
<dd>The key refers to a keyword argument passed to <tt class="docutils literal"><span class="pre">Interpolate</span></tt>.</dd>
</dl>
<p>The following ways of interpreting the value are available.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">-replacement</span></tt></dt>
<dd>If the key exists, substitute its value; otherwise,
substitute <tt class="docutils literal"><span class="pre">replacement</span></tt>. <tt class="docutils literal"><span class="pre">replacement</span></tt> may be empty
(<tt class="docutils literal"><span class="pre">%(prop:propname:-)s</span></tt>). This is the default.</dd>
<dt><tt class="docutils literal"><span class="pre">~replacement</span></tt></dt>
<dd>Like <tt class="docutils literal"><span class="pre">-replacement</span></tt>, but only substitutes the value
of the key if it is something Python regards as <tt class="docutils literal"><span class="pre">True</span></tt>.
Python considers <tt class="docutils literal"><span class="pre">None</span></tt>, 0, empty lists, and the empty string to be
false, so such values will be replaced by <tt class="docutils literal"><span class="pre">replacement</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">+replacement</span></tt></dt>
<dd>If the key exists, substitute <tt class="docutils literal"><span class="pre">replacement</span></tt>; otherwise,
substitute an empty string.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">?|sub_if_exists|sub_if_missing</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">#?|sub_if_true|sub_if_false</span></tt></dt>
<dd>Ternary substitution, depending on either the key being present (with
<tt class="docutils literal"><span class="pre">?</span></tt>, similar to <tt class="docutils literal"><span class="pre">+</span></tt>) or being <tt class="docutils literal"><span class="pre">True</span></tt> (with <tt class="docutils literal"><span class="pre">#?</span></tt>, like <tt class="docutils literal"><span class="pre">~</span></tt>).
Notice that there is a pipe immediately following the question mark <em>and</em>
between the two substitution alternatives. The character that follows the
question mark is used as the delimeter between the two alternatives. In the
above examples, it is a pipe, but any character other than <tt class="docutils literal"><span class="pre">(</span></tt> can be used.</dd>
</dl>
<p>Although these are similar to shell substitutions, no other substitutions are currently supported.</p>
<p>Example</p>
<div class="highlight-python"><pre>from buildbot.steps.shell import ShellCommand
from buildbot.process.properties import Interpolate
f.addStep(ShellCommand(command=[ 'make', Interpolate('REVISION=%(prop:got_revision:-%(src::revision:-unknown)s)s')
                                 'dist' ]))</pre>
</div>
<p>In addition, <tt class="docutils literal"><span class="pre">Interpolate</span></tt> supports using positional string interpolation.
Here, <tt class="docutils literal"><span class="pre">%s</span></tt> is used as a placeholder, and the substitutions (which may themselves be placeholders), are given as subsequent arguments:</p>
<div class="highlight-python"><pre>.. note:</pre>
</div>
<blockquote>
<div>Like python, you can use either positional interpolation <em>or</em>
dictionary-style interpolation, not both.  Thus you cannot use a string
like <tt class="docutils literal"><span class="pre">Interpolate(&quot;foo-%(src::revision)s-%s&quot;,</span> <span class="pre">&quot;branch&quot;)</span></tt>.</div></blockquote>
</div>
<div class="section" id="renderer">
<span id="index-11"></span><span id="id6"></span><h6>Renderer<a class="headerlink" href="#renderer" title="Permalink to this headline">¶</a></h6>
<p>While Interpolate can handle many simple cases, and even some common conditionals, more complex cases are best handled with Python code.
The <tt class="docutils literal"><span class="pre">renderer</span></tt> decorator creates a renderable object that will be replaced with the result of the function, called when the step it's passed to begins.
The function receives an <tt class="xref py py-class docutils literal"><span class="pre">IProperties</span></tt> object, which it can use to examine the values of any and all properties.  For example:</p>
<div class="highlight-python"><pre> @properties.renderer
 def makeCommand(props):
     command = [ 'make' ]
     cpus = props.getProperty('CPUs')
     if cpus:
         command += [ '-j', str(cpus+1) ]
     else:
         command += [ '-j', '2' ]
     command += [ 'all' ]
     return command
f.addStep(ShellCommand(command=makeCommand))</pre>
</div>
<p>You can think of <tt class="docutils literal"><span class="pre">renderer</span></tt> as saying &quot;call this function when the step starts&quot;.</p>
</div>
<div class="section" id="withproperties">
<span id="index-12"></span><span id="id7"></span><h6>WithProperties<a class="headerlink" href="#withproperties" title="Permalink to this headline">¶</a></h6>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This placeholder is deprecated. It is an older version of <a class="reference internal" href="#interpolate"><em>Interpolate</em></a>.
It exists for compatability with older configs.</p>
</div>
<p>The simplest use of this class is with positional string interpolation.  Here,
<tt class="docutils literal"><span class="pre">%s</span></tt> is used as a placeholder, and property names are given as subsequent
arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">WithProperties</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span>
          <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;tar&quot;</span><span class="p">,</span> <span class="s">&quot;czf&quot;</span><span class="p">,</span>
                   <span class="n">WithProperties</span><span class="p">(</span><span class="s">&quot;build-</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">.tar.gz&quot;</span><span class="p">,</span> <span class="s">&quot;branch&quot;</span><span class="p">,</span> <span class="s">&quot;revision&quot;</span><span class="p">),</span>
                   <span class="s">&quot;source&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>If this <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> were used in a tree obtained from Git, it would
create a tarball with a name like
<tt class="file docutils literal"><span class="pre">build-master-a7d3a333db708e786edb34b6af646edd8d4d3ad9.tar.gz</span></tt>.</p>
<p id="index-13">The more common pattern is to use python dictionary-style string interpolation
by using the <tt class="docutils literal"><span class="pre">%(propname)s</span></tt> syntax. In this form, the property name goes in
the parentheses, as above.  A common mistake is to omit the trailing &quot;s&quot;,
leading to a rather obscure error from Python (&quot;ValueError: unsupported format
character&quot;).</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">WithProperties</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span> <span class="s">&#39;make&#39;</span><span class="p">,</span> <span class="n">WithProperties</span><span class="p">(</span><span class="s">&#39;REVISION=</span><span class="si">%(got_revision)s</span><span class="s">&#39;</span><span class="p">),</span>
                                 <span class="s">&#39;dist&#39;</span> <span class="p">]))</span>
</pre></div>
</div>
<p>This example will result in a <tt class="docutils literal"><span class="pre">make</span></tt> command with an argument like
<tt class="docutils literal"><span class="pre">REVISION=12098</span></tt>.</p>
<p id="withproperties-dictstyle">The dictionary-style interpolation supports a number of more advanced
syntaxes in the parentheses.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">propname:-replacement</span></tt></dt>
<dd>If <tt class="docutils literal"><span class="pre">propname</span></tt> exists, substitute its value; otherwise,
substitute <tt class="docutils literal"><span class="pre">replacement</span></tt>. <tt class="docutils literal"><span class="pre">replacement</span></tt> may be empty
(<tt class="docutils literal"><span class="pre">%(propname:-)s</span></tt>)</dd>
<dt><tt class="docutils literal"><span class="pre">propname:~replacement</span></tt></dt>
<dd>Like <tt class="docutils literal"><span class="pre">propname:-replacement</span></tt>, but only substitutes the value
of property <tt class="docutils literal"><span class="pre">propname</span></tt> if it is something Python regards as <tt class="docutils literal"><span class="pre">True</span></tt>.
Python considers <tt class="docutils literal"><span class="pre">None</span></tt>, 0, empty lists, and the empty string to be
false, so such values will be replaced by <tt class="docutils literal"><span class="pre">replacement</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">propname:+replacement</span></tt></dt>
<dd>If <tt class="docutils literal"><span class="pre">propname</span></tt> exists, substitute <tt class="docutils literal"><span class="pre">replacement</span></tt>; otherwise,
substitute an empty string.</dd>
</dl>
<p>Although these are similar to shell substitutions, no other
substitutions are currently supported, and <tt class="docutils literal"><span class="pre">replacement</span></tt> in the
above cannot contain more substitutions.</p>
<p>Note: like python, you can use either positional interpolation <em>or</em>
dictionary-style interpolation, not both. Thus you cannot use a string like
<tt class="docutils literal"><span class="pre">WithProperties(&quot;foo-%(revision)s-%s&quot;,</span> <span class="pre">&quot;branch&quot;)</span></tt>.</p>
</div>
<div class="section" id="custom-renderables">
<h6>Custom Renderables<a class="headerlink" href="#custom-renderables" title="Permalink to this headline">¶</a></h6>
<p>If the options described above are not sufficient, more complex substitutions can be achieved by writting custom renderables.</p>
<p>Renderables are objects providing the <tt class="xref py py-class docutils literal"><span class="pre">IRenderable</span></tt> interface.
That interface is simple - objects must provide a <cite>getRenderingFor</cite> method.
The method should take one argument - an <tt class="xref py py-class docutils literal"><span class="pre">IProperties</span></tt> provider - and should return a string.
Pass instances of the class anywhere other renderables are accepted.
For example:</p>
<div class="highlight-python"><pre>class DetermineFoo(object):
    implements(IRenderable)
    def getRenderingFor(self, props)
        if props.hasProperty('bar'):
            return props['bar']
        elif props.hasProperty('baz'):
            return props['baz']
        return 'qux'
ShellCommand(command=['echo', DetermineFoo()])</pre>
</div>
<p>or, more practically,</p>
<div class="highlight-python"><pre>class Now(object):
    implements(IRenderable)
    def getRenderingFor(self, props)
        return time.clock()
ShellCommand(command=['make', Interpolate('TIME=%(kw:now)', now=Now())])</pre>
</div>
<p>This is equivalent to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@renderer</span>
<span class="k">def</span> <span class="nf">now</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
<span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;make&#39;</span><span class="p">,</span> <span class="n">Interpolate</span><span class="p">(</span><span class="s">&#39;TIME=%(kw:now)&#39;</span><span class="p">,</span> <span class="n">now</span><span class="o">=</span><span class="n">now</span><span class="p">)])</span>
</pre></div>
</div>
<p>Note that a custom renderable must be instantiated (and its constructor can take whatever arguments you'd like), whereas a renderer can be used directly.</p>
</div>
</div>
</div>
<span id="document-manual/cfg-buildsteps"></span><div class="section" id="build-steps">
<span id="id1"></span><h4>Build Steps<a class="headerlink" href="#build-steps" title="Permalink to this headline">¶</a></h4>
<p><tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s are usually specified in the buildmaster's
configuration file, in a list that goes into the <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt>.
The <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> instances in this list are used as templates to
construct new independent copies for each build (so that state can be
kept on the <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> in one build without affecting a later
build). Each <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt> can be created with a list of steps,
or the factory can be created empty and then steps added to it using
the <tt class="xref py py-meth docutils literal"><span class="pre">addStep</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps</span> <span class="kn">import</span> <span class="n">source</span><span class="p">,</span> <span class="n">shell</span>
<span class="kn">from</span> <span class="nn">buildbot.process</span> <span class="kn">import</span> <span class="n">factory</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;http://svn.example.org/Trunk/&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;all&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>The basic behavior for a <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> is to:</p>
<blockquote>
<div><ul class="simple">
<li>run for a while, then stop</li>
<li>possibly invoke some RemoteCommands on the attached build slave</li>
<li>possibly produce a set of log files</li>
<li>finish with a status described by one of four values defined in
<tt class="xref py py-mod docutils literal"><span class="pre">buildbot.status.builder</span></tt>: <tt class="docutils literal"><span class="pre">SUCCESS</span></tt>, <tt class="docutils literal"><span class="pre">WARNINGS</span></tt>, <tt class="docutils literal"><span class="pre">FAILURE</span></tt>, <tt class="docutils literal"><span class="pre">SKIPPED</span></tt></li>
<li>provide a list of short strings to describe the step</li>
</ul>
</div></blockquote>
<p>The rest of this section describes all the standard <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> objects
available for use in a <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>, and the parameters which can be used to
control each.  A full list of build steps is available in the <a class="reference internal" href="bb-step.html" title="Build Step Index"><em>Build Step Index</em></a>.</p>
<div class="section" id="common-parameters">
<span id="buildstep-common-parameters"></span><span id="index-0"></span><h5>Common Parameters<a class="headerlink" href="#common-parameters" title="Permalink to this headline">¶</a></h5>
<p>All <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s accept some common parameters. Some of these control
how their individual status affects the overall build. Others are used
to specify which <cite>Locks</cite> (see <a class="reference internal" href="#interlocks"><em>Interlocks</em></a>) should be
acquired before allowing the step to run.</p>
<p>Arguments common to all <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> subclasses:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd>the name used to describe the step on the status display. It is also
used to give a name to any <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>s created by this step.</dd>
</dl>
<dl class="docutils" id="index-1">
<dt><tt class="docutils literal"><span class="pre">haltOnFailure</span></tt></dt>
<dd>if <tt class="docutils literal"><span class="pre">True</span></tt>, a <tt class="docutils literal"><span class="pre">FAILURE</span></tt> of this build step will cause the build to halt
immediately. Steps with <tt class="docutils literal"><span class="pre">alwaysRun=True</span></tt> are still run. Generally
speaking, <tt class="docutils literal"><span class="pre">haltOnFailure</span></tt> implies <tt class="docutils literal"><span class="pre">flunkOnFailure</span></tt> (the default for most
<tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s). In some cases, particularly series of tests, it makes sense
to <tt class="docutils literal"><span class="pre">haltOnFailure</span></tt> if something fails early on but not <tt class="docutils literal"><span class="pre">flunkOnFailure</span></tt>.
This can be achieved with <tt class="docutils literal"><span class="pre">haltOnFailure=True</span></tt>, <tt class="docutils literal"><span class="pre">flunkOnFailure=False</span></tt>.</dd>
</dl>
<dl class="docutils" id="index-2">
<dt><tt class="docutils literal"><span class="pre">flunkOnWarnings</span></tt></dt>
<dd>when <tt class="docutils literal"><span class="pre">True</span></tt>, a <tt class="docutils literal"><span class="pre">WARNINGS</span></tt> or <tt class="docutils literal"><span class="pre">FAILURE</span></tt> of this build step will mark the
overall build as <tt class="docutils literal"><span class="pre">FAILURE</span></tt>. The remaining steps will still be executed.</dd>
</dl>
<dl class="docutils" id="index-3">
<dt><tt class="docutils literal"><span class="pre">flunkOnFailure</span></tt></dt>
<dd>when <tt class="docutils literal"><span class="pre">True</span></tt>, a <tt class="docutils literal"><span class="pre">FAILURE</span></tt> of this build step will mark the overall build as
a <tt class="docutils literal"><span class="pre">FAILURE</span></tt>. The remaining steps will still be executed.</dd>
</dl>
<dl class="docutils" id="index-4">
<dt><tt class="docutils literal"><span class="pre">warnOnWarnings</span></tt></dt>
<dd>when <tt class="docutils literal"><span class="pre">True</span></tt>, a <tt class="docutils literal"><span class="pre">WARNINGS</span></tt> or <tt class="docutils literal"><span class="pre">FAILURE</span></tt> of this build step will mark the
overall build as having <tt class="docutils literal"><span class="pre">WARNINGS</span></tt>. The remaining steps will still be
executed.</dd>
</dl>
<dl class="docutils" id="index-5">
<dt><tt class="docutils literal"><span class="pre">warnOnFailure</span></tt></dt>
<dd>when <tt class="docutils literal"><span class="pre">True</span></tt>, a <tt class="docutils literal"><span class="pre">FAILURE</span></tt> of this build step will mark the overall build as
having <tt class="docutils literal"><span class="pre">WARNINGS</span></tt>. The remaining steps will still be executed.</dd>
</dl>
<dl class="docutils" id="index-6">
<dt><tt class="docutils literal"><span class="pre">alwaysRun</span></tt></dt>
<dd>if <tt class="docutils literal"><span class="pre">True</span></tt>, this build step will always be run, even if a previous buildstep
with <tt class="docutils literal"><span class="pre">haltOnFailure=True</span></tt> has failed.</dd>
</dl>
<dl class="docutils" id="index-7">
<dt><tt class="docutils literal"><span class="pre">doStepIf</span></tt></dt>
<dd>A step can be configured to only run under certain conditions.  To do this, set
the step's <tt class="docutils literal"><span class="pre">doStepIf</span></tt> to a boolean value, or to a function that returns a
boolean value or Deferred.  If the value or function result is false, then the step will
return <tt class="docutils literal"><span class="pre">SKIPPED</span></tt> without doing anything.  Oherwise, the step will be executed
normally.  If you set <tt class="docutils literal"><span class="pre">doStepIf</span></tt> to a function, that function should
accept one parameter, which will be the <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt> object itself.</dd>
</dl>
<dl class="docutils" id="index-8">
<dt><tt class="docutils literal"><span class="pre">hideStepIf</span></tt></dt>
<dd><p class="first">A step can be optionally hidden from the waterfall and build details web pages.  To do
this, set the step's <tt class="docutils literal"><span class="pre">hideStepIf</span></tt> to a boolean value, or to a function that takes one
parameter, the <tt class="xref py py-class docutils literal"><span class="pre">BuildStepStatus</span></tt> and returns a boolean value.  Steps are always
shown while they execute, however after the step as finished, this parameter
is evaluated (if a function) and if the value is True, the step is hidden.
For example, in order to hide the step if the step has been skipped,</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">hideStepIf</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">result</span><span class="o">==</span><span class="n">SKIPPED</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
<dl class="docutils" id="index-9">
<dt><tt class="docutils literal"><span class="pre">locks</span></tt></dt>
<dd>a list of <tt class="docutils literal"><span class="pre">Locks</span></tt> (instances of <tt class="xref py py-class docutils literal"><span class="pre">buildbot.locks.SlaveLock</span></tt> or
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.locks.MasterLock</span></tt>) that should be acquired before starting this
<tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt>. The <tt class="docutils literal"><span class="pre">Locks</span></tt> will be released when the step is complete. Note that this is a
list of actual <tt class="xref py py-class docutils literal"><span class="pre">Lock</span></tt> instances, not names. Also note that all Locks must have
unique names.  See <a class="reference internal" href="#interlocks"><em>Interlocks</em></a>.</dd>
</dl>
</div>
<div class="section" id="module-buildbot.steps.source">
<span id="id2"></span><span id="source-checkout"></span><h5>Source Checkout<a class="headerlink" href="#module-buildbot.steps.source" title="Permalink to this headline">¶</a></h5>
<p>At the moment, Buildbot contains two implementations of most source steps.  The
new implementation handles most of the logic on the master side, and has a
simpler, more unified approach.  The older implementation
(<a class="reference internal" href="#source-checkout-slave-side"><em>Source Checkout (Slave-Side)</em></a>) handles the logic on the slave side, and
some of the classes have a bewildering array of options.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p>Master-side source checkout steps are recently developed and not
stable yet. If you find any bugs please report them on the <a class="reference external" href="http://trac.buildbot.net/newticket">Buildbot Trac</a>. The older Slave-side described source
steps are <a class="reference internal" href="#source-checkout-slave-side"><em>Source Checkout (Slave-Side)</em></a>.</p>
<p>The old source steps are imported like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source</span> <span class="kn">import</span> <span class="n">Git</span>
</pre></div>
</div>
<p>while new source steps are in separate source-packages for each
version-control system:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.git</span> <span class="kn">import</span> <span class="n">Git</span>
</pre></div>
</div>
</div>
<p>New users should, where possible, use the new implementations.  The old
implementations will be deprecated in a later release.  Old users should take
this opportunity to switch to the new implementations while both are supported
by Buildbot.</p>
<p>Some version control systems have not yet been implemented as master-side
steps.  If you are interested in continued support for such a version control
system, please consider helping the Buildbot developers to create such an
implementation.  In particular, version-control systems with proprietary
licenses will not be supported without access to the version-control system
for development.</p>
<div class="section" id="id3">
<h6>Common Parameters<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h6>
<p>All source checkout steps accept some common parameters to control how they get
the sources and where they should be placed. The remaining per-VC-system
parameters are mostly to specify where exactly the sources are coming from.</p>
<p><tt class="docutils literal"><span class="pre">mode</span></tt>
<tt class="docutils literal"><span class="pre">method</span></tt></p>
<blockquote>
<div><p>These two parameters specify the means by which the source is checked out.
<tt class="docutils literal"><span class="pre">mode</span></tt> specifies the type of checkout and <tt class="docutils literal"><span class="pre">method</span></tt> tells about the
way to implement it.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">factory</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.source.mercurial</span> <span class="kn">import</span> <span class="n">Mercurial</span>
<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Mercurial</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s">&#39;path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;fresh&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">mode</span></tt> parameter a string describing the kind of VC operation that is
desired, defaulting to <tt class="docutils literal"><span class="pre">incremental</span></tt>.  The options are</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">incremental</span></tt></dt>
<dd>Update the source to the desired revision, but do not remove any other files
generated by previous builds.  This allows compilers to take advantage of
object files from previous builds.  This mode is exactly same as the old
<tt class="docutils literal"><span class="pre">update</span></tt> mode.</dd>
<dt><tt class="docutils literal"><span class="pre">full</span></tt></dt>
<dd>Update the source, but delete remnants of previous builds.  Build steps that
follow will need to regenerate all object files.</dd>
</dl>
<p>Methods are specific to the version-control system in question, as they may
take advantage of special behaviors in that version-control system that can
make checkouts more efficient or reliable.</p>
</div></blockquote>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">workdir</span></tt></dt>
<dd>like all Steps, this indicates the directory where the build will take
place. Source Steps are special in that they perform some operations
outside of the workdir (like creating the workdir itself).</dd>
<dt><tt class="docutils literal"><span class="pre">alwaysUseLatest</span></tt></dt>
<dd>if True, bypass the usual behavior of checking out the revision in the
source stamp, and always update to the latest revision in the repository
instead.</dd>
<dt><tt class="docutils literal"><span class="pre">retry</span></tt></dt>
<dd>If set, this specifies a tuple of <tt class="docutils literal"><span class="pre">(delay,</span> <span class="pre">repeats)</span></tt> which means
that when a full VC checkout fails, it should be retried up to
<tt class="docutils literal"><span class="pre">repeats</span></tt> times, waiting <tt class="docutils literal"><span class="pre">delay</span></tt> seconds between attempts. If
you don't provide this, it defaults to <tt class="docutils literal"><span class="pre">None</span></tt>, which means VC
operations should not be retried. This is provided to make life easier
for buildslaves which are stuck behind poor network connections.</dd>
<dt><tt class="docutils literal"><span class="pre">repository</span></tt></dt>
<dd><p class="first">The name of this parameter might vary depending on the Source step you
are running. The concept explained here is common to all steps and
applies to <tt class="docutils literal"><span class="pre">repourl</span></tt> as well as for <tt class="docutils literal"><span class="pre">baseURL</span></tt> (when
applicable).</p>
<p class="last">A common idiom is to pass <tt class="docutils literal"><span class="pre">Property('repository',</span> <span class="pre">'url://default/repo/path')</span></tt>
as repository. This grabs the repository from the source stamp of the
build. This can be a security issue, if you allow force builds from the
web, or have the <tt class="xref py py-class docutils literal"><span class="pre">WebStatus</span></tt> change hooks enabled; as the buildslave
will download code from an arbitrary repository.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">codebase</span></tt></dt>
<dd>This specifies which codebase the source step should use to select the right
source stamp. The default codebase value is ''. The codebase must correspond
to a codebase assigned by the <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><tt class="xref bb bb-cfg docutils literal"><span class="pre">codebaseGenerator</span></tt></a>. If there is no
codebaseGenerator defined in the master then codebase doesn't need to be set,
the default value will then match all changes.</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd>Specifies the timeout for slave-side operations, in seconds.  If
your repositories are particularly large, then you may need to
increase this  value from its default of 1200 (20 minutes).</dd>
<dt><tt class="docutils literal"><span class="pre">logEnviron</span></tt></dt>
<dd>If this option is true (the default), then the step's logfile will
describe the environment variables on the slave. In situations
where the environment is not relevant and is long, it may be
easier to set logEnviron=False.</dd>
<dt><tt class="docutils literal"><span class="pre">env</span></tt></dt>
<dd>a dictionary of environment strings which will be added to the child
command's environment.  The usual property interpolations can be used in
environment variable names and values - see <a class="reference internal" href="#properties"><em>Properties</em></a>.</dd>
</dl>
</div>
<div class="section" id="mercurial">
<span id="step-mercurial"></span><span id="step-Mercurial"></span><h6>Mercurial<a class="headerlink" href="#mercurial" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.mercurial.Mercurial">
<em class="property">class </em><tt class="descclassname">buildbot.steps.source.mercurial.</tt><tt class="descname">Mercurial</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.mercurial.Mercurial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-Mercurial" title="Mercurial"><tt class="xref bb bb-step docutils literal"><span class="pre">Mercurial</span></tt></a> build step performs a <a class="reference external" href="http://selenic.com/mercurial">Mercurial</a>
(aka <tt class="docutils literal"><span class="pre">hg</span></tt>) checkout or update.</p>
<p>Branches are available in two modes: <tt class="docutils literal"><span class="pre">dirname</span></tt>, where the name of the branch is
a suffix of the name of the repository, or <tt class="docutils literal"><span class="pre">inrepo</span></tt>, which uses hg's
named-branches support. Make sure this setting matches your changehook, if you
have that installed.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.mercurial</span> <span class="kn">import</span> <span class="n">Mercurial</span>
<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Mercurial</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s">&#39;path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">,</span>
                          <span class="n">method</span><span class="o">=</span><span class="s">&#39;fresh&#39;</span><span class="p">,</span> <span class="n">branchType</span><span class="o">=</span><span class="s">&#39;inrepo&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The Mercurial step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>where the Mercurial source repository is available.</dd>
<dt><tt class="docutils literal"><span class="pre">defaultBranch</span></tt></dt>
<dd>this specifies the name of the branch to use when a Build does not provide
one of its own. This will be appended to <tt class="docutils literal"><span class="pre">repourl</span></tt> to create the
string that will be passed to the <tt class="docutils literal"><span class="pre">hg</span> <span class="pre">clone</span></tt> command.</dd>
<dt><tt class="docutils literal"><span class="pre">branchType</span></tt></dt>
<dd>either 'dirname' (default) or 'inrepo' depending on whether the
branch name should be appended to the <tt class="docutils literal"><span class="pre">repourl</span></tt> or the branch
is a mercurial named branch and can be found within the <tt class="docutils literal"><span class="pre">repourl</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">clobberOnBranchChange</span></tt></dt>
<dd>boolean, defaults to <tt class="docutils literal"><span class="pre">True</span></tt>. If set and using inrepos branches,
clobber the tree at each branch change. Otherwise, just update to
the branch.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">mode</span></tt>
<tt class="docutils literal"><span class="pre">method</span></tt></p>
<blockquote>
<div><p>Mercurial's incremental mode does not require a method.  The full mode has
three methods defined:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">clobber</span></tt></dt>
<dd>It removes the build directory entirely then makes full clone
from repo. This can be slow as it need to clone whole repository</dd>
<dt><tt class="docutils literal"><span class="pre">fresh</span></tt></dt>
<dd>This remove all other files except those tracked by VCS. First
it does <strong class="command">hg purge --all</strong> then pull/update</dd>
<dt><tt class="docutils literal"><span class="pre">clean</span></tt></dt>
<dd>All the files which are tracked by Mercurial and listed ignore
files are not deleted. Remaining all other files will be deleted
before pull/update. This is equivalent to <strong class="command">hg purge</strong>
then pull/update.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="git">
<span id="step-git"></span><span id="step-Git"></span><h6>Git<a class="headerlink" href="#git" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.git.Git">
<em class="property">class </em><tt class="descclassname">buildbot.steps.source.git.</tt><tt class="descname">Git</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.git.Git" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <tt class="docutils literal"><span class="pre">Git</span></tt> build step clones or updates a <a class="reference external" href="http://git.or.cz/">Git</a>
repository and checks out the specified branch or revision. Note that
the buildbot supports Git version 1.2.0 and later: earlier versions
(such as the one shipped in Ubuntu 'Dapper') do not support the
<strong class="command">git init</strong> command that the buildbot uses.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.git</span> <span class="kn">import</span> <span class="n">Git</span>
<span class="n">factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Git</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s">&#39;git://path/to/repo&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">,</span>
                          <span class="n">method</span><span class="o">=</span><span class="s">&#39;clobber&#39;</span><span class="p">,</span> <span class="n">submodules</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<p>The Git step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>(required): the URL of the upstream Git repository.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>(optional): this specifies the name of the branch to use when a
Build does not provide one of its own. If this this parameter is
not specified, and the Build does not provide a branch, the
<tt class="docutils literal"><span class="pre">master</span></tt> branch will be used.</dd>
<dt><tt class="docutils literal"><span class="pre">submodules</span></tt></dt>
<dd>(optional): when initializing/updating a Git repository, this
decides whether or not buildbot should consider git submodules.
Default: <tt class="docutils literal"><span class="pre">False</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">shallow</span></tt></dt>
<dd>(optional): instructs git to attempt shallow clones (<tt class="docutils literal"><span class="pre">--depth</span>
<span class="pre">1</span></tt>). If the user/scheduler asks for a specific revision, this
parameter is ignored.</dd>
<dt><tt class="docutils literal"><span class="pre">progress</span></tt></dt>
<dd>(optional): passes the (<tt class="docutils literal"><span class="pre">--progress</span></tt>) flag to (<strong class="command">git
fetch</strong>). This solves issues of long fetches being killed due to
lack of output, but requires Git 1.7.2 or later.</dd>
<dt><tt class="docutils literal"><span class="pre">retryFetch</span></tt></dt>
<dd>(optional): this value defaults to <tt class="docutils literal"><span class="pre">False</span></tt>. In any case if
fetch fails buildbot retries to fetch again instead of failing the
entire source checkout.</dd>
<dt><tt class="docutils literal"><span class="pre">clobberOnFailure</span></tt></dt>
<dd>(optional): defaults to <tt class="docutils literal"><span class="pre">False</span></tt>. If a fetch or full clone
fails we can checkout source removing everything. This way new
repository will be cloned. If retry fails it fails the source
checkout step.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">mode</span></tt>
<tt class="docutils literal"><span class="pre">method</span></tt></p>
<blockquote>
<div><p>Git's incremental mode does not require a method.  The full mode has
four methods defined:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">clobber</span></tt></dt>
<dd>It removes the build directory entirely then makes full clone
from repo. This can be slow as it need to clone whole repository</dd>
<dt><tt class="docutils literal"><span class="pre">fresh</span></tt></dt>
<dd>This remove all other files except those tracked by Git. First
it does <strong class="command">git clean -d -f -x</strong> then fetch/checkout to a
specified revision(if any). This option is equal to update mode
with <tt class="docutils literal"><span class="pre">ignore_ignores=True</span></tt> in old steps.</dd>
<dt><tt class="docutils literal"><span class="pre">clean</span></tt></dt>
<dd>All the files which are tracked by Git and listed ignore files
are not deleted. Remaining all other files will be deleted
before fetch/checkout. This is equivalent to <strong class="command">git clean
-d -f</strong> then fetch. This is equivalent to
<tt class="docutils literal"><span class="pre">ignore_ignores=False</span></tt> in old steps.</dd>
<dt><tt class="docutils literal"><span class="pre">copy</span></tt></dt>
<dd>This first checkout source into source directory then copy the
<tt class="docutils literal"><span class="pre">source</span></tt> directory to <tt class="docutils literal"><span class="pre">build</span></tt> directory then performs the
build operation in the copied directory. This way we make fresh
builds with very less bandwidth to download source. The behavior
of source checkout follows exactly same as incremental. It
performs all the incremental checkout behavior in <tt class="docutils literal"><span class="pre">source</span></tt>
directory.</dd>
</dl>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">getDescription</span></tt></p>
<blockquote>
<div><p>(optional) After checkout, invoke a <cite>git describe</cite> on the revision and save
the result in a property; the property's name is either <tt class="docutils literal"><span class="pre">commit-description</span></tt>
or <tt class="docutils literal"><span class="pre">commit-description-foo</span></tt>, depending on whether the <tt class="docutils literal"><span class="pre">codebase</span></tt>
argument was also provided. The argument should either be a <tt class="docutils literal"><span class="pre">bool</span></tt> or <tt class="docutils literal"><span class="pre">dict</span></tt>,
and will change how <cite>git describe</cite> is called:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">getDescription=False</span></tt>: disables this feature explicitly</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">getDescription=True</span></tt> or empty <tt class="docutils literal"><span class="pre">dict()</span></tt>: Run <cite>git describe</cite> with no args</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">getDescription={...}</span></tt>: a dict with keys named the same as the git option.
Each key's value can be <tt class="docutils literal"><span class="pre">False</span></tt> or <tt class="docutils literal"><span class="pre">None</span></tt> to explicitly skip that argument.</p>
<p>For the following keys, a value of <tt class="docutils literal"><span class="pre">True</span></tt> appends the same-named git argument:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">all</span></tt> : <cite>--all</cite></li>
<li><tt class="docutils literal"><span class="pre">always</span></tt>: <cite>--always</cite></li>
<li><tt class="docutils literal"><span class="pre">contains</span></tt>: <cite>--contains</cite></li>
<li><tt class="docutils literal"><span class="pre">debug</span></tt>: <cite>--debug</cite></li>
<li><tt class="docutils literal"><span class="pre">long</span></tt>: <cite>--long`</cite></li>
<li><tt class="docutils literal"><span class="pre">exact-match</span></tt>: <cite>--exact-match</cite></li>
<li><tt class="docutils literal"><span class="pre">tags</span></tt>: <cite>--tags</cite></li>
<li><tt class="docutils literal"><span class="pre">dirty</span></tt>: <cite>--dirty</cite></li>
</ul>
</div></blockquote>
<p>For the following keys, an integer or string value (depending on what git expects)
will set the argument's parameter appropriately. Examples show the key-value pair:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">match=foo</span></tt>: <cite>--match foo</cite></li>
<li><tt class="docutils literal"><span class="pre">abbrev=7</span></tt>: <cite>--abbrev=7</cite></li>
<li><tt class="docutils literal"><span class="pre">candidates=7</span></tt>: <cite>--candidates=7</cite></li>
<li><tt class="docutils literal"><span class="pre">dirty=foo</span></tt>: <cite>--dirty=foo</cite></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="svn">
<span id="step-svn"></span><span id="step-SVN"></span><h6>SVN<a class="headerlink" href="#svn" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.svn.SVN">
<em class="property">class </em><tt class="descclassname">buildbot.steps.source.svn.</tt><tt class="descname">SVN</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.svn.SVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> build step performs a <a class="reference external" href="http://subversion.tigris.org">Subversion</a>
checkout or update. There are two
basic ways of setting up the checkout step, depending upon whether you
are using multiple branches or not.</p>
<p>The <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> step should be created with the
<tt class="docutils literal"><span class="pre">repourl</span></tt> argument:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>(required): this specifies the <tt class="docutils literal"><span class="pre">URL</span></tt> argument that will be
given to the <strong class="command">svn checkout</strong> command. It dictates both where
the repository is located and which sub-tree should be
extracted. One way to specify the branch is to use <tt class="docutils literal"><span class="pre">Interpolate</span></tt>. For
example, if you wanted to check out the trunk repository, you could use
<tt class="docutils literal"><span class="pre">repourl=Interpolate(&quot;http://svn.example.com/repos/%(src::branch)s&quot;)</span></tt>
Alternatively, if you are using a remote Subversion repository
which is accessible through HTTP at a URL of <tt class="docutils literal"><span class="pre">http://svn.example.com/repos</span></tt>,
and you wanted to check out the <tt class="docutils literal"><span class="pre">trunk/calc</span></tt> sub-tree, you would directly
use <tt class="docutils literal"><span class="pre">repourl=&quot;http://svn.example.com/repos/trunk/calc&quot;</span></tt> as an
argument to your <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> step.</dd>
</dl>
<p>If you are building from multiple branches, then you should create
the <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> step with the <tt class="docutils literal"><span class="pre">repourl</span></tt> and provide branch
information with <tt class="docutils literal"><span class="pre">Interpolate</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="kn">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;incremental&#39;</span><span class="p">,</span>
               <span class="n">repourl</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s">&#39;svn://svn.example.org/svn/%(src::branch)s/myproject&#39;</span><span class="p">)))</span>
</pre></div>
</div>
<p>Alternatively, the <tt class="docutils literal"><span class="pre">repourl</span></tt> argument can be used to create the <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> step without
<tt class="docutils literal"><span class="pre">Interpolate</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="kn">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">,</span>
               <span class="n">repourl</span><span class="o">=</span><span class="s">&#39;svn://svn.example.org/svn/myproject/trunk&#39;</span><span class="p">))</span>
</pre></div>
</div>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">username</span></tt></dt>
<dd>(optional): if specified, this will be passed to the <tt class="docutils literal"><span class="pre">svn</span></tt>
binary with a <tt class="docutils literal"><span class="pre">--username</span></tt> option.</dd>
<dt><tt class="docutils literal"><span class="pre">password</span></tt></dt>
<dd>(optional): if specified, this will be passed to the <tt class="docutils literal"><span class="pre">svn</span></tt> binary
with a <tt class="docutils literal"><span class="pre">--password</span></tt> option. The password itself will be suitably
obfuscated in the logs.</dd>
<dt><tt class="docutils literal"><span class="pre">extra_args</span></tt></dt>
<dd>(optional): if specified, an array of strings that will be passed
as extra arguments to the <tt class="docutils literal"><span class="pre">svn</span></tt> binary.</dd>
<dt><tt class="docutils literal"><span class="pre">keep_on_purge</span></tt></dt>
<dd>(optional): specific files or directories to keep between purges,
like some build outputs that can be reused between builds.</dd>
<dt><tt class="docutils literal"><span class="pre">depth</span></tt></dt>
<dd><p class="first">(optional): Specify depth argument to achieve sparse checkout.
Only available if slave has Subversion 1.5 or higher.</p>
<p class="last">If set to <tt class="docutils literal"><span class="pre">empty</span></tt> updates will not pull in any files or
subdirectories not already present. If set to <tt class="docutils literal"><span class="pre">files</span></tt>, updates will
pull in any files not already present, but not directories.  If set
to <tt class="docutils literal"><span class="pre">immediates</span></tt>, updates will pull in any files or subdirectories
not already present, the new subdirectories will have depth: empty.
If set to <tt class="docutils literal"><span class="pre">infinity</span></tt>, updates will pull in any files or
subdirectories not already present; the new subdirectories will
have depth-infinity. Infinity is equivalent to SVN default update
behavior, without specifying any depth argument.</p>
</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">mode</span></tt>
<tt class="docutils literal"><span class="pre">method</span></tt></p>
<blockquote>
<div><p>SVN's incremental mode does not require a method.  The full mode
has four methods defined:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">clobber</span></tt></dt>
<dd>It removes the working directory for each build then makes full checkout.</dd>
<dt><tt class="docutils literal"><span class="pre">fresh</span></tt></dt>
<dd>This always always purges local changes before updating. This
deletes unversioned files and reverts everything that would
appear in a <strong class="command">svn status --no-ignore</strong>. This is equivalent
to the old update mode with <tt class="docutils literal"><span class="pre">always_purge</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">clean</span></tt></dt>
<dd>This is same as fresh except that it deletes all unversioned
files generated by <strong class="command">svn status</strong>.</dd>
<dt><tt class="docutils literal"><span class="pre">copy</span></tt></dt>
<dd>This first checkout source into source directory then copy the
<tt class="docutils literal"><span class="pre">source</span></tt> directory to <tt class="docutils literal"><span class="pre">build</span></tt> directory then performs
the build operation in the copied directory. This way we make
fresh builds with very less bandwidth to download source. The
behavior of source checkout follows exactly same as
incremental. It performs all the incremental checkout behavior
in <tt class="docutils literal"><span class="pre">source</span></tt> directory.</dd>
<dt><tt class="docutils literal"><span class="pre">export</span></tt></dt>
<dd>Similar to <tt class="docutils literal"><span class="pre">method='copy'</span></tt>, except using <tt class="docutils literal"><span class="pre">svn</span> <span class="pre">export</span></tt> to create build
directory so that there are no <tt class="docutils literal"><span class="pre">.svn</span></tt> directories in the build
directory.</dd>
</dl>
</div></blockquote>
<p>If you are using branches, you must also make sure your
<tt class="docutils literal"><span class="pre">ChangeSource</span></tt> will report the correct branch names.</p>
</div>
<div class="section" id="cvs">
<span id="step-cvs"></span><span id="step-CVS"></span><h6>CVS<a class="headerlink" href="#cvs" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.cvs.CVS">
<em class="property">class </em><tt class="descclassname">buildbot.steps.source.cvs.</tt><tt class="descname">CVS</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.cvs.CVS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-CVS" title="CVS"><tt class="xref bb bb-step docutils literal"><span class="pre">CVS</span></tt></a> build step performs a <a class="reference external" href="http://www.nongnu.org/cvs/">CVS</a>
checkout or update.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.cvs</span> <span class="kn">import</span> <span class="n">CVS</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CVS</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;incremental&#39;</span><span class="p">,</span>
               <span class="n">cvsroot</span><span class="o">=</span><span class="s">&#39;:pserver:me@cvs.sourceforge.net:/cvsroot/myproj&#39;</span><span class="p">,</span>
               <span class="n">cvsmodule</span><span class="o">=</span><span class="s">&#39;buildbot&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">cvsroot</span></tt></dt>
<dd>(required): specify the CVSROOT value, which points to a CVS repository,
probably on a remote machine. For example, if Buildbot was hosted in CVS
then the cvsroot value you would use to get a copy of the Buildbot source
code might be
<tt class="docutils literal"><span class="pre">:pserver:anonymous&#64;cvs.sourceforge.net:/cvsroot/buildbot</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">cvsmodule</span></tt></dt>
<dd>(required): specify the cvs <tt class="docutils literal"><span class="pre">module</span></tt>, which is generally a
subdirectory of the CVSROOT. The cvsmodule for the Buildbot source code is
<tt class="docutils literal"><span class="pre">buildbot</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>a string which will be used in a <tt class="docutils literal"><span class="pre">-r</span></tt> argument. This is most useful for
specifying a branch to work on. Defaults to <tt class="docutils literal"><span class="pre">HEAD</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">global_options</span></tt></dt>
<dd>a list of flags to be put before the argument <tt class="docutils literal"><span class="pre">checkout</span></tt> in the CVS
command.</dd>
<dt><tt class="docutils literal"><span class="pre">extra_options</span></tt></dt>
<dd>a list of flags to be put after the <tt class="docutils literal"><span class="pre">checkout</span></tt> in the CVS command.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">mode</span></tt>
<tt class="docutils literal"><span class="pre">method</span></tt></p>
<blockquote>
<div><p>No method is needed for incremental mode.  For full mode, <tt class="docutils literal"><span class="pre">method</span></tt> can
take the values shown below. If no value is given, it defaults to
<tt class="docutils literal"><span class="pre">fresh</span></tt>.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">clobber</span></tt></dt>
<dd>This specifies to remove the <tt class="docutils literal"><span class="pre">workdir</span></tt> and make a full checkout.</dd>
<dt><tt class="docutils literal"><span class="pre">fresh</span></tt></dt>
<dd>This method first runs <tt class="docutils literal"><span class="pre">cvsdisard</span></tt> in the build directory, then updates
it.  This requires <tt class="docutils literal"><span class="pre">cvsdiscard</span></tt> which is a part of the cvsutil package.</dd>
<dt><tt class="docutils literal"><span class="pre">clean</span></tt></dt>
<dd>This method is the same as <tt class="docutils literal"><span class="pre">method='fresh'</span></tt>, but it runs <tt class="docutils literal"><span class="pre">cvsdiscard</span>
<span class="pre">--ignore</span></tt> instead of <tt class="docutils literal"><span class="pre">cvsdiscard</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">copy</span></tt></dt>
<dd>This maintains a <tt class="docutils literal"><span class="pre">source</span></tt> directory for source, which it updates copies to
the build directory.  This allows Buildbot to start with a fresh directory,
without downloading the entire repository on every build.</dd>
</dl>
</div></blockquote>
</div>
<div class="section" id="bzr">
<span id="step-bzr"></span><span id="step-Bzr"></span><h6>Bzr<a class="headerlink" href="#bzr" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.bzr.Bzr">
<em class="property">class </em><tt class="descclassname">buildbot.steps.source.bzr.</tt><tt class="descname">Bzr</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.bzr.Bzr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>bzr is a descendant of Arch/Baz, and is frequently referred to
as simply <cite>Bazaar</cite>. The repository-vs-workspace model is similar to
Darcs, but it uses a strictly linear sequence of revisions (one
history per branch) like Arch. Branches are put in subdirectories.
This makes it look very much like Mercurial.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.bzr</span> <span class="kn">import</span> <span class="n">Bzr</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Bzr</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&#39;incremental&#39;</span><span class="p">,</span>
               <span class="n">repourl</span><span class="o">=</span><span class="s">&#39;lp:~knielsen/maria/tmp-buildbot-test&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): the URL at which the
Bzr source repository is available.</dd>
<dt><tt class="docutils literal"><span class="pre">baseURL</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">repourl</span></tt> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.</dd>
<dt><tt class="docutils literal"><span class="pre">defaultBranch</span></tt></dt>
<dd>(allowed if and only if <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): this specifies
the name of the branch to use when a Build does not provide one of its
own. This will be appended to <tt class="docutils literal"><span class="pre">baseURL</span></tt> to create the string that
will be passed to the <tt class="docutils literal"><span class="pre">bzr</span> <span class="pre">checkout</span></tt> command.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">mode</span></tt>
<tt class="docutils literal"><span class="pre">method</span></tt></p>
<blockquote>
<div><p>No method is needed for incremental mode.  For full mode, <tt class="docutils literal"><span class="pre">method</span></tt> can
take the values shown below. If no value is given, it defaults to
<tt class="docutils literal"><span class="pre">fresh</span></tt>.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">clobber</span></tt></dt>
<dd>This specifies to remove the <tt class="docutils literal"><span class="pre">workdir</span></tt> and make a full checkout.</dd>
<dt><tt class="docutils literal"><span class="pre">fresh</span></tt></dt>
<dd>This method first runs <tt class="docutils literal"><span class="pre">bzr</span> <span class="pre">clean-tree</span></tt> to remove all the unversioned
files then <tt class="docutils literal"><span class="pre">update</span></tt> the repo. This remove all unversioned files
including those in .bzrignore.</dd>
<dt><tt class="docutils literal"><span class="pre">clean</span></tt></dt>
<dd>This is same as fresh except that it doesn't remove the files mentioned
in .bzrginore i.e, by running <tt class="docutils literal"><span class="pre">bzr</span> <span class="pre">clean-tree</span> <span class="pre">--ignore</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">copy</span></tt></dt>
<dd>A local bzr repository is maintained and the repo is copied to <tt class="docutils literal"><span class="pre">build</span></tt>
directory for each build. Before each build the local bzr repo is
updated then copied to <tt class="docutils literal"><span class="pre">build</span></tt> for next steps.</dd>
</dl>
</div></blockquote>
</div>
</div>
<div class="section" id="source-checkout-slave-side">
<span id="id7"></span><h5>Source Checkout (Slave-Side)<a class="headerlink" href="#source-checkout-slave-side" title="Permalink to this headline">¶</a></h5>
<p>This section describes the more mature slave-side source steps.  Where
possible, new users should use the master-side source checkout steps, as the
slave-side steps will be removed in a future version.  See
<a class="reference internal" href="#source-checkout"><em>Source Checkout</em></a>.</p>
<p>The first step of any build is typically to acquire the source code
from which the build will be performed. There are several classes to
handle this, one for each of the different source control system that
Buildbot knows about. For a description of how Buildbot treats source
control in general, see <a class="reference internal" href="#version-control-systems"><em>Version Control Systems</em></a>.</p>
<p>All source checkout steps accept some common parameters to control how
they get the sources and where they should be placed. The remaining
per-VC-system parameters are mostly to specify where exactly the
sources are coming from.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first">a string describing the kind of VC operation that is desired. Defaults
to <tt class="docutils literal"><span class="pre">update</span></tt>.</p>
<dl class="last docutils">
<dt><tt class="docutils literal"><span class="pre">update</span></tt></dt>
<dd>specifies that the CVS checkout/update should be performed
directly into the workdir. Each build is performed in the same
directory, allowing for incremental builds. This minimizes
disk space, bandwidth, and CPU time. However, it may encounter
problems if the build process does not handle dependencies
properly (sometimes you must do a <em>clean build</em> to make sure
everything gets compiled), or if source files are deleted but
generated files can influence test behavior (e.g. python's
.pyc files), or when source directories are deleted but
generated files prevent CVS from removing them. Builds ought
to be correct regardless of whether they are done <em>from
scratch</em> or incrementally, but it is useful to test both
kinds: this mode exercises the incremental-build style.</dd>
<dt><tt class="docutils literal"><span class="pre">copy</span></tt></dt>
<dd>specifies that the CVS workspace should be maintained in a
separate directory (called the <tt class="file docutils literal"><span class="pre">copydir</span></tt>), using
checkout or update as necessary. For each build, a new workdir
is created with a copy of the source tree (<tt class="docutils literal"><span class="pre">rm</span> <span class="pre">-rf</span> <span class="pre">workdir;</span>
<span class="pre">cp</span> <span class="pre">-r</span> <span class="pre">copydir</span> <span class="pre">workdir</span></tt>). This doubles the disk space
required, but keeps the bandwidth low (update instead of a
full checkout). A full 'clean' build is performed each
time. This avoids any generated-file build problems, but is
still occasionally vulnerable to CVS problems such as a
repository being manually rearranged, causing CVS errors on
update which are not an issue with a full checkout.</dd>
<dt><tt class="docutils literal"><span class="pre">clobber</span></tt></dt>
<dd>specifies that the working directory should be deleted each
time, necessitating a full checkout for each build. This
insures a clean build off a complete checkout, avoiding any of
the problems described above. This mode exercises the
<em>from-scratch</em> build style.</dd>
<dt><tt class="docutils literal"><span class="pre">export</span></tt></dt>
<dd>this is like <tt class="docutils literal"><span class="pre">clobber</span></tt>, except that the <tt class="docutils literal"><span class="pre">cvs</span> <span class="pre">export</span></tt>
command is used to create the working directory. This command
removes all CVS metadata files (the <tt class="file docutils literal"><span class="pre">CVS/</span></tt> directories)
from the tree, which is sometimes useful for creating source
tarballs (to avoid including the metadata in the tar file).</dd>
</dl>
</dd>
<dt><tt class="docutils literal"><span class="pre">workdir</span></tt></dt>
<dd>As for all steps, this indicates the directory where the build will take
place. Source Steps are special in that they perform some operations
outside of the workdir (like creating the workdir itself).</dd>
<dt><tt class="docutils literal"><span class="pre">alwaysUseLatest</span></tt></dt>
<dd>if <tt class="docutils literal"><span class="pre">True</span></tt>, bypass the usual <cite>update to the last Change</cite> behavior, and
always update to the latest changes instead.</dd>
<dt><tt class="docutils literal"><span class="pre">retry</span></tt></dt>
<dd>If set, this specifies a tuple of <tt class="docutils literal"><span class="pre">(delay,</span> <span class="pre">repeats)</span></tt> which means
that when a full VC checkout fails, it should be retried up to
<cite>repeats</cite> times, waiting <cite>delay</cite> seconds between attempts. If
you don't provide this, it defaults to <tt class="docutils literal"><span class="pre">None</span></tt>, which means VC
operations should not be retried. This is provided to make life easier
for buildslaves which are stuck behind poor network connections.</dd>
<dt><tt class="docutils literal"><span class="pre">repository</span></tt></dt>
<dd><p class="first">The name of this parameter might varies depending on the Source step you
are running. The concept explained here is common to all steps and
applies to <tt class="docutils literal"><span class="pre">repourl</span></tt> as well as for <tt class="docutils literal"><span class="pre">baseURL</span></tt> (when
aplicable). Buildbot, now being aware of the repository name via the
change source, might in some cases not need the repository url. There
are multiple way to pass it through to this step, those correspond to
the type of the parameter given to this step:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">None</span></tt></dt>
<dd>In the case where no paraneter is specified, the repository url will be
taken exactly from the Change attribute. You are looking for that one if
your ChangeSource step has all informations about how to reach the
Change.</dd>
<dt>string</dt>
<dd>The parameter might be a string, in this case, this string will be taken
as the repository url, and nothing more. the value coming from the
ChangeSource step will be forgotten.</dd>
<dt>format string</dt>
<dd>If the parameter is a string containing <tt class="docutils literal"><span class="pre">%s</span></tt>, then this the
repository attribute from the <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt> will be place in place of the
<tt class="docutils literal"><span class="pre">%s</span></tt>. This is usefull when the change source knows where the
repository resides locally, but don't know the scheme used to access
it. For instance <tt class="docutils literal"><span class="pre">ssh://server/%s</span></tt> makes sense if the the
repository attribute is the local path of the repository.</dd>
<dt>dict</dt>
<dd>In this case, the repository URL will be the value indexed by the
repository attribute in the dict given as parameter.</dd>
<dt>callable</dt>
<dd>The callable given as parameter will take the repository attribute from
the Change and its return value will be used as repository URL.</dd>
</dl>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">this is quite similar to the mechanism used by the
WebStatus for the <tt class="docutils literal"><span class="pre">changecommentlink</span></tt>, <tt class="docutils literal"><span class="pre">projects</span></tt> or
<tt class="docutils literal"><span class="pre">repositories</span></tt> parameter.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd>Specifies the timeout for slave-side operations, in seconds.  If
your repositories are particularly large, then you may need to
increase this  value from its default of 1200 (20 minutes).</dd>
</dl>
<p>My habit as a developer is to do a <tt class="docutils literal"><span class="pre">cvs</span> <span class="pre">update</span></tt> and <strong class="command">make</strong> each
morning. Problems can occur, either because of bad code being checked in, or
by incomplete dependencies causing a partial rebuild to fail where a
complete from-scratch build might succeed. A quick Builder which emulates
this incremental-build behavior would use the <tt class="docutils literal"><span class="pre">mode='update'</span></tt>
setting.</p>
<p>On the other hand, other kinds of dependency problems can cause a clean
build to fail where a partial build might succeed. This frequently results
from a link step that depends upon an object file that was removed from a
later version of the tree: in the partial tree, the object file is still
around (even though the Makefiles no longer know how to create it).</p>
<p><cite>official</cite> builds (traceable builds performed from a known set of
source revisions) are always done as clean builds, to make sure it is
not influenced by any uncontrolled factors (like leftover files from a
previous build). A <cite>full</cite> <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> which behaves this way would want
to use the <tt class="docutils literal"><span class="pre">mode='clobber'</span></tt> setting.</p>
<p>Each VC system has a corresponding source checkout class: their
arguments are described on the following pages.</p>
<div class="section" id="cvs-slave-side">
<span id="step-cvs-slave-side"></span><span id="step-CVS (Slave-Side)"></span><h6>CVS (Slave-Side)<a class="headerlink" href="#cvs-slave-side" title="Permalink to this headline">¶</a></h6>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">CVS</span></tt> build step performs a <a class="reference external" href="http://www.nongnu.org/cvs/">CVS</a>
checkout or update. It takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">cvsroot</span></tt></dt>
<dd>(required): specify the CVSROOT value, which points to a CVS
repository, probably on a remote machine. For example, the cvsroot
value you would use to get a copy of the Buildbot source code is
<tt class="docutils literal"><span class="pre">:pserver:anonymous&#64;cvs.sourceforge.net:/cvsroot/buildbot</span></tt></dd>
<dt><tt class="docutils literal"><span class="pre">cvsmodule</span></tt></dt>
<dd>(required): specify the cvs <tt class="docutils literal"><span class="pre">module</span></tt>, which is generally a
subdirectory of the CVSROOT. The <cite>cvsmodule</cite> for the Buildbot source
code is <tt class="docutils literal"><span class="pre">buildbot</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>a string which will be used in a <em class="xref std std-option">-r</em> argument. This is most
useful for specifying a branch to work on. Defaults to <tt class="docutils literal"><span class="pre">HEAD</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">global_options</span></tt></dt>
<dd>a list of flags to be put before the verb in the CVS command.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">checkout_options</span></tt></p>
<p><tt class="docutils literal"><span class="pre">export_options</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">extra_options</span></tt></dt>
<dd>a list of flags to be put after the verb in the CVS command.
<tt class="docutils literal"><span class="pre">checkout_options</span></tt> is only used for checkout operations,
<tt class="docutils literal"><span class="pre">export_options</span></tt> is only used for export operations, and
<tt class="docutils literal"><span class="pre">extra_options</span></tt> is used for both.</dd>
<dt><tt class="docutils literal"><span class="pre">checkoutDelay</span></tt></dt>
<dd>if set, the number of seconds to put between the timestamp of the last
known Change and the value used for the <em class="xref std std-option">-D</em> option. Defaults to
half of the parent <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>'s <tt class="docutils literal"><span class="pre">treeStableTimer</span></tt>.</dd>
</dl>
</div>
<div class="section" id="svn-slave-side">
<span id="step-svn-slave-side"></span><span id="step-SVN (Slave-Side)"></span><h6>SVN (Slave-Side)<a class="headerlink" href="#svn-slave-side" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-SVN (Slave-Side)" title="SVN (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> build step performs a
<a class="reference external" href="http://subversion.tigris.org">Subversion</a> checkout or update.
There are two basic ways of setting up the checkout step, depending
upon whether you are using multiple branches or not.</p>
<p>The most versatile way to create the <tt class="docutils literal"><span class="pre">SVN</span></tt> step is with the
<tt class="docutils literal"><span class="pre">svnurl</span></tt> argument:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">svnurl</span></tt></dt>
<dd>(required): this specifies the <tt class="docutils literal"><span class="pre">URL</span></tt> argument that will be given
to the <tt class="docutils literal"><span class="pre">svn</span> <span class="pre">checkout</span></tt> command. It dictates both where the
repository is located and which sub-tree should be extracted. In this
respect, it is like a combination of the CVS <tt class="docutils literal"><span class="pre">cvsroot</span></tt> and
<tt class="docutils literal"><span class="pre">cvsmodule</span></tt> arguments. For example, if you are using a remote
Subversion repository which is accessible through HTTP at a URL of
<tt class="docutils literal"><span class="pre">http://svn.example.com/repos</span></tt>, and you wanted to check out the
<tt class="docutils literal"><span class="pre">trunk/calc</span></tt> sub-tree, you would use
<tt class="docutils literal"><span class="pre">svnurl=&quot;http://svn.example.com/repos/trunk/calc&quot;</span></tt> as an argument
to your <tt class="docutils literal"><span class="pre">SVN</span></tt> step.</dd>
</dl>
<p>The <tt class="docutils literal"><span class="pre">svnurl</span></tt> argument can be considered as a universal means to
create the <tt class="docutils literal"><span class="pre">SVN</span></tt> step as it ignores the branch information in the
SourceStamp.</p>
<p>Alternatively, if you are building from multiple branches, then you
should preferentially create the <tt class="docutils literal"><span class="pre">SVN</span></tt> step with the
<tt class="docutils literal"><span class="pre">baseURL</span></tt> and <tt class="docutils literal"><span class="pre">defaultBranch</span></tt> arguments instead:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">baseURL</span></tt></dt>
<dd>(required): this specifies the base repository URL, to which a branch
name will be appended. It should probably end in a slash.</dd>
<dt><tt class="docutils literal"><span class="pre">defaultBranch</span></tt></dt>
<dd><p class="first">(optional): this specifies the name of the branch to use when a Build
does not provide one of its own. This will be appended to
<tt class="docutils literal"><span class="pre">baseURL</span></tt> to create the string that will be passed to the
<tt class="docutils literal"><span class="pre">svn</span> <span class="pre">checkout</span></tt> command.</p>
<p class="last">It is possible to mix to have a mix of <tt class="docutils literal"><span class="pre">SVN</span></tt> steps that use
either the <tt class="docutils literal"><span class="pre">svnurl</span></tt> or  <tt class="docutils literal"><span class="pre">baseURL</span></tt> arguments but not both at
the same time.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">username</span></tt></dt>
<dd>(optional): if specified, this will be passed to the <strong class="command">svn</strong>
binary with a <em class="xref std std-option">--username</em> option.</dd>
<dt><tt class="docutils literal"><span class="pre">password</span></tt></dt>
<dd>(optional): if specified, this will be passed to the <tt class="docutils literal"><span class="pre">svn</span></tt>
binary with a <em class="xref std std-option">--password</em> option.  The password itself will be
suitably obfuscated in the logs.</dd>
<dt><tt class="docutils literal"><span class="pre">extra_args</span></tt></dt>
<dd>(optional): if specified, an array of strings that will be passed as
extra arguments to the <strong class="command">svn</strong> binary.</dd>
<dt><tt class="docutils literal"><span class="pre">keep_on_purge</span></tt></dt>
<dd>(optional): specific files or directories to keep between purges,
like some build outputs that can be reused between builds.</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_ignores</span></tt></dt>
<dd>(optional): when purging changes, don't use rules defined in
<tt class="docutils literal"><span class="pre">svn:ignore</span></tt> properties and global-ignores in subversion/config.</dd>
<dt><tt class="docutils literal"><span class="pre">always_purge</span></tt></dt>
<dd>(optional): if set to <tt class="docutils literal"><span class="pre">True</span></tt>, always purge local changes before updating. This
deletes unversioned files and reverts everything that would appear in a
<tt class="docutils literal"><span class="pre">svn</span> <span class="pre">status</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">depth</span></tt></dt>
<dd><p class="first">(optional): Specify depth argument to achieve sparse checkout.  Only
available if slave has Subversion 1.5 or higher.</p>
<p class="last">If set to &quot;empty&quot; updates will not pull in any files or subdirectories not
already present. If set to &quot;files&quot;, updates will pull in any files not already
present, but not directories. If set to &quot;immediates&quot;, updates willl pull in any
files or subdirectories not already present, the new subdirectories will have
depth: empty. If set to &quot;infinity&quot;, updates will pull in any files or
subdirectories not already present; the new subdirectories will have
depth-infinity. Infinity is equivalent to SVN default update behavior, without
specifying any depth argument.</p>
</dd>
</dl>
<p>If you are using branches, you must also make sure your
<tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt> will report the correct branch names.</p>
</div>
<div class="section" id="darcs-slave-side">
<span id="step-Darcs (Slave-Side)"></span><h6>Darcs (Slave-Side)<a class="headerlink" href="#darcs-slave-side" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-Darcs (Slave-Side)" title="Darcs (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">Darcs</span></tt></a> build step performs a
<a class="reference external" href="http://darcs.net/">Darcs</a> checkout or update.</p>
<p>Like <a class="reference internal" href="#step-SVN (Slave-Side)" title="SVN (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a>, this step can either be configured to always check
out a specific tree, or set up to pull from a particular branch that
gets specified separately for each build. Also like SVN, the
repository URL given to Darcs is created by concatenating a
<tt class="docutils literal"><span class="pre">baseURL</span></tt> with the branch name, and if no particular branch is
requested, it uses a <tt class="docutils literal"><span class="pre">defaultBranch</span></tt>. The only difference in
usage is that each potential Darcs repository URL must point to a
fully-fledged repository, whereas SVN URLs usually point to sub-trees
of the main Subversion repository. In other words, doing an SVN
checkout of <tt class="docutils literal"><span class="pre">baseURL</span></tt> is legal, but silly, since you'd probably
wind up with a copy of every single branch in the whole repository.
Doing a Darcs checkout of <tt class="docutils literal"><span class="pre">baseURL</span></tt> is just plain wrong, since
the parent directory of a collection of Darcs repositories is not
itself a valid repository.</p>
<p>The Darcs step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): the URL at which the
Darcs source repository is available.</dd>
<dt><tt class="docutils literal"><span class="pre">baseURL</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">repourl</span></tt> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.</dd>
<dt><tt class="docutils literal"><span class="pre">defaultBranch</span></tt></dt>
<dd>(allowed if and only if <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): this specifies
the name of the branch to use when a Build does not provide one of its
own. This will be appended to <tt class="docutils literal"><span class="pre">baseURL</span></tt> to create the string that
will be passed to the <tt class="docutils literal"><span class="pre">darcs</span> <span class="pre">get</span></tt> command.</dd>
</dl>
</div>
<div class="section" id="mercurial-slave-side">
<span id="step-Mercurial (Slave-Side)"></span><h6>Mercurial (Slave-Side)<a class="headerlink" href="#mercurial-slave-side" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-Mercurial (Slave-Side)" title="Mercurial (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">Mercurial</span></tt></a> build step performs a
<a class="reference external" href="http://selenic.com/mercurial">Mercurial</a> (aka <cite>hg</cite>) checkout
or update.</p>
<p>Branches are available in two modes: <cite>dirname</cite> like <a class="reference internal" href="#step-Darcs (Slave-Side)" title="Darcs (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">Darcs</span></tt></a>, or
<cite>inrepo</cite>, which uses the repository internal branches. Make sure this
setting matches your changehook, if you have that installed.</p>
<p>The Mercurial step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): the URL at which the
Mercurial source repository is available.</dd>
<dt><tt class="docutils literal"><span class="pre">baseURL</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">repourl</span></tt> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.</dd>
<dt><tt class="docutils literal"><span class="pre">defaultBranch</span></tt></dt>
<dd>(allowed if and only if <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): this specifies
the name of the branch to use when a <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> does not provide one of its
own. This will be appended to <tt class="docutils literal"><span class="pre">baseURL</span></tt> to create the string that
will be passed to the <tt class="docutils literal"><span class="pre">hg</span> <span class="pre">clone</span></tt> command.</dd>
<dt><tt class="docutils literal"><span class="pre">branchType</span></tt></dt>
<dd>either 'dirname' (default) or 'inrepo' depending on whether
the branch name should be appended to the <tt class="docutils literal"><span class="pre">baseURL</span></tt>
or the branch is a mercurial named branch and can be
found within the <tt class="docutils literal"><span class="pre">repourl</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">clobberOnBranchChange</span></tt></dt>
<dd>boolean, defaults to <tt class="docutils literal"><span class="pre">True</span></tt>. If set and
using inrepos branches, clobber the tree
at each branch change. Otherwise, just
update to the branch.</dd>
</dl>
</div>
<div class="section" id="bzr-slave-side">
<span id="step-Bzr (Slave-Side)"></span><h6>Bzr (Slave-Side)<a class="headerlink" href="#bzr-slave-side" title="Permalink to this headline">¶</a></h6>
<p>bzr is a descendant of Arch/Baz, and is frequently referred to
as simply <cite>Bazaar</cite>. The repository-vs-workspace model is similar to
Darcs, but it uses a strictly linear sequence of revisions (one
history per branch) like Arch. Branches are put in subdirectories.
This makes it look very much like Mercurial. It takes the following
arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): the URL at which the
Bzr source repository is available.</dd>
<dt><tt class="docutils literal"><span class="pre">baseURL</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">repourl</span></tt> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.</dd>
<dt><tt class="docutils literal"><span class="pre">defaultBranch</span></tt></dt>
<dd>(allowed if and only if <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): this specifies
the name of the branch to use when a Build does not provide one of its
own. This will be appended to <tt class="docutils literal"><span class="pre">baseURL</span></tt> to create the string that
will be passed to the <tt class="docutils literal"><span class="pre">bzr</span> <span class="pre">checkout</span></tt> command.</dd>
<dt><tt class="docutils literal"><span class="pre">forceSharedRepo</span></tt></dt>
<dd>(boolean, optional, defaults to <tt class="docutils literal"><span class="pre">False</span></tt>): If set to <tt class="docutils literal"><span class="pre">True</span></tt>, the working directory
will be made into a bzr shared repository if it is not already. Shared
repository greatly reduces the amount of history data that needs to be
downloaded if not using update/copy mode, or if using update/copy mode with
multiple branches.</dd>
</dl>
</div>
<div class="section" id="p4-slave-side">
<span id="step-P4 (Slave-Side)"></span><h6>P4 (Slave-Side)<a class="headerlink" href="#p4-slave-side" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-P4 (Slave-Side)" title="P4 (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">P4</span> <span class="pre">(Slave-Side)</span></tt></a> build step creates a <a class="reference external" href="http://www.perforce.com/">Perforce</a>
client specification and performs an update.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">p4base</span></tt></dt>
<dd>A view into the Perforce depot without branch name or trailing &quot;...&quot;.
Typically <tt class="docutils literal"><span class="pre">//depot/proj/</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">defaultBranch</span></tt></dt>
<dd>A branch name to append on build requests if none is specified.
Typically <tt class="docutils literal"><span class="pre">trunk</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">p4port</span></tt></dt>
<dd>(optional): the <tt class="samp docutils literal"><em><span class="pre">host</span></em><span class="pre">:</span><em><span class="pre">port</span></em></tt> string describing how to get to the P4 Depot
(repository), used as the <em class="xref std std-option">-p</em> argument for all p4 commands.</dd>
<dt><tt class="docutils literal"><span class="pre">p4user</span></tt></dt>
<dd>(optional): the Perforce user, used as the <em class="xref std std-option">-u</em> argument to all p4
commands.</dd>
<dt><tt class="docutils literal"><span class="pre">p4passwd</span></tt></dt>
<dd>(optional): the Perforce password, used as the <em class="xref std std-option">-p</em> argument to all p4
commands.</dd>
<dt><tt class="docutils literal"><span class="pre">p4extra_views</span></tt></dt>
<dd>(optional): a list of <tt class="docutils literal"><span class="pre">(depotpath,</span> <span class="pre">clientpath)</span></tt> tuples containing extra
views to be mapped into the client specification. Both will have
&quot;/...&quot; appended automatically. The client name and source directory
will be prepended to the client path.</dd>
<dt><tt class="docutils literal"><span class="pre">p4client</span></tt></dt>
<dd>(optional): The name of the client to use. In <tt class="docutils literal"><span class="pre">mode='copy'</span></tt> and
<tt class="docutils literal"><span class="pre">mode='update'</span></tt>, it's particularly important that a unique name is used
for each checkout directory to avoid incorrect synchronization. For
this reason, Python percent substitution will be performed on this value
to replace %(slave)s with the slave name and %(builder)s with the
builder name. The default is <cite>buildbot_%(slave)s_%(build)s</cite>.</dd>
<dt><tt class="docutils literal"><span class="pre">p4line_end</span></tt></dt>
<dd>(optional): The type of line ending handling P4 should use.  This is
added directly to the client spec's <tt class="docutils literal"><span class="pre">LineEnd</span></tt> property.  The default is
<tt class="docutils literal"><span class="pre">local</span></tt>.</dd>
</dl>
</div>
<div class="section" id="git-slave-side">
<span id="step-Git (Slave-Side)"></span><h6>Git (Slave-Side)<a class="headerlink" href="#git-slave-side" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-Git (Slave-Side)" title="Git (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">Git</span></tt></a> build step clones or updates a <a class="reference external" href="http://git.or.cz/">Git</a>
repository and checks out the specified branch or revision. Note
that the buildbot supports Git version 1.2.0 and later: earlier
versions (such as the one shipped in Ubuntu 'Dapper') do not support
the <tt class="docutils literal"><span class="pre">git</span> <span class="pre">init</span></tt> command that the buildbot uses.</p>
<p>The <tt class="docutils literal"><span class="pre">Git</span></tt> step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>(required): the URL of the upstream Git repository.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>(optional): this specifies the name of the branch to use when a Build
does not provide one of its own. If this this parameter is not
specified, and the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> does not provide a branch, the <cite>master</cite>
branch will be used.</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_ignores</span></tt></dt>
<dd>(optional): when purging changes, don't use <tt class="file docutils literal"><span class="pre">.gitignore</span></tt> and
<tt class="file docutils literal"><span class="pre">.git/info/exclude</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">submodules</span></tt></dt>
<dd>(optional): when initializing/updating a Git repository, this decides whether
or not buildbot should consider git submodules.  Default: <tt class="docutils literal"><span class="pre">False</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">reference</span></tt></dt>
<dd>(optional): use the specified string as a path to a reference
repository on the local machine. Git will try to grab objects from
this path first instead of the main repository, if they exist.</dd>
<dt><tt class="docutils literal"><span class="pre">shallow</span></tt></dt>
<dd>(optional): instructs git to attempt shallow clones (<tt class="docutils literal"><span class="pre">--depth</span> <span class="pre">1</span></tt>).  If the
user/scheduler asks for a specific revision, this parameter is ignored.</dd>
<dt><tt class="docutils literal"><span class="pre">progress</span></tt></dt>
<dd>(optional): passes the (<tt class="docutils literal"><span class="pre">--progress</span></tt>) flag to (<tt class="docutils literal"><span class="pre">git</span>
<span class="pre">fetch</span></tt>). This solves issues of long fetches being killed due to
lack of output, but requires Git 1.7.2 or later.</dd>
</dl>
<p>This Source step integrates with <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></tt></a>, and will automatically use
Gerrit's &quot;virtual branch&quot; (<tt class="docutils literal"><span class="pre">refs/changes/*</span></tt>) to download the additionnal changes
introduced by a pending changeset.</p>
<p id="index-10">Gerrit integration can be also triggered using forced build with <tt class="docutils literal"><span class="pre">gerrit_change</span></tt>
property with value in format: <tt class="docutils literal"><span class="pre">change_number/patchset_number</span></tt>.</p>
</div>
<div class="section" id="bitkeeper-slave-side">
<span id="step-BK (Slave-Side)"></span><h6>BitKeeper (Slave-Side)<a class="headerlink" href="#bitkeeper-slave-side" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-BK (Slave-Side)" title="BK (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">BK</span></tt></a> build step performs a <a class="reference external" href="http://www.bitkeeper.com/">BitKeeper</a>
checkout or update.</p>
<p>The BitKeeper step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">baseURL</span></tt> is provided): the URL at which the
BitKeeper source repository is available.</dd>
<dt><tt class="docutils literal"><span class="pre">baseURL</span></tt></dt>
<dd>(required unless <tt class="docutils literal"><span class="pre">repourl</span></tt> is provided): the base repository URL,
to which a branch name will be appended. It should probably end in a
slash.</dd>
</dl>
</div>
<div class="section" id="repo-slave-side">
<span id="step-Repo (Slave-Side)"></span><h6>Repo (Slave-Side)<a class="headerlink" href="#repo-slave-side" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.source.Repo">
<em class="property">class </em><tt class="descclassname">buildbot.steps.source.</tt><tt class="descname">Repo</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.source.Repo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#step-Repo (Slave-Side)" title="Repo (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">Repo</span> <span class="pre">(Slave-Side)</span></tt></a> build step performs a <a class="reference external" href="http://lwn.net/Articles/304488/">Repo</a>
init and sync.</p>
<p>The Repo step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">manifest_url</span></tt></dt>
<dd>(required): the URL at which the Repo's manifests source repository is available.</dd>
<dt><tt class="docutils literal"><span class="pre">manifest_branch</span></tt></dt>
<dd>(optional, defaults to <tt class="docutils literal"><span class="pre">master</span></tt>): the manifest repository branch
on which repo will take its manifest. Corresponds to the <tt class="docutils literal"><span class="pre">-b</span></tt>
argument to the <strong class="command">repo init</strong> command.</dd>
<dt><tt class="docutils literal"><span class="pre">manifest_file</span></tt></dt>
<dd>(optional, defaults to <tt class="docutils literal"><span class="pre">default.xml</span></tt>): the manifest
filename. Corresponds to the <tt class="docutils literal"><span class="pre">-m</span></tt> argument to the <strong class="command">repo
init</strong> command.</dd>
<dt><tt class="docutils literal"><span class="pre">tarball</span></tt></dt>
<dd>(optional, defaults to <tt class="docutils literal"><span class="pre">None</span></tt>): the repo tarball used for
fast bootstrap. If not present the tarball will be created
automatically after first sync. It is a copy of the <tt class="docutils literal"><span class="pre">.repo</span></tt>
directory which contains all the git objects. This feature helps
to minimize network usage on very big projects.</dd>
<dt><tt class="docutils literal"><span class="pre">jobs</span></tt></dt>
<dd>(optional, defaults to <tt class="docutils literal"><span class="pre">None</span></tt>): Number of projects to fetch
simultaneously while syncing. Passed to repo sync subcommand with &quot;-j&quot;.</dd>
</dl>
<p>This Source step integrates with <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></tt></a>, and will
automatically use the <strong class="command">repo download</strong> command of repo to
download the additionnal changes introduced by a pending changeset.</p>
<p id="index-11">Gerrit integration can be also triggered using forced build with following properties:
<tt class="docutils literal"><span class="pre">repo_d</span></tt>, <tt class="docutils literal"><span class="pre">repo_d[0-9]</span></tt>, <tt class="docutils literal"><span class="pre">repo_download</span></tt>, <tt class="docutils literal"><span class="pre">repo_download[0-9]</span></tt>
with values in format: <tt class="docutils literal"><span class="pre">project/change_number/patchset_number</span></tt>.
All of these properties will be translated into a <strong class="command">repo download</strong>.
This feature allows integrators to build with several pending interdependent changes,
which at the moment cannot be described properly in Gerrit, and can only be described
by humans.</p>
</div>
<div class="section" id="monotone-slave-side">
<span id="step-Monotone (Slave-Side)"></span><h6>Monotone (Slave-Side)<a class="headerlink" href="#monotone-slave-side" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-Monotone (Slave-Side)" title="Monotone (Slave-Side)"><tt class="xref bb bb-step docutils literal"><span class="pre">Monotone</span></tt></a> build step performs a
<a class="reference external" href="http://www.monotone.ca">Monotone</a>, (aka <tt class="docutils literal"><span class="pre">mtn</span></tt>) checkout
or update.</p>
<p>The Monotone step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">repourl</span></tt></dt>
<dd>the URL at which the Monotone source repository is available.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>this specifies the name of the branch to use when a Build does not
provide one of its own.</dd>
<dt><tt class="docutils literal"><span class="pre">progress</span></tt></dt>
<dd>this is a boolean that has a pull from the repository use
<tt class="docutils literal"><span class="pre">--ticker=dot</span></tt> instead of the default <tt class="docutils literal"><span class="pre">--ticker=none</span></tt>.</dd>
</dl>
</div>
</div>
<div class="section" id="shellcommand">
<span id="step-ShellCommand"></span><h5>ShellCommand<a class="headerlink" href="#shellcommand" title="Permalink to this headline">¶</a></h5>
<p>Most interesting steps involve exectuing a process of some sort on the
buildslave.  The <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a> class handles this activity.</p>
<p>Several subclasses of <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a> are provided as starting points for
common build steps.</p>
<div class="section" id="using-shellcommands">
<h6>Using ShellCommands<a class="headerlink" href="#using-shellcommands" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.ShellCommand">
<em class="property">class </em><tt class="descclassname">buildbot.steps.shell.</tt><tt class="descname">ShellCommand</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.ShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is a useful base class for just about everything you might want
to do during a build (except for the initial source checkout). It runs
a single command in a child shell on the buildslave. All stdout/stderr
is recorded into a <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>. The step usually finishes with a
status of <tt class="docutils literal"><span class="pre">FAILURE</span></tt> if the command's exit code is non-zero, otherwise
it has a status of <tt class="docutils literal"><span class="pre">SUCCESS</span></tt>.</p>
<p>The preferred way to specify the command is with a list of argv strings,
since this allows for spaces in filenames and avoids doing any fragile
shell-escaping. You can also specify the command with a single string, in
which case the string is given to <tt class="samp docutils literal"><span class="pre">/bin/sh</span> <span class="pre">-c</span> <em><span class="pre">COMMAND</span></em></tt> for parsing.</p>
<p>On Windows, commands are run via <tt class="docutils literal"><span class="pre">cmd.exe</span> <span class="pre">/c</span></tt> which works well. However,
if you're running a batch file, the error level does not get propagated
correctly unless you add 'call' before your batch file's name:
<tt class="docutils literal"><span class="pre">cmd=['call',</span> <span class="pre">'myfile.bat',</span> <span class="pre">...]</span></tt>.</p>
<p>The <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a> arguments are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">command</span></tt></dt>
<dd><p class="first">a list of strings (preferred) or single string (discouraged) which
specifies the command to be run. A list of strings is preferred
because it can be used directly as an argv array. Using a single
string (with embedded spaces) requires the buildslave to pass the
string to <strong class="command">/bin/sh</strong> for interpretation, which raises all sorts of
difficult questions about how to escape or interpret shell
metacharacters.</p>
<p>If <tt class="docutils literal"><span class="pre">command</span></tt> contains nested lists (for example, from a properties
substitution), then that list will be flattened before it is executed.</p>
<p class="last">On the topic of shell metacharacters, note that in DOS the pipe character
(<tt class="docutils literal"><span class="pre">|</span></tt>) is conditionally escaped (to <tt class="docutils literal"><span class="pre">^|</span></tt>) when it occurs inside a more
complex string in a list of strings.  It remains unescaped when it
occurs as part of a single string or as a lone pipe in a list of strings.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">workdir</span></tt></dt>
<dd><p class="first">All ShellCommands are run by default in the <tt class="docutils literal"><span class="pre">workdir</span></tt>, which
defaults to the <tt class="file docutils literal"><span class="pre">build</span></tt> subdirectory of the slave builder's
base directory. The absolute path of the workdir will thus be the
slave's basedir (set as an option to <tt class="docutils literal"><span class="pre">buildslave</span> <span class="pre">create-slave</span></tt>,
<a class="reference internal" href="#creating-a-buildslave"><em>Creating a buildslave</em></a>) plus the builder's basedir (set in the
builder's <tt class="docutils literal"><span class="pre">builddir</span></tt> key in <tt class="file docutils literal"><span class="pre">master.cfg</span></tt>) plus the workdir
itself (a class-level attribute of the BuildFactory, defaults to
<tt class="file docutils literal"><span class="pre">build</span></tt>).</p>
<p>For example:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">],</span>
                       <span class="n">workdir</span><span class="o">=</span><span class="s">&quot;build/tests&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">env</span></tt></dt>
<dd><p class="first">a dictionary of environment strings which will be added to the child
command's environment. For example, to run tests with a different i18n
language setting, you might use</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">],</span>
                       <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;LANG&#39;</span><span class="p">:</span> <span class="s">&#39;fr_FR&#39;</span><span class="p">}))</span>
</pre></div>
</div>
<p>These variable settings will override any existing ones in the
buildslave's environment or the environment specified in the
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>. The exception is <span class="target" id="index-12"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt>, which is
merged with (actually prepended to) any existing
<span class="target" id="index-13"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> setting. The following example will prepend
<tt class="file docutils literal"><span class="pre">/home/buildbot/lib/python</span></tt> to any existing
<span class="target" id="index-14"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;PYTHONPATH&#39;</span><span class="p">:</span> <span class="s">&quot;/home/buildbot/lib/python&quot;</span><span class="p">}))</span>
</pre></div>
</div>
<p>To avoid the need of concatenating path together in the master config file,
if the value is a list, it will be joined together using the right platform
dependant separator.</p>
<p>Those variables support expansion so that if you just want to prepend
<tt class="file docutils literal"><span class="pre">/home/buildbot/bin</span></tt> to the <span class="target" id="index-15"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt> environment variable, you can do
it by putting the value <tt class="docutils literal"><span class="pre">${PATH}</span></tt> at the end of the value like
in the example below. Variables that don't exist on the slave will be
replaced by <tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;PATH&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;/home/buildbot/bin&quot;</span><span class="p">,</span>
                            <span class="s">&quot;${PATH}&quot;</span><span class="p">]}))</span>
</pre></div>
</div>
<p class="last">Note that environment values must be strings (or lists that are turned into
strings).  In particular, numeric properties such as <tt class="docutils literal"><span class="pre">buildnumber</span></tt> must
be substituted using <a class="reference internal" href="#interpolate"><em>Interpolate</em></a>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">want_stdout</span></tt></dt>
<dd>if <tt class="docutils literal"><span class="pre">False</span></tt>, stdout from the child process is discarded rather than being
sent to the buildmaster for inclusion in the step's <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">want_stderr</span></tt></dt>
<dd>like <tt class="docutils literal"><span class="pre">want_stdout</span></tt> but for <tt class="file docutils literal"><span class="pre">stderr</span></tt>. Note that commands run through
a PTY do not have separate <tt class="file docutils literal"><span class="pre">stdout</span></tt>/<tt class="file docutils literal"><span class="pre">stderr</span></tt> streams: both are merged into
<tt class="file docutils literal"><span class="pre">stdout</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">usePTY</span></tt></dt>
<dd><p class="first">Should this command be run in a <tt class="docutils literal"><span class="pre">pty</span></tt>?  The default is to observe the
configuration of the client (<a class="reference internal" href="#buildslave-options"><em>Buildslave Options</em></a>), but specifying
<tt class="docutils literal"><span class="pre">True</span></tt> or <tt class="docutils literal"><span class="pre">False</span></tt> here will override the
default. This option is not available on Windows.</p>
<p>In general, you do not want to use a pseudo-terminal.  This is is
<em>only</em> useful for running commands that require a terminal - for
example, testing a command-line application that will only accept
passwords read from a terminal. Using a pseudo-terminal brings
lots of compatibility problems, and prevents Buildbot from
distinguishing the standard error (red) and standard output
(black) streams.</p>
<p>In previous versions, the advantage of using a pseudo-terminal was
that <tt class="docutils literal"><span class="pre">grandchild</span></tt> processes were more likely to be cleaned up if
the build was interrupted or times out.  This occurred because
using a pseudo-terminal incidentally puts the command into its own
process group.</p>
<p class="last">As of Buildbot-0.8.4, all commands are placed in process groups,
and thus grandchild processes will be cleaned up properly.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">logfiles</span></tt></dt>
<dd><p class="first">Sometimes commands will log interesting data to a local file, rather
than emitting everything to stdout or stderr. For example, Twisted's
<strong class="command">trial</strong> command (which runs unit tests) only presents summary
information to stdout, and puts the rest into a file named
<tt class="file docutils literal"><span class="pre">_trial_temp/test.log</span></tt>. It is often useful to watch these files
as the command runs, rather than using <strong class="command">/bin/cat</strong> to dump
their contents afterwards.</p>
<p>The <tt class="docutils literal"><span class="pre">logfiles=</span></tt> argument allows you to collect data from these
secondary logfiles in near-real-time, as the step is running. It
accepts a dictionary which maps from a local Log name (which is how
the log data is presented in the build results) to either a remote filename
(interpreted relative to the build's working directory), or a dictionary
of options. Each named file will be polled on a regular basis (every couple
of seconds) as the build runs, and any new text will be sent over to the
buildmaster.</p>
<p>If you provide a dictionary of options instead of a string, you must specify
the <tt class="docutils literal"><span class="pre">filename</span></tt> key. You can optionally provide a <tt class="docutils literal"><span class="pre">follow</span></tt> key which
is a boolean controlling whether a logfile is followed or concatenated in its
entirety.  Following is appropriate for logfiles to which the build step will
append, where the pre-existing contents are not interesting.  The default value
for <tt class="docutils literal"><span class="pre">follow</span></tt> is <tt class="docutils literal"><span class="pre">False</span></tt>, which gives the same behavior as just
providing a string filename.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">logfiles</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;triallog&quot;</span><span class="p">:</span> <span class="s">&quot;_trial_temp/test.log&quot;</span><span class="p">}))</span>
</pre></div>
</div>
<p>The above example will add a log named 'triallog' on the master,
based on <tt class="file docutils literal"><span class="pre">_trial_temp/test.log</span></tt> on the slave.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">logfiles</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;triallog&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;filename&quot;</span><span class="p">:</span> <span class="s">&quot;_trial_temp/test.log&quot;</span><span class="p">,</span>
                   <span class="s">&quot;follow&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,}}))</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">lazylogfiles</span></tt></dt>
<dd>If set to <tt class="docutils literal"><span class="pre">True</span></tt>, logfiles will be tracked lazily, meaning that they will
only be added when and if something is written to them. This can be used to
suppress the display of empty or missing log files. The default is <tt class="docutils literal"><span class="pre">False</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd>if the command fails to produce any output for this many seconds, it
is assumed to be locked up and will be killed. This defaults to
1200 seconds. Pass <tt class="docutils literal"><span class="pre">None</span></tt> to disable.</dd>
<dt><tt class="docutils literal"><span class="pre">maxTime</span></tt></dt>
<dd>if the command takes longer than this many seconds, it will be
killed. This is disabled by default.</dd>
<dt><tt class="docutils literal"><span class="pre">description</span></tt></dt>
<dd>This will be used to describe the command (on the Waterfall display)
while the command is still running. It should be a single
imperfect-tense verb, like <cite>compiling</cite> or <cite>testing</cite>. The preferred
form is a list of short strings, which allows the HTML
displays to create narrower columns by emitting a &lt;br&gt; tag between each
word. You may also provide a single string.</dd>
<dt><tt class="docutils literal"><span class="pre">descriptionDone</span></tt></dt>
<dd><p class="first">This will be used to describe the command once it has finished. A
simple noun like <cite>compile</cite> or <cite>tests</cite> should be used. Like
<tt class="docutils literal"><span class="pre">description</span></tt>, this may either be a list of short strings or a
single string.</p>
<p>If neither <tt class="docutils literal"><span class="pre">description</span></tt> nor <tt class="docutils literal"><span class="pre">descriptionDone</span></tt> are set, the
actual command arguments will be used to construct the description.
This may be a bit too wide to fit comfortably on the Waterfall
display.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">],</span>
                       <span class="n">description</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;testing&quot;</span><span class="p">],</span>
                       <span class="n">descriptionDone</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;tests&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">descriptionSuffix</span></tt></dt>
<dd><p class="first">This is an optional suffix appended to the end of the description (ie,
after <tt class="docutils literal"><span class="pre">description</span></tt> and <tt class="docutils literal"><span class="pre">descriptionDone</span></tt>). This can be used to distinguish
between build steps that would display the same descriptions in the waterfall.
This parameter may be set to list of short strings, a single string, or <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p class="last">For example, a builder might use the <tt class="docutils literal"><span class="pre">Compile</span></tt> step to build two different
codebases. The <tt class="docutils literal"><span class="pre">descriptionSuffix</span></tt> could be set to <cite>projectFoo</cite> and <cite>projectBar</cite>,
respectively for each step, which will result in the full descriptions
<cite>compiling projectFoo</cite> and <cite>compiling projectBar</cite> to be shown in the waterfall.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">logEnviron</span></tt></dt>
<dd>If this option is <tt class="docutils literal"><span class="pre">True</span></tt> (the default), then the step's logfile will describe the
environment variables on the slave.  In situations where the environment is not
relevant and is long, it may be easier to set <tt class="docutils literal"><span class="pre">logEnviron=False</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">interruptSignal</span></tt></dt>
<dd>If the command should be interrupted (either by buildmaster or timeout
etc.), what signal should be sent to the process, specified by name. By
default this is &quot;KILL&quot; (9). Specify &quot;TERM&quot; (15) to give the process a
chance to cleanup.  This functionality requires a 0.8.6 slave or newer.</dd>
<dt><tt class="docutils literal"><span class="pre">initialStdin</span></tt></dt>
<dd>If the command expects input on stdin, that can be supplied a a string with
this parameter.  This value should not be excessively large, as it is
handled as a single string throughout Buildbot -- for example, do not pass
the contents of a tarball with this parameter.</dd>
<dt><tt class="docutils literal"><span class="pre">decodeRC</span></tt></dt>
<dd>This is a dictionary that decodes exit codes into results value.
e.g: <tt class="docutils literal"><span class="pre">{0:SUCCESS,1:FAILURE,2:WARNINGS}</span></tt>, will treat the exit code <tt class="docutils literal"><span class="pre">2</span></tt> as
WARNINGS.
The default is to treat just 0 as successful. (<tt class="docutils literal"><span class="pre">{0:SUCCESS}</span></tt>)
any exit code not present in the dictionary will be treated as <tt class="docutils literal"><span class="pre">FAILURE</span></tt></dd>
</dl>
</div>
<div class="section" id="configure">
<span id="step-Configure"></span><h6>Configure<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.Configure">
<em class="property">class </em><tt class="descclassname">buildbot.steps.shell.</tt><tt class="descname">Configure</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.Configure" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is intended to handle the <strong class="command">./configure</strong> step from
autoconf-style projects, or the <tt class="docutils literal"><span class="pre">perl</span> <span class="pre">Makefile.PL</span></tt> step from perl
<tt class="file docutils literal"><span class="pre">MakeMaker.pm</span></tt>-style modules. The default command is <strong class="command">./configure</strong>
but you can change this by providing a <tt class="docutils literal"><span class="pre">command=</span></tt> parameter. The arguments are
identical to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">Configure</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Configure</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="compile">
<span id="step-Compile"></span><h6>Compile<a class="headerlink" href="#compile" title="Permalink to this headline">¶</a></h6>
<p id="index-16">This is meant to handle compiling or building a project written in C.
The default command is <tt class="docutils literal"><span class="pre">make</span> <span class="pre">all</span></tt>. When the compile is finished,
the log file is scanned for GCC warning messages, a summary log is
created with any problems that were seen, and the step is marked as
WARNINGS if any were discovered. Through the <tt class="xref py py-class docutils literal"><span class="pre">WarningCountingShellCommand</span></tt>
superclass, the number of warnings is stored in a Build Property named
<cite>warnings-count</cite>, which is accumulated over all <a class="reference internal" href="#step-Compile" title="Compile"><tt class="xref bb bb-step docutils literal"><span class="pre">Compile</span></tt></a> steps (so if two
warnings are found in one step, and three are found in another step, the
overall build will have a <cite>warnings-count</cite> property of 5). Each step can be
optionally given a maximum number of warnings via the maxWarnCount parameter.
If this limit is exceeded, the step will be marked as a failure.</p>
<p>The default regular expression used to detect a warning is
<tt class="docutils literal"><span class="pre">'.*warning[:</span> <span class="pre">].*'</span></tt> , which is fairly liberal and may cause
false-positives. To use a different regexp, provide a
<tt class="docutils literal"><span class="pre">warningPattern=</span></tt> argument, or use a subclass which sets the
<tt class="docutils literal"><span class="pre">warningPattern</span></tt> attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">Compile</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">],</span>
                  <span class="n">warningPattern</span><span class="o">=</span><span class="s">&quot;^Warning: &quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">warningPattern=</span></tt> can also be a pre-compiled python regexp
object: this makes it possible to add flags like <tt class="docutils literal"><span class="pre">re.I</span></tt> (to use
case-insensitive matching).</p>
<p>Note that the compiled <tt class="docutils literal"><span class="pre">warningPattern</span></tt> will have its <tt class="xref py py-meth docutils literal"><span class="pre">match</span></tt> method
called, which is subtly different from a <tt class="xref py py-meth docutils literal"><span class="pre">search</span></tt>. Your regular
expression must match the from the beginning of the line. This means that to
look for the word &quot;warning&quot; in the middle of a line, you will need to
prepend <tt class="docutils literal"><span class="pre">'.*'</span></tt> to your regular expression.</p>
<p>The <tt class="docutils literal"><span class="pre">suppressionFile=</span></tt> argument can be specified as the (relative) path
of a file inside the workdir defining warnings to be suppressed from the
warning counting and log file. The file will be uploaded to the master from
the slave before compiling, and any warning matched by a line in the
suppression file will be ignored. This is useful to accept certain warnings
(eg. in some special module of the source tree or in cases where the compiler
is being particularly stupid), yet still be able to easily detect and fix the
introduction of new warnings.</p>
<p>The file must contain one line per pattern of warnings to ignore. Empty lines
and lines beginning with <tt class="docutils literal"><span class="pre">#</span></tt> are ignored. Other lines must consist of a
regexp matching the file name, followed by a colon (<tt class="docutils literal"><span class="pre">:</span></tt>), followed by a
regexp matching the text of the warning. Optionally this may be followed by
another colon and a line number range. For example:</p>
<div class="highlight-none"><div class="highlight"><pre># Sample warning suppression file

mi_packrec.c : .*result of 32-bit shift implicitly converted to 64 bits.* : 560-600
DictTabInfo.cpp : .*invalid access to non-static.*
kernel_types.h : .*only defines private constructors and has no friends.* : 51
</pre></div>
</div>
<p>If no line number range is specified, the pattern matches the whole file; if
only one number is given it matches only on that line.</p>
<p>The default warningPattern regexp only matches the warning text, so line
numbers and file names are ignored. To enable line number and file name
matching, privide a different regexp and provide a function (callable) as the
argument of <tt class="docutils literal"><span class="pre">warningExtractor=</span></tt>. The function is called with three
arguments: the <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> object, the line in the log file with the warning,
and the <tt class="docutils literal"><span class="pre">SRE_Match</span></tt> object of the regexp search for <tt class="docutils literal"><span class="pre">warningPattern</span></tt>. It
should return a tuple <tt class="docutils literal"><span class="pre">(filename,</span> <span class="pre">linenumber,</span> <span class="pre">warning_test)</span></tt>. For
example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Compile</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">],</span>
                  <span class="n">warningPattern</span><span class="o">=</span><span class="s">&quot;^(.\*?):([0-9]+): [Ww]arning: (.\*)$&quot;</span><span class="p">,</span>
                  <span class="n">warningExtractor</span><span class="o">=</span><span class="n">Compile</span><span class="o">.</span><span class="n">warnExtractFromRegexpGroups</span><span class="p">,</span>
                  <span class="n">suppressionFile</span><span class="o">=</span><span class="s">&quot;support-files/compiler_warnings.supp&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>(<tt class="docutils literal"><span class="pre">Compile.warnExtractFromRegexpGroups</span></tt> is a pre-defined function that
returns the filename, linenumber, and text from groups (1,2,3) of the regexp
match).</p>
<p>In projects with source files in multiple directories, it is possible to get
full path names for file names matched in the suppression file, as long as the
build command outputs the names of directories as they are entered into and
left again. For this, specify regexps for the arguments
<tt class="docutils literal"><span class="pre">directoryEnterPattern=</span></tt> and <tt class="docutils literal"><span class="pre">directoryLeavePattern=</span></tt>. The
<tt class="docutils literal"><span class="pre">directoryEnterPattern=</span></tt> regexp should return the name of the directory
entered into in the first matched group. The defaults, which are suitable for
.. GNU Make, are these:</p>
<div class="highlight-python"><pre>..     directoryEnterPattern = "make.*: Entering directory [\"`'](.*)['`\"]"
..     directoryLeavePattern = "make.*: Leaving directory"</pre>
</div>
<p>(TODO: this step needs to be extended to look for GCC error messages
as well, and collect them into a separate logfile, along with the
source code filenames involved).</p>
<span class="target" id="index-17"></span><span class="target" id="step-VC6"></span><span class="target" id="step-VC7"></span><span class="target" id="step-VC8"></span><span class="target" id="step-VC2003"></span><span class="target" id="step-VC2005"></span><span class="target" id="step-VC2008"></span></div>
<div class="section" id="visual-c">
<span id="step-VCExpress9"></span><h6>Visual C++<a class="headerlink" href="#visual-c" title="Permalink to this headline">¶</a></h6>
<p>This step is meant to handle compilation using Microsoft compilers.
VC++ 6-9, VS2003, VS2005, VS2008, and VCExpress9 are supported. This step will take care
of setting up a clean compilation environment, parse the generated
output in real time and deliver as detailed as possible information
about the compilation executed.</p>
<p>All of the classes are in <tt class="xref py py-mod docutils literal"><span class="pre">buildbot.steps.vstudio</span></tt>.  The available classes are:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">VC6</span></tt></li>
<li><tt class="docutils literal"><span class="pre">VC7</span></tt></li>
<li><tt class="docutils literal"><span class="pre">VC8</span></tt></li>
<li><tt class="docutils literal"><span class="pre">VC9</span></tt></li>
<li><tt class="docutils literal"><span class="pre">VS2003</span></tt></li>
<li><tt class="docutils literal"><span class="pre">VC2005</span></tt></li>
<li><tt class="docutils literal"><span class="pre">VC2008</span></tt></li>
<li><tt class="docutils literal"><span class="pre">VCExpress9</span></tt></li>
</ul>
</div></blockquote>
<p>The available constructor arguments are</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd>The mode default to <tt class="docutils literal"><span class="pre">rebuild</span></tt>, which means that first all the
remaining object files will be cleaned by the compiler. The alternate
values are <tt class="docutils literal"><span class="pre">build</span></tt>, where only the updated files will be recompiled,
and <tt class="docutils literal"><span class="pre">clean</span></tt>, where the current build files are removed and no
compilation occurs.</dd>
<dt><tt class="docutils literal"><span class="pre">projectfile</span></tt></dt>
<dd>This is a mandatory argument which specifies the project file to be used
during the compilation.</dd>
<dt><tt class="docutils literal"><span class="pre">config</span></tt></dt>
<dd>This argument defaults to <tt class="docutils literal"><span class="pre">release</span></tt> an gives to the compiler the
configuration to use.</dd>
<dt><tt class="docutils literal"><span class="pre">installdir</span></tt></dt>
<dd>This is the place where the compiler is installed. The default value is
compiler specific and is the default place where the compiler is installed.</dd>
<dt><tt class="docutils literal"><span class="pre">useenv</span></tt></dt>
<dd>This boolean parameter, defaulting to <tt class="docutils literal"><span class="pre">False</span></tt> instruct the compiler
to use its own settings or the one defined through the environment
variables <span class="target" id="index-18"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt>, <span class="target" id="index-19"></span><tt class="xref std std-envvar docutils literal"><span class="pre">INCLUDE</span></tt>, and <span class="target" id="index-20"></span><tt class="xref std std-envvar docutils literal"><span class="pre">LIB</span></tt>. If any of
the <tt class="docutils literal"><span class="pre">INCLUDE</span></tt> or  <tt class="docutils literal"><span class="pre">LIB</span></tt> parameter is defined, this parameter
automatically switches to <tt class="docutils literal"><span class="pre">True</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">PATH</span></tt></dt>
<dd>This is a list of path to be added to the <span class="target" id="index-21"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt> environment
variable. The default value is the one defined in the compiler options.</dd>
<dt><tt class="docutils literal"><span class="pre">INCLUDE</span></tt></dt>
<dd>This is a list of path where the compiler will first look for include
files. Then comes the default paths defined in the compiler options.</dd>
<dt><tt class="docutils literal"><span class="pre">LIB</span></tt></dt>
<dd>This is a list of path where the compiler will first look for
libraries. Then comes the default path defined in the compiler options.</dd>
<dt><tt class="docutils literal"><span class="pre">arch</span></tt></dt>
<dd>That one is only available with the class VS2005 (VC8). It gives the
target architecture of the built artifact. It defaults to <tt class="docutils literal"><span class="pre">x86</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">project</span></tt></dt>
<dd>This gives the specific project to build from within a
workspace. It defaults to building all projects. This is useful
for building cmake generate projects.</dd>
</dl>
<p>Here is an example on how to use this step:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.VisualStudio</span> <span class="kn">import</span> <span class="n">VS2005</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">VS2005</span><span class="p">(</span>
        <span class="n">projectfile</span><span class="o">=</span><span class="s">&quot;project.sln&quot;</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="s">&quot;release&quot;</span><span class="p">,</span>
        <span class="n">arch</span><span class="o">=</span><span class="s">&quot;x64&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;build&quot;</span><span class="p">,</span>
        <span class="n">INCLUDE</span><span class="o">=</span><span class="p">[</span><span class="s">r&#39;D:\WINDDK\Include\wnet&#39;</span><span class="p">],</span>
        <span class="n">LIB</span><span class="o">=</span><span class="p">[</span><span class="s">r&#39;D:\WINDDK\lib\wnet\amd64&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="test">
<span id="step-Test"></span><h6>Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">Test</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Test</span><span class="p">())</span>
</pre></div>
</div>
<p>This is meant to handle unit tests. The default command is <strong class="command">make
test</strong>, and the <tt class="docutils literal"><span class="pre">warnOnFailure</span></tt> flag is set. The other arguments are identical
to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>.</p>
<span class="target" id="step-TreeSize"></span></div>
<div class="section" id="treesize">
<span id="index-22"></span><h6>TreeSize<a class="headerlink" href="#treesize" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">TreeSize</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">TreeSize</span><span class="p">())</span>
</pre></div>
</div>
<p>This is a simple command that uses the <strong class="command">du</strong> tool to measure the size
of the code tree. It puts the size (as a count of 1024-byte blocks, aka 'KiB'
or 'kibibytes') on the step's status text, and sets a build property named
<tt class="docutils literal"><span class="pre">tree-size-KiB</span></tt> with the same value.  All arguments are identical to
<a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>.</p>
</div>
<div class="section" id="perlmoduletest">
<span id="step-PerlModuleTest"></span><h6>PerlModuleTest<a class="headerlink" href="#perlmoduletest" title="Permalink to this headline">¶</a></h6>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">PerlModuleTest</span>
<span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PerlModuleTest</span><span class="p">())</span>
</pre></div>
</div>
<p>This is a simple command that knows how to run tests of perl modules.  It
parses the output to determine the number of tests passed and failed and total
number executed, saving the results for later query.  The command is <tt class="docutils literal"><span class="pre">prove</span>
<span class="pre">--lib</span> <span class="pre">lib</span> <span class="pre">-r</span> <span class="pre">t</span></tt>, although this can be overridden with the <tt class="docutils literal"><span class="pre">command</span></tt>
argument.  All other arguments are identical to those for
<a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>.</p>
</div>
<div class="section" id="mtr-mysql-test-run">
<span id="step-MTR"></span><h6>MTR (mysql-test-run)<a class="headerlink" href="#mtr-mysql-test-run" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-MTR" title="MTR"><tt class="xref bb bb-step docutils literal"><span class="pre">MTR</span></tt></a> class is a subclass of <a class="reference internal" href="#step-Test" title="Test"><tt class="xref bb bb-step docutils literal"><span class="pre">Test</span></tt></a>.
It is used to run test suites using the mysql-test-run program,
as used in MySQL, Drizzle, MariaDB, and MySQL storage engine plugins.</p>
<p>The shell command to run the test suite is specified in the same way as for
the <a class="reference internal" href="#step-Test" title="Test"><tt class="xref bb bb-step docutils literal"><span class="pre">Test</span></tt></a> class. The <a class="reference internal" href="#step-MTR" title="MTR"><tt class="xref bb bb-step docutils literal"><span class="pre">MTR</span></tt></a> class will parse the output of running the test suite,
and use the count of tests executed so far to provide more accurate completion
time estimates. Any test failures that occur during the test are summarized on
the Waterfall Display.</p>
<p>Server error logs are added as additional log files, useful to debug test
failures.</p>
<p>Optionally, data about the test run and any test failures can be inserted into
a database for further analysis and report generation. To use this facility,
create an instance of <tt class="xref py py-class docutils literal"><span class="pre">twisted.enterprise.adbapi.ConnectionPool</span></tt> with
connections to the database. The necessary tables can be created automatically
by setting <tt class="docutils literal"><span class="pre">autoCreateTables</span></tt> to <tt class="docutils literal"><span class="pre">True</span></tt>, or manually using the SQL
found in the <tt class="file docutils literal"><span class="pre">mtrlogobserver.py</span></tt> source file.</p>
<p>One problem with specifying a database is that each reload of the
configuration will get a new instance of <tt class="docutils literal"><span class="pre">ConnectionPool</span></tt> (even if the
connection parameters are the same). To avoid that Buildbot thinks the builder
configuration has changed because of this, use the
<tt class="xref py py-class docutils literal"><span class="pre">process.mtrlogobserver.EqConnectionPool</span></tt> subclass of
<tt class="xref py py-class docutils literal"><span class="pre">ConnectionPool</span></tt>, which implements an equiality operation that avoids
this problem.</p>
<p>Example use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.mtrlogobserver</span> <span class="kn">import</span> <span class="n">MTR</span><span class="p">,</span> <span class="n">EqConnectionPool</span>
<span class="n">myPool</span> <span class="o">=</span> <span class="n">EqConnectionPool</span><span class="p">(</span><span class="s">&quot;MySQLdb&quot;</span><span class="p">,</span> <span class="s">&quot;host&quot;</span><span class="p">,</span> <span class="s">&quot;buildbot&quot;</span><span class="p">,</span> <span class="s">&quot;password&quot;</span><span class="p">,</span> <span class="s">&quot;db&quot;</span><span class="p">)</span>
<span class="n">myFactory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MTR</span><span class="p">(</span><span class="n">workdir</span><span class="o">=</span><span class="s">&quot;mysql-test&quot;</span><span class="p">,</span> <span class="n">dbpool</span><span class="o">=</span><span class="n">myPool</span><span class="p">,</span>
                      <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;perl&quot;</span><span class="p">,</span> <span class="s">&quot;mysql-test-run.pl&quot;</span><span class="p">,</span> <span class="s">&quot;--force&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#step-MTR" title="MTR"><tt class="xref bb bb-step docutils literal"><span class="pre">MTR</span></tt></a> step's arguments are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">textLimit</span></tt></dt>
<dd>Maximum number of test failures to show on the waterfall page (to not flood
the page in case of a large number of test failures. Defaults to 5.</dd>
<dt><tt class="docutils literal"><span class="pre">testNameLimit</span></tt></dt>
<dd>Maximum length of test names to show unabbreviated in the waterfall page, to
avoid excessive column width. Defaults to 16.</dd>
<dt><tt class="docutils literal"><span class="pre">parallel</span></tt></dt>
<dd>Value of <em class="xref std std-option">--parallel</em> option used for <tt class="file docutils literal"><span class="pre">mysql-test-run.pl</span></tt> (number of processes
used to run the test suite in parallel). Defaults to 4. This is used to
determine the number of server error log files to download from the
slave. Specifying a too high value does not hurt (as nonexisting error logs
will be ignored), however if using <em class="xref std std-option">--parallel</em> value greater than the default
it needs to be specified, or some server error logs will be missing.</dd>
<dt><tt class="docutils literal"><span class="pre">dbpool</span></tt></dt>
<dd>An instance of <tt class="xref py py-class docutils literal"><span class="pre">twisted.enterprise.adbapi.ConnectionPool</span></tt>, or <tt class="docutils literal"><span class="pre">None</span></tt>.  Defaults to
<tt class="docutils literal"><span class="pre">None</span></tt>. If specified, results are inserted into the database using the
<tt class="xref py py-class docutils literal"><span class="pre">ConnectionPool</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">autoCreateTables</span></tt></dt>
<dd>Boolean, defaults to <tt class="docutils literal"><span class="pre">False</span></tt>. If <tt class="docutils literal"><span class="pre">True</span></tt> (and <tt class="docutils literal"><span class="pre">dbpool</span></tt> is specified), the
necessary database tables will be created automatically if they do not exist
already. Alternatively, the tables can be created manually from the SQL
statements found in the <tt class="file docutils literal"><span class="pre">mtrlogobserver.py</span></tt> source file.</dd>
<dt><tt class="docutils literal"><span class="pre">test_type</span></tt></dt>
<dd>Short string that will be inserted into the database in the row for the test
run. Defaults to the empty string, but can be specified to identify different
types of test runs.</dd>
<dt><tt class="docutils literal"><span class="pre">test_info</span></tt></dt>
<dd>Descriptive string that will be inserted into the database in the row for the test
run. Defaults to the empty string, but can be specified as a user-readable
description of this particular test run.</dd>
<dt><tt class="docutils literal"><span class="pre">mtr_subdir</span></tt></dt>
<dd>The subdirectory in which to look for server error log files. Defaults to
<tt class="file docutils literal"><span class="pre">mysql-test</span></tt>, which is usually correct. <a class="reference internal" href="#interpolate"><em>Interpolate</em></a> is supported.</dd>
</dl>
</div>
<div class="section" id="subunitshellcommand">
<span id="step-subunitshellcommand"></span><span id="step-SubunitShellCommand"></span><h6>SubunitShellCommand<a class="headerlink" href="#subunitshellcommand" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.subunit.SubunitShellCommand">
<em class="property">class </em><tt class="descclassname">buildbot.steps.subunit.</tt><tt class="descname">SubunitShellCommand</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.subunit.SubunitShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This buildstep is similar to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>, except that it runs the log content
through a subunit filter to extract test and failure counts.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.subunit</span> <span class="kn">import</span> <span class="n">SubunitShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SubunitShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s">&quot;make test&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This runs <tt class="docutils literal"><span class="pre">make</span> <span class="pre">test</span></tt> and filters it through subunit. The 'tests' and
'test failed' progress metrics will now accumulate test data from the test run.</p>
<p>If <tt class="docutils literal"><span class="pre">failureOnNoTests</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>, this step will fail if no test is run. By
default <tt class="docutils literal"><span class="pre">failureOnNoTests</span></tt> is False.</p>
</div>
</div>
<div class="section" id="slave-filesystem-steps">
<span id="id12"></span><h5>Slave Filesystem Steps<a class="headerlink" href="#slave-filesystem-steps" title="Permalink to this headline">¶</a></h5>
<p>Here are some buildsteps for manipulating the slave's filesystem.</p>
<div class="section" id="fileexists">
<span id="step-FileExists"></span><h6>FileExists<a class="headerlink" href="#fileexists" title="Permalink to this headline">¶</a></h6>
<p>This step will assert that a given file exists, failing if it does not.  The
filename can be specified with a property.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.slave</span> <span class="kn">import</span> <span class="n">FileExists</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">FileExists</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s">&#39;test_data&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires slave version 0.8.4 or later.</p>
</div>
<div class="section" id="removedirectory">
<span id="step-RemoveDirectory"></span><h6>RemoveDirectory<a class="headerlink" href="#removedirectory" title="Permalink to this headline">¶</a></h6>
<p>This command recursively deletes a directory on the slave.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.slave</span> <span class="kn">import</span> <span class="n">RemoveDirectory</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">RemoveDirectory</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s">&quot;build/build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires slave version 0.8.4 or later.</p>
</div>
<div class="section" id="makedirectory">
<span id="step-MakeDirectory"></span><h6>MakeDirectory<a class="headerlink" href="#makedirectory" title="Permalink to this headline">¶</a></h6>
<p>This command creates a directory on the slave.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.slave</span> <span class="kn">import</span> <span class="n">MakeDirectory</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MakeDirectory</span><span class="p">(</span><span class="nb">dir</span><span class="o">=</span><span class="s">&quot;build/build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step requires slave version 0.8.5 or later.</p>
</div>
</div>
<div class="section" id="python-buildsteps">
<span id="id13"></span><h5>Python BuildSteps<a class="headerlink" href="#python-buildsteps" title="Permalink to this headline">¶</a></h5>
<p>Here are some <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s that are specifcally useful for projects
implemented in Python.</p>
<div class="section" id="buildepydoc">
<span id="step-buildepydoc"></span><span id="step-BuildEPYDoc"></span><h6>BuildEPYDoc<a class="headerlink" href="#buildepydoc" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.BuildEPYDoc">
<em class="property">class </em><tt class="descclassname">buildbot.steps.python.</tt><tt class="descname">BuildEPYDoc</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.BuildEPYDoc" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://epydoc.sourceforge.net/">epydoc</a> is a tool for generating
API documentation for Python modules from their docstrings. It reads
all the <tt class="file docutils literal"><span class="pre">.py</span></tt> files from your source tree, processes the docstrings
therein, and creates a large tree of <tt class="file docutils literal"><span class="pre">.html</span></tt> files (or a single <tt class="file docutils literal"><span class="pre">.pdf</span></tt>
file).</p>
<p>The <a class="reference internal" href="#step-BuildEPYDoc" title="BuildEPYDoc"><tt class="xref bb bb-step docutils literal"><span class="pre">BuildEPYDoc</span></tt></a> step will run
<strong class="command">epydoc</strong> to produce this API documentation, and will count the
errors and warnings from its output.</p>
<p>You must supply the command line to be used. The default is
<tt class="docutils literal"><span class="pre">make</span> <span class="pre">epydocs</span></tt>, which assumes that your project has a <tt class="file docutils literal"><span class="pre">Makefile</span></tt>
with an <cite>epydocs</cite> target. You might wish to use something like
<tt class="samp docutils literal"><span class="pre">epydoc</span> <span class="pre">-o</span> <span class="pre">apiref</span> <span class="pre">source/</span><em><span class="pre">PKGNAME</span></em></tt> instead. You might also want
to add <em class="xref std std-option">--pdf</em> to generate a PDF file instead of a large tree
of HTML files.</p>
<p>The API docs are generated in-place in the build tree (under the
workdir, in the subdirectory controlled by the <em class="xref std std-option">-o</em> argument). To
make them useful, you will probably have to copy them to somewhere
they can be read. A command like <tt class="docutils literal"><span class="pre">rsync</span> <span class="pre">-ad</span> <span class="pre">apiref/</span>
<span class="pre">dev.example.com:~public_html/current-apiref/</span></tt> might be useful. You
might instead want to bundle them into a tarball and publish it in the
same place where the generated install tarball is placed.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.python</span> <span class="kn">import</span> <span class="n">BuildEPYDoc</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">BuildEPYDoc</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;epydoc&quot;</span><span class="p">,</span> <span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;apiref&quot;</span><span class="p">,</span> <span class="s">&quot;source/mypkg&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="pyflakes">
<span id="step-pyflake"></span><span id="step-PyFlakes"></span><h6>PyFlakes<a class="headerlink" href="#pyflakes" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.PyFlakes">
<em class="property">class </em><tt class="descclassname">buildbot.steps.python.</tt><tt class="descname">PyFlakes</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.PyFlakes" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://divmod.org/trac/wiki/DivmodPyflakes">PyFlakes</a> is a tool
to perform basic static analysis of Python code to look for simple
errors, like missing imports and references of undefined names. It is
like a fast and simple form of the C <strong class="command">lint</strong> program. Other tools
(like <a class="reference external" href="http://pychecker.sourceforge.net/">pychecker</a>)
provide more detailed results but take longer to run.</p>
<p>The <a class="reference internal" href="#step-PyFlakes" title="PyFlakes"><tt class="xref bb bb-step docutils literal"><span class="pre">PyFlakes</span></tt></a> step will run pyflakes and
count the various kinds of errors and warnings it detects.</p>
<p>You must supply the command line to be used. The default is
<tt class="docutils literal"><span class="pre">make</span> <span class="pre">pyflakes</span></tt>, which assumes you have a top-level <tt class="file docutils literal"><span class="pre">Makefile</span></tt>
with a <tt class="docutils literal"><span class="pre">pyflakes</span></tt> target. You might want to use something like
<tt class="docutils literal"><span class="pre">pyflakes</span> <span class="pre">.</span></tt> or <tt class="docutils literal"><span class="pre">pyflakes</span> <span class="pre">src</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.python</span> <span class="kn">import</span> <span class="n">PyFlakes</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">PyFlakes</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;pyflakes&quot;</span><span class="p">,</span> <span class="s">&quot;src&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="sphinx">
<span id="step-sphinx"></span><span id="step-Sphinx"></span><h6>Sphinx<a class="headerlink" href="#sphinx" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python.Sphinx">
<em class="property">class </em><tt class="descclassname">buildbot.steps.python.</tt><tt class="descname">Sphinx</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python.Sphinx" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference external" href="http://sphinx.pocoo.org/">Shinx</a> is  the Python Documentation
Generator. It uses <a class="reference external" href="http://docutils.sourceforge.net/rst.html">RestructuredText</a>
as input format.</p>
<p>The <a class="reference internal" href="#step-Sphinx" title="Sphinx"><tt class="xref bb bb-step docutils literal"><span class="pre">Sphinx</span></tt></a> step will run
<strong class="program">sphinx-build</strong> or any other program specified in its
<tt class="docutils literal"><span class="pre">sphinx</span></tt> argument and count the various warnings and error it
detects.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.python</span> <span class="kn">import</span> <span class="n">Sphinx</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Sphinx</span><span class="p">(</span><span class="n">sphinx_builddir</span><span class="o">=</span><span class="s">&quot;_build&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This step takes the following arguments:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">sphinx_builddir</span></tt></dt>
<dd>(required) Name of the directory where the documentation will be generated.</dd>
<dt><tt class="docutils literal"><span class="pre">sphinx_sourcedir</span></tt></dt>
<dd>(optional, defaulting to <tt class="docutils literal"><span class="pre">.</span></tt>), Name the directory where the
<tt class="file docutils literal"><span class="pre">conf.py</span></tt> file will be found</dd>
<dt><tt class="docutils literal"><span class="pre">sphinx_builder</span></tt></dt>
<dd>(optional) Indicates the builder to use.</dd>
<dt><tt class="docutils literal"><span class="pre">sphinx</span></tt></dt>
<dd>(optional, defaulting to <strong class="program">shinx-build</strong>) Indicates the
executable to run.</dd>
<dt><tt class="docutils literal"><span class="pre">tags</span></tt></dt>
<dd>(optional) List of <tt class="docutils literal"><span class="pre">tags</span></tt> to pass to <strong class="program">sphinx-build</strong></dd>
<dt><tt class="docutils literal"><span class="pre">defines</span></tt></dt>
<dd>(optional) Dictionnary of defines to overwrite values of the
<tt class="file docutils literal"><span class="pre">conf.py</span></tt> file.</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd>(optional) String, one of <tt class="docutils literal"><span class="pre">full</span></tt> or <tt class="docutils literal"><span class="pre">incremental</span></tt> (the default).
If set to <tt class="docutils literal"><span class="pre">full</span></tt>, indicates to Sphinx to rebuild everything without
re-using the previous build results.</dd>
</dl>
</div>
<div class="section" id="pylint">
<span id="step-pylint"></span><span id="step-PyLint"></span><h6>PyLint<a class="headerlink" href="#pylint" title="Permalink to this headline">¶</a></h6>
<p>Similarly, the <a class="reference internal" href="#step-PyLint" title="PyLint"><tt class="xref bb bb-step docutils literal"><span class="pre">PyLint</span></tt></a> step will run <strong class="command">pylint</strong> and
analyze the results.</p>
<p>You must supply the command line to be used. There is no default.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.python</span> <span class="kn">import</span> <span class="n">PyLint</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">PyLint</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;pylint&quot;</span><span class="p">,</span> <span class="s">&quot;src&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="section" id="trial">
<span id="step-trial"></span><span id="step-Trial"></span><h6>Trial<a class="headerlink" href="#trial" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python_twisted.Trial">
<em class="property">class </em><tt class="descclassname">buildbot.steps.python_twisted.</tt><tt class="descname">Trial</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python_twisted.Trial" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This step runs a unit test suite using <strong class="command">trial</strong>, a unittest-like testing
framework that is a component of Twisted Python. Trial is used to implement
Twisted's own unit tests, and is the unittest-framework of choice for many
projects that use Twisted internally.</p>
<p>Projects that use trial typically have all their test cases in a 'test'
subdirectory of their top-level library directory. For example, for a package
<tt class="docutils literal"><span class="pre">petmail</span></tt>, the tests might be in <tt class="file docutils literal"><span class="pre">petmail/test/test_*.py</span></tt>. More
complicated packages (like Twisted itself) may have multiple test directories,
like <tt class="file docutils literal"><span class="pre">twisted/test/test_*.py</span></tt> for the core functionality and
<tt class="file docutils literal"><span class="pre">twisted/mail/test/test_*.py</span></tt> for the email-specific tests.</p>
<p>To run trial tests manually, you run the <strong class="command">trial</strong> executable and tell it
where the test cases are located. The most common way of doing this is with a
module name. For petmail, this might look like <strong class="command">trial petmail.test</strong>, which
would locate all the <tt class="file docutils literal"><span class="pre">test_*.py</span></tt> files under <tt class="file docutils literal"><span class="pre">petmail/test/</span></tt>, running
every test case it could find in them.  Unlike the <tt class="docutils literal"><span class="pre">unittest.py</span></tt> that
comes with Python, it is not necessary to run the <tt class="file docutils literal"><span class="pre">test_foo.py</span></tt> as a
script; you always let trial do the importing and running. The step's
<tt class="docutils literal"><span class="pre">tests`</span></tt> parameter controls which tests trial will run: it can be a string
or a list of strings.</p>
<p>To find the test cases, the Python search path must allow something like
<tt class="docutils literal"><span class="pre">import</span> <span class="pre">petmail.test</span></tt> to work. For packages that don't use a separate
top-level <tt class="file docutils literal"><span class="pre">lib</span></tt> directory, <tt class="docutils literal"><span class="pre">PYTHONPATH=.</span></tt> will work, and will use the
test cases (and the code they are testing) in-place.
<tt class="docutils literal"><span class="pre">PYTHONPATH=build/lib</span></tt> or <tt class="docutils literal"><span class="pre">PYTHONPATH=build/lib.somearch</span></tt> are also
useful when you do a <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">build</span></tt> step first. The
<tt class="docutils literal"><span class="pre">testpath</span></tt> attribute of this class controls what <span class="target" id="index-23"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> is set
to before running <strong class="command">trial</strong>.</p>
<p>Trial has the ability, through the <tt class="docutils literal"><span class="pre">--testmodule</span></tt> flag, to run only the
set of test cases named by special <tt class="docutils literal"><span class="pre">test-case-name</span></tt> tags in source files.
We can get the list of changed source files from our parent Build and provide
them to trial, thus running the minimal set of test cases needed to cover the
Changes.  This is useful for quick builds, especially in trees with a lot of
test cases.  The <tt class="docutils literal"><span class="pre">testChanges</span></tt> parameter controls this feature: if set, it
will override <tt class="docutils literal"><span class="pre">tests</span></tt>.</p>
<p>The trial executable itself is typically just <strong class="command">trial</strong>, and is typically
found in the shell search path.  It can be overridden with the <tt class="docutils literal"><span class="pre">trial</span></tt>
parameter.  This is useful for Twisted's own unittests, which want to use the
copy of bin/trial that comes with the sources.</p>
<p>To influence the version of python being used for the tests, or to add flags to
the command, set the <tt class="docutils literal"><span class="pre">python</span></tt> parameter. This can be a string (like
<tt class="docutils literal"><span class="pre">python2.2</span></tt>) or a list (like <tt class="docutils literal"><span class="pre">['python2.3',</span> <span class="pre">'-Wall']</span></tt>).</p>
<p>Trial creates and switches into a directory named <tt class="file docutils literal"><span class="pre">_trial_temp/</span></tt> before
running the tests, and sends the twisted log (which includes all exceptions) to
a file named <tt class="file docutils literal"><span class="pre">test.log</span></tt>. This file will be pulled up to the master where
it can be seen as part of the status output.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.python_twisted</span> <span class="kn">import</span> <span class="n">Trial</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Trial</span><span class="p">(</span><span class="n">tests</span><span class="o">=</span><span class="s">&#39;petmail.test&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="removepycs">
<span id="step-RemovePYCs"></span><h6>RemovePYCs<a class="headerlink" href="#removepycs" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.python_twisted.RemovePYCs">
<em class="property">class </em><tt class="descclassname">buildbot.steps.python_twisted.</tt><tt class="descname">RemovePYCs</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.python_twisted.RemovePYCs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This is a simple built-in step that will remove <tt class="docutils literal"><span class="pre">.pyc</span></tt> files from the
workdir.  This is useful in builds that update their source (and thus do not
automatically delete <tt class="docutils literal"><span class="pre">.pyc</span></tt> files) but where some part of the build
process is dynamically searching for Python modules.  Notably, trial has a bad
habit of finding old test modules.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.python_twisted</span> <span class="kn">import</span> <span class="n">RemovePYCs</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">RemovePYCs</span><span class="p">())</span>
</pre></div>
</div>
<span class="target" id="index-24"></span><span class="target" id="step-FileUpload"></span></div>
</div>
<div class="section" id="transferring-files">
<span id="step-FileDownload"></span><h5>Transferring Files<a class="headerlink" href="#transferring-files" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.FileUpload">
<em class="property">class </em><tt class="descclassname">buildbot.steps.transfer.</tt><tt class="descname">FileUpload</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.FileUpload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.FileDownload">
<em class="property">class </em><tt class="descclassname">buildbot.steps.transfer.</tt><tt class="descname">FileDownload</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.FileDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Most of the work involved in a build will take place on the
buildslave. But occasionally it is useful to do some work on the
buildmaster side. The most basic way to involve the buildmaster is
simply to move a file from the slave to the master, or vice versa.
There are a pair of steps named <a class="reference internal" href="#step-FileUpload" title="FileUpload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileUpload</span></tt></a> and
<a class="reference internal" href="#step-FileDownload" title="FileDownload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileDownload</span></tt></a> to provide this functionality. <a class="reference internal" href="#step-FileUpload" title="FileUpload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileUpload</span></tt></a>
moves a file <em>up to</em> the master, while <a class="reference internal" href="#step-FileDownload" title="FileDownload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileDownload</span></tt></a> moves
a file <em>down from</em> the master.</p>
<p>As an example, let's assume that there is a step which produces an
HTML file within the source tree that contains some sort of generated
project documentation. We want to move this file to the buildmaster,
into a <tt class="file docutils literal"><span class="pre">~/public_html</span></tt> directory, so it can be visible to
developers. This file will wind up in the slave-side working directory
under the name <tt class="file docutils literal"><span class="pre">docs/reference.html</span></tt>. We want to put it into the
master-side <tt class="file docutils literal"><span class="pre">~/public_html/ref.html</span></tt>, and add a link to the HTML
status to the uploaded file.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.transfer</span> <span class="kn">import</span> <span class="n">FileUpload</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;docs&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">FileUpload</span><span class="p">(</span><span class="n">slavesrc</span><span class="o">=</span><span class="s">&quot;docs/reference.html&quot;</span><span class="p">,</span>
                     <span class="n">masterdest</span><span class="o">=</span><span class="s">&quot;/home/bb/public_html/ref.html&quot;</span><span class="p">,</span>
                     <span class="n">url</span><span class="o">=</span><span class="s">&quot;http://somesite/~buildbot/ref.html&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">masterdest=</span></tt> argument will be passed to <tt class="xref py py-meth docutils literal"><span class="pre">os.path.expanduser</span></tt>,
so things like <tt class="docutils literal"><span class="pre">~</span></tt> will be expanded properly. Non-absolute paths
will be interpreted relative to the buildmaster's base directory.
Likewise, the <tt class="docutils literal"><span class="pre">slavesrc=</span></tt> argument will be expanded and
interpreted relative to the builder's working directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The copied file will have the same permissions on the master
as on the slave, look at the <tt class="docutils literal"><span class="pre">mode=</span></tt> parameter to set it
differently.</p>
</div>
<p>To move a file from the master to the slave, use the
<a class="reference internal" href="#step-FileDownload" title="FileDownload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileDownload</span></tt></a> command. For example, let's assume that some step
requires a configuration file that, for whatever reason, could not be
recorded in the source code repository or generated on the buildslave
side:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.transfer</span> <span class="kn">import</span> <span class="n">FileDownload</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">FileDownload</span><span class="p">(</span><span class="n">mastersrc</span><span class="o">=</span><span class="s">&quot;~/todays_build_config.txt&quot;</span><span class="p">,</span>
                       <span class="n">slavedest</span><span class="o">=</span><span class="s">&quot;build_config.txt&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;config&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Like <a class="reference internal" href="#step-FileUpload" title="FileUpload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileUpload</span></tt></a>, the <tt class="docutils literal"><span class="pre">mastersrc=</span></tt> argument is interpreted
relative to the buildmaster's base directory, and the
<tt class="docutils literal"><span class="pre">slavedest=</span></tt> argument is relative to the builder's working
directory. If the buildslave is running in <tt class="file docutils literal"><span class="pre">~buildslave</span></tt>, and the
builder's <tt class="docutils literal"><span class="pre">builddir</span></tt> is something like <tt class="file docutils literal"><span class="pre">tests-i386</span></tt>, then the
workdir is going to be <tt class="file docutils literal"><span class="pre">~buildslave/tests-i386/build</span></tt>, and a
<tt class="docutils literal"><span class="pre">slavedest=</span></tt> of <tt class="file docutils literal"><span class="pre">foo/bar.html</span></tt> will get put in
<tt class="file docutils literal"><span class="pre">~buildslave/tests-i386/build/foo/bar.html</span></tt>. Both of these commands
will create any missing intervening directories.</p>
<div class="section" id="other-parameters">
<h6>Other Parameters<a class="headerlink" href="#other-parameters" title="Permalink to this headline">¶</a></h6>
<p>The <tt class="docutils literal"><span class="pre">maxsize=</span></tt> argument lets you set a maximum size for the file
to be transferred. This may help to avoid surprises: transferring a
100MB coredump when you were expecting to move a 10kB status file
might take an awfully long time. The <tt class="docutils literal"><span class="pre">blocksize=</span></tt> argument
controls how the file is sent over the network: larger blocksizes are
slightly more efficient but also consume more memory on each end, and
there is a hard-coded limit of about 640kB.</p>
<p>The <tt class="docutils literal"><span class="pre">mode=</span></tt> argument allows you to control the access permissions
of the target file, traditionally expressed as an octal integer. The
most common value is probably <tt class="docutils literal"><span class="pre">0755</span></tt>, which sets the <cite>x</cite> executable
bit on the file (useful for shell scripts and the like). The default
value for <tt class="docutils literal"><span class="pre">mode=</span></tt> is None, which means the permission bits will
default to whatever the umask of the writing process is. The default
umask tends to be fairly restrictive, but at least on the buildslave
you can make it less restrictive with a --umask command-line option at
creation time (<a class="reference internal" href="#buildslave-options"><em>Buildslave Options</em></a>).</p>
<p>The <tt class="docutils literal"><span class="pre">keepstamp=</span></tt> argument is a boolean that, when <tt class="docutils literal"><span class="pre">True</span></tt>, forces
the modified and accessed time of the destination file to match the
times of the source file.  When <tt class="docutils literal"><span class="pre">False</span></tt> (the default), the modified
and accessed times of the destination file are set to the current time
on the buildmaster.</p>
<p>The <tt class="docutils literal"><span class="pre">url=</span></tt> argument allows you to specify an url that will be
displayed in the HTML status. The title of the url will be the name of
the item transfered (directory for <tt class="xref py py-class docutils literal"><span class="pre">DirectoryUpload</span></tt> or file
for <tt class="xref py py-class docutils literal"><span class="pre">FileUpload</span></tt>). This allows the user to add a link to the
uploaded item if that one is uploaded to an accessible place.</p>
</div>
<div class="section" id="transfering-directories">
<span id="step-DirectoryUpload"></span><h6>Transfering Directories<a class="headerlink" href="#transfering-directories" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.DirectoryUpload">
<em class="property">class </em><tt class="descclassname">buildbot.steps.transfer.</tt><tt class="descname">DirectoryUpload</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.DirectoryUpload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>To transfer complete directories from the buildslave to the master, there
is a <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> named <a class="reference internal" href="#step-DirectoryUpload" title="DirectoryUpload"><tt class="xref bb bb-step docutils literal"><span class="pre">DirectoryUpload</span></tt></a>. It works like <a class="reference internal" href="#step-FileUpload" title="FileUpload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileUpload</span></tt></a>,
just for directories. However it does not support the <tt class="docutils literal"><span class="pre">maxsize</span></tt>,
<tt class="docutils literal"><span class="pre">blocksize</span></tt> and <tt class="docutils literal"><span class="pre">mode</span></tt> arguments. As an example, let's assume an
generated project documentation, which consists of many files (like the output
of <strong class="command">doxygen</strong> or <strong class="command">epydoc</strong>). We want to move the entire documentation to the
buildmaster, into a <tt class="file docutils literal"><span class="pre">~/public_html/docs</span></tt> directory, and add a
link to the uploaded documentation on the HTML status page. On the slave-side
the directory can be found under <tt class="file docutils literal"><span class="pre">docs</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.shell</span> <span class="kn">import</span> <span class="n">ShellCommand</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.transfer</span> <span class="kn">import</span> <span class="n">DirectoryUpload</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;docs&quot;</span><span class="p">]))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">DirectoryUpload</span><span class="p">(</span><span class="n">slavesrc</span><span class="o">=</span><span class="s">&quot;docs&quot;</span><span class="p">,</span>
                          <span class="n">masterdest</span><span class="o">=</span><span class="s">&quot;~/public_html/docs&quot;</span><span class="p">,</span>
                          <span class="n">url</span><span class="o">=</span><span class="s">&quot;~buildbot/docs&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="#step-DirectoryUpload" title="DirectoryUpload"><tt class="xref bb bb-step docutils literal"><span class="pre">DirectoryUpload</span></tt></a> step will create all necessary directories and
transfers empty directories, too.</p>
<p>The <tt class="docutils literal"><span class="pre">maxsize</span></tt> and <tt class="docutils literal"><span class="pre">blocksize</span></tt> parameters are the same as for
<a class="reference internal" href="#step-FileUpload" title="FileUpload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileUpload</span></tt></a>, although note that the size of the transferred data is
implementation-dependent, and probably much larger than you expect due to the
encoding used (currently tar).</p>
<p>The optional <tt class="docutils literal"><span class="pre">compress</span></tt> argument can be given as <tt class="docutils literal"><span class="pre">'gz'</span></tt> or
<tt class="docutils literal"><span class="pre">'bz2'</span></tt> to compress the datastream.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The permissions on the copied files will be the same on the
master as originately on the slave, see <a class="reference internal" href="#cmdoption-buildslave-create-slave--umask"><em class="xref std std-option">buildslave
create-slave --umask</em></a> to change the default one.</p>
</div>
<span class="target" id="step-StringDownload"></span><span class="target" id="step-JSONStringDownload"></span></div>
</div>
<div class="section" id="transfering-strings">
<span id="step-JSONPropertiesDownload"></span><h5>Transfering Strings<a class="headerlink" href="#transfering-strings" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.StringDownload">
<em class="property">class </em><tt class="descclassname">buildbot.steps.transfer.</tt><tt class="descname">StringDownload</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.StringDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.JSONStringDownload">
<em class="property">class </em><tt class="descclassname">buildbot.steps.transfer.</tt><tt class="descname">JSONStringDownload</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.JSONStringDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.transfer.JSONPropertiesDownload">
<em class="property">class </em><tt class="descclassname">buildbot.steps.transfer.</tt><tt class="descname">JSONPropertiesDownload</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.transfer.JSONPropertiesDownload" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes it is useful to transfer a calculated value from the master to the
slave. Instead of having to create a temporary file and then use FileDownload,
you can use one of the string download steps.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.transfer</span> <span class="kn">import</span> <span class="n">StringDownload</span>
<span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StringDownload</span><span class="p">(</span><span class="n">Interpolate</span><span class="p">(</span><span class="s">&quot;%(src::branch)s-%(prop:got_revision)s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">),</span>
        <span class="n">slavedest</span><span class="o">=</span><span class="s">&quot;buildid.txt&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="#step-StringDownload" title="StringDownload"><tt class="xref bb bb-step docutils literal"><span class="pre">StringDownload</span></tt></a> works just like <a class="reference internal" href="#step-FileDownload" title="FileDownload"><tt class="xref bb bb-step docutils literal"><span class="pre">FileDownload</span></tt></a> except it takes a single argument,
<tt class="docutils literal"><span class="pre">s</span></tt>, representing the string to download instead of a <tt class="docutils literal"><span class="pre">mastersrc</span></tt> argument.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.transfer</span> <span class="kn">import</span> <span class="n">JSONStringDownload</span>
<span class="n">buildinfo</span> <span class="o">=</span> <span class="p">{</span> <span class="n">branch</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s">&#39;branch&#39;</span><span class="p">),</span> <span class="n">got_revision</span><span class="p">:</span> <span class="n">Property</span><span class="p">(</span><span class="s">&#39;got_revision&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">JSONStringDownload</span><span class="p">(</span><span class="n">buildinfo</span><span class="p">,</span> <span class="n">slavedest</span><span class="o">=</span><span class="s">&quot;buildinfo.json&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="#step-JSONStringDownload" title="JSONStringDownload"><tt class="xref bb bb-step docutils literal"><span class="pre">JSONStringDownload</span></tt></a> is similar, except it takes an <tt class="docutils literal"><span class="pre">o</span></tt> argument, which must be JSON
serializable, and transfers that as a JSON-encoded string to the slave.</p>
<div class="highlight-python" id="index-25"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.transfer</span> <span class="kn">import</span> <span class="n">JSONPropertiesDownload</span>
<span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">JSONPropertiesDownload</span><span class="p">(</span><span class="n">slavedest</span><span class="o">=</span><span class="s">&quot;build-properties.json&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p><a class="reference internal" href="#step-JSONPropertiesDownload" title="JSONPropertiesDownload"><tt class="xref bb bb-step docutils literal"><span class="pre">JSONPropertiesDownload</span></tt></a> transfers a json-encoded string that represents a
dictionary where properties maps to a dictionary of build property <tt class="docutils literal"><span class="pre">name</span></tt> to
property <tt class="docutils literal"><span class="pre">value</span></tt>; and <tt class="docutils literal"><span class="pre">sourcestamp</span></tt> represents the build's sourcestamp.</p>
</div>
<div class="section" id="running-commands-on-the-master">
<span id="step-MasterShellCommand"></span><h5>Running Commands on the Master<a class="headerlink" href="#running-commands-on-the-master" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.master.MasterShellCommand">
<em class="property">class </em><tt class="descclassname">buildbot.steps.master.</tt><tt class="descname">MasterShellCommand</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.master.MasterShellCommand" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Occasionally, it is useful to execute some task on the master, for example to
create a directory, deploy a build result, or trigger some other centralized
processing.  This is possible, in a limited fashion, with the
<a class="reference internal" href="#step-MasterShellCommand" title="MasterShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">MasterShellCommand</span></tt></a> step.</p>
<p>This step operates similarly to a regular <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>, but executes on
the master, instead of the slave.  To be clear, the enclosing <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>
object must still have a slave object, just as for any other step -- only, in
this step, the slave does not do anything.</p>
<p>In this example, the step renames a tarball based on the day of the week.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.transfer</span> <span class="kn">import</span> <span class="n">FileUpload</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.master</span> <span class="kn">import</span> <span class="n">MasterShellCommand</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">FileUpload</span><span class="p">(</span><span class="n">slavesrc</span><span class="o">=</span><span class="s">&quot;widgetsoft.tar.gz&quot;</span><span class="p">,</span>
                     <span class="n">masterdest</span><span class="o">=</span><span class="s">&quot;/var/buildoutputs/widgetsoft-new.tar.gz&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MasterShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    cd /var/buildoutputs;</span>
<span class="s">    mv widgetsoft-new.tar.gz widgetsoft-`date +%a`.tar.gz&quot;&quot;&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, this step passes a copy of the buildmaster's environment
variables to the subprocess.  To pass an explicit environment instead, add an
<tt class="docutils literal"><span class="pre">env={..}</span></tt> argument.</p>
</div>
<p>Environment variables constructed using the <tt class="docutils literal"><span class="pre">env</span></tt> argument support expansion
so that if you just want to prepend  <tt class="file docutils literal"><span class="pre">/home/buildbot/bin</span></tt> to the
<span class="target" id="index-26"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PATH</span></tt> environment variable, you can do it by putting the value
<tt class="docutils literal"><span class="pre">${PATH}</span></tt> at the end of the value like in the example below.
Variables that don't exist on the master will be replaced by <tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.master</span> <span class="kn">import</span> <span class="n">MasterShellCommand</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MasterShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;www&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;PATH&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;/home/buildbot/bin&quot;</span><span class="p">,</span>
                            <span class="s">&quot;${PATH}&quot;</span><span class="p">]}))</span>
</pre></div>
</div>
<p>Note that environment values must be strings (or lists that are turned into
strings).  In particular, numeric properties such as <tt class="docutils literal"><span class="pre">buildnumber</span></tt> must
be substituted using <a class="reference internal" href="#interpolate"><em>Interpolate</em></a>.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">interruptSignal</span></tt></dt>
<dd>(optional) Signal to use to end the process, if the step is interrupted.</dd>
</dl>
</div>
<div class="section" id="setting-properties">
<span id="index-27"></span><span id="id15"></span><h5>Setting Properties<a class="headerlink" href="#setting-properties" title="Permalink to this headline">¶</a></h5>
<p>These steps set properties on the master based on information from the slave.</p>
<div class="section" id="setproperty">
<span id="step-setproperty"></span><span id="step-SetProperty"></span><h6>SetProperty<a class="headerlink" href="#setproperty" title="Permalink to this headline">¶</a></h6>
<dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.shell.SetProperty">
<em class="property">class </em><tt class="descclassname">buildbot.steps.shell.</tt><tt class="descname">SetProperty</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.shell.SetProperty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This buildstep is similar to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>, except that it captures the
output of the command into a property.  It is usually used like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps</span> <span class="kn">import</span> <span class="n">shell</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s">&quot;uname -a&quot;</span><span class="p">,</span> <span class="nb">property</span><span class="o">=</span><span class="s">&quot;uname&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>This runs <tt class="docutils literal"><span class="pre">uname</span> <span class="pre">-a</span></tt> and captures its stdout, stripped of leading
and trailing whitespace, in the property <tt class="docutils literal"><span class="pre">uname</span></tt>.  To avoid stripping,
add <tt class="docutils literal"><span class="pre">strip=False</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">property</span></tt> argument can be specified as a  <a class="reference internal" href="#interpolate"><em>Interpolate</em></a>
object, allowing the property name to be built from other property values.</p>
<p>The more advanced usage allows you to specify a function to extract
properties from the command output.  Here you can use regular
expressions, string interpolation, or whatever you would like. In this
form, <tt class="xref py py-func docutils literal"><span class="pre">extract_fn</span></tt> should be passed, and not <tt class="xref py py-class docutils literal"><span class="pre">Property</span></tt>.
The <tt class="xref py py-func docutils literal"><span class="pre">extract_fn</span></tt> function is called with three arguments: the exit status of the
command, its standard output as a string, and its standard error as
a string.  It should return a dictionary containing all new properties.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">glob2list</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span><span class="p">):</span>
    <span class="n">jpgs</span> <span class="o">=</span> <span class="p">[</span> <span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span> <span class="s">&#39;jpgs&#39;</span> <span class="p">:</span> <span class="n">jpgs</span> <span class="p">}</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SetProperty</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s">&quot;ls -1 *.jpg&quot;</span><span class="p">,</span> <span class="n">extract_fn</span><span class="o">=</span><span class="n">glob2list</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that any ordering relationship of the contents of stdout and
stderr is lost.  For example, given</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SetProperty</span><span class="p">(</span>
    <span class="n">command</span><span class="o">=</span><span class="s">&quot;echo output1; echo error &gt;&amp;2; echo output2&quot;</span><span class="p">,</span>
    <span class="n">extract_fn</span><span class="o">=</span><span class="n">my_extract</span><span class="p">))</span>
</pre></div>
</div>
<p>Then <tt class="docutils literal"><span class="pre">my_extract</span></tt> will see <tt class="docutils literal"><span class="pre">stdout=&quot;output1\noutput2\n&quot;</span></tt>
and <tt class="docutils literal"><span class="pre">stderr=&quot;error\n&quot;</span></tt>.</p>
<span class="target" id="step-SetPropertiesFromEnv"></span><dl class="class">
<dt id="buildbot.steps.source.buildbot.steps.slave.SetPropertiesFromEnv">
<em class="property">class </em><tt class="descclassname">buildbot.steps.slave.</tt><tt class="descname">SetPropertiesFromEnv</tt><a class="headerlink" href="#buildbot.steps.source.buildbot.steps.slave.SetPropertiesFromEnv" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="setpropertiesfromenv">
<h6>SetPropertiesFromEnv<a class="headerlink" href="#setpropertiesfromenv" title="Permalink to this headline">¶</a></h6>
<p>Buildbot slaves (later than version 0.8.3) provide their environment variables
to the master on connect.  These can be copied into Buildbot properties with
the <a class="reference internal" href="#step-SetPropertiesFromEnv" title="SetPropertiesFromEnv"><tt class="xref bb bb-step docutils literal"><span class="pre">SetPropertiesFromEnv</span></tt></a> step.  Pass a variable or list of variables
in the <tt class="docutils literal"><span class="pre">variables</span></tt> parameter, then simply use the values as properties in a
later step.</p>
<p>Note that on Windows, environment variables are case-insensitive, but Buildbot
property names are case sensitive.  The property will have exactly the variable
name you specify, even if the underlying environment variable is capitalized
differently.  If, for example, you use <tt class="docutils literal"><span class="pre">variables=['Tmp']</span></tt>, the result
will be a property named <tt class="docutils literal"><span class="pre">Tmp</span></tt>, even though the environment variable is
displayed as <span class="target" id="index-28"></span><tt class="xref std std-envvar docutils literal"><span class="pre">TMP</span></tt> in the Windows GUI.</p>
<div class="highlight-python"><pre>from buildbot.steps.slave import SetPropertiesFromEnv
from buildbot.steps.shell import Compile

f.addStep(SetPropertiesFromEnv(variables=["SOME_JAVA_LIB_HOME", "JAVAC"]))
f.addStep(Compile(commands=[Interpolate("%(prop:JAVAC)s"), "-cp", Interpolate("%(prop:SOME_JAVA_LIB_HOME)s")))</pre>
</div>
<p>Note that this step requires that the Buildslave be at least version 0.8.3.
For previous versions, no environment variables are available (the slave
environment will appear to be empty).</p>
<span class="target" id="index-29"></span></div>
</div>
<div class="section" id="triggering-schedulers">
<span id="step-Trigger"></span><span id="id16"></span><h5>Triggering Schedulers<a class="headerlink" href="#triggering-schedulers" title="Permalink to this headline">¶</a></h5>
<p>The counterpart to the Triggerable described in section
<a class="reference internal" href="#sched-Triggerable" title="Triggerable"><tt class="xref bb bb-sched docutils literal"><span class="pre">Triggerable</span></tt></a> is the <a class="reference internal" href="#step-Trigger" title="Trigger"><tt class="xref bb bb-step docutils literal"><span class="pre">Trigger</span></tt></a> build step:</p>
<div class="highlight-python"><pre>from buildbot.steps.trigger import Trigger
f.addStep(Trigger(schedulerNames=['build-prep'],
                  waitForFinish=True,
                  updateSourceStamp=True,
                  set_properties={ 'quick' : False })</pre>
</div>
<p>The <tt class="docutils literal"><span class="pre">schedulerNames=</span></tt> argument lists the <a class="reference internal" href="#sched-Triggerable" title="Triggerable"><tt class="xref bb bb-sched docutils literal"><span class="pre">Triggerable</span></tt></a> schedulers
that should be triggered when this step is executed.  Note that
it is possible, but not advisable, to create a cycle where a build
continually triggers itself, because the schedulers are specified
by name.</p>
<p>If <tt class="docutils literal"><span class="pre">waitForFinish</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>, then the step will not finish until
all of the builds from the triggered schedulers have finished. Hyperlinks
are added to the waterfall and the build detail web pages for each
triggered build. If this argument is <tt class="docutils literal"><span class="pre">False</span></tt> (the default) or not given,
then the buildstep succeeds immediately after triggering the schedulers.</p>
<p>The SourceStamps to use for the triggered build are controlled by the arguments
<tt class="docutils literal"><span class="pre">updateSourceStamp</span></tt>, <tt class="docutils literal"><span class="pre">alwaysUseLatest</span></tt>, and <tt class="docutils literal"><span class="pre">sourceStamps</span></tt>.  If
<tt class="docutils literal"><span class="pre">updateSourceStamp</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt> (the default), then step updates the
<tt class="xref py py-class docutils literal"><span class="pre">SourceStamp`s</span> <span class="pre">given</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">:bb:sched:`Triggerable</span></tt> schedulers to include
<tt class="docutils literal"><span class="pre">got_revision</span></tt> (the revision actually used in this build) as <tt class="docutils literal"><span class="pre">revision</span></tt>
(the revision to use in the triggered builds). This is useful to ensure that
all of the builds use exactly the same <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp`s,</span> <span class="pre">even</span> <span class="pre">if</span> <span class="pre">other</span>
<span class="pre">:class:`Change</span></tt>s have occurred while the build was running. If
<tt class="docutils literal"><span class="pre">updateSourceStamp</span></tt> is False (and neither of the other arguments are
specified), then the exact same SourceStamps are used. If <tt class="docutils literal"><span class="pre">alwaysUseLatest</span></tt> is
True, then no SourceStamps are given, corresponding to using the latest revisions
of the repositories specified in the Source steps. This is useful if the triggered
builds use to a different source repository.  The argument <tt class="docutils literal"><span class="pre">sourceStamps</span></tt>
accepts a list of dictionaries containing the keys <tt class="docutils literal"><span class="pre">branch</span></tt>, <tt class="docutils literal"><span class="pre">revision</span></tt>,
<tt class="docutils literal"><span class="pre">repository</span></tt>, <tt class="docutils literal"><span class="pre">project</span></tt>, and optionally <tt class="docutils literal"><span class="pre">patch_level</span></tt>,
<tt class="docutils literal"><span class="pre">patch_body</span></tt>, <tt class="docutils literal"><span class="pre">patch_subdir</span></tt>, <tt class="docutils literal"><span class="pre">patch_author</span></tt> and <tt class="docutils literal"><span class="pre">patch_comment</span></tt>
and creates the corresponding SourceStamps.
If only one sourceStamp has to be specified then the argument <tt class="docutils literal"><span class="pre">sourceStamp</span></tt>
can be used for a dictionary containing the keys mentioned above. The arguments
<tt class="docutils literal"><span class="pre">updateSourceStamp</span></tt>, <tt class="docutils literal"><span class="pre">alwaysUseLatest</span></tt>, and <tt class="docutils literal"><span class="pre">sourceStamp</span></tt> can be specified
using properties.</p>
<p>The <tt class="docutils literal"><span class="pre">set_properties</span></tt> parameter allows control of the properties that are passed to the triggered scheduler.
The parameter takes a dictionary mapping property names to values.
You may use <a class="reference internal" href="#interpolate"><em>Interpolate</em></a> here to dynamically construct new property values.
For the simple case of copying a property, this might look like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">set_properties</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;my_prop1&quot;</span><span class="p">,</span> <span class="n">Property</span><span class="p">(</span><span class="s">&quot;my_prop1&quot;</span><span class="p">)}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">copy_properties</span></tt> parameter, given a list of properties to copy into the new build request, has been deprecated in favor of explicit use of <tt class="docutils literal"><span class="pre">set_properties</span></tt>.</p>
</div>
<div class="section" id="rpm-related-steps">
<h5>RPM-Related Steps<a class="headerlink" href="#rpm-related-steps" title="Permalink to this headline">¶</a></h5>
<p>These steps work with RPMs and spec files.</p>
<div class="section" id="rpmbuild">
<span id="step-RpmBuild"></span><h6>RpmBuild<a class="headerlink" href="#rpmbuild" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-RpmBuild" title="RpmBuild"><tt class="xref bb bb-step docutils literal"><span class="pre">RpmBuild</span></tt></a> step builds RPMs based on a spec file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.package.rpm</span> <span class="kn">import</span> <span class="n">RpmBuild</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">RpmBuild</span><span class="p">(</span><span class="n">specfile</span><span class="o">=</span><span class="s">&quot;proj.spec&quot;</span><span class="p">,</span>
        <span class="n">dist</span><span class="o">=</span><span class="s">&#39;.el5&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">specfile</span></tt></dt>
<dd>The <tt class="docutils literal"><span class="pre">.spec</span></tt> file to build from</dd>
<dt><tt class="docutils literal"><span class="pre">topdir</span></tt></dt>
<dd>Definition for <tt class="docutils literal"><span class="pre">_topdir</span></tt>, defaulting to the workdir.</dd>
<dt><tt class="docutils literal"><span class="pre">builddir</span></tt></dt>
<dd>Definition for <tt class="docutils literal"><span class="pre">_builddir</span></tt>, defaulting to the workdir.</dd>
<dt><tt class="docutils literal"><span class="pre">rpmdir</span></tt></dt>
<dd>Definition for <tt class="docutils literal"><span class="pre">_rpmdir</span></tt>, defaulting to the workdir.</dd>
<dt><tt class="docutils literal"><span class="pre">sourcedir</span></tt></dt>
<dd>Definition for <tt class="docutils literal"><span class="pre">_sourcedir</span></tt>, defaulting to the workdir.</dd>
<dt><tt class="docutils literal"><span class="pre">srcrpmdir</span></tt></dt>
<dd>Definition for <tt class="docutils literal"><span class="pre">_srcrpmdir</span></tt>, defaulting to the workdir.</dd>
<dt><tt class="docutils literal"><span class="pre">dist</span></tt></dt>
<dd>Distribution to build, used as the definition for <tt class="docutils literal"><span class="pre">_dist</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">autoRelease</span></tt></dt>
<dd>If true, use the auto-release mechanics.</dd>
<dt><tt class="docutils literal"><span class="pre">vcsRevision</span></tt></dt>
<dd>If true, use the version-control revision mechanics.  This uses the
<tt class="docutils literal"><span class="pre">got_revision</span></tt> property to determine the revision and define
<tt class="docutils literal"><span class="pre">_revision</span></tt>.  Note that this will not work with multi-codebase builds.</dd>
</dl>
</div>
<div class="section" id="rpmlint">
<span id="step-RpmLint"></span><h6>RpmLint<a class="headerlink" href="#rpmlint" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-RpmLint" title="RpmLint"><tt class="xref bb bb-step docutils literal"><span class="pre">RpmLint</span></tt></a> step checks for common problems in RPM packages or
spec files:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.package.rpm</span> <span class="kn">import</span> <span class="n">RpmLint</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">RpmLint</span><span class="p">())</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">fileloc</span></tt></dt>
<dd>The file or directory to check. In case of a directory, it is recursively
searched for RPMs and spec files to check.</dd>
<dt><tt class="docutils literal"><span class="pre">config</span></tt></dt>
<dd>Path to a rpmlint config file. This is passed as the user configuration
file if present.</dd>
</dl>
</div>
<div class="section" id="mock-steps">
<h6>Mock Steps<a class="headerlink" href="#mock-steps" title="Permalink to this headline">¶</a></h6>
<p>Mock (<a class="reference external" href="http://fedoraproject.org/wiki/Projects/Mock">http://fedoraproject.org/wiki/Projects/Mock</a>) creates chroots and builds
packages in them. It populates the changeroot with a basic system
and the packages listed as build requirement. The type of chroot to build
is specified with the <tt class="docutils literal"><span class="pre">root</span></tt> parameter. To use mock your buildbot user must
be added to the <tt class="docutils literal"><span class="pre">mock</span></tt> group.</p>
</div>
<div class="section" id="mockbuildsrpm-step">
<span id="step-MockBuildSRPM"></span><h6>MockBuildSRPM Step<a class="headerlink" href="#mockbuildsrpm-step" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-MockBuildSRPM" title="MockBuildSRPM"><tt class="xref bb bb-step docutils literal"><span class="pre">MockBuildSRPM</span></tt></a> step builds a SourceRPM based on a spec file and
optionaly a source directory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.package.rpm</span> <span class="kn">import</span> <span class="n">MockBuildSRPM</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MockBuildSRPM</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="s">&#39;mypkg.spec&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">root</span></tt></dt>
<dd>Use chroot configuration defined in <tt class="docutils literal"><span class="pre">/etc/mock/&lt;root&gt;.cfg</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">resultdir</span></tt></dt>
<dd>The directory where the logfiles and the SourceRPM are written to.</dd>
<dt><tt class="docutils literal"><span class="pre">spec</span></tt></dt>
<dd>Build the SourceRPM from this spec file.</dd>
<dt><tt class="docutils literal"><span class="pre">sources</span></tt></dt>
<dd>Path to the directory containing the sources, defaulting to <tt class="docutils literal"><span class="pre">.</span></tt>.</dd>
</dl>
</div>
<div class="section" id="mockrebuild-step">
<span id="step-MockRebuild"></span><h6>MockRebuild Step<a class="headerlink" href="#mockrebuild-step" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-MockRebuild" title="MockRebuild"><tt class="xref bb bb-step docutils literal"><span class="pre">MockRebuild</span></tt></a> step rebuilds a SourceRPM package:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.package.rpm</span> <span class="kn">import</span> <span class="n">MockRebuild</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MockRebuild</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">,</span> <span class="n">spec</span><span class="o">=</span><span class="s">&#39;mypkg-1.0-1.src.rpm&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">root</span></tt></dt>
<dd>Uses chroot configuration defined in <tt class="docutils literal"><span class="pre">/etc/mock/&lt;root&gt;.cfg</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">resultdir</span></tt></dt>
<dd>The directory where the logfiles and the SourceRPM are written to.</dd>
<dt><tt class="docutils literal"><span class="pre">srpm</span></tt></dt>
<dd>The path to the SourceRPM to rebuild.</dd>
</dl>
</div>
</div>
<div class="section" id="debian-build-steps">
<h5>Debian Build Steps<a class="headerlink" href="#debian-build-steps" title="Permalink to this headline">¶</a></h5>
<div class="section" id="debpbuilder">
<span id="step-DebPbuilder"></span><h6>DebPbuilder<a class="headerlink" href="#debpbuilder" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-DebPbuilder" title="DebPbuilder"><tt class="xref bb bb-step docutils literal"><span class="pre">DebPbuilder</span></tt></a> step builds Debian packages within a chroot built
by pbuilder. It populates the changeroot with a basic system and the packages
listed as build requirement. The type of chroot to build is specified with the
<tt class="docutils literal"><span class="pre">distribution</span></tt>, <tt class="docutils literal"><span class="pre">distribution</span></tt> and <tt class="docutils literal"><span class="pre">mirror</span></tt> parameter. To use pbuilder
your buildbot must have the right to run pbuilder as root throug sudo.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.package.deb.pbuilder</span> <span class="kn">import</span> <span class="n">DepPbuilder</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">DepPbuilder</span><span class="p">())</span>
</pre></div>
</div>
<p>The step takes the following parameters</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">architecture</span></tt></dt>
<dd>Architecture to build chroot for.</dd>
<dt><tt class="docutils literal"><span class="pre">distribution</span></tt></dt>
<dd>Name, or nickname, of the dirstribution. Defaults to 'stable'.</dd>
<dt><tt class="docutils literal"><span class="pre">basetgz</span></tt></dt>
<dd>Path of the basetgz to use for building.</dd>
<dt><tt class="docutils literal"><span class="pre">mirror</span></tt></dt>
<dd>URL of the mirror used to download the packages from.</dd>
<dt><tt class="docutils literal"><span class="pre">extrapackages</span></tt></dt>
<dd>List if packages to install in addition to the base system.</dd>
<dt><tt class="docutils literal"><span class="pre">keyring</span></tt></dt>
<dd>Path to a gpg keyring to verify the downloaded packages. This is necessary
if you build for a forain distribution.</dd>
<dt><tt class="docutils literal"><span class="pre">components</span></tt></dt>
<dd>Repos to activate for chroot building.</dd>
</dl>
</div>
<div class="section" id="debcowbuilder">
<span id="step-DebCowbuilder"></span><h6>DebCowbuilder<a class="headerlink" href="#debcowbuilder" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-DebCowbuilder" title="DebCowbuilder"><tt class="xref bb bb-step docutils literal"><span class="pre">DebCowbuilder</span></tt></a> step is a subclass of <a class="reference internal" href="#step-DebPbuilder" title="DebPbuilder"><tt class="xref bb bb-step docutils literal"><span class="pre">DebPbuilder</span></tt></a>,
which use cowbuilder instead of pbuilder.</p>
</div>
<div class="section" id="deblintian">
<span id="step-DebLintian"></span><h6>DebLintian<a class="headerlink" href="#deblintian" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-DebLintian" title="DebLintian"><tt class="xref bb bb-step docutils literal"><span class="pre">DebLintian</span></tt></a> step checks a build .deb for bugs and policy
violations. The packages or changes file to test is specified in <tt class="docutils literal"><span class="pre">fileloc</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.package.deb.lintian</span> <span class="kn">import</span> <span class="n">DebLintian</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">DebLintian</span><span class="p">(</span><span class="n">fileloc</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s">&quot;%(prop:deb-changes)s&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="miscellaneous-buildsteps">
<h5>Miscellaneous BuildSteps<a class="headerlink" href="#miscellaneous-buildsteps" title="Permalink to this headline">¶</a></h5>
<p>A number of steps do not fall into any particular category.</p>
<div class="section" id="hlint">
<span id="step-HLint"></span><h6>HLint<a class="headerlink" href="#hlint" title="Permalink to this headline">¶</a></h6>
<p>The <a class="reference internal" href="#step-HLint" title="HLint"><tt class="xref bb bb-step docutils literal"><span class="pre">HLint</span></tt></a> step runs Twisted Lore, a lint-like checker over a set of
<tt class="docutils literal"><span class="pre">.xhtml</span></tt> files.  Any deviations from recommended style is flagged and put
in the output log.</p>
<p>The step looks at the list of changes in the build to determine which files to
check - it does not check all files.  It specifically excludes any <tt class="docutils literal"><span class="pre">.xhtml</span></tt>
files in the top-level <tt class="docutils literal"><span class="pre">sandbox/</span></tt> directory.</p>
<p>The step takes a single, optional, parameter: <tt class="docutils literal"><span class="pre">python</span></tt>.  This specifies the
Python executable to use to run Lore.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.python_twisted</span> <span class="kn">import</span> <span class="n">HLint</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">HLint</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="maxq">
<h6>MaxQ<a class="headerlink" href="#maxq" title="Permalink to this headline">¶</a></h6>
<p id="step-MaxQ">MaxQ (<a class="reference external" href="http://maxq.tigris.org/">http://maxq.tigris.org/</a>) is a web testing tool that allows you to record
HTTP sessions and play them back.  The <a class="reference internal" href="#step-MaxQ" title="MaxQ"><tt class="xref bb bb-step docutils literal"><span class="pre">MaxQ</span></tt></a> step runs this
framework.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.maxq</span> <span class="kn">import</span> <span class="n">MaxQ</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MaxQ</span><span class="p">(</span><span class="n">testdir</span><span class="o">=</span><span class="s">&#39;tests/&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The single argument, <tt class="docutils literal"><span class="pre">testdir</span></tt>, specifies where the tests should be run.
This directory will be passed to the <tt class="docutils literal"><span class="pre">run_maxq.py</span></tt> command, and the results
analyzed.</p>
</div>
</div>
</div>
<span id="document-manual/cfg-interlocks"></span><div class="section" id="interlocks">
<span id="id1"></span><h4>Interlocks<a class="headerlink" href="#interlocks" title="Permalink to this headline">¶</a></h4>
<p>Until now, we assumed that a master can run builds at any slave whenever
needed or desired.  Some times, you want to enforce additional constraints on
builds. For reasons like limited network bandwidth, old slave machines, or a
self-willed data base server, you may want to limit the number of builds (or
build steps) that can access a resource.</p>
<div class="section" id="access-modes">
<span id="id2"></span><h5>Access Modes<a class="headerlink" href="#access-modes" title="Permalink to this headline">¶</a></h5>
<p>The mechanism used by Buildbot is known as the read/write lock <a class="footnote-reference" href="#id6" id="id3">[1]</a>. It
allows either many readers or a single writer but not a combination of readers
and writers. The general lock has been modified and extended for use in
Buildbot. Firstly, the general lock allows an infinite number of readers. In
Buildbot, we often want to put an upper limit on the number of readers, for
example allowing two out of five possible builds at the same time. To do this,
the lock counts the number of active readers. Secondly, the terms <em>read
mode</em> and <em>write mode</em> are confusing in Buildbot context. They have been
replaced by <em>counting mode</em> (since the lock counts them) and <em>exclusive
mode</em>.  As a result of these changes, locks in Buildbot allow a number of
builds (up to some fixed number) in counting mode, or they allow one build in
exclusive mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Access modes are specified when a lock is used.  That is, it is
possible to have a single lock that is used by several slaves in counting mode,
and several slaves in exclusive mode.  In fact, this is the strength of the
modes: accessing a lock in exclusive mode will prevent all counting-mode
accesses.</p>
</div>
</div>
<div class="section" id="count">
<h5>Count<a class="headerlink" href="#count" title="Permalink to this headline">¶</a></h5>
<p>Often, not all slaves are equal. To allow for this situation, Buildbot allows
to have a separate upper limit on the count for each slave. In this way, you
can have at most 3 concurrent builds at a fast slave, 2 at a slightly older
slave, and 1 at all other slaves.</p>
</div>
<div class="section" id="scope">
<h5>Scope<a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h5>
<p>The final thing you can specify when you introduce a new lock is its scope.
Some constraints are global -- they must be enforced over all slaves. Other
constraints are local to each slave.  A <em>master lock</em> is used for the
global constraints. You can ensure for example that at most one build (of all
builds running at all slaves) accesses the data base server. With a
<em>slave lock</em> you can add a limit local to each slave. With such a lock,
you can for example enforce an upper limit to the number of active builds at a
slave, like above.</p>
</div>
<div class="section" id="examples">
<h5>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h5>
<p>Time for a few examples. Below a master lock is defined to protect a data base,
and a slave lock is created to limit the number of builds at each slave.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot</span> <span class="kn">import</span> <span class="n">locks</span>

<span class="n">db_lock</span> <span class="o">=</span> <span class="n">locks</span><span class="o">.</span><span class="n">MasterLock</span><span class="p">(</span><span class="s">&quot;database&quot;</span><span class="p">)</span>
<span class="n">build_lock</span> <span class="o">=</span> <span class="n">locks</span><span class="o">.</span><span class="n">SlaveLock</span><span class="p">(</span><span class="s">&quot;slave_builds&quot;</span><span class="p">,</span>
                             <span class="n">maxCount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">maxCountForSlave</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;fast&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;new&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">})</span>
</pre></div>
</div>
<p>After importing locks from buildbot, <tt class="xref py py-data docutils literal"><span class="pre">db_lock</span></tt> is defined to be a master
lock. The <tt class="docutils literal"><span class="pre">database</span></tt> string is used for uniquely identifying the lock.
At the next line, a slave lock called <tt class="xref py py-data docutils literal"><span class="pre">build_lock</span></tt> is created. It is
identified by the <tt class="docutils literal"><span class="pre">slave_builds</span></tt> string. Since the requirements of the
lock are a bit more complicated, two optional arguments are also specified. The
<tt class="docutils literal"><span class="pre">maxCount</span></tt> parameter sets the default limit for builds in counting mode to
<tt class="docutils literal"><span class="pre">1</span></tt>. For the slave called <tt class="docutils literal"><span class="pre">'fast'</span></tt> however, we want to have at most
three builds, and for the slave called <tt class="docutils literal"><span class="pre">'new'</span></tt> the upper limit is two
builds running at the same time.</p>
<p>The next step is accessing the locks in builds.  Buildbot allows a lock to be used
during an entire build (from beginning to end), or only during a single build
step. In the latter case, the lock is claimed for use just before the step
starts, and released again when the step ends. To prevent
deadlocks, <a class="footnote-reference" href="#id7" id="id4">[2]</a> it is not possible to claim or release
locks at other times.</p>
<p>To use locks, you add them with a <tt class="docutils literal"><span class="pre">locks</span></tt> argument to a build or a step.
Each use of a lock is either in counting mode (that is, possibly shared with
other builds) or in exclusive mode, and this is indicated with the syntax
<tt class="docutils literal"><span class="pre">lock.access(mode)</span></tt>, where <tt class="xref py py-data docutils literal"><span class="pre">mode</span></tt> is one of <tt class="docutils literal"><span class="pre">&quot;counting&quot;</span></tt> or <tt class="docutils literal"><span class="pre">&quot;exclusive&quot;</span></tt>.</p>
<p>A build or build step proceeds only when it has acquired all locks. If a build
or step needs a lot of locks, it may be starved <a class="footnote-reference" href="#id8" id="id5">[3]</a> by other builds that need
fewer locks.</p>
<p>To illustrate use of locks, a few examples.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot</span> <span class="kn">import</span> <span class="n">locks</span>
<span class="kn">from</span> <span class="nn">buildbot.steps</span> <span class="kn">import</span> <span class="n">source</span><span class="p">,</span> <span class="n">shell</span>
<span class="kn">from</span> <span class="nn">buildbot.process</span> <span class="kn">import</span> <span class="n">factory</span>

<span class="n">db_lock</span> <span class="o">=</span> <span class="n">locks</span><span class="o">.</span><span class="n">MasterLock</span><span class="p">(</span><span class="s">&quot;database&quot;</span><span class="p">)</span>
<span class="n">build_lock</span> <span class="o">=</span> <span class="n">locks</span><span class="o">.</span><span class="n">SlaveLock</span><span class="p">(</span><span class="s">&quot;slave_builds&quot;</span><span class="p">,</span>
                             <span class="n">maxCount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                             <span class="n">maxCountForSlave</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;fast&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&#39;new&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="p">})</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">source</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;http://example.org/svn/Trunk&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s">&quot;make all&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">shell</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s">&quot;make test&quot;</span><span class="p">,</span>
                             <span class="n">locks</span><span class="o">=</span><span class="p">[</span><span class="n">db_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&#39;exclusive&#39;</span><span class="p">)]))</span>

<span class="n">b1</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;full1&#39;</span><span class="p">,</span> <span class="s">&#39;slavename&#39;</span><span class="p">:</span> <span class="s">&#39;fast&#39;</span><span class="p">,</span>  <span class="s">&#39;builddir&#39;</span><span class="p">:</span> <span class="s">&#39;f1&#39;</span><span class="p">,</span> <span class="s">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b2</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;full2&#39;</span><span class="p">,</span> <span class="s">&#39;slavename&#39;</span><span class="p">:</span> <span class="s">&#39;new&#39;</span><span class="p">,</span>   <span class="s">&#39;builddir&#39;</span><span class="p">:</span> <span class="s">&#39;f2&#39;</span><span class="p">,</span> <span class="s">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b3</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;full3&#39;</span><span class="p">,</span> <span class="s">&#39;slavename&#39;</span><span class="p">:</span> <span class="s">&#39;old&#39;</span><span class="p">,</span>   <span class="s">&#39;builddir&#39;</span><span class="p">:</span> <span class="s">&#39;f3&#39;</span><span class="p">,</span> <span class="s">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b4</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;full4&#39;</span><span class="p">,</span> <span class="s">&#39;slavename&#39;</span><span class="p">:</span> <span class="s">&#39;other&#39;</span><span class="p">,</span> <span class="s">&#39;builddir&#39;</span><span class="p">:</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">c</span><span class="p">[</span><span class="s">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">]</span>
</pre></div>
</div>
<p>Here we have four slaves <tt class="xref py py-data docutils literal"><span class="pre">b1</span></tt>, <tt class="xref py py-data docutils literal"><span class="pre">b2</span></tt>, <tt class="xref py py-data docutils literal"><span class="pre">b3</span></tt>, and <tt class="xref py py-data docutils literal"><span class="pre">b4</span></tt>. Each
slave performs the same checkout, make, and test build step sequence.
We want to enforce that at most one test step is executed between all slaves due
to restrictions with the data base server. This is done by adding the
<tt class="docutils literal"><span class="pre">locks=</span></tt> parameter with the third step. It takes a list of locks with their
access mode. In this case only the <tt class="xref py py-data docutils literal"><span class="pre">db_lock</span></tt> is needed. The exclusive
access mode is used to ensure there is at most one slave that executes the test
step.</p>
<p>In addition to exclusive accessing the data base, we also want slaves to stay
responsive even under the load of a large number of builds being triggered.
For this purpose, the slave lock called <tt class="xref py py-data docutils literal"><span class="pre">build_lock</span></tt> is defined. Since
the restraint holds for entire builds, the lock is specified in the builder
with <tt class="docutils literal"><span class="pre">'locks':</span> <span class="pre">[build_lock.access('counting')]</span></tt>.</p>
<p>Note that you will occasionally see <tt class="docutils literal"><span class="pre">lock.access(mode)</span></tt> written as
<tt class="docutils literal"><span class="pre">LockAccess(lock,</span> <span class="pre">mode)</span></tt>.  The two are equivalent, but the former is
preferred.</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[1]</a></td><td>See <a class="reference external" href="http://en.wikipedia.org/wiki/Read/write_lock_pattern">http://en.wikipedia.org/wiki/Read/write_lock_pattern</a> for more information.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>Deadlock is the situation where two or more slaves each
hold a lock in exclusive mode, and in addition want to claim the lock held by
the other slave exclusively as well. Since locks allow at most one exclusive
user, both slaves will wait forever.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td>Starving is the
situation that only a few locks are available, and they are immediately grabbed
by another build. As a result, it may take a long time before all locks needed
by the starved build are free at the same time.</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-manual/cfg-statustargets"></span><div class="section" id="status-targets">
<span id="cfg-status"></span><span id="id1"></span><h4>Status Targets<a class="headerlink" href="#status-targets" title="Permalink to this headline">¶</a></h4>
<p>The Buildmaster has a variety of ways to present build status to
various users. Each such delivery method is a <cite>Status Target</cite> object
in the configuration's <a class="reference internal" href="#cfg-status" title="status"><tt class="xref bb bb-cfg docutils literal"><span class="pre">status</span></tt></a> list. To add status targets, you
just append more objects to this list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="kn">from</span> <span class="nn">buildbot.status</span> <span class="kn">import</span> <span class="n">html</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">Waterfall</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8010</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">buildbot.status</span> <span class="kn">import</span> <span class="n">mail</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">mail</span><span class="o">.</span><span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s">&quot;buildbot@localhost&quot;</span><span class="p">,</span>
                      <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;builds@lists.example.com&quot;</span><span class="p">],</span>
                      <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">buildbot.status</span> <span class="kn">import</span> <span class="n">words</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">words</span><span class="o">.</span><span class="n">IRC</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">&quot;irc.example.com&quot;</span><span class="p">,</span> <span class="n">nick</span><span class="o">=</span><span class="s">&quot;bb&quot;</span><span class="p">,</span>
                             <span class="n">channels</span><span class="o">=</span><span class="p">[{</span><span class="s">&quot;channel&quot;</span><span class="p">:</span> <span class="s">&quot;#example1&quot;</span><span class="p">},</span>
                                       <span class="p">{</span><span class="s">&quot;channel&quot;</span><span class="p">:</span> <span class="s">&quot;#example2&quot;</span><span class="p">,</span>
                                        <span class="s">&quot;password&quot;</span><span class="p">:</span> <span class="s">&quot;somesecretpassword&quot;</span><span class="p">}]))</span>
</pre></div>
</div>
<p>Most status delivery objects take a <tt class="docutils literal"><span class="pre">categories=</span></tt> argument, which
can contain a list of <cite>category</cite> names: in this case, it will only
show status for Builders that are in one of the named categories.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Implementation Note</p>
<p class="last">Each of these objects should be a <tt class="xref py py-class docutils literal"><span class="pre">service.MultiService</span></tt> which will be attached
to the BuildMaster object when the configuration is processed. They should use
<tt class="docutils literal"><span class="pre">self.parent.getStatus()</span></tt> to get access to the top-level <tt class="xref py py-class docutils literal"><span class="pre">IStatus</span></tt> object,
either inside <tt class="xref py py-meth docutils literal"><span class="pre">startService</span></tt> or later. They may call
<tt class="xref py py-meth docutils literal"><span class="pre">status.subscribe</span></tt> in <tt class="xref py py-meth docutils literal"><span class="pre">startService</span></tt> to receive notifications of
builder events, in which case they must define <tt class="xref py py-meth docutils literal"><span class="pre">builderAdded</span></tt> and related
methods. See the docstrings in <tt class="file docutils literal"><span class="pre">buildbot/interfaces.py</span></tt> for full details.</p>
</div>
<p>The remainder of this section describes each built-in status target.  A full
list of status targets is available in the <a class="reference internal" href="bb-status.html" title="Status Target Index"><em>Status Target Index</em></a>.</p>
<div class="section" id="webstatus">
<span id="status-WebStatus"></span><h5>WebStatus<a class="headerlink" href="#webstatus" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.status.web.baseweb.WebStatus">
<em class="property">class </em><tt class="descclassname">buildbot.status.web.baseweb.</tt><tt class="descname">WebStatus</tt><a class="headerlink" href="#buildbot.status.web.baseweb.WebStatus" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <tt class="xref py py-class docutils literal"><span class="pre">buildbot.status.html.WebStatus</span></tt> status target runs a small
web server inside the buildmaster. You can point a browser at this web
server and retrieve information about every build the buildbot knows
about, as well as find out what the buildbot is currently working on.</p>
<p>The first page you will see is the <em>Welcome Page</em>, which contains
links to all the other useful pages. By default, this page is served from the
<tt class="file docutils literal"><span class="pre">status/web/templates/root.html</span></tt> file in buildbot's library area.</p>
<p>One of the most complex resource provided by <tt class="xref py py-class docutils literal"><span class="pre">WebStatus</span></tt> is the
<em>Waterfall Display</em>, which shows a time-based chart of events. This
somewhat-busy display provides detailed information about all steps of all
recent builds, and provides hyperlinks to look at individual build logs and
source changes. By simply reloading this page on a regular basis, you will see
a complete description of everything the buildbot is currently working on.</p>
<p>A similar, but more developer-oriented display is the <cite>Grid</cite> display.  This
arranges builds by <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt> (horizontal axis) and builder (vertical axis),
and can provide quick information as to which revisions are passing or failing
on which builders.</p>
<p>There are also pages with more specialized information. For example,
there is a page which shows the last 20 builds performed by the
buildbot, one line each. Each line is a link to detailed information
about that build. By adding query arguments to the URL used to reach
this page, you can narrow the display to builds that involved certain
branches, or which ran on certain <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s. These pages are described
in great detail below.</p>
<div class="section" id="configuration">
<h6>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h6>
<p>The simplest possible configuration for WebStatus is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.html</span> <span class="kn">import</span> <span class="n">WebStatus</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WebStatus</span><span class="p">(</span><span class="mi">8080</span><span class="p">))</span>
</pre></div>
</div>
<p>Buildbot uses a templating system for the web interface. The source
of these templates can be found in the <tt class="file docutils literal"><span class="pre">status/web/templates/</span></tt> directory
in buildbot's library area. You can override these templates by creating
alternate versions in a <tt class="file docutils literal"><span class="pre">templates/</span></tt> directory within the buildmaster's
base directory.</p>
<p>If that isn't enough you can also provide additional Jinja2 template loaders:</p>
<div class="highlight-python"><pre>import jinja2
myloaders = [
    jinja2.FileSystemLoader("/tmp/mypath"),
    ]

c['status'].append(html.WebStatus(
    …,
    jinja_loaders = myloaders,
))</pre>
</div>
<p>The first time a buildmaster is created, the <tt class="file docutils literal"><span class="pre">public_html/</span></tt>
directory is populated with some sample files, which you will probably
want to customize for your own project. These files are all static:
the buildbot does not modify them in any way as it serves them to HTTP
clients.</p>
<p>Templates in <tt class="file docutils literal"><span class="pre">templates/</span></tt> take precedence over static files in
<tt class="file docutils literal"><span class="pre">public_html/</span></tt>.</p>
<p>The initial <tt class="file docutils literal"><span class="pre">robots.txt</span></tt> file has Disallow lines for all of
the dynamically-generated buildbot pages, to discourage web spiders
and search engines from consuming a lot of CPU time as they crawl
through the entire history of your buildbot. If you are running the
buildbot behind a reverse proxy, you'll probably need to put the
<tt class="file docutils literal"><span class="pre">robots.txt</span></tt> file somewhere else (at the top level of the parent web
server), and replace the URL prefixes in it with more suitable values.</p>
<p>If you would like to use an alternative root directory, add the
<tt class="docutils literal"><span class="pre">public_html=</span></tt> option to the <tt class="xref py py-class docutils literal"><span class="pre">WebStatus</span></tt> creation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WebStatus</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="n">public_html</span><span class="o">=</span><span class="s">&quot;/var/www/buildbot&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>In addition, if you are familiar with twisted.web <em>Resource
Trees</em>, you can write code to add additional pages at places inside
this web space. Just use <tt class="xref py py-meth docutils literal"><span class="pre">webstatus.putChild</span></tt> to place these
resources.</p>
<p>The following section describes the special URLs and the status views
they provide.</p>
</div>
<div class="section" id="buildbot-web-resources">
<h6>Buildbot Web Resources<a class="headerlink" href="#buildbot-web-resources" title="Permalink to this headline">¶</a></h6>
<p>Certain URLs are <cite>magic</cite>, and the pages they serve are created by
code in various classes in the <tt class="file docutils literal"><span class="pre">buildbot.status.web</span></tt> package
instead of being read from disk. The most common way to access these
pages is for the buildmaster admin to write or modify the
<tt class="file docutils literal"><span class="pre">index.html</span></tt> page to contain links to them. Of course other
project web pages can contain links to these buildbot pages as well.</p>
<p>Many pages can be modified by adding query arguments to the URL. For
example, a page which shows the results of the most recent build
normally does this for all builders at once. But by appending
<tt class="docutils literal"><span class="pre">?builder=i386</span></tt> to the end of the URL, the page will show only the
results for the <cite>i386</cite> builder. When used in this way, you can add
multiple <tt class="docutils literal"><span class="pre">builder=</span></tt> arguments to see multiple builders. Remembering
that URL query arguments are separated <em>from each other</em> with
ampersands, a URL that ends in <tt class="docutils literal"><span class="pre">?builder=i386&amp;builder=ppc</span></tt> would
show builds for just those two Builders.</p>
<p>The <tt class="docutils literal"><span class="pre">branch=</span></tt> query argument can be used on some pages. This
filters the information displayed by that page down to only the builds
or changes which involved the given branch. Use <tt class="docutils literal"><span class="pre">branch=trunk</span></tt> to
reference the trunk: if you aren't intentionally using branches,
you're probably using trunk. Multiple <tt class="docutils literal"><span class="pre">branch=</span></tt> arguments can be
used to examine multiple branches at once (so appending
<tt class="docutils literal"><span class="pre">?branch=foo&amp;branch=bar</span></tt> to the URL will show builds involving
either branch). No <tt class="docutils literal"><span class="pre">branch=</span></tt> arguments means to show builds and
changes for all branches.</p>
<p>Some pages may include the Builder name or the build number in the
main part of the URL itself. For example, a page that describes Build
#7 of the <cite>i386</cite> builder would live at <tt class="file docutils literal"><span class="pre">/builders/i386/builds/7</span></tt>.</p>
<p>The table below lists all of the internal pages and the URLs that can
be used to access them.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">/waterfall</span></tt></dt>
<dd><p class="first">This provides a chronologically-oriented display of the activity of
all builders. It is the same display used by the Waterfall display.</p>
<p>By adding one or more <tt class="docutils literal"><span class="pre">builder=</span></tt> query arguments, the Waterfall is
restricted to only showing information about the given Builders. By
adding one or more <tt class="docutils literal"><span class="pre">branch=</span></tt> query arguments, the display is
restricted to showing information about the given branches. In
addition, adding one or more <tt class="docutils literal"><span class="pre">category=</span></tt> query arguments to the URL
will limit the display to Builders that were defined with one of the
given categories.</p>
<p>A <tt class="docutils literal"><span class="pre">show_events=true</span></tt> query argument causes the display to include
non-<tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> events, like slaves attaching and detaching, as well as
reconfiguration events. <tt class="docutils literal"><span class="pre">show_events=false</span></tt> hides these events. The
default is to show them.</p>
<p>By adding the <tt class="docutils literal"><span class="pre">failures_only=true</span></tt> query argument, the Waterfall is
restricted to only showing information about the builders that
are currently failing. A builder is considered failing if the
last finished build was not successful, a step in the current
build(s) is failing, or if the builder is offline.</p>
<p>The <tt class="docutils literal"><span class="pre">last_time=</span></tt>, <tt class="docutils literal"><span class="pre">first_time=</span></tt>, and  <tt class="docutils literal"><span class="pre">show_time=</span></tt>
arguments will control what interval of time is displayed. The default
is to show the latest events, but these can be used to look at earlier
periods in history. The <tt class="docutils literal"><span class="pre">num_events=</span></tt> argument also provides a
limit on the size of the displayed page.</p>
<p class="last">The Waterfall has references to resources many of the other portions
of the URL space: <tt class="file docutils literal"><span class="pre">/builders</span></tt> for access to individual builds,
<tt class="file docutils literal"><span class="pre">/changes</span></tt> for access to information about source code changes,
etc.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">/grid</span></tt></dt>
<dd><p class="first">This provides a chronologically oriented display of builders, by
revision.  The builders are listed down the left side of the page,
and the revisions are listed across the top.</p>
<p>By adding one or more <tt class="docutils literal"><span class="pre">category=</span></tt> arguments the grid will be
restricted to revisions in those categories.</p>
<p>A <tt class="samp docutils literal"><span class="pre">width=</span><em><span class="pre">N</span></em></tt> argument will limit the number of revisions shown to <em>N</em>,
defaulting to 5.</p>
<p class="last">A <tt class="samp docutils literal"><span class="pre">branch=</span><em><span class="pre">BRANCHNAME</span></em></tt> argument will limit the grid to revisions on
branch <em>BRANCHNAME</em>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">/tgrid</span></tt></dt>
<dd><p class="first">The Transposed Grid is similar to the standard grid, but, as the name
implies, transposes the grid: the revisions are listed down the left side
of the page, and the build hosts are listed across the top.  It accepts
the same query arguments. The exception being that instead of <tt class="docutils literal"><span class="pre">width</span></tt>
the argument is named <tt class="docutils literal"><span class="pre">length</span></tt>.</p>
<p class="last">This page also has a <tt class="docutils literal"><span class="pre">rev_order=</span></tt> query argument that lets you
change in what order revisions are shown. Valid values are <tt class="docutils literal"><span class="pre">asc</span></tt>
(ascending, oldest revision first) and <tt class="docutils literal"><span class="pre">desc</span></tt> (descending,
newest revision first).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">/console</span></tt></dt>
<dd><p class="first">EXPERIMENTAL: This provides a developer-oriented display of the last
changes and how they affected the builders.</p>
<p>It allows a developer to quickly see the status of each builder for the
first build including his or her change. A green box means that the change
succeeded for all the steps for a given builder. A red box means that
the changed introduced a new regression on a builder. An orange box
means that at least one of the tests failed, but it was also failing
in the previous build, so it is not possible to see if there were any
regressions from this change. Finally a yellow box means that the test
is in progress.</p>
<p>By adding one or more <tt class="docutils literal"><span class="pre">builder=</span></tt> query arguments, the Console view is
restricted to only showing information about the given Builders. Adding a
<tt class="docutils literal"><span class="pre">repository=</span></tt> argument will limit display to a given repository. By
adding one or more <tt class="docutils literal"><span class="pre">branch=</span></tt> query arguments, the display is restricted
to showing information about the given branches. In addition, adding one or
more <tt class="docutils literal"><span class="pre">category=</span></tt> query arguments to the URL will limit the display to
Builders that were defined with one of the given categories.  With the
<tt class="docutils literal"><span class="pre">project=</span></tt> query argument, it's possible to restrict the view to changes
from the given project.  With the <tt class="docutils literal"><span class="pre">codebase=</span></tt> query argument, it's possible
to restrict the view to changes for the given codebase.</p>
<p>By adding one or more <tt class="docutils literal"><span class="pre">name=</span></tt> query arguments to the URL, the console view is
restricted to only showing changes made by the given users.</p>
<p>NOTE: To use this page, your <tt class="file docutils literal"><span class="pre">buildbot.css</span></tt> file in
<tt class="file docutils literal"><span class="pre">public_html</span></tt> must be the one found in
<a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/status/web/files/default.css" title="master/buildbot/status/web/files/default.css"><tt class="docutils literal"><span class="pre">master/buildbot/status/web/files/default.css</span></tt></a>. This is the default
for new installs, but upgrades of very old installs of Buildbot may need to
manually fix the CSS file.</p>
<p>The console view is still in development. At this moment by
default the view sorts revisions lexically, which can lead to odd
behavior with non-integer revisions (e.g., git), or with integer
revisions of different length (e.g., 999 and 1000). It also has
some issues with displaying multiple braches at the same time. If
you do have multiple branches, you should use the <tt class="docutils literal"><span class="pre">branch=</span></tt>
query argument.  The <tt class="docutils literal"><span class="pre">order_console_by_time</span></tt> option may help
sorting revisions, although it depends on the date being set
correctly in each commit:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">w</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">WebStatus</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">order_console_by_time</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">/rss</span></tt></dt>
<dd>This provides a rss feed summarizing all failed builds. The same
query-arguments used by 'waterfall' can be added to filter the
feed output.</dd>
<dt><tt class="docutils literal"><span class="pre">/atom</span></tt></dt>
<dd>This provides an atom feed summarizing all failed builds. The same
query-arguments used by 'waterfall' can be added to filter the feed
output.</dd>
<dt><tt class="docutils literal"><span class="pre">/json</span></tt></dt>
<dd>This view provides quick access to Buildbot status information in a form that
is easiliy digested from other programs, including JavaScript.  See
<tt class="docutils literal"><span class="pre">/json/help</span></tt> for detailed interactive documentation of the output formats
for this view.</dd>
<dt><tt class="samp docutils literal"><span class="pre">/buildstatus?builder=$</span><em><span class="pre">BUILDERNAME</span></em><span class="pre">&amp;number=$</span><em><span class="pre">BUILDNUM</span></em></tt></dt>
<dd>This displays a waterfall-like chronologically-oriented view of all the
steps for a given build number on a given builder.</dd>
<dt><tt class="samp docutils literal"><span class="pre">/builders/$</span><em><span class="pre">BUILDERNAME</span></em></tt></dt>
<dd>This describes the given <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> and provides buttons to force a
build.  A <tt class="docutils literal"><span class="pre">numbuilds=</span></tt> argument will control how many build lines
are displayed (5 by default).</dd>
<dt><tt class="samp docutils literal"><span class="pre">/builders/$</span><em><span class="pre">BUILDERNAME</span></em><span class="pre">/builds/$</span><em><span class="pre">BUILDNUM</span></em></tt></dt>
<dd>This describes a specific Build.</dd>
<dt><tt class="samp docutils literal"><span class="pre">/builders/$</span><em><span class="pre">BUILDERNAME</span></em><span class="pre">/builds/$</span><em><span class="pre">BUILDNUM</span></em><span class="pre">/steps/$</span><em><span class="pre">STEPNAME</span></em></tt></dt>
<dd>This describes a specific BuildStep.</dd>
<dt><tt class="samp docutils literal"><span class="pre">/builders/$</span><em><span class="pre">BUILDERNAME</span></em><span class="pre">/builds/$</span><em><span class="pre">BUILDNUM</span></em><span class="pre">/steps/$</span><em><span class="pre">STEPNAME</span></em><span class="pre">/logs/$</span><em><span class="pre">LOGNAME</span></em></tt></dt>
<dd>This provides an HTML representation of a specific logfile.</dd>
<dt><tt class="samp docutils literal"><span class="pre">/builders/$</span><em><span class="pre">BUILDERNAME</span></em><span class="pre">/builds/$</span><em><span class="pre">BUILDNUM</span></em><span class="pre">/steps/$</span><em><span class="pre">STEPNAME</span></em><span class="pre">/logs/$</span><em><span class="pre">LOGNAME</span></em><span class="pre">/text</span></tt></dt>
<dd>This returns the logfile as plain text, without any HTML coloring
markup. It also removes the <cite>headers</cite>, which are the lines that
describe what command was run and what the environment variable
settings were like. This maybe be useful for saving to disk and
feeding to tools like <strong class="command">grep</strong>.</dd>
<dt><tt class="docutils literal"><span class="pre">/changes</span></tt></dt>
<dd>This provides a brief description of the <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt> in use
(see <a class="reference internal" href="#change-sources"><em>Change Sources</em></a>).</dd>
<dt><tt class="samp docutils literal"><span class="pre">/changes/</span><em><span class="pre">NN</span></em></tt></dt>
<dd>This shows detailed information about the numbered <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>: who was the
author, what files were changed, what revision number was represented,
etc.</dd>
<dt><tt class="docutils literal"><span class="pre">/buildslaves</span></tt></dt>
<dd><p class="first">This summarizes each <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt>, including which <cite>Builder</cite>s are
configured to use it, whether the buildslave is currently connected or
not, and host information retrieved from the buildslave itself.</p>
<p class="last">A <tt class="docutils literal"><span class="pre">no_builders=1</span></tt> URL argument will omit the builders column.  This is
useful if each buildslave is assigned to a large number of builders.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">/one_line_per_build</span></tt></dt>
<dd><p class="first">This page shows one line of text for each build, merging information
from all <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>s <a class="footnote-reference" href="#id6" id="id2">[1]</a>. Each line specifies
the name of the Builder, the number of the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>, what revision it
used, and a summary of the results. Successful builds are in green,
while failing builds are in red. The date and time of the build are
added to the right-hand edge of the line. The lines are ordered by
build finish timestamp.</p>
<p class="last">One or more <tt class="docutils literal"><span class="pre">builder=</span></tt> or <tt class="docutils literal"><span class="pre">branch=</span></tt> arguments can be used to
restrict the list. In addition, a <tt class="docutils literal"><span class="pre">numbuilds=</span></tt> argument will
control how many lines are displayed (20 by default).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">/builders</span></tt></dt>
<dd><p class="first">This page shows a small table, with one box for each <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>,
containing the results of the most recent <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>. It does not show the
individual steps, or the current status. This is a simple summary of
buildbot status: if this page is green, then all tests are passing.</p>
<p class="last">As with <tt class="docutils literal"><span class="pre">/one_line_per_build</span></tt>, this page will also honor
<tt class="docutils literal"><span class="pre">builder=</span></tt> and <tt class="docutils literal"><span class="pre">branch=</span></tt> arguments.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">/users</span></tt></dt>
<dd>This page exists for authentication reasons when checking <tt class="docutils literal"><span class="pre">showUsersPage</span></tt>.
It'll redirect to <tt class="docutils literal"><span class="pre">/authfail</span></tt> on <tt class="docutils literal"><span class="pre">False</span></tt>, <tt class="docutils literal"><span class="pre">/users/table</span></tt> on <tt class="docutils literal"><span class="pre">True</span></tt>,
and give a username/password login prompt on <tt class="docutils literal"><span class="pre">'auth'</span></tt>. Passing or failing
results redirect to the same pages as <tt class="docutils literal"><span class="pre">False</span></tt> and <tt class="docutils literal"><span class="pre">True</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">/users/table</span></tt></dt>
<dd>This page shows a table containing users that are stored in the database.
It has columns for their respective <tt class="docutils literal"><span class="pre">uid</span></tt> and <tt class="docutils literal"><span class="pre">identifier</span></tt> values,
with the <tt class="docutils literal"><span class="pre">uid</span></tt> values being clickable for more detailed information
relating to a user.</dd>
<dt><tt class="docutils literal"><span class="pre">/users/table/{NN}</span></tt></dt>
<dd>Shows all the attributes stored in the database relating to the user
with uid <tt class="docutils literal"><span class="pre">{NN}</span></tt> in a table.</dd>
<dt><tt class="docutils literal"><span class="pre">/about</span></tt></dt>
<dd>This page gives a brief summary of the Buildbot itself: software
version, versions of some libraries that the Buildbot depends upon,
etc. It also contains a link to the buildbot.net home page.</dd>
</dl>
<p>There are also a set of web-status resources that are intended for use
by other programs, rather than humans.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">/change_hook</span></tt></dt>
<dd>This provides an endpoint for web-based source change
notification. It is used by GitHub and
contrib/post_build_request.py. See <a class="reference internal" href="#change-hooks"><em>Change Hooks</em></a> for more
details.</dd>
</dl>
</div>
<div class="section" id="webstatus-configuration-parameters">
<h6>WebStatus Configuration Parameters<a class="headerlink" href="#webstatus-configuration-parameters" title="Permalink to this headline">¶</a></h6>
<div class="section" id="http-connection">
<h7>HTTP Connection<a class="headerlink" href="#http-connection" title="Permalink to this headline">¶</a></h7>
<p>The most common way to run a <tt class="xref py py-class docutils literal"><span class="pre">WebStatus</span></tt> is on a regular TCP
port. To do this, just pass in the TCP port number when you create the
<tt class="xref py py-class docutils literal"><span class="pre">WebStatus</span></tt> instance; this is called the <tt class="docutils literal"><span class="pre">http_port</span></tt> argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.html</span> <span class="kn">import</span> <span class="n">WebStatus</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WebStatus</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8080</span><span class="p">))</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">http_port</span></tt> argument is actually a <cite>strports specification</cite> for the
port that the web server should listen on. This can be a simple port number, or
a string like <tt class="docutils literal"><span class="pre">http_port=&quot;tcp:8080:interface=127.0.0.1&quot;</span></tt> (to limit
connections to the loopback interface, and therefore to clients running on the
same host) <a class="footnote-reference" href="#id7" id="id3">[2]</a>.</p>
<p>If instead (or in addition) you provide the <tt class="docutils literal"><span class="pre">distrib_port</span></tt>
argument, a twisted.web distributed server will be started either on a
TCP port (if <tt class="docutils literal"><span class="pre">distrib_port</span></tt> is like <tt class="docutils literal"><span class="pre">&quot;tcp:12345&quot;</span></tt>) or more
likely on a UNIX socket (if <tt class="docutils literal"><span class="pre">distrib_port</span></tt> is like
<tt class="docutils literal"><span class="pre">&quot;unix:/path/to/socket&quot;</span></tt>).</p>
<p>The <tt class="docutils literal"><span class="pre">public_html</span></tt> option gives the path to a regular directory of HTML
files that will be displayed alongside the various built-in URLs buildbot
supplies.  This is most often used to supply CSS files (<tt class="file docutils literal"><span class="pre">/buildbot.css</span></tt>)
and a top-level navigational file (<tt class="file docutils literal"><span class="pre">/index.html</span></tt>), but can also serve any
other files required - even build results!</p>
</div>
<div class="section" id="authorization">
<span id="id4"></span><h7>Authorization<a class="headerlink" href="#authorization" title="Permalink to this headline">¶</a></h7>
<p>The buildbot web status is, by default, read-only.  It displays lots of
information, but users are not allowed to affect the operation of the
buildmaster.  However, there are a number of supported activities that can
be enabled, and Buildbot can also perform rudimentary username/password
authentication.  The actions are:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">forceBuild</span></tt></dt>
<dd>force a particular builder to begin building, optionally with a specific revision, branch, etc.</dd>
<dt><tt class="docutils literal"><span class="pre">forceAllBuilds</span></tt></dt>
<dd>force <em>all</em> builders to start building</dd>
<dt><tt class="docutils literal"><span class="pre">pingBuilder</span></tt></dt>
<dd>&quot;ping&quot; a builder's buildslaves to check that they are alive</dd>
<dt><tt class="docutils literal"><span class="pre">gracefulShutdown</span></tt></dt>
<dd>gracefully shut down a slave when it is finished with its current build</dd>
<dt><tt class="docutils literal"><span class="pre">stopBuild</span></tt></dt>
<dd>stop a running build</dd>
<dt><tt class="docutils literal"><span class="pre">stopAllBuilds</span></tt></dt>
<dd>stop all running builds</dd>
<dt><tt class="docutils literal"><span class="pre">cancelPendingBuild</span></tt></dt>
<dd>cancel a build that has not yet started</dd>
<dt><tt class="docutils literal"><span class="pre">stopChange</span></tt></dt>
<dd>cancel builds that include a given change number</dd>
<dt><tt class="docutils literal"><span class="pre">cleanShutdown</span></tt></dt>
<dd>shut down the master gracefully, without interrupting builds</dd>
<dt><tt class="docutils literal"><span class="pre">showUsersPage</span></tt></dt>
<dd>access to page displaying users in the database, see <a class="reference internal" href="#user-objects"><em>User Objects</em></a></dd>
</dl>
<p>For each of these actions, you can configure buildbot to never allow the
action, always allow the action, allow the action to any authenticated user, or
check with a function of your creation to determine whether the action is OK
(see below).</p>
<p>This is all configured with the <tt class="xref py py-class docutils literal"><span class="pre">Authz</span></tt> class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.html</span> <span class="kn">import</span> <span class="n">WebStatus</span>
<span class="kn">from</span> <span class="nn">buildbot.status.web.authz</span> <span class="kn">import</span> <span class="n">Authz</span>
<span class="n">authz</span> <span class="o">=</span> <span class="n">Authz</span><span class="p">(</span>
    <span class="n">forceBuild</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">stopBuild</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WebStatus</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">authz</span><span class="o">=</span><span class="n">authz</span><span class="p">))</span>
</pre></div>
</div>
<p>Each of the actions listed above is an option to <tt class="xref py py-class docutils literal"><span class="pre">Authz</span></tt>.  You can
specify <tt class="docutils literal"><span class="pre">False</span></tt> (the default) to prohibit that action or <tt class="docutils literal"><span class="pre">True</span></tt> to enable
it.  Or you can specify a callable.  Each such callable will take a username as
its first argument.  The remaining arguments vary depending on the type of
authorization request.  For <tt class="docutils literal"><span class="pre">forceBuild</span></tt>, the second argument is the builder
stsatus.</p>
</div>
<div class="section" id="authentication">
<h7>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">¶</a></h7>
<p>If you do not wish to allow strangers to perform actions, but do want
developers to have such access, you will need to add some authentication
support.  Pass an instance of <tt class="xref py py-class docutils literal"><span class="pre">status.web.auth.IAuth</span></tt> as a <tt class="docutils literal"><span class="pre">auth</span></tt>
keyword argument to <tt class="xref py py-class docutils literal"><span class="pre">Authz</span></tt>, and specify the action as <tt class="docutils literal"><span class="pre">&quot;auth&quot;</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.html</span> <span class="kn">import</span> <span class="n">WebStatus</span>
<span class="kn">from</span> <span class="nn">buildbot.status.web.authz</span> <span class="kn">import</span> <span class="n">Authz</span>
<span class="kn">from</span> <span class="nn">buildbot.status.web.auth</span> <span class="kn">import</span> <span class="n">BasicAuth</span>
<span class="n">users</span> <span class="o">=</span> <span class="p">[(</span><span class="s">&#39;bob&#39;</span><span class="p">,</span> <span class="s">&#39;secret-pass&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;jill&#39;</span><span class="p">,</span> <span class="s">&#39;super-pass&#39;</span><span class="p">)]</span>
<span class="n">authz</span> <span class="o">=</span> <span class="n">Authz</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">BasicAuth</span><span class="p">(</span><span class="n">users</span><span class="p">),</span>
    <span class="n">forceBuild</span><span class="o">=</span><span class="s">&#39;auth&#39;</span><span class="p">,</span> <span class="c"># only authenticated users</span>
    <span class="n">pingBuilder</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c"># but anyone can do this</span>
<span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WebStatus</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8080</span><span class="p">,</span> <span class="n">authz</span><span class="o">=</span><span class="n">authz</span><span class="p">))</span>
<span class="c"># or</span>
<span class="kn">from</span> <span class="nn">buildbot.status.web.auth</span> <span class="kn">import</span> <span class="n">HTPasswdAuth</span>
<span class="n">auth</span> <span class="o">=</span> <span class="p">(</span><span class="n">HTPasswdAuth</span><span class="p">(</span><span class="s">&#39;/path/to/htpasswd&#39;</span><span class="p">))</span>
<span class="c"># or</span>
<span class="kn">from</span> <span class="nn">buildbot.status.web.auth</span> <span class="kn">import</span> <span class="n">UsersAuth</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">UsersAuth</span><span class="p">()</span>
</pre></div>
</div>
<p>The class <tt class="xref py py-class docutils literal"><span class="pre">BasicAuth</span></tt> implements a basic authentication mechanism using a
list of user/password tuples provided from the configuration file.  The class
<cite>HTPasswdAuth</cite> implements an authentication against an <tt class="file docutils literal"><span class="pre">.htpasswd</span></tt>
file. The <cite>HTPasswdAprAuth</cite> a subcalss of <cite>HTPasswdAuth</cite> use libaprutil for
authenticating. This adds support for apr1/md5 and sha1 password hashes but
requires libaprutil at runtime. The <tt class="xref py py-class docutils literal"><span class="pre">UsersAuth</span></tt> works with
<a class="reference internal" href="#user-objects"><em>User Objects</em></a> to check for valid user credentials.</p>
<p>If you need still-more flexibility, pass a function for the authentication
action.  That function will be called with an authenticated username and some
action-specific arguments, and should return true if the action is authorized.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">canForceBuild</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">builder_status</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">builder_status</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;smoketest&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="c"># any authenticated user can run smoketest</span>
    <span class="k">elif</span> <span class="n">username</span> <span class="o">==</span> <span class="s">&#39;releng&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="c"># releng can force whatever they want</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span> <span class="c"># otherwise, no way.</span>

<span class="n">authz</span> <span class="o">=</span> <span class="n">Authz</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">BasicAuth</span><span class="p">(</span><span class="n">users</span><span class="p">),</span>
    <span class="n">forceBuild</span><span class="o">=</span><span class="n">canForceBuild</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">forceBuild</span></tt> and <tt class="docutils literal"><span class="pre">pingBuilder</span></tt> actions both supply a
<tt class="xref py py-class docutils literal"><span class="pre">BuilderStatus</span></tt> object.  The <tt class="docutils literal"><span class="pre">stopBuild</span></tt> action supplies a <tt class="xref py py-class docutils literal"><span class="pre">BuildStatus</span></tt>
object.  The <tt class="docutils literal"><span class="pre">cancelPendingBuild</span></tt> action supplies a <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>.  The
remainder do not supply any extra arguments.</p>
</div>
<div class="section" id="http-based-authentication-by-frontend-server">
<h7>HTTP-based authentication by frontend server<a class="headerlink" href="#http-based-authentication-by-frontend-server" title="Permalink to this headline">¶</a></h7>
<p>In case if WebStatus is served through reverse proxy that supports HTTP-based
authentication (like apache, lighttpd), it's possible to to tell WebStatus to
trust web server and get username from request headers. This allows displaying
correct usernames in build reason, interrupt messages, etc.</p>
<p>Just set <tt class="docutils literal"><span class="pre">useHttpHeader</span></tt> to <tt class="docutils literal"><span class="pre">True</span></tt> in <tt class="xref py py-class docutils literal"><span class="pre">Authz</span></tt> constructor.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">authz</span> <span class="o">=</span> <span class="n">Authz</span><span class="p">(</span><span class="n">useHttpHeader</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c"># WebStatus secured by web frontend with HTTP auth</span>
</pre></div>
</div>
<p>Please note that WebStatus can decode password for HTTP Basic requests only (for
Digest authentication it's just impossible). Custom <tt class="xref py py-class docutils literal"><span class="pre">status.web.auth.IAuth</span></tt>
subclasses may just ignore password at all since it's already validated by web server.</p>
<p>Administrator must make sure that it's impossible to get access to WebStatus
using other way than through frontend. Usually this means that WebStatus should
listen for incoming connections only on localhost (or on some firewall-protected
port). Frontend must require HTTP authentication to access WebStatus pages
(using any source for credentials, such as htpasswd, PAM, LDAP).</p>
<p>If you allow unauthenticated access through frontend as well, it's possible to
specify a <tt class="docutils literal"><span class="pre">httpLoginLink</span></tt> which will be rendered on the WebStatus for
unauthenticated users as a link named Login.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">authz</span> <span class="o">=</span> <span class="n">Authz</span><span class="p">(</span><span class="n">useHttpHeader</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">httpLoginLink</span><span class="o">=</span><span class="s">&#39;https://buildbot/login&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>A configuration example with Apache HTTPD as reverse proxy could look like the
following.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">authz</span> <span class="o">=</span> <span class="n">Authz</span><span class="p">(</span>
  <span class="n">useHttpHeader</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
  <span class="n">httpLoginLink</span><span class="o">=</span><span class="s">&#39;https://buildbot/login&#39;</span><span class="p">,</span>
  <span class="n">auth</span> <span class="o">=</span> <span class="n">HTPasswdAprAuth</span><span class="p">(</span><span class="s">&#39;/var/www/htpasswd&#39;</span><span class="p">),</span>
  <span class="n">forceBuild</span> <span class="o">=</span> <span class="s">&#39;auth&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Corresponding Apache configuration.</p>
<div class="highlight-apache"><div class="highlight"><pre><span class="nb">ProxyPass</span> / http://127.0.0.1:8010/

<span class="nt">&lt;Location</span> <span class="s">/login</span><span class="nt">&gt;</span>
    <span class="nb">AuthType</span> Basic
    <span class="nb">AuthName</span> <span class="s2">&quot;Buildbot&quot;</span>
    <span class="nb">AuthUserFile</span> <span class="sx">/var/www/htpasswd</span>
    <span class="nb">Require</span> valid-user

    <span class="nb">RewriteEngine</span> <span class="k">on</span>
    <span class="nb">RewriteCond</span> %{HTTP_REFERER} ^https?://([^/]+)/(.*)$
    <span class="nb">RewriteRule</span> ^.*$ https://%1/%2 [R,L]
<span class="nt">&lt;/Location&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="logging-configuration">
<h7>Logging configuration<a class="headerlink" href="#logging-configuration" title="Permalink to this headline">¶</a></h7>
<p>The <cite>WebStatus</cite> uses a separate log file (<tt class="file docutils literal"><span class="pre">http.log</span></tt>) to avoid clutter
buildbot's default log (<tt class="file docutils literal"><span class="pre">twistd.log</span></tt>) with request/response messages.
This log is also, by default, rotated in the same way as the twistd.log
file, but you can also customize the rotation logic with the following
parameters if you need a different behaviour.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">rotateLength</span></tt></dt>
<dd>An integer defining the file size at which log files are rotated.</dd>
<dt><tt class="docutils literal"><span class="pre">maxRotatedFiles</span></tt></dt>
<dd>The maximum number of old log files to keep.</dd>
</dl>
</div>
<div class="section" id="url-decorating-options">
<h7>URL-decorating options<a class="headerlink" href="#url-decorating-options" title="Permalink to this headline">¶</a></h7>
<p>These arguments adds an URL link to various places in the WebStatus,
such as revisions, repositories, projects and, optionally, ticket/bug references
in change comments.</p>
<div class="section" id="revlink">
<h8>revlink<a class="headerlink" href="#revlink" title="Permalink to this headline">¶</a></h8>
<p>The <tt class="docutils literal"><span class="pre">revlink</span></tt> argument on <tt class="xref py py-class docutils literal"><span class="pre">WebStatus</span></tt> is deprecated in favour of the
global <a class="reference internal" href="#cfg-revlink" title="revlink"><tt class="xref bb bb-cfg docutils literal"><span class="pre">revlink</span></tt></a> option. Only use this if you need to generate
different URLs for different web status instances.</p>
<p>In addition to a callable like <a class="reference internal" href="#cfg-revlink" title="revlink"><tt class="xref bb bb-cfg docutils literal"><span class="pre">revlink</span></tt></a>, this argument accepts a
format string or a dict mapping a string (repository name) to format strings.</p>
<p>The format string should use <tt class="docutils literal"><span class="pre">%s</span></tt> to insert the revision id in the url.  For
example, for Buildbot on GitHub:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">revlink</span><span class="o">=</span><span class="s">&#39;http://github.com/buildbot/buildbot/tree/</span><span class="si">%s</span><span class="s">&#39;</span>
</pre></div>
</div>
<p>The revision ID will be URL encoded before inserted in the replacement string</p>
</div>
<div class="section" id="changecommentlink">
<h8>changecommentlink<a class="headerlink" href="#changecommentlink" title="Permalink to this headline">¶</a></h8>
<p>The <tt class="docutils literal"><span class="pre">changecommentlink</span></tt> argument can be used to create links to
ticket-ids from change comments (i.e. #123).</p>
<p>The argument can either be a tuple of three strings, a dictionary
mapping strings (project names) to tuples or a callable taking a
changetext (a <tt class="xref py py-class docutils literal"><span class="pre">jinja2.Markup</span></tt> instance) and a project name,
returning a the same change text with additional links/html tags added
to it.</p>
<p>If the tuple is used, it should contain three strings where the first
element is a regex that searches for strings (with match groups), the
second is a replace-string that, when substituted with <tt class="docutils literal"><span class="pre">\1</span></tt> etc,
yields the URL and the third is the title attribute of the link. (The
<tt class="docutils literal"><span class="pre">&lt;a</span> <span class="pre">href=&quot;&quot;</span> <span class="pre">title=&quot;&quot;&gt;&lt;/a&gt;</span></tt> is added by the system.) So, for Trac
tickets (#42, etc): <tt class="docutils literal"><span class="pre">changecommentlink(r&quot;#(\d+)&quot;,</span>
<span class="pre">r&quot;http://buildbot.net/trac/ticket/\1&quot;,</span> <span class="pre">r&quot;Ticket</span> <span class="pre">\g&lt;0&gt;&quot;)</span></tt> .</p>
</div>
<div class="section" id="projects">
<h8>projects<a class="headerlink" href="#projects" title="Permalink to this headline">¶</a></h8>
<p>A dictionary from strings to strings, mapping project names to URLs,
or a callable taking a project name and returning an URL.</p>
</div>
<div class="section" id="repositories">
<h8>repositories<a class="headerlink" href="#repositories" title="Permalink to this headline">¶</a></h8>
<p>Same as the projects arg above, a dict or callable mapping project names
to URLs.</p>
</div>
</div>
<div class="section" id="display-specific-options">
<h7>Display-Specific Options<a class="headerlink" href="#display-specific-options" title="Permalink to this headline">¶</a></h7>
<p>The <tt class="docutils literal"><span class="pre">order_console_by_time</span></tt> option affects the rendering of the console;
see the description of the console above.</p>
<p>The <tt class="docutils literal"><span class="pre">numbuilds</span></tt> option determines the number of builds that most status
displays will show.  It can usually be overriden in the URL, e.g.,
<tt class="docutils literal"><span class="pre">?numbuilds=13</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">num_events</span></tt> option gives the default number of events that the
waterfall will display.  The <tt class="docutils literal"><span class="pre">num_events_max</span></tt> gives the maximum number of
events displayed, even if the web browser requests more.</p>
</div>
</div>
<div class="section" id="change-hooks">
<span id="id5"></span><h6>Change Hooks<a class="headerlink" href="#change-hooks" title="Permalink to this headline">¶</a></h6>
<p>The <tt class="docutils literal"><span class="pre">/change_hook</span></tt> url is a magic URL which will accept HTTP requests and translate
them into changes for buildbot. Implementations (such as a trivial json-based endpoint
and a GitHub implementation) can be found in <a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/status/web/hooks" title="master/buildbot/status/web/hooks"><tt class="docutils literal"><span class="pre">master/buildbot/status/web/hooks</span></tt></a>.
The format of the url is <tt class="samp docutils literal"><span class="pre">/change_hook/</span><em><span class="pre">DIALECT</span></em></tt> where DIALECT is a package within the
hooks directory. Change_hook is disabled by default and each DIALECT has to be enabled
separately, for security reasons</p>
<p>An example WebStatus configuration line which enables change_hook and two DIALECTS:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">WebStatus</span><span class="p">(</span><span class="n">http_port</span><span class="o">=</span><span class="mi">8010</span><span class="p">,</span><span class="n">allowForce</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span>
                          <span class="s">&#39;base&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                          <span class="s">&#39;somehook&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;option1&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                                       <span class="s">&#39;option2&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">}}))</span>
</pre></div>
</div>
<p>Within the WebStatus arguments, the <tt class="docutils literal"><span class="pre">change_hook</span></tt> key enables/disables the module
and <tt class="docutils literal"><span class="pre">change_hook_dialects</span></tt> whitelists DIALECTs where the keys are the module names
and the values are optional arguments which will be passed to the hooks.</p>
<p>The <tt class="file docutils literal"><span class="pre">post_build_request.py</span></tt> script in <tt class="file docutils literal"><span class="pre">master/contrib</span></tt> allows for the
submission of an arbitrary change request. Run <strong class="command">post_build_request.py
--help</strong> for more information.  The <tt class="docutils literal"><span class="pre">base</span></tt> dialect must be enabled for this to
work.</p>
<div class="section" id="github-hook">
<h7>github hook<a class="headerlink" href="#github-hook" title="Permalink to this headline">¶</a></h7>
<p>The GitHub hook is simple and takes no options.</p>
<div class="highlight-python"><pre>c['status'].append(html.WebStatus(..
                   change_hook_dialects={ 'github' : True }))</pre>
</div>
<p>With this set up, add a Post-Receive URL for the project in the GitHub
administrative interface, pointing to <tt class="docutils literal"><span class="pre">/change_hook/github</span></tt> relative to
the root of the web status.  For example, if the grid URL is
<tt class="docutils literal"><span class="pre">http://builds.mycompany.com/bbot/grid</span></tt>, then point GitHub to
<tt class="docutils literal"><span class="pre">http://builds.mycompany.com/bbot/change_hook/github</span></tt>. To specify a project
associated to the repository, append <tt class="docutils literal"><span class="pre">?project=name</span></tt> to the URL.</p>
<p>Note that there is a standalone HTTP server available for receiving GitHub
notifications, as well: <tt class="file docutils literal"><span class="pre">contrib/github_buildbot.py</span></tt>.  This script may be
useful in cases where you cannot expose the WebStatus for public consumption.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The incoming HTTP requests for this hook are not authenticated in
any way.  Anyone who can access the web status can &quot;fake&quot; a request from
GitHub, potentially causing the buildmaster to run arbitrary code.  See
<a class="reference external" href="http://trac.buildbot.net/ticket/2186" title="bug #2186">bug #2186</a> for work to fix this problem.</p>
</div>
</div>
<div class="section" id="google-code-hook">
<h7>Google Code hook<a class="headerlink" href="#google-code-hook" title="Permalink to this headline">¶</a></h7>
<p>The Google Code hook is quite similar to the GitHub Hook. It has one option
for the &quot;Post-Commit Authentication Key&quot; used to check if the request is
legitimate:</p>
<div class="highlight-python"><pre>c['status'].append(html.WebStatus(
    …,
    change_hook_dialects={'googlecode': {'secret_key': 'FSP3p-Ghdn4T0oqX'}}
))</pre>
</div>
<p>This will add a &quot;Post-Commit URL&quot; for the project in the Google Code
administrative interface, pointing to <tt class="docutils literal"><span class="pre">/change_hook/googlecode</span></tt> relative to
the root of the web status.</p>
<p>Alternatively, you can use the <a class="reference internal" href="#googlecodeatompoller"><em>GoogleCodeAtomPoller</em></a> <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>
that periodically poll the Google Code commit feed for changes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Google Code doesn't send the branch on which the changes were made. So, the
hook always returns <tt class="docutils literal"><span class="pre">'default'</span></tt> as the branch, you can override it with the
<tt class="docutils literal"><span class="pre">'branch'</span></tt> option:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">change_hook_dialects</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;googlecode&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;secret_key&#39;</span><span class="p">:</span> <span class="s">&#39;FSP3p-Ghdn4T0oqX&#39;</span><span class="p">,</span> <span class="s">&#39;branch&#39;</span><span class="p">:</span> <span class="s">&#39;master&#39;</span><span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="poller-hook">
<h7>Poller hook<a class="headerlink" href="#poller-hook" title="Permalink to this headline">¶</a></h7>
<p>The poller hook allows you to use GET requests to trigger polling. One
advantage of this is your buildbot instance can (at start up) poll to get
changes that happened while it was down, but then you can still use a commit
hook to get fast notification of new changes.</p>
<p>Suppose you have a poller configured like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/amanda&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">split_file_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>And you configure your WebStatus to enable this hook:</p>
<div class="highlight-python"><pre>c['status'].append(html.WebStatus(
    …,
    change_hook_dialects={'poller': True}
))</pre>
</div>
<p>Then you will be able to trigger a poll of the SVN repository by poking the
<tt class="docutils literal"><span class="pre">/change_hook/poller</span></tt> URL from a commit hook like this:</p>
<div class="highlight-python"><pre>curl http://yourbuildbot/change_hook/poller?poller=https%3A%2F%2Famanda.svn.sourceforge.net%2Fsvnroot%2Famanda%2Famanda</pre>
</div>
<p>If no <tt class="docutils literal"><span class="pre">poller</span></tt> argument is provided then the hook will trigger polling of all
polling change sources.</p>
<p>You can restrict which pollers the webhook has access to using the <tt class="docutils literal"><span class="pre">allowed</span></tt>
option:</p>
<div class="highlight-python"><pre>c['status'].append(html.WebStatus(
    …,
    change_hook_dialects={'poller': {'allowed': ['https://amanda.svn.sourceforge.net/svnroot/amanda/amanda']}}
))</pre>
</div>
<span class="target" id="status-MailNotifier"></span></div>
</div>
</div>
<div class="section" id="mailnotifier">
<span id="index-0"></span><h5>MailNotifier<a class="headerlink" href="#mailnotifier" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.status.mail.MailNotifier">
<em class="property">class </em><tt class="descclassname">buildbot.status.mail.</tt><tt class="descname">MailNotifier</tt><a class="headerlink" href="#buildbot.status.mail.MailNotifier" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The buildbot can also send email when builds finish. The most common
use of this is to tell developers when their change has caused the
build to fail. It is also quite common to send a message to a mailing
list (usually named <cite>builds</cite> or similar) about every build.</p>
<p>The <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> status target is used to accomplish this. You
configure it by specifying who mail should be sent to, under what
circumstances mail should be sent, and how to deliver the mail. It can
be configured to only send out mail for certain builders, and only
send messages when the build fails, or when the builder transitions
from success to failure. It can also be configured to include various
build logs in each message.</p>
<p>If a proper lookup function is configured, the message will be sent to the
&quot;interested users&quot; list (<a class="reference internal" href="#doing-things-with-users"><em>Doing Things With Users</em></a>), which includes all
developers who made changes in the build.  By default, however, Buildbot does
not know how to construct an email addressed based on the information from the
version control system.  See the <tt class="docutils literal"><span class="pre">lookup</span></tt> argument, below, for more
information.</p>
<p>You can add additional, statically-configured, recipients with the
<tt class="docutils literal"><span class="pre">extraRecipients</span></tt> argument.  You can also add interested users by setting the
<tt class="docutils literal"><span class="pre">owners</span></tt> build property to a list of users in the scheduler constructor
(<a class="reference internal" href="#configuring-schedulers"><em>Configuring Schedulers</em></a>).</p>
<p>Each <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> sends mail to a single set of recipients. To send
different kinds of mail to different recipients, use multiple
<tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt>s.</p>
<p>The following simple example will send an email upon the completion of
each build, to just those developers whose <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s were included in
the build. The email contains a description of the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>, its results,
and URLs where more information can be obtained.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.mail</span> <span class="kn">import</span> <span class="n">MailNotifier</span>
<span class="n">mn</span> <span class="o">=</span> <span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s">&quot;buildbot@example.org&quot;</span><span class="p">,</span> <span class="n">lookup</span><span class="o">=</span><span class="s">&quot;example.org&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span>
</pre></div>
</div>
<p>To get a simple one-message-per-build (say, for a mailing list), use
the following form instead. This form does not send mail to individual
developers (and thus does not need the <tt class="docutils literal"><span class="pre">lookup=</span></tt> argument,
explained below), instead it only ever sends mail to the <cite>extra
recipients</cite> named in the arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mn</span> <span class="o">=</span> <span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                  <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                  <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;listaddr@example.org&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>If your SMTP host requires authentication before it allows you to send emails,
this can also be done by specifying <tt class="docutils literal"><span class="pre">smtpUser</span></tt> and <tt class="docutils literal"><span class="pre">smptPassword</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mn</span> <span class="o">=</span> <span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s">&quot;myuser@gmail.com&quot;</span><span class="p">,</span>
                  <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                  <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;listaddr@example.org&quot;</span><span class="p">],</span>
                  <span class="n">relayhost</span><span class="o">=</span><span class="s">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="n">smtpPort</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span>
                  <span class="n">smtpUser</span><span class="o">=</span><span class="s">&quot;myuser@gmail.com&quot;</span><span class="p">,</span> <span class="n">smtpPassword</span><span class="o">=</span><span class="s">&quot;mypassword&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to require Transport Layer Security (TLS), then you can also
set <tt class="docutils literal"><span class="pre">useTls</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">mn</span> <span class="o">=</span> <span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s">&quot;myuser@gmail.com&quot;</span><span class="p">,</span>
                  <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                  <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;listaddr@example.org&quot;</span><span class="p">],</span>
                  <span class="n">useTls</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">relayhost</span><span class="o">=</span><span class="s">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="n">smtpPort</span><span class="o">=</span><span class="mi">587</span><span class="p">,</span>
                  <span class="n">smtpUser</span><span class="o">=</span><span class="s">&quot;myuser@gmail.com&quot;</span><span class="p">,</span> <span class="n">smtpPassword</span><span class="o">=</span><span class="s">&quot;mypassword&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you see <tt class="docutils literal"><span class="pre">twisted.mail.smtp.TLSRequiredError</span></tt> exceptions in
the log while using TLS, this can be due <em>either</em> to the server not
supporting TLS or to a missing <a class="reference external" href="http://pyopenssl.sourceforge.net/">PyOpenSSL</a> package on the buildmaster system.</p>
</div>
<p>In some cases it is desirable to have different information then what is
provided in a standard MailNotifier message. For this purpose MailNotifier
provides the argument <tt class="docutils literal"><span class="pre">messageFormatter</span></tt> (a function) which allows for the
creation of messages with unique content.</p>
<p>For example, if only short emails are desired (e.g., for delivery to phones)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.builder</span> <span class="kn">import</span> <span class="n">Results</span>
<span class="k">def</span> <span class="nf">messageFormatter</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">master_status</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="n">results</span><span class="p">]</span>

    <span class="n">text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;STATUS: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">result</span><span class="o">.</span><span class="n">title</span><span class="p">())</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s">&#39;body&#39;</span> <span class="p">:</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
        <span class="s">&#39;type&#39;</span> <span class="p">:</span> <span class="s">&#39;plain&#39;</span>
    <span class="p">}</span>

<span class="n">mn</span> <span class="o">=</span> <span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                  <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                  <span class="n">mode</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;problem&#39;</span><span class="p">,),</span>
                  <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;listaddr@example.org&#39;</span><span class="p">],</span>
                  <span class="n">messageFormatter</span><span class="o">=</span><span class="n">messageFormatter</span><span class="p">)</span>
</pre></div>
</div>
<p>Another example of a function delivering a customized html email
containing the last 80 log lines of logs of the last build step is
given below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.builder</span> <span class="kn">import</span> <span class="n">Results</span>

<span class="kn">import</span> <span class="nn">cgi</span><span class="o">,</span> <span class="nn">datetime</span>

<span class="k">def</span> <span class="nf">html_message_formatter</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">master_status</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provide a customized message to Buildbot&#39;s MailNotifier.</span>

<span class="sd">    The last 80 lines of the log are provided as well as the changes</span>
<span class="sd">    relevant to the build.  Message content is formatted as html.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="n">results</span><span class="p">]</span>

    <span class="n">limit_lines</span> <span class="o">=</span> <span class="mi">80</span>
    <span class="n">text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;h4&gt;Build status: </span><span class="si">%s</span><span class="s">&lt;/h4&gt;&#39;</span> <span class="o">%</span> <span class="n">result</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;table cellspacing=&quot;10&quot;&gt;&lt;tr&gt;&#39;</span><span class="p">)</span>
    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&quot;&lt;td&gt;Buildslave for this Build:&lt;/td&gt;&lt;td&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s">&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span class="o">%</span> <span class="n">build</span><span class="o">.</span><span class="n">getSlavename</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">master_status</span><span class="o">.</span><span class="n">getURLForThing</span><span class="p">(</span><span class="n">build</span><span class="p">):</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;tr&gt;&lt;td&gt;Complete logs for all build steps:&lt;/td&gt;&lt;td&gt;&lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">master_status</span><span class="o">.</span><span class="n">getURLForThing</span><span class="p">(</span><span class="n">build</span><span class="p">),</span>
                       <span class="n">master_status</span><span class="o">.</span><span class="n">getURLForThing</span><span class="p">(</span><span class="n">build</span><span class="p">))</span>
                    <span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;tr&gt;&lt;td&gt;Build Reason:&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s">&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="n">build</span><span class="o">.</span><span class="n">getReason</span><span class="p">())</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s">u&quot;&quot;</span>
        <span class="n">ss</span> <span class="o">=</span> <span class="n">build</span><span class="o">.</span><span class="n">getSourceStamp</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">branch</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">+=</span> <span class="s">u&quot;[branch </span><span class="si">%s</span><span class="s">] &quot;</span> <span class="o">%</span> <span class="n">ss</span><span class="o">.</span><span class="n">branch</span>
        <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">revision</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">+=</span>  <span class="n">ss</span><span class="o">.</span><span class="n">revision</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">+=</span> <span class="s">u&quot;HEAD&quot;</span>
        <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">patch</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">+=</span> <span class="s">u&quot; (plus patch)&quot;</span>
        <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">patch_info</span><span class="p">:</span> <span class="c"># add patch comment</span>
            <span class="n">source</span> <span class="o">+=</span> <span class="s">u&quot; (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">ss</span><span class="o">.</span><span class="n">patch_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&quot;&lt;tr&gt;&lt;td&gt;Build Source Stamp:&lt;/td&gt;&lt;td&gt;&lt;b&gt;</span><span class="si">%s</span><span class="s">&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span class="o">%</span> <span class="n">source</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&quot;&lt;tr&gt;&lt;td&gt;Blamelist:&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s">&lt;/td&gt;&lt;/tr&gt;&quot;</span> <span class="o">%</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">build</span><span class="o">.</span><span class="n">getResponsibleUsers</span><span class="p">()))</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;/table&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ss</span><span class="o">.</span><span class="n">changes</span><span class="p">:</span>
            <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;h4&gt;Recent Changes:&lt;/h4&gt;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ss</span><span class="o">.</span><span class="n">changes</span><span class="p">:</span>
                <span class="n">cd</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">asDict</span><span class="p">()</span>
                <span class="n">when</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">cd</span><span class="p">[</span><span class="s">&#39;when&#39;</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;table cellspacing=&quot;10&quot;&gt;&#39;</span><span class="p">)</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;tr&gt;&lt;td&gt;Repository:&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s">&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="n">cd</span><span class="p">[</span><span class="s">&#39;repository&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;tr&gt;&lt;td&gt;Project:&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s">&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="n">cd</span><span class="p">[</span><span class="s">&#39;project&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;tr&gt;&lt;td&gt;Time:&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s">&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="n">when</span><span class="p">)</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;tr&gt;&lt;td&gt;Changed by:&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s">&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="n">cd</span><span class="p">[</span><span class="s">&#39;who&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;tr&gt;&lt;td&gt;Comments:&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s">&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="n">cd</span><span class="p">[</span><span class="s">&#39;comments&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;/table&gt;&#39;</span><span class="p">)</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">cd</span><span class="p">[</span><span class="s">&#39;files&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;table cellspacing=&quot;10&quot;&gt;&lt;tr&gt;&lt;th align=&quot;left&quot;&gt;Files&lt;/th&gt;&lt;/tr&gt;&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;tr&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s">:&lt;/td&gt;&lt;/tr&gt;&#39;</span> <span class="o">%</span> <span class="nb">file</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="p">)</span>
                    <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;/table&gt;&#39;</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;br&gt;&#39;</span><span class="p">)</span>
        <span class="c"># get log for last step</span>
        <span class="n">logs</span> <span class="o">=</span> <span class="n">build</span><span class="o">.</span><span class="n">getLogs</span><span class="p">()</span>
        <span class="c"># logs within a step are in reverse order. Search back until we find stdio</span>
        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">logs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">log</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;stdio&#39;</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">getStep</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">log</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="n">status</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">getStep</span><span class="p">()</span><span class="o">.</span><span class="n">getResults</span><span class="p">()</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="c"># Note: can be VERY LARGE</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">u&#39;</span><span class="si">%s</span><span class="s">/steps/</span><span class="si">%s</span><span class="s">/logs/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">master_status</span><span class="o">.</span><span class="n">getURLForThing</span><span class="p">(</span><span class="n">build</span><span class="p">),</span>
                                       <span class="n">log</span><span class="o">.</span><span class="n">getStep</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                                       <span class="n">log</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>

        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;i&gt;Detailed log of last build step:&lt;/i&gt; &lt;a href=&quot;</span><span class="si">%s</span><span class="s">&quot;&gt;</span><span class="si">%s</span><span class="s">&lt;/a&gt;&#39;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">url</span><span class="p">))</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;br&gt;&#39;</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;h4&gt;Last </span><span class="si">%d</span><span class="s"> lines of &quot;</span><span class="si">%s</span><span class="s">&quot;&lt;/h4&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">limit_lines</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">unilist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">-</span><span class="n">limit_lines</span><span class="p">:]:</span>
            <span class="n">unilist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s">&#39;utf-8&#39;</span><span class="p">)))</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;pre&gt;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">uniline</span> <span class="k">for</span> <span class="n">uniline</span> <span class="ow">in</span> <span class="n">unilist</span><span class="p">]))</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;/pre&gt;&#39;</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;br&gt;&lt;br&gt;&#39;</span><span class="p">)</span>
        <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">u&#39;&lt;b&gt;-The Buildbot&lt;/b&gt;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;body&#39;</span><span class="p">:</span> <span class="s">u&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">),</span>
            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="s">&#39;html&#39;</span>
            <span class="p">}</span>

<span class="n">mn</span> <span class="o">=</span> <span class="n">MailNotifier</span><span class="p">(</span><span class="n">fromaddr</span><span class="o">=</span><span class="s">&quot;buildbot@example.org&quot;</span><span class="p">,</span>
                  <span class="n">sendToInterestedUsers</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                  <span class="n">mode</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;failing&#39;</span><span class="p">,),</span>
                  <span class="n">extraRecipients</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;listaddr@example.org&#39;</span><span class="p">],</span>
                  <span class="n">messageFormatter</span><span class="o">=</span><span class="n">html_message_formatter</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="mailnotifier-arguments">
<h6>MailNotifier arguments<a class="headerlink" href="#mailnotifier-arguments" title="Permalink to this headline">¶</a></h6>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">fromaddr</span></tt></dt>
<dd>The email address to be used in the 'From' header.</dd>
<dt><tt class="docutils literal"><span class="pre">sendToInterestedUsers</span></tt></dt>
<dd>(boolean). If <tt class="docutils literal"><span class="pre">True</span></tt> (the default), send mail to all of the Interested
Users. If <tt class="docutils literal"><span class="pre">False</span></tt>, only send mail to the <tt class="docutils literal"><span class="pre">extraRecipients</span></tt> list.</dd>
<dt><tt class="docutils literal"><span class="pre">extraRecipients</span></tt></dt>
<dd>(list of strings). A list of email addresses to which messages should
be sent (in addition to the InterestedUsers list, which includes any
developers who made <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>s that went into this build). It is a good
idea to create a small mailing list and deliver to that, then let
subscribers come and go as they please.</dd>
<dt><tt class="docutils literal"><span class="pre">subject</span></tt></dt>
<dd>(string). A string to be used as the subject line of the message.
<tt class="docutils literal"><span class="pre">%(builder)s</span></tt> will be replaced with the name of the builder which
provoked the message.</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first">(list of strings). A combination of:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">change</span></tt></dt>
<dd>Send mail about builds which change status.</dd>
<dt><tt class="docutils literal"><span class="pre">failing</span></tt></dt>
<dd>Send mail about builds which fail.</dd>
<dt><tt class="docutils literal"><span class="pre">passing</span></tt></dt>
<dd>Send mail about builds which succeed.</dd>
<dt><tt class="docutils literal"><span class="pre">problem</span></tt></dt>
<dd>Send mail about a build which failed when the previous build has passed.</dd>
<dt><tt class="docutils literal"><span class="pre">warnings</span></tt></dt>
<dd>Send mail about builds which generate warnings.</dd>
<dt><tt class="docutils literal"><span class="pre">exception</span></tt></dt>
<dd>Send mail about builds which generate exceptions.</dd>
<dt><tt class="docutils literal"><span class="pre">all</span></tt></dt>
<dd>Always send mail about builds.</dd>
</dl>
<p class="last">Defaults to (<tt class="docutils literal"><span class="pre">failing</span></tt>, <tt class="docutils literal"><span class="pre">passing</span></tt>, <tt class="docutils literal"><span class="pre">warnings</span></tt>).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">builders</span></tt></dt>
<dd>(list of strings). A list of builder names for which mail should be
sent. Defaults to <tt class="docutils literal"><span class="pre">None</span></tt> (send mail for all builds). Use either builders
or categories, but not both.</dd>
<dt><tt class="docutils literal"><span class="pre">categories</span></tt></dt>
<dd>(list of strings). A list of category names to serve status
information for. Defaults to <tt class="docutils literal"><span class="pre">None</span></tt> (all categories). Use either
builders or categories, but not both.</dd>
<dt><tt class="docutils literal"><span class="pre">addLogs</span></tt></dt>
<dd>(boolean). If <tt class="docutils literal"><span class="pre">True</span></tt>, include all build logs as attachments to the
messages. These can be quite large. This can also be set to a list of
log names, to send a subset of the logs. Defaults to <tt class="docutils literal"><span class="pre">False</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">addPatch</span></tt></dt>
<dd>(boolean). If <tt class="docutils literal"><span class="pre">True</span></tt>, include the patch content if a patch was present.
Patches are usually used on a <tt class="xref py py-class docutils literal"><span class="pre">Try</span></tt> server.
Defaults to <tt class="docutils literal"><span class="pre">True</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">buildSetSummary</span></tt></dt>
<dd>(boolean). If <tt class="docutils literal"><span class="pre">True</span></tt>, send a single summary email consisting of the
concatenation of all build completion messages rather than a
completion message for each build.  Defaults to <tt class="docutils literal"><span class="pre">False</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">relayhost</span></tt></dt>
<dd>(string). The host to which the outbound SMTP connection should be
made. Defaults to 'localhost'</dd>
<dt><tt class="docutils literal"><span class="pre">smtpPort</span></tt></dt>
<dd>(int). The port that will be used on outbound SMTP
connections. Defaults to 25.</dd>
<dt><tt class="docutils literal"><span class="pre">useTls</span></tt></dt>
<dd>(boolean). When this argument is <tt class="docutils literal"><span class="pre">True</span></tt> (default is <tt class="docutils literal"><span class="pre">False</span></tt>)
<tt class="docutils literal"><span class="pre">MailNotifier</span></tt> sends emails using TLS and authenticates with the
<tt class="docutils literal"><span class="pre">relayhost</span></tt>. When using TLS the arguments <tt class="docutils literal"><span class="pre">smtpUser</span></tt> and
<tt class="docutils literal"><span class="pre">smtpPassword</span></tt> must also be specified.</dd>
<dt><tt class="docutils literal"><span class="pre">smtpUser</span></tt></dt>
<dd>(string). The user name to use when authenticating with the
<tt class="docutils literal"><span class="pre">relayhost</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">smtpPassword</span></tt></dt>
<dd>(string). The password that will be used when authenticating with the
<tt class="docutils literal"><span class="pre">relayhost</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">lookup</span></tt></dt>
<dd><p class="first">(implementor of <tt class="xref py py-class docutils literal"><span class="pre">IEmailLookup</span></tt>). Object which provides
<tt class="xref py py-class docutils literal"><span class="pre">IEmailLookup</span></tt>, which is responsible for mapping User names (which come
from the VC system) into valid email addresses.</p>
<p>If the argument is not provided, the <tt class="docutils literal"><span class="pre">MailNotifier</span></tt> will attempt to build
the <tt class="docutils literal"><span class="pre">sendToInterestedUsers</span></tt> from the authors of the Changes that led to
the Build via <a class="reference internal" href="#user-objects"><em>User Objects</em></a>.  If the author of one of the Build's
Changes has an email address stored, it will added to the recipients list.
With this method, <tt class="docutils literal"><span class="pre">owners</span></tt> are still added to the recipients.  Note that,
in the current implementation of user objects, email addresses are not
stored; as a result, unless you have specifically added email addresses to
the user database, this functionality is unlikely to actually send any
emails.</p>
<p>Most of the time you can use a simple Domain instance. As a shortcut, you
can pass as string: this will be treated as if you had provided
<tt class="docutils literal"><span class="pre">Domain(str)</span></tt>. For example, <tt class="docutils literal"><span class="pre">lookup='twistedmatrix.com'</span></tt> will allow
mail to be sent to all developers whose SVN usernames match their
twistedmatrix.com account names. See <tt class="file docutils literal"><span class="pre">buildbot/status/mail.py</span></tt> for
more details.</p>
<p class="last">Regardless of the setting of <tt class="docutils literal"><span class="pre">lookup</span></tt>, <tt class="docutils literal"><span class="pre">MailNotifier</span></tt> will also send
mail to addresses in the <tt class="docutils literal"><span class="pre">extraRecipients</span></tt> list.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">messageFormatter</span></tt></dt>
<dd>This is a optional function that can be used to generate a custom mail message.
A <tt class="xref py py-func docutils literal"><span class="pre">messageFormatter</span></tt> function takes the mail mode (<tt class="docutils literal"><span class="pre">mode</span></tt>), builder
name (<tt class="docutils literal"><span class="pre">name</span></tt>), the build status (<tt class="docutils literal"><span class="pre">build</span></tt>), the result code
(<tt class="docutils literal"><span class="pre">results</span></tt>), and the BuildMaster status (<tt class="docutils literal"><span class="pre">master_status</span></tt>).  It
returns a dictionary. The <tt class="docutils literal"><span class="pre">body</span></tt> key gives a string that is the complete
text of the message. The <tt class="docutils literal"><span class="pre">type</span></tt> key is the message type ('plain' or
'html'). The 'html' type should be used when generating an HTML message.  The
<tt class="docutils literal"><span class="pre">subject</span></tt> key is optional, but gives the subject for the email.</dd>
<dt><tt class="docutils literal"><span class="pre">extraHeaders</span></tt></dt>
<dd>(dictionary) A dictionary containing key/value pairs of extra headers to add
to sent e-mails. Both the keys and the values may be a <cite>Interpolate</cite> instance.</dd>
</dl>
<p>As a help to those writing <tt class="xref py py-func docutils literal"><span class="pre">messageFormatter</span></tt> functions, the following
table describes how to get some useful pieces of information from the various
status objects:</p>
<dl class="docutils">
<dt>Name of the builder that generated this event</dt>
<dd><tt class="docutils literal"><span class="pre">name</span></tt></dd>
<dt>Name of the project</dt>
<dd><tt class="xref py py-meth docutils literal"><span class="pre">master_status.getProjectName</span></tt></dd>
<dt>MailNotifier mode</dt>
<dd><dl class="first last docutils">
<dt><tt class="docutils literal"><span class="pre">mode</span></tt> (a combination of <tt class="docutils literal"><span class="pre">change</span></tt>, <tt class="docutils literal"><span class="pre">failing</span></tt>, <tt class="docutils literal"><span class="pre">passing</span></tt>, <tt class="docutils literal"><span class="pre">problem</span></tt>, <tt class="docutils literal"><span class="pre">warnings</span></tt>,</dt>
<dd><tt class="docutils literal"><span class="pre">exception</span></tt>, <tt class="docutils literal"><span class="pre">all</span></tt>)</dd>
</dl>
</dd>
</dl>
<p>Builder result as a string</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.builder</span> <span class="kn">import</span> <span class="n">Results</span>
<span class="n">result_str</span> <span class="o">=</span> <span class="n">Results</span><span class="p">[</span><span class="n">results</span><span class="p">]</span>
<span class="c"># one of &#39;success&#39;, &#39;warnings&#39;, &#39;failure&#39;, &#39;skipped&#39;, or &#39;exception&#39;</span>
</pre></div>
</div>
<dl class="docutils">
<dt>URL to build page</dt>
<dd><tt class="docutils literal"><span class="pre">master_status.getURLForThing(build)</span></tt></dd>
<dt>URL to buildbot main page.</dt>
<dd><tt class="docutils literal"><span class="pre">master_status.getBuildbotURL()</span></tt></dd>
<dt>Build text</dt>
<dd><tt class="docutils literal"><span class="pre">build.getText()</span></tt></dd>
<dt>Mapping of property names to values</dt>
<dd><tt class="docutils literal"><span class="pre">build.getProperties()</span></tt> (a <tt class="xref py py-class docutils literal"><span class="pre">Properties</span></tt> instance)</dd>
<dt>Slave name</dt>
<dd><tt class="docutils literal"><span class="pre">build.getSlavename()</span></tt></dd>
<dt>Build reason (from a forced build)</dt>
<dd><tt class="docutils literal"><span class="pre">build.getReason()</span></tt></dd>
<dt>List of responsible users</dt>
<dd><tt class="docutils literal"><span class="pre">build.getResponsibleUsers()</span></tt></dd>
</dl>
<p>Source information (only valid if ss is not <tt class="docutils literal"><span class="pre">None</span></tt>)</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span class="n">ss</span> <span class="o">=</span> <span class="n">build</span><span class="o">.</span><span class="n">getSourceStamp</span><span class="p">()</span>
<span class="k">if</span> <span class="n">ss</span><span class="p">:</span>
    <span class="n">branch</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">branch</span>
    <span class="n">revision</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">revision</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">patch</span>
    <span class="n">changes</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">changes</span> <span class="c"># list</span>
</pre></div>
</div>
<p>A change object has the following useful information:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">who</span></tt></dt>
<dd>(str) who made this change</dd>
<dt><tt class="docutils literal"><span class="pre">revision</span></tt></dt>
<dd>(str) what VC revision is this change</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>(str) on what branch did this change occur</dd>
<dt><tt class="docutils literal"><span class="pre">when</span></tt></dt>
<dd>(str) when did this change occur</dd>
<dt><tt class="docutils literal"><span class="pre">files</span></tt></dt>
<dd>(list of str) what files were affected in this change</dd>
<dt><tt class="docutils literal"><span class="pre">comments</span></tt></dt>
<dd>(str) comments reguarding the change.</dd>
</dl>
<p>The <tt class="docutils literal"><span class="pre">Change</span></tt> methods <tt class="xref py py-meth docutils literal"><span class="pre">asText</span></tt> and <tt class="xref py py-meth docutils literal"><span class="pre">asDict</span></tt> can be used to format the
information above.  <tt class="xref py py-meth docutils literal"><span class="pre">asText</span></tt> returns a list of strings and <tt class="xref py py-meth docutils literal"><span class="pre">asDict</span></tt> returns
a dictonary suitable for html/mail rendering.</p>
</div></blockquote>
<p>Log information</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">logs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">build</span><span class="o">.</span><span class="n">getLogs</span><span class="p">():</span>
    <span class="n">log_name</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">getStep</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">log</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
    <span class="n">log_status</span><span class="p">,</span> <span class="n">dummy</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">getStep</span><span class="p">()</span><span class="o">.</span><span class="n">getResults</span><span class="p">()</span>
    <span class="n">log_body</span> <span class="o">=</span> <span class="n">log</span><span class="o">.</span><span class="n">getText</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="c"># Note: can be VERY LARGE</span>
    <span class="n">log_url</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/steps/</span><span class="si">%s</span><span class="s">/logs/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">master_status</span><span class="o">.</span><span class="n">getURLForThing</span><span class="p">(</span><span class="n">build</span><span class="p">),</span>
                                       <span class="n">log</span><span class="o">.</span><span class="n">getStep</span><span class="p">()</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span>
                                       <span class="n">log</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
    <span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">log_name</span><span class="p">,</span> <span class="n">log_url</span><span class="p">,</span> <span class="n">log_body</span><span class="p">,</span> <span class="n">log_status</span><span class="p">))</span>
</pre></div>
</div>
<span class="target" id="status-IRC"></span></div>
</div>
<div class="section" id="irc-bot">
<span id="index-1"></span><h5>IRC Bot<a class="headerlink" href="#irc-bot" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.status.words.IRC">
<em class="property">class </em><tt class="descclassname">buildbot.status.words.</tt><tt class="descname">IRC</tt><a class="headerlink" href="#buildbot.status.words.IRC" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#buildbot.status.words.IRC" title="buildbot.status.words.IRC"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.status.words.IRC</span></tt></a> status target creates an IRC bot
which will attach to certain channels and be available for status
queries. It can also be asked to announce builds as they occur, or be
told to shut up.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status</span> <span class="kn">import</span> <span class="n">words</span>
<span class="n">irc</span> <span class="o">=</span> <span class="n">words</span><span class="o">.</span><span class="n">IRC</span><span class="p">(</span><span class="s">&quot;irc.example.org&quot;</span><span class="p">,</span> <span class="s">&quot;botnickname&quot;</span><span class="p">,</span>
                <span class="n">useColors</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">channels</span><span class="o">=</span><span class="p">[{</span><span class="s">&quot;channel&quot;</span><span class="p">:</span> <span class="s">&quot;#example1&quot;</span><span class="p">},</span>
                          <span class="p">{</span><span class="s">&quot;channel&quot;</span><span class="p">:</span> <span class="s">&quot;#example2&quot;</span><span class="p">,</span>
                           <span class="s">&quot;password&quot;</span><span class="p">:</span> <span class="s">&quot;somesecretpassword&quot;</span><span class="p">}],</span>
                <span class="n">password</span><span class="o">=</span><span class="s">&quot;mysecretnickservpassword&quot;</span><span class="p">,</span>
                <span class="n">notify_events</span><span class="o">=</span><span class="p">{</span>
                  <span class="s">&#39;exception&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="s">&#39;successToFailure&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="s">&#39;failureToSuccess&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="p">})</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irc</span><span class="p">)</span>
</pre></div>
</div>
<p>Take a look at the docstring for <tt class="xref py py-class docutils literal"><span class="pre">words.IRC</span></tt> for more details on
configuring this service. Note that the <tt class="docutils literal"><span class="pre">useSSL</span></tt> option requires
<a class="reference external" href="http://pyopenssl.sourceforge.net/">PyOpenSSL</a>.  The <tt class="docutils literal"><span class="pre">password</span></tt> argument, if provided, will be sent to
Nickserv to claim the nickname: some IRC servers will not allow clients to send
private messages until they have logged in with a password. We can also specify
a different <tt class="docutils literal"><span class="pre">port</span></tt> number. Default value is 6667.</p>
<p>To use the service, you address messages at the buildbot, either
normally (<tt class="docutils literal"><span class="pre">botnickname:</span> <span class="pre">status</span></tt>) or with private messages
(<tt class="docutils literal"><span class="pre">/msg</span> <span class="pre">botnickname</span> <span class="pre">status</span></tt>). The buildbot will respond in kind.</p>
<p>The bot will add color to some of its messages. This is enabled by default,
you might turn it off with <tt class="docutils literal"><span class="pre">useColors=False</span></tt> argument to words.IRC().</p>
<p>If you issue a command that is currently not available, the buildbot
will respond with an error message. If the <tt class="docutils literal"><span class="pre">noticeOnChannel=True</span></tt>
option was used, error messages will be sent as channel notices instead
of messaging. The default value is <tt class="docutils literal"><span class="pre">noticeOnChannel=False</span></tt>.</p>
<p>Some of the commands currently available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">list</span> <span class="pre">builders</span></tt></dt>
<dd>Emit a list of all configured builders</dd>
<dt><tt class="samp docutils literal"><span class="pre">status</span> <em><span class="pre">BUILDER</span></em></tt></dt>
<dd>Announce the status of a specific Builder: what it is doing right now.</dd>
<dt><tt class="docutils literal"><span class="pre">status</span> <span class="pre">all</span></tt></dt>
<dd>Announce the status of all Builders</dd>
<dt><tt class="samp docutils literal"><span class="pre">watch</span> <em><span class="pre">BUILDER</span></em></tt></dt>
<dd>If the given <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> is currently running, wait until the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> is
finished and then announce the results.</dd>
<dt><tt class="samp docutils literal"><span class="pre">last</span> <em><span class="pre">BUILDER</span></em></tt></dt>
<dd>Return the results of the last build to run on the given <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>.</dd>
<dt><tt class="samp docutils literal"><span class="pre">join</span> <em><span class="pre">CHANNEL</span></em></tt></dt>
<dd>Join the given IRC channel</dd>
<dt><tt class="samp docutils literal"><span class="pre">leave</span> <em><span class="pre">CHANNEL</span></em></tt></dt>
<dd>Leave the given IRC channel</dd>
<dt><tt class="samp docutils literal"><span class="pre">notify</span> <span class="pre">on|off|list</span> <em><span class="pre">EVENT</span></em></tt></dt>
<dd><p class="first">Report events relating to builds.  If the command is issued as a
private message, then the report will be sent back as a private
message to the user who issued the command.  Otherwise, the report
will be sent to the channel.  Available events to be notified are:</p>
<dl class="last docutils">
<dt><tt class="docutils literal"><span class="pre">started</span></tt></dt>
<dd>A build has started</dd>
<dt><tt class="docutils literal"><span class="pre">finished</span></tt></dt>
<dd>A build has finished</dd>
<dt><tt class="docutils literal"><span class="pre">success</span></tt></dt>
<dd>A build finished successfully</dd>
<dt><tt class="docutils literal"><span class="pre">failure</span></tt></dt>
<dd>A build failed</dd>
<dt><tt class="docutils literal"><span class="pre">exception</span></tt></dt>
<dd>A build generated and exception</dd>
<dt><tt class="docutils literal"><span class="pre">xToY</span></tt></dt>
<dd>The previous build was x, but this one is Y, where x and Y are each
one of success, warnings, failure, exception (except Y is
capitalized).  For example: <tt class="docutils literal"><span class="pre">successToFailure</span></tt> will notify if the
previous build was successful, but this one failed</dd>
</dl>
</dd>
<dt><tt class="samp docutils literal"><span class="pre">help</span> <em><span class="pre">COMMAND</span></em></tt></dt>
<dd>Describe a command. Use <strong class="command">help commands</strong> to get a list of known
commands.</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd>Announce the URL of the Buildbot's home page.</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd>Announce the version of this Buildbot.</dd>
</dl>
<p>Additionally, the config file may specify default notification options
as shown in the example earlier.</p>
<p>If the <tt class="docutils literal"><span class="pre">allowForce=True</span></tt> option was used, some addtional commands
will be available:</p>
<dl class="docutils" id="index-2">
<dt><tt class="samp docutils literal"><span class="pre">force</span> <span class="pre">build</span> <span class="pre">[--branch=</span><em><span class="pre">BRANCH</span></em><span class="pre">]</span> <span class="pre">[--revision=</span><em><span class="pre">REVISION</span></em><span class="pre">]</span> <span class="pre">[--props=PROP1=VAL1,PROP2=VAL2...]</span> <em><span class="pre">BUILDER</span></em> <em><span class="pre">REASON</span></em></tt></dt>
<dd>Tell the given <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> to start a build of the latest code. The user
requesting the build and <em>REASON</em> are recorded in the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> status. The
buildbot will announce the build's status when it finishes.The
user can specify a branch and/or revision with the optional
parameters <tt class="samp docutils literal"><span class="pre">--branch=</span><em><span class="pre">BRANCH</span></em></tt> and <tt class="samp docutils literal"><span class="pre">--revision=</span><em><span class="pre">REVISION</span></em></tt>. The user
can also give a list of properties with <tt class="samp docutils literal"><span class="pre">--props=</span><em><span class="pre">PROP1=VAL1,PROP2=VAL2..</span></em></tt>.</dd>
<dt><tt class="samp docutils literal"><span class="pre">stop</span> <span class="pre">build</span> <em><span class="pre">BUILDER</span></em> <em><span class="pre">REASON</span></em></tt></dt>
<dd>Terminate any running build in the given <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>. <em>REASON</em> will be added
to the build status to explain why it was stopped. You might use this
if you committed a bug, corrected it right away, and don't want to
wait for the first build (which is destined to fail) to complete
before starting the second (hopefully fixed) build.</dd>
</dl>
<p>If the <cite>categories</cite> is set to a category of builders (see the categories
option in <a class="reference internal" href="#builder-configuration"><em>Builder Configuration</em></a>) changes related to only that
category of builders will be sent to the channel.</p>
<p>If the <cite>useRevisions</cite> option is set to <cite>True</cite>, the IRC bot will send status messages
that replace the build number with a list of revisions that are contained in that
build. So instead of seeing <cite>build #253 of ...</cite>, you would see something like
<cite>build containing revisions [a87b2c4]</cite>. Revisions that are stored as hashes are
shortened to 7 characters in length, as multiple revisions can be contained in one
build and may exceed the IRC message length limit.</p>
<p>Two additional arguments can be set to control how fast the IRC bot tries to
reconnect when it encounters connection issues. <tt class="docutils literal"><span class="pre">lostDelay</span></tt> is the number of
of seconds the bot will wait to reconnect when the connection is lost, where as
<tt class="docutils literal"><span class="pre">failedDelay</span></tt> is the number of seconds until the bot tries to reconnect when
the connection failed. <tt class="docutils literal"><span class="pre">lostDelay</span></tt> defaults to a random number between 1 and 5,
while <tt class="docutils literal"><span class="pre">failedDelay</span></tt> defaults to a random one between 45 and 60. Setting random
defaults like this means multiple IRC bots are less likely to deny each other
by flooding the server.</p>
</div>
<div class="section" id="pblistener">
<span id="status-PBListener"></span><h5>PBListener<a class="headerlink" href="#pblistener" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.status.client.PBListener">
<em class="property">class </em><tt class="descclassname">buildbot.status.client.</tt><tt class="descname">PBListener</tt><a class="headerlink" href="#buildbot.status.client.PBListener" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">buildbot.status.client</span>
<span class="n">pbl</span> <span class="o">=</span> <span class="n">buildbot</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">PBListener</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
                                        <span class="n">passwd</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pbl</span><span class="p">)</span>
</pre></div>
</div>
<p>This sets up a PB listener on the given TCP port, to which a PB-based
status client can connect and retrieve status information.
<strong class="command">buildbot statusgui</strong> (<a class="reference internal" href="#cmdline-statusgui" title="statusgui"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">statusgui</span></tt></a>) is an example of such a
status client. The <tt class="docutils literal"><span class="pre">port</span></tt> argument can also be a strports
specification string.</p>
</div>
<div class="section" id="statuspush">
<span id="status-StatusPush"></span><h5>StatusPush<a class="headerlink" href="#statuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.status.status_push.StatusPush">
<em class="property">class </em><tt class="descclassname">buildbot.status.status_push.</tt><tt class="descname">StatusPush</tt><a class="headerlink" href="#buildbot.status.status_push.StatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">Process</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="k">print</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">popChunk</span><span class="p">())</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">queueNextServerPush</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">buildbot.status.status_push</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">buildbot</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">status_push</span><span class="o">.</span><span class="n">StatusPush</span><span class="p">(</span><span class="n">serverPushCb</span><span class="o">=</span><span class="n">Process</span><span class="p">,</span>
                                            <span class="n">bufferDelay</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                            <span class="n">retryDelay</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="xref py py-class docutils literal"><span class="pre">StatusPush</span></tt> batches events normally processed and sends it to the
<tt class="xref py py-func docutils literal"><span class="pre">serverPushCb</span></tt> callback every <tt class="docutils literal"><span class="pre">bufferDelay</span></tt> seconds. The callback
should pop items from the queue and then queue the next callback.
If no items were poped from <tt class="docutils literal"><span class="pre">self.queue</span></tt>, <tt class="docutils literal"><span class="pre">retryDelay</span></tt> seconds will be
waited instead.</p>
</div>
<div class="section" id="httpstatuspush">
<span id="status-HttpStatusPush"></span><h5>HttpStatusPush<a class="headerlink" href="#httpstatuspush" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">buildbot.status.status_push</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">buildbot</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">status_push</span><span class="o">.</span><span class="n">HttpStatusPush</span><span class="p">(</span>
        <span class="n">serverUrl</span><span class="o">=</span><span class="s">&quot;http://example.com/submit&quot;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="xref py py-class docutils literal"><span class="pre">HttpStatusPush</span></tt> builds on <tt class="xref py py-class docutils literal"><span class="pre">StatusPush</span></tt> and sends HTTP requests to
<tt class="docutils literal"><span class="pre">serverUrl</span></tt>, with all the items json-encoded. It is useful to create a
status front end outside of buildbot for better scalability.</p>
</div>
<div class="section" id="gerritstatuspush">
<span id="status-GerritStatusPush"></span><h5>GerritStatusPush<a class="headerlink" href="#gerritstatuspush" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.status.status_gerrit.GerritStatusPush">
<em class="property">class </em><tt class="descclassname">buildbot.status.status_gerrit.</tt><tt class="descname">GerritStatusPush</tt><a class="headerlink" href="#buildbot.status.status_gerrit.GerritStatusPush" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.status.status_gerrit</span> <span class="kn">import</span> <span class="n">GerritStatusPush</span>
<span class="kn">from</span> <span class="nn">buildbot.status.builder</span> <span class="kn">import</span> <span class="n">Results</span><span class="p">,</span> <span class="n">SUCCESS</span><span class="p">,</span> <span class="n">RETRY</span>

<span class="k">def</span> <span class="nf">gerritReviewCB</span><span class="p">(</span><span class="n">builderName</span><span class="p">,</span> <span class="n">build</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">RETRY</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="n">message</span> <span class="o">=</span>  <span class="s">&quot;Buildbot finished compiling your patchset</span><span class="se">\n</span><span class="s">&quot;</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;on configuration: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">builderName</span>
    <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;The result is: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">Results</span><span class="p">[</span><span class="n">result</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">arg</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">For more details visit:</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="n">status</span><span class="o">.</span><span class="n">getURLForThing</span><span class="p">(</span><span class="n">build</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>

    <span class="c"># message, verified, reviewed</span>
    <span class="k">return</span> <span class="n">message</span><span class="p">,</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">SUCCESS</span> <span class="ow">or</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span>

<span class="n">c</span><span class="p">[</span><span class="s">&#39;buildbotURL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;http://buildbot.example.com/&#39;</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GerritStatusPush</span><span class="p">(</span><span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="s">&#39;buildbot&#39;</span><span class="p">,</span>
                                    <span class="n">reviewCB</span><span class="o">=</span><span class="n">gerritReviewCB</span><span class="p">,</span>
                                    <span class="n">reviewArg</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="s">&#39;buildbotURL&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>GerritStatusPush sends review of the <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt> back to the Gerrit server.
<tt class="docutils literal"><span class="pre">reviewCB</span></tt> should return a tuple of message, verified, reviewed. If message
is <tt class="docutils literal"><span class="pre">None</span></tt>, no review will be sent.</p>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>Apparently this is the same way <a class="reference external" href="http://buildd.debian.org">http://buildd.debian.org</a> displays build status</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>It may even be possible to provide SSL access by using a
specification like <tt class="docutils literal"><span class="pre">&quot;ssl:12345:privateKey=mykey.pen:certKey=cert.pem&quot;</span></tt>,
but this is completely untested</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<span id="document-manual/customization"></span><div class="section" id="customization">
<span id="id1"></span><h3>Customization<a class="headerlink" href="#customization" title="Permalink to this headline">¶</a></h3>
<p>For advanced users, Buildbot acts as a framework supporting a customized build
application.  For the most part, such configurations consist of subclasses set
up for use in a regular Buildbot configuration file.</p>
<p>This chapter describes some of the more common idioms in advanced Buildbot
configurations.</p>
<p>At the moment, this chapter is an unordered set of suggestions; if you'd like
to clean it up, fork the project on github and get started!</p>
<div class="section" id="programmatic-configuration-generation">
<h4>Programmatic Configuration Generation<a class="headerlink" href="#programmatic-configuration-generation" title="Permalink to this headline">¶</a></h4>
<p>Bearing in mind that <tt class="docutils literal"><span class="pre">master.cfg</span></tt> is a Python file, large configurations can
be shortened considerably by judicious use of Python loops.  For example, the
following will generate a builder for each of a range of supported versions of
Python:</p>
<div class="highlight-python"><pre>pythons = [ 'python2.4', 'python2.5', 'python2.6', 'python2.7',
            'python3.2', python3.3' ]
pytest_slaves = [ "slave%s" % n for n in range(10) ]
for python in pythons:
    f = BuildFactory()
    f.addStep(SVN(..))
    f.addStep(ShellCommand(command=[ python, 'test.py' ]))
    c['builders'].append(BuilderConfig(
            name="test-%s" % python,
            factory=f,
            slavenames=pytest_slaves))</pre>
</div>
</div>
<div class="section" id="merge-request-functions">
<span id="id2"></span><h4>Merge Request Functions<a class="headerlink" href="#merge-request-functions" title="Permalink to this headline">¶</a></h4>
<p id="index-0">The logic Buildbot uses to decide which build request can be merged can be
customized by providing a Python function (a callable) instead of <tt class="docutils literal"><span class="pre">True</span></tt> or
<tt class="docutils literal"><span class="pre">False</span></tt> described in <a class="reference internal" href="#merging-build-requests"><em>Merging Build Requests</em></a>.</p>
<p>The callable will be invoked with three positional arguments: a
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> object and two <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt> objects. It should return
true if the requests can be merged, and False otherwise. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mergeRequests</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">):</span>
    <span class="s">&quot;any requests with the same branch can be merged&quot;</span>
    <span class="k">return</span> <span class="n">req1</span><span class="o">.</span><span class="n">branch</span> <span class="o">==</span> <span class="n">req2</span><span class="o">.</span><span class="n">branch</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;mergeRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mergeRequests</span>
</pre></div>
</div>
<p>In many cases, the details of the <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt>s and <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>s are important.
In this example, only <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>s with the same &quot;reason&quot; are merged; thus
developers forcing builds for different reasons will see distinct builds.  Note
the use of the <tt class="xref py py-func docutils literal"><span class="pre">canBeMergedWith</span></tt> method to access the source stamp
compatibility algorithm.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mergeRequests</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">req1</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">canBeMergedWith</span><span class="p">(</span><span class="n">req2</span><span class="o">.</span><span class="n">source</span><span class="p">)</span> <span class="ow">and</span>  <span class="n">req1</span><span class="o">.</span><span class="n">reason</span> <span class="o">==</span> <span class="n">req2</span><span class="o">.</span><span class="n">reason</span><span class="p">:</span>
       <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;mergeRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mergeRequests</span>
</pre></div>
</div>
<p>If it's necessary to perform some extended operation to determine whether two
requests can be merged, then the <tt class="docutils literal"><span class="pre">mergeRequests</span></tt> callable may return its
result via Deferred.  Note, however, that the number of invocations of the
callable is proportional to the square of the request queue length, so a
long-running callable may cause undesirable delays when the queue length
grows.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mergeRequests</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="n">req1</span><span class="p">,</span> <span class="n">req2</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">gatherResults</span><span class="p">([</span>
        <span class="n">getMergeInfo</span><span class="p">(</span><span class="n">req1</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">revision</span><span class="p">),</span>
        <span class="n">getMergeInfo</span><span class="p">(</span><span class="n">req2</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">revision</span><span class="p">),</span>
    <span class="p">])</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">info1</span><span class="p">,</span> <span class="n">info2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">info1</span> <span class="o">==</span> <span class="n">info2</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">process</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;mergeRequests&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mergeRequests</span>
</pre></div>
</div>
</div>
<div class="section" id="builder-priority-functions">
<span id="id3"></span><h4>Builder Priority Functions<a class="headerlink" href="#builder-priority-functions" title="Permalink to this headline">¶</a></h4>
<p id="index-1">The <a class="reference internal" href="#cfg-prioritizeBuilders" title="prioritizeBuilders"><tt class="xref bb bb-cfg docutils literal"><span class="pre">prioritizeBuilders</span></tt></a> configuration key specifies a function which
is called with two arguments: a <tt class="xref py py-class docutils literal"><span class="pre">BuildMaster</span></tt> and a list of
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> objects.  It should return a list of the same <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>
objects, in the desired order.  It may also remove items from the list if
builds should not be started on those builders. If necessary, this function can
return its results via a Deferred (it is called with <tt class="docutils literal"><span class="pre">maybeDeferred</span></tt>).</p>
<p>A simple <tt class="docutils literal"><span class="pre">prioritizeBuilders</span></tt> implementation might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">prioritizeBuilders</span><span class="p">(</span><span class="n">buildmaster</span><span class="p">,</span> <span class="n">builders</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prioritize builders.  &#39;finalRelease&#39; builds have the highest</span>
<span class="sd">    priority, so they should be built before running tests, or</span>
<span class="sd">    creating builds.&quot;&quot;&quot;</span>
    <span class="n">builderPriorities</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&quot;finalRelease&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">&quot;test&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">&quot;build&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">builders</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">b</span><span class="p">:</span> <span class="n">builderPriorities</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">builders</span>

<span class="n">c</span><span class="p">[</span><span class="s">&#39;prioritizeBuilders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prioritizeBuilders</span>
</pre></div>
</div>
</div>
<div class="section" id="build-priority-functions">
<span id="index-2"></span><span id="id4"></span><h4>Build Priority Functions<a class="headerlink" href="#build-priority-functions" title="Permalink to this headline">¶</a></h4>
<p>When a builder has multiple pending build requests, it uses a <tt class="docutils literal"><span class="pre">nextBuild</span></tt>
function to decide which build it should start first.  This function is given
two parameters: the <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>, and a list of <tt class="xref py py-class docutils literal"><span class="pre">BuildRequest</span></tt>
objects representing pending build requests.</p>
<p>A simple function to prioritize release builds over other builds might look
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">nextBuild</span><span class="p">(</span><span class="n">bldr</span><span class="p">,</span> <span class="n">requests</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">branch</span> <span class="o">==</span> <span class="s">&#39;release&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">r</span>
    <span class="k">return</span> <span class="n">requests</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>If some non-immediate result must be calculated, the <tt class="docutils literal"><span class="pre">nextBuild</span></tt> function can
also return a Deferred:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">nextBuild</span><span class="p">(</span><span class="n">bldr</span><span class="p">,</span> <span class="n">requests</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">get_request_priorities</span><span class="p">(</span><span class="n">requests</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pick</span><span class="p">(</span><span class="n">priorities</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">requests</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">priorities</span><span class="p">,</span> <span class="n">requests</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">pick</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-svnpoller">
<span id="id5"></span><h4>Customizing SVNPoller<a class="headerlink" href="#customizing-svnpoller" title="Permalink to this headline">¶</a></h4>
<p>Each source file that is tracked by a Subversion repository has a
fully-qualified SVN URL in the following form:
<tt class="docutils literal"><span class="pre">({REPOURL})({PROJECT-plus-BRANCH})({FILEPATH})</span></tt>. When you create the
<a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a>, you give it a <tt class="docutils literal"><span class="pre">svnurl</span></tt> value that includes all of the
<tt class="docutils literal"><span class="pre">{REPOURL}</span></tt> and possibly some portion of the
<tt class="docutils literal"><span class="pre">{PROJECT-plus-BRANCH}</span></tt> string. The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> is responsible
for producing Changes that contain a branch name and a <tt class="docutils literal"><span class="pre">{FILEPATH}</span></tt>
(which is relative to the top of a checked-out tree). The details of how these
strings are split up depend upon how your repository names its branches.</p>
<div class="section" id="project-branchname-filepath-repositories">
<h5>PROJECT/BRANCHNAME/FILEPATH repositories<a class="headerlink" href="#project-branchname-filepath-repositories" title="Permalink to this headline">¶</a></h5>
<p>One common layout is to have all the various projects that share a repository
get a single top-level directory each, with <tt class="docutils literal"><span class="pre">branches</span></tt>, <tt class="docutils literal"><span class="pre">tags</span></tt>, and
<tt class="docutils literal"><span class="pre">trunk</span></tt> subdirectories:</p>
<div class="highlight-none"><div class="highlight"><pre>amanda/trunk
      /branches/3_2
               /3_3
      /tags/3_2_1
           /3_2_2
           /3_3_0
</pre></div>
</div>
<p>To set up a <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> that watches the Amanda trunk (and nothing
else), we would use the following, using the default <tt class="docutils literal"><span class="pre">split_file</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">SVNPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span>
   <span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;https://svn.amanda.sourceforge.net/svnroot/amanda/amanda/trunk&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this case, every Change that our <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> produces will have
its branch attribute set to <tt class="docutils literal"><span class="pre">None</span></tt>, to indicate that the Change is on the
trunk.  No other sub-projects or branches will be tracked.</p>
<p>If we want our ChangeSource to follow multiple branches, we have to do
two things. First we have to change our <tt class="docutils literal"><span class="pre">svnurl=</span></tt> argument to
watch more than just <tt class="docutils literal"><span class="pre">amanda/trunk</span></tt>. We will set it to
<tt class="docutils literal"><span class="pre">amanda</span></tt> so that we'll see both the trunk and all the branches.
Second, we have to tell <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> how to split the
<tt class="docutils literal"><span class="pre">({PROJECT-plus-BRANCH})({FILEPATH})</span></tt> strings it gets from the repository
out into <tt class="docutils literal"><span class="pre">({BRANCH})</span></tt> and <tt class="docutils literal"><span class="pre">({FILEPATH})`</span></tt>.</p>
<p>We do the latter by providing a <tt class="docutils literal"><span class="pre">split_file</span></tt> function. This function is
responsible for splitting something like <tt class="docutils literal"><span class="pre">branches/3_3/common-src/amanda.h</span></tt>
into <tt class="docutils literal"><span class="pre">branch='branches/3_3'</span></tt> and <tt class="docutils literal"><span class="pre">filepath='common-src/amanda.h'</span></tt>. The
function is always given a string that names a file relative to the
subdirectory pointed to by the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a>'s <tt class="docutils literal"><span class="pre">svnurl=</span></tt> argument.
It is expected to return a dictionary with at least the <tt class="docutils literal"><span class="pre">path</span></tt> key. The
splitter may optionally set <tt class="docutils literal"><span class="pre">branch</span></tt>, <tt class="docutils literal"><span class="pre">project</span></tt> and <tt class="docutils literal"><span class="pre">repository</span></tt>.
For backwards compatibility it may return a tuple of <tt class="docutils literal"><span class="pre">(branchname,</span> <span class="pre">path)</span></tt>.
It may also return <tt class="docutils literal"><span class="pre">None</span></tt> to indicate that the file is of no interest.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the function should return <tt class="docutils literal"><span class="pre">branches/3_3</span></tt> rather than just <tt class="docutils literal"><span class="pre">3_3</span></tt>
because the SVN checkout step, will append the branch name to the
<tt class="docutils literal"><span class="pre">baseURL</span></tt>, which requires that we keep the <tt class="docutils literal"><span class="pre">branches</span></tt> component in
there. Other VC schemes use a different approach towards branches and may
not require this artifact.</p>
</div>
<p>If your repository uses this same <tt class="docutils literal"><span class="pre">{PROJECT}/{BRANCH}/{FILEPATH}</span></tt> naming
scheme, the following function will work:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">split_file_branches</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">pieces</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;trunk&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pieces</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;branches&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span>
                <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">[</span><span class="mi">2</span><span class="p">:]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
<p>In fact, this is the definition of the provided <tt class="docutils literal"><span class="pre">split_file_branches</span></tt>
function.  So to have our Twisted-watching <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> follow
multiple branches, we would use this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">SVNPoller</span><span class="p">,</span> <span class="n">split_file_branches</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span><span class="s">&quot;svn://svn.twistedmatrix.com/svn/Twisted&quot;</span><span class="p">,</span>
                               <span class="n">split_file</span><span class="o">=</span><span class="n">split_file_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>Changes for all sorts of branches (with names like <tt class="docutils literal"><span class="pre">&quot;branches/1.5.x&quot;</span></tt>, and
<tt class="docutils literal"><span class="pre">None</span></tt> to indicate the trunk) will be delivered to the Schedulers.  Each
Scheduler is then free to use or ignore each branch as it sees fit.</p>
<p>If you have multiple projects in the same repository your split function can
attach a project name to the Change to help the Scheduler filter out unwanted
changes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">split_file_branches</span>
<span class="k">def</span> <span class="nf">split_file_projects_branches</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">project</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">split_file_branches</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">project</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">info</span><span class="p">[</span><span class="s">&#39;branch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">info</span>
    <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
<p>Again, this is provided by default. To use it you would do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">SVNPoller</span><span class="p">,</span> <span class="n">split_file_projects_branches</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span>
   <span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;https://svn.amanda.sourceforge.net/svnroot/amanda/&quot;</span><span class="p">,</span>
   <span class="n">split_file</span><span class="o">=</span><span class="n">split_file_projects_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>Note here that we are monitoring at the root of the repository, and that within
that repository is a <tt class="docutils literal"><span class="pre">amanda</span></tt> subdirectory which in turn has <tt class="docutils literal"><span class="pre">trunk</span></tt> and
<tt class="docutils literal"><span class="pre">branches</span></tt>. It is that <tt class="docutils literal"><span class="pre">amanda</span></tt> subdirectory whose name becomes the
<tt class="docutils literal"><span class="pre">project</span></tt> field of the Change.</p>
</div>
<div class="section" id="branchname-project-filepath-repositories">
<h5>BRANCHNAME/PROJECT/FILEPATH repositories<a class="headerlink" href="#branchname-project-filepath-repositories" title="Permalink to this headline">¶</a></h5>
<p>Another common way to organize a Subversion repository is to put the branch
name at the top, and the projects underneath. This is especially frequent when
there are a number of related sub-projects that all get released in a group.</p>
<p>For example, <a class="reference external" href="http://Divmod.org">Divmod.org</a> hosts a project named <cite>Nevow</cite> as
well as one named <cite>Quotient</cite>. In a checked-out Nevow tree there is a directory
named <cite>formless</cite> that contains a python source file named <tt class="file docutils literal"><span class="pre">webform.py</span></tt>.
This repository is accessible via webdav (and thus uses an <cite>http:</cite> scheme)
through the divmod.org hostname. There are many branches in this repository,
and they use a <tt class="docutils literal"><span class="pre">({BRANCHNAME})/({PROJECT})</span></tt> naming policy.</p>
<p>The fully-qualified SVN URL for the trunk version of <tt class="file docutils literal"><span class="pre">webform.py</span></tt> is
<tt class="docutils literal"><span class="pre">http://divmod.org/svn/Divmod/trunk/Nevow/formless/webform.py</span></tt>.
The 1.5.x branch version of this file would have a URL of
<tt class="docutils literal"><span class="pre">http://divmod.org/svn/Divmod/branches/1.5.x/Nevow/formless/webform.py</span></tt>.
The whole Nevow trunk would be checked out with
<tt class="docutils literal"><span class="pre">http://divmod.org/svn/Divmod/trunk/Nevow</span></tt>, while the Quotient
trunk would be checked out using
<tt class="docutils literal"><span class="pre">http://divmod.org/svn/Divmod/trunk/Quotient</span></tt>.</p>
<p>Now suppose we want to have an <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> that only cares about the
Nevow trunk. This case looks just like the <tt class="docutils literal"><span class="pre">{PROJECT}/{BRANCH}</span></tt> layout
described earlier:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">SVNPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span><span class="s">&quot;http://divmod.org/svn/Divmod/trunk/Nevow&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>But what happens when we want to track multiple Nevow branches? We
have to point our <tt class="docutils literal"><span class="pre">svnurl=</span></tt> high enough to see all those
branches, but we also don't want to include Quotient changes (since
we're only building Nevow). To accomplish this, we must rely upon the
<tt class="docutils literal"><span class="pre">split_file</span></tt> function to help us tell the difference between
files that belong to Nevow and those that belong to Quotient, as well
as figuring out which branch each one is on.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.changes.svnpoller</span> <span class="kn">import</span> <span class="n">SVNPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SVNPoller</span><span class="p">(</span><span class="s">&quot;http://divmod.org/svn/Divmod&quot;</span><span class="p">,</span>
                               <span class="n">split_file</span><span class="o">=</span><span class="n">my_file_splitter</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">my_file_splitter</span></tt> function will be called with repository-relative
pathnames like:</p>
<dl class="docutils">
<dt><tt class="file docutils literal"><span class="pre">trunk/Nevow/formless/webform.py</span></tt></dt>
<dd>This is a Nevow file, on the trunk. We want the Change that includes this
to see a filename of <tt class="file docutils literal"><span class="pre">formless/webform.py</span></tt>, and a branch of
<tt class="docutils literal"><span class="pre">None</span></tt></dd>
<dt><tt class="file docutils literal"><span class="pre">branches/1.5.x/Nevow/formless/webform.py</span></tt></dt>
<dd>This is a Nevow file, on a branch. We want to get
<tt class="docutils literal"><span class="pre">branch='branches/1.5.x'</span></tt> and <tt class="docutils literal"><span class="pre">filename='formless/webform.py'</span></tt>.</dd>
<dt><tt class="file docutils literal"><span class="pre">trunk/Quotient/setup.py</span></tt></dt>
<dd>This is a Quotient file, so we want to ignore it by having
<tt class="xref py py-meth docutils literal"><span class="pre">my_file_splitter</span></tt> return <tt class="docutils literal"><span class="pre">None</span></tt>.</dd>
<dt><tt class="file docutils literal"><span class="pre">branches/1.5.x/Quotient/setup.py</span></tt></dt>
<dd>This is also a Quotient file, which should be ignored.</dd>
</dl>
<p>The following definition for <tt class="xref py py-meth docutils literal"><span class="pre">my_file_splitter</span></tt> will do the job:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">my_file_splitter</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">pieces</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;trunk&#39;</span><span class="p">:</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">pieces</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># remove &#39;trunk&#39;</span>
    <span class="k">elif</span> <span class="n">pieces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;branches&#39;</span><span class="p">:</span>
        <span class="n">pieces</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c"># remove &#39;branches&#39;</span>
        <span class="c"># grab branch name</span>
        <span class="n">branch</span> <span class="o">=</span> <span class="s">&#39;branches/&#39;</span> <span class="o">+</span> <span class="n">pieces</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="c"># something weird</span>
    <span class="n">projectname</span> <span class="o">=</span> <span class="n">pieces</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">projectname</span> <span class="o">!=</span> <span class="s">&#39;Nevow&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span> <span class="c"># wrong project</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">branc</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">))</span>
</pre></div>
</div>
<p>If you later decide you want to get changes for Quotient as well you could
replace the last 3 lines with simply:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">project</span><span class="o">=</span><span class="n">projectname</span><span class="p">,</span> <span class="n">branch</span><span class="o">=</span><span class="n">branch</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pieces</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="writing-change-sources">
<span id="id6"></span><h4>Writing Change Sources<a class="headerlink" href="#writing-change-sources" title="Permalink to this headline">¶</a></h4>
<p>For some version-control systems, making Bulidbot aware of new changes can be a
challenge.  If the pre-supplied classes in <a class="reference internal" href="#change-sources"><em>Change Sources</em></a> are not
sufficient, then you will need to write your own.</p>
<p>There are three approaches, one of which is not even a change source.
The first option is to write a change source that exposes some service to
which the version control system can &quot;push&quot; changes.  This can be more
complicated, since it requires implementing a new service, but delivers changes
to Buildbot immediately on commit.</p>
<p>The second option is often preferable to the first: implement a notification
service in an external process (perhaps one that is started directly by the
version control system, or by an email server) and delivers changes to Buildbot
via <a class="reference internal" href="#pbchangesource"><em>PBChangeSource</em></a>.  This section does not describe this particular
approach, since it requires no customization within the buildmaster process.</p>
<p>The third option is to write a change source which polls for changes -
repeatedly connecting to an external service to check for new changes.  This
works well in many cases, but can produce a high load on the version control
system if polling is too frequent, and can take too long to notice changes if
the polling is not frequent enough.</p>
<div class="section" id="writing-a-notification-based-change-source">
<h5>Writing a Notification-based Change Source<a class="headerlink" href="#writing-a-notification-based-change-source" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.base.ChangeSource">
<em class="property">class </em><tt class="descclassname">buildbot.changes.base.</tt><tt class="descname">ChangeSource</tt><a class="headerlink" href="#buildbot.changes.base.ChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>A custom change source must implement
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.interfaces.IChangeSource</span></tt>.</p>
<p>The easiest way to do this is to subclass
<a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.changes.base.ChangeSource</span></tt></a>, implementing the <tt class="xref py py-meth docutils literal"><span class="pre">describe</span></tt>
method to describe the instance. <tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt> is a Twisted service, so
you will need to implement the <tt class="xref py py-meth docutils literal"><span class="pre">startService</span></tt> and <tt class="xref py py-meth docutils literal"><span class="pre">stopService</span></tt>
methods to control the means by which your change source receives
notifications.</p>
<p>When the class does receive a change, it should call
<tt class="docutils literal"><span class="pre">self.master.addChange(..)</span></tt> to submit it to the buildmaster.  This method
shares the same parameters as <tt class="docutils literal"><span class="pre">master.db.changes.addChange</span></tt>, so consult the
API documentation for that function for details on the available arguments.</p>
<p>You will probably also want to set <tt class="docutils literal"><span class="pre">compare_attrs</span></tt> to the list of object
attributes which Buildbot will use to compare one change source to another when
reconfiguring.  During reconfiguration, if the new change source is different
from the old, then the old will be stopped and the new started.</p>
</div>
<div class="section" id="writing-a-change-poller">
<h5>Writing a Change Poller<a class="headerlink" href="#writing-a-change-poller" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.changes.base.PollingChangeSource">
<em class="property">class </em><tt class="descclassname">buildbot.changes.base.</tt><tt class="descname">PollingChangeSource</tt><a class="headerlink" href="#buildbot.changes.base.PollingChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Polling is a very common means of seeking changes, so Buildbot supplies a
utility parent class to make it easier.  A poller should subclass
<a class="reference internal" href="#buildbot.changes.base.PollingChangeSource" title="buildbot.changes.base.PollingChangeSource"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.changes.base.PollingChangeSource</span></tt></a>, which is a subclass of
<tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt>.  This subclass implements the <tt class="xref py py-meth docutils literal"><span class="pre">Service</span></tt> methods,
and causes the <tt class="xref py py-meth docutils literal"><span class="pre">poll</span></tt> method to be called every <tt class="docutils literal"><span class="pre">self.pollInterval</span></tt>
seconds.  This method should return a Deferred to signal its completion.</p>
<p>Aside from the service methods, the other concerns in the previous section
apply here, too.</p>
</div>
</div>
<div class="section" id="writing-a-new-latent-buildslave-implementation">
<h4>Writing a New Latent Buildslave Implementation<a class="headerlink" href="#writing-a-new-latent-buildslave-implementation" title="Permalink to this headline">¶</a></h4>
<p>Writing a new latent buildslave should only require subclassing
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.buildslave.AbstractLatentBuildSlave</span></tt> and implementing
<tt class="xref py py-meth docutils literal"><span class="pre">start_instance</span></tt> and <tt class="xref py py-meth docutils literal"><span class="pre">stop_instance</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">start_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c"># responsible for starting instance that will try to connect with this</span>
    <span class="c"># master. Should return deferred. Problems should use an errback. The</span>
    <span class="c"># callback value can be None, or can be an iterable of short strings to</span>
    <span class="c"># include in the &quot;substantiate success&quot; status message, such as</span>
    <span class="c"># identifying the instance that started.</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<span class="k">def</span> <span class="nf">stop_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="c"># responsible for shutting down instance. Return a deferred. If `fast`,</span>
    <span class="c"># we&#39;re trying to shut the master down, so callback as soon as is safe.</span>
    <span class="c"># Callback value is ignored.</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</pre></div>
</div>
<p>See <tt class="xref py py-class docutils literal"><span class="pre">buildbot.ec2buildslave.EC2LatentBuildSlave</span></tt> for an example, or see
the test example <tt class="xref py py-class docutils literal"><span class="pre">buildbot.test_slaves.FakeLatentBuildSlave</span></tt>.</p>
</div>
<div class="section" id="custom-build-classes">
<h4>Custom Build Classes<a class="headerlink" href="#custom-build-classes" title="Permalink to this headline">¶</a></h4>
<p>The standard <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt> object creates <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> objects
by default. These Builds will each execute a collection of <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s
in a fixed sequence. Each step can affect the results of the build,
but in general there is little intelligence to tie the different steps
together.</p>
<p>By setting the factory's <tt class="docutils literal"><span class="pre">buildClass</span></tt> attribute to a different class, you can
instantiate a different build class.  This might be useful, for example, to
create a build class that dynamically determines which steps to run.  The
skeleton of such a project would look like:</p>
<div class="highlight-python"><pre>class DynamicBuild(Build):
    # .. override some methods

f = factory.BuildFactory()
f.buildClass = DynamicBuild
f.addStep(...)</pre>
</div>
</div>
<div class="section" id="factory-workdir-functions">
<span id="id7"></span><h4>Factory Workdir Functions<a class="headerlink" href="#factory-workdir-functions" title="Permalink to this headline">¶</a></h4>
<p>It is sometimes helpful to have a build's workdir determined at runtime based
on the parameters of the build.  To accomplish this, set the <tt class="docutils literal"><span class="pre">workdir</span></tt>
attribute of the build factory to a callable.  That callable will be invoked
with the <tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt> for the build, and should return the appropriate
workdir.  Note that the value must be returned immediately - Deferreds are not
supported.</p>
<p>This can be useful, for exmaple, in scenarios with multiple repositories
submitting changes to BuildBot. In this case you likely will want to have a
dedicated workdir per repository, since otherwise a sourcing step with mode =
&quot;update&quot; will fail as a workdir with a working copy of repository A can't be
&quot;updated&quot; for changes from a repository B. Here is an example how you can
achive workdir-per-repo:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">workdir</span><span class="p">(</span><span class="n">source_stamp</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span> <span class="p">(</span><span class="n">source_stamp</span><span class="o">.</span><span class="n">repository</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>

<span class="n">build_factory</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">build_factory</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span> <span class="n">workdir</span>

<span class="n">build_factory</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Git</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s">&quot;update&quot;</span><span class="p">))</span>
<span class="c"># ...</span>
<span class="n">builders</span><span class="o">.</span><span class="n">append</span> <span class="p">({</span><span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;mybuilder&#39;</span><span class="p">,</span>
                  <span class="s">&#39;slavename&#39;</span><span class="p">:</span> <span class="s">&#39;myslave&#39;</span><span class="p">,</span>
                  <span class="s">&#39;builddir&#39;</span><span class="p">:</span> <span class="s">&#39;mybuilder&#39;</span><span class="p">,</span>
                  <span class="s">&#39;factory&#39;</span><span class="p">:</span> <span class="n">build_factory</span><span class="p">})</span>
</pre></div>
</div>
<p>The end result is a set of workdirs like</p>
<div class="highlight-none"><div class="highlight"><pre>Repo1 =&gt; &lt;buildslave-base&gt;/mybuilder/a78890ba
Repo2 =&gt; &lt;buildslave-base&gt;/mybuilder/0823ba88
</pre></div>
</div>
<p>You could make the <tt class="xref py py-func docutils literal"><span class="pre">workdir</span></tt> function compute other paths, based on
parts of the repo URL in the sourcestamp, or lookup in a lookup table
based on repo URL. As long as there is a permanent 1:1 mapping between
repos and workdir, this will work.</p>
</div>
<div class="section" id="writing-new-buildsteps">
<h4>Writing New BuildSteps<a class="headerlink" href="#writing-new-buildsteps" title="Permalink to this headline">¶</a></h4>
<p>While it is a good idea to keep your build process self-contained in the source code tree, sometimes it is convenient to put more intelligence into your Buildbot configuration.
One way to do this is to write a custom <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>.
Once written, this Step can be used in the <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> file.</p>
<p>The best reason for writing a custom <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> is to better parse the results of the command being run.
For example, a <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> that knows about JUnit could look at the logfiles to determine which tests had been run, how many passed and how many failed, and then report more detailed information than a simple <tt class="docutils literal"><span class="pre">rc==0</span></tt> -based <cite>good/bad</cite> decision.</p>
<p>Buildbot has acquired a large fleet of build steps, and sports a number of knobs and hooks to make steps easier to write.
This section may seem a bit overwhelming, but most custom steps will only need to apply one or two of the techniques outlined here.</p>
<p>For complete documentation of the build step interfaces, see <a class="reference internal" href="#document-developer/cls-buildsteps"><em>BuildSteps</em></a>.</p>
<div class="section" id="writing-buildstep-constructors">
<span id="id8"></span><h5>Writing BuildStep Constructors<a class="headerlink" href="#writing-buildstep-constructors" title="Permalink to this headline">¶</a></h5>
<p>Build steps act as their own factories, so their constructors are a bit more complex than necessary.
In the configuration file, a <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt></a> object is instantiated, but because steps store state locally while executing, this object cannot be used during builds.</p>
<p>Consider the use of a <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> in <tt class="file docutils literal"><span class="pre">master.cfg</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">MyStep</span><span class="p">(</span><span class="n">someopt</span><span class="o">=</span><span class="s">&quot;stuff&quot;</span><span class="p">,</span> <span class="n">anotheropt</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>This creates a single instance of class <tt class="docutils literal"><span class="pre">MyStep</span></tt>.
However, Buildbot needs a new object each time the step is executed.
An instance of <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt></a> rembers how it was constructed, and can create copies of itself.
When writing a new step class, then, keep in mind are that you cannot do anything &quot;interesting&quot; in the constructor -- limit yourself to checking and storing arguments.</p>
<p>It is customary to call the parent class's constructor with all otherwise-unspecified keyword arguments.
Keep a <tt class="docutils literal"><span class="pre">**kwargs</span></tt> argument on the end of your options, and pass that up to the parent class's constructor.</p>
<p>The whole thing looks like this:</p>
<div class="highlight-python"><pre>class Frobnify(LoggingBuildStep):
    def __init__(self,
            frob_what="frobee",
            frob_how_many=None,
            frob_how=None,
            **kwargs):

        # check
        if frob_how_many is None:
            raise TypeError("Frobnify argument how_many is required")

        # override a parent option
        kwargs['parentOpt'] = 'xyz'

        # call parent
        LoggingBuildStep.__init__(self, **kwargs)

        # set Frobnify attributes
        self.frob_what = frob_what
        self.frob_how_many = how_many
        self.frob_how = frob_how

class FastFrobnify(Frobnify):
    def __init__(self,
            speed=5,
            **kwargs)
        Frobnify.__init__(self, **kwargs)
        self.speed = speed</pre>
</div>
</div>
<div class="section" id="running-commands">
<h5>Running Commands<a class="headerlink" href="#running-commands" title="Permalink to this headline">¶</a></h5>
<p>To spawn a command in the buildslave, create a <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand" title="buildbot.process.buildstep.RemoteCommand"><tt class="xref py py-class docutils literal"><span class="pre">RemoteCommand</span></tt></a> instance in your step's <tt class="docutils literal"><span class="pre">start</span></tt> method and run it with <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.runCommand" title="buildbot.process.buildstep.BuildStep.runCommand"><tt class="xref py py-meth docutils literal"><span class="pre">runCommand</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cmd</span> <span class="o">=</span> <span class="n">RemoteCommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
</pre></div>
</div>
<p>To add a LogFile, use <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addLog" title="buildbot.process.buildstep.BuildStep.addLog"><tt class="xref py py-meth docutils literal"><span class="pre">addLog</span></tt></a>.
Make sure the log gets closed when it finishes.
When giving a Logfile to a <a class="reference internal" href="#buildbot.process.buildstep.RemoteShellCommand" title="buildbot.process.buildstep.RemoteShellCommand"><tt class="xref py py-class docutils literal"><span class="pre">RemoteShellCommand</span></tt></a>, just ask it to close the log when the command completes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">log</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addLog</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">)</span>
<span class="n">cmd</span><span class="o">.</span><span class="n">useLog</span><span class="p">(</span><span class="n">log</span><span class="p">,</span> <span class="n">closeWhenFinished</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="updating-status">
<h5>Updating Status<a class="headerlink" href="#updating-status" title="Permalink to this headline">¶</a></h5>
<p>TBD</p>
</div>
<div class="section" id="capturing-logfiles">
<h5>Capturing Logfiles<a class="headerlink" href="#capturing-logfiles" title="Permalink to this headline">¶</a></h5>
<p>Each BuildStep has a collection of <cite>logfiles</cite>. Each one has a short
name, like <cite>stdio</cite> or <cite>warnings</cite>. Each <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> contains an
arbitrary amount of text, usually the contents of some output file
generated during a build or test step, or a record of everything that
was printed to <tt class="file docutils literal"><span class="pre">stdout</span></tt>/<tt class="file docutils literal"><span class="pre">stderr</span></tt> during the execution of some command.</p>
<p>These <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>s are stored to disk, so they can be retrieved later.</p>
<p>Each can contain multiple <cite>channels</cite>, generally limited to three
basic ones: stdout, stderr, and <cite>headers</cite>. For example, when a
ShellCommand runs, it writes a few lines to the <cite>headers</cite> channel to
indicate the exact argv strings being run, which directory the command
is being executed in, and the contents of the current environment
variables. Then, as the command runs, it adds a lot of <tt class="file docutils literal"><span class="pre">stdout</span></tt> and
<tt class="file docutils literal"><span class="pre">stderr</span></tt> messages. When the command finishes, a final <cite>header</cite>
line is added with the exit code of the process.</p>
<p>Status display plugins can format these different channels in
different ways. For example, the web page shows LogFiles as text/html,
with header lines in blue text, stdout in black, and stderr in red. A
different URL is available which provides a text/plain format, in
which stdout and stderr are collapsed together, and header lines are
stripped completely. This latter option makes it easy to save the
results to a file and run <strong class="command">grep</strong> or whatever against the
output.</p>
<p>Each <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> contains a mapping (implemented in a python dictionary)
from <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> name to the actual <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> objects. Status plugins can
get a list of LogFiles to display, for example, a list of HREF links
that, when clicked, provide the full contents of the <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>.</p>
<div class="section" id="using-logfiles-in-custom-buildsteps">
<h6>Using LogFiles in custom BuildSteps<a class="headerlink" href="#using-logfiles-in-custom-buildsteps" title="Permalink to this headline">¶</a></h6>
<p>The most common way for a custom <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> to use a <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> is to
summarize the results of a <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a> (after the command has
finished running). For example, a compile step with thousands of lines
of output might want to create a summary of just the warning messages.
If you were doing this from a shell, you would use something like:</p>
<div class="highlight-bash"><div class="highlight"><pre>grep <span class="s2">&quot;warning:&quot;</span> output.log &gt;warnings.log
</pre></div>
</div>
<p>In a custom BuildStep, you could instead create a <tt class="docutils literal"><span class="pre">warnings</span></tt> <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>
that contained the same text. To do this, you would add code to your
<tt class="xref py py-meth docutils literal"><span class="pre">createSummary</span></tt> method that pulls lines from the main output log
and creates a new <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> with the results:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">createSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">getText</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sio</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="k">if</span> <span class="s">&quot;warning:&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">addCompleteLog</span><span class="p">(</span><span class="s">&#39;warnings&#39;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">warnings</span><span class="p">))</span>
</pre></div>
</div>
<p>This example uses the <tt class="xref py py-meth docutils literal"><span class="pre">addCompleteLog</span></tt> method, which creates a
new <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>, puts some text in it, and then <cite>closes</cite> it, meaning
that no further contents will be added. This <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> will appear in
the HTML display under an HREF with the name <cite>warnings</cite>, since that
is the name of the <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>.</p>
<p>You can also use <tt class="xref py py-meth docutils literal"><span class="pre">addHTMLLog</span></tt> to create a complete (closed)
<tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> that contains HTML instead of plain text. The normal <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>
will be HTML-escaped if presented through a web page, but the HTML
<tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> will not. At the moment this is only used to present a pretty
HTML representation of an otherwise ugly exception traceback when
something goes badly wrong during the <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>.</p>
<p>In contrast, you might want to create a new <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> at the beginning
of the step, and add text to it as the command runs. You can create
the <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> and attach it to the build by calling <tt class="xref py py-meth docutils literal"><span class="pre">addLog</span></tt>, which
returns the <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> object. You then add text to this <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> by
calling methods like <tt class="xref py py-meth docutils literal"><span class="pre">addStdout</span></tt> and <tt class="xref py py-meth docutils literal"><span class="pre">addHeader</span></tt>. When you
are done, you must call the <tt class="xref py py-meth docutils literal"><span class="pre">finish</span></tt> method so the <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> can be
closed. It may be useful to create and populate a <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> like this
from a <tt class="xref py py-class docutils literal"><span class="pre">LogObserver</span></tt> method - see <a class="reference internal" href="#adding-logobservers"><em>Adding LogObservers</em></a>.</p>
<p>The <tt class="docutils literal"><span class="pre">logfiles=</span></tt> argument to <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a> (see
<a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>) creates new <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>s and fills them in realtime
by asking the buildslave to watch a actual file on disk. The
buildslave will look for additions in the target file and report them
back to the <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>. These additions will be added to the <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt> by
calling <tt class="xref py py-meth docutils literal"><span class="pre">addStdout</span></tt>. These secondary LogFiles can be used as the
source of a LogObserver just like the normal <tt class="file docutils literal"><span class="pre">stdio</span></tt> <tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt>.</p>
</div>
</div>
<div class="section" id="reading-logfiles">
<h5>Reading Logfiles<a class="headerlink" href="#reading-logfiles" title="Permalink to this headline">¶</a></h5>
<p>Once a <a class="reference internal" href="#buildbot.status.logfile.LogFile" title="buildbot.status.logfile.LogFile"><tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt></a> has been added to a
<a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt></a> with
<a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addLog" title="buildbot.process.buildstep.BuildStep.addLog"><tt class="xref py py-meth docutils literal"><span class="pre">addLog</span></tt></a>,
<a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><tt class="xref py py-meth docutils literal"><span class="pre">addCompleteLog</span></tt></a>,
<a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addHTMLLog" title="buildbot.process.buildstep.BuildStep.addHTMLLog"><tt class="xref py py-meth docutils literal"><span class="pre">addHTMLLog</span></tt></a>, or <tt class="docutils literal"><span class="pre">logfiles={}</span></tt>,
your <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> can retrieve it
by using <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.getLog" title="buildbot.process.buildstep.BuildStep.getLog"><tt class="xref py py-meth docutils literal"><span class="pre">getLog</span></tt></a>:</p>
<div class="highlight-python"><pre>class MyBuildStep(ShellCommand):
    logfiles = @{ "nodelog": "_test/node.log" @}

    def evaluateCommand(self, cmd):
        nodelog = self.getLog("nodelog")
        if "STARTED" in nodelog.getText():
            return SUCCESS
        else:
            return FAILURE</pre>
</div>
</div>
<div class="section" id="adding-logobservers">
<span id="id9"></span><h5>Adding LogObservers<a class="headerlink" href="#adding-logobservers" title="Permalink to this headline">¶</a></h5>
<p>Most shell commands emit messages to stdout or stderr as they operate,
especially if you ask them nicely with a <em class="xref std std-option">--verbose</em> flag of some
sort. They may also write text to a log file while they run. Your
<tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> can watch this output as it arrives, to keep track of how
much progress the command has made. You can get a better measure of
progress by counting the number of source files compiled or test cases
run than by merely tracking the number of bytes that have been written
to stdout. This improves the accuracy and the smoothness of the ETA
display.</p>
<p>To accomplish this, you will need to attach a <tt class="xref py py-class docutils literal"><span class="pre">LogObserver</span></tt> to
one of the log channels, most commonly to the <tt class="file docutils literal"><span class="pre">stdio</span></tt> channel but
perhaps to another one which tracks a log file. This observer is given
all text as it is emitted from the command, and has the opportunity to
parse that output incrementally. Once the observer has decided that
some event has occurred (like a source file being compiled), it can
use the <tt class="xref py py-meth docutils literal"><span class="pre">setProgress</span></tt> method to tell the <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> about the
progress that this event represents.</p>
<p>There are a number of pre-built <tt class="xref py py-class docutils literal"><span class="pre">LogObserver</span></tt> classes that you
can choose from (defined in <a class="reference internal" href="#module-buildbot.process.buildstep" title="buildbot.process.buildstep"><tt class="xref py py-mod docutils literal"><span class="pre">buildbot.process.buildstep</span></tt></a>, and of
course you can subclass them to add further customization. The
<tt class="xref py py-class docutils literal"><span class="pre">LogLineObserver</span></tt> class handles the grunt work of buffering and
scanning for end-of-line delimiters, allowing your parser to operate
on complete <tt class="file docutils literal"><span class="pre">stdout</span></tt>/<tt class="file docutils literal"><span class="pre">stderr</span></tt> lines. (Lines longer than a set maximum
length are dropped; the maximum defaults to 16384 bytes, but you can
change it by calling <tt class="xref py py-meth docutils literal"><span class="pre">setMaxLineLength</span></tt> on your
<tt class="xref py py-class docutils literal"><span class="pre">LogLineObserver</span></tt> instance.  Use <tt class="docutils literal"><span class="pre">sys.maxint</span></tt> for effective
infinity.)</p>
<p>For example, let's take a look at the <tt class="xref py py-class docutils literal"><span class="pre">TrialTestCaseCounter</span></tt>,
which is used by the <a class="reference internal" href="#step-Trial" title="Trial"><tt class="xref bb bb-step docutils literal"><span class="pre">Trial</span></tt></a> step to count test cases as they are run.
As Trial executes, it emits lines like the following:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot.test.test_config.ConfigTest.testDebugPassword ... [OK]
buildbot.test.test_config.ConfigTest.testEmpty ... [OK]
buildbot.test.test_config.ConfigTest.testIRC ... [FAIL]
buildbot.test.test_config.ConfigTest.testLocks ... [OK]
</pre></div>
</div>
<p>When the tests are finished, trial emits a long line of <cite>======</cite> and
then some lines which summarize the tests that failed. We want to
avoid parsing these trailing lines, because their format is less
well-defined than the <cite>[OK]</cite> lines.</p>
<p>The parser class looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.buildstep</span> <span class="kn">import</span> <span class="n">LogLineObserver</span>

<span class="k">class</span> <span class="nc">TrialTestCaseCounter</span><span class="p">(</span><span class="n">LogLineObserver</span><span class="p">):</span>
    <span class="n">_line_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^([\w\.]+) \.\.\. \[([^\]]+)\]$&#39;</span><span class="p">)</span>
    <span class="n">numTests</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">outLineReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">return</span>

        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_line_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">testname</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">numTests</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="o">.</span><span class="n">setProgress</span><span class="p">(</span><span class="s">&#39;tests&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">numTests</span><span class="p">)</span>
</pre></div>
</div>
<p>This parser only pays attention to stdout, since that's where trial
writes the progress lines. It has a mode flag named <tt class="docutils literal"><span class="pre">finished</span></tt> to
ignore everything after the <tt class="docutils literal"><span class="pre">====</span></tt> marker, and a scary-looking
regular expression to match each line while hopefully ignoring other
messages that might get displayed as the test runs.</p>
<p>Each time it identifies a test has been completed, it increments its
counter and delivers the new progress value to the step with
&#64;code{self.step.setProgress}. This class is specifically measuring
progress along the <cite>tests</cite> metric, in units of test cases (as
opposed to other kinds of progress like the <cite>output</cite> metric, which
measures in units of bytes). The Progress-tracking code uses each
progress metric separately to come up with an overall completion
percentage and an ETA value.</p>
<p>To connect this parser into the <a class="reference internal" href="#step-Trial" title="Trial"><tt class="xref bb bb-step docutils literal"><span class="pre">Trial</span></tt></a> build step,
<tt class="docutils literal"><span class="pre">Trial.__init__</span></tt> ends with the following clause:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># this counter will feed Progress along the &#39;test cases&#39; metric</span>
<span class="n">counter</span> <span class="o">=</span> <span class="n">TrialTestCaseCounter</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">addLogObserver</span><span class="p">(</span><span class="s">&#39;stdio&#39;</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">progressMetrics</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39;tests&#39;</span><span class="p">,)</span>
</pre></div>
</div>
<p>This creates a <tt class="xref py py-class docutils literal"><span class="pre">TrialTestCaseCounter</span></tt> and tells the step that the
counter wants to watch the <tt class="file docutils literal"><span class="pre">stdio</span></tt> log. The observer is
automatically given a reference to the step in its <tt class="xref py py-attr docutils literal"><span class="pre">step</span></tt>
attribute.</p>
</div>
<div class="section" id="using-properties">
<h5>Using Properties<a class="headerlink" href="#using-properties" title="Permalink to this headline">¶</a></h5>
<p>In custom <tt class="xref py py-class docutils literal"><span class="pre">BuildSteps</span></tt>, you can get and set the build properties with
the <a class="reference internal" href="#getProperty" title="getProperty"><tt class="xref py py-meth docutils literal"><span class="pre">getProperty</span></tt></a>/<a class="reference internal" href="#setProperty" title="setProperty"><tt class="xref py py-meth docutils literal"><span class="pre">setProperty</span></tt></a> methods. Each takes a string
for the name of the property, and returns or accepts an
arbitrary object. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MakeTarball</span><span class="p">(</span><span class="n">ShellCommand</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&quot;os&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s">&quot;win&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCommand</span><span class="p">([</span> <span class="o">...</span> <span class="p">])</span> <span class="c"># windows-only command</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setCommand</span><span class="p">([</span> <span class="o">...</span> <span class="p">])</span> <span class="c"># equivalent for other systems</span>
        <span class="n">ShellCommand</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
<p>Remember that properties set in a step may not be available until the next step
begins.  In particular, any <tt class="xref py py-class docutils literal"><span class="pre">Property</span></tt> or <tt class="xref py py-class docutils literal"><span class="pre">Interpolate</span></tt>
instances for the current step are interpoloated before the <tt class="docutils literal"><span class="pre">start</span></tt> method
begins.</p>
</div>
<div class="section" id="buildstep-urls">
<span id="index-4"></span><h5>BuildStep URLs<a class="headerlink" href="#buildstep-urls" title="Permalink to this headline">¶</a></h5>
<p>Each BuildStep has a collection of <cite>links</cite>. Like its collection of
LogFiles, each link has a name and a target URL. The web status page
creates HREFs for each link in the same box as it does for LogFiles,
except that the target of the link is the external URL instead of an
internal link to a page that shows the contents of the LogFile.</p>
<p>These external links can be used to point at build information hosted
on other servers. For example, the test process might produce an
intricate description of which tests passed and failed, or some sort
of code coverage data in HTML form, or a PNG or GIF image with a graph
of memory usage over time. The external link can provide an easy way
for users to navigate from the buildbot's status page to these
external web sites or file servers. Note that the step itself is
responsible for insuring that there will be a document available at
the given URL (perhaps by using <strong class="command">scp</strong> to copy the HTML output
to a <tt class="file docutils literal"><span class="pre">~/public_html/</span></tt> directory on a remote web server). Calling
<tt class="xref py py-meth docutils literal"><span class="pre">addURL</span></tt> does not magically populate a web server.</p>
<p>To set one of these links, the <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> should call the <tt class="xref py py-meth docutils literal"><span class="pre">addURL</span></tt>
method with the name of the link and the target URL. Multiple URLs can
be set.</p>
<p>In this example, we assume that the <tt class="docutils literal"><span class="pre">make</span> <span class="pre">test</span></tt> command causes
a collection of HTML files to be created and put somewhere on the
coverage.example.org web server, in a filename that incorporates the
build number.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestWithCodeCoverage</span><span class="p">(</span><span class="n">BuildStep</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">,</span>
               <span class="n">Interpolate</span><span class="p">(</span><span class="s">&quot;buildnum=%(prop:buildnumber)s&quot;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">createSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
        <span class="n">buildnumber</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getProperty</span><span class="p">(</span><span class="s">&quot;buildnumber&quot;</span><span class="p">)</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s">&quot;http://coverage.example.org/builds/</span><span class="si">%s</span><span class="s">.html&quot;</span> <span class="o">%</span> <span class="n">buildnumber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="s">&quot;coverage&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
<p>You might also want to extract the URL from some special message
output by the build process itself:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestWithCodeCoverage</span><span class="p">(</span><span class="n">BuildStep</span><span class="p">):</span>
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;make&quot;</span><span class="p">,</span> <span class="s">&quot;test&quot;</span><span class="p">,</span>
               <span class="n">Interpolate</span><span class="p">(</span><span class="s">&quot;buildnum=%(prop:buildnumber)s&quot;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">createSummary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="n">log</span><span class="o">.</span><span class="n">getText</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;coverage-url:&quot;</span><span class="p">):</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s">&quot;coverage-url:&quot;</span><span class="p">):]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addURL</span><span class="p">(</span><span class="s">&quot;coverage&quot;</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
                <span class="k">return</span>
</pre></div>
</div>
<p>Note that a build process which emits both <tt class="file docutils literal"><span class="pre">stdout</span></tt> and <tt class="file docutils literal"><span class="pre">stderr</span></tt> might
cause this line to be split or interleaved between other lines. It
might be necessary to restrict the <tt class="xref py py-meth docutils literal"><span class="pre">getText</span></tt> call to only stdout with
something like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">output</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                           <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">log</span><span class="o">.</span><span class="n">getChunks</span><span class="p">()</span>
                           <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">LOG_CHANNEL_STDOUT</span><span class="p">]))</span>
</pre></div>
</div>
<p>Of course if the build is run under a PTY, then stdout and stderr will
be merged before the buildbot ever sees them, so such interleaving
will be unavoidable.</p>
</div>
<div class="section" id="a-somewhat-whimsical-example">
<h5>A Somewhat Whimsical Example<a class="headerlink" href="#a-somewhat-whimsical-example" title="Permalink to this headline">¶</a></h5>
<p>Let's say that we've got some snazzy new unit-test framework called
Framboozle. It's the hottest thing since sliced bread. It slices, it
dices, it runs unit tests like there's no tomorrow. Plus if your unit
tests fail, you can use its name for a Web 2.1 startup company, make
millions of dollars, and hire engineers to fix the bugs for you, while
you spend your afternoons lazily hang-gliding along a scenic pacific
beach, blissfully unconcerned about the state of your
tests. <a class="footnote-reference" href="#framboozle-reg" id="id10">[1]</a></p>
<p>To run a Framboozle-enabled test suite, you just run the 'framboozler'
command from the top of your source code tree. The 'framboozler'
command emits a bunch of stuff to stdout, but the most interesting bit
is that it emits the line &quot;FNURRRGH!&quot; every time it finishes running a
test case You'd like to have a test-case counting LogObserver that
watches for these lines and counts them, because counting them will
help the buildbot more accurately calculate how long the build will
take, and this will let you know exactly how long you can sneak out of
the office for your hang-gliding lessons without anyone noticing that
you're gone.</p>
<p>This will involve writing a new <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> (probably named
&quot;Framboozle&quot;) which inherits from <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>. The <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> class
definition itself will look something like this:</p>
<div class="highlight-python"><pre>from buildbot.steps.shell import ShellCommand
from buildbot.process.buildstep import LogLineObserver

class FNURRRGHCounter(LogLineObserver):
    numTests = 0
    def outLineReceived(self, line):
        if "FNURRRGH!" in line:
            self.numTests += 1
            self.step.setProgress('tests', self.numTests)

class Framboozle(ShellCommand):
    command = ["framboozler"]

    def __init__(self, **kwargs):
        ShellCommand.__init__(self, **kwargs)   # always upcall!
        counter = FNURRRGHCounter())
        self.addLogObserver('stdio', counter)
        self.progressMetrics += ('tests',)</pre>
</div>
<p>So that's the code that we want to wind up using. How do we actually
deploy it?</p>
<p>You have a couple of different options.</p>
<p>Option 1: The simplest technique is to simply put this text
(everything from START to FINISH) in your <tt class="FILE docutils literal"><span class="pre">master.cfg</span></tt> file, somewhere
before the <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt> definition where you actually use it in a
clause like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;stuff&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Framboozle</span><span class="p">())</span>
</pre></div>
</div>
<p>Remember that <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> is secretly just a python program with one
job: populating the <tt class="file docutils literal"><span class="pre">BuildmasterConfig</span></tt> dictionary. And python programs
are allowed to define as many classes as they like. So you can define
classes and use them in the same file, just as long as the class is
defined before some other code tries to use it.</p>
<p>This is easy, and it keeps the point of definition very close to the
point of use, and whoever replaces you after that unfortunate
hang-gliding accident will appreciate being able to easily figure out
what the heck this stupid &quot;Framboozle&quot; step is doing anyways. The
downside is that every time you reload the config file, the Framboozle
class will get redefined, which means that the buildmaster will think
that you've reconfigured all the Builders that use it, even though
nothing changed. Bleh.</p>
<p>Option 2: Instead, we can put this code in a separate file, and import
it into the master.cfg file just like we would the normal buildsteps
like <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a> and <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a>.</p>
<p>Create a directory named ~/lib/python, put everything from START to
FINISH in <tt class="file docutils literal"><span class="pre">~/lib/python/framboozle.py</span></tt>, and run your buildmaster using:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">PYTHONPATH</span><span class="o">=</span>~/lib/python buildbot start MASTERDIR
</pre></div>
</div>
<p>or use the <tt class="file docutils literal"><span class="pre">Makefile.buildbot</span></tt> to control the way
<tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">start</span></tt> works. Or add something like this to
something like your <tt class="file docutils literal"><span class="pre">~/.bashrc</span></tt> or <tt class="file docutils literal"><span class="pre">~/.bash_profile</span></tt> or <tt class="file docutils literal"><span class="pre">~/.cshrc</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nb">export </span><span class="nv">PYTHONPATH</span><span class="o">=</span>~/lib/python
</pre></div>
</div>
<p>Once we've done this, our <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> can look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">framboozle</span> <span class="kn">import</span> <span class="n">Framboozle</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;stuff&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">Framboozle</span><span class="p">())</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">framboozle</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">svnurl</span><span class="o">=</span><span class="s">&quot;stuff&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">framboozle</span><span class="o">.</span><span class="n">Framboozle</span><span class="p">())</span>
</pre></div>
</div>
<p>(check out the python docs for details about how &quot;import&quot; and &quot;from A
import B&quot; work).</p>
<p>What we've done here is to tell python that every time it handles an
&quot;import&quot; statement for some named module, it should look in our
<tt class="file docutils literal"><span class="pre">~/lib/python/</span></tt> for that module before it looks anywhere else. After our
directories, it will try in a bunch of standard directories too
(including the one where buildbot is installed). By setting the
<span class="target" id="index-6"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> environment variable, you can add directories to the front
of this search list.</p>
<p>Python knows that once it &quot;import&quot;s a file, it doesn't need to
re-import it again. This means that reconfiguring the buildmaster
(with <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">reconfig</span></tt>, for example) won't make it think the
Framboozle class has changed every time, so the Builders that use it
will not be spuriously restarted. On the other hand, you either have
to start your buildmaster in a slightly weird way, or you have to
modify your environment to set the <span class="target" id="index-7"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> variable.</p>
<p>Option 3: Install this code into a standard python library directory</p>
<p>Find out what your python's standard include path is by asking it:</p>
<div class="highlight-none"><div class="highlight"><pre>80:warner@luther% python
Python 2.4.4c0 (#2, Oct  2 2006, 00:57:46)
[GCC 4.1.2 20060928 (prerelease) (Debian 4.1.1-15)] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt; import sys
&gt;&gt;&gt; import pprint
&gt;&gt;&gt; pprint.pprint(sys.path)
[&#39;&#39;,
 &#39;/usr/lib/python24.zip&#39;,
 &#39;/usr/lib/python2.4&#39;,
 &#39;/usr/lib/python2.4/plat-linux2&#39;,
 &#39;/usr/lib/python2.4/lib-tk&#39;,
 &#39;/usr/lib/python2.4/lib-dynload&#39;,
 &#39;/usr/local/lib/python2.4/site-packages&#39;,
 &#39;/usr/lib/python2.4/site-packages&#39;,
 &#39;/usr/lib/python2.4/site-packages/Numeric&#39;,
 &#39;/var/lib/python-support/python2.4&#39;,
 &#39;/usr/lib/site-python&#39;]
</pre></div>
</div>
<p>In this case, putting the code into
/usr/local/lib/python2.4/site-packages/framboozle.py would work just
fine. We can use the same <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> <tt class="docutils literal"><span class="pre">import</span> <span class="pre">framboozle</span></tt> statement as
in Option 2. By putting it in a standard include directory (instead of
the decidedly non-standard <tt class="file docutils literal"><span class="pre">~/lib/python</span></tt>), we don't even have to set
<span class="target" id="index-8"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt> to anything special. The downside is that you probably have
to be root to write to one of those standard include directories.</p>
<p>Option 4: Submit the code for inclusion in the Buildbot distribution</p>
<p>Make a fork of buildbot on <a class="reference external" href="http://github.com/djmitche/buildbot">http://github.com/djmitche/buildbot</a> or post a patch
in a bug at <a class="reference external" href="http://buildbot.net">http://buildbot.net</a>.  In either case, post a note about your patch
to the mailing list, so others can provide feedback and, eventually, commit it.</p>
<blockquote>
<div>from buildbot.steps import framboozle
f = BuildFactory()
f.addStep(SVN(svnurl=&quot;stuff&quot;))
f.addStep(framboozle.Framboozle())</div></blockquote>
<p>And then you don't even have to install framboozle.py anywhere on your system,
since it will ship with Buildbot. You don't have to be root, you don't have to
set <span class="target" id="index-9"></span><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt>. But you do have to make a good case for Framboozle
being worth going into the main distribution, you'll probably have to provide
docs and some unit test cases, you'll need to figure out what kind of beer the
author likes (IPA's and Stouts for Dustin), and then you'll have to wait until
the next release. But in some environments, all this is easier than getting
root on your buildmaster box, so the tradeoffs may actually be worth it.</p>
<p>Putting the code in master.cfg (1) makes it available to that
buildmaster instance. Putting it in a file in a personal library
directory (2) makes it available for any buildmasters you might be
running. Putting it in a file in a system-wide shared library
directory (3) makes it available for any buildmasters that anyone on
that system might be running. Getting it into the buildbot's upstream
repository (4) makes it available for any buildmasters that anyone in
the world might be running. It's all a matter of how widely you want
to deploy that new class.</p>
</div>
</div>
<div class="section" id="writing-new-status-plugins">
<h4>Writing New Status Plugins<a class="headerlink" href="#writing-new-status-plugins" title="Permalink to this headline">¶</a></h4>
<p>Each status plugin is an object which provides the
<tt class="xref py py-class docutils literal"><span class="pre">twisted.application.service.IService</span></tt> interface, which creates a
tree of Services with the buildmaster at the top [not strictly true].
The status plugins are all children of an object which implements
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.interfaces.IStatus</span></tt>, the main status object. From this
object, the plugin can retrieve anything it wants about current and
past builds. It can also subscribe to hear about new and upcoming
builds.</p>
<p>Status plugins which only react to human queries (like the Waterfall
display) never need to subscribe to anything: they are idle until
someone asks a question, then wake up and extract the information they
need to answer it, then they go back to sleep. Plugins which need to
act spontaneously when builds complete (like the <tt class="xref py py-class docutils literal"><span class="pre">MailNotifier</span></tt> plugin)
need to subscribe to hear about new builds.</p>
<p>If the status plugin needs to run network services (like the HTTP
server used by the Waterfall plugin), they can be attached as Service
children of the plugin itself, using the <tt class="xref py py-class docutils literal"><span class="pre">IServiceCollection</span></tt>
interface.</p>
<table class="docutils footnote" frame="void" id="framboozle-reg" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[1]</a></td><td>framboozle.com is still available. Remember, I get 10% :).</td></tr>
</tbody>
</table>
</div>
</div>
<span id="document-manual/cmdline"></span><div class="section" id="command-line-tool">
<span id="id1"></span><h3>Command-line Tool<a class="headerlink" href="#command-line-tool" title="Permalink to this headline">¶</a></h3>
<p>This section describes command-line tools available after buildbot
installation. Since version 0.8 the one-for-all <strong class="command">buildbot</strong>
command-line tool was divided into two parts namely <strong class="command">buildbot</strong>
and <strong class="command">buildslave</strong>. The last one was separated from main
command-line tool to minimize dependencies required for running a
buildslave while leaving all other functions to <strong class="command">buildbot</strong> tool.</p>
<p>Every command-line tool has a list of global options and a set of commands
which have their own options. One can run these tools in the following way:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot [global options] command [command options]
buildslave [global options] command [command options]
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">buildbot</span></tt> command is used on the master, while <tt class="docutils literal"><span class="pre">buildslave</span></tt> is used on
the slave.  Global options are the same for both tools which perform the
following actions:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--help</span></kbd></td>
<td>Print general help about available commands and global options and exit.
All subsequent arguments are ignored.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--verbose</span></kbd></td>
<td>Set verbose output.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--version</span></kbd></td>
<td>Print current buildbot version and exit. All subsequent arguments are
ignored.</td></tr>
</tbody>
</table>
<p>You can get help on any command by specifying <tt class="docutils literal"><span class="pre">--help</span></tt> as a
command option:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot @var{command} --help
</pre></div>
</div>
<p>You can also use manual pages for <strong class="command">buildbot</strong> and
<strong class="command">buildslave</strong> for quick reference on command-line options.</p>
<p>The remainder of this section describes each buildbot command.  See
<a class="reference internal" href="bb-cmdline.html" title="Command Line Index"><em>Command Line Index</em></a> for a full list.</p>
<div class="section" id="buildbot">
<h4>buildbot<a class="headerlink" href="#buildbot" title="Permalink to this headline">¶</a></h4>
<p>The <strong class="command">buildbot</strong> command-line tool can be used to start or stop a
buildmaster or buildbot, and to interact with a running buildmaster.
Some of its subcommands are intended for buildmaster admins, while
some are for developers who are editing the code that the buildbot is
monitoring.</p>
<div class="section" id="administrator-tools">
<h5>Administrator Tools<a class="headerlink" href="#administrator-tools" title="Permalink to this headline">¶</a></h5>
<p>The following <strong class="command">buildbot</strong> sub-commands are intended for
buildmaster administrators:</p>
<div class="section" id="create-master">
<span id="cmdline-create-master"></span><h6>create-master<a class="headerlink" href="#create-master" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre>buildbot create-master -r {BASEDIR}
</pre></div>
</div>
<p>This creates a new directory and populates it with files that allow it to be used as a buildmaster's base directory.</p>
<p>You will usually want to use the <em class="xref std std-option">-r</em> option to create a relocatable <tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt>.
This allows you to move the master directory without editing this file.</p>
</div>
<div class="section" id="start">
<span id="cmdline-start (buildbot)"></span><h6>start<a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre>buildbot start [--nodaemon] {BASEDIR}
</pre></div>
</div>
<p>This starts a buildmaster which was already created in the given base directory.
The daemon is launched in the background, with events logged to a file named <tt class="file docutils literal"><span class="pre">twistd.log</span></tt>.</p>
<p>The <em class="xref std std-option">--nodaemon</em> option instructs Buildbot to skip daemonizing.
The process will start in the foreground.
It will only return to the command-line when it is stopped.</p>
</div>
<div class="section" id="restart">
<span id="cmdline-restart (buildbot)"></span><h6>restart<a class="headerlink" href="#restart" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre>buildbot restart [--nodaemon] {BASEDIR}
</pre></div>
</div>
<p>Restart the buildmaster.
This is equivalent to <tt class="docutils literal"><span class="pre">stop</span></tt> followed by <tt class="docutils literal"><span class="pre">start</span></tt>
The <em class="xref std std-option">--nodaemon</em> option has the same meaning as for <tt class="docutils literal"><span class="pre">start</span></tt>.</p>
</div>
<div class="section" id="stop">
<span id="cmdline-stop (buildbot)"></span><h6>stop<a class="headerlink" href="#stop" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre>buildbot stop {BASEDIR}
</pre></div>
</div>
<p>This terminates the daemon (either buildmaster or buildslave) running in the given directory.</p>
</div>
<div class="section" id="sighup">
<span id="cmdline-sighup"></span><h6>sighup<a class="headerlink" href="#sighup" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre>buildbot sighup {BASEDIR}
</pre></div>
</div>
<p>This sends a SIGHUP to the buildmaster running in the given directory, which causes it to re-read its <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> file.</p>
</div>
</div>
<div class="section" id="developer-tools">
<h5>Developer Tools<a class="headerlink" href="#developer-tools" title="Permalink to this headline">¶</a></h5>
<p>These tools are provided for use by the developers who are working on
the code that the buildbot is monitoring.</p>
<div class="section" id="statuslog">
<span id="cmdline-statuslog"></span><h6>statuslog<a class="headerlink" href="#statuslog" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre>buildbot statuslog --master {MASTERHOST}:{PORT}
</pre></div>
</div>
<p>This command starts a simple text-based status client, one which just
prints out a new line each time an event occurs on the buildmaster.</p>
<p>The <em class="xref std std-option">--master</em> option provides the location of the
<a class="reference internal" href="#buildbot.status.client.PBListener" title="buildbot.status.client.PBListener"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.status.client.PBListener</span></tt></a> status port, used to deliver
build information to realtime status clients. The option is always in
the form of a string, with hostname and port number separated by a
colon (<tt class="samp docutils literal"><em><span class="pre">HOSTNAME</span></em><span class="pre">:</span><em><span class="pre">PORTNUM</span></em></tt>). Note that this port is <em>not</em> the
same as the slaveport (although a future version may allow the same
port number to be used for both purposes). If you get an error message
to the effect of <tt class="docutils literal"><span class="pre">Failure:</span> <span class="pre">twisted.cred.error.UnauthorizedLogin:</span></tt>,
this may indicate that you are connecting to the slaveport rather than
a <tt class="xref py py-class docutils literal"><span class="pre">PBListener</span></tt> port.</p>
<p>The <em class="xref std std-option">--master</em> option can also be provided by the
<tt class="docutils literal"><span class="pre">masterstatus</span></tt> name in <tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt>
(see <a class="reference internal" href="#buildbot-config-directory"><em>.buildbot config directory</em></a>).</p>
</div>
<div class="section" id="statusgui">
<span id="cmdline-statusgui"></span><h6>statusgui<a class="headerlink" href="#statusgui" title="Permalink to this headline">¶</a></h6>
<p>If you have set up a <a class="reference internal" href="#status-PBListener" title="PBListener"><tt class="xref bb bb-status docutils literal"><span class="pre">PBListener</span></tt></a>, you will be able
to monitor your Buildbot using a simple Gtk+ application invoked with
the <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">statusgui</span></tt> command:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot statusgui --master {MASTERHOST}:{PORT}
</pre></div>
</div>
<p>This command starts a simple Gtk+-based status client, which contains a few
boxes for each Builder that change color as events occur. It uses the same
<tt class="docutils literal"><span class="pre">--master</span></tt> argument and <tt class="docutils literal"><span class="pre">masterstatus</span></tt> option as the
<tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">statuslog</span></tt> command (<a class="reference internal" href="#cmdline-statuslog" title="statuslog"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">statuslog</span></tt></a>).</p>
</div>
<div class="section" id="try">
<span id="cmdline-try"></span><h6>try<a class="headerlink" href="#try" title="Permalink to this headline">¶</a></h6>
<p>This lets a developer to ask the question <tt class="docutils literal"><span class="pre">What</span> <span class="pre">would</span> <span class="pre">happen</span> <span class="pre">if</span> <span class="pre">I</span>
<span class="pre">committed</span> <span class="pre">this</span> <span class="pre">patch</span> <span class="pre">right</span> <span class="pre">now?</span></tt>. It runs the unit test suite (across
multiple build platforms) on the developer's current code, allowing
them to make sure they will not break the tree when they finally
commit their changes.</p>
<p>The <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">try</span></tt> command is meant to be run from within a
developer's local tree, and starts by figuring out the base revision
of that tree (what revision was current the last time the tree was
updated), and a patch that can be applied to that revision of the tree
to make it match the developer's copy. This <tt class="docutils literal"><span class="pre">(revision,</span> <span class="pre">patch)</span></tt> pair is
then sent to the buildmaster, which runs a build with that
<tt class="xref py py-class docutils literal"><span class="pre">SourceStamp</span></tt>. If you want, the tool will emit status messages as the
builds run, and will not terminate until the first failure has been
detected (or the last success).</p>
<p>There is an alternate form which accepts a pre-made patch file
(typically the output of a command like <strong class="command">svn diff</strong>). This <tt class="docutils literal"><span class="pre">--diff</span></tt>
form does not require a local tree to run from. See <a class="reference internal" href="#try-diff"><em>try --diff</em></a> concerning
the <tt class="docutils literal"><span class="pre">--diff</span></tt> command option.</p>
<p>For this command to work, several pieces must be in place: the
<a class="reference internal" href="#sched-Try_Jobdir" title="Try_Jobdir"><tt class="xref bb bb-sched docutils literal"><span class="pre">Try_Jobdir</span></tt></a> or :<a class="reference internal" href="#sched-Try_Userpass" title="Try_Userpass"><tt class="xref bb bb-sched docutils literal"><span class="pre">Try_Userpass</span></tt></a>, as well as some client-side
configuration.</p>
<div class="section" id="locating-the-master">
<h7>Locating the master<a class="headerlink" href="#locating-the-master" title="Permalink to this headline">¶</a></h7>
<p>The <strong class="command">try</strong> command needs to be told how to connect to the
try scheduler, and must know which of the authentication
approaches described above is in use by the buildmaster. You specify
the approach by using <tt class="docutils literal"><span class="pre">--connect=ssh</span></tt> or <tt class="docutils literal"><span class="pre">--connect=pb</span></tt>
(or <tt class="docutils literal"><span class="pre">try_connect</span> <span class="pre">=</span> <span class="pre">'ssh'</span></tt> or <tt class="docutils literal"><span class="pre">try_connect</span> <span class="pre">=</span> <span class="pre">'pb'</span></tt> in
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt>).</p>
<p>For the PB approach, the command must be given a <em class="xref std std-option">--master</em>
argument (in the form <tt class="samp docutils literal"><em><span class="pre">HOST</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em></tt>) that points to TCP port that you
picked in the <tt class="xref py py-class docutils literal"><span class="pre">Try_Userpass</span></tt> scheduler. It also takes a
<em class="xref std std-option">--username</em> and <em class="xref std std-option">--passwd</em> pair of arguments that match
one of the entries in the buildmaster's <tt class="docutils literal"><span class="pre">userpass</span></tt> list. These
arguments can also be provided as <tt class="docutils literal"><span class="pre">try_master</span></tt>,
<tt class="docutils literal"><span class="pre">try_username</span></tt>, and <tt class="docutils literal"><span class="pre">try_password</span></tt> entries in the
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt> file.</p>
<p>For the SSH approach, the command must be given <em class="xref std std-option">--host</em> and
<em class="xref std std-option">--username</em>, to get to the buildmaster host. It must also be given
<em class="xref std std-option">--jobdir</em>, which points to the inlet directory configured
above. The jobdir can be relative to the user's home directory, but
most of the time you will use an explicit path like
<tt class="file docutils literal"><span class="pre">~buildbot/project/trydir</span></tt>. These arguments can be provided in
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt> as <tt class="docutils literal"><span class="pre">try_host</span></tt>, <tt class="docutils literal"><span class="pre">try_username</span></tt>,
<tt class="docutils literal"><span class="pre">try_password</span></tt>, and <tt class="docutils literal"><span class="pre">try_jobdir</span></tt>.</p>
<p>The SSH approach also provides a <em class="xref std std-option">--buildbotbin</em> argument to
allow specification of the buildbot binary to run on the
buildmaster. This is useful in the case where buildbot is installed in
a <a class="reference internal" href="#installation-in-a-virtualenv"><em>virtualenv</em></a> on the buildmaster
host, or in other circumstances where the buildbot command is not on
the path of the user given by <em class="xref std std-option">--username</em>. The
<em class="xref std std-option">--buildbotbin</em> argument can be provided in
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt> as <tt class="docutils literal"><span class="pre">try_buildbotbin</span></tt></p>
<p>Finally, the SSH approach needs to connect to a <tt class="xref py py-class docutils literal"><span class="pre">PBListener</span></tt>
status port, so it can retrieve and report the results of the build
(the PB approach uses the existing connection to retrieve status
information, so this step is not necessary). This requires a
<em class="xref std std-option">--masterstatus</em> argument, or a <tt class="docutils literal"><span class="pre">try_masterstatus</span></tt> entry in
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt>, in the form of a <tt class="samp docutils literal"><em><span class="pre">HOSTNAME</span></em><span class="pre">:</span><em><span class="pre">PORT</span></em></tt>
string.</p>
<p>The following command line arguments are deprecated, but retained for
backward compatibility:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--tryhost</span></kbd></td>
<td>is replaced by <em class="xref std std-option">--host</em></td></tr>
<tr><td class="option-group">
<kbd><span class="option">--trydir</span></kbd></td>
<td>is replaced by <em class="xref std std-option">--jobdir</em></td></tr>
<tr><td class="option-group">
<kbd><span class="option">--master</span></kbd></td>
<td>is replaced by <em class="xref std std-option">--masterstatus</em></td></tr>
</tbody>
</table>
<p>Likewise, the following <tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt> file entries are
deprecated, but retained for backward compatibility:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">try_dir</span></tt> is replaced by <tt class="docutils literal"><span class="pre">try_jobdir</span></tt></li>
<li><tt class="docutils literal"><span class="pre">masterstatus</span></tt> is replaced by <tt class="docutils literal"><span class="pre">try_masterstatus</span></tt></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="choosing-the-builders">
<h7>Choosing the Builders<a class="headerlink" href="#choosing-the-builders" title="Permalink to this headline">¶</a></h7>
<p>A trial build is performed on multiple Builders at the same time, and
the developer gets to choose which Builders are used (limited to a set
selected by the buildmaster admin with the <tt class="xref py py-class docutils literal"><span class="pre">TryScheduler</span></tt>'s
<tt class="docutils literal"><span class="pre">builderNames=</span></tt> argument). The set you choose will depend upon
what your goals are: if you are concerned about cross-platform
compatibility, you should use multiple Builders, one from each
platform of interest. You might use just one builder if that platform
has libraries or other facilities that allow better test coverage than
what you can accomplish on your own machine, or faster test runs.</p>
<p>The set of Builders to use can be specified with multiple
<em class="xref std std-option">--builder</em> arguments on the command line. It can also be
specified with a single <tt class="docutils literal"><span class="pre">try_builders</span></tt> option in
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt> that uses a list of strings to specify all
the Builder names:</p>
<blockquote>
<div>try_builders = [&quot;full-OSX&quot;, &quot;full-win32&quot;, &quot;full-linux&quot;]</div></blockquote>
<p>If you are using the PB approach, you can get the names of the builders
that are configured for the try scheduler using the <tt class="docutils literal"><span class="pre">get-builder-names</span></tt>
argument:</p>
<blockquote>
<div>buildbot try --get-builder-names --connect=pb --master=... --username=... --passwd=...</div></blockquote>
</div>
<div class="section" id="specifying-the-vc-system">
<h7>Specifying the VC system<a class="headerlink" href="#specifying-the-vc-system" title="Permalink to this headline">¶</a></h7>
<p>The <strong class="command">try</strong> command also needs to know how to take the
developer's current tree and extract the (revision, patch)
source-stamp pair. Each VC system uses a different process, so you
start by telling the <strong class="command">try</strong> command which VC system you are
using, with an argument like <em class="xref std std-option">--vc=cvs</em> or <em class="xref std std-option">--vc=git</em>.
This can also be provided as <tt class="docutils literal"><span class="pre">try_vc</span></tt> in
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt>.</p>
<p>The following names are recognized: <tt class="docutils literal"><span class="pre">bzr</span></tt> <tt class="docutils literal"><span class="pre">cvs</span></tt> <tt class="docutils literal"><span class="pre">darcs</span></tt> <tt class="docutils literal"><span class="pre">hg</span></tt>
<tt class="docutils literal"><span class="pre">git</span></tt> <tt class="docutils literal"><span class="pre">mtn</span></tt> <tt class="docutils literal"><span class="pre">p4</span></tt> <tt class="docutils literal"><span class="pre">svn</span></tt></p>
</div>
<div class="section" id="finding-the-top-of-the-tree">
<h7>Finding the top of the tree<a class="headerlink" href="#finding-the-top-of-the-tree" title="Permalink to this headline">¶</a></h7>
<p>Some VC systems (notably CVS and SVN) track each directory
more-or-less independently, which means the <strong class="command">try</strong> command
needs to move up to the top of the project tree before it will be able
to construct a proper full-tree patch. To accomplish this, the
<strong class="command">try</strong> command will crawl up through the parent directories
until it finds a marker file. The default name for this marker file is
<tt class="file docutils literal"><span class="pre">.buildbot-top</span></tt>, so when you are using CVS or SVN you should
<tt class="docutils literal"><span class="pre">touch</span> <span class="pre">.buildbot-top</span></tt> from the top of your tree before running
<strong class="command">buildbot try</strong>. Alternatively, you can use a filename like
<tt class="file docutils literal"><span class="pre">ChangeLog</span></tt> or <tt class="file docutils literal"><span class="pre">README</span></tt>, since many projects put one of
these files in their top-most directory (and nowhere else). To set
this filename, use <tt class="docutils literal"><span class="pre">--topfile=ChangeLog</span></tt>, or set it in the
options file with <tt class="docutils literal"><span class="pre">try_topfile</span> <span class="pre">=</span> <span class="pre">'ChangeLog'</span></tt>.</p>
<p>You can also manually set the top of the tree with
<tt class="docutils literal"><span class="pre">--topdir=~/trees/mytree</span></tt>, or <tt class="docutils literal"><span class="pre">try_topdir</span> <span class="pre">=</span>
<span class="pre">'~/trees/mytree'</span></tt>. If you use <tt class="docutils literal"><span class="pre">try_topdir</span></tt>, in a
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt> file, you will need a separate options file
for each tree you use, so it may be more convenient to use the
<tt class="docutils literal"><span class="pre">try_topfile</span></tt> approach instead.</p>
<p>Other VC systems which work on full projects instead of individual
directories (darcs, mercurial, git, monotone) do not require
<strong class="command">try</strong> to know the top directory, so the <em class="xref std std-option">--try-topfile</em>
and <em class="xref std std-option">--try-topdir</em> arguments will be ignored.</p>
<p>If the <strong class="command">try</strong> command cannot find the top directory, it will
abort with an error message.</p>
<p>The following command line arguments are deprecated, but retained for
backward compatibility:</p>
<blockquote>
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">--try-topdir</span></tt> is replaced by <em class="xref std std-option">--topdir</em></li>
<li><tt class="docutils literal"><span class="pre">--try-topfile</span></tt> is replaced by <em class="xref std std-option">--topfile</em></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="determining-the-branch-name">
<h7>Determining the branch name<a class="headerlink" href="#determining-the-branch-name" title="Permalink to this headline">¶</a></h7>
<p>Some VC systems record the branch information in a way that <tt class="docutils literal"><span class="pre">try</span></tt>
can locate it. For the others, if you are using something other than
the default branch, you will have to tell the buildbot which branch
your tree is using. You can do this with either the <em class="xref std std-option">--branch</em>
argument, or a <tt class="docutils literal"><span class="pre">try_branch</span></tt> entry in the
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt> file.</p>
</div>
<div class="section" id="determining-the-revision-and-patch">
<h7>Determining the revision and patch<a class="headerlink" href="#determining-the-revision-and-patch" title="Permalink to this headline">¶</a></h7>
<p>Each VC system has a separate approach for determining the tree's base
revision and computing a patch.</p>
<dl class="docutils">
<dt>CVS</dt>
<dd><strong class="command">try</strong> pretends that the tree is up to date. It converts the
current time into a <em class="xref std std-option">-D</em> time specification, uses it as the base
revision, and computes the diff between the upstream tree as of that
point in time versus the current contents. This works, more or less,
but requires that the local clock be in reasonably good sync with the
repository.</dd>
<dt>SVN</dt>
<dd><strong class="command">try</strong> does a <strong class="command">svn status -u</strong> to find the latest
repository revision number (emitted on the last line in the <tt class="samp docutils literal"><span class="pre">Status</span>
<span class="pre">against</span> <span class="pre">revision:</span> <em><span class="pre">NN</span></em></tt> message). It then performs an <tt class="samp docutils literal"><span class="pre">svn</span> <span class="pre">diff</span>
<span class="pre">-r</span><em><span class="pre">NN</span></em></tt> to find out how your tree differs from the repository version,
and sends the resulting patch to the buildmaster. If your tree is not
up to date, this will result in the <tt class="docutils literal"><span class="pre">try</span></tt> tree being created with
the latest revision, then <em>backwards</em> patches applied to bring it
<tt class="docutils literal"><span class="pre">back</span></tt> to the version you actually checked out (plus your actual
code changes), but this will still result in the correct tree being
used for the build.</dd>
<dt>bzr</dt>
<dd><strong class="command">try</strong> does a <tt class="docutils literal"><span class="pre">bzr</span> <span class="pre">revision-info</span></tt> to find the base revision,
then a <tt class="docutils literal"><span class="pre">bzr</span> <span class="pre">diff</span> <span class="pre">-r$base..</span></tt> to obtain the patch.</dd>
<dt>Mercurial</dt>
<dd><tt class="docutils literal"><span class="pre">hg</span> <span class="pre">parents</span> <span class="pre">--template</span> <span class="pre">'{node}\n'</span></tt> emits the full revision id (as opposed to
the common 12-char truncated) which is a SHA1 hash of the current
revision's contents. This is used as the base revision.
<tt class="docutils literal"><span class="pre">hg</span> <span class="pre">diff</span></tt> then provides the patch relative to that
revision. For <strong class="command">try</strong> to work, your working directory must only
have patches that are available from the same remotely-available
repository that the build process' <tt class="docutils literal"><span class="pre">source.Mercurial</span></tt> will use.</dd>
<dt>Perforce</dt>
<dd><strong class="command">try</strong> does a <tt class="docutils literal"><span class="pre">p4</span> <span class="pre">changes</span> <span class="pre">-m1</span> <span class="pre">...</span></tt> to determine the latest
changelist and implicitly assumes that the local tree is synched to this
revision. This is followed by a <tt class="docutils literal"><span class="pre">p4</span> <span class="pre">diff</span> <span class="pre">-du</span></tt> to obtain the patch.
A p4 patch differs sligtly from a normal diff. It contains full depot
paths and must be converted to paths relative to the branch top. To convert
the following restriction is imposed. The p4base (see <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">P4Source</span></tt></a>)
is assumed to be <tt class="docutils literal"><span class="pre">//depot</span></tt></dd>
<dt>Darcs</dt>
<dd><strong class="command">try</strong> does a <tt class="docutils literal"><span class="pre">darcs</span> <span class="pre">changes</span> <span class="pre">--context</span></tt> to find the list
of all patches back to and including the last tag that was made. This text
file (plus the location of a repository that contains all these
patches) is sufficient to re-create the tree. Therefore the contents
of this <tt class="docutils literal"><span class="pre">context</span></tt> file <em>are</em> the revision stamp for a
Darcs-controlled source tree.  It then does a <tt class="docutils literal"><span class="pre">darcs</span> <span class="pre">diff</span> <span class="pre">-u</span></tt>
to compute the patch relative to that revision.</dd>
<dt>Git</dt>
<dd><tt class="docutils literal"><span class="pre">git</span> <span class="pre">branch</span> <span class="pre">-v</span></tt> lists all the branches available in the local
repository along with the revision ID it points to and a short summary
of the last commit. The line containing the currently checked out
branch begins with <tt class="docutils literal"><span class="pre">*&nbsp;</span></tt> (star and space) while all the others start
with <tt class="docutils literal"><span class="pre">&nbsp;&nbsp;</span></tt> (two spaces). <strong class="command">try</strong> scans for this line and extracts
the branch name and revision from it. Then it generates a diff against
the base revision.</dd>
</dl>
<dl class="docutils">
<dt>Monotone</dt>
<dd><strong class="command">mtn automate get_base_revision_id</strong> emits the full revision id
which is a SHA1 hash of the current revision's contents. This is used as
the base revision.
<strong class="command">mtn diff</strong> then provides the patch relative to that
revision.  For <strong class="command">try</strong> to work, your working directory must
only have patches that are available from the same
remotely-available repository that the build process'
<tt class="xref py py-class docutils literal"><span class="pre">source.Monotone</span></tt> will use.</dd>
</dl>
</div>
<div class="section" id="patch-information">
<h7>patch information<a class="headerlink" href="#patch-information" title="Permalink to this headline">¶</a></h7>
<p>You can provide the <em class="xref std std-option">--who=dev</em> to designate who is running the
try build. This will add the <tt class="docutils literal"><span class="pre">dev</span></tt> to the Reason field on the try
build's status web page. You can also set <tt class="docutils literal"><span class="pre">try_who</span> <span class="pre">=</span> <span class="pre">dev</span></tt> in the
<tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt> file. Note that <em class="xref std std-option">--who=dev</em> will not
work on version 0.8.3 or earlier masters.</p>
<p>Similarly, <em class="xref std std-option">--comment=COMMENT</em> will specify the comment for the patch,
which is also displayed in the patch information.  The corresponding
config-file option is <tt class="docutils literal"><span class="pre">try_comment</span></tt>.</p>
</div>
<div class="section" id="waiting-for-results">
<h7>Waiting for results<a class="headerlink" href="#waiting-for-results" title="Permalink to this headline">¶</a></h7>
<p>If you provide the <em class="xref std std-option">--wait</em> option (or <tt class="docutils literal"><span class="pre">try_wait</span> <span class="pre">=</span> <span class="pre">True</span></tt>
in <tt class="file docutils literal"><span class="pre">.buildbot/options</span></tt>), the <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">try</span></tt> command will
wait until your changes have either been proven good or bad before
exiting. Unless you use the <em class="xref std std-option">--quiet</em> option (or
<tt class="docutils literal"><span class="pre">try_quiet=True</span></tt>), it will emit a progress message every 60
seconds until the builds have completed.</p>
</div>
</div>
<div class="section" id="try-diff">
<span id="id2"></span><h6>try --diff<a class="headerlink" href="#try-diff" title="Permalink to this headline">¶</a></h6>
<p>Sometimes you might have a patch from someone else that you want to
submit to the buildbot. For example, a user may have created a patch
to fix some specific bug and sent it to you by email. You've inspected
the patch and suspect that it might do the job (and have at least
confirmed that it doesn't do anything evil). Now you want to test it
out.</p>
<p>One approach would be to check out a new local tree, apply the patch,
run your local tests, then use <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">try</span></tt> to run the tests on
other platforms. An alternate approach is to use the <tt class="docutils literal"><span class="pre">buildbot</span>
<span class="pre">try</span> <span class="pre">--diff</span></tt> form to have the buildbot test the patch without using a
local tree.</p>
<p>This form takes a <em class="xref std std-option">--diff</em> argument which points to a file that
contains the patch you want to apply. By default this patch will be
applied to the TRUNK revision, but if you give the optional
<em class="xref std std-option">--baserev</em> argument, a tree of the given revision will be used
as a starting point instead of TRUNK.</p>
<p>You can also use <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">try</span> <span class="pre">--diff=-</span></tt> to read the patch
from <tt class="file docutils literal"><span class="pre">stdin</span></tt>.</p>
<p>Each patch has a <tt class="docutils literal"><span class="pre">patchlevel</span></tt> associated with it. This indicates the
number of slashes (and preceding pathnames) that should be stripped
before applying the diff. This exactly corresponds to the <em class="xref std std-option">-p</em>
or <em class="xref std std-option">--strip</em> argument to the <strong class="command">patch</strong> utility. By
default <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">try</span> <span class="pre">--diff</span></tt> uses a patchlevel of 0, but you
can override this with the <em class="xref std std-option">-p</em> argument.</p>
<p>When you use <em class="xref std std-option">--diff</em>, you do not need to use any of the other
options that relate to a local tree, specifically <em class="xref std std-option">--vc</em>,
<em class="xref std std-option">--try-topfile</em>, or <em class="xref std std-option">--try-topdir</em>. These options will
be ignored. Of course you must still specify how to get to the
buildmaster (with <em class="xref std std-option">--connect</em>, <em class="xref std std-option">--tryhost</em>, etc).</p>
</div>
</div>
<div class="section" id="other-tools">
<h5>Other Tools<a class="headerlink" href="#other-tools" title="Permalink to this headline">¶</a></h5>
<p>These tools are generally used by buildmaster administrators.</p>
<div class="section" id="sendchange">
<span id="cmdline-sendchange"></span><h6>sendchange<a class="headerlink" href="#sendchange" title="Permalink to this headline">¶</a></h6>
<p>This command is used to tell the buildmaster about source changes. It
is intended to be used from within a commit script, installed on the
VC server. It requires that you have a <tt class="xref py py-class docutils literal"><span class="pre">PBChangeSource</span></tt>
(<a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></tt></a>) running in the buildmaster (by being set in
<tt class="docutils literal"><span class="pre">c['change_source']</span></tt>).</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot sendchange --master {MASTERHOST}:{PORT} --auth {USER}:{PASS}
        --who {USER} {FILENAMES..}
</pre></div>
</div>
<p>The <em class="xref std std-option">auth</em> option specifies the credentials to use to connect to the
master, in the form <tt class="docutils literal"><span class="pre">user:pass</span></tt>.  If the password is omitted, then
sendchange will prompt for it.  If both are omitted, the old default (username
&quot;change&quot; and password &quot;changepw&quot;) will be used.  Note that this password is
well-known, and should not be used on an internet-accessible port.</p>
<p>The <em class="xref std std-option">master</em> and <em class="xref std std-option">username</em> arguments can also be given in the
options file (see <a class="reference internal" href="#buildbot-config-directory"><em>.buildbot config directory</em></a>).  There are other (optional)
arguments which can influence the <tt class="docutils literal"><span class="pre">Change</span></tt> that gets submitted:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--branch</span></kbd></td>
<td>(or option <tt class="docutils literal"><span class="pre">branch</span></tt>) This provides the (string) branch specifier. If
omitted, it defaults to <tt class="docutils literal"><span class="pre">None</span></tt>, indicating the <tt class="docutils literal"><span class="pre">default</span> <span class="pre">branch</span></tt>. All files
included in this Change must be on the same branch.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--category</span></kbd></td>
<td>(or option <tt class="docutils literal"><span class="pre">category</span></tt>) This provides the (string) category specifier. If
omitted, it defaults to <tt class="docutils literal"><span class="pre">None</span></tt>, indicating <tt class="docutils literal"><span class="pre">no</span> <span class="pre">category</span></tt>. The category property
can be used by <tt class="xref py py-class docutils literal"><span class="pre">Scheduler</span></tt>s to filter what changes they listen to.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--project</span></kbd></td>
<td>(or option <tt class="docutils literal"><span class="pre">project</span></tt>) This provides the (string) project to which this
change applies, and defaults to ''.  The project can be used by schedulers to
decide which builders should respond to a particular change.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--repository</span></kbd></td>
<td>(or option <tt class="docutils literal"><span class="pre">repository</span></tt>) This provides the repository from which this
change came, and defaults to <tt class="docutils literal"><span class="pre">''</span></tt>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--revision</span></kbd></td>
<td>This provides a revision specifier, appropriate to the VC system in use.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--revision_file</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>This provides a filename which will be opened and the contents used as
the revision specifier. This is specifically for Darcs, which uses the
output of <tt class="docutils literal"><span class="pre">darcs</span> <span class="pre">changes</span> <span class="pre">--context</span></tt> as a revision specifier.
This context file can be a couple of kilobytes long, spanning a couple
lines per patch, and would be a hassle to pass as a command-line
argument.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--property</span></kbd></td>
<td>This parameter is used to set a property on the <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt> generated by <tt class="docutils literal"><span class="pre">sendchange</span></tt>.
Properties are specified as a <tt class="samp docutils literal"><em><span class="pre">name</span></em><span class="pre">:</span><em><span class="pre">value</span></em></tt> pair, separated by a colon. You may
specify many properties by passing this parameter multiple times.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--comments</span></kbd></td>
<td>This provides the change comments as a single argument. You may want
to use <em class="xref std std-option">--logfile</em> instead.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--logfile</span></kbd></td>
<td>This instructs the tool to read the change comments from the given
file. If you use <tt class="docutils literal"><span class="pre">-</span></tt> as the filename, the tool will read the
change comments from stdin.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--encoding</span></kbd></td>
<td>Specifies the character encoding for all other parameters,
defaulting to <tt class="docutils literal"><span class="pre">'utf8'</span></tt>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--vc</span></kbd></td>
<td>Specifies which VC system the Change is coming from, one of: <tt class="docutils literal"><span class="pre">cvs</span></tt>,
<tt class="docutils literal"><span class="pre">svn</span></tt>, <tt class="docutils literal"><span class="pre">darcs</span></tt>, <tt class="docutils literal"><span class="pre">hg</span></tt>, <tt class="docutils literal"><span class="pre">bzr</span></tt>, <tt class="docutils literal"><span class="pre">git</span></tt>, <tt class="docutils literal"><span class="pre">mtn</span></tt>, or <tt class="docutils literal"><span class="pre">p4</span></tt>.
Defaults to <tt class="docutils literal"><span class="pre">None</span></tt>.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="debugclient">
<span id="cmdline-debugclient"></span><h6>debugclient<a class="headerlink" href="#debugclient" title="Permalink to this headline">¶</a></h6>
<div class="highlight-none"><div class="highlight"><pre>buildbot debugclient --master {MASTERHOST}:{PORT} --passwd {DEBUGPW}
</pre></div>
</div>
<p>This launches a small Gtk+/Glade-based debug tool, connecting to the
buildmaster's <tt class="docutils literal"><span class="pre">debug</span> <span class="pre">port</span></tt>. This debug port shares the same port
number as the slaveport (see <a class="reference internal" href="#setting-the-pb-port-for-slaves"><em>Setting the PB Port for Slaves</em></a>), but the
<tt class="docutils literal"><span class="pre">debugPort</span></tt> is only enabled if you set a debug password in the
buildmaster's config file (see <a class="reference internal" href="#debug-options"><em>Debug Options</em></a>). The
<em class="xref std std-option">--passwd</em> option must match the <tt class="docutils literal"><span class="pre">c['debugPassword']</span></tt>
value.</p>
<p><em class="xref std std-option">--master</em> can also be provided in <tt class="file docutils literal"><span class="pre">.debug/options</span></tt> by the
<tt class="docutils literal"><span class="pre">master</span></tt> key. <em class="xref std std-option">--passwd</em> can be provided by the
<tt class="docutils literal"><span class="pre">debugPassword</span></tt> key.  See <a class="reference internal" href="#buildbot-config-directory"><em>.buildbot config directory</em></a>.</p>
<p>The <em class="guilabel">Connect</em> button must be pressed before any of the other
buttons will be active. This establishes the connection to the
buildmaster. The other sections of the tool are as follows:</p>
<dl class="docutils">
<dt><em class="guilabel">Reload .cfg</em></dt>
<dd>Forces the buildmaster to reload its <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> file. This is
equivalent to sending a SIGHUP to the buildmaster, but can be done
remotely through the debug port. Note that it is a good idea to be
watching the buildmaster's <tt class="file docutils literal"><span class="pre">twistd.log</span></tt> as you reload the config
file, as any errors which are detected in the config file will be
announced there.</dd>
<dt><em class="guilabel">Rebuild .py</em></dt>
<dd>(not yet implemented). The idea here is to use Twisted's <tt class="docutils literal"><span class="pre">rebuild</span></tt>
facilities to replace the buildmaster's running code with a new
version. Even if this worked, it would only be used by buildbot
developers.</dd>
<dt><em class="guilabel">poke IRC</em></dt>
<dd>This locates a <tt class="xref py py-class docutils literal"><span class="pre">words.IRC</span></tt> status target and causes it to emit a
message on all the channels to which it is currently connected. This
was used to debug a problem in which the buildmaster lost the
connection to the IRC server and did not attempt to reconnect.</dd>
<dt><em class="guilabel">Commit</em></dt>
<dd>This allows you to inject a <tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>, just as if a real one had been
delivered by whatever VC hook you are using. You can set the name of
the committed file and the name of the user who is doing the commit.
Optionally, you can also set a revision for the change. If the
revision you provide looks like a number, it will be sent as an
integer, otherwise it will be sent as a string.</dd>
<dt><em class="guilabel">Force Build</em></dt>
<dd>This lets you force a <tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt> (selected by name) to start a build of
the current source tree.</dd>
<dt><em class="guilabel">Currently</em></dt>
<dd>(obsolete). This was used to manually set the status of the given
<tt class="xref py py-class docutils literal"><span class="pre">Builder</span></tt>, but the status-assignment code was changed in an incompatible
way and these buttons are no longer meaningful.</dd>
</dl>
</div>
<div class="section" id="user">
<span id="cmdline-user"></span><h6>user<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h6>
<p>Note that in order to use this command, you need to configure a
<cite>CommandlineUserManager</cite> instance in your <cite>master.cfg</cite> file, which is
explained in <a class="reference internal" href="#users-options"><em>Users Options</em></a>.</p>
<p>This command allows you to manage users in buildbot's database.
No extra requirements are needed to use this command, aside from
the Buildmaster running. For details on how Buildbot manages users,
see <a class="reference internal" href="#concepts-users"><em>Users</em></a>.</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--master</span></kbd></td>
<td>The <strong class="command">user</strong> command can be run virtually anywhere
provided a location of the running buildmaster. The <em class="xref std std-option">master</em>
argument is of the form <tt class="docutils literal"><span class="pre">{MASTERHOST}:{PORT}</span></tt>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--username</span></kbd></td>
<td>PB connection authentication that should match the arguments to
<cite>CommandlineUserManager</cite>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--passwd</span></kbd></td>
<td>PB connection authentication that should match the arguments to
<cite>CommandlineUserManager</cite>.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--op</span></kbd></td>
<td>There are four supported values for the <em class="xref std std-option">op</em> argument:
<em class="xref std std-option">add</em>, <em class="xref std std-option">update</em>, <em class="xref std std-option">remove</em>, and
<em class="xref std std-option">get</em>. Each are described in full in the following sections.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--bb_username</span></kbd></td>
<td>Used with the <em class="xref std std-option">update</em> option, this sets the user's username
for web authentication in the database. It requires <em class="xref std std-option">bb_password</em>
to be set along with it.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--bb_password</span></kbd></td>
<td>Also used with the <em class="xref std std-option">update</em> option, this sets the password
portion of a user's web authentication credentials into the database.
The password is first encrypted prior to storage for security reasons.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--ids</span></kbd></td>
<td><p class="first">When working with users, you need to be able to refer to them by
unique identifiers to find particular users in the database. The
<em class="xref std std-option">ids</em> option lets you specify a comma separated list of these
identifiers for use with the <strong class="command">user</strong> command.</p>
<p class="last">The <em class="xref std std-option">ids</em> option is used only when using <em class="xref std std-option">remove</em>
or <em class="xref std std-option">show</em>.</p>
</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--info</span></kbd></td>
<td><p class="first">Users are known in buildbot as a collection of attributes tied
together by some unique identifier (see <a class="reference internal" href="#concepts-users"><em>Users</em></a>). These
attributes are specified in the form <tt class="docutils literal"><span class="pre">{TYPE}={VALUE}</span></tt> when
using the <em class="xref std std-option">info</em> option. These <tt class="docutils literal"><span class="pre">{TYPE}={VALUE}</span></tt> pairs
are specified in a comma separated list, so for example:</p>
<div class="highlight-none"><div class="highlight"><pre>--info=svn=jschmo,git=&#39;Joe Schmo &lt;joe@schmo.com&gt;&#39;
</pre></div>
</div>
<p>The <em class="xref std std-option">info</em> option can be specified multiple times in the
<strong class="command">user</strong> command, as each specified option will be interpreted
as a new user. Note that <em class="xref std std-option">info</em> is only used with <em class="xref std std-option">add</em>
or with <em class="xref std std-option">update</em>, and whenever you use <em class="xref std std-option">update</em> you need
to specify the identifier of the user you want to update. This is done
by prepending the <em class="xref std std-option">info</em> arguments with <tt class="docutils literal"><span class="pre">{ID:}</span></tt>. If we were
to update <tt class="docutils literal"><span class="pre">'jschmo'</span></tt> from the previous example, it would look like this:</p>
<div class="last highlight-none"><div class="highlight"><pre>--info=jschmo:git=&#39;Joseph Schmo &lt;joe@schmo.com&gt;&#39;
</pre></div>
</div>
</td></tr>
</tbody>
</table>
<p>Note that <em class="xref std std-option">--master</em>, <em class="xref std std-option">--username</em>, <em class="xref std std-option">--passwd</em>, and
<em class="xref std std-option">--op</em> are always required to issue the <strong class="command">user</strong> command.</p>
<p>The <em class="xref std std-option">--master</em>, <em class="xref std std-option">--username</em>, and <em class="xref std std-option">--passwd</em> options
can be specified in the option file with keywords <em class="xref std std-option">user_master</em>,
<em class="xref std std-option">user_username</em>, and <em class="xref std std-option">user_passwd</em>, respectively.  If
<em class="xref std std-option">user_master</em> is not specified, then <em class="xref std std-option">master</em> from the options
file will be used instead.</p>
<p>Below are examples of how each command should look. Whenever a
<strong class="command">user</strong> command is successful, results will be shown
to whoever issued the command.</p>
<p>For <em class="xref std std-option">add</em>:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot user --master={MASTERHOST} --op=add \
        --username={USER} --passwd={USERPW} \
        --info={TYPE}={VALUE},...
</pre></div>
</div>
<p>For <em class="xref std std-option">update</em>:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot user --master={MASTERHOST} --op=update \
        --username={USER} --passwd={USERPW} \
        --info={ID}:{TYPE}={VALUE},...
</pre></div>
</div>
<p>For <em class="xref std std-option">remove</em>:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot user --master={MASTERHOST} --op=remove \
        --username={USER} --passwd={USERPW} \
        --ids={ID1},{ID2},...
</pre></div>
</div>
<p>For <em class="xref std std-option">get</em>:</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot user --master={MASTERHOST} --op=get \
        --username={USER} --passwd={USERPW} \
        --ids={ID1},{ID2},...
</pre></div>
</div>
<p>A note on <em class="xref std std-option">update</em>: when updating the <em class="xref std std-option">bb_username</em>
and <em class="xref std std-option">bb_password</em>, the <em class="xref std std-option">info</em> doesn't need to have
additional <tt class="docutils literal"><span class="pre">{TYPE}={VALUE}</span></tt> pairs to update and can just take
the <tt class="docutils literal"><span class="pre">{ID}</span></tt> portion.</p>
</div>
</div>
<div class="section" id="buildbot-config-directory">
<span id="id3"></span><h5>.buildbot config directory<a class="headerlink" href="#buildbot-config-directory" title="Permalink to this headline">¶</a></h5>
<p>Many of the <strong class="command">buildbot</strong> tools must be told how to contact the
buildmaster that they interact with. This specification can be
provided as a command-line argument, but most of the time it will be
easier to set them in an <tt class="docutils literal"><span class="pre">options</span></tt> file. The <strong class="command">buildbot</strong>
command will look for a special directory named <tt class="file docutils literal"><span class="pre">.buildbot</span></tt>,
starting from the current directory (where the command was run) and
crawling upwards, eventually looking in the user's home directory. It
will look for a file named <tt class="file docutils literal"><span class="pre">options</span></tt> in this directory, and will
evaluate it as a python script, looking for certain names to be set.
You can just put simple <tt class="docutils literal"><span class="pre">name</span> <span class="pre">=</span> <span class="pre">'value'</span></tt> pairs in this file to
set the options.</p>
<p>For a description of the names used in this file, please see the
documentation for the individual <strong class="command">buildbot</strong> sub-commands. The
following is a brief sample of what this file's contents could be.</p>
<div class="highlight-none"><div class="highlight"><pre># for status-reading tools
masterstatus = &#39;buildbot.example.org:12345&#39;
# for &#39;sendchange&#39; or the debug port
master = &#39;buildbot.example.org:18990&#39;
debugPassword = &#39;eiv7Po&#39;
</pre></div>
</div>
<p>Note carefully that the names in the <tt class="file docutils literal"><span class="pre">options</span></tt> file usually do not match
the command-line option name.</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">masterstatus</span></tt></dt>
<dd>Equivalent to <em class="xref std std-option">--master</em> for <a class="reference internal" href="#cmdline-statuslog" title="statuslog"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">statuslog</span></tt></a> and <a class="reference internal" href="#cmdline-statusgui" title="statusgui"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">statusgui</span></tt></a>, this
gives the location of the <tt class="xref py py-class docutils literal"><span class="pre">client.PBListener</span></tt> status port.</dd>
<dt><tt class="docutils literal"><span class="pre">master</span></tt></dt>
<dd>Equivalent to <em class="xref std std-option">--master</em> for <a class="reference internal" href="#cmdline-debugclient" title="debugclient"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">debugclient</span></tt></a> and <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">sendchange</span></tt></a>.
This option is used for two purposes.  It is the location of the
<tt class="docutils literal"><span class="pre">debugPort</span></tt> for <tt class="docutils literal"><span class="pre">debugclient</span></tt> and the location of the
<tt class="xref py py-class docutils literal"><span class="pre">pb.PBChangeSource</span></tt> for <tt class="docutils literal"><span class="pre">`sendchange</span></tt>.  Generally these are the
same port.</dd>
<dt><tt class="docutils literal"><span class="pre">debugPassword</span></tt></dt>
<dd><p class="first">Equivalent to <em class="xref std std-option">--passwd</em> for <a class="reference internal" href="#cmdline-debugclient" title="debugclient"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">debugclient</span></tt></a>.</p>
<div class="last admonition important">
<p class="first admonition-title">Important</p>
<p class="last">This value must match the value of <a class="reference internal" href="#cfg-debugPassword" title="debugPassword"><tt class="xref bb bb-cfg docutils literal"><span class="pre">debugPassword</span></tt></a>, used to
protect the debug port, for the <a class="reference internal" href="#cmdline-debugclient" title="debugclient"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">debugclient</span></tt></a> command.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">username</span></tt></dt>
<dd>Equivalent to <em class="xref std std-option">--username</em> for the <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">sendchange</span></tt></a> command.</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd>Equivalent to <em class="xref std std-option">--branch</em> for the <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">sendchange</span></tt></a> command.</dd>
<dt><tt class="docutils literal"><span class="pre">category</span></tt></dt>
<dd>Equivalent to <em class="xref std std-option">--category</em> for the <a class="reference internal" href="#cmdline-sendchange" title="sendchange"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">sendchange</span></tt></a> command.</dd>
<dt><tt class="docutils literal"><span class="pre">try_connect</span></tt></dt>
<dd>Equivalent to <em class="xref std std-option">--connect</em>, this specifies how the <a class="reference internal" href="#cmdline-try" title="try"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">try</span></tt></a> command should
deliver its request to the buildmaster. The currently accepted values are
<tt class="docutils literal"><span class="pre">ssh</span></tt> and <tt class="docutils literal"><span class="pre">pb</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">try_builders</span></tt></dt>
<dd>Equivalent to <em class="xref std std-option">--builders</em>, specifies which builders should be used for
the <a class="reference internal" href="#cmdline-try" title="try"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">try</span></tt></a> build.</dd>
<dt><tt class="docutils literal"><span class="pre">try_vc</span></tt></dt>
<dd>Equivalent to <em class="xref std std-option">--vc</em> for <a class="reference internal" href="#cmdline-try" title="try"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">try</span></tt></a>, this specifies the version control
system being used.</dd>
<dt><tt class="docutils literal"><span class="pre">try_branch</span></tt></dt>
<dd>Equivlanent to <em class="xref std std-option">--branch</em>, this indicates that the current tree is on a
non-trunk branch.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">try_topdir</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">try_topfile</span></tt></dt>
<dd>Use <tt class="docutils literal"><span class="pre">try_topdir</span></tt>, equivalent to <em class="xref std std-option">--try-topdir</em>, to explicitly
indicate the top of your working tree, or <tt class="docutils literal"><span class="pre">try_topfile</span></tt>, equivalent to
<em class="xref std std-option">--try-topfile</em> to name a file that will only be found in that top-most
directory.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">try_host</span></tt></p>
<p><tt class="docutils literal"><span class="pre">try_username</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">try_dir</span></tt></dt>
<dd>When <tt class="docutils literal"><span class="pre">try_connect</span></tt> is <tt class="docutils literal"><span class="pre">ssh</span></tt>, the command will use <tt class="docutils literal"><span class="pre">try_host</span></tt> for
<em class="xref std std-option">--tryhost</em>, <tt class="docutils literal"><span class="pre">try_username</span></tt> for <em class="xref std std-option">--username</em>, and <tt class="docutils literal"><span class="pre">try_dir</span></tt>
for <em class="xref std std-option">--trydir</em>.  Apologies for the confusing presence and absence of
'try'.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">try_username</span></tt></p>
<p><tt class="docutils literal"><span class="pre">try_password</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">try_master</span></tt></dt>
<dd>Similarly, when <tt class="docutils literal"><span class="pre">try_connect</span></tt> is <tt class="docutils literal"><span class="pre">pb</span></tt>, the command will pay attention to
<tt class="docutils literal"><span class="pre">try_username</span></tt> for <em class="xref std std-option">--username</em>, <tt class="docutils literal"><span class="pre">try_password</span></tt> for
<em class="xref std std-option">--passwd</em>, and <tt class="docutils literal"><span class="pre">try_master</span></tt> for <em class="xref std std-option">--master</em>.</dd>
</dl>
<p><tt class="docutils literal"><span class="pre">try_wait</span></tt></p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">masterstatus</span></tt></dt>
<dd><tt class="docutils literal"><span class="pre">try_wait</span></tt> and <tt class="docutils literal"><span class="pre">masterstatus</span></tt> (equivalent to <em class="xref std std-option">--wait</em> and
<tt class="docutils literal"><span class="pre">master</span></tt>, respectively) are used to ask the <a class="reference internal" href="#cmdline-try" title="try"><tt class="xref bb bb-cmdline docutils literal"><span class="pre">try</span></tt></a> command to wait for
the requested build to complete.</dd>
</dl>
</div>
</div>
<div class="section" id="buildslave">
<h4>buildslave<a class="headerlink" href="#buildslave" title="Permalink to this headline">¶</a></h4>
<p><strong class="command">buildslave</strong> command-line tool is used for buildslave management
only and does not provide any additional functionality. One can create,
start, stop and restart the buildslave.</p>
<div class="section" id="create-slave">
<span id="cmdline-create-slave"></span><h5>create-slave<a class="headerlink" href="#create-slave" title="Permalink to this headline">¶</a></h5>
<p>This creates a new directory and populates it with files that let it
be used as a buildslave's base directory. You must provide several
arguments, which are used to create the initial <tt class="file docutils literal"><span class="pre">buildbot.tac</span></tt>
file.</p>
<p>The <em class="xref std std-option">-r</em> option is advisable here, just like for <tt class="docutils literal"><span class="pre">create-master</span></tt>.</p>
<div class="highlight-none"><div class="highlight"><pre>buildslave create-slave -r {BASEDIR} {MASTERHOST}:{PORT} {SLAVENAME} {PASSWORD}
</pre></div>
</div>
<p>The create-slave options are described in <a class="reference internal" href="#buildslave-options"><em>Buildslave Options</em></a>.</p>
</div>
<div class="section" id="cmdline-start (buildslave)">
<span id="id4"></span><h5>start<a class="headerlink" href="#cmdline-start (buildslave)" title="Permalink to this headline">¶</a></h5>
<p>This starts a buildslave which was already created in the given base
directory. The daemon is launched in the background, with events logged
to a file named <tt class="file docutils literal"><span class="pre">twistd.log</span></tt>.</p>
<div class="highlight-none"><div class="highlight"><pre>buildslave start [--nodaemon] BASEDIR
</pre></div>
</div>
<p>The <em class="xref std std-option">--nodaemon</em> option instructs Buildbot to skip daemonizing. The
process will start in the foreground.  It will only return to the command-line
when it is stopped.</p>
</div>
<div class="section" id="cmdline-restart (buildslave)">
<span id="id5"></span><h5>restart<a class="headerlink" href="#cmdline-restart (buildslave)" title="Permalink to this headline">¶</a></h5>
<div class="highlight-none"><div class="highlight"><pre>buildslave restart [--nodaemon] BASEDIR
</pre></div>
</div>
<p>This restarts a buildslave which is already running.
It is equivalent to a <tt class="docutils literal"><span class="pre">stop</span></tt> followed by a <tt class="docutils literal"><span class="pre">start</span></tt>.</p>
<p>The <em class="xref std std-option">--nodaemon</em> option has the same meaning as for <tt class="docutils literal"><span class="pre">start</span></tt>.</p>
</div>
<div class="section" id="cmdline-stop (buildslave)">
<span id="id6"></span><h5>stop<a class="headerlink" href="#cmdline-stop (buildslave)" title="Permalink to this headline">¶</a></h5>
<p>This terminates the daemon buildslave running in the given directory.</p>
<div class="highlight-none"><div class="highlight"><pre>buildbot stop BASEDIR
</pre></div>
</div>
</div>
</div>
</div>
<span id="document-manual/resources"></span><div class="section" id="resources">
<span id="id1"></span><h3>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h3>
<p>The Buildbot home page is <a class="reference external" href="http://buildbot.net/">http://buildbot.net/</a>.</p>
<p>For configuration questions and general discussion, please use the
<tt class="docutils literal"><span class="pre">buildbot-devel</span></tt> mailing list. The subscription instructions and
archives are available at
<a class="reference external" href="http://lists.sourceforge.net/lists/listinfo/buildbot-devel">http://lists.sourceforge.net/lists/listinfo/buildbot-devel</a></p>
<p>The <tt class="docutils literal"><span class="pre">#buildbot</span></tt> channel on Freenode's IRC servers hosts development discussion, and
often folks are available to answer questions there, as well.</p>
</div>
</div>
</div>
<span id="document-developer/index"></span><div class="section" id="buildbot-development">
<span id="id1"></span><h2>Buildbot Development<a class="headerlink" href="#buildbot-development" title="Permalink to this headline">¶</a></h2>
<p>This chapter is the official repository for the collected wisdom of the
Buildbot hackers.  It is intended both for developers writing patches that will
be included in Buildbot itself, and for advanced users who wish to customize
Buildbot.</p>
<div class="toctree-wrapper compound">
<span id="document-developer/master-overview"></span><div class="section" id="master-organization">
<span id="master-service-hierarchy"></span><h3>Master Organization<a class="headerlink" href="#master-organization" title="Permalink to this headline">¶</a></h3>
<p>Buildbot makes heavy use of Twisted Python's support for services - software
modules that can be started and stopped dynamically.  Buildbot adds the ability
to reconfigure such services, too - see <a class="reference internal" href="#developer-reconfiguration"><em>Reconfiguration</em></a>.
Twisted arranges services into trees; the following section describes the
service tree on a running master.</p>
<div class="section" id="buildmaster-service-hierarchy">
<h4>Buildmaster Service Hierarchy<a class="headerlink" href="#buildmaster-service-hierarchy" title="Permalink to this headline">¶</a></h4>
<p>The hierarchy begins with the master, a <tt class="xref py py-class docutils literal"><span class="pre">buildbot.master.BuildMaster</span></tt>
instance.  Most other services contain a reference to this object in their
<tt class="docutils literal"><span class="pre">master</span></tt> attribute, and in general the appropriate way to access other
objects or services is to begin with <tt class="docutils literal"><span class="pre">self.master</span></tt> and navigate from there.</p>
<p>The master has several child services:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">master.metrics</span></tt></dt>
<dd>A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.metrics.MetricLogObserver</span></tt> instance that
handles tracking and reporting on master metrics.</dd>
<dt><tt class="docutils literal"><span class="pre">msater.caches</span></tt></dt>
<dd>A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.caches.CacheManager</span></tt> instance that provides
access to object caches.</dd>
<dt><tt class="docutils literal"><span class="pre">master.pbmanager</span></tt></dt>
<dd>A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.pbmanager.PBManager</span></tt> instance that handles incoming
PB connections, potentially on multiple ports, and dispatching those
connections to appropriate components based on the supplied username.</dd>
<dt><tt class="docutils literal"><span class="pre">master.change_svc</span></tt></dt>
<dd>A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.changes.manager.ChangeManager</span></tt> instance that manages
the active change sources, as well as the stream of changes received from
those sources.  All active change sources are child services of this instance.</dd>
<dt><tt class="docutils literal"><span class="pre">master.botmaster</span></tt></dt>
<dd><p class="first">A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.botmaster.BotMaster</span></tt> instance that manages
all of the slaves and builders as child services.</p>
<p class="last">The botmaster acts as the parent service for a
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.botmaster.BuildRequestDistributor</span></tt> instance (at
<tt class="docutils literal"><span class="pre">master.botmaster.brd</span></tt>) as well as all active slaves
(<tt class="xref py py-class docutils literal"><span class="pre">buildbot.buildslave.AbstractBuildSlave</span></tt> instances) and builders
(<tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.builder.Builder</span></tt> instances).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">master.scheduler_manager</span></tt></dt>
<dd>A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.schedulers.manager.SchedulerManager</span></tt> instance that
manages the active schedulers.  All active schedulers are child services of
this instance.</dd>
<dt><tt class="docutils literal"><span class="pre">master.user_manager</span></tt></dt>
<dd>A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.users.manager.UserManagerManager</span></tt> instance
that manages access to users.  All active user managers are child services
of this instance.</dd>
<dt><tt class="docutils literal"><span class="pre">master.db</span></tt></dt>
<dd>A <a class="reference internal" href="#buildbot.db.connector.DBConnector" title="buildbot.db.connector.DBConnector"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.db.connector.DBConnector</span></tt></a> instance that manages
access to the buildbot database.  See <a class="reference internal" href="#developer-database"><em>Database</em></a> for more
information.</dd>
<dt><tt class="docutils literal"><span class="pre">master.debug</span></tt></dt>
<dd>A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.debug.DebugServices</span></tt> instance that manages
debugging-related access -- the debug client and manhole.</dd>
<dt><tt class="docutils literal"><span class="pre">master.status</span></tt></dt>
<dd>A <tt class="xref py py-class docutils literal"><span class="pre">buildbot.status.master.Status</span></tt> instance that provides access
to all status data.  This instance is also the service parent for all
status listeners.</dd>
</dl>
</div>
</div>
<span id="document-developer/definitions"></span><div class="section" id="definitions">
<h3>Definitions<a class="headerlink" href="#definitions" title="Permalink to this headline">¶</a></h3>
<p>Buildbot uses some terms and concepts that have specific meanings.</p>
<div class="section" id="repository">
<h4>Repository<a class="headerlink" href="#repository" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="#attr-repository"><em>Repository</em></a>.</p>
</div>
<div class="section" id="project">
<h4>Project<a class="headerlink" href="#project" title="Permalink to this headline">¶</a></h4>
<p>See <a class="reference internal" href="#attr-project"><em>Project</em></a>.</p>
</div>
<div class="section" id="version-control-comparison">
<h4>Version Control Comparison<a class="headerlink" href="#version-control-comparison" title="Permalink to this headline">¶</a></h4>
<p>Buildbot supports a number of version control systems, and they don't all agree
on their terms.  This table should help to disambiguate them.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="21%" />
<col width="21%" />
<col width="37%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Change</th>
<th class="head">Revision</th>
<th class="head">Branches</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>CVS</td>
<td>patch [1]</td>
<td>timestamp</td>
<td>unnamed</td>
</tr>
<tr class="row-odd"><td>Subversion</td>
<td>revision</td>
<td>integer</td>
<td>directories</td>
</tr>
<tr class="row-even"><td>Git</td>
<td>commit</td>
<td>sha1 hash</td>
<td>named refs</td>
</tr>
<tr class="row-odd"><td>Mercurial</td>
<td>changeset</td>
<td>sha1 hash</td>
<td>different repos
or (permanently)
named commits</td>
</tr>
<tr class="row-even"><td>Darcs</td>
<td>?</td>
<td>none [2]</td>
<td>different repos</td>
</tr>
<tr class="row-odd"><td>Bazaar</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr class="row-even"><td>Perforce</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr class="row-odd"><td>BitKeeper</td>
<td>changeset</td>
<td>?</td>
<td>different repos</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>[1] note that CVS only tracks patches to individual files.  Buildbot tries to
recognize coordinated changes to multiple files by correlating change times.</li>
<li>[2] Darcs does not have a concise way of representing a particular revision
of the source.</li>
</ul>
</div>
</div>
<span id="document-developer/style"></span><div class="section" id="buildbot-coding-style">
<h3>Buildbot Coding Style<a class="headerlink" href="#buildbot-coding-style" title="Permalink to this headline">¶</a></h3>
<div class="section" id="symbol-names">
<h4>Symbol Names<a class="headerlink" href="#symbol-names" title="Permalink to this headline">¶</a></h4>
<p>Buildbot follows <a class="reference external" href="http://www.python.org/dev/peps/pep-0008/">PEP8</a> regarding
the formatting of symbol names.</p>
<p>The single exception in naming of functions and methods. Because Buildbot uses
Twisted so heavily, and Twisted uses interCaps, Buildbot methods should do the
same. That is, you should spell methods and functions with the first character
in lower-case, and the first letter of subsequent words capitalized, e.g.,
<tt class="docutils literal"><span class="pre">compareToOther</span></tt> or <tt class="docutils literal"><span class="pre">getChangesGreaterThan</span></tt>. This point is not applied very
consistently in Buildbot, but let's try to be consistent in new code.</p>
</div>
<div class="section" id="twisted-idioms">
<h4>Twisted Idioms<a class="headerlink" href="#twisted-idioms" title="Permalink to this headline">¶</a></h4>
<p>Programming with Twisted Python can be daunting.  But sticking to a few
well-defined patterns can help avoid surprises.</p>
<div class="section" id="prefer-to-return-deferreds">
<h5>Prefer to Return Deferreds<a class="headerlink" href="#prefer-to-return-deferreds" title="Permalink to this headline">¶</a></h5>
<p>If you're writing a method that doesn't currently block, but could conceivably
block sometime in the future, return a Deferred and document that it does so.
Just about anything might block - even getters and setters!</p>
</div>
<div class="section" id="helpful-twisted-classes">
<h5>Helpful Twisted Classes<a class="headerlink" href="#helpful-twisted-classes" title="Permalink to this headline">¶</a></h5>
<p>Twisted has some useful, but little-known classes.
Brief descriptions follow, but you should consult the API documentation or source code
for the full details.</p>
<dl class="docutils">
<dt><tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.task.LoopingCall</span></tt></dt>
<dd>Calls an asynchronous function repeatedly at set intervals.</dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">twisted.application.internet.TimerService</span></tt></dt>
<dd>Similar to <tt class="docutils literal"><span class="pre">t.i.t.LoopingCall</span></tt>, but implemented as a service that will
automatically start and stop the function calls when the service starts and
stops.</dd>
</dl>
</div>
<div class="section" id="sequences-of-operations">
<h5>Sequences of Operations<a class="headerlink" href="#sequences-of-operations" title="Permalink to this headline">¶</a></h5>
<p>Especially in Buildbot, we're often faced with executing a sequence of
operations, many of which may block.</p>
<p>In all cases where this occurs, there is a danger of pre-emption, so exercise
the same caution you would if writing a threaded application.</p>
<p>For simple cases, you can use nested callback functions. For more complex cases, deferredGenerator is appropriate.</p>
<div class="section" id="nested-callbacks">
<h6>Nested Callbacks<a class="headerlink" href="#nested-callbacks" title="Permalink to this headline">¶</a></h6>
<p>First, an admonition: do not create extra class methods that represent the continuations of the first:</p>
<div class="highlight-python"><pre>def myMethod(self):
    d = ...
    d.addCallback(self._myMethod_2) # BAD!
def _myMethod_2(self, res):         # BAD!
    # ...</pre>
</div>
<p>Invariably, this extra method gets separated from its parent as the code
evolves, and the result is completely unreadable. Instead, include all of the
code for a particular function or method within the same indented block, using
nested functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">getRevInfo</span><span class="p">(</span><span class="n">revname</span><span class="p">):</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rev_parse</span><span class="p">(</span><span class="n">_</span><span class="p">):</span> <span class="c"># note use of &#39;_&#39; to quietly indicate an ignored parameter</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="n">revname</span> <span class="p">])</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">rev_parse</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parse_rev_parse</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;rev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;log&#39;</span><span class="p">,</span> <span class="s">&#39;-1&#39;</span><span class="p">,</span> <span class="s">&#39;--format=</span><span class="si">%s</span><span class="s">%n%b&#39;</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="s">&#39;rev&#39;</span><span class="p">]</span> <span class="p">])</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">parse_rev_parse</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">parse_log</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="n">results</span><span class="p">[</span><span class="s">&#39;comments&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">parse_log</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_results</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">results</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">set_results</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>it is usually best to make the first operation occur within a callback, as the
deferred machinery will then handle any exceptions as a failure in the outer
Deferred.  As a shortcut, <tt class="docutils literal"><span class="pre">d.addCallback</span></tt> works as a decorator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">d</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="nd">@d.addCallback</span>
<span class="k">def</span> <span class="nf">rev_parse</span><span class="p">(</span><span class="n">_</span><span class="p">):</span> <span class="c"># note use of &#39;_&#39; to quietly indicate an ignored parameter</span>
    <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">getProcessOutput</span><span class="p">(</span><span class="n">git</span><span class="p">,</span> <span class="p">[</span> <span class="s">&#39;rev-parse&#39;</span><span class="p">,</span> <span class="n">revname</span> <span class="p">])</span>
</pre></div>
</div>
<p>Be careful with local variables. For example, if <tt class="docutils literal"><span class="pre">parse_rev_parse</span></tt>, above,
merely assigned <tt class="docutils literal"><span class="pre">rev</span> <span class="pre">=</span> <span class="pre">res.strip()</span></tt>, then that variable would be local to
<tt class="docutils literal"><span class="pre">parse_rev_parse</span></tt> and not available in <tt class="docutils literal"><span class="pre">set_results</span></tt>. Mutable variables
(dicts and lists) at the outer function level are appropriate for this purpose.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">do not try to build a loop in this style by chaining multiple
Deferreds!  Unbounded chaining can result in stack overflows, at least on older
versions of Twisted. Use <tt class="docutils literal"><span class="pre">deferredGenerator</span></tt> instead.</p>
</div>
</div>
<div class="section" id="inlinecallbacks">
<h6>inlineCallbacks<a class="headerlink" href="#inlinecallbacks" title="Permalink to this headline">¶</a></h6>
<p><tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.inlineCallbacks</span></tt> is a great help to writing code
that makes a lot of asynchronous calls, particularly if those calls are made in
loop or conditionals.  Refer to the Twisted documentation for the details, but
the style within Buildbot is as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">twisted.internet</span> <span class="kn">import</span> <span class="n">defer</span>

<span class="nd">@defer.inlineCallbacks</span>
<span class="k">def</span> <span class="nf">mymethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">xval</span> <span class="o">=</span> <span class="k">yield</span> <span class="n">getSomething</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="p">(</span><span class="k">yield</span> <span class="n">getZValues</span><span class="p">()):</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">z</span>

    <span class="k">if</span> <span class="n">xval</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">xval</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">someOtherMethod</span><span class="p">()</span>
</pre></div>
</div>
<p>The key points to notice here:</p>
<ul class="simple">
<li>Always import <tt class="docutils literal"><span class="pre">defer</span></tt> as a module, not the names within it.</li>
<li>Use the decorator form of <tt class="docutils literal"><span class="pre">inlineCallbacks</span></tt></li>
<li>In most cases, the result of a <tt class="docutils literal"><span class="pre">yield</span></tt> expression should be assigned to a
variable.  It can be used in a larger expression, but remember that Python
requires that you enclose the expression in its own set of parentheses.</li>
<li>Python does not permit returning a value from a generator, so statements like
<tt class="docutils literal"><span class="pre">return</span> <span class="pre">xval</span> <span class="pre">+</span> <span class="pre">y</span></tt> are invalid.  Instead, yield the result of
<tt class="docutils literal"><span class="pre">defer.returnValue</span></tt>.  Although this function does cause an immediate
function exit, for clarity follow it with a bare <tt class="docutils literal"><span class="pre">return</span></tt>, as in
the example, unless it is the last statement in a function.</li>
</ul>
<p>The great advantage of <tt class="docutils literal"><span class="pre">inlineCallbacks</span></tt> is that it allows you to use all
of the usual Pythonic control structures in their natural form. In particular,
it is easy to represent a loop, or even nested loops, in this style without
losing any readability.</p>
<p>Note that code using <tt class="docutils literal"><span class="pre">deferredGenerator</span></tt> is no longer acceptable in Buildbot.</p>
</div>
<div class="section" id="locking">
<h6>Locking<a class="headerlink" href="#locking" title="Permalink to this headline">¶</a></h6>
<p>Remember that asynchronous programming does not free you from the need to worry
about concurrency issues.  Particularly if you are executing a sequence of
operations, each time you wait for a Deferred, arbitrary other actions can take
place.</p>
<p>In general, you should try to perform actions atomically, but for the rare
situations that require synchronization, the following might be useful:</p>
<ul class="simple">
<li><tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.DeferredLock</span></tt></li>
<li><a class="reference internal" href="#buildbot.util.misc.deferredLocked" title="buildbot.util.misc.deferredLocked"><tt class="xref py py-func docutils literal"><span class="pre">buildbot.util.misc.deferredLocked</span></tt></a></li>
<li><a class="reference internal" href="#buildbot.util.misc.SerializedInvocation" title="buildbot.util.misc.SerializedInvocation"><tt class="xref py py-func docutils literal"><span class="pre">buildbot.util.misc.SerializedInvocation</span></tt></a></li>
</ul>
</div>
</div>
<div class="section" id="joining-sequences">
<h5>Joining Sequences<a class="headerlink" href="#joining-sequences" title="Permalink to this headline">¶</a></h5>
<p>It's often the case that you'll want to perform multiple operations in
parallel, and re-join the results at the end. For this purpose, you'll want to
use a <a class="reference external" href="http://twistedmatrix.com/documents/current/api/twisted.internet.defer.DeferredList.html">DeferredList</a></p>
<div class="highlight-python"><pre>def getRevInfo(revname):
    results = {}
    finished = dict(rev_parse=False, log=False)

    rev_parse_d = utils.getProcessOutput(git, [ 'rev-parse', revname ])
    def parse_rev_parse(res):
        return res.strip()
    rev_parse_d.addCallback(parse_rev_parse)

    log_d = utils.getProcessOutput(git, [ 'log', '-1', '--format=%s%n%b', results['rev'] ]))
    def parse_log(res):
        return res.strip()
    log_d.addCallback(parse_log)

    d = defer.DeferredList([rev_parse_d, log_d], consumeErrors=1, fireOnFirstErrback=1)
    def handle_results(results):
        return dict(rev=results[0][1], log=results[1][1])
    d.addCallback(handle_results)
    return d</pre>
</div>
<p>Here the deferred list will wait for both <tt class="docutils literal"><span class="pre">rev_parse_d</span></tt> and <tt class="docutils literal"><span class="pre">log_d</span></tt> to
fire, or for one of them to fail. You may attach  Callbacks and errbacks to a
<tt class="docutils literal"><span class="pre">DeferredList</span></tt> just as for a deferred.</p>
</div>
</div>
</div>
<span id="document-developer/tests"></span><div class="section" id="buildbot-s-test-suite">
<h3>Buildbot's Test Suite<a class="headerlink" href="#buildbot-s-test-suite" title="Permalink to this headline">¶</a></h3>
<p>Buildbot's tests are under <tt class="docutils literal"><span class="pre">buildbot.test</span></tt> and, for the buildslave,
<tt class="docutils literal"><span class="pre">buildslave.test</span></tt>.  Tests for the slave are similar to the master, although
in some cases helpful functionality on the master is not re-implemented on the
slave.</p>
<div class="section" id="suites">
<h4>Suites<a class="headerlink" href="#suites" title="Permalink to this headline">¶</a></h4>
<p>Tests are divided into a few suites:</p>
<ul class="simple">
<li>Unit tests (<tt class="docutils literal"><span class="pre">buildbot.test.unit</span></tt>) - these follow unit-testing practices and
attempt to maximally isolate the system under test.  Unit tests are the main
mechanism of achieving test coverage, and all new code should be well-covered
by corresponding unit tests.</li>
<li>Interface tests (<tt class="docutils literal"><span class="pre">buildbot.test.interface</span></tt>).  In many cases, Buildbot has
multiple implementations of the same interface -- at least one &quot;real&quot;
implementation and a fake implementation used in unit testing.  The interface
tests ensure that these implementations all meet the same standards.  This
ensures consistency between implementations, and also ensures that the unit
tests are testing against realistic fakes.</li>
<li>Integration tests (<tt class="docutils literal"><span class="pre">buildbot.test.integration</span></tt>) - these test combinations
of multiple units.  Of necessity, integration tests are incomplete - they
cannot test every condition; difficult to maintain - they tend to be complex
and touch a lot of code; and slow - they usually require considerable setup
and execute a lot of code.  As such, use of integration tests is limited to a
few, broad tests to act as a failsafe for the unit and interface tests.</li>
<li>Regression tests (<tt class="docutils literal"><span class="pre">buildbot.test.regrssions</span></tt>) - these test to prevent
re-occurrence of historical bugs.  In most cases, a regression is better
tested by a test in the other suites, or unlike to recur, so this suite tends
to be small.</li>
<li>Fuzz tests (<tt class="docutils literal"><span class="pre">buildbot.test.fuzz</span></tt>) - these tests run for a long time and
apply randomization to try to reproduce rare or unusual failures.  The
Buildbot project does not currently have a framework to run fuzz tests
regularly.</li>
</ul>
<div class="section" id="unit-tests">
<h5>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h5>
<p>Every code module should have corresponding unit tests.  This is not currently
true of Buildbot, due to a large body of legacy code, but is a goal of the
project.  All new code must meet this requirement.</p>
<p>Unit test modules are be named after the package or class they test, replacing
<tt class="docutils literal"><span class="pre">.</span></tt> with <tt class="docutils literal"><span class="pre">_</span></tt> and omitting the <tt class="docutils literal"><span class="pre">buildbot_</span></tt>. For example,
<tt class="file docutils literal"><span class="pre">test_status_web_authz_Authz.py</span></tt> tests the <tt class="xref py py-class docutils literal"><span class="pre">Authz</span></tt> class in
<tt class="file docutils literal"><span class="pre">buildbot/status/web/authz.py</span></tt>. Modules with only one class, or a few
trivial classes, can be tested in a single test module. For more complex
situations, prefer to use multiple test modules.</p>
</div>
<div class="section" id="interface-tests">
<h5>Interface Tests<a class="headerlink" href="#interface-tests" title="Permalink to this headline">¶</a></h5>
<p>Interface tests exist to verify that multiple implementations of an interface
meet the same requirements.  Note that the name 'interface' should not be
confused with the sparse use of Zope Interfaces in the Buildbot code -- in this
context, an interface is any boundary between testable units.</p>
<p>Ideally, all interfaces, both public and private, should be tested.  Certainly,
any <em>public</em> interfaces need interface tests.</p>
<p>Interface test modules are named after the interface they are testing, e.g.,
<tt class="file docutils literal"><span class="pre">test_mq.py</span></tt>.  They generally begin as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.test.util</span> <span class="kn">import</span> <span class="n">interfaces</span>
<span class="kn">from</span> <span class="nn">twistd.trial</span> <span class="kn">import</span> <span class="n">unittest</span>

<span class="k">class</span> <span class="nc">Tests</span><span class="p">(</span><span class="n">interfaces</span><span class="o">.</span><span class="n">InterfaceTests</span><span class="p">):</span>

    <span class="c"># define methods that must be overridden per implementation</span>
    <span class="k">def</span> <span class="nf">someSetupMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="c"># tests that all implementations must pass</span>
    <span class="k">def</span> <span class="nf">test_signature_someMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@self.assertArgSpecMatches</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">systemUnderTest</span><span class="o">.</span><span class="n">someMethod</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">someMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c"># ...</span>

<span class="k">class</span> <span class="nc">RealTests</span><span class="p">(</span><span class="n">Tests</span><span class="p">):</span>

    <span class="c"># tests that all *real* implementations must pass</span>
    <span class="k">def</span> <span class="nf">test_something_else</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c"># ...</span>
</pre></div>
</div>
<p>All of the test methods are defined here, segregated into tests that all
implementations must pass, and tests that the fake implementation is not
expected to pass.  The <tt class="docutils literal"><span class="pre">test_signature_someMethod</span></tt> test above illustrates the
<tt class="docutils literal"><span class="pre">assertArgSpecMatches</span></tt> decorator, which can be used to compare the argument
specification of a callable with a reference implementation conveniently
written as a nested function.</p>
<p>At the bottom of the test module, a subclass is created for each
implementation, implementing the setup methods that were stubbed out in the
parent classes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">TestFakeThing</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">Tests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">someSetupMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c"># ...</span>

<span class="k">class</span> <span class="nc">TestRealThing</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">RealTests</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">someSetupMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c"># ...</span>
</pre></div>
</div>
<p>For implementations which require optional software, this is the appropriate
place to signal that tests should be skipped when their prerequisites are not
available.</p>
</div>
<div class="section" id="integration-tests">
<h5>Integration Tests<a class="headerlink" href="#integration-tests" title="Permalink to this headline">¶</a></h5>
<p>Integration test modules test several units at once, including their
interactions.  In general, they serve as a catch-all for failures and bugs that
were not detected by the unit and interface tests.  As such, they should not
aim to be exhaustive, but merely representative.</p>
<p>Integration tests are very difficult to maintain if they reach into the
internals of any part of Buildbot.  Where possible, try to use the same means
as a user would to set up, run, and check the results of an integration test.
That may mean writing a <tt class="file docutils literal"><span class="pre">master.cfg</span></tt> to be parsed, and checking the
results by examining the database (or fake DB API) afterward.</p>
</div>
<div class="section" id="regression-tests">
<h5>Regression Tests<a class="headerlink" href="#regression-tests" title="Permalink to this headline">¶</a></h5>
<p>Regression tests are even more rare in Buildbot than integration tests.  In
many cases, a regression test is not necessary -- either the test is
better-suited as a unit or interface test, or the failure is so specific that a
test will never fail again.</p>
<p>Regression tests tend to be closely tied to the code in which the error
occurred.  When that code is refactored, the regression test generally becomes
obsolete, and is deleted.</p>
</div>
<div class="section" id="fuzz-tests">
<h5>Fuzz Tests<a class="headerlink" href="#fuzz-tests" title="Permalink to this headline">¶</a></h5>
<p>Fuzz tests generally run for a fixed amount of time, running randomized tests
against a system.  They do not run at all during normal runs of the Buildbot
tests, unless <tt class="docutils literal"><span class="pre">BUILDBOT_FUZZ</span></tt> is defined. This is accomplished with something
like the following at the end of each test module:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="s">&#39;BUILDBOT_FUZZ&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">LRUCacheFuzzer</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mixins">
<h4>Mixins<a class="headerlink" href="#mixins" title="Permalink to this headline">¶</a></h4>
<p>Buildbot provides a number of purpose-specific mixin classes in
<a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/util" title="master/buildbot/util"><tt class="docutils literal"><span class="pre">master/buildbot/util</span></tt></a>.  These generally define a set of utility
functions as well as <tt class="docutils literal"><span class="pre">setUpXxx</span></tt> and <tt class="docutils literal"><span class="pre">tearDownXxx</span></tt> methods.  These methods
should be called explicitly from your subclass's <tt class="docutils literal"><span class="pre">setUp</span></tt> and <tt class="docutils literal"><span class="pre">tearDown</span></tt>
methods.  Note that some of these methods return Deferreds, which should be
handled properly by the caller.</p>
</div>
<div class="section" id="fakes">
<span id="id1"></span><h4>Fakes<a class="headerlink" href="#fakes" title="Permalink to this headline">¶</a></h4>
<p>Buildbot provides a number of pre-defined fake implementations of internal
interfaces, in <a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/fake" title="master/buildbot/fake"><tt class="docutils literal"><span class="pre">master/buildbot/fake</span></tt></a>.  These are designed to be used
in unit tests to limit the scope of the test.  For example, the fake DB API
eliminates the need to create a real database when testing code that uses the
DB API, and isolates bugs in the system under test from bugs in the real DB
implementation.</p>
<p>The danger of using fakes is that the fake interface and the real interface can
differ.  The interface tests exist to solve this problem.  All fakes should be
fully tested in an integration test, so that the fakes pass the same tests as
the &quot;real&quot; thing.  It is particularly important that the method signatures be
compared.</p>
</div>
<div class="section" id="good-tests">
<h4>Good Tests<a class="headerlink" href="#good-tests" title="Permalink to this headline">¶</a></h4>
<p>Bad tests are worse than no tests at all, since they waste developers' time
wondering &quot;was that a spurious failure?&quot; or &quot;what the heck is this test trying
to do?&quot;  Buildbot needs good tests.  So what makes a good test?</p>
<div class="section" id="independent-of-time">
<span id="tests-independent-of-time"></span><h5>Independent of Time<a class="headerlink" href="#independent-of-time" title="Permalink to this headline">¶</a></h5>
<p>Tests that depend on wall time will fail. As a bonus, they run very slowly. Do
not use <tt class="xref py py-meth docutils literal"><span class="pre">reactor.callLater</span></tt> to wait &quot;long enough&quot; for something to happen.</p>
<p>For testing things that themselves depend on time, consider using
<tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.tasks.Clock</span></tt>.  This may mean passing a clock instance to
the code under test, and propagating that instance as necessary to ensure that
all of the code using <tt class="xref py py-meth docutils literal"><span class="pre">callLater</span></tt> uses it.  Refactoring code for
testability is difficult, but wortwhile.</p>
<p>For testing things that do not depend on time, but for which you cannot detect
the &quot;end&quot; of an operation: add a way to detect the end of the operation!</p>
</div>
<div class="section" id="clean-code">
<h5>Clean Code<a class="headerlink" href="#clean-code" title="Permalink to this headline">¶</a></h5>
<p>Make your tests readable. This is no place to skimp on comments! Others will
attempt to learn about the expected behavior of your class by reading the
tests. As a side note, if you use a <tt class="xref py py-class docutils literal"><span class="pre">Deferred</span></tt> chain in your test, write
the callbacks as nested functions, rather than using methods with funny names:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">testSomething</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">doThisFirst</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">andThisNext</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
        <span class="k">pass</span> <span class="c"># ...</span>
    <span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">andThisNext</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>This isolates the entire test into one indented block. It is OK to add methods
for common functionality, but give them real names and explain in detail what
they do.</p>
</div>
<div class="section" id="good-name">
<h5>Good Name<a class="headerlink" href="#good-name" title="Permalink to this headline">¶</a></h5>
<p>Test method names should follow the pattern <tt class="samp docutils literal"><span class="pre">test_</span><em><span class="pre">METHOD</span></em><span class="pre">_</span><em><span class="pre">CONDITION</span></em></tt>
where <em>METHOD</em> is the method being tested, and <em>CONDITION</em> is the
condition under which it's tested. Since we can't always test a single
method, this is not a hard-and-fast rule.</p>
</div>
<div class="section" id="assert-only-one-thing">
<h5>Assert Only One Thing<a class="headerlink" href="#assert-only-one-thing" title="Permalink to this headline">¶</a></h5>
<p>Where practical, each test should have a single assertion. This may require a
little bit of work to get several related pieces of information into a single
Python object for comparison. The problem with multiple assertions is that, if
the first assertion fails, the remainder are not tested.  The test results then
do not tell the entire story.</p>
</div>
<div class="section" id="prefer-fakes-to-mocks">
<h5>Prefer Fakes to Mocks<a class="headerlink" href="#prefer-fakes-to-mocks" title="Permalink to this headline">¶</a></h5>
<p>Mock objects are too &quot;compliant&quot;, and this often masks errors in the system
under test.  For example, a mis-spelled method name on a mock object will not
raise an exception.</p>
<p>Where possible, use one of the pre-written fake objects (see
<a class="reference internal" href="#fakes"><em>Fakes</em></a>) instead of a mock object.  Fakes
themselves should be well-tested using interface tests.</p>
<p>Where they are appropriate, Mock objects can be constructed easily using the
aptly-named <a class="reference external" href="http://www.voidspace.org.uk/python/mock/">mock</a> module, which is
a requirement for Buildbot's tests.</p>
</div>
<div class="section" id="small-tests">
<h5>Small Tests<a class="headerlink" href="#small-tests" title="Permalink to this headline">¶</a></h5>
<p>The shorter each test is, the better. Test as little code as possible in each test.</p>
<p>It is fine, and in fact encouraged, to write the code under test in such a way
as to facilitate this. As an illustrative example, if you are testing a new
Step subclass, but your tests require instantiating a BuildMaster, you're
probably doing something wrong!</p>
<p>This also applies to test modules.  Several short, easily-digested test modules
are preferred over a 1000-line monster.</p>
</div>
<div class="section" id="isolation">
<h5>Isolation<a class="headerlink" href="#isolation" title="Permalink to this headline">¶</a></h5>
<p>Each test should be maximally independent of other tests. Do not leave files
laying around after your test has finished, and do not assume that some other
test has run beforehand. It's fine to use caching techniques to avoid repeated,
lengthy setup times.</p>
</div>
<div class="section" id="be-correct">
<h5>Be Correct<a class="headerlink" href="#be-correct" title="Permalink to this headline">¶</a></h5>
<p>Tests should be as robust as possible, which at a basic level means using the
available frameworks correctly. All Deferreds should have callbacks and be
chained properly. Error conditions should be checked properly. Race conditions
should not exist (see <a class="reference internal" href="#tests-independent-of-time"><em>Independent of Time</em></a>, above).</p>
</div>
<div class="section" id="be-helpful">
<h5>Be Helpful<a class="headerlink" href="#be-helpful" title="Permalink to this headline">¶</a></h5>
<p>Note that tests will pass most of the time, but the moment when they are most
useful is when they fail.</p>
<p>When the test fails, it should produce output that is helpful to the person
chasing it down. This is particularly important when the tests are run
remotely, in which case the person chasing down the bug does not have access to
the system on which the test fails. A test which fails sporadically with no
more information than &quot;AssertionFailed&quot; is a prime candidate for deletion if
the error isn't obvious. Making the error obvious also includes adding comments
describing the ways a test might fail.</p>
</div>
<div class="section" id="keeping-state">
<h5>Keeping State<a class="headerlink" href="#keeping-state" title="Permalink to this headline">¶</a></h5>
<p>Python does not allow assignment to anything but the innermost local scope or
the global scope with the <tt class="docutils literal"><span class="pre">global</span></tt> keyword.  This presents a problem when
creating nested functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">test_localVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">cb_called</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">def</span> <span class="nf">cb</span><span class="p">():</span>
        <span class="n">cb_called</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">cb</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">cb_called</span><span class="p">)</span> <span class="c"># will fail!</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">cb_called</span> <span class="pre">=</span> <span class="pre">True</span></tt> assigns to a <em>different variable</em> than
<tt class="docutils literal"><span class="pre">cb_called</span> <span class="pre">=</span> <span class="pre">False</span></tt>.  In production code, it's usually best to work around
such problems, but in tests this is often the clearest way to express the
behavior under test.</p>
<p>The solution is to change something in a common mutable object.  While a simple
list can serve as such a mutable object, this leads to code that is hard to
read.  Instead, use <tt class="xref py py-class docutils literal"><span class="pre">State</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.test.state</span> <span class="kn">import</span> <span class="n">State</span>

<span class="k">def</span> <span class="nf">test_localVariable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">State</span><span class="p">(</span><span class="n">cb_called</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">cb</span><span class="p">():</span>
        <span class="n">state</span><span class="o">.</span><span class="n">cb_called</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">cb</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">cb_called</span><span class="p">)</span> <span class="c"># passes</span>
</pre></div>
</div>
<p>This is almost as readable as the first example, but it actually works.</p>
</div>
</div>
</div>
<span id="document-developer/config"></span><div class="section" id="module-buildbot.config">
<span id="configuration"></span><h3>Configuration<a class="headerlink" href="#module-buildbot.config" title="Permalink to this headline">¶</a></h3>
<p>Wherever possible, Buildbot components should access configuration information
as needed from the canonical source, <tt class="docutils literal"><span class="pre">master.config</span></tt>, which is an instance of
<a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><tt class="xref py py-class docutils literal"><span class="pre">MasterConfig</span></tt></a>.  For example, components should not keep a copy of
the <tt class="docutils literal"><span class="pre">buildbotURL</span></tt> locally, as this value may change throughout the lifetime
of the master.</p>
<p>Components which need to be notified of changes in the configuration should be
implemented as services, subclassing <a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin" title="buildbot.config.ReconfigurableServiceMixin"><tt class="xref py py-class docutils literal"><span class="pre">ReconfigurableServiceMixin</span></tt></a>, as
described in <a class="reference internal" href="#developer-reconfiguration"><em>Reconfiguration</em></a>.</p>
<dl class="class">
<dt id="buildbot.config.MasterConfig">
<em class="property">class </em><tt class="descclassname">buildbot.config.</tt><tt class="descname">MasterConfig</tt><a class="headerlink" href="#buildbot.config.MasterConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>The master object makes much of the configuration available from an object
named <tt class="docutils literal"><span class="pre">master.config</span></tt>.  Configuration is stored as attributes of this
object.  Where possible, other Buildbot components should access this
configuration directly and not cache the configuration values anywhere
else.  This avoids the need to ensure that update-from-configuration
methods are called on a reconfig.</p>
<p>Aside from validating the configuration, this class handles any
backward-compatibility issues - renamed parameters, type changes, and so on
- removing those concerns from other parts of Buildbot.</p>
<p>This class may be instantiated directly, creating an entirely default
configuration, or via <a class="reference internal" href="#buildbot.config.MasterConfig.loadConfig" title="buildbot.config.MasterConfig.loadConfig"><tt class="xref py py-meth docutils literal"><span class="pre">loadConfig</span></tt></a>, which will load the
configuration from a config file.</p>
<p>The following attributes are available from this class, representing the
current configuration.  This includes a number of global parameters:</p>
<dl class="attribute">
<dt id="buildbot.config.MasterConfig.title">
<tt class="descname">title</tt><a class="headerlink" href="#buildbot.config.MasterConfig.title" title="Permalink to this definition">¶</a></dt>
<dd><p>The title of this buildmaster, from <a class="reference internal" href="#cfg-title" title="title"><tt class="xref bb bb-cfg docutils literal"><span class="pre">title</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.titleURL">
<tt class="descname">titleURL</tt><a class="headerlink" href="#buildbot.config.MasterConfig.titleURL" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL corresponding to the title, from <a class="reference internal" href="#cfg-titleURL" title="titleURL"><tt class="xref bb bb-cfg docutils literal"><span class="pre">titleURL</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.buildbotURL">
<tt class="descname">buildbotURL</tt><a class="headerlink" href="#buildbot.config.MasterConfig.buildbotURL" title="Permalink to this definition">¶</a></dt>
<dd><p>The URL of this buildmaster, for use in constructing WebStatus URLs;
from <a class="reference internal" href="#cfg-buildbotURL" title="buildbotURL"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildbotURL</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.changeHorizon">
<tt class="descname">changeHorizon</tt><a class="headerlink" href="#buildbot.config.MasterConfig.changeHorizon" title="Permalink to this definition">¶</a></dt>
<dd><p>The current change horizon, from <a class="reference internal" href="#cfg-changeHorizon" title="changeHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">changeHorizon</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.eventHorizon">
<tt class="descname">eventHorizon</tt><a class="headerlink" href="#buildbot.config.MasterConfig.eventHorizon" title="Permalink to this definition">¶</a></dt>
<dd><p>The current event horizon, from <a class="reference internal" href="#cfg-eventHorizon" title="eventHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">eventHorizon</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logHorizon">
<tt class="descname">logHorizon</tt><a class="headerlink" href="#buildbot.config.MasterConfig.logHorizon" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log horizon, from <a class="reference internal" href="#cfg-logHorizon" title="logHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logHorizon</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.buildHorizon">
<tt class="descname">buildHorizon</tt><a class="headerlink" href="#buildbot.config.MasterConfig.buildHorizon" title="Permalink to this definition">¶</a></dt>
<dd><p>The current build horizon, from <a class="reference internal" href="#cfg-buildHorizon" title="buildHorizon"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildHorizon</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logCompressionLimit">
<tt class="descname">logCompressionLimit</tt><a class="headerlink" href="#buildbot.config.MasterConfig.logCompressionLimit" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log compression limit, from <a class="reference internal" href="#cfg-logCompressionLimit" title="logCompressionLimit"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logCompressionLimit</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logCompressionMethod">
<tt class="descname">logCompressionMethod</tt><a class="headerlink" href="#buildbot.config.MasterConfig.logCompressionMethod" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log compression method, from
<a class="reference internal" href="#cfg-logCompressionMethod" title="logCompressionMethod"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logCompressionMethod</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logMaxSize">
<tt class="descname">logMaxSize</tt><a class="headerlink" href="#buildbot.config.MasterConfig.logMaxSize" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log maximum size, from <a class="reference internal" href="#cfg-logMaxSize" title="logMaxSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logMaxSize</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.logMaxTailSize">
<tt class="descname">logMaxTailSize</tt><a class="headerlink" href="#buildbot.config.MasterConfig.logMaxTailSize" title="Permalink to this definition">¶</a></dt>
<dd><p>The current log maximum size, from <a class="reference internal" href="#cfg-logMaxTailSize" title="logMaxTailSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">logMaxTailSize</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.properties">
<tt class="descname">properties</tt><a class="headerlink" href="#buildbot.config.MasterConfig.properties" title="Permalink to this definition">¶</a></dt>
<dd><p>A <tt class="xref py py-class docutils literal"><span class="pre">Properties</span></tt> instance
containing global properties, from <a class="reference internal" href="#cfg-properties" title="properties"><tt class="xref bb bb-cfg docutils literal"><span class="pre">properties</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.mergeRequests">
<tt class="descname">mergeRequests</tt><a class="headerlink" href="#buildbot.config.MasterConfig.mergeRequests" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable, or True or False, describing how to merge requests; from
<a class="reference internal" href="#cfg-mergeRequests" title="mergeRequests"><tt class="xref bb bb-cfg docutils literal"><span class="pre">mergeRequests</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.prioritizeBuilders">
<tt class="descname">prioritizeBuilders</tt><a class="headerlink" href="#buildbot.config.MasterConfig.prioritizeBuilders" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable, or None, used to prioritize builders; from
<a class="reference internal" href="#cfg-prioritizeBuilders" title="prioritizeBuilders"><tt class="xref bb bb-cfg docutils literal"><span class="pre">prioritizeBuilders</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.codebaseGenerator">
<tt class="descname">codebaseGenerator</tt><a class="headerlink" href="#buildbot.config.MasterConfig.codebaseGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable, or None, used to determine the codebase from an incomming
<tt class="xref py py-class docutils literal"><span class="pre">Change</span></tt>,
from <a class="reference internal" href="#cfg-codebaseGenerator" title="codebaseGenerator"><tt class="xref bb bb-cfg docutils literal"><span class="pre">codebaseGenerator</span></tt></a></p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.slavePortnum">
<tt class="descname">slavePortnum</tt><a class="headerlink" href="#buildbot.config.MasterConfig.slavePortnum" title="Permalink to this definition">¶</a></dt>
<dd><p>The strports specification for the slave (integer inputs are normalized
to a string), or None; based on <a class="reference internal" href="#cfg-slavePortnum" title="slavePortnum"><tt class="xref bb bb-cfg docutils literal"><span class="pre">slavePortnum</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.multiMaster">
<tt class="descname">multiMaster</tt><a class="headerlink" href="#buildbot.config.MasterConfig.multiMaster" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, then this master is part of a cluster; based on
<a class="reference internal" href="#cfg-multiMaster" title="multiMaster"><tt class="xref bb bb-cfg docutils literal"><span class="pre">multiMaster</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.debugPassword">
<tt class="descname">debugPassword</tt><a class="headerlink" href="#buildbot.config.MasterConfig.debugPassword" title="Permalink to this definition">¶</a></dt>
<dd><p>The password for the debug client, or None; from
<a class="reference internal" href="#cfg-debugPassword" title="debugPassword"><tt class="xref bb bb-cfg docutils literal"><span class="pre">debugPassword</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.manhole">
<tt class="descname">manhole</tt><a class="headerlink" href="#buildbot.config.MasterConfig.manhole" title="Permalink to this definition">¶</a></dt>
<dd><p>The manhole instance to ues, or None; from <a class="reference internal" href="#cfg-manhole" title="manhole"><tt class="xref bb bb-cfg docutils literal"><span class="pre">manhole</span></tt></a>.</p>
</dd></dl>

<p>The remaining attributes contain compound configuration structures, usually
dictionaries:</p>
<dl class="attribute">
<dt id="buildbot.config.MasterConfig.validation">
<tt class="descname">validation</tt><a class="headerlink" href="#buildbot.config.MasterConfig.validation" title="Permalink to this definition">¶</a></dt>
<dd><p>Validation regular expressions, a dictionary from <a class="reference internal" href="#cfg-validation" title="validation"><tt class="xref bb bb-cfg docutils literal"><span class="pre">validation</span></tt></a>.
It is safe to assume that all expected keys are present.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.db">
<tt class="descname">db</tt><a class="headerlink" href="#buildbot.config.MasterConfig.db" title="Permalink to this definition">¶</a></dt>
<dd><p>Database specification, a dictionary with keys <a class="reference internal" href="#cfg-db_url" title="db_url"><tt class="xref bb bb-cfg docutils literal"><span class="pre">db_url</span></tt></a> and
<a class="reference internal" href="#cfg-db_poll_interval" title="db_poll_interval"><tt class="xref bb bb-cfg docutils literal"><span class="pre">db_poll_interval</span></tt></a>.  It is safe to assume that both keys are
present.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.metrics">
<tt class="descname">metrics</tt><a class="headerlink" href="#buildbot.config.MasterConfig.metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>The metrics configuration from <a class="reference internal" href="#cfg-metrics" title="metrics"><tt class="xref bb bb-cfg docutils literal"><span class="pre">metrics</span></tt></a>, or an empty
dictionary by default.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.caches">
<tt class="descname">caches</tt><a class="headerlink" href="#buildbot.config.MasterConfig.caches" title="Permalink to this definition">¶</a></dt>
<dd><p>The cache configuration, from <a class="reference internal" href="#cfg-caches" title="caches"><tt class="xref bb bb-cfg docutils literal"><span class="pre">caches</span></tt></a> as well as the
deprecated <a class="reference internal" href="#cfg-buildCacheSize" title="buildCacheSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">buildCacheSize</span></tt></a> and <a class="reference internal" href="#cfg-changeCacheSize" title="changeCacheSize"><tt class="xref bb bb-cfg docutils literal"><span class="pre">changeCacheSize</span></tt></a>
parameters.</p>
<p>The keys <tt class="docutils literal"><span class="pre">Builds</span></tt> and <tt class="docutils literal"><span class="pre">Caches</span></tt> are always available; other keys
should use <tt class="docutils literal"><span class="pre">config.caches.get(cachename,</span> <span class="pre">1)</span></tt>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.schedulers">
<tt class="descname">schedulers</tt><a class="headerlink" href="#buildbot.config.MasterConfig.schedulers" title="Permalink to this definition">¶</a></dt>
<dd><p>The dictionary of scheduler instances, by name, from <a class="reference internal" href="#cfg-schedulers" title="schedulers"><tt class="xref bb bb-cfg docutils literal"><span class="pre">schedulers</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.builders">
<tt class="descname">builders</tt><a class="headerlink" href="#buildbot.config.MasterConfig.builders" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of <a class="reference internal" href="#buildbot.config.BuilderConfig" title="buildbot.config.BuilderConfig"><tt class="xref py py-class docutils literal"><span class="pre">BuilderConfig</span></tt></a> instances from
<a class="reference internal" href="#cfg-builders" title="builders"><tt class="xref bb bb-cfg docutils literal"><span class="pre">builders</span></tt></a>.  Builders specified as dictionaries in the
configuration file are converted to instances.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.slaves">
<tt class="descname">slaves</tt><a class="headerlink" href="#buildbot.config.MasterConfig.slaves" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt> instances from
<a class="reference internal" href="#cfg-slaves" title="slaves"><tt class="xref bb bb-cfg docutils literal"><span class="pre">slaves</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.change_sources">
<tt class="descname">change_sources</tt><a class="headerlink" href="#buildbot.config.MasterConfig.change_sources" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of <tt class="xref py py-class docutils literal"><span class="pre">IChangeSource</span></tt> providers from
<a class="reference internal" href="#cfg-change_source" title="change_source"><tt class="xref bb bb-cfg docutils literal"><span class="pre">change_source</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.status">
<tt class="descname">status</tt><a class="headerlink" href="#buildbot.config.MasterConfig.status" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of <tt class="xref py py-class docutils literal"><span class="pre">IStatusReceiver</span></tt> providers from
<a class="reference internal" href="#cfg-status" title="status"><tt class="xref bb bb-cfg docutils literal"><span class="pre">status</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.MasterConfig.user_managers">
<tt class="descname">user_managers</tt><a class="headerlink" href="#buildbot.config.MasterConfig.user_managers" title="Permalink to this definition">¶</a></dt>
<dd><p>The list of user managers providers from <a class="reference internal" href="#cfg-user_managers" title="user_managers"><tt class="xref bb bb-cfg docutils literal"><span class="pre">user_managers</span></tt></a>.</p>
</dd></dl>

<p>Loading of the configuration file is generally triggered by the master,
using the following methods:</p>
<dl class="classmethod">
<dt id="buildbot.config.MasterConfig.loadConfig">
<em class="property">classmethod </em><tt class="descname">loadConfig</tt><big>(</big><em>basedir</em>, <em>filename</em><big>)</big><a class="headerlink" href="#buildbot.config.MasterConfig.loadConfig" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>basedir</strong> (<em>string</em>) -- directory to which config is relative</li>
<li><strong>filename</strong> (<em>string</em>) -- the configuration file to load</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><p class="first"><a class="reference internal" href="#buildbot.config.ConfigErrors" title="buildbot.config.ConfigErrors"><tt class="xref py py-exc docutils literal"><span class="pre">ConfigErrors</span></tt></a> if any errors occur</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">new <a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><tt class="xref py py-class docutils literal"><span class="pre">MasterConfig</span></tt></a> instance</p>
</td>
</tr>
</tbody>
</table>
<p>Load the configuration in the given file.  Aside from syntax errors,
this will also detect a number of semantic errors such as multiple
schedulers with the same name.</p>
<p>The filename is treated as relative to the basedir, if it is not
absolute.</p>
</dd></dl>

</dd></dl>

<div class="section" id="builder-configuration">
<h4>Builder Configuration<a class="headerlink" href="#builder-configuration" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="buildbot.config.BuilderConfig">
<em class="property">class </em><tt class="descclassname">buildbot.config.</tt><tt class="descname">BuilderConfig</tt><big>(</big><span class="optional">[</span><em>keyword args</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#buildbot.config.BuilderConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>This class parameterizes configuration of builders; see
<a class="reference internal" href="#builder-configuration"><em>Builder Configuration</em></a> for its arguments.  The constructor checks for
errors and applies defaults, and sets the properties described here.  Most
are simply copied from the constructor argument of the same name.</p>
<p>Users may subclass this class to add defaults, for example.</p>
<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.name">
<tt class="descname">name</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's name.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.factory">
<tt class="descname">factory</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.factory" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's factory.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.slavenames">
<tt class="descname">slavenames</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.slavenames" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's slave names (a list, regardless of whether the names were
specified with <tt class="docutils literal"><span class="pre">slavename</span></tt> or <tt class="docutils literal"><span class="pre">slavenames</span></tt>).</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.builddir">
<tt class="descname">builddir</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.builddir" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's builddir.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.slavebuilddir">
<tt class="descname">slavebuilddir</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.slavebuilddir" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's slave-side builddir.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.category">
<tt class="descname">category</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.category" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's category.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.nextSlave">
<tt class="descname">nextSlave</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.nextSlave" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's nextSlave callable.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.locks">
<tt class="descname">locks</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.locks" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's locks.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.env">
<tt class="descname">env</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.env" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's environmnet variables.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.properties">
<tt class="descname">properties</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.properties" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's properties, as a dictionary.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.BuilderConfig.mergeRequests">
<tt class="descname">mergeRequests</tt><a class="headerlink" href="#buildbot.config.BuilderConfig.mergeRequests" title="Permalink to this definition">¶</a></dt>
<dd><p>The builder's mergeRequests callable.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="error-handling">
<h3>Error Handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h3>
<p>If any errors are encountered while loading the configuration <a class="reference internal" href="#buildbot.config.error" title="buildbot.config.error"><tt class="xref py py-func docutils literal"><span class="pre">buildbot.config.error</span></tt></a>
should be called. This can occur both in the configuration-loading code,
and in the constructors of any objects that are instantiated in the
configuration - change sources, slaves, schedulers, build steps, and so on.</p>
<dl class="function">
<dt id="buildbot.config.error">
<tt class="descclassname">buildbot.config.</tt><tt class="descname">error</tt><big>(</big><em>error</em><big>)</big><a class="headerlink" href="#buildbot.config.error" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>error</strong> -- error to report</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><a class="reference internal" href="#buildbot.config.ConfigErrors" title="buildbot.config.ConfigErrors"><tt class="xref py py-exc docutils literal"><span class="pre">ConfigErrors</span></tt></a> if called at build-time</td>
</tr>
</tbody>
</table>
<p>This function reports a configuration error. If a config file is being loaded,
then the function merely records ther error, and allows he rest of the configuration
to be loaded. At any other time, it raises <a class="reference internal" href="#buildbot.config.ConfigErrors" title="buildbot.config.ConfigErrors"><tt class="xref py py-exc docutils literal"><span class="pre">ConfigErrors</span></tt></a>.  This is done
so all config erros can be reported, rather than just the first.</p>
</dd></dl>

<dl class="exception">
<dt id="buildbot.config.ConfigErrors">
<em class="property">exception </em><tt class="descclassname">buildbot.config.</tt><tt class="descname">ConfigErrors</tt><big>(</big><span class="optional">[</span><em>errors</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#buildbot.config.ConfigErrors" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>errors</strong> (<em>list</em>) -- errors to report</td>
</tr>
</tbody>
</table>
<p>This exception represents errors in the configuration.  It supports
reporting multiple errors to the user simultaneously, e.g., when several
consistency checks fail.</p>
<dl class="attribute">
<dt id="buildbot.config.ConfigErrors.errors">
<tt class="descname">errors</tt><a class="headerlink" href="#buildbot.config.ConfigErrors.errors" title="Permalink to this definition">¶</a></dt>
<dd><p>A list of detected errors, each given as a string.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.config.ConfigErrors.addError">
<tt class="descname">addError</tt><big>(</big><em>msg</em><big>)</big><a class="headerlink" href="#buildbot.config.ConfigErrors.addError" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>msg</strong> (<em>string</em>) -- the message to add</td>
</tr>
</tbody>
</table>
<p>Add another error message to the (presumably not-yet-raised) exception.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="reconfiguration">
<span id="developer-reconfiguration"></span><h3>Reconfiguration<a class="headerlink" href="#reconfiguration" title="Permalink to this headline">¶</a></h3>
<p>When the buildmaster receives a signal to beging a reconfig, it re-reads the
configuration file, generating a new <a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><tt class="xref py py-class docutils literal"><span class="pre">MasterConfig</span></tt></a> instance, and
then notifies all of its child services via the reconfig mechanism described
below.  The master ensures that at most one reconfiguration is taking place at
any time.</p>
<p>See <a class="reference internal" href="#master-service-hierarchy"><em>Master Organization</em></a> for the structure of the Buildbot service
tree.</p>
<p>To simplify initialization, a reconfiguration is performed immediately on
master startup.  As a result, services only need to implement their
configuration handling once, and can use <tt class="docutils literal"><span class="pre">startService</span></tt> for initialization.</p>
<p>See below for instructions on implementing configuration of common types of
components in Buildbot.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Because Buildbot uses a pure-Python configuration file, it is not possible
to support all forms of reconfiguration.  In particular, when the
configuration includes custom subclasses or modules, reconfiguration can
turn up some surprising behaviors due to the dynamic nature of Python.  The
reconfig support in Buildbot is intended for &quot;intermediate&quot; uses of the
software, where there are fewer surprises.</p>
</div>
<div class="section" id="reconfigurable-services">
<h4>Reconfigurable Services<a class="headerlink" href="#reconfigurable-services" title="Permalink to this headline">¶</a></h4>
<p>Instances which need to be notified of a change in configuration should be
implemented as Twisted services, and mix in the
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin" title="buildbot.config.ReconfigurableServiceMixin"><tt class="xref py py-class docutils literal"><span class="pre">ReconfigurableServiceMixin</span></tt></a> class, overriding the
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin.reconfigService" title="buildbot.config.ReconfigurableServiceMixin.reconfigService"><tt class="xref py py-meth docutils literal"><span class="pre">reconfigService</span></tt></a> method.</p>
<dl class="class">
<dt id="buildbot.config.ReconfigurableServiceMixin">
<em class="property">class </em><tt class="descclassname">buildbot.config.</tt><tt class="descname">ReconfigurableServiceMixin</tt><a class="headerlink" href="#buildbot.config.ReconfigurableServiceMixin" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.config.ReconfigurableServiceMixin.reconfigService">
<tt class="descname">reconfigService</tt><big>(</big><em>new_config</em><big>)</big><a class="headerlink" href="#buildbot.config.ReconfigurableServiceMixin.reconfigService" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>new_config</strong> (<a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><tt class="xref py py-class docutils literal"><span class="pre">MasterConfig</span></tt></a>) -- new master configuration</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method notifies the service that it should make any changes
necessary to adapt to the new configuration values given.</p>
<p>This method will be called automatically after a service is started.</p>
<p>It is generally too late at this point to roll back the
reconfiguration, so if possible any errors should be detected in the
<a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><tt class="xref py py-class docutils literal"><span class="pre">MasterConfig</span></tt></a> implementation.  Errors are handled as best as
possible and communicated back to the top level invocation, but such
errors may leave the master in an inconsistent state.
<a class="reference internal" href="#buildbot.config.ConfigErrors" title="buildbot.config.ConfigErrors"><tt class="xref py py-exc docutils literal"><span class="pre">ConfigErrors</span></tt></a> exceptions will be displayed appropriately to
the user on startup.</p>
<p>Subclasses should always call the parent class's implementation. For
<tt class="xref py py-class docutils literal"><span class="pre">MultiService</span></tt> instances, this will call any child services'
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin.reconfigService" title="buildbot.config.ReconfigurableServiceMixin.reconfigService"><tt class="xref py py-meth docutils literal"><span class="pre">reconfigService</span></tt></a> methods, as appropriate.  This will be done
sequentially, such that the Deferred from one service must fire before
the next service is reconfigured.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.config.ReconfigurableServiceMixin.priority">
<tt class="descname">priority</tt><a class="headerlink" href="#buildbot.config.ReconfigurableServiceMixin.priority" title="Permalink to this definition">¶</a></dt>
<dd><p>Child services are reconfigured in order of decreasing priority.  The
default priority is 128, so a service that must be reconfigured before
others should be given a higher priority.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="change-sources">
<h4>Change Sources<a class="headerlink" href="#change-sources" title="Permalink to this headline">¶</a></h4>
<p>When reconfiguring, there is no method by which Buildbot can determine that a
new <a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt></a> represents the same source
as an existing <a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt></a>, but with
different configuration parameters.  As a result, the change source manager
compares the lists of existing and new change sources using equality, stops any
existing sources that are not in the new list, and starts any new change
sources that do not already exist.</p>
<p><a class="reference internal" href="#buildbot.changes.base.ChangeSource" title="buildbot.changes.base.ChangeSource"><tt class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></tt></a> inherits
<a class="reference internal" href="#buildbot.util.ComparableMixin" title="buildbot.util.ComparableMixin"><tt class="xref py py-class docutils literal"><span class="pre">ComparableMixin</span></tt></a>, so change sources are compared
based on the attributes described in their <tt class="docutils literal"><span class="pre">compare_attrs</span></tt>.</p>
<p>If a change source does not make reference to any global configuration
parameters, then there is no need to inherit
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin" title="buildbot.config.ReconfigurableServiceMixin"><tt class="xref py py-class docutils literal"><span class="pre">ReconfigurableServiceMixin</span></tt></a>, as a simple comparison and
<tt class="docutils literal"><span class="pre">startService</span></tt> and <tt class="docutils literal"><span class="pre">stopService</span></tt> will be sufficient.</p>
<p>If the change source does make reference to global values, e.g., as default
values for its parameters, then it must inherit
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin" title="buildbot.config.ReconfigurableServiceMixin"><tt class="xref py py-class docutils literal"><span class="pre">ReconfigurableServiceMixin</span></tt></a> to support the case where the global
values change.</p>
</div>
<div class="section" id="schedulers">
<h4>Schedulers<a class="headerlink" href="#schedulers" title="Permalink to this headline">¶</a></h4>
<p>Schedulers have names, so Buildbot can determine whether a scheduler has been
added, removed, or changed during a reconfig.  Old schedulers will be stopped,
new schedulers will be started, and both new and existing schedulers will see a
call to <a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin.reconfigService" title="buildbot.config.ReconfigurableServiceMixin.reconfigService"><tt class="xref py py-meth docutils literal"><span class="pre">reconfigService</span></tt></a>, if such a
method exists.  For backward compatibility, schedulers which do not support
reconfiguration will be stopped, and the new scheduler started, when their
configuration changes.</p>
<p>If, during a reconfiguration, a new and old scheduler's fully qualified class
names differ, then the old class will be stopped and the new class started.
This supports the case when a user changes, for example, a Nightly scheduler to
a Periodic scheduler without changing the name.</p>
<p>Because Buildbot uses <tt class="xref py py-class docutils literal"><span class="pre">BaseScheduler</span></tt>
instances directly in the configuration file, a reconfigured scheduler must
extract its new configuration information from another instance of itself.
<tt class="xref py py-class docutils literal"><span class="pre">BaseScheduler</span></tt> implements a helper method,
<tt class="xref py py-meth docutils literal"><span class="pre">findNewSchedulerInstance</span></tt>,
which will return the new instance of the scheduler in the given
<a class="reference internal" href="#buildbot.config.MasterConfig" title="buildbot.config.MasterConfig"><tt class="xref py py-class docutils literal"><span class="pre">MasterConfig</span></tt></a> object.</p>
<div class="section" id="custom-subclasses">
<h5>Custom Subclasses<a class="headerlink" href="#custom-subclasses" title="Permalink to this headline">¶</a></h5>
<p>Custom subclasses are most often defined directly in the configuration file, or
in a Python module that is reloaded with <tt class="docutils literal"><span class="pre">reload</span></tt> every time the
configuration is loaded.  Because of the dynamic nature of Python, this creates
a new object representing the subclass every time the configuration is loaded
-- even if the class definition has not changed.</p>
<p>Note that if a scheduler's class changes in a reconfig, but the scheduler's
name does not, it will still be treated as a reconfiguration of the existing
scheduler.  This means that implementation changes in custom scheduler
subclasses will not be activated with a reconfig.  This behavior avoids
stopping and starting such schedulers on every reconfig, but can make
development difficult.</p>
<p>One workaround for this is to change the name of the scheduler before each
reconfig - this will cause the old scheduler to be stopped, and the new
scheduler (with the new name and class) to be started.</p>
</div>
</div>
<div class="section" id="slaves">
<h4>Slaves<a class="headerlink" href="#slaves" title="Permalink to this headline">¶</a></h4>
<p>Similar to schedulers, slaves are specified by name, so new and old
configurations are first compared by name, and any slaves to be added or
removed are noted.  Slaves for which the fully-qualified class name has changed
are also added and removed.  All slaves have their
<a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin.reconfigService" title="buildbot.config.ReconfigurableServiceMixin.reconfigService"><tt class="xref py py-meth docutils literal"><span class="pre">reconfigService</span></tt></a> method called.</p>
<p>This method takes care of the basic slave attributes, including changing the PB
registration if necessary.  Any subclasses that add configuration parameters
should override <a class="reference internal" href="#buildbot.config.ReconfigurableServiceMixin.reconfigService" title="buildbot.config.ReconfigurableServiceMixin.reconfigService"><tt class="xref py py-meth docutils literal"><span class="pre">reconfigService</span></tt></a> and
update those parameters.  As with Schedulers, because the
<tt class="xref py py-class docutils literal"><span class="pre">AbstractBuildSlave</span></tt> instance is given directly
in the configuration, on reconfig instances must extract the configuration from
a new instance.  The
<tt class="xref py py-meth docutils literal"><span class="pre">findNewSlaveInstance</span></tt> method
can be used to find the new instance.</p>
</div>
<div class="section" id="user-managers">
<h4>User Managers<a class="headerlink" href="#user-managers" title="Permalink to this headline">¶</a></h4>
<p>Since user managers are rarely used, and their purpose is unclear, they are
always stopped and re-started on every reconfig.  This may change in figure
versions.</p>
</div>
<div class="section" id="status-receivers">
<h4>Status Receivers<a class="headerlink" href="#status-receivers" title="Permalink to this headline">¶</a></h4>
<p>At every reconfig, all status listeners are stopped and new versions started.</p>
</div>
</div>
<span id="document-developer/utils"></span><div class="section" id="module-buildbot.util">
<span id="utilities"></span><h3>Utilities<a class="headerlink" href="#module-buildbot.util" title="Permalink to this headline">¶</a></h3>
<p>Several small utilities are available at the top-level <a class="reference internal" href="#module-buildbot.util" title="buildbot.util"><tt class="xref py py-mod docutils literal"><span class="pre">buildbot.util</span></tt></a>
package.</p>
<dl class="function">
<dt id="buildbot.util.naturalSort">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">naturalSort</tt><big>(</big><em>list</em><big>)</big><a class="headerlink" href="#buildbot.util.naturalSort" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>list</strong> -- list of strings</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">sorted strings</td>
</tr>
</tbody>
</table>
<p>This function sorts strings &quot;naturally&quot;, with embedded numbers sorted
numerically.  This ordering is good for objects which might have a numeric
suffix, e.g., <tt class="docutils literal"><span class="pre">winslave1</span></tt>, <tt class="docutils literal"><span class="pre">winslave2</span></tt></p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.formatInterval">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">formatInterval</tt><big>(</big><em>interval</em><big>)</big><a class="headerlink" href="#buildbot.util.formatInterval" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>interval</strong> -- duration in seconds</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">human-readable (English) equivalent</td>
</tr>
</tbody>
</table>
<p>This function will return a human-readable string describing a length of
time, given a number of seconds.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.ComparableMixin">
<em class="property">class </em><tt class="descclassname">buildbot.util.</tt><tt class="descname">ComparableMixin</tt><a class="headerlink" href="#buildbot.util.ComparableMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This mixin class adds comparability to a subclass.  Use it like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="n">FactoryProduct</span><span class="p">,</span> <span class="n">ComparableMixin</span><span class="p">):</span>
    <span class="n">compare_attrs</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;radius&#39;</span><span class="p">,</span> <span class="s">&#39;thickness&#39;</span> <span class="p">]</span>
    <span class="c"># ...</span>
</pre></div>
</div>
<p>Any attributes not in <tt class="docutils literal"><span class="pre">compare_attrs</span></tt> will not be considered when
comparing objects.  This is particularly useful in implementing buildbot's
reconfig logic, where a simple comparison between the new and existing objects
can determine whether the new object should replace the existing object.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.safeTranslate">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">safeTranslate</tt><big>(</big><em>str</em><big>)</big><a class="headerlink" href="#buildbot.util.safeTranslate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>str</strong> -- input string</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">safe version of the input</td>
</tr>
</tbody>
</table>
<p>This function will filter out some inappropriate characters for filenames;
it is suitable for adapting strings from the configuration for use as
filenames.  It is not suitable for use with strings from untrusted sources.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.epoch2datetime">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">epoch2datetime</tt><big>(</big><em>epoch</em><big>)</big><a class="headerlink" href="#buildbot.util.epoch2datetime" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>epoch</strong> -- an epoch time (integer)</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">equivalent datetime object</td>
</tr>
</tbody>
</table>
<p>Convert a UNIX epoch timestamp to a Python datetime object, in the UTC
timezone.  Note that timestamps specify UTC time (modulo leap seconds and a
few other minor details).</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.datetime2epoch">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">datetime2epoch</tt><big>(</big><em>datetime</em><big>)</big><a class="headerlink" href="#buildbot.util.datetime2epoch" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>datetime</strong> -- a datetime object</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">equivalent epoch time (integer)</td>
</tr>
</tbody>
</table>
<p>Convert an arbitrary Python datetime object into a UNIX epoch timestamp.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.util.UTC">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">UTC</tt><a class="headerlink" href="#buildbot.util.UTC" title="Permalink to this definition">¶</a></dt>
<dd><p>A <tt class="docutils literal"><span class="pre">datetime.tzinfo</span></tt> subclass representing UTC time.  A similar class has
finally been added to Python in version 3.2, but the implementation is simple
enough to include here.  This is mostly used in tests to create timezone-aware
datetime objects in UTC:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1978</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="n">UTC</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.diffSets">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">diffSets</tt><big>(</big><em>old</em>, <em>new</em><big>)</big><a class="headerlink" href="#buildbot.util.diffSets" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>old</strong> (<em>set or iterable</em>) -- old set</li>
<li><strong>new</strong> (<em>set or iterable</em>) -- new set</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a tuple, (removed, added)</p>
</td>
</tr>
</tbody>
</table>
<p>This function compares two sets of objects, returning elements that were
added and elements that were removed.  This is largely a convenience
function for reconfiguring services.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.makeList">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">makeList</tt><big>(</big><em>input</em><big>)</big><a class="headerlink" href="#buildbot.util.makeList" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>input</strong> -- a thing</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a list of zero or more things</td>
</tr>
</tbody>
</table>
<p>This function is intended to support the many places in Buildbot where the
user can specify either a string or a list of strings, but the
implementation wishes to always consider lists.  It converts any string to
a single-element list, <tt class="docutils literal"><span class="pre">None</span></tt> to an empty list, and any iterable to a
list.  Input lists are copied, avoiding aliasing issues.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.now">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">now</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.util.now" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">epoch time (integer)</td>
</tr>
</tbody>
</table>
<p>Return the current time, using either <tt class="docutils literal"><span class="pre">reactor.seconds</span></tt> or
<tt class="docutils literal"><span class="pre">time.time()</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.flatten">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">flatten</tt><big>(</big><em>list</em><big>)</big><a class="headerlink" href="#buildbot.util.flatten" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>list</strong> -- potentially nested list</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">flat list</td>
</tr>
</tbody>
</table>
<p>Flatten nested lists into a list containing no other lists.  For example:</p>
<div class="highlight-none"><div class="highlight"><pre>&gt;&gt;&gt; flatten([ [  1, 2 ], 3, [ [ 4 ] ] ])
[ 1, 2, 3, 4 ]
</pre></div>
</div>
<p>Note that this looks strictly for lists -- tuples, for example, are not
flattened.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.none_or_str">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">none_or_str</tt><big>(</big><em>obj</em><big>)</big><a class="headerlink" href="#buildbot.util.none_or_str" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>obj</strong> -- input value</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">string or <tt class="docutils literal"><span class="pre">None</span></tt></td>
</tr>
</tbody>
</table>
<p>If <tt class="docutils literal"><span class="pre">obj</span></tt> is not None, return its string representation.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.util.NotABranch">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">NotABranch</tt><a class="headerlink" href="#buildbot.util.NotABranch" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a sentinel value used to indicate that no branch is specified.  It
is necessary since schedulers and change sources consider <tt class="docutils literal"><span class="pre">None</span></tt> a valid
name for a branch.  This is generally used as a default value in a method
signature, and then tested against with <tt class="docutils literal"><span class="pre">is</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">branch</span> <span class="ow">is</span> <span class="n">NotABranch</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c"># ...</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.in_reactor">
<tt class="descclassname">buildbot.util.</tt><tt class="descname">in_reactor</tt><big>(</big><em>fn</em><big>)</big><a class="headerlink" href="#buildbot.util.in_reactor" title="Permalink to this definition">¶</a></dt>
<dd><p>This decorator will cause the wrapped function to be run in the Twisted
reactor, with the reactor stopped when the function completes.  It returns
the result of the wrapped function.  If the wrapped function fails, its
traceback will be printed, the reactor halted, and <tt class="docutils literal"><span class="pre">None</span></tt> returned.</p>
</dd></dl>

<div class="section" id="module-buildbot.util.lru">
<span id="buildbot-util-lru"></span><h4>buildbot.util.lru<a class="headerlink" href="#module-buildbot.util.lru" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt>
<tt class="descname">LRUCache(miss_fn, max_size=50):</tt></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>miss_fn</strong> -- function to call, with key as parameter, for cache misses.
The function should return the value associated with the key argument,
or None if there is no value associated with the key.</li>
<li><strong>max_size</strong> -- maximum number of objects in the cache.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This is a simple least-recently-used cache.  When the cache grows beyond
the maximum size, the least-recently used items will be automatically
removed from the cache.</p>
<p>This cache is designed to control memory usage by minimizing duplication of
objects, while avoiding unnecessary re-fetching of the same rows from the
database.</p>
<p>All values are also stored in a weak valued dictionary, even after they
have expired from the cache.  This allows values that are used elsewhere in
Buildbot to &quot;stick&quot; in the cache in case they are needed by another
component.  Weak references cannot be used for some types, so these types
are not compatible with this class.  Note that dictionaries can be weakly
referenced if they are an instance of a subclass of <tt class="docutils literal"><span class="pre">dict</span></tt>.</p>
<p>If the result of the <tt class="docutils literal"><span class="pre">miss_fn</span></tt> is <tt class="docutils literal"><span class="pre">None</span></tt>, then the value is not cached;
this is intended to avoid caching negative results.</p>
<p>This is based on <a class="reference external" href="http://code.activestate.com/recipes/498245-lru-and-lfu-cache-decorators/">Raymond Hettinger's implementation</a>,
licensed under the PSF license, which is GPL-compatiblie.</p>
<dl class="attribute">
<dt id="buildbot.util.lru.hits">
<tt class="descclassname">buildbot.util.lru.</tt><tt class="descname">hits</tt><a class="headerlink" href="#buildbot.util.lru.hits" title="Permalink to this definition">¶</a></dt>
<dd><p>cache hits so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.refhits">
<tt class="descclassname">buildbot.util.lru.</tt><tt class="descname">refhits</tt><a class="headerlink" href="#buildbot.util.lru.refhits" title="Permalink to this definition">¶</a></dt>
<dd><p>cache misses found in the weak ref dictionary, so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.misses">
<tt class="descclassname">buildbot.util.lru.</tt><tt class="descname">misses</tt><a class="headerlink" href="#buildbot.util.lru.misses" title="Permalink to this definition">¶</a></dt>
<dd><p>cache misses leading to re-fetches, so far</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.lru.max_size">
<tt class="descclassname">buildbot.util.lru.</tt><tt class="descname">max_size</tt><a class="headerlink" href="#buildbot.util.lru.max_size" title="Permalink to this definition">¶</a></dt>
<dd><p>maximum allowed size of the cache</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.get">
<tt class="descclassname">buildbot.util.lru.</tt><tt class="descname">get</tt><big>(</big><em>key</em>, <em>**miss_fn_kwargs</em><big>)</big><a class="headerlink" href="#buildbot.util.lru.get" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>key</strong> -- cache key</li>
<li><strong>miss_fn_kwargs</strong> -- keyword arguments to the <tt class="docutils literal"><span class="pre">miss_fn</span></tt></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">value via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Fetch a value from the cache by key, invoking <tt class="docutils literal"><span class="pre">miss_fn(key,</span>
<span class="pre">**miss_fn_kwargs)</span></tt> if the key is not in the cache.</p>
<p>Any additional keyword arguments are passed to the <tt class="docutils literal"><span class="pre">miss_fn</span></tt> as
keyword arguments; these can supply additional information relating to
the key.  It is up to the caller to ensure that this information is
functionally identical for each key value: if the key is already in the
cache, the <tt class="docutils literal"><span class="pre">miss_fn</span></tt> will not be invoked, even if the keyword
arguments differ.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.put">
<tt class="descclassname">buildbot.util.lru.</tt><tt class="descname">put</tt><big>(</big><em>key</em>, <em>value</em><big>)</big><a class="headerlink" href="#buildbot.util.lru.put" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>key</strong> -- key at which to place the value</li>
<li><strong>value</strong> -- value to place there</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Update the cache with the given key and value, but only if the key is
already in the cache.  The purpose of this method is to insert a new
value into the cache <em>without</em> invoking the miss_fn (e.g., to avoid
unnecessary overhead).</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.lru.inv">
<tt class="descclassname">buildbot.util.lru.</tt><tt class="descname">inv</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.util.lru.inv" title="Permalink to this definition">¶</a></dt>
<dd><p>Check invariants on the cache.  This is intended for debugging
purposes.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt>
<tt class="descname">AsyncLRUCache(miss_fn, max_size=50):</tt></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>miss_fn</strong> -- This is the same as the miss_fn for class LRUCache, with
the difference that this function <em>must</em> return a Deferred.</li>
<li><strong>max_size</strong> -- maximum number of objects in the cache.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class has the same functional interface as LRUCache, but asynchronous
locking is used to ensure that in the common case of multiple concurrent
requests for the same key, only one fetch is performed.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.bbcollections">
<span id="buildbot-util-bbcollections"></span><h4>buildbot.util.bbcollections<a class="headerlink" href="#module-buildbot.util.bbcollections" title="Permalink to this headline">¶</a></h4>
<p>This package provides a few useful collection objects.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This module used to be named <tt class="docutils literal"><span class="pre">collections</span></tt>, but without absolute
imports (<span class="target" id="index-0"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-0328"><strong>PEP 328</strong></a>), this precluded using the standard library's
<tt class="docutils literal"><span class="pre">collections</span></tt> module.</p>
</div>
<dl class="class">
<dt id="buildbot.util.bbcollections.defaultdict">
<em class="property">class </em><tt class="descclassname">buildbot.util.bbcollections.</tt><tt class="descname">defaultdict</tt><a class="headerlink" href="#buildbot.util.bbcollections.defaultdict" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a clone of the Python <tt class="xref py py-class docutils literal"><span class="pre">collections.defaultdict</span></tt> for use in
Python-2.4.  In later versions, this is simply a reference to the built-in
<a class="reference internal" href="#buildbot.util.bbcollections.defaultdict" title="buildbot.util.bbcollections.defaultdict"><tt class="xref py py-class docutils literal"><span class="pre">defaultdict</span></tt></a>, so buildbot code can simply use
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.util.collections.defaultdict</span></tt> everywhere.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.bbcollections.KeyedSets">
<em class="property">class </em><tt class="descclassname">buildbot.util.bbcollections.</tt><tt class="descname">KeyedSets</tt><a class="headerlink" href="#buildbot.util.bbcollections.KeyedSets" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a collection of named sets.  In principal, it contains an empty set
for every name, and you can add things to sets, discard things from sets,
and so on.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span> <span class="o">=</span> <span class="n">KeyedSets</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s">&#39;tim&#39;</span><span class="p">]</span>                   <span class="c"># get a named set</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;tim&#39;</span><span class="p">,</span> <span class="s">&#39;friendly&#39;</span><span class="p">)</span>   <span class="c"># add an element to a set</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;tim&#39;</span><span class="p">,</span> <span class="s">&#39;dexterous&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s">&#39;tim&#39;</span><span class="p">]</span>
<span class="go">set([&#39;friendly&#39;, &#39;dexterous&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;tim&#39;</span> <span class="ow">in</span> <span class="n">ks</span>                 <span class="c"># membership testing</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;ron&#39;</span> <span class="ow">in</span> <span class="n">ks</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s">&#39;tim&#39;</span><span class="p">,</span> <span class="s">&#39;friendly&#39;</span><span class="p">)</span><span class="c"># discard set element</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;tim&#39;</span><span class="p">)</span>               <span class="c"># return set and reset to empty</span>
<span class="go">set([&#39;dexterous&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ks</span><span class="p">[</span><span class="s">&#39;tim&#39;</span><span class="p">]</span>
<span class="go">set([])</span>
</pre></div>
</div>
<p>This class is careful to conserve memory space - empty sets do not occupy
any space.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.eventual">
<span id="buildbot-util-eventual"></span><h4>buildbot.util.eventual<a class="headerlink" href="#module-buildbot.util.eventual" title="Permalink to this headline">¶</a></h4>
<p>This function provides a simple way to say &quot;please do this later&quot;.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.util.eventual</span> <span class="kn">import</span> <span class="n">eventually</span>
<span class="k">def</span> <span class="nf">do_what_I_say</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">where</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="k">return</span> <span class="n">d</span>
<span class="n">eventually</span><span class="p">(</span><span class="n">do_what_I_say</span><span class="p">,</span> <span class="s">&quot;clean up&quot;</span><span class="p">,</span> <span class="s">&quot;your bedroom&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The package defines &quot;later&quot; as &quot;next time the reactor has control&quot;, so this is
a good way to avoid long loops that block other activity in the reactor.</p>
<dl class="function">
<dt id="buildbot.util.eventual.eventually">
<tt class="descclassname">buildbot.util.eventual.</tt><tt class="descname">eventually</tt><big>(</big><em>cb</em>, <em>*args</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#buildbot.util.eventual.eventually" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>cb</strong> -- callable to invoke later</li>
<li><strong>args</strong> -- args to pass to <tt class="docutils literal"><span class="pre">cb</span></tt></li>
<li><strong>kwargs</strong> -- kwargs to pass to <tt class="docutils literal"><span class="pre">cb</span></tt></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Invoke the callable <tt class="docutils literal"><span class="pre">cb</span></tt> in a later reactor turn.</p>
<p>Callables given to <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><tt class="xref py py-func docutils literal"><span class="pre">eventually</span></tt></a> are guaranteed to be called in the
same order as the calls to <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><tt class="xref py py-func docutils literal"><span class="pre">eventually</span></tt></a> -- writing <tt class="docutils literal"><span class="pre">eventually(a);</span>
<span class="pre">eventually(b)</span></tt> guarantees that <tt class="docutils literal"><span class="pre">a</span></tt> will be called before <tt class="docutils literal"><span class="pre">b</span></tt>.</p>
<p>Any exceptions that occur in the callable will be logged with
<tt class="docutils literal"><span class="pre">log.err()</span></tt>.  If you really want to ignore them, provide a callable that
catches those exceptions.</p>
<p>This function returns None. If you care to know when the callable was
run, be sure to provide a callable that notifies somebody.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.eventual.fireEventually">
<tt class="descclassname">buildbot.util.eventual.</tt><tt class="descname">fireEventually</tt><big>(</big><em>value=None</em><big>)</big><a class="headerlink" href="#buildbot.util.eventual.fireEventually" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> -- value with which the Deferred should fire</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This function returns a Deferred which will fire in a later reactor turn,
after the current call stack has been completed, and after all other
Deferreds previously scheduled with <a class="reference internal" href="#buildbot.util.eventual.eventually" title="buildbot.util.eventual.eventually"><tt class="xref py py-func docutils literal"><span class="pre">eventually</span></tt></a>.  The returned
Deferred will never fail.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.eventual.flushEventualQueue">
<tt class="descclassname">buildbot.util.eventual.</tt><tt class="descname">flushEventualQueue</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.util.eventual.flushEventualQueue" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This returns a Deferred which fires when the eventual-send queue is finally
empty. This is useful for tests and other circumstances where it is useful
to know that &quot;later&quot; has arrived.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.json">
<span id="buildbot-util-json"></span><h4>buildbot.util.json<a class="headerlink" href="#module-buildbot.util.json" title="Permalink to this headline">¶</a></h4>
<p>This package is just an import of the best available JSON module.  Use it
instead of a more complex conditional import of <tt class="xref py py-mod docutils literal"><span class="pre">simplejson</span></tt> or
<tt class="xref py py-mod docutils literal"><span class="pre">json</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.util</span> <span class="kn">import</span> <span class="n">json</span>
</pre></div>
</div>
</div>
<div class="section" id="module-buildbot.util.maildir">
<span id="buildbot-util-maildir"></span><h4>buildbot.util.maildir<a class="headerlink" href="#module-buildbot.util.maildir" title="Permalink to this headline">¶</a></h4>
<p>Several Buildbot components make use of <a class="reference external" href="http://www.courier-mta.org/maildir.html">maildirs</a> to hand off messages between
components.  On the receiving end, there's a need to watch a maildir for
incoming messages and trigger some action when one arrives.</p>
<dl class="class">
<dt id="buildbot.util.maildir.MaildirService">
<em class="property">class </em><tt class="descclassname">buildbot.util.maildir.</tt><tt class="descname">MaildirService</tt><big>(</big><em>basedir</em><big>)</big><a class="headerlink" href="#buildbot.util.maildir.MaildirService" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">param basedir:</th><td class="field-body">(optional) base directory of the maildir</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>A <a class="reference internal" href="#buildbot.util.maildir.MaildirService" title="buildbot.util.maildir.MaildirService"><tt class="xref py py-class docutils literal"><span class="pre">MaildirService</span></tt></a> instance watches a maildir for new messages. It
should be a child service of some <tt class="xref py py-class docutils literal"><span class="pre">MultiService</span></tt> instance. When
running, this class uses the linux dirwatcher API (if available) or polls for new
files in the 'new' maildir subdirectory. When it discovers a new
message, it invokes its <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><tt class="xref py py-meth docutils literal"><span class="pre">messageReceived</span></tt></a> method.</p>
<p>To use this class, subclass it and implement a more interesting
<a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><tt class="xref py py-meth docutils literal"><span class="pre">messageReceived</span></tt></a> function.</p>
<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.setBasedir">
<tt class="descname">setBasedir</tt><big>(</big><em>basedir</em><big>)</big><a class="headerlink" href="#buildbot.util.maildir.MaildirService.setBasedir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>basedir</strong> -- base directory of the maildir</td>
</tr>
</tbody>
</table>
<p>If no <tt class="docutils literal"><span class="pre">basedir</span></tt> is provided to the constructor, this method must be
used to set the basedir before the service starts.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.messageReceived">
<tt class="descname">messageReceived</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#buildbot.util.maildir.MaildirService.messageReceived" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> -- unqualified filename of the new message</td>
</tr>
</tbody>
</table>
<p>This method is called with the short filename of the new message. The
full name of the new file can be obtained with <tt class="docutils literal"><span class="pre">os.path.join(maildir,</span>
<span class="pre">'new',</span> <span class="pre">filename)</span></tt>.  The method is un-implemented in the
<a class="reference internal" href="#buildbot.util.maildir.MaildirService" title="buildbot.util.maildir.MaildirService"><tt class="xref py py-class docutils literal"><span class="pre">MaildirService</span></tt></a> class, and must be implemented in
subclasses.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.maildir.MaildirService.moveToCurDir">
<tt class="descname">moveToCurDir</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#buildbot.util.maildir.MaildirService.moveToCurDir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> -- unqualified filename of the new message</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">open file object</td>
</tr>
</tbody>
</table>
<p>Call this from <a class="reference internal" href="#buildbot.util.maildir.MaildirService.messageReceived" title="buildbot.util.maildir.MaildirService.messageReceived"><tt class="xref py py-meth docutils literal"><span class="pre">messageReceived</span></tt></a> to start processing the
message; this moves the message file to the 'cur' directory and returns
an open file handle for it.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.misc">
<span id="buildbot-util-misc"></span><h4>buildbot.util.misc<a class="headerlink" href="#module-buildbot.util.misc" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="buildbot.util.misc.deferredLocked">
<tt class="descclassname">buildbot.util.misc.</tt><tt class="descname">deferredLocked</tt><big>(</big><em>lock</em><big>)</big><a class="headerlink" href="#buildbot.util.misc.deferredLocked" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>lock</strong> -- a <tt class="xref py py-class docutils literal"><span class="pre">twisted.internet.defer.DeferredLock</span></tt> instance or
a string naming an instance attribute containing one</td>
</tr>
</tbody>
</table>
<p>This is a decorator to wrap an event-driven method (one returning a
<tt class="docutils literal"><span class="pre">Deferred</span></tt>) in an acquire/release pair of a designated
<tt class="xref py py-class docutils literal"><span class="pre">DeferredLock</span></tt>.  For simple functions
with a static lock, this is as easy as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">someLock</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredLock</span><span class="p">()</span>
<span class="nd">@util.deferredLocked</span><span class="p">(</span><span class="n">someLock</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someLockedFunction</span><span class="p">():</span>
    <span class="c"># ..</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
<p>For class methods which must access a lock that is an instance attribute, the
lock can be specified by a string, which will be dynamically resolved to the
specific instance at runtime:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">someLock</span> <span class="o">=</span> <span class="n">defer</span><span class="o">.</span><span class="n">DeferredLock</span><span class="p">()</span>

<span class="nd">@util.deferredLocked</span><span class="p">(</span><span class="s">&#39;someLock&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">someLockedFunction</span><span class="p">():</span>
    <span class="c"># ..</span>
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="buildbot.util.misc.SerializedInvocation">
<em class="property">class </em><tt class="descclassname">buildbot.util.misc.</tt><tt class="descname">SerializedInvocation</tt><big>(</big><em>method</em><big>)</big><a class="headerlink" href="#buildbot.util.misc.SerializedInvocation" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a method wrapper that will serialize calls to an asynchronous
method.  If a second call occurs while the first call is still executing,
it will not begin until the first call has finished.  If multiple calls
queue up, they will be collapsed into a single call.  The effect is that
the underlying method is guaranteed to be called at least once after every
call to the wrapper.</p>
<p>Note that if this class is used as a decorator on a method, it will
serialize invocations across all class instances.  For synchronization
specific to each instance, wrap the method in the constructor:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">someMethod</span> <span class="o">=</span> <span class="n">SerializedInovcation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">someMethod</span><span class="p">)</span>
</pre></div>
</div>
<p>Tests can monkey-patch the <tt class="docutils literal"><span class="pre">_quiet</span></tt> method of the class to be notified
when all planned invocations are complete.</p>
</dd></dl>

</div>
<div class="section" id="module-buildbot.util.netstrings">
<span id="buildbot-util-netstrings"></span><h4>buildbot.util.netstrings<a class="headerlink" href="#module-buildbot.util.netstrings" title="Permalink to this headline">¶</a></h4>
<p>Similar to maildirs, <a class="reference external" href="http://cr.yp.to/proto/netstrings.txt">netstrings</a> are
used occasionally in Buildbot to encode data for interchange.  While Twisted
supports a basic netstring receiver protocol, it does not have a simple way to
apply that to a non-network situation.</p>
<dl class="class">
<dt id="buildbot.util.netstrings.NetstringParser">
<em class="property">class </em><tt class="descclassname">buildbot.util.netstrings.</tt><tt class="descname">NetstringParser</tt><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser" title="Permalink to this definition">¶</a></dt>
<dd><p>This class parses strings piece by piece, either collecting the accumulated
strings or invoking a callback for each one.</p>
<dl class="method">
<dt id="buildbot.util.netstrings.NetstringParser.feed">
<tt class="descname">feed</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser.feed" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> -- a portion of netstring-formatted data</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><tt class="xref py py-exc docutils literal"><span class="pre">twisted.protocols.basic.NetstringParseError</span></tt></td>
</tr>
</tbody>
</table>
<p>Add arbitrariliy-sized <tt class="docutils literal"><span class="pre">data</span></tt> to the incoming-data buffer.  Any
complete netstrings will trigger a call to the
<tt class="xref py py-meth docutils literal"><span class="pre">stringReceived</span></tt> method.</p>
<p>Note that this method (like the Twisted class it is based on) cannot
detect a trailing partial netstring at EOF - the data will be silently
ignored.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">stringReceived(string):</tt></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>string</strong> -- the decoded string</td>
</tr>
</tbody>
</table>
<p>This method is called for each decoded string as soon as it is read
completely.  The default implementation appends the string to the
<a class="reference internal" href="#buildbot.util.netstrings.NetstringParser.strings" title="buildbot.util.netstrings.NetstringParser.strings"><tt class="xref py py-attr docutils literal"><span class="pre">strings</span></tt></a> attribute, but subclasses can do anything.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.netstrings.NetstringParser.strings">
<tt class="descname">strings</tt><a class="headerlink" href="#buildbot.util.netstrings.NetstringParser.strings" title="Permalink to this definition">¶</a></dt>
<dd><p>The strings decoded so far, if <tt class="xref py py-meth docutils literal"><span class="pre">stringReceived</span></tt> is not
overridden.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.util.sautils">
<span id="buildbot-util-sautils"></span><h4>buildbot.util.sautils<a class="headerlink" href="#module-buildbot.util.sautils" title="Permalink to this headline">¶</a></h4>
<p>This module contains a few utilities that are not included with SQLAlchemy.</p>
<dl class="class">
<dt id="buildbot.util.sautils.InsertFromSelect">
<em class="property">class </em><tt class="descclassname">buildbot.util.sautils.</tt><tt class="descname">InsertFromSelect</tt><big>(</big><em>table</em>, <em>select</em><big>)</big><a class="headerlink" href="#buildbot.util.sautils.InsertFromSelect" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>table</strong> -- table into which insert should be performed</li>
<li><strong>select</strong> -- select query from which data should be drawn</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class is taken directly from SQLAlchemy's <a class="reference external" href="http://www.sqlalchemy.org/docs/core/compiler.html#compiling-sub-elements-of-a-custom-expression-construct">compiler.html</a>,
and allows a Pythonic representation of <tt class="docutils literal"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">..</span> <span class="pre">SELECT</span> <span class="pre">..</span></tt>
queries.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.util.sautils.sa_version">
<tt class="descclassname">buildbot.util.sautils.</tt><tt class="descname">sa_version</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.util.sautils.sa_version" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a 3-tuple representing the SQLAlchemy version.  Note that older
versions that did not have a <tt class="docutils literal"><span class="pre">__version__</span></tt> attribute are represented by
<tt class="docutils literal"><span class="pre">(0,0,0)</span></tt>.</p>
</dd></dl>

</div>
<div class="section" id="buildbot-util-subscription">
<h4>buildbot.util.subscription<a class="headerlink" href="#buildbot-util-subscription" title="Permalink to this headline">¶</a></h4>
<p>The classes in the <tt class="xref py py-mod docutils literal"><span class="pre">buildbot.util.subscription</span></tt> module are used for
master-local subscriptions.  In the near future, all uses of this module will
be replaced with message-queueing implementations that allow subscriptions and
subscribers to span multiple masters.</p>
</div>
<div class="section" id="buildbot-util-croniter">
<h4>buildbot.util.croniter<a class="headerlink" href="#buildbot-util-croniter" title="Permalink to this headline">¶</a></h4>
<p>This module is a copy of <a class="reference external" href="https://github.com/taichino/croniter">https://github.com/taichino/croniter</a>, and provides
suport for converting cron-like time specifications into actual times.</p>
</div>
<div class="section" id="module-buildbot.util.state">
<span id="buildbot-util-state"></span><h4>buildbot.util.state<a class="headerlink" href="#module-buildbot.util.state" title="Permalink to this headline">¶</a></h4>
<p>The classes in the <tt class="xref py py-mod docutils literal"><span class="pre">buildbot.util.subscription</span></tt> module are used for dealing with object state stored in the database.</p>
<dl class="class">
<dt id="buildbot.util.state.StateMixin">
<em class="property">class </em><tt class="descclassname">buildbot.util.state.</tt><tt class="descname">StateMixin</tt><a class="headerlink" href="#buildbot.util.state.StateMixin" title="Permalink to this definition">¶</a></dt>
<dd><p>This class provides helper methods for accessing the object state stored in the database.</p>
<dl class="attribute">
<dt id="buildbot.util.state.StateMixin.name">
<tt class="descname">name</tt><a class="headerlink" href="#buildbot.util.state.StateMixin.name" title="Permalink to this definition">¶</a></dt>
<dd><p>This must be set to the name to be used to identifiy this object in the database.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.util.state.StateMixin.master">
<tt class="descname">master</tt><a class="headerlink" href="#buildbot.util.state.StateMixin.master" title="Permalink to this definition">¶</a></dt>
<dd><p>This must point to the <tt class="xref py py-class docutils literal"><span class="pre">BuildMaster</span></tt> object.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.util.state.StateMixin.getState">
<tt class="descname">getState</tt><big>(</big><em>name</em>, <em>default</em><big>)</big><a class="headerlink" href="#buildbot.util.state.StateMixin.getState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> -- name of the value to retrieve</li>
<li><strong>default</strong> -- (optional) value to return if <cite>name</cite> is not present</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">state value via a Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><ul class="first last simple">
<li><strong>KeyError</strong> -- if <cite>name</cite> is not present and no default is given</li>
<li><strong>TypeError</strong> -- if JSON parsing fails</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Get a named state value from the object's state.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">getState</tt><big>(</big><em>name</em>, <em>value</em><big>)</big></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> -- the name of the value to change</li>
<li><strong>value</strong> -- the value to set - must be a JSONable object</li>
<li><strong>returns</strong> -- Deferred</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Raises TypeError:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body"><p class="first last">if JSONification fails</p>
</td>
</tr>
</tbody>
</table>
<p>Set a named state value in the object's persistent state.
Note that value must be json-able.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<span id="document-developer/database"></span><div class="section" id="database">
<span id="developer-database"></span><h3>Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h3>
<p>As of version 0.8.0, Buildbot has used a database as part of its storage
backend.  This section describes the database connector classes, which allow
other parts of Buildbot to access the database.  It also describes how to
modify the database schema and the connector classes themsleves.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Buildbot is only half-migrated to a database backend.  Build and builder
status information is still stored on disk in pickle files.  This is
difficult to fix, although work is underway.</p>
</div>
<div class="section" id="database-overview">
<h4>Database Overview<a class="headerlink" href="#database-overview" title="Permalink to this headline">¶</a></h4>
<p>All access to the Buildbot database is mediated by database connector classes.
These classes provide a functional, asynchronous interface to other parts of
Buildbot, and encapsulate the database-specific details in a single location in
the codebase.</p>
<p>The connector API, defined below, is a stable API in Buildbot, and can be
called from any other component.  Given a master <tt class="docutils literal"><span class="pre">master</span></tt>, the root of the
database connectors is available at <tt class="docutils literal"><span class="pre">master.db</span></tt>, so, for example, the state
connector's <tt class="docutils literal"><span class="pre">getState</span></tt> method is <tt class="docutils literal"><span class="pre">master.db.state.getState</span></tt>.</p>
<p>The connectors all use <a class="reference external" href="http://www.sqlalchemy.org/docs/index.html">SQLAlchemy Core</a> to achieve (almost)
database-independent operation.  Note that the SQLAlchemy ORM is not used in
Buildbot.  Database queries are carried out in threads, and report their
results back to the main thread via Twisted Deferreds.</p>
</div>
<div class="section" id="schema">
<h4>Schema<a class="headerlink" href="#schema" title="Permalink to this headline">¶</a></h4>
<p>The database schema is maintained with <a class="reference external" href="http://code.google.com/p/sqlalchemy-migrate/">SQLAlchemy-Migrate</a>.  This package handles the
details of upgrading users between different schema versions.</p>
<p>The schema itself is considered an implementation detail, and may change
significantly from version to version.  Users should rely on the API (below),
rather than performing queries against the database itself.</p>
</div>
<div class="section" id="api">
<h4>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h4>
<div class="section" id="module-buildbot.db.buildrequests">
<span id="buildrequests"></span><h5>buildrequests<a class="headerlink" href="#module-buildbot.db.buildrequests" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-0"></span><dl class="exception">
<dt id="buildbot.db.buildrequests.AlreadyClaimedError">
<em class="property">exception </em><tt class="descclassname">buildbot.db.buildrequests.</tt><tt class="descname">AlreadyClaimedError</tt><a class="headerlink" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when a build request is already claimed, usually by another master.</p>
</dd></dl>

<dl class="exception">
<dt id="buildbot.db.buildrequests.NotClaimedError">
<em class="property">exception </em><tt class="descclassname">buildbot.db.buildrequests.</tt><tt class="descname">NotClaimedError</tt><a class="headerlink" href="#buildbot.db.buildrequests.NotClaimedError" title="Permalink to this definition">¶</a></dt>
<dd><p>Raised when a build request is not claimed by this master.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.buildrequests.</tt><tt class="descname">BuildRequestsConnectorComponent</tt><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles the complex process of claiming and unclaiming build
requests, based on a polling model: callers poll for unclaimed requests with
<a class="reference internal" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests" title="buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests"><tt class="xref py py-meth docutils literal"><span class="pre">getBuildRequests</span></tt></a>, then attempt to claim the requests with
<a class="reference internal" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.claimBuildRequests" title="buildbot.db.buildrequests.BuildRequestsConnectorComponent.claimBuildRequests"><tt class="xref py py-meth docutils literal"><span class="pre">claimBuildRequests</span></tt></a>.  The claim can fail if another master has claimed
the request in the interim.</p>
<p>An instance of this class is available at <tt class="docutils literal"><span class="pre">master.db.buildrequests</span></tt>.</p>
<p id="index-1">Build requests are indexed by an ID referred to as a <em>brid</em>.  The contents
of a request are represented as build request dictionaries (brdicts) with
keys</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">brid</span></tt></li>
<li><tt class="docutils literal"><span class="pre">buildsetid</span></tt></li>
<li><tt class="docutils literal"><span class="pre">buildername</span></tt></li>
<li><tt class="docutils literal"><span class="pre">priority</span></tt></li>
<li><tt class="docutils literal"><span class="pre">claimed</span></tt> (boolean, true if the request is claimed)</li>
<li><tt class="docutils literal"><span class="pre">claimed_at</span></tt> (datetime object, time this request was last claimed)</li>
<li><tt class="docutils literal"><span class="pre">mine</span></tt> (boolean, true if the request is claimed by this master)</li>
<li><tt class="docutils literal"><span class="pre">complete</span></tt> (boolean, true if the request is complete)</li>
<li><tt class="docutils literal"><span class="pre">complete_at</span></tt> (datetime object, time this request was completed)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequest">
<tt class="descname">getBuildRequest</tt><big>(</big><em>brid</em><big>)</big><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequest" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>brid</strong> -- build request id to look up</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">brdict or <tt class="docutils literal"><span class="pre">None</span></tt>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a single BuildRequest, in the format described above.  This method
returns <tt class="docutils literal"><span class="pre">None</span></tt> if there is no such buildrequest.  Note that build
requests are not cached, as the values in the database are not fixed.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests">
<tt class="descname">getBuildRequests</tt><big>(</big><em>buildername=None</em>, <em>complete=None</em>, <em>claimed=None</em>, <em>bsid=None</em><big>)</big><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.getBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>buildername</strong> (<em>string</em>) -- limit results to buildrequests for this builder</li>
<li><strong>complete</strong> -- if true, limit to completed buildrequests; if false,
limit to incomplete buildrequests; if <tt class="docutils literal"><span class="pre">None</span></tt>, do not limit based on
completion.</li>
<li><strong>claimed</strong> -- see below</li>
<li><strong>bsid</strong> -- see below</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of brdicts, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a list of build requests matching the given characteristics.</p>
<p>Pass all parameters as keyword parameters to allow future expansion.</p>
<p>The <tt class="docutils literal"><span class="pre">claimed</span></tt> parameter can be <tt class="docutils literal"><span class="pre">None</span></tt> (the default) to ignore the
claimed status of requests; <tt class="docutils literal"><span class="pre">True</span></tt> to return only claimed builds,
<tt class="docutils literal"><span class="pre">False</span></tt> to return only unclaimed builds, or <tt class="docutils literal"><span class="pre">&quot;mine&quot;</span></tt> to return only
builds claimed by this master instance.  A request is considered
unclaimed if its <tt class="docutils literal"><span class="pre">claimed_at</span></tt> column is either NULL or 0, and it is
not complete.  If <tt class="docutils literal"><span class="pre">bsid</span></tt> is specified, then only build requests for
that buildset will be returned.</p>
<p>A build is considered completed if its <tt class="docutils literal"><span class="pre">complete</span></tt> column is 1; the
<tt class="docutils literal"><span class="pre">complete_at</span></tt> column is not consulted.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.claimBuildRequests">
<tt class="descname">claimBuildRequests</tt><big>(</big><em>brids</em><span class="optional">[</span>, <em>claimed_at=XX</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.claimBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>brids</strong> (<em>list</em>) -- ids of buildrequests to claim</li>
<li><strong>claimed_at</strong> (<em>datetime</em>) -- time at which the builds are claimed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises :</th><td class="field-body"><p class="first last"><a class="reference internal" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="buildbot.db.buildrequests.AlreadyClaimedError"><tt class="xref py py-exc docutils literal"><span class="pre">AlreadyClaimedError</span></tt></a></p>
</td>
</tr>
</tbody>
</table>
<p>Try to &quot;claim&quot; the indicated build requests for this buildmaster
instance.  The resulting deferred will fire normally on success, or
fail with <a class="reference internal" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="buildbot.db.buildrequests.AlreadyClaimedError"><tt class="xref py py-exc docutils literal"><span class="pre">AlreadyClaimedError</span></tt></a> if <em>any</em> of the build
requests are already claimed by another master instance.  In this case,
none of the claims will take effect.</p>
<p>If <tt class="docutils literal"><span class="pre">claimed_at</span></tt> is not given, then the current time will be used.</p>
<p>As of 0.8.5, this method can no longer be used to re-claim build
requests.  All given ID's must be unclaimed.  Use
<a class="reference internal" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.reclaimBuildRequests" title="buildbot.db.buildrequests.BuildRequestsConnectorComponent.reclaimBuildRequests"><tt class="xref py py-meth docutils literal"><span class="pre">reclaimBuildRequests</span></tt></a> to reclaim.</p>
<span class="target" id="index-2"></span><div class="admonition note" id="index-3">
<p class="first admonition-title">Note</p>
<p class="last">On database backends that do not enforce referential integrity
(e.g., SQLite), this method will not prevent claims for nonexistent
build requests.  On database backends that do not support
transactions (MySQL), this method will not properly roll back any
partial claims made before an <a class="reference internal" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="buildbot.db.buildrequests.AlreadyClaimedError"><tt class="xref py py-exc docutils literal"><span class="pre">AlreadyClaimedError</span></tt></a> is
generated.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.reclaimBuildRequests">
<tt class="descname">reclaimBuildRequests</tt><big>(</big><em>brids</em><big>)</big><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.reclaimBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>brids</strong> (<em>list</em>) -- ids of buildrequests to reclaim</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises :</th><td class="field-body"><a class="reference internal" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="buildbot.db.buildrequests.AlreadyClaimedError"><tt class="xref py py-exc docutils literal"><span class="pre">AlreadyClaimedError</span></tt></a></td>
</tr>
</tbody>
</table>
<p>Re-claim the given build requests, updating the timestamp, but checking
that the requsts are owned by this master.  The resulting deferred will
fire normally on success, or fail with <a class="reference internal" href="#buildbot.db.buildrequests.AlreadyClaimedError" title="buildbot.db.buildrequests.AlreadyClaimedError"><tt class="xref py py-exc docutils literal"><span class="pre">AlreadyClaimedError</span></tt></a> if
<em>any</em> of the build requests are already claimed by another master
instance, or don't exist.  In this case, none of the reclaims will take
effect.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.unclaimBuildRequests">
<tt class="descname">unclaimBuildRequests</tt><big>(</big><em>brids</em><big>)</big><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.unclaimBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>brids</strong> (<em>list</em>) -- ids of buildrequests to unclaim</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Release this master's claim on all of the given build requests.  This
will not unclaim requests that are claimed by another master, but will
not fail in this case.  The method does not check whether a request is
completed.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.completeBuildRequests">
<tt class="descname">completeBuildRequests</tt><big>(</big><em>brids</em>, <em>results</em><span class="optional">[</span>, <em>complete_at=XX</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.completeBuildRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>brids</strong> (<em>integer</em>) -- build request IDs to complete</li>
<li><strong>results</strong> (<em>integer</em>) -- integer result code</li>
<li><strong>complete_at</strong> (<em>datetime</em>) -- time at which the buildset was completed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises :</th><td class="field-body"><p class="first last"><a class="reference internal" href="#buildbot.db.buildrequests.NotClaimedError" title="buildbot.db.buildrequests.NotClaimedError"><tt class="xref py py-exc docutils literal"><span class="pre">NotClaimedError</span></tt></a></p>
</td>
</tr>
</tbody>
</table>
<p>Complete a set of build requests, all of which are owned by this master
instance.  This will fail with <a class="reference internal" href="#buildbot.db.buildrequests.NotClaimedError" title="buildbot.db.buildrequests.NotClaimedError"><tt class="xref py py-exc docutils literal"><span class="pre">NotClaimedError</span></tt></a> if the build
request is already completed or does not exist.  If <tt class="docutils literal"><span class="pre">complete_at</span></tt> is
not given, the current time will be used.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildrequests.BuildRequestsConnectorComponent.unclaimExpiredRequests">
<tt class="descname">unclaimExpiredRequests</tt><big>(</big><em>old</em><big>)</big><a class="headerlink" href="#buildbot.db.buildrequests.BuildRequestsConnectorComponent.unclaimExpiredRequests" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>old</strong> (<em>int</em>) -- number of seconds after which a claim is considered old</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Find any incomplete claimed builds which are older than <tt class="docutils literal"><span class="pre">old</span></tt>
seconds, and clear their claim information.</p>
<p>This is intended to catch builds that were claimed by a master which
has since disappeared.  As a side effect, it will log a message if any
requests are unclaimed.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.builds">
<span id="builds"></span><h5>builds<a class="headerlink" href="#module-buildbot.db.builds" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-4"></span><dl class="class">
<dt id="buildbot.db.builds.BuildsConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.builds.</tt><tt class="descname">BuildsConnectorComponent</tt><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles a little bit of information about builds.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The interface for this class will change - the builds table duplicates
some information available in pickles, without including all such
information.  Do not depend on this API.</p>
</div>
<p>An instance of this class is available at <tt class="docutils literal"><span class="pre">master.db.builds</span></tt>.</p>
<p id="index-5">Builds are indexed by <em>bid</em> and their contents represented as <em>bdicts</em>
(build dictionaries), with keys</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">bid</span></tt> (the build ID, globally unique)</li>
<li><tt class="docutils literal"><span class="pre">number</span></tt> (the build number, unique only within this master and builder)</li>
<li><tt class="docutils literal"><span class="pre">brid</span></tt> (the ID of the build request that caused this build)</li>
<li><tt class="docutils literal"><span class="pre">start_time</span></tt></li>
<li><tt class="docutils literal"><span class="pre">finish_time</span></tt> (datetime objects, or None).</li>
</ul>
<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.getBuild">
<tt class="descname">getBuild</tt><big>(</big><em>bid</em><big>)</big><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.getBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bid</strong> (<em>integer</em>) -- build id</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Build dictionary as above or <tt class="docutils literal"><span class="pre">None</span></tt>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a single build, in the format described above.  Returns <tt class="docutils literal"><span class="pre">None</span></tt> if
there is no such build.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.getBuildsForRequest">
<tt class="descname">getBuildsForRequest</tt><big>(</big><em>brid</em><big>)</big><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.getBuildsForRequest" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>brids</strong> -- list of build request ids</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">List of build dictionaries as above, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a list of builds for the given build request.  The resulting build
dictionaries are in exactly the same format as for <a class="reference internal" href="#buildbot.db.builds.BuildsConnectorComponent.getBuild" title="buildbot.db.builds.BuildsConnectorComponent.getBuild"><tt class="xref py py-meth docutils literal"><span class="pre">getBuild</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.addBuild">
<tt class="descname">addBuild</tt><big>(</big><em>brid</em>, <em>number</em><big>)</big><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.addBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>brid</strong> -- build request id</li>
<li><strong>number</strong> -- build number</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">build ID via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new build to the db, recorded as having started at the current
time.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.builds.BuildsConnectorComponent.finishBuilds">
<tt class="descname">finishBuilds</tt><big>(</big><em>bids</em><big>)</big><a class="headerlink" href="#buildbot.db.builds.BuildsConnectorComponent.finishBuilds" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bids</strong> (<em>list</em>) -- build ids</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Mark the given builds as finished, with <tt class="docutils literal"><span class="pre">finish_time</span></tt> set to the
current time.  This is done unconditionally, even if the builds are
already finished.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.buildsets">
<span id="buildsets"></span><h5>buildsets<a class="headerlink" href="#module-buildbot.db.buildsets" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-6"></span><dl class="class">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.buildsets.</tt><tt class="descname">BuildsetsConnectorComponent</tt><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles getting buildsets into and out of the database.
Buildsets combine multiple build requests that were triggered together.</p>
<p>An instance of this class is available at <tt class="docutils literal"><span class="pre">master.db.buildsets</span></tt>.</p>
<p id="index-7">Buildsets are indexed by <em>bsid</em> and their contents represented as <em>bsdicts</em>
(buildset dictionaries), with keys</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">bsid</span></tt></li>
<li><tt class="docutils literal"><span class="pre">external_idstring</span></tt> (arbitrary string for mapping builds externally)</li>
<li><tt class="docutils literal"><span class="pre">reason</span></tt> (string; reason these builds were triggered)</li>
<li><tt class="docutils literal"><span class="pre">sourcestampsetid</span></tt> (source stamp set for this buildset)</li>
<li><tt class="docutils literal"><span class="pre">submitted_at</span></tt> (datetime object; time this buildset was created)</li>
<li><tt class="docutils literal"><span class="pre">complete</span></tt> (boolean; true if all of the builds for this buildset are complete)</li>
<li><tt class="docutils literal"><span class="pre">complete_at</span></tt> (datetime object; time this buildset was completed)</li>
<li><tt class="docutils literal"><span class="pre">results</span></tt> (aggregate result of this buildset; see <a class="reference internal" href="#build-result-codes"><em>Build Result Codes</em></a>)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.addBuildset">
<tt class="descname">addBuildset</tt><big>(</big><em>sourcestampsetid</em>, <em>reason</em>, <em>properties</em>, <em>builderNames</em>, <em>external_idstring=None</em><big>)</big><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.addBuildset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>sourcestampsetid</strong> (<em>integer</em>) -- id of the SourceStampSet for this buildset</li>
<li><strong>reason</strong> (<em>short unicode string</em>) -- reason for this buildset</li>
<li><strong>properties</strong> (<em>dictionary, where values are tuples of (value, source)</em>) -- properties for this buildset</li>
<li><strong>builderNames</strong> (<em>list of strings</em>) -- builders specified by this buildset</li>
<li><strong>external_idstring</strong> (<em>unicode string</em>) -- external key to identify this buildset; defaults to None</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">buildset ID and buildrequest IDs, via a Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a new Buildset to the database, along with BuildRequests for each
named builder, returning the resulting bsid via a Deferred.  Arguments
should be specified by keyword.</p>
<p>The return value is a tuple <tt class="docutils literal"><span class="pre">(bsid,</span> <span class="pre">brids)</span></tt> where <tt class="docutils literal"><span class="pre">bsid</span></tt> is the
inserted buildset ID and <tt class="docutils literal"><span class="pre">brids</span></tt> is a dictionary mapping buildernames
to build request IDs.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.completeBuildset">
<tt class="descname">completeBuildset</tt><big>(</big><em>bsid</em>, <em>results</em><span class="optional">[</span>, <em>complete_at=XX</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.completeBuildset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>bsid</strong> (<em>integer</em>) -- buildset ID to complete</li>
<li><strong>results</strong> (<em>integer</em>) -- integer result code</li>
<li><strong>complete_at</strong> (<em>datetime</em>) -- time the buildset was completed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises :</th><td class="field-body"><p class="first last"><tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt> if the buildset does not exist or is
already complete</p>
</td>
</tr>
</tbody>
</table>
<p>Complete a buildset, marking it with the given <tt class="docutils literal"><span class="pre">results</span></tt> and setting
its <tt class="docutils literal"><span class="pre">completed_at</span></tt> to the current time, if the <tt class="docutils literal"><span class="pre">complete_at</span></tt>
argument is omitted.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildset">
<tt class="descname">getBuildset</tt><big>(</big><em>bsid</em><big>)</big><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildset" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>bsid</strong> -- buildset ID</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">bsdict, or <tt class="docutils literal"><span class="pre">None</span></tt>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a bsdict representing the given buildset, or <tt class="docutils literal"><span class="pre">None</span></tt> if no such
buildset exists.</p>
<p>Note that buildsets are not cached, as the values in the database are
not fixed.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildsets">
<tt class="descname">getBuildsets</tt><big>(</big><em>complete=None</em><big>)</big><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildsets" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>complete</strong> -- if true, return only complete buildsets; if false,
return only incomplete buildsets; if <tt class="docutils literal"><span class="pre">None</span></tt> or omitted, return all
buildsets</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of bsdicts, via Deferred</td>
</tr>
</tbody>
</table>
<p>Get a list of bsdicts matching the given criteria.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildsetProperties">
<tt class="descname">getBuildsetProperties</tt><big>(</big><em>buildsetid</em><big>)</big><a class="headerlink" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.getBuildsetProperties" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>buildsetid</strong> -- buildset ID</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">dictionary mapping property name to <tt class="docutils literal"><span class="pre">value,</span> <span class="pre">source</span></tt>, via
Deferred</td>
</tr>
</tbody>
</table>
<p>Return the properties for a buildset, in the same format they were
given to <a class="reference internal" href="#buildbot.db.buildsets.BuildsetsConnectorComponent.addBuildset" title="buildbot.db.buildsets.BuildsetsConnectorComponent.addBuildset"><tt class="xref py py-meth docutils literal"><span class="pre">addBuildset</span></tt></a>.</p>
<p>Note that this method does not distinguish a nonexistent buildset from
a buildset with no properties, and returns <tt class="docutils literal"><span class="pre">{}</span></tt> in either case.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.changes">
<span id="changes"></span><h5>changes<a class="headerlink" href="#module-buildbot.db.changes" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-8"></span><dl class="class">
<dt id="buildbot.db.changes.ChangesConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.changes.</tt><tt class="descname">ChangesConnectorComponent</tt><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles changes in the buildbot database, including pulling
information from the changes sub-tables.</p>
<p>An instance of this class is available at <tt class="docutils literal"><span class="pre">master.db.changes</span></tt>.</p>
<p id="index-9">Changes are indexed by <em>changeid</em>, and are represented by a <em>chdict</em>, which
has the following keys:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">changeid</span></tt> (the ID of this change)</li>
<li><tt class="docutils literal"><span class="pre">author</span></tt> (unicode; the author of the change)</li>
<li><tt class="docutils literal"><span class="pre">files</span></tt> (list of unicode; source-code filenames changed)</li>
<li><tt class="docutils literal"><span class="pre">comments</span></tt> (unicode; user comments)</li>
<li><tt class="docutils literal"><span class="pre">is_dir</span></tt> (deprecated)</li>
<li><tt class="docutils literal"><span class="pre">links</span></tt> (list of unicode; links for this change, e.g., to web views,
review)</li>
<li><tt class="docutils literal"><span class="pre">revision</span></tt> (unicode string; revision for this change, or <tt class="docutils literal"><span class="pre">None</span></tt> if
unknown)</li>
<li><tt class="docutils literal"><span class="pre">when_timestamp</span></tt> (datetime instance; time of the change)</li>
<li><tt class="docutils literal"><span class="pre">branch</span></tt> (unicode string; branch on which the change took place, or
<tt class="docutils literal"><span class="pre">None</span></tt> for the &quot;default branch&quot;, whatever that might mean)</li>
<li><tt class="docutils literal"><span class="pre">category</span></tt> (unicode string; user-defined category of this change, or
<tt class="docutils literal"><span class="pre">None</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">revlink</span></tt> (unicode string; link to a web view of this change)</li>
<li><tt class="docutils literal"><span class="pre">properties</span></tt> (user-specified properties for this change, represented as
a dictionary mapping keys to (value, source))</li>
<li><tt class="docutils literal"><span class="pre">repository</span></tt> (unicode string; repository where this change occurred)</li>
<li><tt class="docutils literal"><span class="pre">project</span></tt> (unicode string; user-defined project to which this change
corresponds)</li>
</ul>
<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.addChange">
<tt class="descname">addChange</tt><big>(</big><em>author=None</em>, <em>files=None</em>, <em>comments=None</em>, <em>is_dir=0</em>, <em>links=None</em>, <em>revision=None</em>, <em>when_timestamp=None</em>, <em>branch=None</em>, <em>category=None</em>, <em>revlink=''</em>, <em>properties={}</em>, <em>repository=''</em>, <em>project=''</em>, <em>uid=None</em><big>)</big><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.addChange" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>author</strong> (<em>unicode string</em>) -- the author of this change</li>
<li><strong>files</strong> -- a list of filenames that were changed</li>
<li><strong>comments</strong> -- user comments on the change</li>
<li><strong>is_dir</strong> -- deprecated</li>
<li><strong>links</strong> (<em>list of unicode strings</em>) -- a list of links related to this change, e.g., to web
viewers or review pages</li>
<li><strong>revision</strong> (<em>unicode string</em>) -- the revision identifier for this change</li>
<li><strong>when_timestamp</strong> (<em>datetime instance or None</em>) -- when this change occurred, or the current time
if None</li>
<li><strong>branch</strong> (<em>unicode string</em>) -- the branch on which this change took place</li>
<li><strong>category</strong> (<em>unicode string</em>) -- category for this change (arbitrary use by Buildbot
users)</li>
<li><strong>revlink</strong> (<em>unicode string</em>) -- link to a web view of this revision</li>
<li><strong>properties</strong> (<em>dictionary</em>) -- properties to set on this change, where values are
tuples of (value, source).  At the moment, the source must be
<tt class="docutils literal"><span class="pre">'Change'</span></tt>, although this may be relaxed in later versions.</li>
<li><strong>repository</strong> (<em>unicode string</em>) -- the repository in which this change took place</li>
<li><strong>project</strong> (<em>unicode string</em>) -- the project this change is a part of</li>
<li><strong>uid</strong> (<em>integer</em>) -- uid generated for the change author</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">new change's ID via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Add a Change with the given attributes to the database, returning the
changeid via a Deferred.  All arguments should be given as keyword
arguments.</p>
<p>The <tt class="docutils literal"><span class="pre">project</span></tt> and <tt class="docutils literal"><span class="pre">repository</span></tt> arguments must be strings; <tt class="docutils literal"><span class="pre">None</span></tt>
is not allowed.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getChange">
<tt class="descname">getChange</tt><big>(</big><em>changeid</em>, <em>no_cache=False</em><big>)</big><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getChange" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>changeid</strong> -- the id of the change instance to fetch</li>
<li><strong>no_cache</strong> (<em>boolean</em>) -- bypass cache and always fetch from database</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">chdict via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a change dictionary for the given changeid, or <tt class="docutils literal"><span class="pre">None</span></tt> if no such
change exists.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getChangeUids">
<tt class="descname">getChangeUids</tt><big>(</big><em>changeid</em><big>)</big><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getChangeUids" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>changeid</strong> -- the id of the change instance to fetch</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of uids via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the userids associated with the given changeid.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getRecentChanges">
<tt class="descname">getRecentChanges</tt><big>(</big><em>count</em><big>)</big><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getRecentChanges" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>count</strong> -- maximum number of instances to return</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of dictionaries via Deferred, ordered by changeid</td>
</tr>
</tbody>
</table>
<p>Get a list of the <tt class="docutils literal"><span class="pre">count</span></tt> most recent changes, represented as
dictionaries; returns fewer if that many do not exist.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For this function, &quot;recent&quot; is determined by the order of the
changeids, not by <tt class="docutils literal"><span class="pre">when_timestamp</span></tt>.  This is most apparent in
DVCS's, where the timestamp of a change may be significantly
earlier than the time at which it is merged into a repository
monitored by Buildbot.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.changes.ChangesConnectorComponent.getLatestChangeid">
<tt class="descname">getLatestChangeid</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.db.changes.ChangesConnectorComponent.getLatestChangeid" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">changeid via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the most-recently-assigned changeid, or <tt class="docutils literal"><span class="pre">None</span></tt> if there are no
changes at all.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.schedulers">
<span id="schedulers"></span><h5>schedulers<a class="headerlink" href="#module-buildbot.db.schedulers" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-10"></span><dl class="class">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.schedulers.</tt><tt class="descname">SchedulersConnectorComponent</tt><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class manages the state of the Buildbot schedulers.  This state includes
classifications of as-yet un-built changes.</p>
<p>An instance of this class is available at <tt class="docutils literal"><span class="pre">master.db.changes</span></tt>.</p>
<p id="index-11">Schedulers are identified by a their objectid - see
<tt class="xref py py-class docutils literal"><span class="pre">StateConnectorComponent</span></tt>.</p>
<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.classifyChanges">
<tt class="descname">classifyChanges</tt><big>(</big><em>objectid</em>, <em>classifications</em><big>)</big><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.classifyChanges" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>objectid</strong> -- scheduler classifying the changes</li>
<li><strong>classifications</strong> (<em>dictionary</em>) -- mapping of changeid to boolean, where the boolean
is true if the change is important, and false if it is unimportant</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Record the given classifications.  This method allows a scheduler to
record which changes were important and which were not immediately,
even if the build based on those changes will not occur for some time
(e.g., a tree stable timer).  Schedulers should be careful to flush
classifications once they are no longer needed, using
<tt class="xref py py-meth docutils literal"><span class="pre">flushChangeClassifications</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.schedulers.SchedulersConnectorComponent.getChangeClassifications">
<tt class="descname">getChangeClassifications</tt><big>(</big><em>objectid</em><span class="optional">[</span>, <em>branch</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#buildbot.db.schedulers.SchedulersConnectorComponent.getChangeClassifications" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>objectid</strong> (<em>integer</em>) -- scheduler to look up changes for</li>
<li><strong>branch</strong> (<em>string or None (for default branch)</em>) -- (optional) limit to changes with this branch</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">dictionary via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Return the classifications made by this scheduler, in the form of a
dictionary mapping changeid to a boolean, just as supplied to
<a class="reference internal" href="#buildbot.db.schedulers.SchedulersConnectorComponent.classifyChanges" title="buildbot.db.schedulers.SchedulersConnectorComponent.classifyChanges"><tt class="xref py py-meth docutils literal"><span class="pre">classifyChanges</span></tt></a>.</p>
<p>If <tt class="docutils literal"><span class="pre">branch</span></tt> is specified, then only changes on that branch will be
given.  Note that specifying <tt class="docutils literal"><span class="pre">branch=None</span></tt> requests changes for the
default branch, and is not the same as omitting the <tt class="docutils literal"><span class="pre">branch</span></tt> argument
altogether.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.sourcestamps">
<span id="sourcestamps"></span><h5>sourcestamps<a class="headerlink" href="#module-buildbot.db.sourcestamps" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-12"></span><dl class="class">
<dt id="buildbot.db.sourcestamps.SourceStampsConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.sourcestamps.</tt><tt class="descname">SourceStampsConnectorComponent</tt><a class="headerlink" href="#buildbot.db.sourcestamps.SourceStampsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class manages source stamps, as stored in the database. Source stamps
are linked to changes. Source stamps with the same sourcestampsetid belong
to the same sourcestampset. Buildsets link to one or more source stamps via
a sourcestampset id.</p>
<p>An instance of this class is available at <tt class="docutils literal"><span class="pre">master.db.sourcestamps</span></tt>.</p>
<p id="index-13">Source stamps are identified by a <em>ssid</em>, and represented internally as a <em>ssdict</em>, with keys</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ssid</span></tt></li>
<li><tt class="docutils literal"><span class="pre">sourcestampsetid</span></tt> (set to which the sourcestamp belongs)</li>
<li><tt class="docutils literal"><span class="pre">branch</span></tt> (branch, or <tt class="docutils literal"><span class="pre">None</span></tt> for default branch)</li>
<li><tt class="docutils literal"><span class="pre">revision</span></tt> (revision, or <tt class="docutils literal"><span class="pre">None</span></tt> to indicate the latest revision, in
which case this is a relative source stamp)</li>
<li><tt class="docutils literal"><span class="pre">patch_body</span></tt> (body of the patch, or <tt class="docutils literal"><span class="pre">None</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">patch_level</span></tt> (directory stripping level of the patch, or <tt class="docutils literal"><span class="pre">None</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">patch_subdir</span></tt> (subdirectory in which to apply the patch, or <tt class="docutils literal"><span class="pre">None</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">patch_author</span></tt> (author of the patch, or <tt class="docutils literal"><span class="pre">None</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">patch_comment</span></tt> (comment for the patch, or <tt class="docutils literal"><span class="pre">None</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">repository</span></tt> (repository containing the source; never <tt class="docutils literal"><span class="pre">None</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">project</span></tt> (project this source is for; never <tt class="docutils literal"><span class="pre">None</span></tt>)</li>
<li><tt class="docutils literal"><span class="pre">changeids</span></tt> (list of changes, by id, that generated this sourcestamp)</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Presently, no attempt is made to ensure uniqueness of source stamps, so
multiple ssids may correspond to the same source stamp.  This may be fixed
in a future version.</p>
</div>
<dl class="method">
<dt id="buildbot.db.sourcestamps.SourceStampsConnectorComponent.addSourceStamp">
<tt class="descname">addSourceStamp</tt><big>(</big><em>branch</em>, <em>revision</em>, <em>repository</em>, <em>project</em>, <em>patch_body=None</em>, <em>patch_level=0</em>, <em>patch_author=&quot;&quot;</em>, <em>patch_comment=&quot;&quot;</em>, <em>patch_subdir=None</em>, <em>changeids=</em><span class="optional">[</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#buildbot.db.sourcestamps.SourceStampsConnectorComponent.addSourceStamp" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>branch</strong> (<em>unicode string</em>) -- </li>
<li><strong>revision</strong> (<em>unicode string</em>) -- </li>
<li><strong>repository</strong> (<em>unicode string</em>) -- </li>
<li><strong>project</strong> (<em>string</em>) -- </li>
<li><strong>patch_body</strong> (<em>string</em>) -- (optional)</li>
<li><strong>patch_level</strong> (<em>int</em>) -- (optional)</li>
<li><strong>patch_author</strong> (<em>unicode string</em>) -- (optional)</li>
<li><strong>patch_comment</strong> (<em>unicode string</em>) -- (optional)</li>
<li><strong>patch_subdir</strong> (<em>unicode string</em>) -- (optional)</li>
<li><strong>changeids</strong> (<em>list of ints</em>) -- </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">ssid, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Create a new SourceStamp instance with the given attributes, and return
its ssid.  The arguments all have the same meaning as in an ssdict.
Pass them as keyword arguments to allow for future expansion.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStamp">
<tt class="descname">getSourceStamp</tt><big>(</big><em>ssid</em><big>)</big><a class="headerlink" href="#buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStamp" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>ssid</strong> -- sourcestamp to get</li>
<li><strong>no_cache</strong> (<em>boolean</em>) -- bypass cache and always fetch from database</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">ssdict, or <tt class="docutils literal"><span class="pre">None</span></tt>, via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get an ssdict representing the given source stamp, or <tt class="docutils literal"><span class="pre">None</span></tt> if no
such source stamp exists.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStamps">
<tt class="descname">getSourceStamps</tt><big>(</big><em>sourcestampsetid</em><big>)</big><a class="headerlink" href="#buildbot.db.sourcestamps.SourceStampsConnectorComponent.getSourceStamps" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sourcestampsetid</strong> (<em>integer</em>) -- identification of the set, all returned sourcestamps belong to this set</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">sslist of ssdict</td>
</tr>
</tbody>
</table>
<p>Get a set of sourcestamps identified by a set id. The set is returned as
a sslist that contains one or more sourcestamps (represented as ssdicts).
The list is empty if the set does not exist or no sourcestamps belong to the set.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.sourcestampsets">
<span id="sourcestampset"></span><h5>sourcestampset<a class="headerlink" href="#module-buildbot.db.sourcestampsets" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-14"></span><dl class="class">
<dt id="buildbot.db.sourcestampsets.SourceStampSetsConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.sourcestampsets.</tt><tt class="descname">SourceStampSetsConnectorComponent</tt><a class="headerlink" href="#buildbot.db.sourcestampsets.SourceStampSetsConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is responsible for adding new sourcestampsets to the database.
Build sets link to sourcestamp sets, via their (set) id's.</p>
<p>An instance of this class is available at <tt class="docutils literal"><span class="pre">master.db.sourcestampsets</span></tt>.</p>
<p>Sourcestamp sets are identified by a sourcestampsetid.</p>
<dl class="method">
<dt id="buildbot.db.sourcestampsets.SourceStampSetsConnectorComponent.addSourceStampSet">
<tt class="descname">addSourceStampSet</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.db.sourcestampsets.SourceStampSetsConnectorComponent.addSourceStampSet" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">new sourcestampsetid as integer, via Deferred</td>
</tr>
</tbody>
</table>
<p>Add a new (empty) sourcestampset to the database. The unique identification
of the set is returned as integer. The new id can be used to add
new sourcestamps to the database and as reference in a buildset.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.state">
<span id="state"></span><h5>state<a class="headerlink" href="#module-buildbot.db.state" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-15"></span><dl class="class">
<dt id="buildbot.db.state.StateConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.state.</tt><tt class="descname">StateConnectorComponent</tt><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles maintaining arbitrary key/value state for Buildbot
objects.  Each object can store arbitrary key/value pairs, where the values
are any JSON-encodable value.  Each pair can be set and retrieved
atomically.</p>
<p>Objects are identified by their (user-visible) name and their
class.  This allows, for example, a <tt class="docutils literal"><span class="pre">nightly_smoketest</span></tt> object of class
<tt class="docutils literal"><span class="pre">NightlyScheduler</span></tt> to maintain its state even if it moves between
masters, but avoids cross-contaminating state between different classes
of objects with the same name.</p>
<p>Note that &quot;class&quot; is not interpreted literally, and can be any string that
will uniquely identify the class for the object; if classes are renamed,
they can continue to use the old names.</p>
<p>An instance of this class is available at <tt class="docutils literal"><span class="pre">master.db.state</span></tt>.</p>
<p id="index-16">Objects are identified by <em>objectid</em>.</p>
<dl class="method">
<dt id="buildbot.db.state.StateConnectorComponent.getObjectId">
<tt class="descname">getObjectId</tt><big>(</big><em>name</em>, <em>class_name</em><big>)</big><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent.getObjectId" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>name</strong> -- name of the object</li>
<li><strong>class_name</strong> -- object class name</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the objectid, via a Deferred.</p>
</td>
</tr>
</tbody>
</table>
<p>Get the object ID for this combination of a name and a class.  This
will add a row to the 'objects' table if none exists already.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.state.StateConnectorComponent.getState">
<tt class="descname">getState</tt><big>(</big><em>objectid</em>, <em>name</em><span class="optional">[</span>, <em>default</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent.getState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>objectid</strong> -- objectid on which the state should be checked</li>
<li><strong>name</strong> -- name of the value to retrieve</li>
<li><strong>default</strong> -- (optional) value to return if C{name} is not present</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">state value via a Deferred</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name" colspan="2">Raises KeyError:</th></tr>
<tr class="field-odd field"><td>&nbsp;</td><td class="field-body"><p class="first">if <tt class="docutils literal"><span class="pre">name</span></tt> is not present and no default is given</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><p class="first last">TypeError if JSON parsing fails</p>
</td>
</tr>
</tbody>
</table>
<p>Get the state value for key <tt class="docutils literal"><span class="pre">name</span></tt> for the object with id
<tt class="docutils literal"><span class="pre">objectid</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.state.StateConnectorComponent.setState">
<tt class="descname">setState</tt><big>(</big><em>objectid</em>, <em>name</em>, <em>value</em><big>)</big><a class="headerlink" href="#buildbot.db.state.StateConnectorComponent.setState" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>objectid</strong> -- the objectid for which the state should be changed</li>
<li><strong>name</strong> -- the name of the value to change</li>
<li><strong>value</strong> (<em>JSON-able value</em>) -- the value to set</li>
<li><strong>returns</strong> -- Deferred</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><p class="first last">TypeError if JSONification fails</p>
</td>
</tr>
</tbody>
</table>
<p>Set the state value for <tt class="docutils literal"><span class="pre">name</span></tt> for the object with id <tt class="docutils literal"><span class="pre">objectid</span></tt>,
overwriting any existing value.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.users">
<span id="users"></span><h5>users<a class="headerlink" href="#module-buildbot.db.users" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-17"></span><dl class="class">
<dt id="buildbot.db.users.UsersConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.users.</tt><tt class="descname">UsersConnectorComponent</tt><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This class handles Buildbot's notion of users.  Buildbot tracks the usual
information about users -- username and password, plus a display name.</p>
<p>The more complicated task is to recognize each user across multiple
interfaces with Buildbot.  For example, a user may be identified as
'djmitche' in Subversion, <a class="reference external" href="mailto:'dustin&#37;&#52;&#48;v&#46;igoro&#46;us">'dustin<span>&#64;</span>v<span>&#46;</span>igoro<span>&#46;</span>us</a>' in Git, and 'dustin' on IRC.
To support this functionality, each user as a set of attributes, keyed by
type.  The <a class="reference internal" href="#buildbot.db.users.UsersConnectorComponent.findUserByAttr" title="buildbot.db.users.UsersConnectorComponent.findUserByAttr"><tt class="xref py py-meth docutils literal"><span class="pre">findUserByAttr</span></tt></a> method uses these attributes to match users,
adding a new user if no matching user is found.</p>
<p>Users are identified canonically by <em>uid</em>, and are represented by <em>usdicts</em> (user
dictionaries) with keys</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">uid</span></tt></li>
<li><tt class="docutils literal"><span class="pre">identifier</span></tt> (display name for the user)</li>
<li><tt class="docutils literal"><span class="pre">bb_username</span></tt> (buildbot login username)</li>
<li><tt class="docutils literal"><span class="pre">bb_password</span></tt> (hashed login password)</li>
</ul>
<p>All attributes are also included in the dictionary, keyed by type.  Types
colliding with the keys above are ignored.</p>
<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.findUserByAttr">
<tt class="descname">findUserByAttr</tt><big>(</big><em>identifier</em>, <em>attr_type</em>, <em>attr_data</em><big>)</big><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.findUserByAttr" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>identifier</strong> -- identifier to use for a new user</li>
<li><strong>attr_type</strong> -- attribute type to search for and/or add</li>
<li><strong>attr_data</strong> -- attribute data to add</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">userid via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get an existing user, or add a new one, based on the given attribute.</p>
<p>This method is intended for use by other components of Buildbot to
search for a user with the given attributes.</p>
<p>Note that <tt class="docutils literal"><span class="pre">identifier</span></tt> is <em>not</em> used in the search for an existing
user.  It is only used when creating a new user.  The identifier should
be based deterministically on the attributes supplied, in some fashion
that will seem natural to users.</p>
<p>For future compatibility, always use keyword parameters to call this
method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.getUser">
<tt class="descname">getUser</tt><big>(</big><em>uid</em><big>)</big><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.getUser" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>uid</strong> -- user id to look up</li>
<li><strong>no_cache</strong> (<em>boolean</em>) -- bypass cache and always fetch from database</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">usdict via Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Get a usdict for the given user, or <tt class="docutils literal"><span class="pre">None</span></tt> if no matching user is
found.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.getUserByUsername">
<tt class="descname">getUserByUsername</tt><big>(</big><em>username</em><big>)</big><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.getUserByUsername" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>username</strong> (<em>string</em>) -- username portion of user credentials</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">usdict or None via deferred</td>
</tr>
</tbody>
</table>
<p>Looks up the user with the bb_username, returning the usdict or
<tt class="docutils literal"><span class="pre">None</span></tt> if no matching user is found.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.getUsers">
<tt class="descname">getUsers</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.getUsers" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">list of partial usdicts via Deferred</td>
</tr>
</tbody>
</table>
<p>Get the entire list of users.  User attributes are not included, so the
results are not full userdicts.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.updateUser">
<tt class="descname">updateUser</tt><big>(</big><em>uid=None</em>, <em>identifier=None</em>, <em>bb_username=None</em>, <em>bb_password=None</em>, <em>attr_type=None</em>, <em>attr_data=None</em><big>)</big><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.updateUser" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>uid</strong> (<em>int</em>) -- the user to change</li>
<li><strong>identifier</strong> (<em>string</em>) -- (optional) new identifier for this user</li>
<li><strong>bb_username</strong> (<em>string</em>) -- (optional) new buildbot username</li>
<li><strong>bb_password</strong> (<em>string</em>) -- (optional) new hashed buildbot password</li>
<li><strong>attr_type</strong> (<em>string</em>) -- (optional) attribute type to update</li>
<li><strong>attr_data</strong> (<em>string</em>) -- (optional) value for <tt class="docutils literal"><span class="pre">attr_type</span></tt></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Update information about the given user.  Only the specified attributes
are updated.  If no user with the given uid exists, the method will
return silently.</p>
<p>Note that <tt class="docutils literal"><span class="pre">bb_password</span></tt> must be given if <tt class="docutils literal"><span class="pre">bb_username</span></tt> appears;
similarly, <tt class="docutils literal"><span class="pre">attr_type</span></tt> requires <tt class="docutils literal"><span class="pre">attr_data</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.removeUser">
<tt class="descname">removeUser</tt><big>(</big><em>uid</em><big>)</big><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.removeUser" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>uid</strong> (<em>int</em>) -- the user to remove</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Remove the user with the given uid from the database.  This will remove
the user from any associated tables as well.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.users.UsersConnectorComponent.identifierToUid">
<tt class="descname">identifierToUid</tt><big>(</big><em>identifier</em><big>)</big><a class="headerlink" href="#buildbot.db.users.UsersConnectorComponent.identifierToUid" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>identifier</strong> (<em>string</em>) -- identifier to search for</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">uid or <tt class="docutils literal"><span class="pre">None</span></tt>, via Deferred</td>
</tr>
</tbody>
</table>
<p>Fetch a uid for the given identifier, if one exists.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="writing-database-connector-methods">
<h4>Writing Database Connector Methods<a class="headerlink" href="#writing-database-connector-methods" title="Permalink to this headline">¶</a></h4>
<p>The information above is intended for developers working on the rest of
Buildbot, and treating the database layer as an abstraction.  The remainder of
this section describes the internals of the database implementation, and is
intended for developers modifying the schema or adding new methods to the
database layer.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It's difficult to change the database schema significantly after it has
been released, and very disruptive to users to change the database API.
Consider very carefully the future-proofing of any changes here!</p>
</div>
<div class="section" id="module-buildbot.db.connector">
<span id="the-db-connector-and-components"></span><h5>The DB Connector and Components<a class="headerlink" href="#module-buildbot.db.connector" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.db.connector.DBConnector">
<em class="property">class </em><tt class="descclassname">buildbot.db.connector.</tt><tt class="descname">DBConnector</tt><a class="headerlink" href="#buildbot.db.connector.DBConnector" title="Permalink to this definition">¶</a></dt>
<dd><p>The root of the database connectors, <tt class="docutils literal"><span class="pre">master.db</span></tt>, is a
<a class="reference internal" href="#buildbot.db.connector.DBConnector" title="buildbot.db.connector.DBConnector"><tt class="xref py py-class docutils literal"><span class="pre">DBConnector</span></tt></a> instance.  Its main purpose is
to hold reference to each of the connector components, but it also handles
timed cleanup tasks.</p>
<p>If you are adding a new connector component, import its module and create
an instance of it in this class's constructor.</p>
</dd></dl>

<span class="target" id="module-buildbot.db.base"></span><dl class="class">
<dt id="buildbot.db.base.DBConnectorComponent">
<em class="property">class </em><tt class="descclassname">buildbot.db.base.</tt><tt class="descname">DBConnectorComponent</tt><a class="headerlink" href="#buildbot.db.base.DBConnectorComponent" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base class for connector components.</p>
<p>There should be no need to override the constructor defined by this base
class.</p>
<dl class="attribute">
<dt id="buildbot.db.base.DBConnectorComponent.db">
<tt class="descname">db</tt><a class="headerlink" href="#buildbot.db.base.DBConnectorComponent.db" title="Permalink to this definition">¶</a></dt>
<dd><p>A reference to the <a class="reference internal" href="#buildbot.db.connector.DBConnector" title="buildbot.db.connector.DBConnector"><tt class="xref py py-class docutils literal"><span class="pre">DBConnector</span></tt></a>, so that
connector components can use e.g., <tt class="docutils literal"><span class="pre">self.db.pool</span></tt> or
<tt class="docutils literal"><span class="pre">self.db.model</span></tt>.  In the unusual case that a connector component
needs access to the master, the easiest path is <tt class="docutils literal"><span class="pre">self.db.master</span></tt>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.pool">
<span id="direct-database-access"></span><h5>Direct Database Access<a class="headerlink" href="#module-buildbot.db.pool" title="Permalink to this headline">¶</a></h5>
<p>The connectors all use <a class="reference external" href="http://www.sqlalchemy.org/docs/index.html">SQLAlchemy Core</a> as a wrapper around database
client drivers.  Unfortunately, SQLAlchemy is a synchronous library, so some
extra work is required to use it in an asynchronous context like Buildbot.
This is accomplished by deferring all database operations to threads, and
returning a Deferred.  The <tt class="xref py py-class docutils literal"><span class="pre">Pool</span></tt> class takes care of
the details.</p>
<p>A connector method should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">myMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">thd</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
        <span class="n">q</span> <span class="o">=</span> <span class="o">...</span> <span class="c"># construct a query</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
            <span class="o">...</span> <span class="c"># do something with the results</span>
        <span class="k">return</span> <span class="o">...</span> <span class="c"># return an interesting value</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">thd</span><span class="p">)</span>
</pre></div>
</div>
<p>Picking that apart, the body of the method defines a function named <tt class="docutils literal"><span class="pre">thd</span></tt>
taking one argument, a <tt class="xref py py-class docutils literal"><span class="pre">Connection</span></tt> object.  It then calls
<tt class="docutils literal"><span class="pre">self.db.pool.do</span></tt>, passing the <tt class="docutils literal"><span class="pre">thd</span></tt> function.  This function is called in
a thread, and can make blocking calls to SQLAlchemy as desired.  The <tt class="docutils literal"><span class="pre">do</span></tt>
method will return a Deferred that will fire with the return value of <tt class="docutils literal"><span class="pre">thd</span></tt>,
or with a failure representing any exceptions raised by <tt class="docutils literal"><span class="pre">thd</span></tt>.</p>
<p>The return value of <tt class="docutils literal"><span class="pre">thd</span></tt> must not be an SQLAlchemy object - in particular,
any <tt class="xref py py-class docutils literal"><span class="pre">ResultProxy</span></tt>
objects must be parsed into lists or other data structures before they are
returned.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">As the name <tt class="docutils literal"><span class="pre">thd</span></tt> indicates, the function runs in a thread.  It should
not interact with any other part of Buildbot, nor with any of the Twisted
components that expect to be accessed from the main thread -- the reactor,
Deferreds, etc.</p>
</div>
<p>Queries can be constructed using any of the SQLAlchemy core methods, using
tables from <a class="reference internal" href="#buildbot.db.model.Model" title="buildbot.db.model.Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a>, and executed with the connection
object, <tt class="docutils literal"><span class="pre">conn</span></tt>.</p>
<dl class="class">
<dt id="buildbot.db.pool.DBThreadPool">
<em class="property">class </em><tt class="descclassname">buildbot.db.pool.</tt><tt class="descname">DBThreadPool</tt><a class="headerlink" href="#buildbot.db.pool.DBThreadPool" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="buildbot.db.pool.DBThreadPool.do">
<tt class="descname">do</tt><big>(</big><em>callable</em>, <em>...</em><big>)</big><a class="headerlink" href="#buildbot.db.pool.DBThreadPool.do" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Call <tt class="docutils literal"><span class="pre">callable</span></tt> in a thread, with a <tt class="xref py py-class docutils literal"><span class="pre">Connection</span></tt> object as first
argument.  Returns a deferred that will fire with the results of the
callable, or with a failure representing any exception raised during
its execution.</p>
<p>Any additional positional or keyword arguments are passed to
<tt class="docutils literal"><span class="pre">callable</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.pool.DBThreadPool.do_with_engine">
<tt class="descname">do_with_engine</tt><big>(</big><em>callable</em>, <em>...</em><big>)</big><a class="headerlink" href="#buildbot.db.pool.DBThreadPool.do_with_engine" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Similar to <a class="reference internal" href="#buildbot.db.pool.DBThreadPool.do" title="buildbot.db.pool.DBThreadPool.do"><tt class="xref py py-meth docutils literal"><span class="pre">do</span></tt></a>, call <tt class="docutils literal"><span class="pre">callable</span></tt> in a thread, but with an
<tt class="xref py py-class docutils literal"><span class="pre">Engine</span></tt> object as
first argument.</p>
<p>This method is only used for schema manipulation, and should not be
used in a running master.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-buildbot.db.model">
<span id="database-schema"></span><h5>Database Schema<a class="headerlink" href="#module-buildbot.db.model" title="Permalink to this headline">¶</a></h5>
<p>Database connector methods access the database through SQLAlchemy, which
requires access to Python objects represenging the database tables.  That is
handled through the model.</p>
<dl class="class">
<dt id="buildbot.db.model.Model">
<em class="property">class </em><tt class="descclassname">buildbot.db.model.</tt><tt class="descname">Model</tt><a class="headerlink" href="#buildbot.db.model.Model" title="Permalink to this definition">¶</a></dt>
<dd><p>This class contains the canonical description of the buildbot schema, It is
presented in the form of SQLAlchemy <tt class="xref py py-class docutils literal"><span class="pre">Table</span></tt> instances, as class variables.  At
runtime, the model is available at <tt class="docutils literal"><span class="pre">master.db.model</span></tt>, so for example the
<tt class="docutils literal"><span class="pre">buildrequests</span></tt> table can be referred to as
<tt class="docutils literal"><span class="pre">master.db.model.buildrequests</span></tt>, and columns are available in its <tt class="docutils literal"><span class="pre">c</span></tt>
attribute.</p>
<p>The source file, <a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/db/model.py" title="master/buildbot/db/model.py"><tt class="docutils literal"><span class="pre">master/buildbot/db/model.py</span></tt></a>, contains comments
describing each table; that information is not replicated in this
documentation.</p>
<p>Note that the model is not used for new installations or upgrades of the
Buildbot database.  See <a class="reference internal" href="#modifying-the-database-schema"><em>Modifying the Database Schema</em></a> for more
information.</p>
<dl class="attribute">
<dt id="buildbot.db.model.Model.metadata">
<tt class="descname">metadata</tt><a class="headerlink" href="#buildbot.db.model.Model.metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>The model object also has a <tt class="docutils literal"><span class="pre">metadata</span></tt> attribute containing a
<tt class="xref py py-class docutils literal"><span class="pre">MetaData</span></tt> instance.
Connector methods should not need to access this object.  The metadata
is not bound to an engine.</p>
</dd></dl>

<p>The <a class="reference internal" href="#buildbot.db.model.Model" title="buildbot.db.model.Model"><tt class="xref py py-class docutils literal"><span class="pre">Model</span></tt></a> class also defines some migration-related methods:</p>
<dl class="method">
<dt id="buildbot.db.model.Model.is_current">
<tt class="descname">is_current</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.db.model.Model.is_current" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">boolean via Deferred</td>
</tr>
</tbody>
</table>
<p>Returns true if the current database's version is current.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.db.model.Model.upgrade">
<tt class="descname">upgrade</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.db.model.Model.upgrade" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Upgrades the database to the most recent schema version.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="caching">
<h5>Caching<a class="headerlink" href="#caching" title="Permalink to this headline">¶</a></h5>
<p>Connector component methods that get an object based on an ID are good
candidates for caching.  The <a class="reference internal" href="#buildbot.db.base.cached" title="buildbot.db.base.cached"><tt class="xref py py-func docutils literal"><span class="pre">cached</span></tt></a> decorator
makes this automatic:</p>
<dl class="function">
<dt id="buildbot.db.base.cached">
<tt class="descclassname">buildbot.db.base.</tt><tt class="descname">cached</tt><big>(</big><em>cachename</em><big>)</big><a class="headerlink" href="#buildbot.db.base.cached" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>cache_name</strong> -- name of the cache to use</td>
</tr>
</tbody>
</table>
<p>A decorator for &quot;getter&quot; functions that fetch an object from the database
based on a single key.  The wrapped method will only be called if the named
cache does not contain the key.</p>
<p>The wrapped function must take one argument (the key); the wrapper will
take a key plus an optional <tt class="docutils literal"><span class="pre">no_cache</span></tt> argument which, if true, will
cause it to invoke the underlying method even if the key is in the cache.</p>
<p>The resulting method will have a <tt class="docutils literal"><span class="pre">cache</span></tt> attribute which can be used to
access the underlying cache.</p>
</dd></dl>

<p>In most cases, getter methods return a well-defined dictionary.  Unfortunately,
Python does not handle weak references to bare dictionaries, so components must
instantiate a subclass of <tt class="docutils literal"><span class="pre">dict</span></tt>.  The whole assembly looks something like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ThDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">ThingConnectorComponent</span><span class="p">(</span><span class="n">base</span><span class="o">.</span><span class="n">DBConnectorComponent</span><span class="p">):</span>

    <span class="nd">@base.cached</span><span class="p">(</span><span class="s">&#39;thdicts&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">getThing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thid</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">thd</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
            <span class="o">...</span>
            <span class="n">thdict</span> <span class="o">=</span> <span class="n">ThDict</span><span class="p">(</span><span class="n">thid</span><span class="o">=</span><span class="n">thid</span><span class="p">,</span> <span class="n">attr</span><span class="o">=</span><span class="n">row</span><span class="o">.</span><span class="n">attr</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">thdict</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">thd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="tests">
<h5>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h5>
<p>It goes without saying that any new connector methods must be fully tested!</p>
<p>You will also want to add an in-memory implementation of the methods to the
fake classes in <tt class="docutils literal"><span class="pre">master/budilbot/test/fake/fakedb.py</span></tt>.  Non-DB Buildbot code
is tested using these fake implementations in order to isolate that code from
the database code.</p>
</div>
</div>
<div class="section" id="modifying-the-database-schema">
<span id="id2"></span><h4>Modifying the Database Schema<a class="headerlink" href="#modifying-the-database-schema" title="Permalink to this headline">¶</a></h4>
<p>Changes to the schema are accomplished through migration scripts, supported by
<a class="reference external" href="http://code.google.com/p/sqlalchemy-migrate/">SQLAlchemy-Migrate</a>.  In fact,
even new databases are created with the migration scripts -- a new database is
a migrated version of an empty database.</p>
<p>The schema is tracked by a version number, stored in the <tt class="docutils literal"><span class="pre">migrate_version</span></tt>
table.  This number is incremented for each change to the schema, and used to
determine whether the database must be upgraded.  The master will refuse to run
with an out-of-date database.</p>
<p>To make a change to the schema, first consider how to handle any existing data.
When adding new columns, this may not be necessary, but table refactorings can
be complex and require caution so as not to lose information.</p>
<p>Create a new script in <a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/db/migrate/versions" title="master/buildbot/db/migrate/versions"><tt class="docutils literal"><span class="pre">master/buildbot/db/migrate/versions</span></tt></a>, following
the numbering scheme already present.  The script should have an <tt class="docutils literal"><span class="pre">update</span></tt>
method, which takes an engine as a parameter, and ugprades the database, both
changing the schema and performing any required data migrations.  The engine
passed to this parameter is &quot;enhanced&quot; by SQLAlchemy-Migrate, with methods to
handle adding, altering, and dropping columns.  See the SQLAlchemy-Migrate
documentation for details.</p>
<p>Next, modify <a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/db/model.py" title="master/buildbot/db/model.py"><tt class="docutils literal"><span class="pre">master/buildbot/db/model.py</span></tt></a> to represent the updated
schema.  Buildbot's automated tests perform a rudimentary comparison of an
upgraded database with the model, but it is important to check the details -
key length, nullability, and so on can sometimes be missed by the checks.  If
the schema and the upgrade scripts get out of sync, bizarre behavior can
result.</p>
<p>Also, adjust the fake database table definitions in
<a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/test/fake/fakedb.py" title="master/buildbot/test/fake/fakedb.py"><tt class="docutils literal"><span class="pre">master/buildbot/test/fake/fakedb.py</span></tt></a> according to your changes.</p>
<p>Your upgrade script should have unit tests.  The classes in
<a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/test/util/migration.py" title="master/buildbot/test/util/migration.py"><tt class="docutils literal"><span class="pre">master/buildbot/test/util/migration.py</span></tt></a> make this straightforward.
Unit test scripts should be named e.g.,
<tt class="file docutils literal"><span class="pre">test_db_migrate_versions_015_remove_bad_master_objectid.py</span></tt>.</p>
<p>The <tt class="file docutils literal"><span class="pre">master/buildbot/test/integration/test_upgrade.py</span></tt> also tests
upgrades, and will confirm that the resulting database matches the model.  If
you encounter implicit indexes on MySQL, that do not appear on SQLite or
Postgres, add them to <tt class="docutils literal"><span class="pre">implied_indexes</span></tt> in
<tt class="file docutils literal"><span class="pre">master/buidlbot/db/model.py</span></tt>.</p>
</div>
<div class="section" id="database-compatibility-notes">
<h4>Database Compatibility Notes<a class="headerlink" href="#database-compatibility-notes" title="Permalink to this headline">¶</a></h4>
<p>Or: &quot;If you thought any database worked right, think again&quot;</p>
<p>Because Buildbot works over a wide range of databases, it is generally limited
to database features present in all supported backends.  This section
highlights a few things to watch out for.</p>
<p>In general, Buildbot should be functional on all supported database backends.
If use of a backend adds minor usage restrictions, or cannot implement some
kinds of error checking, that is acceptable if the restrictions are
well-documented in the manual.</p>
<p>The metabuildbot tests Buildbot against all supported databases, so most
compatibility errors will be caught before a release.</p>
<div class="section" id="index-length-in-mysql">
<h5>Index Length in MySQL<a class="headerlink" href="#index-length-in-mysql" title="Permalink to this headline">¶</a></h5>
<p id="index-18">MySQL only supports about 330-character indexes.  The actual index length is
1000 bytes, but MySQL uses 3-byte encoding for UTF8 strings.  This is a
longstanding bug in MySQL - see <a class="reference external" href="http://bugs.mysql.com/bug.php?id=4541">&quot;Specified key was too long; max key
length is 1000 bytes&quot; with utf8</a>.
While this makes sense for indexes used for record lookup, it limits the
ability to use unique indexes to prevent duplicate rows.</p>
<p>InnoDB has even more severe restrictions on key lengths, which is why the MySQL
implementation requires a MyISAM storage engine.</p>
</div>
<div class="section" id="transactions-in-mysql">
<h5>Transactions in MySQL<a class="headerlink" href="#transactions-in-mysql" title="Permalink to this headline">¶</a></h5>
<p id="index-19">Unfortunately, use of the MyISAM storage engine precludes real transactions in
MySQL.  <tt class="docutils literal"><span class="pre">transaction.commit()</span></tt> and <tt class="docutils literal"><span class="pre">transaction.rollback()</span></tt> are essentially
no-ops: modifications to data in the database are visible to other users
immediately, and are not reverted in a rollback.</p>
</div>
<div class="section" id="referential-integrity-in-sqlite-and-mysql">
<h5>Referential Integrity in SQLite and MySQL<a class="headerlink" href="#referential-integrity-in-sqlite-and-mysql" title="Permalink to this headline">¶</a></h5>
<span class="target" id="index-20"></span><p id="index-21">Neither MySQL nor SQLite enforce referential integrity based on foreign keys.
Postgres does enforce, however.  If possible, test your changes on Postgres
before committing, to check that tables are added and removed in the proper
order.</p>
</div>
<div class="section" id="subqueries-in-mysql">
<h5>Subqueries in MySQL<a class="headerlink" href="#subqueries-in-mysql" title="Permalink to this headline">¶</a></h5>
<p id="index-22">MySQL's query planner is easily confused by subqueries.  For example, a DELETE
query specifying id's that are IN a subquery will not work.  The workaround is
to run the subquery directly, and then execute a DELETE query for each returned
id.</p>
<p>If this weakness has a significant peformance impact, it would be acceptable to
conditionalize use of the subquery on the database dialect.</p>
</div>
</div>
</div>
<span id="document-developer/results"></span><div class="section" id="module-buildbot.status.results">
<span id="id1"></span><span id="build-result-codes"></span><h3>Build Result Codes<a class="headerlink" href="#module-buildbot.status.results" title="Permalink to this headline">¶</a></h3>
<p>Buildbot represents the status of a step, build, or buildset using a set of
numeric constants.  From Python, these constants are available in the module
<tt class="docutils literal"><span class="pre">buildbot.status.results</span></tt>, but the values also appear in the database and in
external tools, so the values are fixed.</p>
<dl class="data">
<dt id="buildbot.status.results.SUCCESS">
<tt class="descclassname">buildbot.status.results.</tt><tt class="descname">SUCCESS</tt><a class="headerlink" href="#buildbot.status.results.SUCCESS" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 0; color: green; a successful run.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.status.results.WARNINGS">
<tt class="descclassname">buildbot.status.results.</tt><tt class="descname">WARNINGS</tt><a class="headerlink" href="#buildbot.status.results.WARNINGS" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 1; color: orange; a successful run, with some warnings.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.status.results.FAILURE">
<tt class="descclassname">buildbot.status.results.</tt><tt class="descname">FAILURE</tt><a class="headerlink" href="#buildbot.status.results.FAILURE" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 2; color: red; a failed run, due to problems in the build itself, as
opposed to a Buildbot misconfiguration or bug.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.status.results.SKIPPED">
<tt class="descclassname">buildbot.status.results.</tt><tt class="descname">SKIPPED</tt><a class="headerlink" href="#buildbot.status.results.SKIPPED" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 3; color: white; a run that was skipped -- usually a step skipped by
<tt class="docutils literal"><span class="pre">doStepIf</span></tt> (see <a class="reference internal" href="#buildstep-common-parameters"><em>Common Parameters</em></a>)</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.status.results.EXCEPTION">
<tt class="descclassname">buildbot.status.results.</tt><tt class="descname">EXCEPTION</tt><a class="headerlink" href="#buildbot.status.results.EXCEPTION" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 4; color: purple; a run that failed due to a problem in Buildbot
itself.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.status.results.RETRY">
<tt class="descclassname">buildbot.status.results.</tt><tt class="descname">RETRY</tt><a class="headerlink" href="#buildbot.status.results.RETRY" title="Permalink to this definition">¶</a></dt>
<dd><p>Value: 4; color: purple; a run that should be retried, usually due to a
slave disconnection.</p>
</dd></dl>

<dl class="data">
<dt id="buildbot.status.results.Results">
<tt class="descclassname">buildbot.status.results.</tt><tt class="descname">Results</tt><a class="headerlink" href="#buildbot.status.results.Results" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary mapping result codes to their lowercase names.</p>
</dd></dl>

<dl class="function">
<dt id="buildbot.status.results.worst_status">
<tt class="descclassname">buildbot.status.results.</tt><tt class="descname">worst_status</tt><big>(</big><em>a</em>, <em>b</em><big>)</big><a class="headerlink" href="#buildbot.status.results.worst_status" title="Permalink to this definition">¶</a></dt>
<dd><p>This function takes two status values, and returns the &quot;worst&quot; status of
the two.  This is used (with exceptions) to aggregate step statuses into
build statuses, and build statuses into buildset statuses.</p>
</dd></dl>

</div>
<span id="document-developer/formats"></span><div class="section" id="file-formats">
<h3>File Formats<a class="headerlink" href="#file-formats" title="Permalink to this headline">¶</a></h3>
<div class="section" id="log-file-format">
<h4>Log File Format<a class="headerlink" href="#log-file-format" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="buildbot.status.logfile.LogFile">
<em class="property">class </em><tt class="descclassname">buildbot.status.logfile.</tt><tt class="descname">LogFile</tt><a class="headerlink" href="#buildbot.status.logfile.LogFile" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The master currently stores each logfile in a single file, which may have a
standard compression applied.</p>
<p>The format is a special case of the netstrings protocol - see
<a class="reference external" href="http://cr.yp.to/proto/netstrings.txt">http://cr.yp.to/proto/netstrings.txt</a>.  The text in each netstring
consists of a one-digit channel identifier followed by the data from that
channel.</p>
<p>The formatting is implemented in the LogFile class in
<tt class="file docutils literal"><span class="pre">buildbot/status/logfile.py</span></tt>, and in particular by the <tt class="xref py py-meth docutils literal"><span class="pre">merge</span></tt>
method.</p>
</div>
</div>
<span id="document-developer/webstatus"></span><div class="section" id="web-status">
<h3>Web Status<a class="headerlink" href="#web-status" title="Permalink to this headline">¶</a></h3>
<div class="section" id="jinja-web-templates">
<span id="id1"></span><h4>Jinja Web Templates<a class="headerlink" href="#jinja-web-templates" title="Permalink to this headline">¶</a></h4>
<p>Buildbot uses Jinja2 to render its web interface.  The authoritative source for
this templating engine is
<a class="reference external" href="http://jinja.pocoo.org/2/documentation/">its own documentation</a>,
of course, but a few notes are in order for those who are
making only minor modifications.</p>
<div class="section" id="whitespace">
<h5>Whitespace<a class="headerlink" href="#whitespace" title="Permalink to this headline">¶</a></h5>
<p>Jinja directives are enclosed in <tt class="docutils literal"><span class="pre">{%</span> <span class="pre">..</span> <span class="pre">%}</span></tt>, and sometimes also have
dashes.  These dashes strip whitespace in the output.  For example:</p>
<div class="highlight-none"><div class="highlight"><pre>{% for entry in entries %}
  &lt;li&gt;{{ entry }}&lt;/li&gt;
{% endfor %}
</pre></div>
</div>
<p>will produce output with too much whitespace:</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;li&gt;</span>pigs<span class="nt">&lt;/li&gt;</span>


<span class="nt">&lt;li&gt;</span>cows<span class="nt">&lt;/li&gt;</span>
</pre></div>
</div>
<p>But adding the dashes will collapse that whitespace completely:</p>
<div class="highlight-none"><div class="highlight"><pre>{% for entry in entries -%}
  &lt;li&gt;{{ entry }}&lt;/li&gt;
{%- endfor %}
</pre></div>
</div>
<p>yields</p>
<div class="highlight-html"><div class="highlight"><pre><span class="nt">&lt;li&gt;</span>pigs<span class="nt">&lt;/li&gt;&lt;li&gt;</span>cows<span class="nt">&lt;/li&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="web-authorization-framework">
<span id="id2"></span><h4>Web Authorization Framework<a class="headerlink" href="#web-authorization-framework" title="Permalink to this headline">¶</a></h4>
<p>Whenever any part of the web framework wants to perform some action on the
buildmaster, it should check the user's authorization first.</p>
<p>Always check authorization twice: once to decide whether to show the option to
the user (link, button, form, whatever); and once before actually performing
the action.</p>
<p>To check whether to display the option, you'll usually want to pass an authz
object to the Jinja template in your <tt class="xref py py-class docutils literal"><span class="pre">HtmlResource</span></tt> subclass:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">cxt</span><span class="p">):</span>
    <span class="c"># ...</span>
    <span class="n">cxt</span><span class="p">[</span><span class="s">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAuthz</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
    <span class="n">template</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">cxt</span><span class="p">)</span>
</pre></div>
</div>
<p>and then determine whether to advertise the action in the template:</p>
<div class="highlight-none"><div class="highlight"><pre>{{ if authz.advertiseAction(&#39;myNewTrick&#39;) }}
  &lt;form action=&quot;{{ myNewTrick_url }}&quot;&gt; ...
{{ endif }}
</pre></div>
</div>
<p>Actions can optionally require authentication, so use <tt class="docutils literal"><span class="pre">needAuthForm</span></tt> to
determine whether to require a 'username' and 'passwd' field in the generated
form.  These fields are usually generated by <tt class="xref py py-meth docutils literal"><span class="pre">authFormIfNeeded</span></tt>:</p>
<div class="highlight-none"><div class="highlight"><pre>{{ authFormIfNeeded(authz, &#39;myNewTrick&#39;) }}
</pre></div>
</div>
<p>Once the POST request comes in, it's time to check authorization again.
This usually looks something like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">res</span> <span class="o">=</span> <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAuthz</span><span class="p">(</span><span class="n">req</span><span class="p">)</span><span class="o">.</span><span class="n">actionAllowed</span><span class="p">(</span><span class="s">&#39;myNewTrick&#39;</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="n">someExtraArg</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
    <span class="n">defer</span><span class="o">.</span><span class="n">returnValue</span><span class="p">(</span><span class="n">Redirect</span><span class="p">(</span><span class="n">path_to_authfail</span><span class="p">(</span><span class="n">req</span><span class="p">)))</span>
    <span class="k">return</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">someExtraArg</span></tt> is optional (it's handled with <tt class="docutils literal"><span class="pre">*args</span></tt>, so you can
have several if you want), and is given to the user's authorization function.
For example, a build-related action should pass the build status, so that the
user's authorization function could ensure that devs can only operate on their
own builds.</p>
<p>Note that <tt class="docutils literal"><span class="pre">actionAllowed</span></tt> returns a <tt class="docutils literal"><span class="pre">Deferred</span></tt> instance, so you must wait
for the <tt class="docutils literal"><span class="pre">Deferred</span></tt> and yield the <tt class="docutils literal"><span class="pre">Redirect</span></tt> instead of returning it.</p>
<p>The available actions are described in <a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">WebStatus</span></tt></a>.</p>
</div>
</div>
<span id="document-developer/master-slave"></span><div class="section" id="master-slave-api">
<h3>Master-Slave API<a class="headerlink" href="#master-slave-api" title="Permalink to this headline">¶</a></h3>
<p>This section describes the master-slave interface.</p>
<div class="section" id="connection">
<h4>Connection<a class="headerlink" href="#connection" title="Permalink to this headline">¶</a></h4>
<p>The interface is based on Twisted's Perspective Broker, which operates over TCP
connections.</p>
<p>The slave connects to the master, using the parameters supplied to
<strong class="command">buildslave create-slave</strong>.  It uses a reconnecting process with an
exponential backoff, and will automatically reconnect on disconnection.</p>
<p>Once connected, the slave authenticates with the Twisted Cred (newcred)
mechanism, using the username and password supplied to <strong class="command">buildslave
create-slave</strong>.  The <em>mind</em> is the slave bot instance (class
<tt class="xref py py-class docutils literal"><span class="pre">buildslave.bot.Bot</span></tt>).</p>
<p>On the master side, the realm is implemented by
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.master.Dispatcher</span></tt>, which examines the username of incoming
avatar requests.  There are special cases for <tt class="docutils literal"><span class="pre">change</span></tt>, <tt class="docutils literal"><span class="pre">debug</span></tt>, and
<tt class="docutils literal"><span class="pre">statusClient</span></tt>, which are not discussed here.  For all other usernames,
the botmaster is consulted, and if a slave with that name is configured, its
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.buildslave.BuildSlave</span></tt> instance is returned as the perspective.</p>
</div>
<div class="section" id="build-slaves">
<h4>Build Slaves<a class="headerlink" href="#build-slaves" title="Permalink to this headline">¶</a></h4>
<p>At this point, the master-side BuildSlave object has a pointer to the remote,
slave-side Bot object in its <tt class="docutils literal"><span class="pre">self.slave</span></tt>, and the slave-side Bot object has
a reference to the master-side BuildSlave object in its <tt class="docutils literal"><span class="pre">self.perspective</span></tt>.</p>
<div class="section" id="bot-methods">
<h5>Bot methods<a class="headerlink" href="#bot-methods" title="Permalink to this headline">¶</a></h5>
<p>The slave-side Bot object has the following remote methods:</p>
<dl class="docutils">
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_getCommands</span></tt></dt>
<dd>Returns a list of <tt class="docutils literal"><span class="pre">(name,</span> <span class="pre">version)</span></tt> for all commands the slave recognizes</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_setBuilderList</span></tt></dt>
<dd><p class="first">Given a list of builders and their build directories, ensures that
those builders, and only those builders, are running.  This can be
called after the initial connection is established, with a new
list, to add or remove builders.</p>
<p class="last">This method returns a dictionary of <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt> objects - see below</p>
</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_print</span></tt></dt>
<dd>Adds a message to the slave logfile</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_getSlaveInfo</span></tt></dt>
<dd><p class="first">Returns the contents of the slave's <tt class="file docutils literal"><span class="pre">info/</span></tt> directory. This also
contains the keys</p>
<dl class="last docutils">
<dt><tt class="docutils literal"><span class="pre">environ</span></tt></dt>
<dd>copy of the slaves environment</dd>
<dt><tt class="docutils literal"><span class="pre">system</span></tt></dt>
<dd>OS the slave is running (extracted from pythons os.name)</dd>
<dt><tt class="docutils literal"><span class="pre">basedir</span></tt></dt>
<dd>base directory where slave is running</dd>
</dl>
</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_getVersion</span></tt></dt>
<dd>Returns the slave's version</dd>
</dl>
</div>
<div class="section" id="buildslave-methods">
<h5>BuildSlave methods<a class="headerlink" href="#buildslave-methods" title="Permalink to this headline">¶</a></h5>
<p>The master-side object has the following method:</p>
<dl class="docutils">
<dt><tt class="xref py py-meth docutils literal"><span class="pre">perspective_keepalive</span></tt></dt>
<dd>Does nothing - used to keep traffic flowing over the TCP connection</dd>
</dl>
</div>
</div>
<div class="section" id="setup">
<h4>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h4>
<p>After the initial connection and trading of a mind (Bot) for an avatar
(BuildSlave), the master calls the Bot's <tt class="xref py py-meth docutils literal"><span class="pre">setBuilderList</span></tt> method to set
up the proper slave builders on the slave side.  This method returns a
reference to each of the new slave-side <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt>
objects, described below.  Each of these is handed to the corresponding
master-side <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt> object.</p>
<p>This immediately calls the remote <tt class="xref py py-meth docutils literal"><span class="pre">setMaster</span></tt> method, then the
<tt class="xref py py-meth docutils literal"><span class="pre">print</span></tt> method.</p>
</div>
<div class="section" id="pinging">
<h4>Pinging<a class="headerlink" href="#pinging" title="Permalink to this headline">¶</a></h4>
<p>To ping a remote SlaveBuilder, the master calls its <tt class="xref py py-meth docutils literal"><span class="pre">print</span></tt> method.</p>
</div>
<div class="section" id="building">
<h4>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h4>
<p>When a build starts, the master calls the slave's <tt class="xref py py-meth docutils literal"><span class="pre">startBuild</span></tt> method.
Each BuildStep instance will subsequently call the <tt class="xref py py-meth docutils literal"><span class="pre">startCommand</span></tt> method,
passing a reference to itself as the <tt class="docutils literal"><span class="pre">stepRef</span></tt> parameter.  The
<tt class="xref py py-meth docutils literal"><span class="pre">startCommand</span></tt> method returns immediately, and the end of the command is
signalled with a call to a method on the master-side BuildStep object.</p>
</div>
<div class="section" id="slave-builders">
<h4>Slave Builders<a class="headerlink" href="#slave-builders" title="Permalink to this headline">¶</a></h4>
<p>Each build slave has a set of builders which can run on it.  These are
represented by distinct classes on the master and slave, just like the
BuildSlave and Bot objects described above.</p>
<p>On the slave side, builders are represented as instances of the
<tt class="xref py py-class docutils literal"><span class="pre">buildslave.bot.SlaveBuilder</span></tt> class.  On the master side, they are
represented by the <tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.slavebuilder.SlaveBuilder</span></tt> class.
The identical names are a source of confusion.  The following will refer to
these as the slave-side and master-side SlaveBuilder classes.  Each object
keeps a reference to its opposite in <tt class="docutils literal"><span class="pre">self.remote</span></tt>.</p>
<div class="section" id="slave-side-slavebuilder-methods">
<h5>Slave-Side SlaveBuilder Methods<a class="headerlink" href="#slave-side-slavebuilder-methods" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_setMaster</span></tt></dt>
<dd>Provides a reference to the master-side SlaveBuilder</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_print</span></tt></dt>
<dd>Adds a message to the slave logfile; used to check round-trip connectivity</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_startBuild</span></tt></dt>
<dd>Indicates that a build is about to start, and that any subsequent
commands are part of that build</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_startCommand</span></tt></dt>
<dd>Invokes a command on the slave side</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_interruptCommand</span></tt></dt>
<dd>Interrupts the currently-running command</dd>
<dt><tt class="xref py py-meth docutils literal"><span class="pre">remote_shutdown</span></tt></dt>
<dd>Shuts down the slave cleanly</dd>
</dl>
</div>
<div class="section" id="master-side-slavebuilder-methods">
<h5>Master-side SlaveBuilder Methods<a class="headerlink" href="#master-side-slavebuilder-methods" title="Permalink to this headline">¶</a></h5>
<p>The master side does not have any remotely-callable methods.</p>
</div>
</div>
<div class="section" id="commands">
<h4>Commands<a class="headerlink" href="#commands" title="Permalink to this headline">¶</a></h4>
<p>Actual work done by the slave is represented on the master side by a
<a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand" title="buildbot.process.buildstep.RemoteCommand"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.buildstep.RemoteCommand</span></tt></a> instance.</p>
<p>The command instance keeps a reference to the slave-side
<tt class="xref py py-class docutils literal"><span class="pre">buildslave.bot.SlaveBuilder</span></tt>, and calls methods like
<tt class="xref py py-meth docutils literal"><span class="pre">remote_startCommand</span></tt> to start new commands.
Once that method is called, the <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt> instance
keeps a reference to the command, and calls the following methods on it:</p>
<div class="section" id="master-side-remotecommand-methods">
<h5>Master-Side RemoteCommand Methods<a class="headerlink" href="#master-side-remotecommand-methods" title="Permalink to this headline">¶</a></h5>
<dl class="docutils">
<dt><a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.remote_update" title="buildbot.process.buildstep.RemoteCommand.remote_update"><tt class="xref py py-meth docutils literal"><span class="pre">remote_update</span></tt></a></dt>
<dd>Update information about the running command.  See below for the format.</dd>
<dt><a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.remote_complete" title="buildbot.process.buildstep.RemoteCommand.remote_complete"><tt class="xref py py-meth docutils literal"><span class="pre">remote_complete</span></tt></a></dt>
<dd>Signal that the command is complete, either successfully or with a Twisted failure.</dd>
</dl>
</div>
</div>
<div class="section" id="updates">
<span id="master-slave-updates"></span><h4>Updates<a class="headerlink" href="#updates" title="Permalink to this headline">¶</a></h4>
<p>Updates from the slave, sent via
<a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.remote_update" title="buildbot.process.buildstep.RemoteCommand.remote_update"><tt class="xref py py-meth docutils literal"><span class="pre">remote_update</span></tt></a>, are a list of
individual update elements.  Each update element is, in turn, a list of the
form <tt class="docutils literal"><span class="pre">[data,</span> <span class="pre">0]</span></tt> where the 0 is present for historical reasons.  The data is
a dictionary, with keys describing the contents.  The updates are handled by
<a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.remoteUpdate" title="buildbot.process.buildstep.RemoteCommand.remoteUpdate"><tt class="xref py py-meth docutils literal"><span class="pre">remoteUpdate</span></tt></a>.</p>
<p>Updates with different keys can be combined into a single dictionary or
delivered sequentially as list elements, at the slave's option.</p>
<p>To summarize, an <tt class="docutils literal"><span class="pre">updates</span></tt> parameter to
<a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.remote_update" title="buildbot.process.buildstep.RemoteCommand.remote_update"><tt class="xref py py-meth docutils literal"><span class="pre">remote_update</span></tt></a> might look like
this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s">&#39;header&#39;</span> <span class="p">:</span> <span class="s">&#39;running command..&#39;</span> <span class="p">},</span> <span class="mi">0</span> <span class="p">],</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s">&#39;stdout&#39;</span> <span class="p">:</span> <span class="s">&#39;abcd&#39;</span><span class="p">,</span> <span class="s">&#39;stderr&#39;</span> <span class="p">:</span> <span class="s">&#39;local modifications&#39;</span> <span class="p">},</span> <span class="mi">0</span> <span class="p">],</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s">&#39;log&#39;</span> <span class="p">:</span> <span class="p">(</span> <span class="s">&#39;cmd.log&#39;</span><span class="p">,</span> <span class="s">&#39;cmd invoked at 12:33 pm</span><span class="se">\n</span><span class="s">&#39;</span> <span class="p">)</span> <span class="p">},</span> <span class="mi">0</span> <span class="p">],</span>
    <span class="p">[</span> <span class="p">{</span> <span class="s">&#39;rc&#39;</span> <span class="p">:</span> <span class="mi">0</span> <span class="p">},</span> <span class="mi">0</span> <span class="p">],</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="defined-commands">
<h5>Defined Commands<a class="headerlink" href="#defined-commands" title="Permalink to this headline">¶</a></h5>
<p>The following commands are defined on the slaves.</p>
<div class="section" id="shell">
<span id="shell-command-args"></span><h6>shell<a class="headerlink" href="#shell" title="Permalink to this headline">¶</a></h6>
<p>Runs a shell command on the slave.  This command takes the following arguments:</p>
<p><tt class="docutils literal"><span class="pre">command</span></tt></p>
<blockquote>
<div>The command to run.  If this is a string, will be passed to the system
shell as a string.  Otherwise, it must be a list, which will be
executed directly.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">workdir</span></tt></p>
<blockquote>
<div>Directory in which to run the command, relative to the builder dir.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">env</span></tt></p>
<blockquote>
<div>A dictionary of environment variables to augment or replace the
existing environment on the slave.  In this dictionary, <tt class="docutils literal"><span class="pre">PYTHONPATH</span></tt>
is treated specially: it should be a list of path components, rather
than a string, and will be prepended to the existing python path.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">initial_stdin</span></tt></p>
<blockquote>
<div>A string which will be written to the command's standard input before
it is closed.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">want_stdout</span></tt></p>
<blockquote>
<div>If false, then no updates will be sent for stdout.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">want_stderr</span></tt></p>
<blockquote>
<div>If false, then no updates will be sent for stderr.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">usePTY</span></tt></p>
<blockquote>
<div>If true, the command should be run with a PTY (POSIX only).  This
defaults to the value specified in the slave's <tt class="docutils literal"><span class="pre">buildbot.tac</span></tt>.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">not_really</span></tt></p>
<blockquote>
<div>If true, skip execution and return an update with rc=0.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">timeout</span></tt></p>
<blockquote>
<div>Maximum time without output before the command is killed.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">maxTime</span></tt></p>
<blockquote>
<div>Maximum overall time from the start before the command is killed.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">logfiles</span></tt></p>
<blockquote>
<div><p>A dictionary specifying logfiles other than stdio.  Keys are the logfile
names, and values give the workdir-relative filename of the logfile.  Alternately,
a value can be a dictionary; in this case, the dictionary must have a <tt class="docutils literal"><span class="pre">filename</span></tt>
key specifying the filename, and can also have the following keys:</p>
<p><tt class="docutils literal"><span class="pre">follow</span></tt></p>
<blockquote>
<div>Only follow the file from its current end-of-file, rather that starting
from the beginning.</div></blockquote>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">logEnviron</span></tt></p>
<blockquote>
<div>If false, the command's environment will not be logged.</div></blockquote>
<p>The <tt class="docutils literal"><span class="pre">shell</span></tt> command sends the following updates:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">stdout</span></tt></dt>
<dd>The data is a bytestring which represents a continuation of the stdout
stream.  Note that the bytestring boundaries are not necessarily aligned
with newlines.</dd>
<dt><tt class="docutils literal"><span class="pre">stderr</span></tt></dt>
<dd>Similar to <tt class="docutils literal"><span class="pre">stdout</span></tt>, but for the error stream.</dd>
<dt><tt class="docutils literal"><span class="pre">header</span></tt></dt>
<dd>Similar to <tt class="docutils literal"><span class="pre">stdout</span></tt>, but containing data for a stream of
buildbot-specific metadata.</dd>
<dt><tt class="docutils literal"><span class="pre">rc</span></tt></dt>
<dd>The exit status of the command, where -- in keeping with UNIX tradition --
0 indicates success and any nonzero value is considered a failure.  No
further updates should be sent after an <tt class="docutils literal"><span class="pre">rc</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">log</span></tt></dt>
<dd>This update contains data for a logfile other than stdio.  The data
associated with the update is a tuple of the log name and the data for that
log.  Note that non-stdio logs do not distinguish output, error, and header
streams.</dd>
</dl>
</div>
<div class="section" id="uploadfile">
<h6>uploadFile<a class="headerlink" href="#uploadfile" title="Permalink to this headline">¶</a></h6>
<p>Upload a file from the slave to the master.  The arguments are</p>
<p><tt class="docutils literal"><span class="pre">workdir</span></tt></p>
<blockquote>
<div>The base directory for the filename, relative to the builder's basedir.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">slavesrc</span></tt></p>
<blockquote>
<div>Name of the filename to read from., relative to the workdir.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">writer</span></tt></p>
<blockquote>
<div>A remote reference to a writer object, described below.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">maxsize</span></tt></p>
<blockquote>
<div>Maximum size, in bytes, of the file to write.  The operation will fail if
the file exceeds this size.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">blocksize</span></tt></p>
<blockquote>
<div>The block size with which to transfer the file.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">keepstamp</span></tt></p>
<blockquote>
<div>If true, preserve the file modified and accessed times.</div></blockquote>
<p>The slave calls a few remote methods on the writer object.  First, the
<tt class="docutils literal"><span class="pre">write</span></tt> method is called with a bytestring containing data, until all of the
data has been transmitted.  Then, the slave calls the writer's <tt class="docutils literal"><span class="pre">close</span></tt>,
followed (if <tt class="docutils literal"><span class="pre">keepstamp</span></tt> is true) by a call to <tt class="docutils literal"><span class="pre">upload(atime,</span> <span class="pre">mtime)</span></tt>.</p>
<p>This command sends <tt class="docutils literal"><span class="pre">rc</span></tt> and <tt class="docutils literal"><span class="pre">stderr</span></tt> updates, as defined for the <tt class="docutils literal"><span class="pre">shell</span></tt>
command.</p>
</div>
<div class="section" id="uploaddirectory">
<h6>uploadDirectory<a class="headerlink" href="#uploaddirectory" title="Permalink to this headline">¶</a></h6>
<p>Similar to <tt class="docutils literal"><span class="pre">uploadFile</span></tt>, this command will upload an entire directory to the
master, in the form of a tarball.  It takes the following arguments:</p>
<p><tt class="docutils literal"><span class="pre">workdir</span></tt>
<tt class="docutils literal"><span class="pre">slavesrc</span></tt>
<tt class="docutils literal"><span class="pre">writer</span></tt>
<tt class="docutils literal"><span class="pre">maxsize</span></tt>
<tt class="docutils literal"><span class="pre">blocksize</span></tt></p>
<blockquote>
<div>See <tt class="docutils literal"><span class="pre">uploadFile</span></tt></div></blockquote>
<p><tt class="docutils literal"><span class="pre">compress</span></tt></p>
<blockquote>
<div>Compression algorithm to use -- one of <tt class="docutils literal"><span class="pre">None</span></tt>, <tt class="docutils literal"><span class="pre">'bz2'</span></tt>, or <tt class="docutils literal"><span class="pre">'gz'</span></tt>.</div></blockquote>
<p>The writer object is treated similarly to the <tt class="docutils literal"><span class="pre">uploadFile</span></tt> command, but after
the file is closed, the slave calls the master's <tt class="docutils literal"><span class="pre">unpack</span></tt> method with no
arguments to extract the tarball.</p>
<p>This command sends <tt class="docutils literal"><span class="pre">rc</span></tt> and <tt class="docutils literal"><span class="pre">stderr</span></tt> updates, as defined for the <tt class="docutils literal"><span class="pre">shell</span></tt>
command.</p>
</div>
<div class="section" id="downloadfile">
<h6>downloadFile<a class="headerlink" href="#downloadfile" title="Permalink to this headline">¶</a></h6>
<p>This command will download a file from the master to the slave.  It takes the
following arguments:</p>
<p><tt class="docutils literal"><span class="pre">workdir</span></tt></p>
<blockquote>
<div>Base directory for the destination filename, relative to the builder basedir.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">slavedest</span></tt></p>
<blockquote>
<div>Filename to write to, relative to the workdir.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">reader</span></tt></p>
<blockquote>
<div>A remote reference to a reader object, described below.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">maxsize</span></tt></p>
<blockquote>
<div>Maximum size of the file.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">blocksize</span></tt></p>
<blockquote>
<div>The block size with which to transfer the file.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">mode</span></tt></p>
<blockquote>
<div>Acess mode for the new file.</div></blockquote>
<p>The reader object's <tt class="docutils literal"><span class="pre">read(maxsize)</span></tt> method will be called with a maximum
size, which will return no more than that number of bytes as a bytestring.  At
EOF, it will return an empty string.  Once EOF is received, the slave will call
the remote <tt class="docutils literal"><span class="pre">close</span></tt> method.</p>
<p>This command sends <tt class="docutils literal"><span class="pre">rc</span></tt> and <tt class="docutils literal"><span class="pre">stderr</span></tt> updates, as defined for the <tt class="docutils literal"><span class="pre">shell</span></tt>
command.</p>
</div>
<div class="section" id="mkdir">
<h6>mkdir<a class="headerlink" href="#mkdir" title="Permalink to this headline">¶</a></h6>
<p>This command will create a directory on the slave.  It will also create any
intervening directories required.  It takes the following arugment:</p>
<p><tt class="docutils literal"><span class="pre">dir</span></tt></p>
<blockquote>
<div>Directory to create.</div></blockquote>
<p>The <tt class="docutils literal"><span class="pre">mkdir</span></tt> command produces the same updates as <tt class="docutils literal"><span class="pre">shell</span></tt>.</p>
</div>
<div class="section" id="rmdir">
<h6>rmdir<a class="headerlink" href="#rmdir" title="Permalink to this headline">¶</a></h6>
<p>This command will remove a directory or file on the slave.  It takes the following arguments:</p>
<p><tt class="docutils literal"><span class="pre">dir</span></tt></p>
<blockquote>
<div>Directory to remove.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">timeout</span></tt>
<tt class="docutils literal"><span class="pre">maxTime</span></tt></p>
<blockquote>
<div>See <tt class="docutils literal"><span class="pre">shell</span></tt>, above.</div></blockquote>
<p>The <tt class="docutils literal"><span class="pre">rmdir</span></tt> command produces the same updates as <tt class="docutils literal"><span class="pre">shell</span></tt>.</p>
</div>
<div class="section" id="cpdir">
<h6>cpdir<a class="headerlink" href="#cpdir" title="Permalink to this headline">¶</a></h6>
<p>This command will copy a directory from place to place on the slave.  It takes the following
arguments:</p>
<p><tt class="docutils literal"><span class="pre">fromdir</span></tt></p>
<blockquote>
<div>Source directory for the copy operation, relative to the builder's basedir.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">todir</span></tt></p>
<blockquote>
<div>Destination directory for the copy operation, relative to the builder's basedir.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">timeout</span></tt>
<tt class="docutils literal"><span class="pre">maxTime</span></tt></p>
<blockquote>
<div>See <tt class="docutils literal"><span class="pre">shell</span></tt>, above.</div></blockquote>
<p>The <tt class="docutils literal"><span class="pre">cpdir</span></tt> command produces the same updates as <tt class="docutils literal"><span class="pre">shell</span></tt>.</p>
</div>
<div class="section" id="stat">
<h6>stat<a class="headerlink" href="#stat" title="Permalink to this headline">¶</a></h6>
<p>This command returns status information about a file or directory.  It takes a
single parameter, <tt class="docutils literal"><span class="pre">file</span></tt>, specifying the filename relative to the builder's
basedir.</p>
<p>It produces two status updates:</p>
<p><tt class="docutils literal"><span class="pre">stat</span></tt></p>
<blockquote>
<div>The return value from Python's <tt class="docutils literal"><span class="pre">os.stat</span></tt>.</div></blockquote>
<p><tt class="docutils literal"><span class="pre">rc</span></tt></p>
<blockquote>
<div>0 if the file is found, otherwise 1.</div></blockquote>
</div>
<div class="section" id="source-commands">
<h6>Source Commands<a class="headerlink" href="#source-commands" title="Permalink to this headline">¶</a></h6>
<p>The source commands (<tt class="docutils literal"><span class="pre">bk</span></tt>, <tt class="docutils literal"><span class="pre">cvs</span></tt>, <tt class="docutils literal"><span class="pre">darcs</span></tt>, <tt class="docutils literal"><span class="pre">git</span></tt>, <tt class="docutils literal"><span class="pre">repo</span></tt>, <tt class="docutils literal"><span class="pre">bzr</span></tt>,
<tt class="docutils literal"><span class="pre">hg</span></tt>, <tt class="docutils literal"><span class="pre">p4</span></tt>, <tt class="docutils literal"><span class="pre">p4sync</span></tt>, and <tt class="docutils literal"><span class="pre">mtn</span></tt>) are deprecated.  See the docstrings in
the source code for more information.</p>
</div>
</div>
</div>
</div>
<span id="document-developer/encodings"></span><div class="section" id="string-encodings">
<h3>String Encodings<a class="headerlink" href="#string-encodings" title="Permalink to this headline">¶</a></h3>
<p>Buildbot expects all strings used internally to be valid Unicode strings - not
bytestrings.</p>
<p>Note that Buildbot rarely feeds strings back into external tools in such a way
that those strings must match.  For example, Buildbot does not attempt to
access the filenames specified in a Change.  So it is more important to store
strings in a manner that will be most useful to a human reader (e.g., in
logfiles, web status, etc.) than to store them in a lossless format.</p>
<div class="section" id="inputs">
<h4>Inputs<a class="headerlink" href="#inputs" title="Permalink to this headline">¶</a></h4>
<p>On input, strings should be decoded, if their encoding is known.  Where
necessary, the assumed input encoding should be configurable.  In some cases,
such as filenames, this encoding is not known or not well-defined (e.g., a
utf-8 encoded filename in a latin-1 directory).  In these cases, the input
mechanisms should make a best effort at decoding, and use e.g., the
<tt class="docutils literal"><span class="pre">errors='replace'</span></tt> option to fail gracefully on un-decodable characters.</p>
</div>
<div class="section" id="outputs">
<h4>Outputs<a class="headerlink" href="#outputs" title="Permalink to this headline">¶</a></h4>
<p>At most points where Buildbot outputs a string, the target encoding is known.
For example, the web status can encode to utf-8.  In cases where it is not
known, it should be configurable, with a safe fallback (e.g., ascii with
<tt class="docutils literal"><span class="pre">errors='replace'</span></tt>.  For HTML/XML outputs, consider using
<tt class="docutils literal"><span class="pre">errors='xmlcharrefreplace'</span></tt> instead.</p>
</div>
</div>
<span id="document-developer/metrics"></span><div class="section" id="metrics">
<span id="id1"></span><h3>Metrics<a class="headerlink" href="#metrics" title="Permalink to this headline">¶</a></h3>
<p>New in buildbot 0.8.4 is support for tracking various performance
metrics inside the buildbot master process. Currently these are logged
periodically according to the <tt class="docutils literal"><span class="pre">log_interval</span></tt> configuration
setting of the &#64;ref{Metrics Options} configuration.</p>
<p>If <a class="reference internal" href="#status-WebStatus" title="WebStatus"><tt class="xref bb bb-status docutils literal"><span class="pre">WebStatus</span></tt></a> is enabled, the metrics data is also available
via <tt class="docutils literal"><span class="pre">/json/metrics</span></tt>.</p>
<p>The metrics subsystem is implemented in
<tt class="xref py py-mod docutils literal"><span class="pre">buildbot.process.metrics</span></tt>. It makes use of twisted's logging
system to pass metrics data from all over buildbot's code to a central
<tt class="xref py py-class docutils literal"><span class="pre">MetricsLogObserver</span></tt> object, which is available at
<tt class="docutils literal"><span class="pre">BuildMaster.metrics</span></tt> or via <tt class="docutils literal"><span class="pre">Status.getMetrics()</span></tt>.</p>
<div class="section" id="metric-events">
<h4>Metric Events<a class="headerlink" href="#metric-events" title="Permalink to this headline">¶</a></h4>
<p><tt class="xref py py-class docutils literal"><span class="pre">MetricEvent</span></tt> objects represent individual items to
monitor. There are three sub-classes implemented:</p>
<dl class="docutils">
<dt><tt class="xref py py-class docutils literal"><span class="pre">MetricCountEvent</span></tt></dt>
<dd><p class="first">Records incremental increase or decrease of some value, or an
absolute measure of some value.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="kn">import</span> <span class="n">MetricCountEvent</span>

<span class="c"># We got a new widget!</span>
<span class="n">MetricCountEvent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;num_widgets&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c"># We have exactly 10 widgets</span>
<span class="n">MetricCountEvent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;num_widgets&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">MetricTimeEvent</span></tt></dt>
<dd><p class="first">Measures how long things take. By default the average of the last
10 times will be reported.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="kn">import</span> <span class="n">MetricTimeEvent</span>

<span class="c"># function took 0.001s</span>
<span class="n">MetricTimeEvent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;time_function&#39;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><tt class="xref py py-class docutils literal"><span class="pre">MetricAlarmEvent</span></tt></dt>
<dd><p class="first">Indicates the health of various metrics.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="kn">import</span> <span class="n">MetricAlarmEvent</span><span class="p">,</span> <span class="n">ALARM_OK</span>

<span class="c"># num_slaves looks ok</span>
<span class="n">MetricAlarmEvent</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;num_slaves&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">ALARM_OK</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="metric-handlers">
<h4>Metric Handlers<a class="headerlink" href="#metric-handlers" title="Permalink to this headline">¶</a></h4>
<p><tt class="xref py py-class docutils literal"><span class="pre">MetricsHandler</span></tt> objects are responsble for collecting
<tt class="xref py py-class docutils literal"><span class="pre">MetricEvent</span></tt>s of a specific type and keeping track of their
values for future reporting. There are <tt class="xref py py-class docutils literal"><span class="pre">MetricsHandler</span></tt> classes
corresponding to each of the <tt class="xref py py-class docutils literal"><span class="pre">MetricEvent</span></tt> types.</p>
</div>
<div class="section" id="metric-watchers">
<h4>Metric Watchers<a class="headerlink" href="#metric-watchers" title="Permalink to this headline">¶</a></h4>
<p>Watcher objects can be added to <tt class="xref py py-class docutils literal"><span class="pre">MetricsHandlers</span></tt> to be called
when metric events of a certain type are received. Watchers are
generally used to record alarm events in response to count or time
events.</p>
</div>
<div class="section" id="metric-helpers">
<h4>Metric Helpers<a class="headerlink" href="#metric-helpers" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt><tt class="xref py py-func docutils literal"><span class="pre">countMethod(name)</span></tt></dt>
<dd><p class="first">A function decorator that counts how many times the function is
called.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="kn">import</span> <span class="n">countMethod</span>

<span class="nd">@countMethod</span><span class="p">(</span><span class="s">&#39;foo_called&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;foo!&quot;</span>
</pre></div>
</div>
</dd>
<dt><tt class="xref py py-func docutils literal"><span class="pre">Timer(name)</span></tt></dt>
<dd><p class="first"><tt class="xref py py-class docutils literal"><span class="pre">Timer</span></tt> objects can be used to make timing events
easier. When <tt class="docutils literal"><span class="pre">Timer.stop()</span></tt> is called, a
<tt class="xref py py-class docutils literal"><span class="pre">MetricTimeEvent</span></tt> is logged with the elapsed time since
<tt class="docutils literal"><span class="pre">timer.start()</span></tt> was called.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="kn">import</span> <span class="n">Timer</span>

<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="s">&#39;time_foo&#39;</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">calc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;foo!&quot;</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<p><tt class="xref py py-class docutils literal"><span class="pre">Timer</span></tt> objects also provide a pair of decorators,
<tt class="xref py py-func docutils literal"><span class="pre">startTimer</span></tt>/<tt class="xref py py-func docutils literal"><span class="pre">stopTimer</span></tt> to decorate other functions.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="kn">import</span> <span class="n">Timer</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Timer</span><span class="p">(</span><span class="s">&#39;time_thing&#39;</span><span class="p">)</span>

<span class="nd">@t.startTimer</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;foo!&quot;</span>

<span class="nd">@t.stopTimer</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;bar!&quot;</span>

<span class="n">foo</span><span class="p">()</span>
<span class="n">bar</span><span class="p">()</span>
</pre></div>
</div>
</dd>
<dt><tt class="xref py py-func docutils literal"><span class="pre">timeMethod(name)</span></tt></dt>
<dd><p class="first">A function decorator that measures how long a function takes to
execute. Note that many functions in buildbot return deferreds, so
may return before all the work they set up has completed. Using an
explicit <tt class="xref py py-class docutils literal"><span class="pre">Timer</span></tt> is better in this case.</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.metrics</span> <span class="kn">import</span> <span class="n">timeMethod</span>

<span class="nd">@timeMethod</span><span class="p">(</span><span class="s">&#39;time_foo&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">calc</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;foo!&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<span id="document-developer/classes"></span><div class="section" id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h3>
<p>The sections contained here document classes that can be used or subclassed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Some of this information duplicates information available in the source
code itself.  Consider this information authoritative, and the source code
a demonstration of the current implementation which is subject to change.</p>
</div>
<div class="toctree-wrapper compound">
<span id="document-developer/cls-buildfactory"></span><div class="section" id="buildfactory">
<h4>BuildFactory<a class="headerlink" href="#buildfactory" title="Permalink to this headline">¶</a></h4>
<div class="section" id="buildfactory-implementation-note">
<h5>BuildFactory Implementation Note<a class="headerlink" href="#buildfactory-implementation-note" title="Permalink to this headline">¶</a></h5>
<p>The default <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt>, provided in the
<tt class="xref py py-mod docutils literal"><span class="pre">buildbot.process.factory</span></tt> module, contains an internal list of
<cite>BuildStep specifications</cite>: a list of <tt class="docutils literal"><span class="pre">(step_class,</span> <span class="pre">kwargs)</span></tt>
tuples for each. These specification tuples are constructed when the
config file is read, by asking the instances passed to <tt class="xref py py-meth docutils literal"><span class="pre">addStep</span></tt>
for their subclass and arguments.</p>
<p>To support config files from buildbot-0.7.5 and earlier,
<tt class="xref py py-meth docutils literal"><span class="pre">addStep</span></tt> also accepts the <tt class="docutils literal"><span class="pre">f.addStep(shell.Compile,</span>
<span class="pre">command=[&quot;make&quot;,&quot;build&quot;])</span></tt> form, although its use is discouraged
because then the <tt class="docutils literal"><span class="pre">Compile</span></tt> step doesn't get to validate or
complain about its arguments until build time. The modern
pass-by-instance approach allows this validation to occur while the
config file is being loaded, where the admin has a better chance of
noticing problems.</p>
<p>When asked to create a <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>, the <tt class="xref py py-class docutils literal"><span class="pre">BuildFactory</span></tt> puts a copy of
the list of step specifications into the new <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> object. When the
<tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> is actually started, these step specifications are used to
create the actual set of <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s, which are then executed one at a
time. This serves to give each Build an independent copy of each step.</p>
<p>Each step can affect the build process in the following ways:</p>
<blockquote>
<div><ul class="simple">
<li>If the step's <tt class="xref py py-attr docutils literal"><span class="pre">haltOnFailure</span></tt> attribute is <tt class="docutils literal"><span class="pre">True</span></tt>, then a failure
in the step (i.e. if it completes with a result of <tt class="docutils literal"><span class="pre">FAILURE</span></tt>) will cause
the whole build to be terminated immediately: no further steps will be
executed, with the exception of steps with <tt class="xref py py-attr docutils literal"><span class="pre">alwaysRun</span></tt> set to
<tt class="docutils literal"><span class="pre">True</span></tt>. <tt class="xref py py-attr docutils literal"><span class="pre">haltOnFailure</span></tt> is useful for setup steps upon which the
rest of the build depends: if the CVS checkout or <strong class="command">./configure</strong>
process fails, there is no point in trying to compile or test the
resulting tree.</li>
<li>If the step's <tt class="xref py py-attr docutils literal"><span class="pre">alwaysRun</span></tt> attribute is <tt class="docutils literal"><span class="pre">True</span></tt>, then it will always
be run, regardless of if previous steps have failed. This is useful
for cleanup steps that should always be run to return the build
directory or build slave into a good state.</li>
<li>If the <tt class="xref py py-attr docutils literal"><span class="pre">flunkOnFailure</span></tt> or <tt class="xref py py-attr docutils literal"><span class="pre">flunkOnWarnings</span></tt> flag is set,
then a result of <tt class="docutils literal"><span class="pre">FAILURE</span></tt> or <tt class="docutils literal"><span class="pre">WARNINGS</span></tt> will mark the build as a whole as
<tt class="docutils literal"><span class="pre">FAILED</span></tt>. However, the remaining steps will still be executed. This is
appropriate for things like multiple testing steps: a failure in any
one of them will indicate that the build has failed, however it is
still useful to run them all to completion.</li>
<li>Similarly, if the <tt class="xref py py-attr docutils literal"><span class="pre">warnOnFailure</span></tt> or <tt class="xref py py-attr docutils literal"><span class="pre">warnOnWarnings</span></tt> flag
is set, then a result of <tt class="docutils literal"><span class="pre">FAILURE</span></tt> or <tt class="docutils literal"><span class="pre">WARNINGS</span></tt> will mark the build as
having <tt class="docutils literal"><span class="pre">WARNINGS</span></tt>, and the remaining steps will still be executed. This
may be appropriate for certain kinds of optional build or test steps.
For example, a failure experienced while building documentation files
should be made visible with a <tt class="docutils literal"><span class="pre">WARNINGS</span></tt> result but not be serious
enough to warrant marking the whole build with a <tt class="docutils literal"><span class="pre">FAILURE</span></tt>.</li>
</ul>
</div></blockquote>
<p>In addition, each <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt> produces its own results, may create logfiles,
etc. However only the flags described above have any effect on the
build as a whole.</p>
<p>The pre-defined <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt>s like <tt class="xref py py-class docutils literal"><span class="pre">CVS</span></tt> and <tt class="xref py py-class docutils literal"><span class="pre">Compile</span></tt> have
reasonably appropriate flags set on them already. For example, without
a source tree there is no point in continuing the build, so the
<tt class="xref py py-class docutils literal"><span class="pre">CVS</span></tt> class has the <tt class="xref py py-attr docutils literal"><span class="pre">haltOnFailure</span></tt> flag set to <tt class="docutils literal"><span class="pre">True</span></tt>. Look
in <tt class="file docutils literal"><span class="pre">buildbot/steps/*.py</span></tt> to see how the other <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt>s are
marked.</p>
<p>Each <tt class="xref py py-class docutils literal"><span class="pre">Step</span></tt> is created with an additional <tt class="docutils literal"><span class="pre">workdir</span></tt> argument that
indicates where its actions should take place. This is specified as a
subdirectory of the slave builder's base directory, with a default
value of <tt class="file docutils literal"><span class="pre">build</span></tt>. This is only implemented as a step argument (as
opposed to simply being a part of the base directory) because the
CVS/SVN steps need to perform their checkouts from the parent
directory.</p>
</div>
</div>
<span id="document-developer/cls-remotecommands"></span><div class="section" id="remotecommands">
<h4>RemoteCommands<a class="headerlink" href="#remotecommands" title="Permalink to this headline">¶</a></h4>
<p>Most of the action in build steps consists of performing operations on the
slave.  This is accomplished via <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand" title="buildbot.process.buildstep.RemoteCommand"><tt class="xref py py-class docutils literal"><span class="pre">RemoteCommand</span></tt></a> and its subclasses.
Each represents a single operation on the slave.</p>
<p>Most data is returned to a command via updates.  These updates are described in
detail in <a class="reference internal" href="#master-slave-updates"><em>Updates</em></a>.</p>
<div class="section" id="remotecommand">
<h5>RemoteCommand<a class="headerlink" href="#remotecommand" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.process.buildstep.RemoteCommand">
<em class="property">class </em><tt class="descclassname">buildbot.process.buildstep.</tt><tt class="descname">RemoteCommand</tt><big>(</big><em>remote_command</em>, <em>args</em>, <em>collectStdout=False</em>, <em>ignore_updates=False</em>, <em>decodeRC=dict(0)</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>remote_command</strong> (<em>string</em>) -- command to run on the slave</li>
<li><strong>args</strong> (<em>dictionary</em>) -- arguments to pass to the command</li>
<li><strong>collectStdout</strong> -- if True, collect the command's stdout</li>
<li><strong>ignore_updates</strong> -- true to ignore remote updates</li>
<li><strong>decodeRC</strong> -- dictionary associating <tt class="docutils literal"><span class="pre">rc</span></tt> values to buildsteps results constants
(e.g. <tt class="docutils literal"><span class="pre">SUCCESS</span></tt>, <tt class="docutils literal"><span class="pre">FAILURE</span></tt>, <tt class="docutils literal"><span class="pre">WARNINGS</span></tt>)</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class handles running commands, consisting of a command name and
a dictionary of arguments.  If true, <tt class="docutils literal"><span class="pre">ignore_updates</span></tt> will suppress any
updates sent from the slave.</p>
<p>This class handles updates for <tt class="docutils literal"><span class="pre">stdout</span></tt>, <tt class="docutils literal"><span class="pre">stderr</span></tt>, and <tt class="docutils literal"><span class="pre">header</span></tt> by
appending them to a <tt class="docutils literal"><span class="pre">stdio</span></tt> logfile, if one is in use.  It handles
updates for <tt class="docutils literal"><span class="pre">rc</span></tt> by recording the value in its <tt class="docutils literal"><span class="pre">rc</span></tt> attribute.</p>
<p>Most slave-side commands, even those which do not spawn a new process on
the slave, generate logs and an <tt class="docutils literal"><span class="pre">rc</span></tt>, requiring this class or one of its
subclasses.  See <a class="reference internal" href="#master-slave-updates"><em>Updates</em></a> for the updates that each
command may send.</p>
<dl class="attribute">
<dt id="buildbot.process.buildstep.RemoteCommand.active">
<tt class="descname">active</tt><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.active" title="Permalink to this definition">¶</a></dt>
<dd><p>True if the command is currently running</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.run">
<tt class="descname">run</tt><big>(</big><em>step</em>, <em>remote</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.run" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>step</strong> -- the buildstep invoking this command</li>
<li><strong>remote</strong> -- a reference to the remote <tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt>
instance</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">Deferred</p>
</td>
</tr>
</tbody>
</table>
<p>Run the command.  Call this method to initiate the command; the
returned Deferred will fire when the command is complete.  The Deferred
fires with the <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand" title="buildbot.process.buildstep.RemoteCommand"><tt class="xref py py-class docutils literal"><span class="pre">RemoteCommand</span></tt></a> instance as its value.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.interrupt">
<tt class="descname">interrupt</tt><big>(</big><em>why</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.interrupt" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>why</strong> (<em>Twisted Failure</em>) -- reason for interrupt</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method attempts to stop the running command early.  The Deferred
it returns will fire when the interrupt request is received by the
slave; this may be a long time before the command itself completes, at
which time the Deferred returned from <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.run" title="buildbot.process.buildstep.RemoteCommand.run"><tt class="xref py py-meth docutils literal"><span class="pre">run</span></tt></a> will fire.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.results">
<tt class="descname">results</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.results" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">results constant</td>
</tr>
</tbody>
</table>
<p>This method checks the <tt class="docutils literal"><span class="pre">rc</span></tt> against the decodeRC dictionary, and returns results constant</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.didFail">
<tt class="descname">didFail</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.didFail" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
<p>This method returns True if the results() function returns FAILURE</p>
</dd></dl>

<p>The following methods are invoked from the slave.  They should not be
called directly.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.remote_update">
<tt class="descname">remote_update</tt><big>(</big><em>updates</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.remote_update" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>updates</strong> -- new information from the slave</td>
</tr>
</tbody>
</table>
<p>Handles updates from the slave on the running command.  See
<a class="reference internal" href="#master-slave-updates"><em>Updates</em></a> for the content of the updates.  This class
splits the updates out, and handles the <tt class="docutils literal"><span class="pre">ignore_updates</span></tt> option, then
calls <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.remoteUpdate" title="buildbot.process.buildstep.RemoteCommand.remoteUpdate"><tt class="xref py py-meth docutils literal"><span class="pre">remoteUpdate</span></tt></a> to process the update.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.remote_complete">
<tt class="descname">remote_complete</tt><big>(</big><em>failure=None</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.remote_complete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>failure</strong> -- the failure that caused the step to complete, or None
for success</td>
</tr>
</tbody>
</table>
<p>Called by the slave to indicate that the command is complete.  Normal
completion (even with a nonzero <tt class="docutils literal"><span class="pre">rc</span></tt>) will finish with no failure; if
<tt class="docutils literal"><span class="pre">failure</span></tt> is set, then the step should finish with status
<a class="reference internal" href="#buildbot.status.results.EXCEPTION" title="buildbot.status.results.EXCEPTION"><tt class="xref py py-attr docutils literal"><span class="pre">EXCEPTION</span></tt></a>.</p>
</dd></dl>

<p>These methods are hooks for subclasses to add functionality.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.remoteUpdate">
<tt class="descname">remoteUpdate</tt><big>(</big><em>update</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.remoteUpdate" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>update</strong> -- the update to handle</td>
</tr>
</tbody>
</table>
<p>Handle a single update.  Subclasses must override this method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.remoteComplete">
<tt class="descname">remoteComplete</tt><big>(</big><em>failure</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.remoteComplete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>failure</strong> -- the failure that caused the step to complete, or None
for success</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Handle command completion, performing any necessary cleanup.
Subclasses should override this method.  If <tt class="docutils literal"><span class="pre">failure</span></tt> is not None, it
should be returned to ensure proper processing.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.RemoteCommand.logs">
<tt class="descname">logs</tt><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.logs" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary of <a class="reference internal" href="#buildbot.status.logfile.LogFile" title="buildbot.status.logfile.LogFile"><tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt></a> instances
representing active logs.  Do not modify this directly -- use
<a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.useLog" title="buildbot.process.buildstep.RemoteCommand.useLog"><tt class="xref py py-meth docutils literal"><span class="pre">useLog</span></tt></a> instead.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.RemoteCommand.rc">
<tt class="descname">rc</tt><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.rc" title="Permalink to this definition">¶</a></dt>
<dd><p>Set to the return code of the command, after the command has completed.
For compatibility with shell commands, 0 is taken to indicate success,
while nonzero return codes indicate failure.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.RemoteCommand.stdout">
<tt class="descname">stdout</tt><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.stdout" title="Permalink to this definition">¶</a></dt>
<dd><p>If the <tt class="docutils literal"><span class="pre">collectStdout</span></tt> constructor argument is true, then this
attribute will contain all data from stdout, as a single string.  This
is helpful when running informational commands (e.g., <tt class="docutils literal"><span class="pre">svnversion</span></tt>),
but is not appropriate for commands that will produce a large amount of
output, as that output is held in memory.</p>
</dd></dl>

<p>To set up logging, use <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.useLog" title="buildbot.process.buildstep.RemoteCommand.useLog"><tt class="xref py py-meth docutils literal"><span class="pre">useLog</span></tt></a> or <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.useLogDelayed" title="buildbot.process.buildstep.RemoteCommand.useLogDelayed"><tt class="xref py py-meth docutils literal"><span class="pre">useLogDelayed</span></tt></a> before
starting the command:</p>
<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.useLog">
<tt class="descname">useLog</tt><big>(</big><em>log</em>, <em>closeWhenFinished=False</em>, <em>logfileName=None</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.useLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>log</strong> -- the <a class="reference internal" href="#buildbot.status.logfile.LogFile" title="buildbot.status.logfile.LogFile"><tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt></a> instance to add to.</li>
<li><strong>closeWhenFinished</strong> -- if true, call
<tt class="xref py py-meth docutils literal"><span class="pre">finish</span></tt> when the command is
finished.</li>
<li><strong>logfileName</strong> -- the name of the logfile, as given to the slave.
This is <tt class="docutils literal"><span class="pre">stdio</span></tt> for standard streams.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Route log-related updates to the given logfile.  Note that <tt class="docutils literal"><span class="pre">stdio</span></tt> is
not included by default, and must be added explicitly.  The
<tt class="docutils literal"><span class="pre">logfileName</span></tt> must match the name given by the slave in any <tt class="docutils literal"><span class="pre">log</span></tt>
updates.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.useLogDelayed">
<tt class="descname">useLogDelayed</tt><big>(</big><em>log</em>, <em>logfileName</em>, <em>activateCallback</em>, <em>closeWhenFinished=False</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.useLogDelayed" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>log</strong> -- the <a class="reference internal" href="#buildbot.status.logfile.LogFile" title="buildbot.status.logfile.LogFile"><tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt></a> instance to add to.</li>
<li><strong>logfileName</strong> -- the name of the logfile, as given to the slave.
This is <tt class="docutils literal"><span class="pre">stdio</span></tt> for standard streams.</li>
<li><strong>activateCallback</strong> -- callback for when the log is added; see below</li>
<li><strong>closeWhenFinished</strong> -- if true, call
<tt class="xref py py-meth docutils literal"><span class="pre">finish</span></tt> when the command is
finished.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Similar to <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.useLog" title="buildbot.process.buildstep.RemoteCommand.useLog"><tt class="xref py py-meth docutils literal"><span class="pre">useLog</span></tt></a>, but the logfile is only actually added when
an update arrives for it.  The callback, <tt class="docutils literal"><span class="pre">activateCallback</span></tt>, will be
called with the <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand" title="buildbot.process.buildstep.RemoteCommand"><tt class="xref py py-class docutils literal"><span class="pre">RemoteCommand</span></tt></a>
instance when the first update for the log is delivered.</p>
</dd></dl>

<p>With that finished, run the command using the inherited
<a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.run" title="buildbot.process.buildstep.RemoteCommand.run"><tt class="xref py py-meth docutils literal"><span class="pre">run</span></tt></a> method.  During the
run, you can inject data into the logfiles with any of these methods:</p>
<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.addStdout">
<tt class="descname">addStdout</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.addStdout" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> -- data to add to the logfile</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Add stdout data to the <tt class="docutils literal"><span class="pre">stdio</span></tt> log.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.addStderr">
<tt class="descname">addStderr</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.addStderr" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> -- data to add to the logfile</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Add stderr data to the <tt class="docutils literal"><span class="pre">stdio</span></tt> log.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.addHeader">
<tt class="descname">addHeader</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.addHeader" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> -- data to add to the logfile</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Add header data to the <tt class="docutils literal"><span class="pre">stdio</span></tt> log.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.RemoteCommand.addToLog">
<tt class="descname">addToLog</tt><big>(</big><em>logname</em>, <em>data</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteCommand.addToLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logname</strong> -- the logfile to receive the data</li>
<li><strong>data</strong> -- data to add to the logfile</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>Add data to a logfile other than <tt class="docutils literal"><span class="pre">stdio</span></tt>.</p>
</dd></dl>

<dl class="class">
<dt id="buildbot.process.buildstep.RemoteShellCommand">
<em class="property">class </em><tt class="descclassname">buildbot.process.buildstep.</tt><tt class="descname">RemoteShellCommand</tt><big>(</big><em>workdir</em>, <em>command</em>, <em>env=None</em>, <em>want_stdout=True</em>, <em>want_stderr=True</em>, <em>timeout=20*60</em>, <em>maxTime=None</em>, <em>logfiles={}</em>, <em>usePTY=&quot;slave-config&quot;</em>, <em>logEnviron=True</em>, <em>collectStdio=False</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.RemoteShellCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>workdir</strong> -- directory in which command should be executed, relative to
the builder's basedir.</li>
<li><strong>command</strong> (<em>string or list</em>) -- shell command to run</li>
<li><strong>want_stdout</strong> -- If false, then no updates will be sent for stdout.</li>
<li><strong>want_stderr</strong> -- If false, then no updates will be sent for stderr.</li>
<li><strong>timeout</strong> -- Maximum time without output before the command is killed.</li>
<li><strong>maxTime</strong> -- Maximum overall time from the start before the command is
killed.</li>
<li><strong>env</strong> -- A dictionary of environment variables to augment or replace the
existing environment on the slave.</li>
<li><strong>logfiles</strong> -- Additional logfiles to request from the slave.</li>
<li><strong>usePTY</strong> -- True to use a PTY, false to not use a PTY; the default value
uses the default configured on the slave.</li>
<li><strong>logEnviron</strong> -- If false, do not log the environment on the slave.</li>
<li><strong>collectStdout</strong> -- If True, collect the command's stdout.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Most of the constructor arguments are sent directly to the slave; see
<a class="reference internal" href="#shell-command-args"><em>shell</em></a> for the details of the formats.  The
<tt class="docutils literal"><span class="pre">collectStdout</span></tt> parameter is as described for the parent class.</p>
<p>This class is used by the <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a> step, and by steps that
run multiple customized shell commands.</p>
</dd></dl>

</div>
</div>
<span id="document-developer/cls-buildsteps"></span><div class="section" id="module-buildbot.process.buildstep">
<span id="buildsteps"></span><h4>BuildSteps<a class="headerlink" href="#module-buildbot.process.buildstep" title="Permalink to this headline">¶</a></h4>
<p>There are a few parent classes that are used as base classes for real buildsteps.
This section describes the base classes.  The &quot;leaf&quot; classes are described in <a class="reference internal" href="#document-manual/cfg-buildsteps"><em>Build Steps</em></a>.</p>
<div class="section" id="buildstep">
<h5>BuildStep<a class="headerlink" href="#buildstep" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.process.buildstep.BuildStep">
<em class="property">class </em><tt class="descclassname">buildbot.process.buildstep.</tt><tt class="descname">BuildStep</tt><big>(</big><em>name</em>, <em>locks</em>, <em>haltOnFailure</em>, <em>flunkOnWarnings</em>, <em>flunkOnFailure</em>, <em>warnOnWarnings</em>, <em>warnOnFailure</em>, <em>alwaysRun</em>, <em>progressMetrics</em>, <em>useProgress</em>, <em>doStepIf</em>, <em>hideStepIf</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep" title="Permalink to this definition">¶</a></dt>
<dd><p>All constructor arguments must be given as keyword arguments.
Each constructor parameter is copied to the corresponding attribute.</p>
<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.name">
<tt class="descname">name</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the step.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.locks">
<tt class="descname">locks</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.locks" title="Permalink to this definition">¶</a></dt>
<dd><p>List of locks for this step; see <a class="reference internal" href="#interlocks"><em>Interlocks</em></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.progressMetrics">
<tt class="descname">progressMetrics</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.progressMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>List of names of metrics that should be used to track the progress of this build, and build ETA's for users.
This is generally set in the</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.useProgress">
<tt class="descname">useProgress</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.useProgress" title="Permalink to this definition">¶</a></dt>
<dd><p>If true (the default), then ETAs will be calculated for this step using progress metrics.
If the step is known to have unpredictable timing (e.g., an incremental build), then this should be set to false.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.doStepIf">
<tt class="descname">doStepIf</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.doStepIf" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable or bool to determine whether this step should be executed.
See <a class="reference internal" href="#buildstep-common-parameters"><em>Common Parameters</em></a> for details.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.hideStepIf">
<tt class="descname">hideStepIf</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.hideStepIf" title="Permalink to this definition">¶</a></dt>
<dd><p>A callable or bool to determine whether this step should be shown in the waterfall and build details pages.
See <a class="reference internal" href="#buildstep-common-parameters"><em>Common Parameters</em></a> for details.</p>
</dd></dl>

<p>The following attributes affect the behavior of the containing build:</p>
<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.haltOnFailure">
<tt class="descname">haltOnFailure</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.haltOnFailure" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will halt on a failure of this step, and not execute subsequent tests (except those with <tt class="docutils literal"><span class="pre">alwaysRun</span></tt>).</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.flunkOnWarnings">
<tt class="descname">flunkOnWarnings</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.flunkOnWarnings" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will be marked as a failure if this step ends with warnings.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.flunkOnFailure">
<tt class="descname">flunkOnFailure</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.flunkOnFailure" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will be marked as a failure if this step fails.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.warnOnWarnings">
<tt class="descname">warnOnWarnings</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.warnOnWarnings" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will be marked as warnings, or worse, if this step ends with warnings.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.warnOnFailure">
<tt class="descname">warnOnFailure</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.warnOnFailure" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the build will be marked as warnings, or worse, if this step fails.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.alwaysRun">
<tt class="descname">alwaysRun</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.alwaysRun" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, the step will run even if a previous step halts the build with <tt class="docutils literal"><span class="pre">haltOnFailure</span></tt>.</p>
</dd></dl>

<p>A few important pieces of information are not available when a step is constructed, and are added later.
These are set by the following methods; the order in which these methods are called is not defined.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setBuild">
<tt class="descname">setBuild</tt><big>(</big><em>build</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setBuild" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>build</strong> -- the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt> instance controlling this step.</td>
</tr>
</tbody>
</table>
<p>This method is called during setup to set the build instance controlling this slave.
Subclasses can override this to get access to the build object as soon as it is available.
The default implementation sets the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.build" title="buildbot.process.buildstep.BuildStep.build"><tt class="xref py py-attr docutils literal"><span class="pre">build</span></tt></a> attribute.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.build">
<tt class="descname">build</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.build" title="Permalink to this definition">¶</a></dt>
<dd><p>The build object controlling this step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setBuildSlave">
<tt class="descname">setBuildSlave</tt><big>(</big><em>build</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setBuildSlave" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>build</strong> -- the <tt class="xref py py-class docutils literal"><span class="pre">BuildSlave</span></tt> instance on which this step will run.</td>
</tr>
</tbody>
</table>
<p>Similarly, this method is called with the build slave that will run this step.
The default implementation sets the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.buildslave" title="buildbot.process.buildstep.BuildStep.buildslave"><tt class="xref py py-attr docutils literal"><span class="pre">buildslave</span></tt></a> attribute.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.buildslave">
<tt class="descname">buildslave</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.buildslave" title="Permalink to this definition">¶</a></dt>
<dd><p>The build slave that will run this step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setDefaultWorkdir">
<tt class="descname">setDefaultWorkdir</tt><big>(</big><em>workdir</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setDefaultWorkdir" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>workdir</strong> -- the default workdir, from the build</td>
</tr>
</tbody>
</table>
<p>This method is called at build startup with the default workdir for the build.
Steps which allow a workdir to be specified, but want to override it with the build's default workdir, can use this method to apply the default.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setStepStatus">
<tt class="descname">setStepStatus</tt><big>(</big><em>status</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setStepStatus" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>status</strong> (<tt class="xref py py-class docutils literal"><span class="pre">BuildStepStatus</span></tt>) -- step status</td>
</tr>
</tbody>
</table>
<p>This method is called to set the status instance to which the step should report.
The default implementation sets <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.step_status" title="buildbot.process.buildstep.BuildStep.step_status"><tt class="xref py py-attr docutils literal"><span class="pre">step_status</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.step_status">
<tt class="descname">step_status</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.step_status" title="Permalink to this definition">¶</a></dt>
<dd><p>The <tt class="xref py py-class docutils literal"><span class="pre">BuildStepStatus</span></tt> object tracking the status of this step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setupProgress">
<tt class="descname">setupProgress</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setupProgress" title="Permalink to this definition">¶</a></dt>
<dd><p>This method is called during build setup to give the step a chance to set up progress tracking.
It is only called if the build has <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.useProgress" title="buildbot.process.buildstep.BuildStep.useProgress"><tt class="xref py py-attr docutils literal"><span class="pre">useProgress</span></tt></a> set.
There is rarely any reason to override this method.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.progress">
<tt class="descname">progress</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.progress" title="Permalink to this definition">¶</a></dt>
<dd><p>If the step is tracking progress, this is a <tt class="xref py py-class docutils literal"><span class="pre">StepProgress</span></tt> instance performing that task.</p>
</dd></dl>

<p>Exeuction of the step itself is governed by the following methods and attributes.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.startStep">
<tt class="descname">startStep</tt><big>(</big><em>remote</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.startStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>remote</strong> -- a remote reference to the slave-side
<tt class="xref py py-class docutils literal"><span class="pre">SlaveBuilder</span></tt> instance</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>Begin the step. This is the build's interface to step execution.
Subclasses should override <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.start" title="buildbot.process.buildstep.BuildStep.start"><tt class="xref py py-meth docutils literal"><span class="pre">start</span></tt></a> to implement custom behaviors.</p>
<p>The method returns a Deferred that fires when the step finishes.
It fires with a tuple of <tt class="docutils literal"><span class="pre">(result,</span> <span class="pre">[extra</span> <span class="pre">text])</span></tt>, where <tt class="docutils literal"><span class="pre">result</span></tt> is one of the constants from <tt class="xref py py-mod docutils literal"><span class="pre">buildbot.status.builder</span></tt>.
The extra text is a list of short strings which should be appended to the Build's text results.
For example, a test step may add <tt class="docutils literal"><span class="pre">17</span> <span class="pre">failures</span></tt> to the Build's status by this mechanism.</p>
<p>The deferred will errback if the step encounters an exception, including an exception on the slave side (or if the slave goes away altogether).
Normal build/test failures will <em>not</em> cause an errback.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.start">
<tt class="descname">start</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.start" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><tt class="docutils literal"><span class="pre">None</span></tt> or <a class="reference internal" href="#buildbot.status.results.SKIPPED" title="buildbot.status.results.SKIPPED"><tt class="xref py py-data docutils literal"><span class="pre">SKIPPED</span></tt></a>,
optionally via a Deferred.</td>
</tr>
</tbody>
</table>
<p>Begin the step.
Subclasses should override this method to do local processing, fire off remote commands, etc.
The parent method raises <tt class="xref py py-exc docutils literal"><span class="pre">NotImplementedError</span></tt>.</p>
<p>When the step is done, it should call <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><tt class="xref py py-meth docutils literal"><span class="pre">finished</span></tt></a>, with a result -- a constant from <a class="reference internal" href="#module-buildbot.status.results" title="buildbot.status.results"><tt class="xref py py-mod docutils literal"><span class="pre">buildbot.status.results</span></tt></a>.
The result will be handed off to the <tt class="xref py py-class docutils literal"><span class="pre">Build</span></tt>.</p>
<p>If the step encounters an exception, it should call <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><tt class="xref py py-meth docutils literal"><span class="pre">failed</span></tt></a> with a Failure object.
This method automatically fails the whole build with an exception.
A common idiom is to add <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><tt class="xref py py-meth docutils literal"><span class="pre">failed</span></tt></a> as an errback on a Deferred:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cmd</span> <span class="o">=</span> <span class="n">RemoteCommand</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">suceed</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">SUCCESS</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">addCallback</span><span class="p">(</span><span class="n">succeed</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">addErrback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">)</span>
</pre></div>
</div>
<p>If the step decides it does not need to be run, <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.start" title="buildbot.process.buildstep.BuildStep.start"><tt class="xref py py-meth docutils literal"><span class="pre">start</span></tt></a> can return the constant <a class="reference internal" href="#buildbot.status.results.SKIPPED" title="buildbot.status.results.SKIPPED"><tt class="xref py py-data docutils literal"><span class="pre">SKIPPED</span></tt></a>.
In this case, it is not necessary to call <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><tt class="xref py py-meth docutils literal"><span class="pre">finished</span></tt></a> directly.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.finished">
<tt class="descname">finished</tt><big>(</big><em>results</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.finished" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>results</strong> -- a constant from <a class="reference internal" href="#module-buildbot.status.results" title="buildbot.status.results"><tt class="xref py py-mod docutils literal"><span class="pre">results</span></tt></a></td>
</tr>
</tbody>
</table>
<p>A call to this method indicates that the step is finished and the build should analyze the results and perhaps proceed to the next step.
The step should not perform any additional processing after calling this method.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.failed">
<tt class="descname">failed</tt><big>(</big><em>failure</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.failed" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>failure</strong> -- a <tt class="xref py py-class docutils literal"><span class="pre">Failure</span></tt> instance</td>
</tr>
</tbody>
</table>
<p>Similar to <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><tt class="xref py py-meth docutils literal"><span class="pre">finished</span></tt></a>, this method indicates that the step is finished, but handles exceptions with appropriate logging and diagnostics.</p>
<p>This method handles <a class="reference internal" href="#buildbot.process.buildstep.BuildStepFailed" title="buildbot.process.buildstep.BuildStepFailed"><tt class="xref py py-exc docutils literal"><span class="pre">BuildStepFailed</span></tt></a> specially, by calling <tt class="docutils literal"><span class="pre">finished(FAILURE)</span></tt>.
This provides subclasses with a shortcut to stop execution of a step by raising this failure in a context where <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><tt class="xref py py-meth docutils literal"><span class="pre">failed</span></tt></a> will catch it.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.interrupt">
<tt class="descname">interrupt</tt><big>(</big><em>reason</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.interrupt" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>reason</strong> (string or <tt class="xref py py-class docutils literal"><span class="pre">Failure</span></tt>) -- why the build was interrupted</td>
</tr>
</tbody>
</table>
<p>This method is used from various control interfaces to stop a running step.
The step should be brought to a halt as quickly as possible, by cancelling a remote command, killing a local process, etc.
The step must still finish with either <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.finished" title="buildbot.process.buildstep.BuildStep.finished"><tt class="xref py py-meth docutils literal"><span class="pre">finished</span></tt></a> or <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><tt class="xref py py-meth docutils literal"><span class="pre">failed</span></tt></a>.</p>
<p>The <tt class="docutils literal"><span class="pre">reason</span></tt> parameter can be a string or, when a slave is lost during step processing, a <tt class="xref py py-exc docutils literal"><span class="pre">ConnectionLost</span></tt> failure.</p>
<p>The parent method handles any pending lock operations, and should be called by implementations in subclasses.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.process.buildstep.BuildStep.stopped">
<tt class="descname">stopped</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.stopped" title="Permalink to this definition">¶</a></dt>
<dd><p>If false, then the step is running.  If true, the step is not running, or has been interrupted.</p>
</dd></dl>

<p>This method provides a convenient way to summarize the status of the step for status displays:</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.describe">
<tt class="descname">describe</tt><big>(</big><em>done=False</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.describe" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>done</strong> -- If true, the step is finished.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of strings</td>
</tr>
</tbody>
</table>
<p>Describe the step succinctly.
The return value should be a sequence of short strings suitable for display in a horizontally constrained space.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be careful not to assume that the step has been started in this method.
In relatively rare circumstances, steps are described before they have started.
Ideally, unit tests should be used to ensure that this method is resilient.</p>
</div>
</dd></dl>

<p>Build steps support progress metrics - values that increase roughly linearly during the execution of the step, and can thus be used to calculate an expected completion time for a running step.
A metric may be a count of lines logged, tests executed, or files compiled.
The build mechanics will take care of translating this progress information into an ETA for the user.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.setProgress">
<tt class="descname">setProgress</tt><big>(</big><em>metric</em>, <em>value</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.setProgress" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>metric</strong> (<em>string</em>) -- the metric to update</li>
<li><strong>value</strong> (<em>integer</em>) -- the new value for the metric</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Update a progress metric.
This should be called by subclasses that can provide useful progress-tracking information.</p>
<p>The specified metric name must be included in <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.progressMetrics" title="buildbot.process.buildstep.BuildStep.progressMetrics"><tt class="xref py py-attr docutils literal"><span class="pre">progressMetrics</span></tt></a>.</p>
</dd></dl>

<p>The following methods are provided as utilities to subclasses.
These methods should only be invoked after the step is started.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.slaveVersion">
<tt class="descname">slaveVersion</tt><big>(</big><em>command</em>, <em>oldVersion=None</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.slaveVersion" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> (<em>string</em>) -- command to examine</li>
<li><strong>oldVersion</strong> -- return value if the slave does not specify a version</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">string</p>
</td>
</tr>
</tbody>
</table>
<p>Fetch the version of the named command, as specified on the slave.
In practice, all commands on a slave have the same version, but passing <tt class="docutils literal"><span class="pre">command</span></tt> is still useful to ensure that the command is implemented on the slave.
If the command is not implemented on the slave, <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.slaveVersion" title="buildbot.process.buildstep.BuildStep.slaveVersion"><tt class="xref py py-meth docutils literal"><span class="pre">slaveVersion</span></tt></a> will return <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>Versions take the form <tt class="docutils literal"><span class="pre">x.y</span></tt> where <tt class="docutils literal"><span class="pre">x</span></tt> and <tt class="docutils literal"><span class="pre">y</span></tt> are integers, and are compared as expected for version numbers.</p>
<p>Buildbot versions older than 0.5.0 did not support version queries; in this case, <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.slaveVersion" title="buildbot.process.buildstep.BuildStep.slaveVersion"><tt class="xref py py-meth docutils literal"><span class="pre">slaveVersion</span></tt></a> will return <tt class="docutils literal"><span class="pre">oldVersion</span></tt>.
Since such ancient versions of Buildbot are no longer in use, this functionality is largely vestigial.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.slaveVersionIsOlderThan">
<tt class="descname">slaveVersionIsOlderThan</tt><big>(</big><em>command</em>, <em>minversion</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.slaveVersionIsOlderThan" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> (<em>string</em>) -- command to examine</li>
<li><strong>minversion</strong> -- minimum version</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">boolean</p>
</td>
</tr>
</tbody>
</table>
<p>This method returns true if <tt class="docutils literal"><span class="pre">command</span></tt> is not implemented on the slave, or if it is older than <tt class="docutils literal"><span class="pre">minversion</span></tt>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getSlaveName">
<tt class="descname">getSlaveName</tt><big>(</big><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getSlaveName" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">string</td>
</tr>
</tbody>
</table>
<p>Get the name of the buildslave assigned to this step.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.runCommand">
<tt class="descname">runCommand</tt><big>(</big><em>command</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.runCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Deferred</td>
</tr>
</tbody>
</table>
<p>This method connects the given command to the step's buildslave and runs it, returning the Deferred from <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.run" title="buildbot.process.buildstep.RemoteCommand.run"><tt class="xref py py-meth docutils literal"><span class="pre">run</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addURL">
<tt class="descname">addURL</tt><big>(</big><em>name</em>, <em>url</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addURL" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> -- URL name</li>
<li><strong>url</strong> -- the URL</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Add a link to the given <tt class="docutils literal"><span class="pre">url</span></tt>, with the given <tt class="docutils literal"><span class="pre">name</span></tt> to displays of this step.
This allows a step to provide links to data that is not available in the log files.</p>
</dd></dl>

<p>The <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt></a> class provides minimal support for log handling, that is extended by the <a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep" title="buildbot.process.buildstep.LoggingBuildStep"><tt class="xref py py-class docutils literal"><span class="pre">LoggingBuildStep</span></tt></a> class.
The following methods provide some useful behaviors.
These methods can be called while the step is running, but not before.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addLog">
<tt class="descname">addLog</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> -- log name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><a class="reference internal" href="#buildbot.status.logfile.LogFile" title="buildbot.status.logfile.LogFile"><tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt></a> instance</td>
</tr>
</tbody>
</table>
<p>Add a new logfile with the given name to the step, and return the log file instance.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.getLog">
<tt class="descname">getLog</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.getLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> -- log name</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><a class="reference internal" href="#buildbot.status.logfile.LogFile" title="buildbot.status.logfile.LogFile"><tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt></a> instance</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises :</th><td class="field-body"><tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt> if the log is not found</td>
</tr>
</tbody>
</table>
<p>Get an existing logfile by name.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addCompleteLog">
<tt class="descname">addCompleteLog</tt><big>(</big><em>name</em>, <em>text</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> -- log name</li>
<li><strong>text</strong> -- content of the logfile</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method adds a new log and sets <tt class="docutils literal"><span class="pre">text</span></tt> as its content.
This is often useful to add a short logfile describing activities performed on the master.
The logfile is immediately closed, and no further data can be added.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addHTMLLog">
<tt class="descname">addHTMLLog</tt><big>(</big><em>name</em>, <em>html</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addHTMLLog" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> -- log name</li>
<li><strong>html</strong> -- content of the logfile</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Similar to <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><tt class="xref py py-meth docutils literal"><span class="pre">addCompleteLog</span></tt></a>, this adds a logfile containing pre-formatted HTML, allowing more expressiveness than the text format supported by <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addCompleteLog" title="buildbot.process.buildstep.BuildStep.addCompleteLog"><tt class="xref py py-meth docutils literal"><span class="pre">addCompleteLog</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.BuildStep.addLogObserver">
<tt class="descname">addLogObserver</tt><big>(</big><em>logname</em>, <em>observer</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.BuildStep.addLogObserver" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logname</strong> -- log name</li>
<li><strong>observer</strong> -- log observer instance</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Add a log observer for the named log.
The named log need not have been added already: the observer will be connected when the log is added.</p>
<p>See <a class="reference internal" href="#adding-logobservers"><em>Adding LogObservers</em></a> for more information on log observers.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="loggingbuildstep">
<h5>LoggingBuildStep<a class="headerlink" href="#loggingbuildstep" title="Permalink to this headline">¶</a></h5>
<dl class="class">
<dt id="buildbot.process.buildstep.LoggingBuildStep">
<em class="property">class </em><tt class="descclassname">buildbot.process.buildstep.</tt><tt class="descname">LoggingBuildStep</tt><big>(</big><em>logfiles</em>, <em>lazylogfiles</em>, <em>log_eval_func</em>, <em>name</em>, <em>locks</em>, <em>haltOnFailure</em>, <em>flunkOnWarnings</em>, <em>flunkOnFailure</em>, <em>warnOnWarnings</em>, <em>warnOnFailure</em>, <em>alwaysRun</em>, <em>progressMetrics</em>, <em>useProgress</em>, <em>doStepIf</em>, <em>hideStepIf</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>logfiles</strong> -- see <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a></li>
<li><strong>lazylogfiles</strong> -- see <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a></li>
<li><strong>log_eval_func</strong> -- see <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The remaining arguments are passed to the <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt></a> constructor.</p>
<p>This subclass of <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt></a> is designed to help its subclasses run remote commands that produce standard I/O logfiles.
It:</p>
<ul class="simple">
<li>tracks progress using the length of the stdout logfile</li>
<li>provides hooks for summarizing and evaluating the command's result</li>
<li>supports lazy logfiles</li>
<li>handles the mechanics of starting, interrupting, and finishing remote commands</li>
<li>detects lost slaves and finishes with a status of
<a class="reference internal" href="#buildbot.status.results.RETRY" title="buildbot.status.results.RETRY"><tt class="xref py py-data docutils literal"><span class="pre">RETRY</span></tt></a></li>
</ul>
<dl class="attribute">
<dt id="buildbot.process.buildstep.LoggingBuildStep.logfiles">
<tt class="descname">logfiles</tt><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.logfiles" title="Permalink to this definition">¶</a></dt>
<dd><p>The logfiles to track, as described for <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><tt class="xref bb bb-step docutils literal"><span class="pre">ShellCommand</span></tt></a>.
The contents of the class-level <tt class="docutils literal"><span class="pre">logfiles</span></tt> attribute are combined with those passed to the constructor, so subclasses may add log files with a class attribute:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyStep</span><span class="p">(</span><span class="n">LoggingBuildStep</span><span class="p">):</span>
    <span class="n">logfiles</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="s">&#39;debug.log&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that lazy logfiles cannot be specified using this method; they must be provided as constructor arguments.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.LoggingBuildStep.startCommand">
<tt class="descname">startCommand</tt><big>(</big><em>command</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.startCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>command</strong> -- the <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand" title="buildbot.process.buildstep.RemoteCommand"><tt class="xref py py-class docutils literal"><span class="pre">RemoteCommand</span></tt></a>
instance to start</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<blockquote>
<div>This method permits an optional <tt class="docutils literal"><span class="pre">errorMessages</span></tt> parameter, allowing errors detected early in the command process to be logged.
It will be removed, and its use is deprecated.</div></blockquote>
<p>Handle all of the mechanics of running the given command.
This sets up all required logfiles, keeps status text up to date, and calls the utility hooks described below.
When the command is finished, the step is finished as well, making this class is unsuitable for steps that run more than one command in sequence.</p>
<p>Subclasses should override <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.start" title="buildbot.process.buildstep.BuildStep.start"><tt class="xref py py-meth docutils literal"><span class="pre">start</span></tt></a> and, after setting up an appropriate command, call this method.</p>
<div class="last highlight-python"><pre>def start(self):
    cmd = RemoteShellCommand(..)
    self.startCommand(cmd, warnings)</pre>
</div>
</div>
</dd></dl>

<p>To refine the status output, override one or more of the following methods.
The <a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep" title="buildbot.process.buildstep.LoggingBuildStep"><tt class="xref py py-class docutils literal"><span class="pre">LoggingBuildStep</span></tt></a> implementations are stubs, so there is no need to call the parent method.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.LoggingBuildStep.commandComplete">
<tt class="descname">commandComplete</tt><big>(</big><em>command</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.commandComplete" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>command</strong> -- the just-completed remote command</td>
</tr>
</tbody>
</table>
<p>This is a general-purpose hook method for subclasses.
It will be called after the remote command has finished, but before any of the other hook functions are called.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.LoggingBuildStep.createSummary">
<tt class="descname">createSummary</tt><big>(</big><em>stdio</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.createSummary" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>stdio</strong> -- stdio <a class="reference internal" href="#buildbot.status.logfile.LogFile" title="buildbot.status.logfile.LogFile"><tt class="xref py py-class docutils literal"><span class="pre">LogFile</span></tt></a></td>
</tr>
</tbody>
</table>
<p>This hook is designed to perform any summarization of the step, based either on the contents of the stdio logfile, or on instance attributes set earlier in the step processing.
Implementations of this method often call e.g., <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.addURL" title="buildbot.process.buildstep.BuildStep.addURL"><tt class="xref py py-meth docutils literal"><span class="pre">addURL</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.LoggingBuildStep.evaluateCommand">
<tt class="descname">evaluateCommand</tt><big>(</big><em>command</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.evaluateCommand" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>command</strong> -- the just-completed remote command</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">step result from <a class="reference internal" href="#module-buildbot.status.results" title="buildbot.status.results"><tt class="xref py py-mod docutils literal"><span class="pre">buildbot.status.results</span></tt></a></td>
</tr>
</tbody>
</table>
<p>This hook should decide what result the step should have.
The default implementation invokes <tt class="docutils literal"><span class="pre">log_eval_func</span></tt> if it exists, and looks at <a class="reference internal" href="#buildbot.process.buildstep.RemoteCommand.rc" title="buildbot.process.buildstep.RemoteCommand.rc"><tt class="xref py py-attr docutils literal"><span class="pre">rc</span></tt></a> to distinguish <a class="reference internal" href="#buildbot.status.results.SUCCESS" title="buildbot.status.results.SUCCESS"><tt class="xref py py-data docutils literal"><span class="pre">SUCCESS</span></tt></a> from <a class="reference internal" href="#buildbot.status.results.FAILURE" title="buildbot.status.results.FAILURE"><tt class="xref py py-data docutils literal"><span class="pre">FAILURE</span></tt></a>.</p>
</dd></dl>

<p>The remaining methods provide an embarassment of ways to set the summary of the step that appears in the various status interfaces.
The easiest way to affect this output is to override <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.describe" title="buildbot.process.buildstep.BuildStep.describe"><tt class="xref py py-meth docutils literal"><span class="pre">describe</span></tt></a>.
If that is not flexible enough, override <a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep.getText" title="buildbot.process.buildstep.LoggingBuildStep.getText"><tt class="xref py py-meth docutils literal"><span class="pre">getText</span></tt></a> and/or <a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep.getText2" title="buildbot.process.buildstep.LoggingBuildStep.getText2"><tt class="xref py py-meth docutils literal"><span class="pre">getText2</span></tt></a>.</p>
<dl class="method">
<dt id="buildbot.process.buildstep.LoggingBuildStep.getText">
<tt class="descname">getText</tt><big>(</big><em>command</em>, <em>results</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.getText" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> -- the just-completed remote command</li>
<li><strong>results</strong> -- step result from <a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep.evaluateCommand" title="buildbot.process.buildstep.LoggingBuildStep.evaluateCommand"><tt class="xref py py-meth docutils literal"><span class="pre">evaluateCommand</span></tt></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a list of short strings</p>
</td>
</tr>
</tbody>
</table>
<p>This method is the primary means of describing the step.
The default implementation calls <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.describe" title="buildbot.process.buildstep.BuildStep.describe"><tt class="xref py py-meth docutils literal"><span class="pre">describe</span></tt></a>, which is usally the easiest method to override, and then appends a string describing the step status if it was not successful.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.process.buildstep.LoggingBuildStep.getText2">
<tt class="descname">getText2</tt><big>(</big><em>command</em>, <em>results</em><big>)</big><a class="headerlink" href="#buildbot.process.buildstep.LoggingBuildStep.getText2" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>command</strong> -- the just-completed remote command</li>
<li><strong>results</strong> -- step result from <a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep.evaluateCommand" title="buildbot.process.buildstep.LoggingBuildStep.evaluateCommand"><tt class="xref py py-meth docutils literal"><span class="pre">evaluateCommand</span></tt></a></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a list of short strings</p>
</td>
</tr>
</tbody>
</table>
<p>Like <a class="reference internal" href="#buildbot.process.buildstep.LoggingBuildStep.getText" title="buildbot.process.buildstep.LoggingBuildStep.getText"><tt class="xref py py-meth docutils literal"><span class="pre">getText</span></tt></a>, this method summarizes the step's result, but it is only called when that result affects the build, either by making it halt, flunk, or end with warnings.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="exceptions">
<h5>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h5>
<dl class="exception">
<dt id="buildbot.process.buildstep.BuildStepFailed">
<em class="property">exception </em><tt class="descclassname">buildbot.process.buildstep.</tt><tt class="descname">BuildStepFailed</tt><a class="headerlink" href="#buildbot.process.buildstep.BuildStepFailed" title="Permalink to this definition">¶</a></dt>
<dd><p>This exception indicates that the buildstep has failed.
It is useful as a way to skip all subsequent processing when a step goes wrong.
It is handled by <a class="reference internal" href="#buildbot.process.buildstep.BuildStep.failed" title="buildbot.process.buildstep.BuildStep.failed"><tt class="xref py py-meth docutils literal"><span class="pre">BuildStep.failed</span></tt></a>.</p>
</dd></dl>

</div>
</div>
<span id="document-developer/cls-forcesched"></span><div class="section" id="forcescheduler">
<span id="id1"></span><h4>ForceScheduler<a class="headerlink" href="#forcescheduler" title="Permalink to this headline">¶</a></h4>
<p>The force scheduler has a symbiotic relationship with the web status, so it
deserves some further description.</p>
<div class="section" id="parameters">
<h5>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h5>
<p>The force scheduler comes with a fleet of parameter classes.  This section
contains information to help users or developers who are interested in adding
new parameter types or hacking the existing types.</p>
<span class="target" id="module-buildbot.schedulers.forceshed"></span><dl class="class">
<dt id="buildbot.schedulers.forceshed.BaseParameter">
<em class="property">class </em><tt class="descclassname">buildbot.schedulers.forceshed.</tt><tt class="descname">BaseParameter</tt><big>(</big><em>name</em>, <em>label</em>, <em>regex</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the base implementation for most parameters, it will check validity,
ensure the arg is present if the <tt class="xref py py-attr docutils literal"><span class="pre">required</span></tt> attribute
is set, and implement the default value.  It will finally call
<tt class="xref py py-meth docutils literal"><span class="pre">update_from_post</span></tt> to process the string(s) from the
HTTP POST.</p>
<p>This class implements <tt class="xref py py-class docutils literal"><span class="pre">IParameter</span></tt>, and subclasses are expected to
adhere to that interface.</p>
<p>The <a class="reference internal" href="#buildbot.schedulers.forceshed.BaseParameter" title="buildbot.schedulers.forceshed.BaseParameter"><tt class="xref py py-class docutils literal"><span class="pre">BaseParameter</span></tt></a> constructor converts any keyword arguments
into instance attributes, so it is generally not necessary for subclasses to
implement a constructor.</p>
<blockquote>
<div><dl class="method">
<dt id="buildbot.schedulers.forceshed.BaseParameter.update_from_post">
<tt class="descname">update_from_post</tt><big>(</big><em>master</em>, <em>properties</em>, <em>changes</em>, <em>req</em><big>)</big><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.update_from_post" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>master</strong> -- the <tt class="xref py py-class docutils literal"><span class="pre">BuildMaster</span></tt> instance</li>
<li><strong>properties</strong> -- a dictionary of properties</li>
<li><strong>changes</strong> -- a list of changeids that will be used to build the
SourceStamp for the forced builds</li>
<li><strong>req</strong> -- the Twisted Web request object</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method updates <tt class="docutils literal"><span class="pre">properties</span></tt> and/or <tt class="docutils literal"><span class="pre">changes</span></tt> according to the
request.  The default implementation is good for many simple uses, but
can be overridden for more complex purposes.</p>
</dd></dl>

<p>The remaining attributes and methods should be overridden by subclasses, although
<a class="reference internal" href="#buildbot.schedulers.forceshed.BaseParameter" title="buildbot.schedulers.forceshed.BaseParameter"><tt class="xref py py-class docutils literal"><span class="pre">BaseParameter</span></tt></a> provides appropriate defaults.</p>
<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.name">
<tt class="descname">name</tt><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.name" title="Permalink to this definition">¶</a></dt>
<dd><p>The name of the parameter. This will correspond to the name of the
property that your parameter will set.  This name is also used
internally as identifier for http POST arguments</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.label">
<tt class="descname">label</tt><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.label" title="Permalink to this definition">¶</a></dt>
<dd><p>The label of the parameter, as displayed to the user.  This value
can contain raw HTML.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.type">
<tt class="descname">type</tt><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.type" title="Permalink to this definition">¶</a></dt>
<dd><p>The type of the parameter is used by the jinja template to create
appropriate html form widget.  The available values are visible in
<a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/buildbot/status/web/template/forms.html" title="master/buildbot/status/web/template/forms.html"><tt class="docutils literal"><span class="pre">master/buildbot/status/web/template/forms.html</span></tt></a> in the
<tt class="docutils literal"><span class="pre">force_build_one_scheduler</span></tt> macro.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.default">
<tt class="descname">default</tt><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.default" title="Permalink to this definition">¶</a></dt>
<dd><p>The default value, used if there is no user input.  This is also
used to fill in the form presented to the user.</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.required">
<tt class="descname">required</tt><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.required" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, an error will be shown to user if there is no input in this
field</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.multiple">
<tt class="descname">multiple</tt><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.multiple" title="Permalink to this definition">¶</a></dt>
<dd><p>If true, this parameter will return a list of values (e.g. list of
tests to run)</p>
</dd></dl>

<dl class="attribute">
<dt id="buildbot.schedulers.forceshed.BaseParameter.regex">
<tt class="descname">regex</tt><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.regex" title="Permalink to this definition">¶</a></dt>
<dd><p>A string that will be compiled as a regex and used to validate the
string value of this parameter.  If None, then no validation will
take place.</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.forceshed.BaseParameter.parse_from_args">
<tt class="descname">parse_from_args</tt><big>(</big><em>l</em><big>)</big><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.parse_from_args" title="Permalink to this definition">¶</a></dt>
<dd><p>return the list of object corresponding to the list or string passed
default function will just call <a class="reference internal" href="#buildbot.schedulers.forceshed.BaseParameter.parse_from_arg" title="buildbot.schedulers.forceshed.BaseParameter.parse_from_arg"><tt class="xref py py-func docutils literal"><span class="pre">parse_from_arg</span></tt></a> with the
first argument</p>
</dd></dl>

<dl class="method">
<dt id="buildbot.schedulers.forceshed.BaseParameter.parse_from_arg">
<tt class="descname">parse_from_arg</tt><big>(</big><em>s</em><big>)</big><a class="headerlink" href="#buildbot.schedulers.forceshed.BaseParameter.parse_from_arg" title="Permalink to this definition">¶</a></dt>
<dd><p>return the  object corresponding to the string passed
default function will just return the unmodified string</p>
</dd></dl>

</div></blockquote>
</dd></dl>

</div>
</div>
<span id="document-developer/cls-irenderable"></span><div class="section" id="irenderable">
<span id="index-0"></span><h4>IRenderable<a class="headerlink" href="#irenderable" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt>
<tt class="descname">buildbot.interfaces.IRenderable::</tt></dt>
<dd><p>Providers of this class can be &quot;rendered&quot;, based on available properties, when a build is started.</p>
<dl class="method">
<dt id="getRenderingFor">
<tt class="descname">getRenderingFor</tt><big>(</big><em>iprops</em><big>)</big><a class="headerlink" href="#getRenderingFor" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>iprops</strong> -- the <tt class="xref py py-class docutils literal"><span class="pre">IProperties</span></tt> provider supplying the properties of the build.</td>
</tr>
</tbody>
</table>
<p>Reeturns the interpretation of the given properties, optionally in a Deferred.</p>
</dd></dl>

</dd></dl>

</div>
<span id="document-developer/cls-iproperties"></span><div class="section" id="iproperties">
<span id="index-0"></span><h4>IProperties<a class="headerlink" href="#iproperties" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt>
<tt class="descname">buildbot.interfaces.IProperties::</tt></dt>
<dd><p>Providers of this interface allow get and set access to a build's properties.</p>
<dl class="method">
<dt id="getProperty">
<tt class="descname">getProperty</tt><big>(</big><em>propname</em>, <em>default=None</em><big>)</big><a class="headerlink" href="#getProperty" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a named property, returning the default value if the property is not found.</p>
</dd></dl>

<dl class="method">
<dt id="hasProperty">
<tt class="descname">hasProperty</tt><big>(</big><em>propname</em><big>)</big><a class="headerlink" href="#hasProperty" title="Permalink to this definition">¶</a></dt>
<dd><p>Determine whether the named property exists.</p>
</dd></dl>

<dl class="method">
<dt id="setProperty">
<tt class="descname">setProperty</tt><big>(</big><em>propname</em>, <em>value</em>, <em>source</em><big>)</big><a class="headerlink" href="#setProperty" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a property's value, also specifying the source for this value.</p>
</dd></dl>

<dl class="method">
<dt id="getProperties">
<tt class="descname">getProperties</tt><big>(</big><big>)</big><a class="headerlink" href="#getProperties" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a <tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.properties.Properties</span></tt> instance.  The
interface of this class is not finalized; where possible, use the other
<tt class="docutils literal"><span class="pre">IProperties</span></tt> methods.</p>
</dd></dl>

</dd></dl>

</div>
</div>
</div>
</div>
</div>
<span id="document-relnotes/index"></span><div class="section" id="release-notes-for-buildbot-version">
<h2>Release Notes for Buildbot 0.8.7<a class="headerlink" href="#release-notes-for-buildbot-version" title="Permalink to this headline">¶</a></h2>
<p>The following are the release notes for Buildbot 0.8.7.</p>
<div class="section" id="master">
<h3>Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h3>
<div class="section" id="features">
<h4>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Buildbot now supports building projects composed of multiple codebases.  New
schedulers can aggregate changes to multiple codebases into source stamp sets
(with one source stamp for each codebase).  Source steps then check out each
codebase as required, and the remainder of the build process proceeds
normally.  See the <a class="reference internal" href="#multiple-codebase-builds"><em>Multiple-Codebase Builds</em></a> for details.<ul>
<li>The format of the <tt class="docutils literal"><span class="pre">got_revision</span></tt> property has changed for multi-codebase builds.
It is now a dictionary keyed by codebase.</li>
</ul>
</li>
<li><tt class="docutils literal"><span class="pre">Source</span></tt> and <tt class="docutils literal"><span class="pre">ShellCommand</span></tt> steps now have an optional <tt class="docutils literal"><span class="pre">descriptionSuffix</span></tt>, a suffix to the
<tt class="docutils literal"><span class="pre">description</span></tt>/<tt class="docutils literal"><span class="pre">descriptionDone</span></tt> values. For example this can help distinguish between
multiple <tt class="docutils literal"><span class="pre">Compile</span></tt> steps that are applied to different codebases.</li>
<li>The <tt class="docutils literal"><span class="pre">Git</span></tt> step has a new <tt class="docutils literal"><span class="pre">getDescription</span></tt> option, which will run <tt class="docutils literal"><span class="pre">git</span> <span class="pre">describe</span></tt> after checkout
normally.  See <a class="reference internal" href="#step-Git" title="Git"><tt class="xref bb bb-step docutils literal"><span class="pre">Git</span></tt></a> for details.</li>
<li>A new interpolation placeholder <a class="reference internal" href="#interpolate"><em>Interpolate</em></a>, with more regular syntax, is available.</li>
<li>A new ternary substitution operator <tt class="docutils literal"><span class="pre">:?</span></tt> and <tt class="docutils literal"><span class="pre">:#?</span></tt> is available with the <tt class="docutils literal"><span class="pre">Interpolate</span></tt> class.</li>
<li><tt class="docutils literal"><span class="pre">IRenderable.getRenderingFor</span></tt> can now return a deferred.</li>
<li>The mercurial hook now supports multple masters.  See <a class="reference external" href="https://github.com/buildbot/buildbot/pull/436" title="pull request 436">pull request 436</a>.</li>
<li>There's a new poller for Mercurial: <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></tt></a>.</li>
<li>The new <tt class="docutils literal"><span class="pre">HTPasswdAprAuth</span></tt> uses libaprutil (through ctypes) to validate
the password against the hash from the .htpasswd file. This adds support for
all hash types htpasswd can generate.</li>
<li><tt class="docutils literal"><span class="pre">GitPoller</span></tt> has been rewritten.
It now supports multiple branches and can share a directory between multiple pollers.
It is also more resilient to changes in configuration, or in the underlying repository.</li>
<li>Added a new property <tt class="docutils literal"><span class="pre">httpLoginUrl</span></tt> to <tt class="docutils literal"><span class="pre">buildbot.status.web.authz.Authz</span></tt>
to render a nice Login link in WebStatus for unauthenticated users if
<tt class="docutils literal"><span class="pre">useHttpHeader</span></tt> and <tt class="docutils literal"><span class="pre">httpLoginUrl</span></tt> are set.</li>
<li><tt class="docutils literal"><span class="pre">ForceScheduler</span></tt> has been updated:<ul>
<li>support for multiple <a class="reference internal" href="#attr-codebase"><em>codebases</em></a> via the <tt class="docutils literal"><span class="pre">codebases</span></tt> parameter</li>
<li><tt class="docutils literal"><span class="pre">NestedParameter</span></tt> to provide a logical grouping of parameters.</li>
<li><tt class="docutils literal"><span class="pre">CodebaseParameter</span></tt> to set the branch/revision/repository/project for a codebase</li>
<li>new HTML/CSS customization points. Each parameter is contained in a <tt class="docutils literal"><span class="pre">row</span></tt> with multiple
'class' attributes associated with them (eg, 'force-string' and 'force-nested') as well as a unique
id to use with Javascript. Explicit line-breaks have been removed from the HTML generator and
are now controlled using CSS.</li>
</ul>
</li>
<li>The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> now supports multiple projects and codebases.
See <a class="reference external" href="https://github.com/buildbot/buildbot/pull/443" title="pull request 443">pull request 443</a>.</li>
<li>The <a class="reference internal" href="#status-MailNotifier" title="MailNotifier"><tt class="xref bb bb-status docutils literal"><span class="pre">MailNotifier</span></tt></a> now takes a callable to calculate the &quot;previous&quot; build for purposes of determining status changes.
See <a class="reference external" href="https://github.com/buildbot/buildbot/pull/489" title="pull request 489">pull request 489</a>.</li>
<li>The <tt class="docutils literal"><span class="pre">copy_properties</span></tt> parameter, given a list of properties to copy into the new build request, has been deprecated in favor of explicit use of <tt class="docutils literal"><span class="pre">set_properties</span></tt>.</li>
</ul>
</div>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h4>Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Buildbot master now requires at least Python-2.5 and Twisted-9.0.0.</p>
</li>
<li><p class="first">Buildbot master requires <tt class="docutils literal"><span class="pre">python-dateutil</span></tt> version 1.5 to support the
Nightly scheduler.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">ForceScheduler</span></tt> has been updated to support multiple <a class="reference internal" href="#attr-codebase"><em>codebases</em></a>.
The branch/revision/repository/project are deprecated; if you have customized these
values, simply provide them as <tt class="docutils literal"><span class="pre">codebases=[CodebaseParameter(name='',</span> <span class="pre">...)]</span></tt>.</p>
<blockquote>
<div><ul class="simple">
<li>The POST URL names for <tt class="docutils literal"><span class="pre">AnyPropertyParameter</span></tt> fields have changed. For example,
'property1name' is now 'property1_name', and 'property1value' is now 'property1_value'.
Please update any bookmarked or saved URL's that used these fields.</li>
<li><tt class="docutils literal"><span class="pre">forcesched.BaseParameter</span></tt> API has changed quite a bit and is no longer backwards
compatible. Updating guidelines:<ul>
<li><tt class="docutils literal"><span class="pre">get_from_post</span></tt> is renamed to <tt class="docutils literal"><span class="pre">getFromKwargs</span></tt></li>
<li><tt class="docutils literal"><span class="pre">update_from_post</span></tt> is renamed to <tt class="docutils literal"><span class="pre">updateFromKwargs</span></tt>. This function's parameters
are now called via named parameters to allow subclasses to ignore values it doesnt use.
Subclasses should add <tt class="docutils literal"><span class="pre">**unused</span></tt> for future compatibility. A new parameter
<tt class="docutils literal"><span class="pre">sourcestampset</span></tt> is provided to allow subclasses to modify the sourcestamp set, and
will probably require you to add the <tt class="docutils literal"><span class="pre">**unused</span></tt> field.</li>
</ul>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">The parameters to the callable version of <tt class="docutils literal"><span class="pre">build.workdir</span></tt> have changed.
Instead of a single sourcestamp, a list of sourcestamps is passed. Each
sourcestamp in the list has a different <a class="reference internal" href="#attr-codebase"><em>codebase</em></a></p>
</li>
<li><p class="first">The undocumented renderable <tt class="docutils literal"><span class="pre">_ComputeRepositoryURL</span></tt> is no longer imported to
<a class="reference internal" href="#module-buildbot.steps.source" title="buildbot.steps.source"><tt class="xref py py-mod docutils literal"><span class="pre">buildbot.steps.source</span></tt></a>. It is still available at
<tt class="xref py py-mod docutils literal"><span class="pre">buildbot.steps.source.oldsource</span></tt>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">IProperties.render</span></tt> now returns a deferred, so any code rendering properties
by hand will need to take this into account.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">baseURL</span></tt> has been removed in <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> to use just <tt class="docutils literal"><span class="pre">repourl</span></tt> - see
<a class="reference external" href="http://trac.buildbot.net/ticket/2066" title="bug #2066">bug #2066</a>. Branch info should be provided with <tt class="docutils literal"><span class="pre">Interpolate</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="kn">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">baseURL</span><span class="o">=</span><span class="s">&quot;svn://svn.example.org/svn/&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>can be replaced with</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">Interpolate</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="kn">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s">&quot;svn://svn.example.org/svn/%(src::branch)s&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="kn">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">baseURL</span><span class="o">=</span><span class="s">&quot;svn://svn.example.org/svn/</span><span class="si">%%</span><span class="s">BRANCH</span><span class="si">%%</span><span class="s">/project&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>can be replaced with</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">Interpolate</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="kn">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s">&quot;svn://svn.example.org/svn/%(src::branch)s/project&quot;</span><span class="p">)))</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="kn">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">baseURL</span><span class="o">=</span><span class="s">&quot;svn://svn.example.org/svn/&quot;</span><span class="p">,</span> <span class="n">defaultBranch</span><span class="o">=</span><span class="s">&quot;branches/test&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>can be replaced with</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">Interpolate</span>
<span class="kn">from</span> <span class="nn">buildbot.steps.source.svn</span> <span class="kn">import</span> <span class="n">SVN</span>
<span class="n">factory</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="n">Interpolate</span><span class="p">(</span><span class="s">&quot;svn://svn.example.org/svn/%(src::branch:-branches/test)s&quot;</span><span class="p">)))</span>
</pre></div>
</div>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">P4Sync</span></tt> step, deprecated since 0.8.5, has been removed.  The <tt class="docutils literal"><span class="pre">P4</span></tt> step remains.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">fetch_spec</span></tt> argument to <tt class="docutils literal"><span class="pre">GitPoller</span></tt> is no longer supported.
<tt class="docutils literal"><span class="pre">GitPoller</span></tt> now only downloads branches that it is polling, so specifies a refspec itself.</p>
</li>
<li><p class="first">The format of the changes produced by <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><tt class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></tt></a> has changed: directory pathnames end with a forward slash.
This allows the <tt class="docutils literal"><span class="pre">split_file</span></tt> function to distinguish between files and directories.
Customized split functions may need to be adjusted accordingly.</p>
</li>
<li><p class="first"><a class="reference internal" href="#withproperties"><em>WithProperties</em></a> has been deprecated in favor of <a class="reference internal" href="#interpolate"><em>Interpolate</em></a>.
<cite>Interpolate</cite> doesn't handle functions as keyword arguments.
The following code using <tt class="docutils literal"><span class="pre">WithProperties</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">WithProperties</span>
<span class="k">def</span> <span class="nf">determine_foo</span><span class="p">(</span><span class="n">props</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s">&#39;bar&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s">&#39;baz&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s">&#39;baz&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="s">&#39;qux&#39;</span>
<span class="n">WithProperties</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%(foo)s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">determine_foo</span><span class="p">)</span>
</pre></div>
</div>
<p>can be replaced with</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">zope.interface</span> <span class="kn">import</span> <span class="n">implementer</span>
<span class="kn">from</span> <span class="nn">buildbot.interfaces</span> <span class="kn">import</span> <span class="n">IRenderable</span>
<span class="kn">from</span> <span class="nn">buildbot.process.properties</span> <span class="kn">import</span> <span class="n">Interpolate</span>
<span class="nd">@implementer</span><span class="p">(</span><span class="n">IRenderable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">determineFoo</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">getRenderingFor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s">&#39;bar&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s">&#39;bar&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">props</span><span class="o">.</span><span class="n">hasProperty</span><span class="p">(</span><span class="s">&#39;baz&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">props</span><span class="p">[</span><span class="s">&#39;baz&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s">&#39;qux&#39;</span>
<span class="n">Interpolate</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">(kw:foo)s&#39;</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="n">determineFoo</span><span class="p">())</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h4>Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">BuildStep.start</span></tt> can now optionally return a deferred and any errback will
be handled gracefully. If you use <tt class="docutils literal"><span class="pre">inlineCallbacks</span></tt>, this means that unexpected
exceptions and failures raised will be captured and logged and the build shut
down normally.</li>
<li>The helper methods <tt class="docutils literal"><span class="pre">getState</span></tt> and <tt class="docutils literal"><span class="pre">setState</span></tt> from <tt class="docutils literal"><span class="pre">BaseScheduler</span></tt> have
been factored into <tt class="docutils literal"><span class="pre">buildbot.util.state.StateMixin</span></tt> for use elsewhere.</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h3>Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
</div>
<div class="section" id="id2">
<h4>Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">P4Sync</span></tt> step, deprecated since 0.8.5, has been removed.  The <tt class="docutils literal"><span class="pre">P4</span></tt> step remains.</li>
</ul>
</div>
</div>
<div class="section" id="details">
<h3>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h3>
<p>For a more detailed description of the changes made in this version, see the
git log itself:</p>
<blockquote>
<div>git log v0.8.6..v0.8.7</div></blockquote>
</div>
<div class="section" id="older-versions">
<h3>Older Versions<a class="headerlink" href="#older-versions" title="Permalink to this headline">¶</a></h3>
<p>Release notes for older versions of Buildbot are available in the <a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/docs/release-notes/" title="master/docs/release-notes/"><tt class="docutils literal"><span class="pre">master/docs/release-notes/</span></tt></a> directory of the source tree.
Newer versions are also available here:</p>
<div class="toctree-wrapper compound">
<span id="document-relnotes/0.8.6"></span><div class="section" id="release-notes-for-buildbot-v0-8-6p1">
<h4>Release Notes for Buildbot v0.8.6p1<a class="headerlink" href="#release-notes-for-buildbot-v0-8-6p1" title="Permalink to this headline">¶</a></h4>
<p>The following are the release notes for Buildbot v0.8.6p1.
Buildbot v0.8.6 was released on March 11, 2012.
Buildbot v0.8.6p1 was released on March 25, 2012.</p>
<div class="section" id="p1">
<h5>0.8.6p1<a class="headerlink" href="#p1" title="Permalink to this headline">¶</a></h5>
<p>In addition to what's listed below, the 0.8.6p1 release adds the following.</p>
<ul class="simple">
<li>Builders are no longer displayed in the order they were configured.  This was
never intended behavior, and will become impossible in the distributed
architecture planned for Buildbot-0.9.x.  As of 0.8.6p1, builders are sorted
naturally: lexically, but with numeric segments sorted numerically.</li>
<li>Slave properties in the configuration are now handled correctly.</li>
<li>The web interface buttons to cancel individual builds now appear when
configured.</li>
<li>The ForceScheduler's properties are correctly updated on reconfig -
<a class="reference external" href="http://trac.buildbot.net/ticket/2248" title="bug #2248">bug #2248</a>.</li>
<li>If a slave is lost while waiting for locks, it is properly cleaned up -
<a class="reference external" href="http://trac.buildbot.net/ticket/2247" title="bug #2247">bug #2247</a>.</li>
<li>Crashes when adding new steps to a factory in a reconfig are fixed -
<a class="reference external" href="http://trac.buildbot.net/ticket/2252" title="bug #2252">bug #2252</a>.</li>
<li>MailNotifier AttributeErrors are fixed - <a class="reference external" href="http://trac.buildbot.net/ticket/2254" title="bug #2254">bug #2254</a>.</li>
<li>Cleanup from failed builds is improved - <a class="reference external" href="http://trac.buildbot.net/ticket/2253" title="bug #2253">bug #2253</a>.</li>
</ul>
</div>
<div class="section" id="master">
<h5>Master<a class="headerlink" href="#master" title="Permalink to this headline">¶</a></h5>
<ul class="simple">
<li>If you are using the github hook, carefully consider the security
implications of allowing un-authenticated change requests, which can
potentially build arbitrary code.  See <a class="reference external" href="http://trac.buildbot.net/ticket/2186" title="bug #2186">bug #2186</a>.</li>
</ul>
<div class="section" id="deprecations-removals-and-non-compatible-changes">
<h6>Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#deprecations-removals-and-non-compatible-changes" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">Forced builds now require that a <a class="reference internal" href="#sched-ForceScheduler" title="ForceScheduler"><tt class="xref bb bb-sched docutils literal"><span class="pre">ForceScheduler</span></tt></a> be defined in the
Buildbot configuration.  For compatible behavior, this should look like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">buildbot.schedulers.forcesched</span> <span class="kn">import</span> <span class="n">ForceScheduler</span>
<span class="n">c</span><span class="p">[</span><span class="s">&#39;schedulers&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ForceScheduler</span><span class="p">(</span>
                        <span class="n">name</span><span class="o">=</span><span class="s">&quot;force&quot;</span><span class="p">,</span>
                        <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;b1&quot;</span><span class="p">,</span> <span class="s">&quot;b2&quot;</span><span class="p">,</span> <span class="o">...</span> <span class="p">]))</span>
</pre></div>
</div>
<p>Where all of the builder names in the configuration are listed.  See the
documentation for the <em>much</em> more flexiblie configuration options now
available.</p>
</li>
<li><p class="first">This is the last release of Buildbot that will be compatible with Python 2.4.
The next version will minimally require Python-2.5.  See <a class="reference external" href="http://trac.buildbot.net/ticket/2157" title="bug #2157">bug #2157</a>.</p>
</li>
<li><p class="first">This is the last release of Buildbot that will be compatible with
Twisted-8.x.y.  The next version will minimally require Twisted-9.0.0.  See
<a class="reference external" href="http://trac.buildbot.net/ticket/2182" title="bug #2182">bug #2182</a>.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">start</span></tt> no longer invokes make if a <tt class="docutils literal"><span class="pre">Makefile.buildbot</span></tt> exists.
If you are using this functionality, consider invoking make directly.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">buildbot</span> <span class="pre">sendchange</span></tt> option <tt class="docutils literal"><span class="pre">--username</span></tt> has been removed as
promised in <a class="reference external" href="http://trac.buildbot.net/ticket/1711" title="bug #1711">bug #1711</a>.</p>
</li>
<li><p class="first">StatusReceivers' checkConfig method should now take an additional <cite>errors</cite>
parameter and call its <a class="reference internal" href="#buildbot.config.ConfigErrors.addError" title="buildbot.config.ConfigErrors.addError"><tt class="xref py py-meth docutils literal"><span class="pre">addError</span></tt></a>
method to indicate errors.</p>
</li>
<li><p class="first">The gerrit status callback now gets an additional parameter (the master
status).  If you use this callback, you will need to adjust its
implementation.</p>
</li>
<li><p class="first">SQLAlchemy-Migrate version 0.6.0 is no longer supported.  See
<a class="reference internal" href="#buildmaster-requirements"><em>Buildmaster Requirements</em></a>.</p>
</li>
<li><p class="first">Older versions of SQLite which could limp along for previous versions of
Buildbot are no longer supported.  The minimum version is 3.4.0, and 3.7.0 or
higher is recommended.</p>
</li>
<li><p class="first">The master-side Git step now checks out 'HEAD' by default, rather than
master, which translates to the default branch on the upstream repository.  See
<a class="reference external" href="https://github.com/buildbot/buildbot/pull/301" title="pull request 301">pull request 301</a>.</p>
</li>
<li><p class="first">The format of the repository strings created by <tt class="docutils literal"><span class="pre">hgbuildbot</span></tt> has changed to
contain the entire repository URL, based on the <tt class="docutils literal"><span class="pre">web.baseurl</span></tt> value in
<tt class="docutils literal"><span class="pre">hgrc</span></tt>.  To continue the old (incorrect) behavior, set
<tt class="docutils literal"><span class="pre">hgbuildbot.baseurl</span></tt> to an empty string as suggested in <a class="reference internal" href="#mercurial-hook"><em>the Buildbot
manual</em></a>.</p>
</li>
<li><p class="first">Master Side <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> Step has been corrected to properly use
<tt class="docutils literal"><span class="pre">--revision</span></tt> when <tt class="docutils literal"><span class="pre">alwaysUseLatest</span></tt> is set to <tt class="docutils literal"><span class="pre">False</span></tt> when in the
<tt class="docutils literal"><span class="pre">full</span></tt> mode. See <a class="reference external" href="http://trac.buildbot.net/ticket/2194" title="bug #2194">bug #2194</a></p>
</li>
<li><p class="first">Master Side <a class="reference internal" href="#step-SVN" title="SVN"><tt class="xref bb bb-step docutils literal"><span class="pre">SVN</span></tt></a> Step paramater svnurl has been renamed repourl, to
be consistent with other master-side source steps.</p>
</li>
<li><p class="first">Master Side <a class="reference internal" href="#step-Mercurial" title="Mercurial"><tt class="xref bb bb-step docutils literal"><span class="pre">Mercurial</span></tt></a> step parameter <tt class="docutils literal"><span class="pre">baseURL</span></tt> has been merged
with <tt class="docutils literal"><span class="pre">repourl</span></tt> parameter. The behavior of the step is already controled by
<tt class="docutils literal"><span class="pre">branchType</span></tt> parameter, so just use a single argument to specify the repository.</p>
</li>
<li><p class="first">Passing a <a class="reference internal" href="#buildbot.process.buildstep.BuildStep" title="buildbot.process.buildstep.BuildStep"><tt class="xref py py-class docutils literal"><span class="pre">buildbot.process.buildstep.BuildStep</span></tt></a> subclass (rather than
instance) to <tt class="xref py py-meth docutils literal"><span class="pre">buildbot.process.factory.BuildFactory.addStep</span></tt> has long been
deprecated, and will be removed in version 0.8.7.</p>
</li>
<li><p class="first">The <cite>hgbuildbot</cite> tool now defaults to the 'inrepo' branch type.  Users who do
not explicitly set a branch type would previously have seen empty branch strings,
and will now see a branch string based on the branch in the repository (e.g.,
<cite>default</cite>).</p>
</li>
</ul>
</div>
<div class="section" id="changes-for-developers">
<h6>Changes for Developers<a class="headerlink" href="#changes-for-developers" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>The interface for runtime access to the master's configuration has changed
considerably.  See <a class="reference internal" href="#document-developer/config"><em>Configuration</em></a> for more details.</li>
<li>The DB connector methods <tt class="docutils literal"><span class="pre">completeBuildset</span></tt>, <tt class="docutils literal"><span class="pre">completeBuildRequest</span></tt>, and
<tt class="docutils literal"><span class="pre">claimBuildRequest</span></tt> now take an optional <tt class="docutils literal"><span class="pre">complete_at</span></tt> parameter to
specify the completion time explicitly.</li>
<li>Buildbot now sports sourcestamp sets, which collect multiple sourcestamps
used to generate a single build, thanks to Harry Borkhuis.  See
<a class="reference external" href="https://github.com/buildbot/buildbot/pull/287" title="pull request 287">pull request 287</a>.</li>
<li>Schedulers no longer have a <tt class="docutils literal"><span class="pre">schedulerid</span></tt>, but rather an <tt class="docutils literal"><span class="pre">objectid</span></tt>.  In
a related change, the <tt class="docutils literal"><span class="pre">schedulers</span></tt> table has been removed, along with the
<tt class="xref py py-meth docutils literal"><span class="pre">buildbot.db.schedulers.SchedulersConnectorComponent.getSchedulerId</span></tt>
method.</li>
<li>The Dependent scheduler tracks its upstream buildsets using
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.db.schedulers.StateConnectorComponent</span></tt>, so the
<tt class="docutils literal"><span class="pre">scheduler_upstream_buildsets</span></tt> table has been removed, along with
corresponding (undocumented)
<tt class="xref py py-class docutils literal"><span class="pre">buildbot.db.buildsets.BuildsetsConnector</span></tt> methods.</li>
<li>Errors during configuration (in particular in <tt class="xref py py-class docutils literal"><span class="pre">BuildStep</span></tt> constructors),
should be reported by calling <a class="reference internal" href="#buildbot.config.error" title="buildbot.config.error"><tt class="xref py py-func docutils literal"><span class="pre">buildbot.config.error</span></tt></a>.</li>
</ul>
</div>
<div class="section" id="features">
<h6>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h6>
<ul>
<li><p class="first">The IRC status bot now display build status in colors by default.
It is controllable and may be disabled with useColors=False in constructor.</p>
</li>
<li><p class="first">Buildbot can now take advantage of authentication done by a front-end web
server - see <a class="reference external" href="https://github.com/buildbot/buildbot/pull/266" title="pull request 266">pull request 266</a>.</p>
</li>
<li><p class="first">Buildbot supports a simple cookie-based login system, so users no longer need
to enter a username and password for every request.  See the earlier commits
in <a class="reference external" href="https://github.com/buildbot/buildbot/pull/278" title="pull request 278">pull request 278</a>.</p>
</li>
<li><p class="first">The master-side SVN step now has an <cite>export</cite> method which is similar to
<cite>copy</cite>, but the build directory does not contain Subversion metdata. (<a class="reference external" href="http://trac.buildbot.net/ticket/2078" title="bug #2078">bug #2078</a>)</p>
</li>
<li><p class="first"><tt class="xref py py-class docutils literal"><span class="pre">Property</span></tt> instances will now render any properties in the
default value if necessary.  This makes possible constructs like</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">command</span><span class="o">=</span><span class="n">Property</span><span class="p">(</span><span class="s">&#39;command&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">Property</span><span class="p">(</span><span class="s">&#39;default-command&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first">Buildbot has a new web hook to handle push notifications from Google Code -
see <a class="reference external" href="https://github.com/buildbot/buildbot/pull/278" title="pull request 278">pull request 278</a>.</p>
</li>
<li><p class="first">Revision links are now generated by a flexible runtime conversion configured
by <a class="reference internal" href="#cfg-revlink" title="revlink"><tt class="xref bb bb-cfg docutils literal"><span class="pre">revlink</span></tt></a> - see <a class="reference external" href="https://github.com/buildbot/buildbot/pull/280" title="pull request 280">pull request 280</a>.</p>
</li>
<li><p class="first">Shell command steps will now &quot;flatten&quot; nested lists in the <tt class="docutils literal"><span class="pre">command</span></tt>
argument.  This allows substitution of multiple command-line arguments using
properties.  See <a class="reference external" href="http://trac.buildbot.net/ticket/2150" title="bug #2150">bug #2150</a>.</p>
</li>
<li><p class="first">Steps now take an optional <tt class="docutils literal"><span class="pre">hideStepIf</span></tt> parameter to suppress the step
from the waterfall and build details in the web. (<a class="reference external" href="http://trac.buildbot.net/ticket/1743" title="bug #1743">bug #1743</a>)</p>
</li>
<li><p class="first"><tt class="xref py py-class docutils literal"><span class="pre">Trigger</span></tt> steps with <tt class="docutils literal"><span class="pre">waitForFinish=True</span></tt> now receive a URL to
all the triggered builds. This URL is displayed in the waterfall and build
details. See <a class="reference external" href="http://trac.buildbot.net/ticket/2170" title="bug #2170">bug #2170</a>.</p>
</li>
<li><p class="first">The <a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/contrib/fakemaster.py`" title="master/contrib/fakemaster.py`"><tt class="docutils literal"><span class="pre">master/contrib/fakemaster.py`</span></tt></a> script allows you to run arbitrary
commands on a slave by emulating a master.  See the file itself for
documentation.</p>
</li>
<li><p class="first">MailNotifier allows multiple notification modes in the same instance.  See
<a class="reference external" href="http://trac.buildbot.net/ticket/2205" title="bug #2205">bug #2205</a>.</p>
</li>
<li><p class="first">SVNPoller now allows passing extra arguments via argument <tt class="docutils literal"><span class="pre">extra_args</span></tt>.
See <a class="reference external" href="http://trac.buildbot.net/ticket/1766" title="bug #1766">bug #1766</a></p>
</li>
</ul>
</div>
</div>
<div class="section" id="slave">
<h5>Slave<a class="headerlink" href="#slave" title="Permalink to this headline">¶</a></h5>
<div class="section" id="id1">
<h6>Deprecations, Removals, and Non-Compatible Changes<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h6>
<ul class="simple">
<li>BitKeeper support is in the &quot;Last-Rites&quot; state, and will be removed in the
next version unless a maintainer steps forward.</li>
</ul>
</div>
<div class="section" id="id2">
<h6>Features<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h6>
</div>
</div>
<div class="section" id="details">
<h5>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h5>
<p>For a more detailed description of the changes made in this version, see the
git log itself:</p>
<blockquote>
<div>git log buildbot-0.8.5..buildbot-0.8.6</div></blockquote>
</div>
<div class="section" id="older-versions">
<h5>Older Versions<a class="headerlink" href="#older-versions" title="Permalink to this headline">¶</a></h5>
<p>Release notes for older versions of Buildbot are available in the
<a class="reference external" href="https://github.com/buildbot/buildbot/blob/master/master/docs/release-notes/" title="master/docs/release-notes/"><tt class="docutils literal"><span class="pre">master/docs/release-notes/</span></tt></a> directory of the source tree, or in the archived
documentation for those versions at <a class="reference external" href="http://buildbot.net/buildbot/docs">http://buildbot.net/buildbot/docs</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h2>Indices and Tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="bb-cfg.html" title="Buildmaster Configuration Index"><em>Buildmaster Configuration Index</em></a></li>
<li><a class="reference internal" href="bb-sched.html" title="Scheduler Index"><em>Scheduler Index</em></a></li>
<li><a class="reference internal" href="bb-chsrc.html" title="Change Source Index"><em>Change Source Index</em></a></li>
<li><a class="reference internal" href="bb-step.html" title="Build Step Index"><em>Build Step Index</em></a></li>
<li><a class="reference internal" href="bb-status.html" title="Status Target Index"><em>Status Target Index</em></a></li>
<li><a class="reference internal" href="bb-cmdline.html" title="Command Line Index"><em>Command Line Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>
<div class="section" id="copyright">
<h2>Copyright<a class="headerlink" href="#copyright" title="Permalink to this headline">¶</a></h2>
<p>Copyright Buildbot Team Members</p>
<p>Copying and distribution of this file, with or without modification, are
permitted in any medium without royalty provided the copyright notice and this
notice are preserved.</p>
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
<h3>Table Of Contents</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-tutorial/index">Buildbot Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-manual/index">Buildbot Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-developer/index">Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-relnotes/index">Release Notes for Buildbot 0.8.7</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer-wrapper">
      <div class="footer">
        <div class="left">
        </div>

        <div class="right">
          
    <div class="footer">
        &copy; Copyright Buildbot Team Members.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

  </body>
</html>