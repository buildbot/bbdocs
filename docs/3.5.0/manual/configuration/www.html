<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.5.15. Web Server &mdash; Buildbot 3.5.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/buildbot_rtd.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/icon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.5.16. Change Hooks" href="wwwhooks.html" />
    <link rel="prev" title="2.5.14.17. ZulipStatusPush" href="reporters/zulip_status.html" /> 
<!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Buildbot
            <img src="../../_static/full_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="workers.html">2.5.6. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildfactories.html">2.5.8. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsets.html">2.5.9. Build Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="properties.html">2.5.10. Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="steps/index.html">2.5.11. Build Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="interlocks.html">2.5.12. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="report_generators/index.html">2.5.13. Report Generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="reporters/index.html">2.5.14. Reporters</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.5.15. Web Server</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ui-plugins">2.5.15.1. UI plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#authentication-plugins">2.5.15.2. Authentication plugins</a></li>
<li class="toctree-l4"><a class="reference internal" href="#user-information">2.5.15.3. User Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reverse-proxy-configuration">2.5.15.4. Reverse Proxy Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#authorization-rules">2.5.15.5. Authorization rules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="wwwhooks.html">2.5.16. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="services/index.html">2.5.17. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbconfig.html">2.5.18. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="configurators.html">2.5.19. Configurators</a></li>
<li class="toctree-l3"><a class="reference internal" href="manhole.html">2.5.20. Manhole</a></li>
<li class="toctree-l3"><a class="reference internal" href="multimaster.html">2.5.21. Multimaster</a></li>
<li class="toctree-l3"><a class="reference internal" href="multicodebase.html">2.5.22. Multiple-Codebase Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc/index.html">2.5.23. Miscellaneous Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="tests/index.html">2.5.24. Testing Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relnotes/index.html">4. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relnotes/index.html#older-release-notes">5. Older Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices.html">6. API Indices</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Buildbot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a> &raquo;</li>
          <li><a href="index.html"><span class="section-number">2.5. </span>Configuration</a> &raquo;</li>
      <li><span class="section-number">2.5.15. </span>Web Server</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/manual/configuration/www.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Buildbot no longer supports Python 2.7 on the Buildbot master.</p>
</div>
<div class="section" id="web-server">
<span id="cfg-www"></span><h1><span class="section-number">2.5.15. </span>Web Server<a class="headerlink" href="#web-server" title="Permalink to this headline"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of Buildbot 0.9.0, the built-in web server replaces the old <code class="docutils literal notranslate"><span class="pre">WebStatus</span></code> plugin.</p>
</div>
<p>Buildbot contains a built-in web server.
This server is configured with the <code class="docutils literal notranslate"><span class="pre">www</span></code> configuration key, which specifies a dictionary with the following keys:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt><dd><p>The TCP port on which to serve requests.
It might be an integer or any string accepted by <a class="reference external" href="https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.html#serverFromString">serverFromString</a> (ex: “<a class="reference external" href="tcp:8010:interface=127.0.0.1">tcp:8010:interface=127.0.0.1</a>” to listen on another interface).
Note that SSL is not supported.
To host Buildbot with SSL, use an HTTP proxy such as lighttpd, nginx, or Apache.
If this is <code class="docutils literal notranslate"><span class="pre">None</span></code> (the default), then the master will not implement a web server.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">json_cache_seconds</span></code></dt><dd><p>The number of seconds into the future at which an HTTP API response should expire.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rest_minimum_version</span></code></dt><dd><p>The minimum supported REST API version.
Any versions less than this value will not be available.
This can be used to ensure that no clients are depending on API versions that will soon be removed from Buildbot.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">plugins</span></code></dt><dd><p>This key gives a dictionary of additional UI plugins to load, along with configuration for those plugins.
These plugins must be separately installed in the Python environment, e.g., <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">buildbot-waterfall-view</span></code>.
See <a class="reference internal" href="#ui-plugins"><span class="std std-ref">UI plugins</span></a>.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;waterfall_view&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">default_page</span></code></dt><dd><p>Configure the default landing page of the web server, for example, to forward directly to another plugin. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;default_page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;console&#39;</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">debug</span></code></dt><dd><p>If true, then debugging information will be output to the browser.
This is best set to false (the default) on production systems, to avoid the possibility of information leakage.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">allowed_origins</span></code></dt><dd><p>This gives a list of origins which are allowed to access the Buildbot API (including control via JSONRPC 2.0).
It implements cross-origin request sharing (CORS), allowing pages at origins other than the Buildbot UI to use the API.
Each origin is interpreted as filename match expression, with <code class="docutils literal notranslate"><span class="pre">?</span></code> matching one character and <code class="docutils literal notranslate"><span class="pre">*</span></code> matching anything.
Thus <code class="docutils literal notranslate"><span class="pre">['*']</span></code> will match all origins, and <code class="docutils literal notranslate"><span class="pre">['https://*.buildbot.net']</span></code> will match secure sites under <code class="docutils literal notranslate"><span class="pre">buildbot.net</span></code>.
The Buildbot UI will operate correctly without this parameter; it is only useful for allowing access from other web applications.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">auth</span></code></dt><dd><p>Authentication module to use for the web server.
See <a class="reference internal" href="#web-authentication"><span class="std std-ref">Authentication plugins</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">avatar_methods</span></code></dt><dd><p>List of methods that can be used to get avatar pictures to use for the web server.
By default, Buildbot uses Gravatar to get images associated with each users, if you want to disable this you can just specify empty list:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;avatar_methods&#39;</span><span class="p">:</span> <span class="p">[]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You could also use the GitHub user avatar if GitHub authentication is enabled:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;avatar_methods&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">AvatarGitHub</span><span class="p">()]</span>
<span class="p">}</span>
</pre></div>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="AvatarGitHub">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">AvatarGitHub</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">github_api_endpoint</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">token</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verify</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#AvatarGitHub" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>github_api_endpoint</strong> (<em>string</em>) – specify the github api endpoint if you work with GitHub Enterprise</p></li>
<li><p><strong>token</strong> (<em>string</em>) – a GitHub API token to execute all requests to the API authenticated. It is strongly recommended to use a API token since it increases GitHub API rate limits significantly</p></li>
<li><p><strong>client_id</strong> (<em>string</em>) – a GitHub OAuth client ID to use with client secret to execute all requests to the API authenticated in place of token</p></li>
<li><p><strong>client_secret</strong> (<em>string</em>) – a GitHub OAuth client secret to use with client ID above</p></li>
<li><p><strong>debug</strong> (<em>boolean</em>) – logs every requests and their response</p></li>
<li><p><strong>verify</strong> (<em>boolean</em>) – disable ssl verification for the case you use temporary self signed certificates on a GitHub Enterprise installation</p></li>
</ul>
</dd>
</dl>
<p>This class requires <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> package to allow interaction with GitHub REST API.</p>
</dd></dl>

</dd>
</dl>
<blockquote>
<div><p>For use of corporate pictures, you can use LdapUserInfo, which can also act as an avatar provider.
See <a class="reference internal" href="#web-authentication"><span class="std std-ref">Authentication plugins</span></a>.</p>
</div></blockquote>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">logfileName</span></code></dt><dd><p>Filename used for HTTP access logs, relative to the master directory.
If set to <code class="docutils literal notranslate"><span class="pre">None</span></code> or the empty string, the content of the logs will land in the main <code class="file docutils literal notranslate"><span class="pre">twisted.log</span></code> log file.
(Defaults to <code class="docutils literal notranslate"><span class="pre">http.log</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logRotateLength</span></code></dt><dd><p>The amount of bytes after which the <code class="file docutils literal notranslate"><span class="pre">http.log</span></code> file will be rotated.
(Defaults to the same value as for the <code class="file docutils literal notranslate"><span class="pre">twisted.log</span></code> file, set in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxRotatedFiles</span></code></dt><dd><p>The amount of log files that will be kept when rotating
(Defaults to the same value as for the <code class="file docutils literal notranslate"><span class="pre">twisted.log</span></code> file, set in <code class="file docutils literal notranslate"><span class="pre">buildbot.tac</span></code>)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">versions</span></code></dt><dd><p>Custom component versions that you’d like to display on the About page.
Buildbot will automatically prepend the versions of Python, twisted and Buildbot itself to the list.</p>
<p><code class="docutils literal notranslate"><span class="pre">versions</span></code> should be a list of tuples. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;versions&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;master.cfg&#39;</span><span class="p">,</span> <span class="s1">&#39;0.1&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;OS&#39;</span><span class="p">,</span> <span class="s1">&#39;Ubuntu 14.04&#39;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The first element of a tuple stands for the name of the component, the second stands for the corresponding version.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">custom_templates_dir</span></code></dt><dd><p>This directory will be parsed for custom angularJS templates to replace the one of the original website templates.
You can use this to slightly customize buildbot look for your project, but to add any logic, you will need to create a full-blown plugin.
If the directory string is relative, it will be joined to the master’s basedir.
Buildbot uses the jade file format natively (which has been renamed to ‘pug’ in the nodejs ecosystem), but you can also use HTML format if you prefer.</p>
<p>Either <code class="docutils literal notranslate"><span class="pre">*.jade</span></code> files or <code class="docutils literal notranslate"><span class="pre">*.html</span></code> files can be used to override templates with the same name in the UI.
On the regular nodejs UI build system, we use nodejs’s pug module to compile jade into html.
For custom_templates, we use the pypugjs interpreter to parse the jade templates, before sending them to the UI.
<code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pypugjs</span></code> is required to use jade templates.
You can also override plugin’s directives, but they have to be in another directory, corresponding to the plugin’s name in its <code class="docutils literal notranslate"><span class="pre">package.json</span></code>.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># replace the template whose source is in:
# www/base/src/app/builders/build/build.tpl.jade
build.jade  # here we use a jade (aka pug) file

# replace the template whose source is in
# www/console_view/src/module/view/builders-header/console.tpl.jade
console_view/console.html  # here we use html format
</pre></div>
</div>
<p>Known differences between nodejs’s pug and pyjade:</p>
<blockquote>
<div><ul class="simple">
<li><p>quotes in attributes are not quoted (<a class="reference external" href="https://github.com/syrusakbary/pyjade/issues/132">https://github.com/syrusakbary/pyjade/issues/132</a>).
This means you should use double quotes for attributes, e.g.: <code class="docutils literal notranslate"><span class="pre">tr(ng-repeat=&quot;br</span> <span class="pre">in</span> <span class="pre">buildrequests</span> <span class="pre">|</span> <span class="pre">orderBy:'-submitted_at'&quot;)</span></code></p></li>
<li><p>pypugjs may have some differences but it is a maintained fork of pyjade. <a class="reference external" href="https://github.com/kakulukia/pypugjs">https://github.com/kakulukia/pypugjs</a></p></li>
</ul>
</div></blockquote>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">change_hook_dialects</span></code></dt><dd><p>See <a class="reference internal" href="wwwhooks.html#change-hooks"><span class="std std-ref">Change Hooks</span></a>.</p>
</dd>
</dl>
<p><code class="docutils literal notranslate"><span class="pre">cookie_expiration_time</span></code></p>
<blockquote>
<div><p>This allows to define the timeout of the session cookie.
Should be a <a class="reference external" href="https://docs.python.org/2/library/datetime.html#timedelta-objects">datetime.timedelta</a>.
Default is one week.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;cookie_expiration_time&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ui_default_config</span></code></p>
<blockquote>
<div><p>Settings in the settings page are stored per browser.
This configuration parameter allows to override the default settings for all your users.
If a user already has changed a value from the default, this will have no effect to them.
The settings page in the UI will tell you what to insert in your master.cfg to reproduce the configuration you have in your own browser.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;ui_default_config&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Builders.buildFetchLimit&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>
    <span class="s1">&#39;Workers.showWorkerBuilders&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">ws_ping_interval</span></code></p>
<blockquote>
<div><p>Send websocket pings every <code class="docutils literal notranslate"><span class="pre">ws_ping_interval</span></code> seconds.
This is useful to avoid websocket timeouts when using reverse proxies or CDNs.
If the value is 0 (the default), pings are disabled.</p>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference internal" href="global.html#cfg-buildbotURL" title="buildbotURL"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">buildbotURL</span></code></a> configuration value gives the base URL that all masters will use to generate links.
The <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span></code></a> configuration gives the settings for the webserver.
In simple cases, the <code class="docutils literal notranslate"><span class="pre">buildbotURL</span></code> contains the hostname and port of the master, e.g., <code class="docutils literal notranslate"><span class="pre">http://master.example.com:8010/</span></code>.
In more complex cases, with multiple masters, web proxies, or load balancers, the correspondence may be less obvious.</p>
</div>
<div class="section" id="ui-plugins">
<span id="id1"></span><h2><span class="section-number">2.5.15.1. </span>UI plugins<a class="headerlink" href="#ui-plugins" title="Permalink to this headline"></a></h2>
<div class="section" id="waterfall-view">
<span id="waterfallview"></span><h3>Waterfall View<a class="headerlink" href="#waterfall-view" title="Permalink to this headline"></a></h3>
<p>Waterfall shows the whole Buildbot activity in a vertical time line.
Builds are represented with boxes whose height vary according to their duration.
Builds are sorted by builders in the horizontal axes, which allows you to see how builders are scheduled together.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-waterfall-view
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;waterfall_view&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Waterfall is the emblematic view of Buildbot Eight.
It allowed to see the whole Buildbot activity very quickly.
Waterfall however had big scalability issues, and larger installs had to disable the page in order to avoid tens of seconds master hang because of a big waterfall page rendering.
The whole Buildbot Eight internal status API has been tailored in order to make Waterfall possible.
This is not the case anymore with Buildbot Nine, which has a more generic and scalable <a class="reference internal" href="../../developer/data.html#data-api"><span class="std std-ref">Data API</span></a> and <a class="reference internal" href="../../developer/rest.html#rest-api"><span class="std std-ref">REST API</span></a>.
This is the reason why Waterfall does not display the steps details anymore.
However nothing is impossible.
We could make a specific REST api available to generate all the data needed for waterfall on the server.
Please step-in if you want to help improve the Waterfall view.</p>
</div>
</div>
<div class="section" id="console-view">
<span id="consoleview"></span><h3>Console View<a class="headerlink" href="#console-view" title="Permalink to this headline"></a></h3>
<p>Console view shows the whole Buildbot activity arranged by changes as discovered by <a class="reference internal" href="changesources.html#change-sources"><span class="std std-ref">Change Sources and Changes</span></a> vertically and builders horizontally.
If a builder has no build in the current time range, it will not be displayed.
If no change is available for a build, then it will generate a fake change according to the <code class="docutils literal notranslate"><span class="pre">got_revision</span></code> property.</p>
<p>Console view will also group the builders by tags.
When there are several tags defined per builders, it will first group the builders by the tag that is defined for most builders.
Then given those builders, it will group them again in another tag cluster.
In order to keep the UI usable, you have to keep your tags short!</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-console-view
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;console_view&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Nine’s Console View is the equivalent of Buildbot Eight’s Console and tgrid views.
Unlike Waterfall, we think it is now feature equivalent and even better, with its live update capabilities.
Please submit an issue if you think there is an issue displaying your data, with screen shots of what happen and suggestion on what to improve.</p>
</div>
</div>
<div class="section" id="grid-view">
<span id="gridview"></span><h3>Grid View<a class="headerlink" href="#grid-view" title="Permalink to this headline"></a></h3>
<p>Grid view shows the whole Buildbot activity arranged by builders vertically and changes horizontally.
It is equivalent to Buildbot Eight’s grid view.</p>
<p>By default, changes on all branches are displayed but only one branch may be filtered by the user.
Builders can also be filtered by tags.
This feature is similar to the one in the builder list.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-grid-view
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;grid_view&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="badges">
<span id="id2"></span><h3>Badges<a class="headerlink" href="#badges" title="Permalink to this headline"></a></h3>
<p>Buildbot badges plugin produces an image in SVG or PNG format with information about the last build for the given builder name.
PNG generation is based on the <a class="reference external" href="https://www.cairographics.org/">CAIRO</a> SVG engine, it requires a bit more CPU to generate.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install buildbot-badges
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;badges&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>You can the access your builder’s badges using urls like <code class="docutils literal notranslate"><span class="pre">http://&lt;buildbotURL&gt;/badges/&lt;buildername&gt;.svg</span></code>.
The default templates are very much configurable via the following options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;left_pad&quot;</span>  <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;left_text&quot;</span><span class="p">:</span> <span class="s2">&quot;Build Status&quot;</span><span class="p">,</span>  <span class="c1"># text on the left part of the image</span>
    <span class="s2">&quot;left_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#555&quot;</span><span class="p">,</span>  <span class="c1"># color of the left part of the image</span>
    <span class="s2">&quot;right_pad&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
    <span class="s2">&quot;border_radius&quot;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="c1"># Border Radius on flat and plastic badges</span>
    <span class="c1"># style of the template availables are &quot;flat&quot;, &quot;flat-square&quot;, &quot;plastic&quot;</span>
    <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;plastic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;template_name&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{style}</span><span class="s2">.svg.j2&quot;</span><span class="p">,</span>  <span class="c1"># name of the template</span>
    <span class="s2">&quot;font_face&quot;</span><span class="p">:</span> <span class="s2">&quot;DejaVu Sans&quot;</span><span class="p">,</span>
    <span class="s2">&quot;font_size&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s2">&quot;color_scheme&quot;</span><span class="p">:</span> <span class="p">{</span>  <span class="c1"># color to be used for right part of the image</span>
        <span class="s2">&quot;exception&quot;</span><span class="p">:</span> <span class="s2">&quot;#007ec6&quot;</span><span class="p">,</span>  <span class="c1"># blue</span>
        <span class="s2">&quot;failure&quot;</span><span class="p">:</span> <span class="s2">&quot;#e05d44&quot;</span><span class="p">,</span>    <span class="c1"># red</span>
        <span class="s2">&quot;retry&quot;</span><span class="p">:</span> <span class="s2">&quot;#007ec6&quot;</span><span class="p">,</span>      <span class="c1"># blue</span>
        <span class="s2">&quot;running&quot;</span><span class="p">:</span> <span class="s2">&quot;#007ec6&quot;</span><span class="p">,</span>    <span class="c1"># blue</span>
        <span class="s2">&quot;skipped&quot;</span><span class="p">:</span> <span class="s2">&quot;a4a61d&quot;</span><span class="p">,</span>     <span class="c1"># yellowgreen</span>
        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="s2">&quot;#4c1&quot;</span><span class="p">,</span>       <span class="c1"># brightgreen</span>
        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;#9f9f9f&quot;</span><span class="p">,</span>    <span class="c1"># lightgrey</span>
        <span class="s2">&quot;warnings&quot;</span><span class="p">:</span> <span class="s2">&quot;#dfb317&quot;</span>    <span class="c1"># yellow</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Those options can be configured either using the plugin configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;badges&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;left_color&quot;</span><span class="p">:</span> <span class="s2">&quot;#222&quot;</span><span class="p">}}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>or via the URL arguments like <code class="docutils literal notranslate"><span class="pre">http://&lt;buildbotURL&gt;/badges/&lt;buildername&gt;.svg?left_color=222</span></code>.
Custom templates can also be specified in a <code class="docutils literal notranslate"><span class="pre">template</span></code> directory nearby the <code class="docutils literal notranslate"><span class="pre">master.cfg</span></code>.</p>
<div class="section" id="the-badgeio-template">
<h4>The badgeio template<a class="headerlink" href="#the-badgeio-template" title="Permalink to this headline"></a></h4>
<p>A badges template was developed to standardize upon a consistent “look and feel” across the usage of
multiple CI/CD solutions, e.g.: use of Buildbot, Codecov.io, and Travis-CI. An example is shown below.</p>
<img alt="../../_images/badges-badgeio.png" src="../../_images/badges-badgeio.png" />
<p>To ensure the correct “look and feel”, the following Buildbot configuration is needed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;badges&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;left_pad&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;right_pad&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;border_radius&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;badgeio&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is highly recommended to use only with SVG.</p>
</div>
</div>
</div>
</div>
<div class="section" id="authentication-plugins">
<span id="web-authentication"></span><h2><span class="section-number">2.5.15.2. </span>Authentication plugins<a class="headerlink" href="#authentication-plugins" title="Permalink to this headline"></a></h2>
<p>By default, Buildbot does not require people to authenticate in order to access control features in the web UI.
To secure Buildbot, you will need to configure an authentication plugin.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To secure the Buildbot web interface, authorization rules must be provided via the ‘authz’ configuration.
If you simply wish to lock down a Buildbot instance so that only read only access is permitted, you can
restrict access to control endpoints to an unpopulated ‘admin’ role. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span><span class="n">allowRules</span><span class="o">=</span><span class="p">[</span><span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">)],</span>
                               <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As of Buildbot 0.9.4, user session is managed via a <a class="reference external" href="https://en.wikipedia.org/wiki/JSON_Web_Token">JWT</a> token, using <a class="reference external" href="https://pyjwt.readthedocs.io/en/latest/algorithms.html">HS256</a> algorithm.
The session secret is stored in the database in the <code class="docutils literal notranslate"><span class="pre">object_state</span></code> table with <code class="docutils literal notranslate"><span class="pre">name</span></code> column being <code class="docutils literal notranslate"><span class="pre">session_secret</span></code>.
Please make sure appropriate access restriction is made to this database table.</p>
</div>
<p>Authentication plugins are implemented as classes, and passed as the <code class="docutils literal notranslate"><span class="pre">auth</span></code> parameter to <a class="reference internal" href="#cfg-www" title="www"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">www</span></code></a>.</p>
<p>The available classes are described here:</p>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.auth.NoAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.auth.</span></span><span class="sig-name descname"><span class="pre">NoAuth</span></span><a class="headerlink" href="#buildbot.www.auth.NoAuth" title="Permalink to this definition"></a></dt>
<dd><p>This class is the default authentication plugin, which disables authentication.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.auth.UserPasswordAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.auth.</span></span><span class="sig-name descname"><span class="pre">UserPasswordAuth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">users</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.UserPasswordAuth" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>users</strong> – list of <code class="docutils literal notranslate"><span class="pre">(&quot;user&quot;,&quot;password&quot;)</span></code> tuples, or a dictionary of <code class="docutils literal notranslate"><span class="pre">{&quot;user&quot;:</span> <span class="pre">&quot;password&quot;,</span> <span class="pre">..}</span></code></p>
</dd>
</dl>
<p>Simple username/password authentication using a list of user/password tuples provided in the configuration file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">UserPasswordAuth</span><span class="p">({</span><span class="s2">&quot;homer&quot;</span><span class="p">:</span> <span class="s2">&quot;doh!&quot;</span><span class="p">}),</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.auth.CustomAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.auth.</span></span><span class="sig-name descname"><span class="pre">CustomAuth</span></span><a class="headerlink" href="#buildbot.www.auth.CustomAuth" title="Permalink to this definition"></a></dt>
<dd><p>This authentication class means to be overridden with a custom <code class="docutils literal notranslate"><span class="pre">check_credentials</span></code> method that gets username and password
as arguments and check if the user can login. You may use it e.g. to check the credentials against an external database or file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>

<span class="k">class</span> <span class="nc">MyAuth</span><span class="p">(</span><span class="n">util</span><span class="o">.</span><span class="n">CustomAuth</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">check_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">user</span> <span class="o">==</span> <span class="s1">&#39;snow&#39;</span> <span class="ow">and</span> <span class="n">password</span> <span class="o">==</span> <span class="s1">&#39;white&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;auth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">MyAuth</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.auth.HTPasswdAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.auth.</span></span><span class="sig-name descname"><span class="pre">HTPasswdAuth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">passwdFile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.auth.HTPasswdAuth" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>passwdFile</strong> – An <code class="file docutils literal notranslate"><span class="pre">.htpasswd</span></code> file to read</p>
</dd>
</dl>
<p>This class implements simple username/password authentication against a standard <code class="file docutils literal notranslate"><span class="pre">.htpasswd</span></code> file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">HTPasswdAuth</span><span class="p">(</span><span class="s2">&quot;my_htpasswd&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.oauth2.GoogleAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.oauth2.</span></span><span class="sig-name descname"><span class="pre">GoogleAuth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clientId</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clientSecret</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.GoogleAuth" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>clientId</strong> – The client ID of your buildbot application</p></li>
<li><p><strong>clientSecret</strong> – The client secret of your buildbot application</p></li>
</ul>
</dd>
</dl>
<p>This class implements an authentication with <a class="reference external" href="https://developers.google.com/accounts/docs/OAuth2">Google</a> single sign-on.
You can look at the <a class="reference external" href="https://developers.google.com/accounts/docs/OAuth2">Google</a> oauth2 documentation on how to register your Buildbot instance to the Google systems.
The developer console will give you the two parameters you have to give to <code class="docutils literal notranslate"><span class="pre">GoogleAuth</span></code>.</p>
<p>Register your Buildbot instance with the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_URL/auth/login</span></code> URL as the allowed redirect URI.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GoogleAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order to use this module, you need to install the Python <code class="docutils literal notranslate"><span class="pre">requests</span></code> module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install requests
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.oauth2.GitHubAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.oauth2.</span></span><span class="sig-name descname"><span class="pre">GitHubAuth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clientId</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clientSecret</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.GitHubAuth" title="Permalink to this definition"></a></dt>
<dd><blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">param clientId</dt>
<dd class="field-odd"><p>The client ID of your buildbot application</p>
</dd>
<dt class="field-even">param clientSecret</dt>
<dd class="field-even"><p>The client secret of your buildbot application</p>
</dd>
<dt class="field-odd">param serverURL</dt>
<dd class="field-odd"><p>The server URL if this is a GitHub Enterprise server</p>
</dd>
<dt class="field-even">param apiVersion</dt>
<dd class="field-even"><p>The GitHub API version to use. One of <code class="docutils literal notranslate"><span class="pre">3</span></code> or <code class="docutils literal notranslate"><span class="pre">4</span></code>
(V3/REST or V4/GraphQL). Defaults to 3.</p>
</dd>
<dt class="field-odd">param getTeamsMembership</dt>
<dd class="field-odd"><p>When <code class="docutils literal notranslate"><span class="pre">True</span></code> fetch all team memberships for each of the
organizations the user belongs to. The teams will be included in the
user’s groups as <code class="docutils literal notranslate"><span class="pre">org-name/team-name</span></code>.</p>
</dd>
<dt class="field-even">param debug</dt>
<dd class="field-even"><p>When <code class="docutils literal notranslate"><span class="pre">True</span></code> and using <code class="docutils literal notranslate"><span class="pre">apiVersion=4</span></code> show some additional log calls with the
GraphQL queries and responses for debugging purposes.</p>
</dd>
</dl>
<p>This class implements an authentication with <a class="reference external" href="https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#web-application-flow">GitHub</a> single sign-on.
It functions almost identically to the <a class="reference internal" href="#buildbot.www.oauth2.GoogleAuth" title="buildbot.www.oauth2.GoogleAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleAuth</span></code></a> class.</p>
<p>Register your Buildbot instance with the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_URL/auth/login</span></code> url as the allowed redirect URI.</p>
<p>The user’s email-address (for e.g. authorization) is set to the “primary” address set by the user in GitHub.
When using group-based authorization, the user’s groups are equal to the names of the GitHub organizations the user
is a member of.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GitHubAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Example for Enterprise GitHub:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GitHubAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;https://git.corp.mycompany.com&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An example on fetching team membership could be:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GitHubAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">,</span> <span class="n">apiVersion</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                            <span class="n">getTeamsMembership</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="s1">&#39;authz&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
        <span class="n">allowRules</span><span class="o">=</span><span class="p">[</span>
          <span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;core-developers&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
          <span class="n">util</span><span class="o">.</span><span class="n">RolesFromGroups</span><span class="p">(</span><span class="n">groupPrefix</span><span class="o">=</span><span class="s1">&#39;buildbot/&#39;</span><span class="p">)</span>
        <span class="p">]</span>
      <span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<p>If the <code class="docutils literal notranslate"><span class="pre">buildbot</span></code> organization had two teams, for example, ‘core-developers’ and ‘contributors’,
with the above example, any user belonging to those teams would be granted the roles matching those
team names.</p>
<p>In order to use this module, you need to install the Python <code class="docutils literal notranslate"><span class="pre">requests</span></code> module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install requests
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.oauth2.GitLabAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.oauth2.</span></span><span class="sig-name descname"><span class="pre">GitLabAuth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instanceUri</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clientId</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clientSecret</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.GitLabAuth" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>instanceUri</strong> – The URI of your GitLab instance</p></li>
<li><p><strong>clientId</strong> – The client ID of your buildbot application</p></li>
<li><p><strong>clientSecret</strong> – The client secret of your buildbot application</p></li>
</ul>
</dd>
</dl>
<p>This class implements an authentication with <a class="reference external" href="http://doc.gitlab.com/ce/integration/oauth_provider.html">GitLab</a> single sign-on.
It functions almost identically to the <a class="reference internal" href="#buildbot.www.oauth2.GoogleAuth" title="buildbot.www.oauth2.GoogleAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleAuth</span></code></a> class.</p>
<p>Register your Buildbot instance with the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_URL/auth/login</span></code> URL as the allowed redirect URI.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GitLabAuth</span><span class="p">(</span><span class="s2">&quot;https://gitlab.com&quot;</span><span class="p">,</span> <span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order to use this module, you need to install the Python <code class="docutils literal notranslate"><span class="pre">requests</span></code> module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install requests
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.oauth2.BitbucketAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.oauth2.</span></span><span class="sig-name descname"><span class="pre">BitbucketAuth</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">clientId</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">clientSecret</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.oauth2.BitbucketAuth" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>clientId</strong> – The client ID of your buildbot application</p></li>
<li><p><strong>clientSecret</strong> – The client secret of your buildbot application</p></li>
</ul>
</dd>
</dl>
<p>This class implements an authentication with <a class="reference external" href="https://confluence.atlassian.com/bitbucket/oauth-on-bitbucket-cloud-238027431.html">Bitbucket</a> single sign-on.
It functions almost identically to the <a class="reference internal" href="#buildbot.www.oauth2.GoogleAuth" title="buildbot.www.oauth2.GoogleAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">GoogleAuth</span></code></a> class.</p>
<p>Register your Buildbot instance with the <code class="docutils literal notranslate"><span class="pre">BUILDBOT_URL/auth/login</span></code> URL as the allowed redirect URI.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">BitbucketAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In order to use this module, you need to install the Python <code class="docutils literal notranslate"><span class="pre">requests</span></code> module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install requests
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.auth.RemoteUserAuth">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.auth.</span></span><span class="sig-name descname"><span class="pre">RemoteUserAuth</span></span><a class="headerlink" href="#buildbot.www.auth.RemoteUserAuth" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>header</strong> – header to use to get the username (defaults to <code class="docutils literal notranslate"><span class="pre">REMOTE_USER</span></code>)</p></li>
<li><p><strong>headerRegex</strong> – regular expression to get the username from header value (defaults to <code class="docutils literal notranslate"><span class="pre">&quot;(?P&lt;username&gt;[^</span> <span class="pre">&#64;]+)&#64;(?P&lt;realm&gt;[^</span> <span class="pre">&#64;]+)&quot;)</span></code>.
Note that you need at least to specify a <code class="docutils literal notranslate"><span class="pre">?P&lt;username&gt;</span></code> regular expression named group.</p></li>
<li><p><strong>userInfoProvider</strong> – user info provider; see <a class="reference internal" href="#user-information"><span class="std std-ref">User Information</span></a></p></li>
</ul>
</dd>
</dl>
<p>If the Buildbot UI is served through a reverse proxy that supports HTTP-based authentication (like apache or lighttpd), it’s possible to tell Buildbot to trust the web server and get the username from the request headers.</p>
<p>The administrator must make sure that it’s impossible to get access to Buildbot in any way other than through the frontend.
Usually this means that Buildbot should listen for incoming connections only on localhost (or on some firewall-protected port).
The reverse proxy must require HTTP authentication to access Buildbot pages (using any source for credentials, such as htpasswd, PAM, LDAP, Kerberos).</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">RemoteUserAuth</span><span class="p">(),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>A corresponding Apache configuration example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;Location &quot;/&quot;&gt;
        AuthType Kerberos
        AuthName &quot;Buildbot login via Kerberos&quot;
        KrbMethodNegotiate On
        KrbMethodK5Passwd On
        KrbAuthRealms &lt;&lt;YOUR CORP REALMS&gt;&gt;
        KrbVerifyKDC off
        KrbServiceName Any
        Krb5KeyTab /etc/krb5/krb5.keytab
        KrbSaveCredentials Off
        require valid-user
        Order allow,deny

        Satisfy Any

        #] SSO
        RewriteEngine On
        RewriteCond %{LA-U:REMOTE_USER} (.+)$
        RewriteRule . - [E=RU:%1,NS]
        RequestHeader set REMOTE_USER %{RU}e

&lt;/Location&gt;
</pre></div>
</div>
<p>The advantage of this sort of authentication is that it is uses a proven and fast implementation for authentication.
The problem is that the only information that is passed to Buildbot is the username, and there is no way to pass any other information like user email, user groups, etc.
That information can be very useful to the mailstatus plugin, or for authorization processes.
See <a class="reference internal" href="#user-information"><span class="std std-ref">User Information</span></a> for a mechanism to supply that information.</p>
</dd></dl>

</div>
<div class="section" id="user-information">
<span id="id3"></span><h2><span class="section-number">2.5.15.3. </span>User Information<a class="headerlink" href="#user-information" title="Permalink to this headline"></a></h2>
<p>For authentication mechanisms which cannot provide complete information about a user, Buildbot needs another way to get user data.
This is useful both for authentication (to fetch more data about the logged-in user) and for avatars (to fetch data about other users).</p>
<p>This extra information is provided, appropriately enough, by user info providers.
These can be passed to <a class="reference internal" href="#buildbot.www.auth.RemoteUserAuth" title="buildbot.www.auth.RemoteUserAuth"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteUserAuth</span></code></a> and as an element of <code class="docutils literal notranslate"><span class="pre">avatar_methods</span></code>.</p>
<p>This can also be passed to oauth2 authentication plugins.
In this case the username provided by oauth2 will be used, and all other information will be taken from ldap (Full Name, email, and groups):</p>
<p>Currently only one provider is available:</p>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.ldapuserinfo.LdapUserInfo">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.ldapuserinfo.</span></span><span class="sig-name descname"><span class="pre">LdapUserInfo</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uri</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bindUser</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bindPw</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accountBase</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accountPattern</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groupBase=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groupMemberPattern=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">groupName=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accountFullName</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accountEmail</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avatarPattern=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">avatarData=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">accountExtraFields=None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.ldapuserinfo.LdapUserInfo" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>uri</strong> – uri of the ldap server</p></li>
<li><p><strong>bindUser</strong> – username of the ldap account that is used to get the infos for other users (usually a “faceless” account)</p></li>
<li><p><strong>bindPw</strong> – password of the <code class="docutils literal notranslate"><span class="pre">bindUser</span></code></p></li>
<li><p><strong>accountBase</strong> – the base dn (distinguished name)of the user database</p></li>
<li><p><strong>accountPattern</strong> – the pattern for searching in the account database.
This must contain the <code class="docutils literal notranslate"><span class="pre">%(username)s</span></code> string, which is replaced by the searched username</p></li>
<li><p><strong>accountFullName</strong> – the name of the field in account ldap database where the full user name is to be found.</p></li>
<li><p><strong>accountEmail</strong> – the name of the field in account ldap database where the user email is to be found.</p></li>
<li><p><strong>groupBase</strong> – the base dn of the groups database</p></li>
<li><p><strong>groupMemberPattern</strong> – the pattern for searching in the group database.
This must contain the <code class="docutils literal notranslate"><span class="pre">%(dn)s</span></code> string, which is replaced by the searched username’s dn</p></li>
<li><p><strong>groupName</strong> – the name of the field in groups ldap database where the group name is to be found.</p></li>
<li><p><strong>avatarPattern</strong> – the pattern for searching avatars from emails in the account database.
This must contain the <code class="docutils literal notranslate"><span class="pre">%(email)s</span></code> string, which is replaced by the searched email</p></li>
<li><p><strong>avatarData</strong> – the name of the field in groups ldap database where the avatar picture is to be found.
This field is supposed to contain the raw picture, format is automatically detected from jpeg, png or git.</p></li>
<li><p><strong>accountExtraFields</strong> – extra fields to extracts for use with the authorization policies</p></li>
</ul>
</dd>
</dl>
<p>If one of the three optional groups parameters is supplied, then all of them become mandatory. If none is supplied, the retrieved user info has an empty list of groups.</p>
</dd></dl>

<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>

<span class="c1"># this configuration works for MS Active Directory ldap implementation</span>
<span class="c1"># we use it for user info, and avatars</span>
<span class="n">userInfoProvider</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">LdapUserInfo</span><span class="p">(</span>
    <span class="n">uri</span><span class="o">=</span><span class="s1">&#39;ldap://ldap.mycompany.com:3268&#39;</span><span class="p">,</span>
    <span class="n">bindUser</span><span class="o">=</span><span class="s1">&#39;ldap_user&#39;</span><span class="p">,</span>
    <span class="n">bindPw</span><span class="o">=</span><span class="s1">&#39;p4$$wd&#39;</span><span class="p">,</span>
    <span class="n">accountBase</span><span class="o">=</span><span class="s1">&#39;dc=corp,dc=mycompany,dc=com&#39;</span><span class="p">,</span>
    <span class="n">groupBase</span><span class="o">=</span><span class="s1">&#39;dc=corp,dc=mycompany,dc=com&#39;</span><span class="p">,</span>
    <span class="n">accountPattern</span><span class="o">=</span><span class="s1">&#39;(&amp;(objectClass=person)(sAMAccountName=</span><span class="si">%(username)s</span><span class="s1">))&#39;</span><span class="p">,</span>
    <span class="n">accountFullName</span><span class="o">=</span><span class="s1">&#39;displayName&#39;</span><span class="p">,</span>
    <span class="n">accountEmail</span><span class="o">=</span><span class="s1">&#39;mail&#39;</span><span class="p">,</span>
    <span class="n">groupMemberPattern</span><span class="o">=</span><span class="s1">&#39;(&amp;(objectClass=group)(member=</span><span class="si">%(dn)s</span><span class="s1">))&#39;</span><span class="p">,</span>
    <span class="n">groupName</span><span class="o">=</span><span class="s1">&#39;cn&#39;</span><span class="p">,</span>
    <span class="n">avatarPattern</span><span class="o">=</span><span class="s1">&#39;(&amp;(objectClass=person)(mail=</span><span class="si">%(email)s</span><span class="s1">))&#39;</span><span class="p">,</span>
    <span class="n">avatarData</span><span class="o">=</span><span class="s1">&#39;thumbnailPhoto&#39;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">PORT</span><span class="p">,</span> <span class="n">allowed_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">],</span>
                <span class="n">url</span><span class="o">=</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;buildbotURL&#39;</span><span class="p">],</span>
                <span class="n">auth</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">RemoteUserAuth</span><span class="p">(</span><span class="n">userInfoProvider</span><span class="o">=</span><span class="n">userInfoProvider</span><span class="p">),</span>
                <span class="n">avatar_methods</span><span class="o">=</span><span class="p">[</span><span class="n">userInfoProvider</span><span class="p">,</span>
                                <span class="n">util</span><span class="o">.</span><span class="n">AvatarGravatar</span><span class="p">()])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to use this module, you need to install the <code class="docutils literal notranslate"><span class="pre">ldap3</span></code> module:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install ldap3
</pre></div>
</div>
</div>
<p>In the case of oauth2 authentications, you have to pass the userInfoProvider as keyword argument:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>
<span class="n">userInfoProvider</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">LdapUserInfo</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># ...</span>
    <span class="s1">&#39;auth&#39;</span><span class="p">:</span> <span class="n">util</span><span class="o">.</span><span class="n">GoogleAuth</span><span class="p">(</span><span class="s2">&quot;clientid&quot;</span><span class="p">,</span> <span class="s2">&quot;clientsecret&quot;</span><span class="p">,</span> <span class="n">userInfoProvider</span><span class="o">=</span><span class="n">userInfoProvider</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="reverse-proxy-configuration">
<span id="reverse-proxy-config"></span><h2><span class="section-number">2.5.15.4. </span>Reverse Proxy Configuration<a class="headerlink" href="#reverse-proxy-configuration" title="Permalink to this headline"></a></h2>
<p>It is usually better to put Buildbot behind a reverse proxy in production.</p>
<ul class="simple">
<li><p>Provides automatic gzip compression</p></li>
<li><p>Provides SSL support with a widely used implementation</p></li>
<li><p>Provides support for http/2 or spdy for fast parallel REST api access from the browser</p></li>
</ul>
<p>Reverse proxy however might be problematic for websocket, you have to configure it specifically to pass web socket requests.
Here is an nginx configuration that is known to work (nginx 1.6.2):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>server {
        # Enable SSL and http2
        listen 443 ssl http2 default_server;

        server_name yourdomain.com;

        root html;
        index index.html index.htm;

        ssl on;
        ssl_certificate /etc/nginx/ssl/server.cer;
        ssl_certificate_key /etc/nginx/ssl/server.key;

        # put a one day session timeout for websockets to stay longer
        ssl_session_cache      shared:SSL:10m;
        ssl_session_timeout  1440m;

        # please consult latest nginx documentation for current secure encryption settings
        ssl_protocols ..
        ssl_ciphers ..
        ssl_prefer_server_ciphers   on;
        #

        # force https
        add_header Strict-Transport-Security &quot;max-age=31536000; includeSubdomains;&quot;;
        spdy_headers_comp 5;

        proxy_set_header HOST $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto  $scheme;
        proxy_set_header X-Forwarded-Server  $host;
        proxy_set_header X-Forwarded-Host  $host;

        # you could use / if you use domain based proxy instead of path based proxy
        location /buildbot/ {
            proxy_pass http://127.0.0.1:5000/;
        }
        location /buildbot/sse/ {
            # proxy buffering will prevent sse to work
            proxy_buffering off;
            proxy_pass http://127.0.0.1:5000/sse/;
        }
        # required for websocket
        location /buildbot/ws {
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection &quot;upgrade&quot;;
            proxy_pass http://127.0.0.1:5000/ws;
            # raise the proxy timeout for the websocket
            proxy_read_timeout 6000s;
        }
}
</pre></div>
</div>
<p>To run with Apache2, you’ll need <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_wstunnel.html">mod_proxy_wstunnel</a> in addition to <a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_http.html">mod_proxy_http</a>. Serving HTTPS (<a class="reference external" href="https://httpd.apache.org/docs/2.4/mod/mod_ssl.html">mod_ssl</a>) is advised to prevent issues with enterprise proxies (see <a class="reference internal" href="../../developer/www-server.html#sse"><span class="std std-ref">Server Sent Events</span></a>), even if you don’t need the encryption itself.</p>
<p>Here is a configuration that is known to work (Apache 2.4.10 / Debian 8, Apache 2.4.25 / Debian 9, Apache 2.4.6 / CentOS 7), directly at the top of the domain.</p>
<p>If you want to add access control directives, just put them in a
<code class="docutils literal notranslate"><span class="pre">&lt;Location</span> <span class="pre">/&gt;</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;VirtualHost *:443&gt;
    ServerName buildbot.example
    ServerAdmin webmaster@buildbot.example

    # replace with actual port of your Buildbot master
    ProxyPass /ws ws://127.0.0.1:8020/ws
    ProxyPassReverse /ws ws://127.0.0.1:8020/ws
    ProxyPass / http://127.0.0.1:8020/
    ProxyPassReverse / http://127.0.0.1:8020/

    SetEnvIf X-Url-Scheme https HTTPS=1
    ProxyPreserveHost On

    SSLEngine on
    SSLCertificateFile /path/to/cert.pem
    SSLCertificateKeyFile /path/to/cert.key

    # check Apache2 documentation for current safe SSL settings
    # This is actually the Debian 8 default at the time of this writing:
    SSLProtocol all -SSLv3

&lt;/VirtualHost&gt;
</pre></div>
</div>
</div>
<div class="section" id="authorization-rules">
<span id="web-authorization"></span><h2><span class="section-number">2.5.15.5. </span>Authorization rules<a class="headerlink" href="#authorization-rules" title="Permalink to this headline"></a></h2>
<p>The authorization framework in Buildbot is very generic and flexible.
The drawback is that it is not very obvious for newcomers.
The ‘simple’ example will however allow you to easily start by implementing an admins-have-all-rights setup.</p>
<p>Please carefully read the following documentation to understand how to setup authorization in Buildbot.</p>
<p>Authorization framework is tightly coupled to the REST API.
Authorization framework only works for HTTP, not for other means of interaction like IRC or try scheduler.
It allows or denies access to the REST APIs according to rules.</p>
<img alt="Auth diagram" src="../../_images/auth_rules.svg" /><ul>
<li><p>Roles is a label that you give to a user.</p>
<p>It is similar but different to the usual notion of group:</p>
<ul class="simple">
<li><p>A user can have several roles, and a role can be given to several users.</p></li>
<li><p>Role is an application specific notion, while group is more organization specific notion.</p></li>
<li><p>Groups are given by the auth plugin, e.g <code class="docutils literal notranslate"><span class="pre">ldap</span></code>, <code class="docutils literal notranslate"><span class="pre">github</span></code>, and are not always in the precise control of the buildbot admins.</p></li>
<li><p>Roles can be dynamically assigned, according to the context.
For example, there is the <code class="docutils literal notranslate"><span class="pre">owner</span></code> role, which can be given to a user for a build that he is at the origin, so that he can stop or rebuild only builds of his own.</p></li>
</ul>
</li>
<li><p>Endpoint matchers associate role requirements to REST API endpoints.
The default policy is allow in case no matcher matches (see below why).</p></li>
<li><p>Role matchers associate authenticated users to roles.</p></li>
</ul>
<div class="section" id="restricting-read-access">
<h3>Restricting Read Access<a class="headerlink" href="#restricting-read-access" title="Permalink to this headline"></a></h3>
<p>Please note that you can use this framework to deny read access to the REST API, but there is no access control in websocket or SSE APIs.
Practically this means user will still see live updates from running builds in the UI, as those will come from websocket.</p>
<p>The only resources that are only available for read in REST API are the log data (a.k.a <cite>logchunks</cite>).</p>
<p>From a strict security point of view you cannot really use Buildbot Authz framework to securely deny read access to your bot.
The access control is rather designed to restrict control APIs which are only accessible through REST API.
In order to reduce attack surface, we recommend to place Buildbot behind an access controlled reverse proxy like <a class="reference external" href="https://github.com/oauth2-proxy/oauth2-proxy">OAuth2Proxy</a>.</p>
</div>
<div class="section" id="authz-configuration">
<h3>Authz Configuration<a class="headerlink" href="#authz-configuration" title="Permalink to this headline"></a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.Authz">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.</span></span><span class="sig-name descname"><span class="pre">Authz</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">allowRules</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">roleMatcher</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stringsMatcher</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">util.fnmatchStrMatcher</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.Authz" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>allowRules</strong> – List of <code class="xref py py-class docutils literal notranslate"><span class="pre">EndpointMatcherBase</span></code> processed in order for each endpoint grant request.</p></li>
<li><p><strong>roleMatcher</strong> – List of RoleMatchers</p></li>
<li><p><strong>stringsMatcher</strong> – Selects algorithm used to make strings comparison (used to compare roles and builder names).
Can be <code class="xref py py-class docutils literal notranslate"><span class="pre">util.fnmatchStrMatcher</span></code> or <code class="xref py py-class docutils literal notranslate"><span class="pre">util.reStrMatcher</span></code> from <code class="docutils literal notranslate"><span class="pre">from</span> <span class="pre">buildbot.plugins</span> <span class="pre">import</span> <span class="pre">util</span></code></p></li>
</ul>
</dd>
</dl>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Authz</span></code> needs to be configured in <code class="docutils literal notranslate"><span class="pre">c['www']['authz']</span></code></p>
</dd></dl>

</div>
<div class="section" id="endpoint-matchers">
<h3>Endpoint matchers<a class="headerlink" href="#endpoint-matchers" title="Permalink to this headline"></a></h3>
<p>Endpoint matchers are responsible for creating rules to match REST endpoints, and requiring roles for them.
Endpoint matchers are processed in the order they are configured.
The first rule matching an endpoint will prevent further rules from being checked.
To continue checking other rules when the result is <cite>deny</cite>, set <cite>defaultDeny=False</cite>.
If no endpoint matcher matches, then access is granted.</p>
<p>One can implement the default deny policy by putting an <code class="xref py py-class docutils literal notranslate"><span class="pre">AnyEndpointMatcher</span></code> with nonexistent role in the end of the list.
Please note that this will deny all REST apis, and most of the UI do not implement proper access denied message in case of such error.</p>
<p>The following sequence is implemented by each EndpointMatcher class:</p>
<ul class="simple">
<li><p>Check whether the requested endpoint is supported by this matcher</p></li>
<li><p>Get necessary info from data API and decide whether it matches</p></li>
<li><p>Look if the user has the required role</p></li>
</ul>
<p>Several endpoints matchers are currently implemented.
If you need a very complex setup, you may need to implement your own endpoint matchers.
In this case, you can look at the source code for detailed examples on how to write endpoint matchers.</p>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.endpointmatchers.EndpointMatcherBase">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.endpointmatchers.</span></span><span class="sig-name descname"><span class="pre">EndpointMatcherBase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">role</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">defaultDeny</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.EndpointMatcherBase" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>role</strong> – The role which grants access to this endpoint.
List of roles is not supported, but a <code class="docutils literal notranslate"><span class="pre">fnmatch</span></code> expression can be provided to match several roles.</p></li>
<li><p><strong>defaultDeny</strong> – The role matcher algorithm will stop if this value is true and the endpoint matched.</p></li>
</ul>
</dd>
</dl>
<p>This is the base endpoint matcher.
Its arguments are inherited by all the other endpoint matchers.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.endpointmatchers.AnyEndpointMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.endpointmatchers.</span></span><span class="sig-name descname"><span class="pre">AnyEndpointMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">role</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.AnyEndpointMatcher" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>role</strong> – The role which grants access to any endpoint.</p>
</dd>
</dl>
<p>AnyEndpointMatcher grants all rights to people with given role (usually “admins”).</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.endpointmatchers.AnyControlEndpointMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.endpointmatchers.</span></span><span class="sig-name descname"><span class="pre">AnyControlEndpointMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">role</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.AnyControlEndpointMatcher" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>role</strong> – The role which grants access to any control endpoint.</p>
</dd>
</dl>
<p>AnyControlEndpointMatcher grants control rights to people with given role (usually “admins”).
This endpoint matcher matches current and future control endpoints.
You need to add this in the end of your configuration to make sure it is future proof.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.endpointmatchers.ForceBuildEndpointMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.endpointmatchers.</span></span><span class="sig-name descname"><span class="pre">ForceBuildEndpointMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">role</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.ForceBuildEndpointMatcher" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>builder</strong> – Name of the builder.</p></li>
<li><p><strong>role</strong> – The role needed to get access to such endpoints.</p></li>
</ul>
</dd>
</dl>
<p>ForceBuildEndpointMatcher grants right to force builds.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.endpointmatchers.StopBuildEndpointMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.endpointmatchers.</span></span><span class="sig-name descname"><span class="pre">StopBuildEndpointMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">role</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.StopBuildEndpointMatcher" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>builder</strong> – Name of the builder.</p></li>
<li><p><strong>role</strong> – The role needed to get access to such endpoints.</p></li>
</ul>
</dd>
</dl>
<p>StopBuildEndpointMatcher grants rights to stop builds.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.endpointmatchers.RebuildBuildEndpointMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.endpointmatchers.</span></span><span class="sig-name descname"><span class="pre">RebuildBuildEndpointMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">role</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.RebuildBuildEndpointMatcher" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>builder</strong> – Name of the builder.</p></li>
<li><p><strong>role</strong> – The role needed to get access to such endpoints.</p></li>
</ul>
</dd>
</dl>
<p>RebuildBuildEndpointMatcher grants rights to rebuild builds.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.endpointmatchers.EnableSchedulerEndpointMatcher">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.endpointmatchers.</span></span><span class="sig-name descname"><span class="pre">EnableSchedulerEndpointMatcher</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">builder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">role</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.endpointmatchers.EnableSchedulerEndpointMatcher" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>builder</strong> – Name of the builder.</p></li>
<li><p><strong>role</strong> – The role needed to get access to such endpoints.</p></li>
</ul>
</dd>
</dl>
<p>EnableSchedulerEndpointMatcher grants rights to enable and disable schedulers via the UI.</p>
</dd></dl>

</div>
<div class="section" id="role-matchers">
<h3>Role matchers<a class="headerlink" href="#role-matchers" title="Permalink to this headline"></a></h3>
<p>Role matchers are responsible for creating rules to match people and grant them roles.
You can grant roles from groups information provided by the Auth plugins, or if you prefer directly to people’s email.</p>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.roles.RolesFromGroups">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.roles.</span></span><span class="sig-name descname"><span class="pre">RolesFromGroups</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">groupPrefix</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromGroups" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>groupPrefix</strong> – Prefix to remove from each group</p>
</dd>
</dl>
<p>RolesFromGroups grants roles from the groups of the user.
If a user has group <code class="docutils literal notranslate"><span class="pre">buildbot-admin</span></code>, and groupPrefix is <code class="docutils literal notranslate"><span class="pre">buildbot-</span></code>, then user will be granted the role ‘admin’</p>
<p>ex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
  <span class="n">util</span><span class="o">.</span><span class="n">RolesFromGroups</span><span class="p">(</span><span class="n">groupPrefix</span><span class="o">=</span><span class="s2">&quot;buildbot-&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.roles.RolesFromEmails">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.roles.</span></span><span class="sig-name descname"><span class="pre">RolesFromEmails</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">roledict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromEmails" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>roledict</strong> – Dictionary with key=role, and value=list of email strings</p>
</dd>
</dl>
<p>RolesFromEmails grants roles to users according to the hardcoded emails.</p>
<p>ex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
  <span class="n">util</span><span class="o">.</span><span class="n">RolesFromEmails</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my@email.com&quot;</span><span class="p">])</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.roles.RolesFromDomain">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.roles.</span></span><span class="sig-name descname"><span class="pre">RolesFromDomain</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">roledict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromDomain" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>roledict</strong> – Dictionary with key=role, and value=list of domain strings</p>
</dd>
</dl>
<p>RolesFromDomain grants roles to users according to their email domains.
If a user tried to login with email <code class="docutils literal notranslate"><span class="pre">foo&#64;gmail.com</span></code>, then the user will be granted the role ‘admins’.</p>
<p>ex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
  <span class="n">util</span><span class="o">.</span><span class="n">RolesFromDomain</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;gmail.com&quot;</span><span class="p">])</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.roles.RolesFromOwner">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.roles.</span></span><span class="sig-name descname"><span class="pre">RolesFromOwner</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">roledict</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromOwner" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>roledict</strong> – Dictionary with key=role, and value=list of email strings</p>
</dd>
</dl>
<p>RolesFromOwner grants a given role when property owner matches the email of the user</p>
<p>ex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">RolesFromOwner</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.www.authz.roles.RolesFromUsername">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.www.authz.roles.</span></span><span class="sig-name descname"><span class="pre">RolesFromUsername</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">roles</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">usernames</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#buildbot.www.authz.roles.RolesFromUsername" title="Permalink to this definition"></a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>roles</strong> – Roles to assign when the username matches.</p></li>
<li><p><strong>usernames</strong> – List of usernames that have the roles.</p></li>
</ul>
</dd>
</dl>
<p>RolesFromUsername grants the given roles when the <code class="docutils literal notranslate"><span class="pre">username</span></code> property is within the list of usernames.</p>
<p>ex:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">RolesFromUsername</span><span class="p">(</span><span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;admins&quot;</span><span class="p">],</span> <span class="n">usernames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;root&quot;</span><span class="p">]),</span>
    <span class="n">RolesFromUsername</span><span class="p">(</span><span class="n">roles</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;developers&quot;</span><span class="p">,</span> <span class="s2">&quot;integrators&quot;</span><span class="p">],</span> <span class="n">usernames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span> <span class="s2">&quot;Bob&quot;</span><span class="p">])</span>
<span class="p">]</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="example-configs">
<h3>Example Configs<a class="headerlink" href="#example-configs" title="Permalink to this headline"></a></h3>
<p>Simple config which allows admin people to control everything, but allow anonymous to look at build results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">authz</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
  <span class="n">allowRules</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">),</span>
  <span class="p">],</span>
  <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">RolesFromEmails</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;my@email.com&quot;</span><span class="p">])</span>
  <span class="p">]</span>
<span class="p">)</span>
<span class="n">auth</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">UserPasswordAuth</span><span class="p">({</span><span class="s1">&#39;my@email.com&#39;</span><span class="p">:</span> <span class="s1">&#39;mypass&#39;</span><span class="p">})</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;auth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authz</span>
</pre></div>
</div>
<p>More complex config with separation per branch:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">authz</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
    <span class="n">stringsMatcher</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">fnmatchStrMatcher</span><span class="p">,</span>  <span class="c1"># simple matcher with &#39;*&#39; glob character</span>
    <span class="c1"># stringsMatcher = util.reStrMatcher,   # if you prefer regular expressions</span>
    <span class="n">allowRules</span><span class="o">=</span><span class="p">[</span>
        <span class="c1"># admins can do anything,</span>
        <span class="c1"># defaultDeny=False: if user does not have the admin role, we continue parsing rules</span>
        <span class="n">util</span><span class="o">.</span><span class="n">AnyEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">,</span> <span class="n">defaultDeny</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>

        <span class="n">util</span><span class="o">.</span><span class="n">StopBuildEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;owner&quot;</span><span class="p">),</span>

        <span class="c1"># *-try groups can start &quot;try&quot; builds</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ForceBuildEndpointMatcher</span><span class="p">(</span><span class="n">builder</span><span class="o">=</span><span class="s2">&quot;try&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;*-try&quot;</span><span class="p">),</span>
        <span class="c1"># *-mergers groups can start &quot;merge&quot; builds</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ForceBuildEndpointMatcher</span><span class="p">(</span><span class="n">builder</span><span class="o">=</span><span class="s2">&quot;merge&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;*-mergers&quot;</span><span class="p">),</span>
        <span class="c1"># *-releasers groups can start &quot;release&quot; builds</span>
        <span class="n">util</span><span class="o">.</span><span class="n">ForceBuildEndpointMatcher</span><span class="p">(</span><span class="n">builder</span><span class="o">=</span><span class="s2">&quot;release&quot;</span><span class="p">,</span> <span class="n">role</span><span class="o">=</span><span class="s2">&quot;*-releasers&quot;</span><span class="p">),</span>
        <span class="c1"># if future Buildbot implement new control, we are safe with this last rule</span>
        <span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;admins&quot;</span><span class="p">)</span>
    <span class="p">],</span>
    <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
        <span class="n">RolesFromGroups</span><span class="p">(</span><span class="n">groupPrefix</span><span class="o">=</span><span class="s2">&quot;buildbot-&quot;</span><span class="p">),</span>
        <span class="n">RolesFromEmails</span><span class="p">(</span><span class="n">admins</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;homer@springfieldplant.com&quot;</span><span class="p">],</span>
                        <span class="n">reaper</span><span class="o">-</span><span class="k">try</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;007@mi6.uk&quot;</span><span class="p">]),</span>
        <span class="c1"># role owner is granted when property owner matches the email of the user</span>
        <span class="n">RolesFromOwner</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authz</span>
</pre></div>
</div>
<p>Using GitHub authentication and allowing access to control endpoints for users in the “Buildbot” organization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">authz</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">Authz</span><span class="p">(</span>
  <span class="n">allowRules</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">AnyControlEndpointMatcher</span><span class="p">(</span><span class="n">role</span><span class="o">=</span><span class="s2">&quot;BuildBot&quot;</span><span class="p">)</span>
  <span class="p">],</span>
  <span class="n">roleMatchers</span><span class="o">=</span><span class="p">[</span>
    <span class="n">util</span><span class="o">.</span><span class="n">RolesFromGroups</span><span class="p">()</span>
  <span class="p">]</span>
<span class="p">)</span>
<span class="n">auth</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">GitHubAuth</span><span class="p">(</span><span class="s1">&#39;CLIENT_ID&#39;</span><span class="p">,</span> <span class="s1">&#39;CLIENT_SECRET&#39;</span><span class="p">)</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;auth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;www&#39;</span><span class="p">][</span><span class="s1">&#39;authz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authz</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="reporters/zulip_status.html" class="btn btn-neutral float-left" title="2.5.14.17. ZulipStatusPush" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="wwwhooks.html" class="btn btn-neutral float-right" title="2.5.16. Change Hooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Buildbot Team Members.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>