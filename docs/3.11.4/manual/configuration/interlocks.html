<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.5.13. Interlocks &mdash; Buildbot 3.11.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/buildbot_rtd.css?v=915d5e18" />

  
    <link rel="shortcut icon" href="../../_static/icon.png"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=7574ce52"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2.5.14. Report Generators" href="report_generators/index.html" />
    <link rel="prev" title="2.5.12.57. DebLintian" href="steps/deb_lintian.html" /> 
<!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Buildbot
              <img src="../../_static/full_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.11.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="workers.html">2.5.6. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="projects.html">2.5.8. Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildfactories.html">2.5.9. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsets.html">2.5.10. Build Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="properties.html">2.5.11. Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="steps/index.html">2.5.12. Build Steps</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.5.13. Interlocks</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#access-modes">2.5.13.1. Access Modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#count">2.5.13.2. Count</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scope">2.5.13.3. Scope</a></li>
<li class="toctree-l4"><a class="reference internal" href="#examples">2.5.13.4. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="report_generators/index.html">2.5.14. Report Generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="reporters/index.html">2.5.15. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="www.html">2.5.16. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="wwwhooks.html">2.5.17. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="services/index.html">2.5.18. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbconfig.html">2.5.19. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="configurators.html">2.5.20. Configurators</a></li>
<li class="toctree-l3"><a class="reference internal" href="manhole.html">2.5.21. Manhole</a></li>
<li class="toctree-l3"><a class="reference internal" href="multimaster.html">2.5.22. Multimaster</a></li>
<li class="toctree-l3"><a class="reference internal" href="multicodebase.html">2.5.23. Multiple-Codebase Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc/index.html">2.5.24. Miscellaneous Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="tests/index.html">2.5.25. Testing Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relnotes/index.html">4. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relnotes/index.html#older-release-notes">5. Older Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices.html">6. API Indices</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Buildbot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">2.5. </span>Configuration</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.5.13. </span>Interlocks</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/manual/configuration/interlocks.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="interlocks">
<span id="id1"></span><h1><span class="section-number">2.5.13. </span>Interlocks<a class="headerlink" href="#interlocks" title="Link to this heading">ÔÉÅ</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#access-modes" id="id9">Access Modes</a></p></li>
<li><p><a class="reference internal" href="#count" id="id10">Count</a></p></li>
<li><p><a class="reference internal" href="#scope" id="id11">Scope</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id12">Examples</a></p></li>
</ul>
</nav>
<p>Until now, we assumed that a master can run builds at any worker whenever needed or desired.
Some times, you want to enforce additional constraints on builds.
For reasons like limited network bandwidth, old worker machines, or a self-willed data base server, you may want to limit the number of builds (or build steps) that can access a resource.</p>
<section id="access-modes">
<span id="id2"></span><h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">2.5.13.1. </span>Access Modes</a><a class="headerlink" href="#access-modes" title="Link to this heading">ÔÉÅ</a></h2>
<p>The mechanism used by Buildbot is known as the read/write lock <a class="footnote-reference brackets" href="#id6" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.
It allows either many readers or a single writer but not a combination of readers and writers.
The general lock has been modified and extended for use in Buildbot.
Firstly, the general lock allows an infinite number of readers.
In Buildbot, we often want to put an upper limit on the number of readers, for example allowing two out of five possible builds at the same time.
To do this, the lock counts the number of active readers.
Secondly, the terms <em>read mode</em> and <em>write mode</em> are confusing in the context of Buildbot.
They have been replaced by <em>counting mode</em> (since the lock counts them) and <em>exclusive mode</em>.
As a result of these changes, locks in Buildbot allow a number of builds (up to some fixed number) in counting mode, or they allow one build in exclusive mode.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Access modes are specified when a lock is used.
That is, it is possible to have a single lock that is used by several workers in counting mode, and several workers in exclusive mode.
In fact, this is the strength of the modes: accessing a lock in exclusive mode will prevent all counting-mode accesses.</p>
</div>
</section>
<section id="count">
<h2><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">2.5.13.2. </span>Count</a><a class="headerlink" href="#count" title="Link to this heading">ÔÉÅ</a></h2>
<p>Often, not all workers are equal.
To address this situation, Buildbot allows to have a separate upper limit on the count for each worker.
In this way, for example, you can have at most 3 concurrent builds at a fast worker, 2 at a slightly older worker, and 1 at all other workers.
You can also specify the count during an access request. This specifies how many units an access consumes from the lock (in other words, as how many builds a build will count).
This way, you can balance a shared resource that builders consume unevenly, for example, the amount of memory or the number of CPU cores.</p>
</section>
<section id="scope">
<h2><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">2.5.13.3. </span>Scope</a><a class="headerlink" href="#scope" title="Link to this heading">ÔÉÅ</a></h2>
<p>The final thing you can specify when you introduce a new lock is its scope.
Some constraints are global and must be enforced on all workers.
Other constraints are local to each worker.
A <em>master lock</em> is used for the global constraints.
You can ensure for example that at most one build (of all builds running at all workers) accesses the database server.
With a <em>worker lock</em> you can add a limit local to each worker.
With such a lock, you can for example enforce an upper limit to the number of active builds at a worker, like above.</p>
</section>
<section id="examples">
<h2><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">2.5.13.4. </span>Examples</a><a class="headerlink" href="#examples" title="Link to this heading">ÔÉÅ</a></h2>
<p>Time for a few examples.
A master lock is defined below to protect a database, and a worker lock is created to limit the number of builds at each worker.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span>

<span class="n">db_lock</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">MasterLock</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">)</span>
<span class="n">build_lock</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">WorkerLock</span><span class="p">(</span><span class="s2">&quot;worker_builds&quot;</span><span class="p">,</span>
                             <span class="n">maxCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">maxCountForWorker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
<p><code class="xref py py-data docutils literal notranslate"><span class="pre">db_lock</span></code> is defined to be a master lock.
The <code class="docutils literal notranslate"><span class="pre">database</span></code> string is used for uniquely identifying the lock.
At the next line, a worker lock called <code class="xref py py-data docutils literal notranslate"><span class="pre">build_lock</span></code> is created with the name <code class="docutils literal notranslate"><span class="pre">worker_builds</span></code>.
Since the requirements of the worker lock are a bit more complicated, two optional arguments are also specified.
The <code class="docutils literal notranslate"><span class="pre">maxCount</span></code> parameter sets the default limit for builds in counting mode to <code class="docutils literal notranslate"><span class="pre">1</span></code>.
For the worker called <code class="docutils literal notranslate"><span class="pre">'fast'</span></code> however, we want to have at most three builds, and for the worker called <code class="docutils literal notranslate"><span class="pre">'new'</span></code>, the upper limit is two builds running at the same time.</p>
<p>The next step is accessing the locks in builds.
Buildbot allows a lock to be used during an entire build (from beginning to end) or only during a single build step.
In the latter case, the lock is claimed for use just before the step starts and released again when the step ends.
To prevent deadlocks <a class="footnote-reference brackets" href="#id7" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>, it is not possible to claim or release locks at other times.</p>
<p>To use locks, you add them with a <code class="docutils literal notranslate"><span class="pre">locks</span></code> argument to a build or a step.
Each use of a lock is either in counting mode (that is, possibly shared with
other builds) or in exclusive mode, and this is indicated with the syntax
<code class="docutils literal notranslate"><span class="pre">lock.access(mode,</span> <span class="pre">count)</span></code>, where <code class="xref py py-data docutils literal notranslate"><span class="pre">mode</span></code> is one of <code class="docutils literal notranslate"><span class="pre">&quot;counting&quot;</span></code> or
<code class="docutils literal notranslate"><span class="pre">&quot;exclusive&quot;</span></code>.</p>
<p>The optional argument <code class="xref py py-data docutils literal notranslate"><span class="pre">count</span></code> is a non-negative integer (for counting
locks) or 1 (for exclusive locks). If unspecified, it defaults to 1. If 0, the
access always succeeds. This argument allows to use locks for balancing a
shared resource that is utilized unevenly.</p>
<p>A build or build step proceeds only when it has acquired all locks.
If a build or step needs many locks, it may be starved <a class="footnote-reference brackets" href="#id8" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> by other builds requiring fewer locks.</p>
<p>To illustrate the use of locks, here are a few examples.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">util</span><span class="p">,</span> <span class="n">steps</span>

<span class="n">db_lock</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">MasterLock</span><span class="p">(</span><span class="s2">&quot;database&quot;</span><span class="p">)</span>
<span class="n">build_lock</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">WorkerLock</span><span class="p">(</span><span class="s2">&quot;worker_builds&quot;</span><span class="p">,</span>
                             <span class="n">maxCount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="n">maxCountForWorker</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fast&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">BuildFactory</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">SVN</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;http://example.org/svn/Trunk&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;make all&quot;</span><span class="p">))</span>
<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="s2">&quot;make test&quot;</span><span class="p">,</span>
                             <span class="n">locks</span><span class="o">=</span><span class="p">[</span><span class="n">db_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;exclusive&#39;</span><span class="p">)]))</span>

<span class="n">b1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;full1&#39;</span><span class="p">,</span> <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;fast&#39;</span><span class="p">,</span>  <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s1">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;full2&#39;</span><span class="p">,</span> <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;new&#39;</span><span class="p">,</span>   <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;f2&#39;</span><span class="p">,</span> <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s1">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b3</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;full3&#39;</span><span class="p">,</span> <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;old&#39;</span><span class="p">,</span>   <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;f3&#39;</span><span class="p">,</span> <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s1">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">b4</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;full4&#39;</span><span class="p">,</span> <span class="s1">&#39;workername&#39;</span><span class="p">:</span> <span class="s1">&#39;other&#39;</span><span class="p">,</span> <span class="s1">&#39;builddir&#39;</span><span class="p">:</span> <span class="s1">&#39;f4&#39;</span><span class="p">,</span> <span class="s1">&#39;factory&#39;</span><span class="p">:</span> <span class="n">f</span><span class="p">,</span>
       <span class="s1">&#39;locks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">build_lock</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="s1">&#39;counting&#39;</span><span class="p">)]</span> <span class="p">}</span>

<span class="n">c</span><span class="p">[</span><span class="s1">&#39;builders&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">]</span>
</pre></div>
</div>
<p>Here we have four workers <code class="xref py py-data docutils literal notranslate"><span class="pre">fast</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">new</span></code>, <code class="xref py py-data docutils literal notranslate"><span class="pre">old</span></code>, and <code class="xref py py-data docutils literal notranslate"><span class="pre">other</span></code>.
Each worker performs the same checkout, make, and test build step sequence.
We want to enforce that at most one test step is executed between all workers due to restrictions with the database server.
This is done by adding the <code class="docutils literal notranslate"><span class="pre">locks=</span></code> parameter to the third step.
It takes a list of locks with their access mode.
Alternatively, this can take a renderable that returns a list of locks with their access mode.</p>
<p>In this case, only the <code class="xref py py-data docutils literal notranslate"><span class="pre">db_lock</span></code> is needed.
The exclusive access mode is used to ensure there is at most one worker that executes the test step.</p>
<p>In addition to exclusive access to the database, we also want workers to stay responsive even under the load of a large number of builds being triggered.
For this purpose, the worker lock called <code class="xref py py-data docutils literal notranslate"><span class="pre">build_lock</span></code> is defined.
Since the restraint holds for entire builds, the lock is specified in the builder with <code class="docutils literal notranslate"><span class="pre">'locks':</span> <span class="pre">[build_lock.access('counting')]</span></code>.</p>
<p>Note that you will occasionally see <code class="docutils literal notranslate"><span class="pre">lock.access(mode)</span></code> written as <code class="docutils literal notranslate"><span class="pre">LockAccess(lock,</span> <span class="pre">mode)</span></code>.
The two are equivalent, but the former is preferred.</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id6" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">1</a><span class="fn-bracket">]</span></span>
<p>See <a class="reference external" href="http://en.wikipedia.org/wiki/Read/write_lock_pattern">http://en.wikipedia.org/wiki/Read/write_lock_pattern</a> for more information.</p>
</aside>
<aside class="footnote brackets" id="id7" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">2</a><span class="fn-bracket">]</span></span>
<p>Deadlock is the situation where two or more workers each hold a lock in exclusive mode, and in addition, they want to claim the lock held by the other worker exclusively as well.
Since locks allow at most one exclusive user, both workers would wait forever.</p>
</aside>
<aside class="footnote brackets" id="id8" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">3</a><span class="fn-bracket">]</span></span>
<p>Starving is the situation where only a few locks are available, and they are immediately grabbed by another build.
As a result, it may take a long time before all locks needed by the starved build are free at the same time.</p>
</aside>
</aside>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="steps/deb_lintian.html" class="btn btn-neutral float-left" title="2.5.12.57. DebLintian" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="report_generators/index.html" class="btn btn-neutral float-right" title="2.5.14. Report Generators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Buildbot Team Members.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>