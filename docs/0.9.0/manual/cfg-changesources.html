<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2.4.3. Change Sources &#8212; Buildbot 0.9.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/qtile.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/buildbot.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="Buildbot 0.9.0 documentation" href="../index.html" />
    <link rel="up" title="2.4. Configuration" href="configuration.html" />
    <link rel="next" title="2.4.4. Schedulers" href="cfg-schedulers.html" />
    <link rel="prev" title="2.4.2. Global Configuration" href="cfg-global.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="cfg-schedulers.html" title="2.4.4. Schedulers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="cfg-global.html" title="2.4.2. Global Configuration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Buildbot 0.9.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >2. Buildbot Manual</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="configuration.html" accesskey="U">2.4. Configuration</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="change-sources">
<span id="id1"></span><h1>2.4.3. Change Sources<a class="headerlink" href="#change-sources" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#choosing-a-change-source" id="id21">Choosing a Change Source</a></li>
<li><a class="reference internal" href="#configuring-change-sources" id="id22">Configuring Change Sources</a><ul>
<li><a class="reference internal" href="#repository-and-project" id="id23">Repository and Project</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mail-parsing-changesources" id="id24">Mail-parsing ChangeSources</a><ul>
<li><a class="reference internal" href="#subscribing-the-buildmaster" id="id25">Subscribing the Buildmaster</a></li>
<li><a class="reference internal" href="#using-maildirs" id="id26">Using Maildirs</a></li>
<li><a class="reference internal" href="#parsing-email-change-messages" id="id27">Parsing Email Change Messages</a></li>
<li><a class="reference internal" href="#cvsmaildirsource" id="id28">CVSMaildirSource</a></li>
<li><a class="reference internal" href="#svncommitemailmaildirsource" id="id29">SVNCommitEmailMaildirSource</a></li>
<li><a class="reference internal" href="#bzrlaunchpademailmaildirsource" id="id30">BzrLaunchpadEmailMaildirSource</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pbchangesource" id="id31">PBChangeSource</a><ul>
<li><a class="reference internal" href="#bzr-hook" id="id32">Bzr Hook</a></li>
</ul>
</li>
<li><a class="reference internal" href="#p4source" id="id33">P4Source</a><ul>
<li><a class="reference internal" href="#example" id="id34">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#svnpoller" id="id35">SVNPoller</a></li>
<li><a class="reference internal" href="#bzr-poller" id="id36">Bzr Poller</a></li>
<li><a class="reference internal" href="#gitpoller" id="id37">GitPoller</a></li>
<li><a class="reference internal" href="#hgpoller" id="id38">HgPoller</a></li>
<li><a class="reference internal" href="#bitbucketpullrequestpoller" id="id39">BitbucketPullrequestPoller</a></li>
<li><a class="reference internal" href="#gerritchangesource" id="id40">GerritChangeSource</a></li>
<li><a class="reference internal" href="#gerritchangefilter" id="id41">GerritChangeFilter</a></li>
<li><a class="reference internal" href="#change-hooks-http-notifications" id="id42">Change Hooks (HTTP Notifications)</a></li>
<li><a class="reference internal" href="#googlecodeatompoller" id="id43">GoogleCodeAtomPoller</a></li>
</ul>
</div>
<p>A Version Control System maintains a source tree, and tells the buildmaster when it changes.
The first step of each <code class="xref py py-class docutils literal"><span class="pre">Build</span></code> is typically to acquire a copy of some version of this tree.</p>
<p>This chapter describes how the Buildbot learns about what <code class="xref py py-class docutils literal"><span class="pre">Change</span></code>s have occurred.
For more information on VC systems and <code class="xref py py-class docutils literal"><span class="pre">Change</span></code>s, see <a class="reference internal" href="concepts.html#version-control-systems"><span class="std std-ref">Version Control Systems</span></a>.</p>
<p><code class="xref py py-class docutils literal"><span class="pre">Change</span></code>s can be provided by a variety of <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code> types, although any given project will typically have only a single <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code> active.
This section provides a description of all available <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code> types and explains how to set up each of them.</p>
<div class="section" id="choosing-a-change-source">
<span id="id2"></span><h2><a class="toc-backref" href="#id21">2.4.3.1. Choosing a Change Source</a><a class="headerlink" href="#choosing-a-change-source" title="Permalink to this headline">¶</a></h2>
<p>There are a variety of <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code> classes available, some of which are meant to be used in conjunction with other tools to deliver <code class="xref py py-class docutils literal"><span class="pre">Change</span></code> events from the VC repository to the buildmaster.</p>
<p>As a quick guide, here is a list of VC systems and the <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code>s that might be useful with them.
Note that some of these modules are in Buildbot's &quot;contrib&quot; directory, meaning that they have been offered by other users in hopes they may be useful, and might require some additional work to make them functional.</p>
<dl class="docutils">
<dt>CVS</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">CVSMaildirSource</span></code></a> (watching mail sent by <code class="docutils literal"><span class="pre">contrib/buildbot_cvs_mail.py</span></code> script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="docutils literal"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code> run in a loginfo script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from a long-running <code class="file docutils literal"><span class="pre">contrib/viewcvspoll.py</span></code> polling process which examines the ViewCVS database directly)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
</ul>
</dd>
<dt>SVN</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="file docutils literal"><span class="pre">contrib/svn_buildbot.py</span></code> run in a postcommit script)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from a long-running <code class="file docutils literal"><span class="pre">contrib/svn_watcher.py</span></code> or <code class="file docutils literal"><span class="pre">contrib/svnpoller.py</span></code> polling process</li>
<li><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNCommitEmailMaildirSource</span></code></a> (watching for email sent by <code class="file docutils literal"><span class="pre">commit-email.pl</span></code>)</li>
<li><a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> (polling the SVN repository)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
<li><a class="reference internal" href="#chsrc-GoogleCodeAtomPoller" title="GoogleCodeAtomPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GoogleCodeAtomPoller</span></code></a> (polling the commit feed for a GoogleCode Git repository)</li>
</ul>
</dd>
<dt>Darcs</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="file docutils literal"><span class="pre">contrib/darcs_buildbot.py</span></code> in a commit script)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
</ul>
</dd>
<dt>Mercurial</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus (including <code class="file docutils literal"><span class="pre">contrib/hgbuildbot.py</span></code>, configurable in a <code class="docutils literal"><span class="pre">changegroup</span></code> hook)</li>
<li><a class="reference external" href="BitBuckethook">BitBucket change hook</a> (specifically designed for BitBucket notifications, but requiring a publicly-accessible WebStatus)</li>
<li><a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a> (polling a remote Mercurial repository)</li>
<li><a class="reference internal" href="#chsrc-GoogleCodeAtomPoller" title="GoogleCodeAtomPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GoogleCodeAtomPoller</span></code></a> (polling the commit feed for a GoogleCode Git repository)</li>
<li><a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BitbucketPullrequestPoller</span></code></a> (polling Bitbucket for pull requests)</li>
<li><a class="reference internal" href="#mail-parsing-changesources"><span class="std std-ref">Mail-parsing ChangeSources</span></a>, though there are no ready-to-use recipes</li>
</ul>
</dd>
<dt>Bzr (the newer Bazaar)</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="file docutils literal"><span class="pre">contrib/bzr_buildbot.py</span></code> run in a post-change-branch-tip or commit hook)</li>
<li><a class="reference internal" href="#chsrc-BzrPoller" title="BzrPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BzrPoller</span></code></a> (polling the Bzr repository)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
</ul>
</dd>
<dt>Git</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="file docutils literal"><span class="pre">contrib/git_buildbot.py</span></code> run in the post-receive hook)</li>
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="file docutils literal"><span class="pre">contrib/github_buildbot.py</span></code>, which listens for notifications from GitHub)</li>
<li><a class="reference internal" href="#chsrc-Change Hooks" title="Change Hooks"><code class="xref bb bb-chsrc docutils literal"><span class="pre">Change</span> <span class="pre">Hooks</span></code></a> in WebStatus</li>
<li>GitHub change hook (specifically designed for GitHub notifications, but requiring a publicly-accessible WebStatus)</li>
<li>BitBucket change hook (specifically designed for BitBucket notifications, but requiring a publicly-accessible WebStatus)</li>
<li><a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></code></a> (polling a remote Git repository)</li>
<li><a class="reference internal" href="#chsrc-GoogleCodeAtomPoller" title="GoogleCodeAtomPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GoogleCodeAtomPoller</span></code></a> (polling the commit feed for a GoogleCode Git repository)</li>
<li><a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BitbucketPullrequestPoller</span></code></a> (polling Bitbucket for pull requests)</li>
</ul>
</dd>
<dt>Repo/Git</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></code></a> connects to Gerrit via SSH to get a live stream of changes</li>
</ul>
</dd>
<dt>Monotone</dt>
<dd><ul class="first last simple">
<li><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> (listening for connections from <code class="file docutils literal"><span class="pre">monotone-buildbot.lua</span></code>, which is available with Monotone)</li>
</ul>
</dd>
</dl>
<p>All VC systems can be driven by a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> and the <code class="docutils literal"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code> tool run from some form of commit script.
If you write an email parsing function, they can also all be driven by a suitable <a class="reference internal" href="#mail-parsing-changesources"><span class="std std-ref">mail-parsing source</span></a>.
Additionally, handlers for web-based notification (i.e. from GitHub) can be used with WebStatus' change_hook module.
The interface is simple, so adding your own handlers (and sharing!) should be a breeze.</p>
<p>See <a class="reference internal" href="../bb-chsrc.html" title="Change Source Index"><em>Change Source Index</em></a> for a full list of change sources.</p>
<span class="target" id="index-0"></span></div>
<div class="section" id="configuring-change-sources">
<span id="cfg-change_source"></span><h2><a class="toc-backref" href="#id22">2.4.3.2. Configuring Change Sources</a><a class="headerlink" href="#configuring-change-sources" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#cfg-change_source" title="change_source"><code class="xref bb bb-cfg docutils literal"><span class="pre">change_source</span></code></a> configuration key holds all active change sources for the configuration.</p>
<p>Most configurations have a single <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code>, watching only a single tree, e.g.,</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">PBChangeSource</span><span class="p">()</span>
</pre></div>
</div>
<p>For more advanced configurations, the parameter can be a list of change sources:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">source1</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">source2</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">source1</span><span class="p">,</span> <span class="n">source1</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="section" id="repository-and-project">
<h3><a class="toc-backref" href="#id23">Repository and Project</a><a class="headerlink" href="#repository-and-project" title="Permalink to this headline">¶</a></h3>
<p><code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code>s will, in general, automatically provide the proper <code class="xref py py-attr docutils literal"><span class="pre">repository</span></code> attribute for any changes they produce.
For systems which operate on URL-like specifiers, this is a repository URL.
Other <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code>s adapt the concept as necessary.</p>
<p>Many <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code>s allow you to specify a project, as well.
This attribute is useful when building from several distinct codebases in the same buildmaster: the project string can serve to differentiate the different codebases.
Schedulers can filter on project, so you can configure different builders to run for each project.</p>
</div>
</div>
<div class="section" id="mail-parsing-changesources">
<span id="id3"></span><h2><a class="toc-backref" href="#id24">2.4.3.3. Mail-parsing ChangeSources</a><a class="headerlink" href="#mail-parsing-changesources" title="Permalink to this headline">¶</a></h2>
<p>Many projects publish information about changes to their source tree by sending an email message out to a mailing list, frequently named <code class="samp docutils literal"><em><span class="pre">PROJECT</span></em><span class="pre">-commits</span></code> or <code class="samp docutils literal"><em><span class="pre">PROJECT</span></em><span class="pre">-changes</span></code>.
Each message usually contains a description of the change (who made the change, which files were affected) and sometimes a copy of the diff.
Humans can subscribe to this list to stay informed about what's happening to the source tree.</p>
<p>The Buildbot can also be subscribed to a <cite>-commits</cite> mailing list, and can trigger builds in response to Changes that it hears about.
The buildmaster admin needs to arrange for these email messages to arrive in a place where the buildmaster can find them, and configure the buildmaster to parse the messages correctly.
Once that is in place, the email parser will create Change objects and deliver them to the schedulers (see <a class="reference internal" href="cfg-schedulers.html#schedulers"><span class="std std-ref">Schedulers</span></a>) just like any other ChangeSource.</p>
<p>There are two components to setting up an email-based ChangeSource.
The first is to route the email messages to the buildmaster, which is done by dropping them into a <cite>maildir</cite>.
The second is to actually parse the messages, which is highly dependent upon the tool that was used to create them.
Each VC system has a collection of favorite change-emailing tools, and each has a slightly different format, so each has a different parsing function.
There is a separate ChangeSource variant for each parsing function.</p>
<p>Once you've chosen a maildir location and a parsing function, create the change source and put it in <a class="reference internal" href="#cfg-change_source" title="change_source"><code class="xref bb bb-cfg docutils literal"><span class="pre">change_source</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">CVSMaildirSource</span><span class="p">(</span><span class="s2">&quot;~/maildir-buildbot&quot;</span><span class="p">,</span>
                                              <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;/trunk/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="subscribing-the-buildmaster">
<span id="id4"></span><h3><a class="toc-backref" href="#id25">Subscribing the Buildmaster</a><a class="headerlink" href="#subscribing-the-buildmaster" title="Permalink to this headline">¶</a></h3>
<p>The recommended way to install the buildbot is to create a dedicated account for the buildmaster.
If you do this, the account will probably have a distinct email address (perhaps <cite>buildmaster&#64;example.org</cite>).
Then just arrange for this account's email to be delivered to a suitable maildir (described in the next section).</p>
<p>If the buildbot does not have its own account, <cite>extension addresses</cite> can be used to distinguish between email intended for the buildmaster and email intended for the rest of the account.
In most modern MTAs, the e.g. <cite>foo&#64;example.org</cite> account has control over every email address at example.org which begins with &quot;foo&quot;, such that email addressed to <cite>account-foo&#64;example.org</cite> can be delivered to a different destination than <cite>account-bar&#64;example.org</cite>.
qmail does this by using separate <code class="file docutils literal"><span class="pre">.qmail</span></code> files for the two destinations (<code class="file docutils literal"><span class="pre">.qmail-foo</span></code> and <code class="file docutils literal"><span class="pre">.qmail-bar</span></code>, with <code class="file docutils literal"><span class="pre">.qmail</span></code> controlling the base address and <code class="file docutils literal"><span class="pre">.qmail-default</span></code> controlling all other extensions).
Other MTAs have similar mechanisms.</p>
<p>Thus you can assign an extension address like <cite>foo-buildmaster&#64;example.org</cite> to the buildmaster, and retain <cite>foo&#64;example.org</cite> for your own use.</p>
</div>
<div class="section" id="using-maildirs">
<span id="id5"></span><h3><a class="toc-backref" href="#id26">Using Maildirs</a><a class="headerlink" href="#using-maildirs" title="Permalink to this headline">¶</a></h3>
<p>A <cite>maildir</cite> is a simple directory structure originally developed for qmail that allows safe atomic update without locking.
Create a base directory with three subdirectories: <code class="file docutils literal"><span class="pre">new</span></code>, <code class="file docutils literal"><span class="pre">tmp</span></code>, and <code class="file docutils literal"><span class="pre">cur</span></code>.
When messages arrive, they are put into a uniquely-named file (using pids, timestamps, and random numbers) in <code class="file docutils literal"><span class="pre">tmp</span></code>. When the file is complete, it is atomically renamed into <code class="file docutils literal"><span class="pre">new</span></code>. Eventually the buildmaster notices the file in <code class="file docutils literal"><span class="pre">new</span></code>, reads and parses the contents, then moves it into <code class="file docutils literal"><span class="pre">cur</span></code>. A cronjob can be used to delete files in <code class="file docutils literal"><span class="pre">cur</span></code> at leisure.</p>
<p>Maildirs are frequently created with the <strong class="command">maildirmake</strong> tool, but a simple <code class="samp docutils literal"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">~/</span><em><span class="pre">MAILDIR</span></em><span class="pre">/</span><em><span class="pre">cur,new,tmp</span></em></code> is pretty much equivalent.</p>
<p>Many modern MTAs can deliver directly to maildirs.
The usual <code class="file docutils literal"><span class="pre">.forward</span></code> or <code class="file docutils literal"><span class="pre">.procmailrc</span></code> syntax is to name the base directory with a trailing slash, so something like <code class="samp docutils literal"><span class="pre">~/</span><em><span class="pre">MAILDIR</span></em><span class="pre">/</span></code>.
qmail and postfix are maildir-capable MTAs, and procmail is a maildir-capable MDA (Mail Delivery Agent).</p>
<p>Here is an example procmail config, located in <code class="file docutils literal"><span class="pre">~/.procmailrc</span></code>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span># .procmailrc
# routes incoming mail to appropriate mailboxes
PATH=/usr/bin:/usr/local/bin
MAILDIR=$HOME/Mail
LOGFILE=.procmail_log
SHELL=/bin/sh

:0
*
new
</pre></div>
</div>
<p>If procmail is not setup on a system wide basis, then the following one-line <code class="file docutils literal"><span class="pre">.forward</span></code> file will invoke it.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>!/usr/bin/procmail
</pre></div>
</div>
<p>For MTAs which cannot put files into maildirs directly, the <cite>safecat</cite> tool can be executed from a <code class="file docutils literal"><span class="pre">.forward</span></code> file to accomplish the same thing.</p>
<p>The Buildmaster uses the linux DNotify facility to receive immediate notification when the maildir's <code class="file docutils literal"><span class="pre">new</span></code> directory has changed.
When this facility is not available, it polls the directory for new messages, every 10 seconds by default.</p>
</div>
<div class="section" id="parsing-email-change-messages">
<span id="id6"></span><h3><a class="toc-backref" href="#id27">Parsing Email Change Messages</a><a class="headerlink" href="#parsing-email-change-messages" title="Permalink to this headline">¶</a></h3>
<p>The second component to setting up an email-based <code class="xref py py-class docutils literal"><span class="pre">ChangeSource</span></code> is to parse the actual notices.
This is highly dependent upon the VC system and commit script in use.</p>
<p>A couple of common tools used to create these change emails, along with the buildbot tools to parse them, are:</p>
<dl class="docutils">
<dt>CVS</dt>
<dd><dl class="first last docutils">
<dt>Buildbot CVS MailNotifier</dt>
<dd><a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">CVSMaildirSource</span></code></a></dd>
</dl>
</dd>
<dt>SVN</dt>
<dd><dl class="first last docutils">
<dt>svnmailer</dt>
<dd><a class="reference external" href="http://opensource.perlig.de/en/svnmailer/">http://opensource.perlig.de/en/svnmailer/</a></dd>
<dt><code class="file docutils literal"><span class="pre">commit-email.pl</span></code></dt>
<dd><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNCommitEmailMaildirSource</span></code></a></dd>
</dl>
</dd>
<dt>Bzr</dt>
<dd><dl class="first last docutils">
<dt>Launchpad</dt>
<dd><a class="reference internal" href="#chsrc-BzrLaunchpadEmailMaildirSource" title="BzrLaunchpadEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BzrLaunchpadEmailMaildirSource</span></code></a></dd>
</dl>
</dd>
<dt>Mercurial</dt>
<dd><dl class="first last docutils">
<dt>NotifyExtension</dt>
<dd><a class="reference external" href="https://www.mercurial-scm.org/wiki/NotifyExtension">https://www.mercurial-scm.org/wiki/NotifyExtension</a></dd>
</dl>
</dd>
<dt>Git</dt>
<dd><dl class="first last docutils">
<dt>post-receive-email</dt>
<dd><a class="reference external" href="http://git.kernel.org/?p=git/git.git;a=blob;f=contrib/hooks/post-receive-email;hb=HEAD">http://git.kernel.org/?p=git/git.git;a=blob;f=contrib/hooks/post-receive-email;hb=HEAD</a></dd>
</dl>
</dd>
</dl>
<p>The following sections describe the parsers available for each of these tools.</p>
<p>Most of these parsers accept a <code class="docutils literal"><span class="pre">prefix=</span></code> argument, which is used to limit the set of files that the buildmaster pays attention to.
This is most useful for systems like CVS and SVN which put multiple projects in a single repository (or use repository names to indicate branches).
Each filename that appears in the email is tested against the prefix: if the filename does not start with the prefix, the file is ignored.
If the filename <em>does</em> start with the prefix, that prefix is stripped from the filename before any further processing is done.
Thus the prefix usually ends with a slash.</p>
</div>
<div class="section" id="cvsmaildirsource">
<span id="chsrc-CVSMaildirSource"></span><span id="id7"></span><h3><a class="toc-backref" href="#id28">CVSMaildirSource</a><a class="headerlink" href="#cvsmaildirsource" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.changes.mail.CVSMaildirSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.mail.</code><code class="descname">CVSMaildirSource</code><a class="headerlink" href="#buildbot.changes.mail.CVSMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This parser works with the <code class="file docutils literal"><span class="pre">buildbot_cvs_maildir.py</span></code> script in the contrib directory.</p>
<p>The script sends an email containing all the files submitted in one directory.
It is invoked by using the <code class="file docutils literal"><span class="pre">CVSROOT/loginfo</span></code> facility.</p>
<p>The Buildbot's <a class="reference internal" href="#chsrc-CVSMaildirSource" title="CVSMaildirSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">CVSMaildirSource</span></code></a> knows how to parse these messages and turn them into Change objects.
It takes the directory name of the maildir root.
For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">CVSMaildirSource</span><span class="p">(</span><span class="s2">&quot;/home/buildbot/Mail&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="configuration-of-cvs-and-buildbot-cvs-mail-py">
<h4>Configuration of CVS and <code class="file docutils literal"><span class="pre">buildbot_cvs_mail.py</span></code><a class="headerlink" href="#configuration-of-cvs-and-buildbot-cvs-mail-py" title="Permalink to this headline">¶</a></h4>
<p>CVS must be configured to invoke the <code class="file docutils literal"><span class="pre">buildbot_cvs_mail.py</span></code> script when files are checked in.
This is done via the CVS loginfo configuration file.</p>
<p>To update this, first do:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cvs checkout CVSROOT
</pre></div>
</div>
<p>cd to the CVSROOT directory and edit the file loginfo, adding a line like:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>SomeModule /cvsroot/CVSROOT/buildbot_cvs_mail.py --cvsroot :ext:example.com:/cvsroot -e buildbot -P SomeModule %@{sVv@}
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For cvs version 1.12.x, the <code class="docutils literal"><span class="pre">--path</span> <span class="pre">%p</span></code> option is required.
Version 1.11.x and 1.12.x report the directory path differently.</p>
</div>
<p>The above example you put the <code class="file docutils literal"><span class="pre">buildbot_cvs_mail.py</span></code> script under /cvsroot/CVSROOT.
It can be anywhere.
Run the script with --help to see all the options.
At the very least, the options <code class="docutils literal"><span class="pre">-e</span></code> (email) and <code class="docutils literal"><span class="pre">-P</span></code> (project) should be specified.
The line must end with <code class="docutils literal"><span class="pre">%{sVv}</span></code>.
This is expanded to the files that were modified.</p>
<p>Additional entries can be added to support more modules.</p>
<p>See <strong class="command">buildbot_cvs_mail.py --help`</strong> for more information on the available options.</p>
</div>
</div>
<div class="section" id="svncommitemailmaildirsource">
<span id="chsrc-SVNCommitEmailMaildirSource"></span><span id="id8"></span><h3><a class="toc-backref" href="#id29">SVNCommitEmailMaildirSource</a><a class="headerlink" href="#svncommitemailmaildirsource" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.changes.mail.SVNCommitEmailMaildirSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.mail.</code><code class="descname">SVNCommitEmailMaildirSource</code><a class="headerlink" href="#buildbot.changes.mail.SVNCommitEmailMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-SVNCommitEmailMaildirSource" title="SVNCommitEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNCommitEmailMaildirSource</span></code></a> parses message sent out by the <code class="file docutils literal"><span class="pre">commit-email.pl</span></code> script, which is included in the Subversion distribution.</p>
<p>It does not currently handle branches: all of the Change objects that it creates will be associated with the default (i.e. trunk) branch.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNCommitEmailMaildirSource</span><span class="p">(</span><span class="s2">&quot;~/maildir-buildbot&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="bzrlaunchpademailmaildirsource">
<span id="chsrc-BzrLaunchpadEmailMaildirSource"></span><span id="id9"></span><h3><a class="toc-backref" href="#id30">BzrLaunchpadEmailMaildirSource</a><a class="headerlink" href="#bzrlaunchpademailmaildirsource" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="buildbot.changes.mail.BzrLaunchpadEmailMaildirSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.mail.</code><code class="descname">BzrLaunchpadEmailMaildirSource</code><a class="headerlink" href="#buildbot.changes.mail.BzrLaunchpadEmailMaildirSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-BzrLaunchpadEmailMaildirSource" title="BzrLaunchpadEmailMaildirSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BzrLaunchpadEmailMaildirSource</span></code></a> parses the mails that are sent to addresses that subscribe to branch revision notifications for a bzr branch hosted on Launchpad.</p>
<p>The branch name defaults to <code class="samp docutils literal"><span class="pre">lp:</span><em><span class="pre">Launchpad</span> <span class="pre">path</span></em></code>.
For example <code class="docutils literal"><span class="pre">lp:~maria-captains/maria/5.1</span></code>.</p>
<p>If only a single branch is used, the default branch name can be changed by setting <code class="docutils literal"><span class="pre">defaultBranch</span></code>.</p>
<p>For multiple branches, pass a dictionary as the value of the <code class="docutils literal"><span class="pre">branchMap</span></code> option to map specific repository paths to specific branch names (see example below).
The leading <code class="docutils literal"><span class="pre">lp:</span></code> prefix of the path is optional.</p>
<p>The <code class="docutils literal"><span class="pre">prefix</span></code> option is not supported (it is silently ignored).
Use the <code class="docutils literal"><span class="pre">branchMap</span></code> and <code class="docutils literal"><span class="pre">defaultBranch</span></code> instead to assign changes to branches (and just do not subscribe the buildbot to branches that are not of interest).</p>
<p>The revision number is obtained from the email text.
The bzr revision id is not available in the mails sent by Launchpad.
However, it is possible to set the bzr <cite>append_revisions_only</cite> option for public shared repositories to avoid new pushes of merges changing the meaning of old revision numbers.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">bm</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;lp:~maria-captains/maria/5.1&#39;</span><span class="p">:</span> <span class="s1">&#39;5.1&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lp:~maria-captains/maria/6.0&#39;</span><span class="p">:</span> <span class="s1">&#39;6.0&#39;</span>
<span class="p">}</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">BzrLaunchpadEmailMaildirSource</span><span class="p">(</span><span class="s2">&quot;~/maildir-buildbot&quot;</span><span class="p">,</span>
                                                            <span class="n">branchMap</span><span class="o">=</span><span class="n">bm</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pbchangesource">
<span id="chsrc-PBChangeSource"></span><span id="id10"></span><h2><a class="toc-backref" href="#id31">2.4.3.4. PBChangeSource</a><a class="headerlink" href="#pbchangesource" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.changes.pb.PBChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.pb.</code><code class="descname">PBChangeSource</code><a class="headerlink" href="#buildbot.changes.pb.PBChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> actually listens on a TCP port for clients to connect and push change notices <em>into</em> the Buildmaster.
This is used by the built-in <code class="docutils literal"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code> notification tool, as well as several version-control hook scripts.
This change is also useful for creating new kinds of change sources that work on a <cite>push</cite> model instead of some kind of subscription scheme, for example a script which is run out of an email <code class="file docutils literal"><span class="pre">.forward</span></code> file.
This ChangeSource always runs on the same TCP port as the workers.
It shares the same protocol, and in fact shares the same space of &quot;usernames&quot;, so you cannot configure a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> with the same name as a worker.</p>
<p>If you have a publicly accessible worker port, and are using <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a>, <em>you must establish a secure username and password for the change source</em>.
If your sendchange credentials are known (e.g., the defaults), then your buildmaster is susceptible to injection of arbitrary changes, which (depending on the build factories) could lead to arbitrary code execution on workers.</p>
<p>The <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> is created with the following arguments.</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">port</span></code></dt>
<dd>which port to listen on.
If <code class="docutils literal"><span class="pre">None</span></code> (which is the default), it shares the port used for worker connections.</dd>
<dt><code class="docutils literal"><span class="pre">user</span></code></dt>
<dd>The user account that the client program must use to connect.
Defaults to <code class="docutils literal"><span class="pre">change</span></code></dd>
<dt><code class="docutils literal"><span class="pre">passwd</span></code></dt>
<dd>The password for the connection - defaults to <code class="docutils literal"><span class="pre">changepw</span></code>.
Do not use this default on a publicly exposed port!</dd>
<dt><code class="docutils literal"><span class="pre">prefix</span></code></dt>
<dd><p class="first">The prefix to be found and stripped from filenames delivered over the connection, defaulting to <code class="docutils literal"><span class="pre">None</span></code>.
Any filenames which do not start with this prefix will be removed.
If all the filenames in a given Change are removed, the that whole Change will be dropped.
This string should probably end with a directory separator.</p>
<p class="last">This is useful for changes coming from version control systems that represent branches as parent directories within the repository (like SVN and Perforce).
Use a prefix of <code class="docutils literal"><span class="pre">trunk/</span></code> or <code class="docutils literal"><span class="pre">project/branches/foobranch/</span></code> to only follow one branch and to get correct tree-relative filenames.
Without a prefix, the <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a> will probably deliver Changes with filenames like <code class="file docutils literal"><span class="pre">trunk/foo.c</span></code> instead of just <code class="file docutils literal"><span class="pre">foo.c</span></code>.
Of course this also depends upon the tool sending the Changes in (like <a class="reference internal" href="cmdline.html#cmdline-sendchange" title="sendchange"><code class="xref bb bb-cmdline docutils literal"><span class="pre">buildbot</span> <span class="pre">sendchange</span></code></a>) and what filenames it is delivering: that tool may be filtering and stripping prefixes at the sending end.</p>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">PBChangeSource</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">9999</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s1">&#39;laura&#39;</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s1">&#39;fpga&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The following hooks are useful for sending changes to a <a class="reference internal" href="#chsrc-PBChangeSource" title="PBChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">PBChangeSource</span></code></a>:</p>
<div class="section" id="bzr-hook">
<span id="id11"></span><h3><a class="toc-backref" href="#id32">Bzr Hook</a><a class="headerlink" href="#bzr-hook" title="Permalink to this headline">¶</a></h3>
<p>Bzr is also written in Python, and the Bzr hook depends on Twisted to send the changes.</p>
<p>To install, put <code class="file docutils literal"><span class="pre">contrib/bzr_buildbot.py</span></code> in one of your plugins locations a bzr plugins directory (e.g., <code class="file docutils literal"><span class="pre">~/.bazaar/plugins</span></code>).
Then, in one of your bazaar conf files (e.g., <code class="file docutils literal"><span class="pre">~/.bazaar/locations.conf</span></code>), set the location you want to connect with buildbot with these keys:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">buildbot_on</span></code>
one of 'commit', 'push, or 'change'.
Turns the plugin on to report changes via commit, changes via push, or any changes to the trunk.
'change' is recommended.</li>
<li><code class="docutils literal"><span class="pre">buildbot_server</span></code>
(required to send to a buildbot master) the URL of the buildbot master to which you will connect (as of this writing, the same server and port to which workers connect).</li>
<li><code class="docutils literal"><span class="pre">buildbot_port</span></code>
(optional, defaults to 9989) the port of the buildbot master to which you will connect (as of this writing, the same server and port to which workers connect)</li>
<li><code class="docutils literal"><span class="pre">buildbot_pqm</span></code>
(optional, defaults to not pqm) Normally, the user that commits the revision is the user that is responsible for the change.
When run in a pqm (Patch Queue Manager, see <a class="reference external" href="https://launchpad.net/pqm">https://launchpad.net/pqm</a>) environment, the user that commits is the Patch Queue Manager, and the user that committed the <em>parent</em> revision is responsible for the change.
To turn on the pqm mode, set this value to any of (case-insensitive) &quot;Yes&quot;, &quot;Y&quot;, &quot;True&quot;, or &quot;T&quot;.</li>
<li><code class="docutils literal"><span class="pre">buildbot_dry_run</span></code>
(optional, defaults to not a dry run) Normally, the post-commit hook will attempt to communicate with the configured buildbot server and port.
If this parameter is included and any of (case-insensitive) &quot;Yes&quot;, &quot;Y&quot;, &quot;True&quot;, or &quot;T&quot;, then the hook will simply print what it would have sent, but not attempt to contact the buildbot master.</li>
<li><code class="docutils literal"><span class="pre">buildbot_send_branch_name</span></code>
(optional, defaults to not sending the branch name) If your buildbot's bzr source build step uses a repourl, do <em>not</em> turn this on.
If your buildbot's bzr build step uses a baseURL, then you may set this value to any of (case-insensitive) &quot;Yes&quot;, &quot;Y&quot;, &quot;True&quot;, or &quot;T&quot; to have the buildbot master append the branch name to the baseURL.</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The bzr smart server (as of version 2.2.2) doesn't know how to resolve <code class="docutils literal"><span class="pre">bzr://</span></code> urls into absolute paths so any paths in <code class="docutils literal"><span class="pre">locations.conf</span></code> won't match, hence no change notifications will be sent to Buildbot.
Setting configuration parameters globally or in-branch might still work.
When buildbot no longer has a hardcoded password, it will be a configuration option here as well.</p>
</div>
<p>Here's a simple example that you might have in your <code class="file docutils literal"><span class="pre">~/.bazaar/locations.conf</span></code>.</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[chroot-*:///var/local/myrepo/mybranch]</span>
<span class="na">buildbot_on</span> <span class="o">=</span> <span class="s">change</span>
<span class="na">buildbot_server</span> <span class="o">=</span> <span class="s">localhost</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="p4source">
<span id="chsrc-P4Source"></span><span id="id12"></span><h2><a class="toc-backref" href="#id33">2.4.3.5. P4Source</a><a class="headerlink" href="#p4source" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal"><span class="pre">P4Source</span></code></a> periodically polls a <a class="reference external" href="http://www.perforce.com/">Perforce</a> depot for changes.
It accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">p4port</span></code></dt>
<dd>The Perforce server to connect to (as <code class="samp docutils literal"><em><span class="pre">host</span></em><span class="pre">:</span><em><span class="pre">port</span></em></code>).</dd>
<dt><code class="docutils literal"><span class="pre">p4user</span></code></dt>
<dd>The Perforce user.</dd>
<dt><code class="docutils literal"><span class="pre">p4passwd</span></code></dt>
<dd>The Perforce password.</dd>
<dt><code class="docutils literal"><span class="pre">p4base</span></code></dt>
<dd>The base depot path to watch, without the trailing '/...'.</dd>
<dt><code class="docutils literal"><span class="pre">p4bin</span></code></dt>
<dd>An optional string parameter.
Specify the location of the perforce command line binary (p4).
You only need to do this if the perforce binary is not in the path of the buildbot user.
Defaults to <cite>p4</cite>.</dd>
<dt><code class="docutils literal"><span class="pre">split_file</span></code></dt>
<dd>A function that maps a pathname, without the leading <code class="docutils literal"><span class="pre">p4base</span></code>, to a (branch, filename) tuple.
The default just returns <code class="docutils literal"><span class="pre">(None,</span> <span class="pre">branchfile)</span></code>, which effectively disables branch support.
You should supply a function which understands your repository structure.</dd>
<dt><code class="docutils literal"><span class="pre">pollInterval</span></code></dt>
<dd>How often to poll, in seconds.
Defaults to 600 (10 minutes).</dd>
<dt><code class="docutils literal"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-P4Source" title="P4Source"><code class="xref bb bb-chsrc docutils literal"><span class="pre">P4Source</span></code></a>.
This will then be set in any changes generated by the <code class="docutils literal"><span class="pre">P4Source</span></code>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch, False = wait for one pollInterval (default).</dd>
<dt><code class="docutils literal"><span class="pre">histmax</span></code></dt>
<dd>The maximum number of changes to inspect at a time.
If more than this number occur since the last poll, older changes will be silently ignored.</dd>
<dt><code class="docutils literal"><span class="pre">encoding</span></code></dt>
<dd>The character encoding of <code class="docutils literal"><span class="pre">p4</span></code>'s output.
This defaults to &quot;utf8&quot;, but if your commit messages are in another encoding, specify that here.
For example, if you're using Perforce on Windows, you may need to use &quot;cp437&quot; as the encoding if &quot;utf8&quot; generates errors in your master log.</dd>
<dt><code class="docutils literal"><span class="pre">server_tz</span></code></dt>
<dd>The timezone of the Perforce server, using the usual timezone format (e.g: <code class="docutils literal"><span class="pre">&quot;Europe/Stockholm&quot;</span></code>) in case it's not in UTC.</dd>
<dt><code class="docutils literal"><span class="pre">use_tickets</span></code></dt>
<dd>Set to <code class="docutils literal"><span class="pre">True</span></code> to use ticket-based authentication, instead of passwords (but you still need to specify <code class="docutils literal"><span class="pre">p4passwd</span></code>).</dd>
<dt><code class="docutils literal"><span class="pre">ticket_login_interval</span></code></dt>
<dd>How often to get a new ticket, in seconds, when <code class="docutils literal"><span class="pre">use_tickets</span></code> is enabled.
Defaults to 86400 (24 hours).</dd>
</dl>
<div class="section" id="example">
<h3><a class="toc-backref" href="#id34">Example</a><a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>This configuration uses the <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal"><span class="pre">P4PORT</span></code>, <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal"><span class="pre">P4USER</span></code>, and <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal"><span class="pre">P4PASSWD</span></code> specified in the buildmaster's environment.
It watches a project in which the branch name is simply the next path component, and the file is all path components after.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">P4Source</span><span class="p">(</span><span class="n">p4base</span><span class="o">=</span><span class="s1">&#39;//depot/project/&#39;</span><span class="p">,</span>
                     <span class="n">split_file</span><span class="o">=</span><span class="k">lambda</span> <span class="n">branchfile</span><span class="p">:</span> <span class="n">branchfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="svnpoller">
<span id="chsrc-SVNPoller"></span><span id="id13"></span><h2><a class="toc-backref" href="#id35">2.4.3.6. SVNPoller</a><a class="headerlink" href="#svnpoller" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.changes.svnpoller.SVNPoller">
<em class="property">class </em><code class="descclassname">buildbot.changes.svnpoller.</code><code class="descname">SVNPoller</code><a class="headerlink" href="#buildbot.changes.svnpoller.SVNPoller" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> is a ChangeSource which periodically polls a <a class="reference external" href="http://subversion.tigris.org/">Subversion</a> repository for new revisions, by running the <code class="docutils literal"><span class="pre">svn</span> <span class="pre">log</span></code> command in a subshell.
It can watch a single branch or multiple branches.</p>
<p><a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">repourl</span></code></dt>
<dd><p class="first">The base URL path to watch, like <code class="docutils literal"><span class="pre">svn://svn.twistedmatrix.com/svn/Twisted/trunk</span></code>, or <code class="docutils literal"><span class="pre">http://divmod.org/svn/Divmo/</span></code>, or even <code class="docutils literal"><span class="pre">file:///home/svn/Repository/ProjectA/branches/1.5/</span></code>.
This must include the access scheme, the location of the repository (both the hostname for remote ones, and any additional directory names necessary to get to the repository), and the sub-path within the repository's virtual filesystem for the project and branch of interest.</p>
<p class="last">The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> will only pay attention to files inside the subdirectory specified by the complete repourl.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">split_file</span></code></dt>
<dd><p class="first">A function to convert pathnames into <code class="docutils literal"><span class="pre">(branch,</span> <span class="pre">relative_pathname)</span></code> tuples.
Use this to explain your repository's branch-naming policy to <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a>.
This function must accept a single string (the pathname relative to the repository) and return a two-entry tuple.
Directory pathnames always end with a right slash to distinguish them from files, like <code class="docutils literal"><span class="pre">trunk/src/</span></code>, or <code class="docutils literal"><span class="pre">src/</span></code>.
There are a few utility functions in <code class="xref py py-mod docutils literal"><span class="pre">buildbot.changes.svnpoller</span></code> that can be used as a <code class="xref py py-meth docutils literal"><span class="pre">split_file</span></code> function; see below for details.</p>
<p>For directories, the relative pathname returned by <code class="xref py py-meth docutils literal"><span class="pre">split_file</span></code> should end with a right slash but an empty string is also accepted for the root, like <code class="docutils literal"><span class="pre">(&quot;branches/1.5.x&quot;,</span> <span class="pre">&quot;&quot;)</span></code> being converted from <code class="docutils literal"><span class="pre">&quot;branches/1.5.x/&quot;</span></code>.</p>
<p>The default value always returns <code class="docutils literal"><span class="pre">(None,</span> <span class="pre">path)</span></code>, which indicates that all files are on the trunk.</p>
<p class="last">Subclasses of <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> can override the <code class="xref py py-meth docutils literal"><span class="pre">split_file</span></code> method instead of using the <code class="docutils literal"><span class="pre">split_file=</span></code> argument.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a>, and can be used in a <a class="reference internal" href="cfg-schedulers.html#change-filters"><span class="std std-ref">Change Filter</span></a> for triggering particular builders.</dd>
<dt><code class="docutils literal"><span class="pre">svnuser</span></code></dt>
<dd>An optional string parameter.
If set, the option <cite>--user</cite> argument will be added to all <strong class="command">svn</strong> commands.
Use this if you have to authenticate to the svn server before you can do <strong class="command">svn info</strong> or <strong class="command">svn log</strong> commands.</dd>
<dt><code class="docutils literal"><span class="pre">svnpasswd</span></code></dt>
<dd>Like <code class="docutils literal"><span class="pre">svnuser</span></code>, this will cause a option <cite>--password</cite> argument to be passed to all <strong class="command">svn</strong> commands.</dd>
<dt><code class="docutils literal"><span class="pre">pollInterval</span></code></dt>
<dd>How often to poll, in seconds.
Defaults to 600 (checking once every 10 minutes).
Lower this if you want the buildbot to notice changes faster, raise it if you want to reduce the network and CPU load on your svn server.
Please be considerate of public SVN repositories by using a large interval when polling them.</dd>
<dt><code class="docutils literal"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch, False = wait for one pollInterval (default).</dd>
<dt><code class="docutils literal"><span class="pre">histmax</span></code></dt>
<dd>The maximum number of changes to inspect at a time.
Every <code class="docutils literal"><span class="pre">pollInterval</span></code> seconds, the <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> asks for the last <code class="docutils literal"><span class="pre">histmax</span></code> changes and looks through them for any revisions it does not already know about.
If more than <code class="docutils literal"><span class="pre">histmax</span></code> revisions have been committed since the last poll, older changes will be silently ignored.
Larger values of <code class="docutils literal"><span class="pre">histmax</span></code> will cause more time and memory to be consumed on each poll attempt.
<code class="docutils literal"><span class="pre">histmax</span></code> defaults to 100.</dd>
<dt><code class="docutils literal"><span class="pre">svnbin</span></code></dt>
<dd>This controls the <strong class="command">svn</strong> executable to use.
If subversion is installed in a weird place on your system (outside of the buildmaster's <span class="target" id="index-4"></span><code class="xref std std-envvar docutils literal"><span class="pre">PATH</span></code>), use this to tell <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> where to find it.
The default value of <cite>svn</cite> will almost always be sufficient.</dd>
<dt><code class="docutils literal"><span class="pre">revlinktmpl</span></code></dt>
<dd>This parameter is deprecated in favour of specifying a global revlink option.
This parameter allows a link to be provided for each revision (for example, to websvn or viewvc).
These links appear anywhere changes are shown, such as on build or change pages.
The proper form for this parameter is an URL with the portion that will substitute for a revision number replaced by ''%s''.
For example, <code class="docutils literal"><span class="pre">'http://myserver/websvn/revision.php?rev=%s'</span></code> could be used to cause revision links to be created to a websvn repository viewer.</dd>
<dt><code class="docutils literal"><span class="pre">cachepath</span></code></dt>
<dd>If specified, this is a pathname of a cache file that <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> will use to store its state between restarts of the master.</dd>
<dt><code class="docutils literal"><span class="pre">extra_args</span></code></dt>
<dd>If specified, the extra arguments will be added to the svn command args.</dd>
</dl>
<p>Several split file functions are available for common SVN repository layouts.
For a poller that is only monitoring trunk, the default split file function is available explicitly as <code class="docutils literal"><span class="pre">split_file_alwaystrunk</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;svn://svn.twistedmatrix.com/svn/Twisted/trunk&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_alwaystrunk</span><span class="p">)</span>
</pre></div>
</div>
<p>For repositories with the <code class="docutils literal"><span class="pre">/trunk</span></code> and <code class="samp docutils literal"><span class="pre">/branches/</span><em><span class="pre">BRANCH</span></em></code> layout, <code class="docutils literal"><span class="pre">split_file_branches</span></code> will do the job:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/amanda&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>When using this splitter the poller will set the <code class="docutils literal"><span class="pre">project</span></code> attribute of any changes to the <code class="docutils literal"><span class="pre">project</span></code> attribute of the poller.</p>
<p>For repositories with the <code class="samp docutils literal"><em><span class="pre">PROJECT</span></em><span class="pre">/trunk</span></code> and <code class="samp docutils literal"><em><span class="pre">PROJECT</span></em><span class="pre">/branches/</span><em><span class="pre">BRANCH</span></em></code> layout, <code class="docutils literal"><span class="pre">split_file_projects_branches</span></code> will do the job:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span><span class="p">,</span> <span class="n">util</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">SVNPoller</span><span class="p">(</span>
    <span class="n">repourl</span><span class="o">=</span><span class="s2">&quot;https://amanda.svn.sourceforge.net/svnroot/amanda/&quot;</span><span class="p">,</span>
    <span class="n">split_file</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">svn</span><span class="o">.</span><span class="n">split_file_projects_branches</span><span class="p">)</span>
</pre></div>
</div>
<p>When using this splitter the poller will set the <code class="docutils literal"><span class="pre">project</span></code> attribute of any changes to the project determined by the splitter.</p>
<p>The <a class="reference internal" href="#chsrc-SVNPoller" title="SVNPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">SVNPoller</span></code></a> is highly adaptable to various Subversion layouts.
See <a class="reference internal" href="customization.html#customizing-svnpoller"><span class="std std-ref">Customizing SVNPoller</span></a> for details and some common scenarios.</p>
</div>
<div class="section" id="bzr-poller">
<span id="chsrc-BzrPoller"></span><span id="id14"></span><h2><a class="toc-backref" href="#id36">2.4.3.7. Bzr Poller</a><a class="headerlink" href="#bzr-poller" title="Permalink to this headline">¶</a></h2>
<p>If you cannot insert a Bzr hook in the server, you can use the Bzr Poller.
To use, put <code class="file docutils literal"><span class="pre">contrib/bzr_buildbot.py</span></code> somewhere that your buildbot configuration can import it.
Even putting it in the same directory as the <code class="file docutils literal"><span class="pre">master.cfg</span></code> should work.
Install the poller in the buildbot configuration as with any other change source.
Minimally, provide a URL that you want to poll (<code class="docutils literal"><span class="pre">bzr://</span></code>, <code class="docutils literal"><span class="pre">bzr+ssh://</span></code>, or <code class="docutils literal"><span class="pre">lp:</span></code>), making sure the buildbot user has necessary privileges.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># put bzr_buildbot.py file to the same directory as master.cfg</span>
<span class="kn">from</span> <span class="nn">bzr_buildbot</span> <span class="k">import</span> <span class="n">BzrPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">BzrPoller</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;bzr://hostname/my_project&#39;</span><span class="p">,</span>
    <span class="n">poll_interval</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">BzrPoller</span></code> parameters are:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">url</span></code></dt>
<dd>The URL to poll.</dd>
<dt><code class="docutils literal"><span class="pre">poll_interval</span></code></dt>
<dd>The number of seconds to wait between polls.
Defaults to 10 minutes.</dd>
<dt><code class="docutils literal"><span class="pre">branch_name</span></code></dt>
<dd>Any value to be used as the branch name.
Defaults to None, or specify a string, or specify the constants from <code class="file docutils literal"><span class="pre">bzr_buildbot.py</span></code> <code class="docutils literal"><span class="pre">SHORT</span></code> or <code class="docutils literal"><span class="pre">FULL</span></code> to get the short branch name or full branch address.</dd>
<dt><code class="docutils literal"><span class="pre">blame_merge_author</span></code></dt>
<dd>normally, the user that commits the revision is the user that is responsible for the change.
When run in a pqm (Patch Queue Manager, see <a class="reference external" href="https://launchpad.net/pqm">https://launchpad.net/pqm</a>) environment, the user that commits is the Patch Queue Manager, and the user that committed the merged, <em>parent</em> revision is responsible for the change.
Set this value to <code class="docutils literal"><span class="pre">True</span></code> if this is pointed against a PQM-managed branch.</dd>
</dl>
</div>
<div class="section" id="gitpoller">
<span id="chsrc-GitPoller"></span><span id="id15"></span><h2><a class="toc-backref" href="#id37">2.4.3.8. GitPoller</a><a class="headerlink" href="#gitpoller" title="Permalink to this headline">¶</a></h2>
<p>If you cannot take advantage of post-receive hooks as provided by <code class="file docutils literal"><span class="pre">contrib/git_buildbot.py</span></code> for example, then you can use the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></code></a>.</p>
<p>The <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></code></a> periodically fetches from a remote Git repository and processes any changes.
It requires its own working directory for operation.
The default should be adequate, but it can be overridden via the <code class="docutils literal"><span class="pre">workdir</span></code> property.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There can only be a single <cite>GitPoller</cite> pointed at any given repository.</p>
</div>
<p>The <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></code></a> requires Git-1.7 and later.
It accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">repourl</span></code></dt>
<dd>the git-url that describes the remote repository, e.g. <code class="docutils literal"><span class="pre">git&#64;example.com:foobaz/myrepo.git</span></code> (see the <strong class="command">git fetch</strong> help for more info on git-url formats)</dd>
<dt><code class="docutils literal"><span class="pre">branches</span></code></dt>
<dd><p class="first">One of the following:</p>
<ul class="last simple">
<li>a list of the branches to fetch.</li>
<li><code class="docutils literal"><span class="pre">True</span></code> indicating that all branches should be fetched</li>
<li>a callable which takes a single argument.
It should take a remote refspec (such as <code class="docutils literal"><span class="pre">'refs/heads/master'</span></code>, and return a boolean indicating whether that branch should be fetched.</li>
</ul>
</dd>
<dt><code class="docutils literal"><span class="pre">branch</span></code></dt>
<dd>accepts a single branch name to fetch.
Exists for backwards compatibility with old configurations.</dd>
<dt><code class="docutils literal"><span class="pre">pollInterval</span></code></dt>
<dd>interval in seconds between polls, default is 10 minutes</dd>
<dt><code class="docutils literal"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch, False = wait for one pollInterval (default).</dd>
<dt><code class="docutils literal"><span class="pre">buildPushesWithNoCommits</span></code></dt>
<dd>Determine if a push on a new branch with already known commits should trigger a build. (defaults to False).</dd>
<dt><code class="docutils literal"><span class="pre">gitbin</span></code></dt>
<dd>path to the Git binary, defaults to just <code class="docutils literal"><span class="pre">'git'</span></code></dd>
<dt><code class="docutils literal"><span class="pre">category</span></code></dt>
<dd>Set the category to be used for the changes produced by the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></code></a>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-GitPoller" title="GitPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GitPoller</span></code></a>.
This will then be set in any changes generated by the <code class="docutils literal"><span class="pre">GitPoller</span></code>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal"><span class="pre">usetimestamps</span></code></dt>
<dd>parse each revision's commit timestamp (default is <code class="docutils literal"><span class="pre">True</span></code>), or ignore it in favor of the current time (so recently processed commits appear together in the waterfall page)</dd>
<dt><code class="docutils literal"><span class="pre">encoding</span></code></dt>
<dd>Set encoding will be used to parse author's name and commit message.
Default encoding is <code class="docutils literal"><span class="pre">'utf-8'</span></code>.
This will not be applied to file names since Git will translate non-ascii file names to unreadable escape sequences.</dd>
<dt><code class="docutils literal"><span class="pre">workdir</span></code></dt>
<dd>the directory where the poller should keep its local repository.
The default is <code class="samp docutils literal"><span class="pre">gitpoller_work</span></code>.
If this is a relative path, it will be interpreted relative to the master's basedir.
Multiple Git pollers can share the same directory.</dd>
</dl>
<p>A configuration for the Git poller might look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">GitPoller</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;git@example.com:foobaz/myrepo.git&#39;</span><span class="p">,</span>
                                       <span class="n">branches</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;master&#39;</span><span class="p">,</span> <span class="s1">&#39;great_new_feature&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="hgpoller">
<span id="chsrc-HgPoller"></span><span id="id16"></span><h2><a class="toc-backref" href="#id38">2.4.3.9. HgPoller</a><a class="headerlink" href="#hgpoller" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a> periodically pulls a named branch from a remote Mercurial repository and processes any changes.
It requires its own working directory for operation, which must be specified via the <code class="docutils literal"><span class="pre">workdir</span></code> property.</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a> requires a working <code class="docutils literal"><span class="pre">hg</span></code> executable, and at least a read-only access to the repository it polls (possibly through ssh keys or by tweaking the <code class="docutils literal"><span class="pre">hgrc</span></code> of the system user buildbot runs as).</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a> will not transmit any change if there are several heads on the watched named branch.
This is similar (although not identical) to the Mercurial executable behaviour.
This exceptional condition is usually the result of a developer mistake, and usually does not last for long.
It is reported in logs.
If fixed by a later merge, the buildmaster administrator does not have anything to do: that merge will be transmitted, together with the intermediate ones.</p>
<p>The <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">name</span></code></dt>
<dd>the name of the poller.
This must be unique, and defaults to the <code class="docutils literal"><span class="pre">repourl</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">repourl</span></code></dt>
<dd>the url that describes the remote repository, e.g. <code class="docutils literal"><span class="pre">http://hg.example.com/projects/myrepo</span></code>.
Any url suitable for <code class="docutils literal"><span class="pre">hg</span> <span class="pre">pull</span></code> can be specified.</dd>
<dt><code class="docutils literal"><span class="pre">branch</span></code></dt>
<dd>the desired branch to pull, will default to <code class="docutils literal"><span class="pre">'default'</span></code></dd>
<dt><code class="docutils literal"><span class="pre">workdir</span></code></dt>
<dd><p class="first">the directory where the poller should keep its local repository.
It is mandatory for now, although later releases may provide a meaningful default.</p>
<p>It also serves to identify the poller in the buildmaster internal database.
Changing it may result in re-processing all changes so far.</p>
<p>Several <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a> instances may share the same <code class="docutils literal"><span class="pre">workdir</span></code> for mutualisation of the common history between two different branches, thus easing on local and remote system resources and bandwidth.</p>
<p class="last">If relative, the <code class="docutils literal"><span class="pre">workdir</span></code> will be interpreted from the master directory.</p>
</dd>
<dt><code class="docutils literal"><span class="pre">pollInterval</span></code></dt>
<dd>interval in seconds between polls, default is 10 minutes</dd>
<dt><code class="docutils literal"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
True = immediately on launch, False = wait for one pollInterval (default).</dd>
<dt><code class="docutils literal"><span class="pre">hgbin</span></code></dt>
<dd>path to the Mercurial binary, defaults to just <code class="docutils literal"><span class="pre">'hg'</span></code></dd>
<dt><code class="docutils literal"><span class="pre">category</span></code></dt>
<dd>Set the category to be used for the changes produced by the <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-HgPoller" title="HgPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">HgPoller</span></code></a>.
This will then be set in any changes generated by the <code class="docutils literal"><span class="pre">HgPoller</span></code>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal"><span class="pre">usetimestamps</span></code></dt>
<dd>parse each revision's commit timestamp (default is <code class="docutils literal"><span class="pre">True</span></code>), or ignore it in favor of the current time (so recently processed commits appear together in the waterfall page)</dd>
<dt><code class="docutils literal"><span class="pre">encoding</span></code></dt>
<dd>Set encoding will be used to parse author's name and commit message.
Default encoding is <code class="docutils literal"><span class="pre">'utf-8'</span></code>.</dd>
</dl>
<p>A configuration for the Mercurial poller might look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">HgPoller</span><span class="p">(</span><span class="n">repourl</span><span class="o">=</span><span class="s1">&#39;http://hg.example.org/projects/myrepo&#39;</span><span class="p">,</span>
                                      <span class="n">branch</span><span class="o">=</span><span class="s1">&#39;great_new_feature&#39;</span><span class="p">,</span>
                                      <span class="n">workdir</span><span class="o">=</span><span class="s1">&#39;hg-myrepo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="bitbucketpullrequestpoller">
<span id="chsrc-BitbucketPullrequestPoller"></span><span id="id17"></span><h2><a class="toc-backref" href="#id39">2.4.3.10. BitbucketPullrequestPoller</a><a class="headerlink" href="#bitbucketpullrequestpoller" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.changes.bitbucket.BitbucketPullrequestPoller">
<em class="property">class </em><code class="descclassname">buildbot.changes.bitbucket.</code><code class="descname">BitbucketPullrequestPoller</code><a class="headerlink" href="#buildbot.changes.bitbucket.BitbucketPullrequestPoller" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BitbucketPullrequestPoller</span></code></a> periodically polls Bitbucket for new or updated pull requests.
It uses Bitbuckets powerful <a class="reference external" href="https://confluence.atlassian.com/display/BITBUCKET/pullrequests+Resource">Pull Request REST API</a> to gather the information needed.</p>
<p>The <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BitbucketPullrequestPoller</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">owner</span></code></dt>
<dd>The owner of the Bitbucket repository.
All Bitbucket Urls are of the form <code class="docutils literal"><span class="pre">https://bitbucket.org/owner/slug/</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">slug</span></code></dt>
<dd>The name of the Bitbucket repository.</dd>
<dt><code class="docutils literal"><span class="pre">branch</span></code></dt>
<dd>A single branch or a list of branches which should be processed.
If it is <code class="docutils literal"><span class="pre">None</span></code> (the default) all pull requests are used.</dd>
<dt><code class="docutils literal"><span class="pre">pollInterval</span></code></dt>
<dd>Interval in seconds between polls, default is 10 minutes.</dd>
<dt><code class="docutils literal"><span class="pre">pollAtLaunch</span></code></dt>
<dd>Determines when the first poll occurs.
<code class="docutils literal"><span class="pre">True</span></code> = immediately on launch, <code class="docutils literal"><span class="pre">False</span></code> = wait for one <code class="docutils literal"><span class="pre">pollInterval</span></code> (default).</dd>
<dt><code class="docutils literal"><span class="pre">category</span></code></dt>
<dd>Set the category to be used for the changes produced by the <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BitbucketPullrequestPoller</span></code></a>.
This will then be set in any changes generated by the <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BitbucketPullrequestPoller</span></code></a>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal"><span class="pre">project</span></code></dt>
<dd>Set the name of the project to be used for the <a class="reference internal" href="#chsrc-BitbucketPullrequestPoller" title="BitbucketPullrequestPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">BitbucketPullrequestPoller</span></code></a>.
This will then be set in any changes generated by the <code class="docutils literal"><span class="pre">BitbucketPullrequestPoller</span></code>, and can be used in a Change Filter for triggering particular builders.</dd>
<dt><code class="docutils literal"><span class="pre">pullrequest_filter</span></code></dt>
<dd>A callable which takes one parameter, the decoded Python object of the pull request JSON.
If the it returns <code class="docutils literal"><span class="pre">False</span></code> the pull request is ignored.
It can be used to define custom filters based on the content of the pull request.
See the Bitbucket documentation for more information about the format of the response.
By default the filter always returns <code class="docutils literal"><span class="pre">True</span></code>.</dd>
<dt><code class="docutils literal"><span class="pre">usetimestamps</span></code></dt>
<dd>parse each revision's commit timestamp (default is <code class="docutils literal"><span class="pre">True</span></code>), or ignore it in favor of the current time (so recently processed commits appear together in the waterfall page)</dd>
<dt><code class="docutils literal"><span class="pre">encoding</span></code></dt>
<dd>Set encoding will be used to parse author's name and commit message.
Default encoding is <code class="docutils literal"><span class="pre">'utf-8'</span></code>.</dd>
</dl>
<p>A minimal configuration for the Bitbucket pull request poller might look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">BitbucketPullrequestPoller</span><span class="p">(</span>
    <span class="n">owner</span><span class="o">=</span><span class="s1">&#39;myname&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s1">&#39;myrepo&#39;</span><span class="p">,</span>
  <span class="p">)</span>
</pre></div>
</div>
<p>Here is a more complex configuration using a <code class="docutils literal"><span class="pre">pullrequest_filter</span></code>.
The pull request is only processed if at least 3 people have already approved it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">approve_filter</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
    <span class="n">approves</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">participant</span> <span class="ow">in</span> <span class="n">pr</span><span class="p">[</span><span class="s1">&#39;participants&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">participant</span><span class="p">[</span><span class="s1">&#39;approved&#39;</span><span class="p">]:</span>
            <span class="n">approves</span> <span class="o">=</span> <span class="n">approves</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">approves</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">BitbucketPullrequestPoller</span><span class="p">(</span>
    <span class="n">owner</span><span class="o">=</span><span class="s1">&#39;myname&#39;</span><span class="p">,</span>
    <span class="n">slug</span><span class="o">=</span><span class="s1">&#39;myrepo&#39;</span><span class="p">,</span>
    <span class="n">branch</span><span class="o">=</span><span class="s1">&#39;mybranch&#39;</span><span class="p">,</span>
    <span class="n">project</span><span class="o">=</span><span class="s1">&#39;myproject&#39;</span><span class="p">,</span>
    <span class="n">pullrequest_filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">pr</span> <span class="p">:</span> <span class="n">approve_filter</span><span class="p">(</span><span class="n">pr</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
    <span class="n">pollInterval</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
  <span class="p">)</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Anyone who can create pull requests for the Bitbucket repository can initiate a change, potentially causing the buildmaster to run arbitrary code.</p>
</div>
</div>
<div class="section" id="gerritchangesource">
<span id="chsrc-GerritChangeSource"></span><span id="id18"></span><h2><a class="toc-backref" href="#id40">2.4.3.11. GerritChangeSource</a><a class="headerlink" href="#gerritchangesource" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.changes.gerritchangesource.GerritChangeSource">
<em class="property">class </em><code class="descclassname">buildbot.changes.gerritchangesource.</code><code class="descname">GerritChangeSource</code><a class="headerlink" href="#buildbot.changes.gerritchangesource.GerritChangeSource" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></code></a> class connects to a Gerrit server by its SSH interface and uses its event source mechanism, <a class="reference external" href="https://gerrit-documentation.storage.googleapis.com/Documentation/2.2.1/cmd-stream-events.html">gerrit stream-events</a>.</p>
<p>The <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></code></a> accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">gerritserver</span></code></dt>
<dd>the dns or ip that host the gerrit ssh server</dd>
<dt><code class="docutils literal"><span class="pre">gerritport</span></code></dt>
<dd>the port of the gerrit ssh server</dd>
<dt><code class="docutils literal"><span class="pre">username</span></code></dt>
<dd>the username to use to connect to gerrit</dd>
<dt><code class="docutils literal"><span class="pre">identity_file</span></code></dt>
<dd>ssh identity file to for authentication (optional).
Pay attention to the <cite>ssh passphrase</cite></dd>
<dt><code class="docutils literal"><span class="pre">handled_events</span></code></dt>
<dd>event to be handled (optional).
By default processes <cite>patchset-created</cite> and <cite>ref-updated</cite></dd>
<dt><code class="docutils literal"><span class="pre">debug</span></code></dt>
<dd>Print gerrit event in the log (default False).
This allows to debug event content, but will eventually fill your logs with useless gerrit event logs.</dd>
</dl>
<p>By default this class adds a change to the buildbot system for each of the following events:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">patchset-created</span></code></dt>
<dd>A change is proposed for review.
Automatic checks like <code class="file docutils literal"><span class="pre">checkpatch.pl</span></code> can be automatically triggered.
Beware of what kind of automatic task you trigger.
At this point, no trusted human has reviewed the code, and a patch could be specially crafted by an attacker to compromise your workers.</dd>
<dt><code class="docutils literal"><span class="pre">ref-updated</span></code></dt>
<dd>A change has been merged into the repository.
Typically, this kind of event can lead to a complete rebuild of the project, and upload binaries to an incremental build results server.</dd>
</dl>
<p>But you can specify how to handle Events:</p>
<ul class="simple">
<li>Any event with change and patchSet will be processed by universal collector by default.</li>
<li>In case you've specified processing function for the given kind of events, all events of this kind will be processed only by this function, bypassing universal collector.</li>
</ul>
<p>An example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="k">class</span> <span class="nc">MyGerritChangeSource</span><span class="p">(</span><span class="n">changes</span><span class="o">.</span><span class="n">GerritChangeSource</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom GerritChangeSource</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">eventReceived_patchset_created</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">properties</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handler events without properties</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addChangeFromEvent</span><span class="p">(</span><span class="n">properties</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</pre></div>
</div>
<p>This class will populate the property list of the triggered build with the info received from Gerrit server in JSON format.</p>
<p id="index-5">In case of <code class="docutils literal"><span class="pre">patchset-created</span></code> event, these properties will be:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">event.change.branch</span></code></dt>
<dd>Branch of the Change</dd>
<dt><code class="docutils literal"><span class="pre">event.change.id</span></code></dt>
<dd>Change's ID in the Gerrit system (the ChangeId: in commit comments)</dd>
<dt><code class="docutils literal"><span class="pre">event.change.number</span></code></dt>
<dd>Change's number in Gerrit system</dd>
<dt><code class="docutils literal"><span class="pre">event.change.owner.email</span></code></dt>
<dd>Change's owner email (owner is first uploader)</dd>
<dt><code class="docutils literal"><span class="pre">event.change.owner.name</span></code></dt>
<dd>Change's owner name</dd>
<dt><code class="docutils literal"><span class="pre">event.change.project</span></code></dt>
<dd>Project of the Change</dd>
<dt><code class="docutils literal"><span class="pre">event.change.subject</span></code></dt>
<dd>Change's subject</dd>
<dt><code class="docutils literal"><span class="pre">event.change.url</span></code></dt>
<dd>URL of the Change in the Gerrit's web interface</dd>
<dt><code class="docutils literal"><span class="pre">event.patchSet.number</span></code></dt>
<dd>Patchset's version number</dd>
<dt><code class="docutils literal"><span class="pre">event.patchSet.ref</span></code></dt>
<dd>Patchset's Gerrit &quot;virtual branch&quot;</dd>
<dt><code class="docutils literal"><span class="pre">event.patchSet.revision</span></code></dt>
<dd>Patchset's Git commit ID</dd>
<dt><code class="docutils literal"><span class="pre">event.patchSet.uploader.email</span></code></dt>
<dd>Patchset uploader's email (owner is first uploader)</dd>
<dt><code class="docutils literal"><span class="pre">event.patchSet.uploader.name</span></code></dt>
<dd>Patchset uploader's name (owner is first uploader)</dd>
<dt><code class="docutils literal"><span class="pre">event.type</span></code></dt>
<dd>Event type (<code class="docutils literal"><span class="pre">patchset-created</span></code>)</dd>
<dt><code class="docutils literal"><span class="pre">event.uploader.email</span></code></dt>
<dd>Patchset uploader's email</dd>
<dt><code class="docutils literal"><span class="pre">event.uploader.name</span></code></dt>
<dd>Patchset uploader's name</dd>
</dl>
<p>In case of <code class="docutils literal"><span class="pre">ref-updated</span></code> event, these properties will be:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">event.refUpdate.newRev</span></code></dt>
<dd>New Git commit ID (after merger)</dd>
<dt><code class="docutils literal"><span class="pre">event.refUpdate.oldRev</span></code></dt>
<dd>Previous Git commit ID (before merger)</dd>
<dt><code class="docutils literal"><span class="pre">event.refUpdate.project</span></code></dt>
<dd>Project that was updated</dd>
<dt><code class="docutils literal"><span class="pre">event.refUpdate.refName</span></code></dt>
<dd>Branch that was updated</dd>
<dt><code class="docutils literal"><span class="pre">event.submitter.email</span></code></dt>
<dd>Submitter's email (merger responsible)</dd>
<dt><code class="docutils literal"><span class="pre">event.submitter.name</span></code></dt>
<dd>Submitter's name (merger responsible)</dd>
<dt><code class="docutils literal"><span class="pre">event.type</span></code></dt>
<dd>Event type (<code class="docutils literal"><span class="pre">ref-updated</span></code>)</dd>
<dt><code class="docutils literal"><span class="pre">event.submitter.email</span></code></dt>
<dd>Submitter's email (merger responsible)</dd>
<dt><code class="docutils literal"><span class="pre">event.submitter.name</span></code></dt>
<dd>Submitter's name (merger responsible)</dd>
</dl>
<p>A configuration for this source might look like:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">changes</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">changes</span><span class="o">.</span><span class="n">GerritChangeSource</span><span class="p">(</span>
    <span class="s2">&quot;gerrit.example.com&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gerrit_user&quot;</span><span class="p">,</span>
    <span class="n">handled_events</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;patchset-created&quot;</span><span class="p">,</span> <span class="s2">&quot;change-merged&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>see <code class="file docutils literal"><span class="pre">master/docs/examples/git_gerrit.cfg</span></code> or <code class="file docutils literal"><span class="pre">master/docs/examples/repo_gerrit.cfg</span></code> in the Buildbot distribution for a full example setup of Git+Gerrit or Repo+Gerrit of <a class="reference internal" href="#chsrc-GerritChangeSource" title="GerritChangeSource"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GerritChangeSource</span></code></a>.</p>
</div>
<div class="section" id="gerritchangefilter">
<h2><a class="toc-backref" href="#id41">2.4.3.12. GerritChangeFilter</a><a class="headerlink" href="#gerritchangefilter" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="buildbot.changes.gerritchangesource.GerritChangeFilter">
<em class="property">class </em><code class="descclassname">buildbot.changes.gerritchangesource.</code><code class="descname">GerritChangeFilter</code><a class="headerlink" href="#buildbot.changes.gerritchangesource.GerritChangeFilter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p><code class="xref py py-class docutils literal"><span class="pre">GerritChangeFilter</span></code> is a ready to use <code class="xref py py-class docutils literal"><span class="pre">ChangeFilter</span></code> you can pass to <a class="reference internal" href="cfg-schedulers.html#sched-AnyBranchScheduler" title="AnyBranchScheduler"><code class="xref bb bb-sched docutils literal"><span class="pre">AnyBranchScheduler</span></code></a> in order to filter changes, to create pre-commit builders or post-commit schedulers.
It has the same api as <a class="reference internal" href="cfg-schedulers.html#change-filters"><span class="std std-ref">Change Filter</span></a>, except it has additionnal <cite>eventtype</cite> set of filter (can as well be specified as value, list, regular expression or callable)</p>
<p>An example is following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="k">import</span> <span class="n">schedulers</span><span class="p">,</span> <span class="n">util</span>
<span class="c1"># this scheduler will create builds when a patch is uploaded to gerrit</span>
<span class="c1"># but only if it is uploaded to the &quot;main&quot; branch</span>
<span class="n">schedulers</span><span class="o">.</span><span class="n">AnyBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;main-precommit&quot;</span><span class="p">,</span>
                              <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">GerritChangeFilter</span><span class="p">(</span><span class="n">branch</span><span class="o">=</span><span class="s2">&quot;main&quot;</span><span class="p">,</span>
                                                                    <span class="n">eventtype</span><span class="o">=</span><span class="s2">&quot;patchset-created&quot;</span><span class="p">),</span>
                              <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                              <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;main-precommit&quot;</span><span class="p">])</span>

<span class="c1"># this scheduler will create builds when a patch is merged in the &quot;main&quot; branch</span>
<span class="c1"># for post-commit tests</span>
<span class="n">schedulers</span><span class="o">.</span><span class="n">AnyBranchScheduler</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;main-postcommit&quot;</span><span class="p">,</span>
                              <span class="n">change_filter</span><span class="o">=</span><span class="n">util</span><span class="o">.</span><span class="n">GerritChangeFilter</span><span class="p">(</span><span class="s2">&quot;main&quot;</span><span class="p">,</span> <span class="s2">&quot;ref-updated&quot;</span><span class="p">),</span>
                              <span class="n">treeStableTimer</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">60</span><span class="p">,</span>
                              <span class="n">builderNames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;main-postcommit&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="change-hooks-http-notifications">
<span id="chsrc-Change Hooks"></span><span id="id19"></span><h2><a class="toc-backref" href="#id42">2.4.3.13. Change Hooks (HTTP Notifications)</a><a class="headerlink" href="#change-hooks-http-notifications" title="Permalink to this headline">¶</a></h2>
<p>Buildbot already provides a web frontend, and that frontend can easily be used to receive HTTP push notifications of commits from services like GitHub or GoogleCode.
See <a class="reference internal" href="cfg-wwwhooks.html#change-hooks"><span class="std std-ref">Change Hooks</span></a> for more information.</p>
</div>
<div class="section" id="googlecodeatompoller">
<span id="chsrc-GoogleCodeAtomPoller"></span><span id="id20"></span><h2><a class="toc-backref" href="#id43">2.4.3.14. GoogleCodeAtomPoller</a><a class="headerlink" href="#googlecodeatompoller" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="#chsrc-GoogleCodeAtomPoller" title="GoogleCodeAtomPoller"><code class="xref bb bb-chsrc docutils literal"><span class="pre">GoogleCodeAtomPoller</span></code></a> periodically polls a Google Code Project's commit feed for changes.
Works on SVN, Git, and Mercurial repositories.
Branches are not understood (yet).
It accepts the following arguments:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">feedurl</span></code></dt>
<dd>The commit Atom feed URL of the GoogleCode repository (MANDATORY)</dd>
<dt><code class="docutils literal"><span class="pre">pollinterval</span></code></dt>
<dd>Polling frequency for the feed (in seconds).
Default is 1 hour (OPTIONAL)</dd>
</dl>
<p>As an example, to poll the Ostinato project's commit feed every 3 hours, the configuration would look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">googlecode_atom</span> <span class="k">import</span> <span class="n">GoogleCodeAtomPoller</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;change_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GoogleCodeAtomPoller</span><span class="p">(</span>
    <span class="n">feedurl</span><span class="o">=</span><span class="s2">&quot;http://code.google.com/feeds/p/ostinato/hgchanges/basic&quot;</span><span class="p">,</span>
    <span class="n">pollinterval</span><span class="o">=</span><span class="mi">10800</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You will need to download <code class="docutils literal"><span class="pre">googlecode_atom.py</span></code> from the Buildbot source and install it somewhere on your <span class="target" id="index-6"></span><code class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></code> first.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/header-text-transparent.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><h3>Table Of Contents</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="configuration.html">2.4. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cfg-intro.html">2.4.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-global.html">2.4.2. Global Configuration</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2.4.3. Change Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-schedulers.html">2.4.4. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-workers.html">2.4.5. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-builders.html">2.4.6. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-buildfactories.html">2.4.7. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-properties.html">2.4.8. Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-buildsteps.html">2.4.9. Build Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-interlocks.html">2.4.10. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-reporters.html">2.4.11. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-www.html">2.4.12. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-wwwhooks.html">2.4.13. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-services.html">2.4.14. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="cfg-dbconfig.html">2.4.15. DbConfig</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="worker-transition.html">2.5. Transition to &quot;worker&quot; terminology</a></li>
<li class="toctree-l2"><a class="reference internal" href="customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="new-style-steps.html">2.7. New-Style Build Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="cmdline.html">2.8. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="resources.html">2.9. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="optimization.html">2.10. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">2.11. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="deploy.html">2.12. Deployment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../relnotes/index.html">4. Release Notes for Buildbot <code class="docutils literal"><span class="pre">|version|</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../indices.html">5. Indices and Tables</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="cfg-global.html"
                        title="previous chapter">2.4.2. Global Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="cfg-schedulers.html"
                        title="next chapter">2.4.4. Schedulers</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/manual/cfg-changesources.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>