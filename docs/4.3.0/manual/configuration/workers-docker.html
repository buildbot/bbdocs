

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Docker latent worker &mdash; Buildbot 4.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/buildbot_rtd.css?v=915d5e18" />

  
    <link rel="shortcut icon" href="../../_static/icon.png"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=a17b270f"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="UpCloud" href="workers-upcloud.html" />
    <link rel="prev" title="OpenStack" href="workers-openstack.html" /> 
<!-- GA-TRACKING-START -->
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try{
var pageTracker = _gat._getTracker("UA-12313843-4");
pageTracker._setDomainName("none");
pageTracker._setAllowLinker(true);
pageTracker._trackPageview();
} catch(err) {}
</script>
<!-- GA-TRACKING-END -->
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Buildbot
              <img src="../../_static/full_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="workers.html">2.5.6. Workers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="workers.html#defining-workers">2.5.6.1. Defining Workers</a></li>
<li class="toctree-l4"><a class="reference internal" href="workers.html#worker-options">2.5.6.2. Worker Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="workers.html#local-workers">2.5.6.3. Local Workers</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="workers.html#latent-workers">2.5.6.4. Latent Workers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="projects.html">2.5.8. Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="codebases.html">2.5.9. Codebases</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildfactories.html">2.5.10. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="buildsets.html">2.5.11. Build Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="properties.html">2.5.12. Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="steps/index.html">2.5.13. Build Steps</a></li>
<li class="toctree-l3"><a class="reference internal" href="interlocks.html">2.5.14. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="report_generators/index.html">2.5.15. Report Generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="reporters/index.html">2.5.16. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="www.html">2.5.17. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="wwwhooks.html">2.5.18. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="services/index.html">2.5.19. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbconfig.html">2.5.20. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="configurators.html">2.5.21. Configurators</a></li>
<li class="toctree-l3"><a class="reference internal" href="manhole.html">2.5.22. Manhole</a></li>
<li class="toctree-l3"><a class="reference internal" href="multimaster.html">2.5.23. Multimaster</a></li>
<li class="toctree-l3"><a class="reference internal" href="multicodebase.html">2.5.24. Multiple-Codebase Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="misc/index.html">2.5.25. Miscellaneous Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="tests/index.html">2.5.26. Testing Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../customization/index.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relnotes/index.html">4. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../relnotes/index.html#older-release-notes">5. Older Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../indices.html">6. API Indices</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Buildbot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">2. </span>Buildbot Manual</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">2.5. </span>Configuration</a></li>
          <li class="breadcrumb-item"><a href="workers.html"><span class="section-number">2.5.6. </span>Workers</a></li>
      <li class="breadcrumb-item active">Docker latent worker</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/manual/configuration/workers-docker.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="docker-latent-worker">
<span id="worker-DockerLatentWorker"></span><span id="index-0"></span><h1>Docker latent worker<a class="headerlink" href="#docker-latent-worker" title="Link to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.worker.docker.DockerLatentWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.worker.docker.</span></span><span class="sig-name descname"><span class="pre">DockerLatentWorker</span></span><a class="headerlink" href="#buildbot.worker.docker.DockerLatentWorker" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.plugins.worker.DockerLatentWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.plugins.worker.</span></span><span class="sig-name descname"><span class="pre">DockerLatentWorker</span></span><a class="headerlink" href="#buildbot.plugins.worker.DockerLatentWorker" title="Link to this definition"></a></dt>
<dd></dd></dl>

<p><a class="reference external" href="https://docker.com">Docker</a> is an open-source project that automates the deployment of applications inside software containers.
The <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> attempts to instantiate a fresh image for each build to assure consistency of the environment between builds.
Each image will be discarded once the worker finished processing the build queue (i.e. becomes <code class="docutils literal notranslate"><span class="pre">idle</span></code>).
See <a class="reference internal" href="workers.html#common-latent-workers-options"><span class="std std-ref">build_wait_timeout</span></a> to change this behavior.</p>
<p>This document will guide you through the setup of such workers.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#docker-installation" id="id3">Docker Installation</a></p></li>
<li><p><a class="reference internal" href="#image-creation" id="id4">Image Creation</a></p></li>
<li><p><a class="reference internal" href="#reuse-same-image-for-different-workers" id="id5">Reuse same image for different workers</a></p></li>
<li><p><a class="reference internal" href="#master-setup" id="id6">Master Setup</a></p></li>
</ul>
</nav>
<section id="docker-installation">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Docker Installation</a><a class="headerlink" href="#docker-installation" title="Link to this heading"></a></h2>
<p>An easy way to try Docker is through installation of dedicated Virtual machines.
Two of them stands out:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://coreos.com/">CoreOS</a></p></li>
<li><p><a class="reference external" href="https://github.com/boot2docker/boot2docker">boot2docker</a></p></li>
</ul>
<p>Beside, it is always possible to install Docker next to the buildmaster.
Beware that in this case, overall performance will depend on how many builds the computer where you have your buildmaster can handle as everything will happen on the same one.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not necessary to install Docker in the same environment as your master as we will make use to the Docker API through <a class="reference external" href="https://pypi.python.org/pypi/docker-py">docker-py</a>.
More in <a class="reference internal" href="#master-setup">master setup</a>.</p>
</div>
<section id="id1">
<h3>CoreOS<a class="headerlink" href="#id1" title="Link to this heading"></a></h3>
<p>CoreOS is targeted at building infrastructure and distributed systems.
In order to get the latent worker working with CoreOS, it is necessary to <a class="reference external" href="https://coreos.com/docs/launching-containers/building/customizing-docker/">expose the docker socket</a> outside of the Virtual Machine.
If you installed it via <a class="reference external" href="https://coreos.com/docs/running-coreos/platforms/vagrant/">Vagrant</a>, it is also necessary to uncomment the following line in your <code class="file docutils literal notranslate"><span class="pre">config.rb</span></code> file:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="vg">$expose_docker_tcp</span><span class="o">=</span><span class="mi">2375</span>
</pre></div>
</div>
<p>The following command should allow you to confirm that your Docker socket is now available via the network:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>-H<span class="w"> </span>tcp://127.0.0.1:2375<span class="w"> </span>ps
</pre></div>
</div>
</section>
<section id="id2">
<h3>boot2docker<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>boot2docker is one of the fastest ways to boot to Docker.
As it is meant to be used from outside of the Virtual Machine, the socket is already exposed.
Please follow the installation instructions on how to find the address of your socket.</p>
</section>
</section>
<section id="image-creation">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Image Creation</a><a class="headerlink" href="#image-creation" title="Link to this heading"></a></h2>
<p>Our build master will need the name of an image to perform its builds.
Each time a new build will be requested, the same base image will be used again and again, actually discarding the result of the previous build.
If you need some persistent storage between builds, you can <a class="reference external" href="settingupvolumes">use Volumes</a>.</p>
<p>Each Docker image has a single purpose.
Our worker image will be running a buildbot worker.</p>
<p>Docker uses <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code>s to describe the steps necessary to build an image.
The following example will build a minimal worker.
This example is voluntarily simplistic, and should probably not be used in production, see next paragraph.</p>
<div class="highlight-Docker notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="k">FROM</span><span class="w"> </span><span class="s">debian:stable</span>
<span class="linenos"> 2</span><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
<span class="linenos"> 3</span><span class="w">   </span>python-dev<span class="w"> </span><span class="se">\</span>
<span class="linenos"> 4</span><span class="w">   </span>python-pip
<span class="linenos"> 5</span><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>buildbot-worker
<span class="linenos"> 6</span><span class="k">RUN</span><span class="w"> </span>groupadd<span class="w"> </span>-r<span class="w"> </span>buildbot<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>useradd<span class="w"> </span>-r<span class="w"> </span>-g<span class="w"> </span>buildbot<span class="w"> </span>buildbot
<span class="linenos"> 7</span><span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>/worker<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>chown<span class="w"> </span>buildbot:buildbot<span class="w"> </span>/worker
<span class="linenos"> 8</span><span class="c"># Install your build-dependencies here ...</span>
<span class="linenos"> 9</span><span class="k">USER</span><span class="w"> </span><span class="s">buildbot</span>
<span class="linenos">10</span><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/worker</span>
<span class="hll"><span class="linenos">11</span><span class="k">RUN</span><span class="w"> </span>buildbot-worker<span class="w"> </span>create-worker<span class="w"> </span>.<span class="w"> </span>&lt;master-hostname&gt;<span class="w"> </span>&lt;workername&gt;<span class="w"> </span>&lt;workerpassword&gt;
</span><span class="linenos">12</span><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/usr/local/bin/buildbot-worker&quot;</span><span class="p">]</span>
<span class="linenos">13</span><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--nodaemon&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>On line 11, the hostname for your master instance, as well as the worker name and password is setup.
Don’t forget to replace those values with some valid ones for your project.</p>
<p>It is a good practice to set the <code class="docutils literal notranslate"><span class="pre">ENTRYPOINT</span></code> to the worker executable, and the <code class="docutils literal notranslate"><span class="pre">CMD</span></code> to <code class="docutils literal notranslate"><span class="pre">[&quot;start&quot;,</span> <span class="pre">&quot;--nodaemon&quot;]</span></code>.
This way, no parameter will be required when starting the image.</p>
<p>When your Dockerfile is ready, you can build your first image using the following command (replace <em>myworkername</em> with a relevant name for your case):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>myworkername<span class="w"> </span>-<span class="w"> </span>&lt;<span class="w"> </span>Dockerfile
</pre></div>
</div>
</section>
<section id="reuse-same-image-for-different-workers">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Reuse same image for different workers</a><a class="headerlink" href="#reuse-same-image-for-different-workers" title="Link to this heading"></a></h2>
<p>Previous simple example hardcodes the worker name into the dockerfile, which will not work if you want to share your docker image between workers.</p>
<p>You can find in buildbot source code in <a class="extlink-src reference external" href="https://github.com/buildbot/buildbot/tree/master/master/contrib/docker">master/contrib/docker</a> one example configurations:</p>
<dl class="simple">
<dt><a class="extlink-src reference external" href="https://github.com/buildbot/buildbot/tree/master/master/contrib/docker/pythonnode_worker/">pythonnode_worker</a></dt><dd><p>a worker with Python and node installed, which demonstrate how to reuse the base worker to create variations of build environments.
It is based on the official <code class="docutils literal notranslate"><span class="pre">buildbot/buildbot-worker</span></code> image.</p>
</dd>
</dl>
<p>The master setups several environment variables before starting the workers:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">BUILDMASTER</span></code></dt><dd><p>The address of the master the worker shall connect to</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BUILDMASTER_PORT</span></code></dt><dd><p>The port of the master’s worker ‘pb’ protocol.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">WORKERNAME</span></code></dt><dd><p>The name the worker should use to connect to master</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">WORKERPASS</span></code></dt><dd><p>The password the worker should use to connect to master</p>
</dd>
</dl>
</section>
<section id="master-setup">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Master Setup</a><a class="headerlink" href="#master-setup" title="Link to this heading"></a></h2>
<p>We will rely on docker-py to connect our master with docker.
Now is the time to install it in your master environment.</p>
<p>Before adding the worker to your master configuration, it is possible to validate the previous steps by starting the newly created image interactively.
To do this, enter the following lines in a Python prompt where docker-py is installed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">docker</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">docker_socket</span> <span class="o">=</span> <span class="s1">&#39;tcp://localhost:2375&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">DockerClient</span><span class="p">(</span><span class="n">base_url</span><span class="o">=</span><span class="n">docker_socket</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">worker_image</span> <span class="o">=</span> <span class="s1">&#39;my_project_worker&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">container</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">create_container</span><span class="p">(</span><span class="n">worker_image</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Optionally examine the logs of the master</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">client</span><span class="o">.</span><span class="n">containers</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">])</span>
<span class="go">0</span>
</pre></div>
</div>
<p>It is now time to add the new worker to the master configuration under <a class="reference internal" href="workers.html#cfg-workers" title="workers"><code class="xref bb bb-cfg docutils literal notranslate"><span class="pre">workers</span></code></a>.</p>
<p>The following example will add a Docker latent worker for docker running at the following address: <code class="docutils literal notranslate"><span class="pre">tcp://localhost:2375</span></code>, the worker name will be <code class="docutils literal notranslate"><span class="pre">docker</span></code>, its password: <code class="docutils literal notranslate"><span class="pre">password</span></code>, and the base image name will be <code class="docutils literal notranslate"><span class="pre">my_project_worker</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">worker</span>
<span class="n">c</span><span class="p">[</span><span class="s1">&#39;workers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">worker</span><span class="o">.</span><span class="n">DockerLatentWorker</span><span class="p">(</span><span class="s1">&#39;docker&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
                              <span class="n">docker_host</span><span class="o">=</span><span class="s1">&#39;tcp://localhost:2375&#39;</span><span class="p">,</span>
                              <span class="n">image</span><span class="o">=</span><span class="s1">&#39;my_project_worker&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">password</span></code></dt><dd><p>(mandatory)
The worker password part of the <a class="reference internal" href="workers.html#latent-workers"><span class="std std-ref">Latent Workers</span></a> API.
If the password is <code class="docutils literal notranslate"><span class="pre">None</span></code>, then it will be automatically generated from random number, and transmitted to the container via environment variable.</p>
</dd>
</dl>
<p>In addition to the arguments available for any <a class="reference internal" href="workers.html#latent-workers"><span class="std std-ref">Latent Workers</span></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DockerLatentWorker</span></code> will accept the following extra ones:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">docker_host</span></code></dt><dd><p>(renderable string, mandatory)
This is the address the master will use to connect with a running Docker instance.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">image</span></code></dt><dd><p>(renderable string, mandatory)
This is the name of the image that will be started by the build master. It should start a worker.
This option can be a renderable, like <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a>, so that it generates from the build request properties.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">command</span></code></dt><dd><p>(optional)
This will override the command setup during image creation.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">volumes</span></code></dt><dd><p>(a renderable list of strings, optional)
Allows to share directory between containers, or between a container and the host system.
Refer to Docker documentation for more information about Volumes.</p>
<p>Each string within the <code class="docutils literal notranslate"><span class="pre">volumes</span></code> array specify a volume in the following format: <code class="samp docutils literal notranslate"><em><span class="pre">volumename</span></em><span class="pre">:</span><em><span class="pre">bindname</span></em></code>.
The volume name has to be appended with <code class="docutils literal notranslate"><span class="pre">:ro</span></code> if the volume should be mounted <em>read-only</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is the same format as when specifying volumes on the command line for docker’s own <code class="docutils literal notranslate"><span class="pre">-v</span></code> option.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dockerfile</span></code></dt><dd><p>(renderable string, optional if <code class="docutils literal notranslate"><span class="pre">image</span></code> is given)
This is the content of the Dockerfile that will be used to build the specified image if the image is not found by Docker.
It should be a multiline string.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In case <code class="docutils literal notranslate"><span class="pre">image</span></code> and <code class="docutils literal notranslate"><span class="pre">dockerfile</span></code> are given, no attempt is made to compare the image with the content of the Dockerfile parameter if the image is found.</p>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">version</span></code></dt><dd><p>(optional, default to the highest version known by docker-py)
This will indicates which API version must be used to communicate with Docker.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tls</span></code></dt><dd><p>(optional)
This allow to use TLS when connecting with the Docker socket.
This should be a <code class="docutils literal notranslate"><span class="pre">docker.tls.TLSConfig</span></code> object.
See <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/tls.html">docker-py’s own documentation</a> for more details on how to initialise this object.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">followStartupLogs</span></code></dt><dd><p>(optional, defaults to false)
This transfers docker container’s log inside master logs during worker startup (before connection). This can be useful to debug worker startup. e.g network issues, etc.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">masterFQDN</span></code></dt><dd><p>(optional, defaults to socket.getfqdn())
Address of the master the worker should connect to. Use if you master machine does not have proper fqdn.
This value is passed to the docker image via environment variable <code class="docutils literal notranslate"><span class="pre">BUILDMASTER</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master_protocol</span></code></dt><dd><p>(optional, default to <code class="docutils literal notranslate"><span class="pre">pb</span></code>)
Protocol that the worker should use when connecting to master. Supported values are <code class="docutils literal notranslate"><span class="pre">pb</span></code> and
<code class="docutils literal notranslate"><span class="pre">msgpack_experimental_v7</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hostconfig</span></code></dt><dd><p>(renderable dictionary, optional)
Extra host configuration parameters passed as a dictionary used to create HostConfig object.
See <a class="reference external" href="https://docker-py.readthedocs.io/en/stable/api.html#docker.api.container.ContainerApiMixin.create_host_config">docker-py’s HostConfig documentation</a> for all the supported options.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">autopull</span></code></dt><dd><p>(optional, defaults to false)
Automatically pulls image if requested image is not on docker host.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">alwaysPull</span></code></dt><dd><p>(optional, defaults to false)
Always pulls (update) image if autopull is set to true.
Also affects the base image specified by <cite>FROM ….</cite> if using a dockerfile, autopull is not needed then.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">target</span></code></dt><dd><p>(renderable string, optional)
Sets target build stage for multi-stage builds when using a dockerfile.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">custom_context</span></code></dt><dd><dl class="simple">
<dt>(renderable boolean, optional)</dt><dd><p>Boolean indicating that the user wants to use custom build arguments for the docker environment. Defaults to False.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">encoding</span></code></dt><dd><dl class="simple">
<dt>(renderable string, optional)</dt><dd><p>String indicating the compression format for the build context. defaults to ‘gzip’, but ‘bzip’ can be used as well.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buildargs</span></code></dt><dd><dl class="simple">
<dt>(renderable dictionary, optional if <code class="docutils literal notranslate"><span class="pre">custom_context</span></code> is True)</dt><dd><p>Dictionary, passes information for the docker to build its environment. Eg. {‘DISTRO’:’ubuntu’, ‘RELEASE’:’11.11’}. Defaults to None.</p>
</dd>
</dl>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hostname</span></code></dt><dd><p>(renderable string, optional)
This will set container’s hostname.</p>
</dd>
</dl>
</section>
</section>
<section id="marathon-latent-worker">
<h1>Marathon latent worker<a class="headerlink" href="#marathon-latent-worker" title="Link to this heading"></a></h1>
<p><a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> Marathon is a production-grade container orchestration platform for Mesosphere’s Data-center Operating System (DC/OS) and Apache <code class="docutils literal notranslate"><span class="pre">Mesos</span></code>.</p>
<p>Buildbot supports using <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> to host your latent workers.</p>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.worker.marathon.MarathonLatentWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.worker.marathon.</span></span><span class="sig-name descname"><span class="pre">MarathonLatentWorker</span></span><a class="headerlink" href="#buildbot.worker.marathon.MarathonLatentWorker" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.plugins.worker.MarathonLatentWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.plugins.worker.</span></span><span class="sig-name descname"><span class="pre">MarathonLatentWorker</span></span><a class="headerlink" href="#buildbot.plugins.worker.MarathonLatentWorker" title="Link to this definition"></a></dt>
<dd></dd></dl>

<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">MarathonLatentWorker</span></code> attempts to instantiate a fresh image for each build to assure consistency of the environment between builds.
Each image will be discarded once the worker finished processing the build queue (i.e. becomes <code class="docutils literal notranslate"><span class="pre">idle</span></code>).
See <a class="reference internal" href="workers.html#common-latent-workers-options"><span class="std std-ref">build_wait_timeout</span></a> to change this behavior.</p>
<p>In addition to the arguments available for any <a class="reference internal" href="workers.html#latent-workers"><span class="std std-ref">Latent Workers</span></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">MarathonLatentWorker</span></code> will accept the following extra ones:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">marathon_url</span></code></dt><dd><p>(mandatory)
This is the URL to <a class="reference external" href="https://mesosphere.github.io/marathon/">Marathon</a> server.
Its REST API will be used to start docker containers.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">marathon_auth</span></code></dt><dd><p>(optional)
This is the optional <code class="docutils literal notranslate"><span class="pre">('userid',</span> <span class="pre">'password')</span></code> <code class="docutils literal notranslate"><span class="pre">BasicAuth</span></code> credential.
If <a class="reference external" href="https://pypi.python.org/pypi/txrequests">txrequests</a> is installed, this can be a <a class="reference external" href="https://2.python-requests.org/en/master/user/authentication/">requests authentication plugin</a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">image</span></code></dt><dd><p>(mandatory)
This is the name of the image that will be started by the build master. It should start a worker.
This option can be a renderable, like <a class="reference internal" href="properties.html#interpolate"><span class="std std-ref">Interpolate</span></a>, so that it generates from the build request properties.
Images are by pulled from the default docker registry.
MarathonLatentWorker does not support starting a worker built from a Dockerfile.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">masterFQDN</span></code></dt><dd><p>(optional, defaults to socket.getfqdn())
Address of the master the worker should connect to. Use if you master machine does not have proper fqdn.
This value is passed to the docker image via environment variable <code class="docutils literal notranslate"><span class="pre">BUILDMASTER</span></code></p>
<p>If the value contains a colon (<code class="docutils literal notranslate"><span class="pre">:</span></code>), then BUILDMASTER and BUILDMASTER_PORT environment variables will be passed, following scheme: <code class="docutils literal notranslate"><span class="pre">masterFQDN=&quot;$BUILDMASTER:$BUILDMASTER_PORT&quot;</span></code></p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">marathon_extra_config</span></code></dt><dd><p>(optional, defaults to <code class="docutils literal notranslate"><span class="pre">{}`</span></code>)
Extra configuration to be passed to <a class="reference external" href="http://mesosphere.github.io/marathon/docs/rest-api.html#post-v2-apps">Marathon API</a>.
This implementation will setup the minimal configuration to run a worker (docker image, <code class="docutils literal notranslate"><span class="pre">BRIDGED</span></code> network)
It will let the default for everything else, including memory size, volume mounting, etc.
This configuration is voluntarily very raw so that it is easy to use new marathon features.
This dictionary will be merged into the Buildbot generated config, and recursively override it.
See <a class="reference external" href="http://mesosphere.github.io/marathon/docs/rest-api.html#post-v2-apps">Marathon API</a> documentation to learn what to include in this config.</p>
</dd>
</dl>
</section>
<section id="kubernetes-latent-worker">
<h1>Kubernetes latent worker<a class="headerlink" href="#kubernetes-latent-worker" title="Link to this heading"></a></h1>
<p><a class="reference external" href="https://kubernetes.io/">Kubernetes</a> is an open-source system for automating deployment, scaling, and management of containerized applications.</p>
<p>Buildbot supports using <a class="reference external" href="https://kubernetes.io/">Kubernetes</a> to host your latent workers.</p>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.worker.kubernetes.KubeLatentWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.worker.kubernetes.</span></span><span class="sig-name descname"><span class="pre">KubeLatentWorker</span></span><a class="headerlink" href="#buildbot.worker.kubernetes.KubeLatentWorker" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.plugins.worker.KubeLatentWorker">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.plugins.worker.</span></span><span class="sig-name descname"><span class="pre">KubeLatentWorker</span></span><a class="headerlink" href="#buildbot.plugins.worker.KubeLatentWorker" title="Link to this definition"></a></dt>
<dd></dd></dl>

<p>The <code class="xref py py-class docutils literal notranslate"><span class="pre">KubeLatentWorker</span></code> attempts to instantiate a fresh container for each build to assure consistency of the environment between builds
Each container will be discarded once the worker finished processing the build queue (i.e. becomes <code class="docutils literal notranslate"><span class="pre">idle</span></code>).
See <a class="reference internal" href="workers.html#common-latent-workers-options"><span class="std std-ref">build_wait_timeout</span></a> to change this behavior.</p>
<p>In addition to the arguments available for any <a class="reference internal" href="workers.html#latent-workers"><span class="std std-ref">Latent Workers</span></a>, <code class="xref py py-class docutils literal notranslate"><span class="pre">KubeLatentWorker</span></code> will accept the following extra ones:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">image</span></code></dt><dd><p>(optional, default to <code class="docutils literal notranslate"><span class="pre">buildbot/buildbot-worker</span></code>)
Docker image. Default to the <cite>official buildbot image</cite>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">namespace</span></code></dt><dd><p>(optional)
This is the name of the namespace. Default to the current namespace</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kube_config</span></code></dt><dd><p>(mandatory)
This is the object specifying how to connect to the kubernetes cluster.
This object must be an instance of abstract class <code class="xref py py-class docutils literal notranslate"><span class="pre">KubeConfigLoaderBase</span></code>, which have 3 implementations:</p>
<ul class="simple">
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">KubeHardcodedConfig</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">KubeCtlProxyConfigLoader</span></code></p></li>
<li><p><code class="xref py py-class docutils literal notranslate"><span class="pre">KubeInClusterConfigLoader</span></code></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">masterFQDN</span></code></dt><dd><p>(optional, default to <code class="docutils literal notranslate"><span class="pre">None</span></code>)
Address of the master the worker should connect to. Put the service master service name if you want to place a load-balancer between the workers and the masters.
The default behaviour is to compute address IP of the master. This option works out-of-the box inside kubernetes but don’t leverage the load-balancing through service.
You can pass any callable, such as <code class="docutils literal notranslate"><span class="pre">KubeLatentWorker.get_fqdn</span></code> that will set <code class="docutils literal notranslate"><span class="pre">masterFQDN=socket.getfqdn()</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">master_protocol</span></code></dt><dd><p>(optional, default to <code class="docutils literal notranslate"><span class="pre">pb</span></code>)
Protocol that the worker should use when connecting to master. Supported values are <code class="docutils literal notranslate"><span class="pre">pb</span></code> and
<code class="docutils literal notranslate"><span class="pre">msgpack_experimental_v7</span></code>.</p>
</dd>
</dl>
<p>For more customization, you can subclass <code class="xref py py-class docutils literal notranslate"><span class="pre">KubeLatentWorker</span></code> and override following methods.
All those methods can optionally return a deferred.
All those methods take props object which is a L{IProperties} allowing to get some parameters from the build properties</p>
<blockquote>
<div><dl class="py method">
<dt class="sig sig-object py" id="createEnvironment">
<span class="sig-name descname"><span class="pre">createEnvironment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#createEnvironment" title="Link to this definition"></a></dt>
<dd><p>This method compute the environment from your properties.
Don’t forget to first call <cite>super().createEnvironment(props)</cite> to get the base properties necessary to connect to the master.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="getBuildContainerResources">
<span class="sig-name descname"><span class="pre">getBuildContainerResources</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#getBuildContainerResources" title="Link to this definition"></a></dt>
<dd><p>This method compute the <a class="reference external" href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#resources">pod resources</a> part of the container spec (<cite>spec.containers[].resources</cite>).
This is important to reserve some CPU and memory for your builds, and to trigger node auto-scaling if needed.
You can also limit the CPU and memory for your container.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getBuildContainerResources</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;requests&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;cpu&quot;</span><span class="p">:</span> <span class="s2">&quot;2500m&quot;</span><span class="p">,</span>
            <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="s2">&quot;4G&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="get_build_container_volume_mounts">
<span class="sig-name descname"><span class="pre">get_build_container_volume_mounts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#get_build_container_volume_mounts" title="Link to this definition"></a></dt>
<dd><p>This method computes the <a class="reference external" href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#volumes-1">volumeMounts</a> part of the container spec.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_build_container_volume_mounts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;mount-name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mountPath&quot;</span><span class="p">:</span> <span class="s2">&quot;/cache&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="get_volumes">
<span class="sig-name descname"><span class="pre">get_volumes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#get_volumes" title="Link to this definition"></a></dt>
<dd><p>This method computes the <a class="reference external" href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#volumes">volumes</a> part of the pod spec.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_volumes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;mount-name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;hostPath&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;/var/log/pods&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="get_node_selector">
<span class="sig-name descname"><span class="pre">get_node_selector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#get_node_selector" title="Link to this definition"></a></dt>
<dd><p>This method computes the <a class="reference external" href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#scheduling">nodeSelector</a> part of the pod spec.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_node_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;my-label&quot;</span><span class="p">:</span> <span class="s2">&quot;my-label-value&quot;</span>
    <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="get_affinity">
<span class="sig-name descname"><span class="pre">get_affinity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#get_affinity" title="Link to this definition"></a></dt>
<dd><p>This method computes the <a class="reference external" href="https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#scheduling">affinity</a> part of the pod spec.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_affinity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">props</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;nodeAffinity&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;requiredDuringSchedulingIgnoredDuringExecution&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;nodeSelectorTerms&quot;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s2">&quot;matchExpressions&quot;</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="s2">&quot;topology.kubernetes.io/zone&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;operator&quot;</span><span class="p">:</span> <span class="s2">&quot;In&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="p">[</span>
                                <span class="s2">&quot;antarctica-east1&quot;</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="getServicesContainers">
<span class="sig-name descname"><span class="pre">getServicesContainers</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">self</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">props</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#getServicesContainers" title="Link to this definition"></a></dt>
<dd><p>This method compute a list of containers spec to put alongside the worker container.
This is useful for starting services around your build pod, like a database container.
All containers within the same pod share the same localhost interface, so you can access the other containers TCP ports very easily.</p>
</dd></dl>

</div></blockquote>
<section id="kubernetes-config-loaders">
<h2>Kubernetes config loaders<a class="headerlink" href="#kubernetes-config-loaders" title="Link to this heading"></a></h2>
<p>Kubernetes provides many options to connect to a cluster.
It is especially more complicated as some cloud providers use specific methods to connect to their managed kubernetes.
Config loaders objects can be shared between LatentWorker.</p>
<p>There are three options you may use to connect to your clusters.</p>
<p>When running both the master and slaves run on the same Kubernetes cluster, you should use the KubeInClusterConfigLoader.
If not, but having a configured <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> tool available to the build master is an option for you, you should use KubeCtlProxyConfigLoader.
If neither of these options is convenient, use KubeHardcodedConfig.</p>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.util.kubeclientservice.KubeCtlProxyConfigLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.util.kubeclientservice.</span></span><span class="sig-name descname"><span class="pre">KubeCtlProxyConfigLoader</span></span><a class="headerlink" href="#buildbot.util.kubeclientservice.KubeCtlProxyConfigLoader" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.plugins.util.KubeCtlProxyConfigLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.plugins.util.</span></span><span class="sig-name descname"><span class="pre">KubeCtlProxyConfigLoader</span></span><a class="headerlink" href="#buildbot.plugins.util.KubeCtlProxyConfigLoader" title="Link to this definition"></a></dt>
<dd></dd></dl>

<section id="kubectlproxyconfigloader">
<h3><code class="docutils literal notranslate"><span class="pre">KubeCtlProxyConfigLoader</span></code><a class="headerlink" href="#kubectlproxyconfigloader" title="Link to this heading"></a></h3>
<p>With <code class="xref py py-class docutils literal notranslate"><span class="pre">KubeCtlProxyConfigLoader</span></code>, buildbot will user <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">proxy</span></code> to get access to the cluster.
This delegates the authentication to the <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> <code class="docutils literal notranslate"><span class="pre">golang</span></code> binary, and thus avoid to implement a python version for every authentication scheme that kubernetes provides.
<code class="docutils literal notranslate"><span class="pre">kubectl</span></code> must be available in the <code class="docutils literal notranslate"><span class="pre">PATH</span></code>, and configured to be able to start pods.
While this method is very convenient and easy, it also opens an unauthenticated http access to your cluster via localhost.
You must ensure that this is properly secured, and your buildbot master machine is not on a shared multi-user server.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">proxy_port</span></code></dt><dd><p>(optional defaults to 8001)
HTTP port to use.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">namespace</span></code></dt><dd><p>(optional defaults to <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code>
default namespace to use if the latent worker do not provide one already.</p>
</dd>
</dl>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.util.kubeclientservice.KubeHardcodedConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.util.kubeclientservice.</span></span><span class="sig-name descname"><span class="pre">KubeHardcodedConfig</span></span><a class="headerlink" href="#buildbot.util.kubeclientservice.KubeHardcodedConfig" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.plugins.util.KubeHardcodedConfig">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.plugins.util.</span></span><span class="sig-name descname"><span class="pre">KubeHardcodedConfig</span></span><a class="headerlink" href="#buildbot.plugins.util.KubeHardcodedConfig" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="kubehardcodedconfig">
<h3><code class="docutils literal notranslate"><span class="pre">KubeHardcodedConfig</span></code><a class="headerlink" href="#kubehardcodedconfig" title="Link to this heading"></a></h3>
<p>With <code class="xref py py-class docutils literal notranslate"><span class="pre">KubeHardcodedConfig</span></code>, you just configure the necessary parameters to connect to the clusters.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">master_url</span></code></dt><dd><p>(mandatory)
The http url of you kubernetes master.
Only http and https protocols are supported</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">headers</span></code></dt><dd><p>(optional)
Additional headers to be passed to the HTTP request</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">basicAuth</span></code></dt><dd><p>(optional)
Basic authorization info to connect to the cluster, as a <cite>{‘user’: ‘username’, ‘password’: ‘psw’ }</cite> dict.</p>
<p>Unlike the headers argument, this argument supports secret providers, e.g:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">basicAuth</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">Secret</span><span class="p">(</span><span class="s1">&#39;k8spassword&#39;</span><span class="p">)}</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bearerToken</span></code></dt><dd><p>(optional)</p>
<p>A bearer token to authenticate to the cluster, as a string.
Unlike the headers argument, this argument supports secret providers, e.g:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">bearerToken</span><span class="o">=</span><span class="n">Secret</span><span class="p">(</span><span class="s1">&#39;k8s-token&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When using the Google Kubernetes Engine (GKE), a bearer token for the default service account can be had with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>get-credentials<span class="w"> </span>--region<span class="w"> </span><span class="o">[</span>YOURREGION<span class="o">]</span><span class="w"> </span>YOURCLUSTER
kubectl<span class="w"> </span>describe<span class="w"> </span>sa
kubectl<span class="w"> </span>describe<span class="w"> </span>secret<span class="w"> </span><span class="o">[</span>SECRET_ID<span class="o">]</span>
</pre></div>
</div>
<p>Where SECRET_ID is displayed by the <code class="docutils literal notranslate"><span class="pre">describe</span> <span class="pre">sa</span></code> command line.
The default service account does not have rights on the cluster (to create/delete pods), which is required by BuildBot’s integration.
You may give it this right by making it a cluster admin with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>create<span class="w"> </span>clusterrolebinding<span class="w"> </span>service-account-admin<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--clusterrole<span class="o">=</span>cluster-admin<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--serviceaccount<span class="w"> </span>default:default
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">cert</span></code></dt><dd><p>(optional)
Client certificate and key to use to authenticate.
This only works if <code class="docutils literal notranslate"><span class="pre">txrequests</span></code> is installed:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cert</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;/path/to/certificate.crt&#39;</span><span class="p">,</span> <span class="s1">&#39;/path/to/certificate.key&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">verify</span></code></dt><dd><p>(optional)
Path to server certificate authenticate the server:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">verify</span><span class="o">=</span><span class="s1">&#39;/path/to/kube_server_certificate.crt&#39;</span>
</pre></div>
</div>
<p>When using the Google Kubernetes Engine (GKE), this certificate is available from the admin console, on the Cluster page.
Verify that it is valid (i.e. no copy/paste errors) with <code class="docutils literal notranslate"><span class="pre">openssl</span> <span class="pre">verify</span> <span class="pre">PATH_TO_PEM</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">namespace</span></code></dt><dd><p>(optional defaults to <code class="docutils literal notranslate"><span class="pre">&quot;default&quot;</span></code>
default namespace to use if the latent worker do not provide one already.</p>
</dd>
</dl>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.util.kubeclientservice.KubeInClusterConfigLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.util.kubeclientservice.</span></span><span class="sig-name descname"><span class="pre">KubeInClusterConfigLoader</span></span><a class="headerlink" href="#buildbot.util.kubeclientservice.KubeInClusterConfigLoader" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="buildbot.plugins.util.KubeInClusterConfigLoader">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.plugins.util.</span></span><span class="sig-name descname"><span class="pre">KubeInClusterConfigLoader</span></span><a class="headerlink" href="#buildbot.plugins.util.KubeInClusterConfigLoader" title="Link to this definition"></a></dt>
<dd></dd></dl>

</section>
<section id="kubeinclusterconfigloader">
<h3><code class="docutils literal notranslate"><span class="pre">KubeInClusterConfigLoader</span></code><a class="headerlink" href="#kubeinclusterconfigloader" title="Link to this heading"></a></h3>
<p>Use <code class="xref py py-class docutils literal notranslate"><span class="pre">KubeInClusterConfigLoader</span></code>, if your Buildbot master is itself located within the kubernetes cluster.
In this case, you would associated a service account to the Buildbot master pod, and <code class="xref py py-class docutils literal notranslate"><span class="pre">KubeInClusterConfigLoader</span></code> will get the credentials from that.</p>
<p>This config loader takes no arguments.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="workers-openstack.html" class="btn btn-neutral float-left" title="OpenStack" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="workers-upcloud.html" class="btn btn-neutral float-right" title="UpCloud" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Buildbot Team Members.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>