<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.5.12.19. ShellCommand &mdash; Buildbot 3.11.6 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=d10597a4" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../../_static/buildbot_rtd.css?v=915d5e18" />

  
    <link rel="shortcut icon" href="../../../_static/icon.png"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=e6f4c021"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="2.5.12.20. Shell Sequence" href="shell_sequence.html" />
    <link rel="prev" title="2.5.12.18. GitDiffInfo" href="git_diffinfo.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            Buildbot
              <img src="../../../_static/full_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.11.6
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/index.html">1. Buildbot Tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">2. Buildbot Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../introduction.html">2.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../installation/index.html">2.2. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../concepts.html">2.3. Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../secretsmanagement.html">2.4. Secret Management</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">2.5. Configuration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../intro.html">2.5.1. Configuring Buildbot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../global.html">2.5.2. Global Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changesources.html">2.5.3. Change Sources and Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../changesources.html#changes">2.5.4. Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../schedulers.html">2.5.5. Schedulers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../workers.html">2.5.6. Workers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../builders.html">2.5.7. Builder Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../projects.html">2.5.8. Projects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../buildfactories.html">2.5.9. Build Factories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../buildsets.html">2.5.10. Build Sets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../properties.html">2.5.11. Properties</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">2.5.12. Build Steps</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="common.html">2.5.12.1. Parameters Common to all Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_common.html">2.5.12.2. Common Parameters of source checkout operations</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_bzr.html">2.5.12.3. Bzr</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_cvs.html">2.5.12.4. CVS</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_darcs.html">2.5.12.5. Darcs</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_gerrit.html">2.5.12.6. Gerrit</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_github.html">2.5.12.7. GitHub</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_gitlab.html">2.5.12.8. GitLab</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_git.html">2.5.12.9. Git</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_mercurial.html">2.5.12.10. Mercurial</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_monotone.html">2.5.12.11. Monotone</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_p4.html">2.5.12.12. P4</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_repo.html">2.5.12.13. Repo</a></li>
<li class="toctree-l4"><a class="reference internal" href="source_svn.html">2.5.12.14. SVN</a></li>
<li class="toctree-l4"><a class="reference internal" href="gitcommit.html">2.5.12.15. GitCommit</a></li>
<li class="toctree-l4"><a class="reference internal" href="gittag.html">2.5.12.16. GitTag</a></li>
<li class="toctree-l4"><a class="reference internal" href="gitpush.html">2.5.12.17. GitPush</a></li>
<li class="toctree-l4"><a class="reference internal" href="git_diffinfo.html">2.5.12.18. GitDiffInfo</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">2.5.12.19. ShellCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="shell_sequence.html">2.5.12.20. Shell Sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="compile.html">2.5.12.21. Compile</a></li>
<li class="toctree-l4"><a class="reference internal" href="configure.html">2.5.12.22. Configure</a></li>
<li class="toctree-l4"><a class="reference internal" href="cmake.html">2.5.12.23. CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="visual_cxx.html">2.5.12.24. Visual C++</a></li>
<li class="toctree-l4"><a class="reference internal" href="cppcheck.html">2.5.12.25. Cppcheck</a></li>
<li class="toctree-l4"><a class="reference internal" href="robocopy.html">2.5.12.26. Robocopy</a></li>
<li class="toctree-l4"><a class="reference internal" href="test.html">2.5.12.27. Test</a></li>
<li class="toctree-l4"><a class="reference internal" href="treesize.html">2.5.12.28. TreeSize</a></li>
<li class="toctree-l4"><a class="reference internal" href="perl_module_test.html">2.5.12.29. PerlModuleTest</a></li>
<li class="toctree-l4"><a class="reference internal" href="subunit_shell_command.html">2.5.12.30. SubunitShellCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="hlint.html">2.5.12.31. HLint</a></li>
<li class="toctree-l4"><a class="reference internal" href="maxq.html">2.5.12.32. MaxQ</a></li>
<li class="toctree-l4"><a class="reference internal" href="trigger.html">2.5.12.33. Trigger</a></li>
<li class="toctree-l4"><a class="reference internal" href="build_epydoc.html">2.5.12.34. BuildEPYDoc</a></li>
<li class="toctree-l4"><a class="reference internal" href="pyflakes.html">2.5.12.35. PyFlakes</a></li>
<li class="toctree-l4"><a class="reference internal" href="sphinx.html">2.5.12.36. Sphinx</a></li>
<li class="toctree-l4"><a class="reference internal" href="pylint.html">2.5.12.37. PyLint</a></li>
<li class="toctree-l4"><a class="reference internal" href="trial.html">2.5.12.38. Trial</a></li>
<li class="toctree-l4"><a class="reference internal" href="remove_pycs.html">2.5.12.39. RemovePYCs</a></li>
<li class="toctree-l4"><a class="reference internal" href="http_step.html">2.5.12.40. HTTP Requests</a></li>
<li class="toctree-l4"><a class="reference internal" href="worker_filesystem.html">2.5.12.41. Worker Filesystem Steps</a></li>
<li class="toctree-l4"><a class="reference internal" href="file_transfer.html">2.5.12.42. Transferring Files</a></li>
<li class="toctree-l4"><a class="reference internal" href="file_transfer.html#transferring-strings">2.5.12.43. Transferring Strings</a></li>
<li class="toctree-l4"><a class="reference internal" href="master_shell_command.html">2.5.12.44. MasterShellCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="log_renderable.html">2.5.12.45. LogRenderable</a></li>
<li class="toctree-l4"><a class="reference internal" href="assert.html">2.5.12.46. Assert</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_property.html">2.5.12.47. SetProperty</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_properties.html">2.5.12.48. SetProperties</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_property_from_command.html">2.5.12.49. SetPropertyFromCommand</a></li>
<li class="toctree-l4"><a class="reference internal" href="set_properties_from_env.html"><code class="docutils literal notranslate"><span class="pre">buildbot.steps.worker.SetPropertiesFromEnv</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="set_properties_from_env.html#setpropertiesfromenv">2.5.12.50. SetPropertiesFromEnv</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpm_build.html">2.5.12.51. RpmBuild</a></li>
<li class="toctree-l4"><a class="reference internal" href="rpm_lint.html">2.5.12.52. RpmLint</a></li>
<li class="toctree-l4"><a class="reference internal" href="mock_build_srpm.html">2.5.12.53. MockBuildSRPM Step</a></li>
<li class="toctree-l4"><a class="reference internal" href="mock_rebuild.html">2.5.12.54. MockRebuild</a></li>
<li class="toctree-l4"><a class="reference internal" href="deb_pbuilder.html">2.5.12.55. DebPbuilder</a></li>
<li class="toctree-l4"><a class="reference internal" href="deb_pbuilder.html#debcowbuilder">2.5.12.56. DebCowbuilder</a></li>
<li class="toctree-l4"><a class="reference internal" href="deb_lintian.html">2.5.12.57. DebLintian</a></li>
<li class="toctree-l4"><a class="reference internal" href="index.html#id2">2.5.12.58. Build steps</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../interlocks.html">2.5.13. Interlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../report_generators/index.html">2.5.14. Report Generators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reporters/index.html">2.5.15. Reporters</a></li>
<li class="toctree-l3"><a class="reference internal" href="../www.html">2.5.16. Web Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="../wwwhooks.html">2.5.17. Change Hooks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../services/index.html">2.5.18. Custom Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dbconfig.html">2.5.19. DbConfig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configurators.html">2.5.20. Configurators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../manhole.html">2.5.21. Manhole</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multimaster.html">2.5.22. Multimaster</a></li>
<li class="toctree-l3"><a class="reference internal" href="../multicodebase.html">2.5.23. Multiple-Codebase Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../misc/index.html">2.5.24. Miscellaneous Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tests/index.html">2.5.25. Testing Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../customization.html">2.6. Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cmdline.html">2.7. Command-line Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../resources.html">2.8. Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../optimization.html">2.9. Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../plugins.html">2.10. Plugin Infrastructure in Buildbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../deploy.html">2.11. Deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../upgrading/index.html">2.12. Upgrading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">3. Buildbot Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../relnotes/index.html">4. Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../relnotes/index.html#older-release-notes">5. Older Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../indices.html">6. API Indices</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Buildbot</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html"><span class="section-number">2. </span>Buildbot Manual</a></li>
          <li class="breadcrumb-item"><a href="../index.html"><span class="section-number">2.5. </span>Configuration</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">2.5.12. </span>Build Steps</a></li>
      <li class="breadcrumb-item active"><span class="section-number">2.5.12.19. </span>ShellCommand</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/manual/configuration/steps/shell_command.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="shellcommand">
<span id="step-shellcommand"></span><span id="step-ShellCommand"></span><h1><span class="section-number">2.5.12.19. </span>ShellCommand<a class="headerlink" href="#shellcommand" title="Link to this heading"></a></h1>
<p>Most interesting steps involve executing a process of some sort on the worker.
The <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> class handles this activity.</p>
<p>Several subclasses of <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> are provided as starting points for common build steps.</p>
<section id="using-shellcommands">
<h2>Using ShellCommands<a class="headerlink" href="#using-shellcommands" title="Link to this heading"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="buildbot.steps.shell.ShellCommand">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">buildbot.steps.shell.</span></span><span class="sig-name descname"><span class="pre">ShellCommand</span></span><a class="headerlink" href="#buildbot.steps.shell.ShellCommand" title="Link to this definition"></a></dt>
<dd></dd></dl>

<p>This is a useful base class for just about everything you might want to do during a build (except for the initial source checkout).
It runs a single command in a child shell on the worker.
All stdout/stderr is recorded into a <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code>.
The step usually finishes with a status of <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code> if the command’s exit code is non-zero, otherwise it has a status of <code class="docutils literal notranslate"><span class="pre">SUCCESS</span></code>.</p>
<p>The preferred way to specify the command is with a list of argv strings, since this allows for spaces in filenames and avoids doing any fragile shell-escaping.
You can also specify the command with a single string, in which case the string is given to <code class="samp docutils literal notranslate"><span class="pre">/bin/sh</span> <span class="pre">-c</span> <em><span class="pre">COMMAND</span></em></code> for parsing.</p>
<p>On Windows, commands are run via <code class="docutils literal notranslate"><span class="pre">cmd.exe</span> <span class="pre">/c</span></code> which works well.
However, if you’re running a batch file, the error level does not get propagated correctly unless you add ‘call’ before your batch file’s name: <code class="docutils literal notranslate"><span class="pre">cmd=['call',</span> <span class="pre">'myfile.bat',</span> <span class="pre">...]</span></code>.</p>
<p>The <a class="reference internal" href="#step-ShellCommand" title="ShellCommand"><code class="xref bb bb-step docutils literal notranslate"><span class="pre">ShellCommand</span></code></a> arguments are:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">command</span></code></dt><dd><p>A list of strings (preferred) or single string (discouraged) which specifies the command to be run.
A list of strings is preferred because it can be used directly as an argv array.
Using a single string (with embedded spaces) requires the worker to pass the string to <strong class="command">/bin/sh</strong> for interpretation, which raises all sorts of difficult questions about how to escape or interpret shell metacharacters.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">command</span></code> contains nested lists (for example, from a properties substitution), then that list will be flattened before it is executed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">workdir</span></code></dt><dd><p>All <code class="xref py py-class docutils literal notranslate"><span class="pre">ShellCommand</span></code>s are run by default in the <code class="docutils literal notranslate"><span class="pre">workdir</span></code>, which defaults to the <code class="file docutils literal notranslate"><span class="pre">build</span></code> subdirectory of the worker builder’s base directory.
The absolute path of the workdir will thus be the worker’s basedir (set as an option to <code class="docutils literal notranslate"><span class="pre">buildbot-worker</span> <span class="pre">create-worker</span></code>, <a class="reference internal" href="../../installation/worker.html#creating-a-worker"><span class="std std-ref">Creating a worker</span></a>), plus the builder’s basedir (set in the builder’s <code class="docutils literal notranslate"><span class="pre">builddir</span></code> key in <code class="file docutils literal notranslate"><span class="pre">master.cfg</span></code>), plus the workdir itself (a class-level attribute of the BuildFactory, defaults to <code class="file docutils literal notranslate"><span class="pre">build</span></code>).</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">workdir</span><span class="o">=</span><span class="s2">&quot;build/tests&quot;</span><span class="p">))</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">env</span></code></dt><dd><p>A dictionary of environment strings which will be added to the child command’s environment.
For example, to run tests with a different i18n language setting, you might use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;LANG&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">}))</span>
</pre></div>
</div>
<p>These variable settings will override any existing ones in the worker’s environment or the environment specified in the <code class="xref py py-class docutils literal notranslate"><span class="pre">Builder</span></code>.
The exception is <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>, which is merged with (actually prepended to) any existing <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> setting.
The following example will prepend <code class="file docutils literal notranslate"><span class="pre">/home/buildbot/lib/python</span></code> to any existing <span class="target" id="index-2"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PYTHONPATH&#39;</span><span class="p">:</span> <span class="s2">&quot;/home/buildbot/lib/python&quot;</span><span class="p">}))</span>
</pre></div>
</div>
<p>To avoid the need of concatenating paths together in the master config file, if the value is a list, it will be joined together using the right platform dependent separator.</p>
<p>Those variables support expansion so that if you just want to prepend <code class="file docutils literal notranslate"><span class="pre">/home/buildbot/bin</span></code> to the <span class="target" id="index-3"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PATH</span></code> environment variable, you can do it by putting the value <code class="docutils literal notranslate"><span class="pre">${PATH}</span></code> at the end of the value like in the example below.
Variables that don’t exist on the worker will be replaced by <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
              <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
              <span class="n">env</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;PATH&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;/home/buildbot/bin&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;$</span><span class="si">{PATH}</span><span class="s2">&quot;</span><span class="p">]}))</span>
</pre></div>
</div>
<p>Note that environment values must be strings (or lists that are turned into strings).
In particular, numeric properties such as <code class="docutils literal notranslate"><span class="pre">buildnumber</span></code> must be substituted using <a class="reference internal" href="../properties.html#interpolate"><span class="std std-ref">Interpolate</span></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">want_stdout</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">False</span></code>, stdout from the child process is discarded rather than being sent to the buildmaster for inclusion in the step’s <code class="xref py py-class docutils literal notranslate"><span class="pre">LogFile</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">want_stderr</span></code></dt><dd><p>Like <code class="docutils literal notranslate"><span class="pre">want_stdout</span></code> but for <code class="file docutils literal notranslate"><span class="pre">stderr</span></code>.
Note that commands that run through a PTY do not have separate <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>/<code class="file docutils literal notranslate"><span class="pre">stderr</span></code> streams, and both are merged into <code class="file docutils literal notranslate"><span class="pre">stdout</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usePTY</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, this command will be run in a <code class="docutils literal notranslate"><span class="pre">pty</span></code> (defaults to <code class="docutils literal notranslate"><span class="pre">False</span></code>).
This option is not available on Windows.</p>
<p>In general, you do not want to use a pseudo-terminal.
This is <em>only</em> useful for running commands that require a terminal - for example, testing a command-line application that will only accept passwords read from a terminal.
Using a pseudo-terminal brings lots of compatibility problems, and prevents Buildbot from distinguishing the standard error (red) and standard output (black) streams.</p>
<p>In previous versions, the advantage of using a pseudo-terminal was that <code class="docutils literal notranslate"><span class="pre">grandchild</span></code> processes were more likely to be cleaned up if the build was interrupted or it timed out.
This occurred because using a pseudo-terminal incidentally puts the command into its own process group.</p>
<p>As of Buildbot-0.8.4, all commands are placed in process groups, and thus grandchild processes will be cleaned up properly.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logfiles</span></code></dt><dd><p>Sometimes commands will log interesting data to a local file, rather than emitting everything to stdout or stderr.
For example, Twisted’s <strong class="command">trial</strong> command (which runs unit tests) only presents summary information to stdout, and puts the rest into a file named <code class="file docutils literal notranslate"><span class="pre">_trial_temp/test.log</span></code>.
It is often useful to watch these files as the command runs, rather than using <strong class="command">/bin/cat</strong> to dump their contents afterwards.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">logfiles=</span></code> argument allows you to collect data from these secondary logfiles in near-real-time, as the step is running.
It accepts a dictionary which maps from a local Log name (which is how the log data is presented in the build results) to either a remote filename (interpreted relative to the build’s working directory), or a dictionary of options.
Each named file will be polled on a regular basis (every couple of seconds) as the build runs, and any new text will be sent over to the buildmaster.</p>
<p>If you provide a dictionary of options instead of a string, you must specify the <code class="docutils literal notranslate"><span class="pre">filename</span></code> key.
You can optionally provide a <code class="docutils literal notranslate"><span class="pre">follow</span></code> key which is a boolean controlling whether a logfile is followed or concatenated in its entirety.
Following is appropriate for logfiles to which the build step will append, where the pre-existing contents are not interesting.
The default value for <code class="docutils literal notranslate"><span class="pre">follow</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, which gives the same behavior as just providing a string filename.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span>
                   <span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                   <span class="n">logfiles</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;triallog&quot;</span><span class="p">:</span> <span class="s2">&quot;_trial_temp/test.log&quot;</span><span class="p">}))</span>
</pre></div>
</div>
<p>The above example will add a log named ‘triallog’ on the master, based on <code class="file docutils literal notranslate"><span class="pre">_trial_temp/test.log</span></code> on the worker.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">buildbot.plugins</span> <span class="kn">import</span> <span class="n">steps</span>

<span class="n">f</span><span class="o">.</span><span class="n">addStep</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">ShellCommand</span><span class="p">(</span><span class="n">command</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;make&quot;</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">],</span>
                             <span class="n">logfiles</span><span class="o">=</span><span class="p">{</span>
                                 <span class="s2">&quot;triallog&quot;</span><span class="p">:</span> <span class="p">{</span>
                                    <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="s2">&quot;_trial_temp/test.log&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;follow&quot;</span><span class="p">:</span> <span class="kc">True</span>
                                 <span class="p">}</span>
                             <span class="p">}))</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lazylogfiles</span></code></dt><dd><p>If set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, logfiles will be tracked lazily, meaning that they will only be added when and if something is written to them.
This can be used to suppress the display of empty or missing log files.
The default is <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">timeout</span></code></dt><dd><p>If the command fails to produce any output for this many seconds, it is assumed to be locked up and will be killed.
This defaults to 1200 seconds.
Pass <code class="docutils literal notranslate"><span class="pre">None</span></code> to disable.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">maxTime</span></code></dt><dd><p>If the command takes longer than this many seconds, it will be killed.
This is disabled by default.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logEnviron</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code> (the default), then the step’s logfile will describe the environment variables on the worker.
In situations where the environment is not relevant and is long, it may be easier to set it to <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">interruptSignal</span></code></dt><dd><p>This is the signal (specified by name) that should be sent to the process when the command needs to be interrupted (either by the buildmaster, a timeout, etc.).
By default, this is “KILL” (9).
Specify “TERM” (15) to give the process a chance to cleanup.
This functionality requires a version 0.8.6 worker or newer.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">sigtermTime</span></code></dt><dd><p>If set, when interrupting, try to kill the command with SIGTERM and wait for sigtermTime seconds before firing <code class="docutils literal notranslate"><span class="pre">interuptSignal</span></code>.
If None, <code class="docutils literal notranslate"><span class="pre">interruptSignal</span></code> will be fired immediately upon interrupt.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">initialStdin</span></code></dt><dd><p>If the command expects input on stdin, the input can be supplied as a string with this parameter.
This value should not be excessively large, as it is handled as a single string throughout Buildbot – for example, do not pass the contents of a tarball with this parameter.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">decodeRC</span></code></dt><dd><p>This is a dictionary that decodes exit codes into results value.
For example, <code class="docutils literal notranslate"><span class="pre">{0:SUCCESS,1:FAILURE,2:WARNINGS}</span></code> will treat the exit code <code class="docutils literal notranslate"><span class="pre">2</span></code> as <code class="docutils literal notranslate"><span class="pre">WARNINGS</span></code>.
The default (<code class="docutils literal notranslate"><span class="pre">{0:SUCCESS}</span></code>) is to treat just 0 as successful.
Any exit code not present in the dictionary will be treated as <code class="docutils literal notranslate"><span class="pre">FAILURE</span></code>.</p>
</dd>
</dl>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="git_diffinfo.html" class="btn btn-neutral float-left" title="2.5.12.18. GitDiffInfo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="shell_sequence.html" class="btn btn-neutral float-right" title="2.5.12.20. Shell Sequence" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Buildbot Team Members.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>